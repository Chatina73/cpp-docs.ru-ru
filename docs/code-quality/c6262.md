---
title: C6262
ms.date: 11/04/2016
ms.topic: reference
f1_keywords:
- C6262
helpviewer_keywords:
- C6262
ms.assetid: 3eddc74e-2b05-4159-a093-fd469fdcebbb
ms.openlocfilehash: f26694d92f2919ed04d844352bacbb19bb22f81d
ms.sourcegitcommit: 7bea0420d0e476287641edeb33a9d5689a98cb98
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/17/2020
ms.locfileid: "79468519"
---
# <a name="c6262"></a>C6262

> предупреждение C6262: функция использует константу \<> байт в стеке: превышает/Analyze: STACKSIZE\<Constant 2 >. Рассмотрите возможность перемещения некоторых данных в кучу.

Это предупреждение означает, что использование стека, превышающее предопределенное пороговое значение (`constant 2`), было обнаружено в функции. Размер кадра стека по умолчанию для этого предупреждения составляет 16 КБ для пользовательского режима, 1 КБ для режима ядра. Stack — даже в пользовательском режиме — ограничено, и Сбой фиксации страницы стека вызывает исключение переполнения стека. Режим ядра имеет ограничение в 12 КБ размера стека, что не может быть увеличено; Поэтому код режима ядра должен жестко ограничивать использование стека.

Чтобы устранить проблему, связанную с этим предупреждением, можно либо переместить данные в кучу, либо в другую динамическую память.  В пользовательском режиме один большой кадр стека может не быть проблемой — и это предупреждение может быть подавлено, но большой кадр стека увеличивает риск переполнения стека. (Большой кадр стека может произойти, если функция использует стек сильно или является рекурсивной.) Общий размер стека в пользовательском режиме может быть увеличен, если переполнение стека действительно происходит, но только до ограничения системы.  Можно использовать параметр командной строки **/Analyze** , чтобы изменить значение `<constant 2>`, но при увеличении он создает риск того, что сообщение об ошибке не будет выводиться.

Для кода режима ядра, например в проектах драйверов, значение `<constant 2>` устанавливается в 1 КБ. Хорошо написанные драйверы должны иметь очень мало функций, которые могут подходить к этому значению, а изменение ограничения вниз может быть желательным.  Те же общие методы, которые используются для кода пользовательского режима для уменьшения размера стека, можно адаптировать в код режима ядра.

## <a name="example"></a>Пример

В следующем коде создается это предупреждение, поскольку `char buffer` выделяет 16 382 байт, а локальная целочисленная переменная `i` выделяет еще 4 байта, что в совокупности превышает предельный размер стека по умолчанию (16 КБ).

```cpp
// cl.exe /c /analyze /EHsc /W4
#include <windows.h>
#define MAX_SIZE 16382

void f( )
{
    int i;
    char buffer[MAX_SIZE];

    i = 0;
    buffer[0]='\0';

    // code...
}
```

Следующий код устраняет это предупреждение, перемещая некоторые данные в кучу.

```cpp
// cl.exe /c /analyze /EHsc /W4
#include <stdlib.h>
#include <malloc.h>
#define MAX_SIZE 16382

void f( )
{
    int i;
    char *buffer;

    i = 0;
    buffer = (char *) malloc( MAX_SIZE );
    if (buffer != NULL)
    {
        buffer[0] = '\0';
        // code...
        free(buffer);
    }
}
```

Использование функции malloc и Free имеет много ловушек с точки зрения утечек памяти и исключений. Чтобы избежать такого рода утечек и проблем с исключениями, используйте механизмы, предоставляемые C++ стандартной библиотекой шаблонов (STL). К ним относятся [shared_ptr](/cpp/standard-library/shared-ptr-class), [unique_ptr](/cpp/standard-library/unique-ptr-class)и [vector](/cpp/standard-library/vector). Дополнительные сведения см. в разделе [смарт-указатели](/cpp/cpp/smart-pointers-modern-cpp) и [ C++ Стандартная библиотека](/cpp/standard-library/cpp-standard-library-reference).

**Исправление этого предупреждения путем настройки размера стека**

1. В строке меню выберите **Проект** > **Свойства**.

     Откроется диалоговое окно **Страницы свойств**.

2. Разверните узел **Свойства конфигурации**.

3. Развернуть **C/C++** .

4. Выберите свойства **командной строки** .

5. В окне **Дополнительные параметры**добавьте **/Analyze: stacksize16388**.

## <a name="see-also"></a>См. также раздел

- [/STACK (выделение памяти в стеке)](/cpp/build/reference/stack-stack-allocations)
- [_resetstkoflw](/cpp/c-runtime-library/reference/resetstkoflw)
- [Практическое руководство. Настройка проверок во время выполнения машинного кода](/visualstudio/debugger/how-to-use-native-run-time-checks)
