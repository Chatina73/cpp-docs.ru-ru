---
title: 'Пошаговое прохождение: Анализ кода C/C- для дефектов'
description: Демонстрирует, как использовать анализ кода с помощью Microsoft C ' в Visual Studio.
ms.date: 04/14/2020
ms.topic: conceptual
helpviewer_keywords:
- C/C++, code analysis
- code analysis, walkthroughs
- code, analyzing C/C++
- code analysis tool, walkthroughs
ms.openlocfilehash: fe9b3775199b2a18cf940b99e87852350f1fbea9
ms.sourcegitcommit: c123cc76bb2b6c5cde6f4c425ece420ac733bf70
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81370217"
---
# <a name="walkthrough-analyzing-cc-code-for-defects"></a>Пошаговое прохождение: Анализ кода C/C- для дефектов

В этом пошаговом показании показано, как анализировать код C/C's на возможные дефекты кода. Он использует инструменты анализа кода для C/C.

В этом пошаговом шаге вы:

- Выполнить анализ кода на родном коде.
- Проанализируйте предупреждения о дефектах кода.
- Относитесь к предупреждению как к ошибке.
- Аннотировать исходный код для улучшения анализа дефектов кода.

## <a name="prerequisites"></a>Предварительные требования

- Копия [образца CppDemo](../code-quality/demo-sample.md).
- Базовое понимание C/C.

## <a name="run-code-analysis-on-native-code"></a>Выполнить анализ кода на родном коде

### <a name="to-run-code-defect-analysis-on-native-code"></a>Для запуска анализа дефектов кода на родном коде

::: moniker range=">=vs-2019"

1. Откройте решение CppDemo в Visual Studio.

     Решение CppDemo теперь заполняет **Solution Explorer.**

1. В меню **сборки** выберите **решение Rebuild.**

     Решение строится без каких-либо ошибок или предупреждений.

1. В **Solution Explorer**выберите проект CodeDefects.

1. В меню **проекта** выберите **Свойства**.

     Отображается диалоговое окно **CodeDefects Property Pages.**

1. Выберите страницу анализа **кода.**

1. Измените **анализ кода включить свойство сборки** на **Yes**. Выберите **ОК** для сохранения внесенных изменений.

1. Перестроить проект CodeDefects.

     Предупреждения об анализе кода отображаются в окне **списка ошибок.**

::: moniker-end

::: moniker range="<=vs-2017"

1. Откройте решение CppDemo в Visual Studio.

     Решение CppDemo теперь заполняет **Solution Explorer.**

1. В меню **сборки** выберите **решение Rebuild.**

     Решение строится без каких-либо ошибок или предупреждений.

     > [!NOTE]
     > В Visual Studio 2017 вы можете увидеть `E1097 unknown attribute "no_init_all"` ложное предупреждение в движке IntelliSense. Это предупреждение можно проигнорировать.

1. В **Solution Explorer**выберите проект CodeDefects.

1. В меню **проекта** выберите **Свойства**.

     Отображается диалоговое окно **CodeDefects Property Pages.**

1. Выберите страницу анализа **кода.**

1. Выберите **анализ кода включить на** флажке сборки. Выберите **ОК** для сохранения внесенных изменений.

1. Перестроить проект CodeDefects.

     Предупреждения об анализе кода отображаются в окне **списка ошибок.**

::: moniker-end

### <a name="to-analyze-code-defect-warnings"></a>Для анализа предупреждений о дефектах кода

1. В меню **View** выберите **Список ошибок.**

     Этот элемент меню может быть невиден. Это зависит от профиля разработчика, который вы выбрали в Visual Studio. Возможно, вам придется указать на **другие окна** в меню **View,** а затем выбрать **Список ошибок.**

1. В окне **списка ошибок** дважды щелкните следующее предупреждение:

     C6230: Неявный бросок между семантически разными типами: использование HRESULT в контексте Boolean.

     Редактор кода отображает строку, вызвавшую `bool ProcessDomain()`предупреждение внутри функции. Это предупреждение указывает `HRESULT` на то, что a используется в "если" заявление, где ожидается результат Boolean. Это, как правило, ошибка, `S_OK` потому что, когда HRESULT возвращается из функции, это `false`указывает на успех, но при преобразовании в boolean значение он оценивает в .

1. Исправьте это `SUCCEEDED` предупреждение с помощью макроса, который преобразуется `true` в то время, когда значение `HRESULT` возврата указывает на успех. Ваш код должен напоминать следующий код:

   ```cpp
   if (SUCCEEDED(ReadUserAccount()))
   ```

1. В **списке ошибок**, дважды нажмите следующее предупреждение:

     C6282: Неправильный оператор: назначение константы в контексте Boolean. Вместо этого рассмотрите возможность использования «я».

1. Исправьте это предупреждение, проверив равенство. Ваш код должен быть похож на следующий код:

   ```cpp
   if ((len == ACCOUNT_DOMAIN_LEN) || (g_userAccount[len] != L'\\'))
   ```

1. Исправьте оставшиеся предупреждения C6001 `i` в `j` **списке ошибок,** инициализировать и до 0.

1. Перестроить проект CodeDefects.

     Проект строится без каких-либо предупреждений или ошибок.

## <a name="correct-source-code-annotation-warnings"></a>Правильные предупреждения об аннотации исходного кода

### <a name="to-enable-the-source-code-annotation-warnings-in-annotationc"></a>Включить предупреждения об аннотации исходного кода в аннотации.c

::: moniker range=">=vs-2019"

1. В Solution Explorer выберите проект Аннотации.

1. В меню **проекта** выберите **Свойства**.

     Отображается диалоговая коробка **«Страницы аннотаций».**

1. Выберите страницу анализа **кода.**

1. Измените **анализ кода включить свойство сборки** на **Yes**. Выберите **ОК** для сохранения внесенных изменений.

::: moniker-end

::: moniker range="<=vs-2017"

1. В Solution Explorer выберите проект Аннотации.

1. В меню **проекта** выберите **Свойства**.

     Отображается диалоговая коробка **«Страницы аннотаций».**

1. Выберите страницу анализа **кода.**

1. Выберите **анализ кода включить на** флажке сборки. Выберите **ОК** для сохранения внесенных изменений.

::: moniker-end

### <a name="to-correct-the-source-code-annotation-warnings-in-annotationc"></a>Для исправления предупреждений об аннотации исходного кода в аннотации.c

1. Перестроить проект Аннотаций.

1. В меню **сборки** выберите **анализ кода на аннотациях.**

1. В **списке ошибок**, дважды нажмите следующее предупреждение:

     C6011: Dereferencing NULL указатель 'newNode'.

     Это предупреждение указывает на сбой вызываемого значения для проверки значения возврата. В этом случае вызов `AllocateNode` может вернуть значение NULL. Смотрите файл заголовка annotations.h для `AllocateNode`объявления функции для .

1. Курсор находится на месте в файле annotations.cpp, где произошло предупреждение.

1. Чтобы исправить это предупреждение, используйте выписку "если" для проверки значения возврата. Ваш код должен напоминать следующий код:

   ```cpp
   LinkedList* newNode = AllocateNode();
   if (nullptr != newNode)
   {
       newNode->data = value;
       newNode->next = 0;
       node->next = newNode;
   }
   ```

1. Перестроить проект Аннотаций.

     Проект строится без каких-либо предупреждений или ошибок.

## <a name="use-source-code-annotation-to-discover-more-issues"></a>Используйте аннотацию исходного кода, чтобы узнать больше проблем

### <a name="to-use-source-code-annotation"></a>Использовать аннотацию исходного кода

1. Аннотировать формальные параметры и значение `AddTail` возврата функции для указания значений указателя может быть нулевым:

   ```cpp
   _Ret_maybenull_ LinkedList* AddTail(_Maybenull_ LinkedList* node, int value)
   ```

1. В меню **Сборка** выберите **Выполнить анализ кода в решении**.

1. В **списке ошибок**, дважды нажмите следующее предупреждение:

     C6011: Dereferencing null указатель 'узла'.

     Это предупреждение указывает на то, что узла, переданного в функцию, может быть нулевым.

1. Чтобы исправить это предупреждение, используйте оператора "если" в начале функции для проверки пройденное значение. Ваш код должен напоминать следующий код:

   ```cpp
   if (nullptr == node)
   {
        return nullptr;
   }
   ```

1. В меню **Сборка** выберите **Выполнить анализ кода в решении**.

     Теперь проект строится без каких-либо предупреждений или ошибок.

## <a name="see-also"></a>См. также раздел

[Пошаговое прохождение: Анализ управляемого кода для дефектов кода](/visualstudio/code-quality/walkthrough-analyzing-managed-code-for-code-defects)\
[Анализ кода для C/C](../code-quality/code-analysis-for-c-cpp-overview.md)
