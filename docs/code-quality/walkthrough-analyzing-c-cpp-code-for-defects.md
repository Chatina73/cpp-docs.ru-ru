---
title: Пошаговое руководство.C++ анализ кода C/Code для дефектов
ms.date: 11/04/2016
ms.topic: conceptual
helpviewer_keywords:
- C/C++, code analysis
- code analysis, walkthroughs
- code, analyzing C/C++
- code analysis tool, walkthroughs
ms.openlocfilehash: 5fbdf9e223b3c1e1b8664de2018381958c458f45
ms.sourcegitcommit: 7bea0420d0e476287641edeb33a9d5689a98cb98
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/17/2020
ms.locfileid: "79467069"
---
# <a name="walkthrough-analyzing-cc-code-for-defects"></a>Пошаговое руководство.C++ анализ кода C/Code для дефектов

В этом пошаговом руководстве показано,C++ как анализировать код c/Code для потенциальных дефектов кода с помощью средстваC++ анализа кода для C/Code.

- Выполнение анализа кода в машинном коде.
- Анализ предупреждений о дефектах кода.
- Рассматривать предупреждение как ошибку.
- Закомментировать исходный код, чтобы улучшить анализ дефектов кода.

## <a name="prerequisites"></a>предварительные требования

- Копия [демонстрационного примера](../code-quality/demo-sample.md).
- Основные сведения о C/C++.

### <a name="to-run-code-defect-analysis-on-native-code"></a>Выполнение анализа дефектов кода в машинном коде

1. Откройте демонстрационное решение в Visual Studio.

     Демонстрационное решение теперь заполняет **Обозреватель решений**.

1. В меню **Построить** выберите пункт **Перестроить решение**.

     Решение строится без ошибок или предупреждений.

1. В **Обозреватель решений**выберите проект кодедефектс.

1. В меню **Проект** выберите **Свойства**.

     Откроется диалоговое окно **страницы свойств кодедефектс** .

1. Щелкните **Анализ кода**.

1. Установите флажок **Включить анализ кода для C/C++ при сборке** .

1. Перестройте проект Кодедефектс.

     Предупреждения анализа кода отображаются в **Список ошибок**.

### <a name="to-analyze-code-defect-warnings"></a>Анализ предупреждений о дефектах кода

1. В меню **Вид** выберите пункт **Список ошибок**.

     В зависимости от профиля разработчика, выбранного в Visual Studio, может потребоваться указать **другие окна** в меню **вид** , а затем выбрать пункт **Список ошибок**.

1. В **Список ошибок**дважды щелкните следующее предупреждение:

     предупреждение C6230: неявное приведение между семантически различными типами: использование HRESULT в логическом контексте.

     В редакторе кода отображается строка, вызвавшая предупреждение в функции `bool ProcessDomain()`. Это предупреждение означает, что в операторе "If" используется `HRESULT`, где ожидается логический результат.  Как правило, это ошибка, так как при возвращении `S_OK` HRESULT из функции она указывает на успешное выполнение, но при преобразовании в логическое значение, результатом которого является `false`.

1. Исправьте это предупреждение с помощью макроса `SUCCEEDED`, который преобразует в `true`, когда `HRESULT` возвращаемое значение указывает на успешное выполнение. Код должен выглядеть следующим образом:

   ```cpp
   if (SUCCEEDED (ReadUserAccount()) )
   ```

1. В **Список ошибок**дважды щелкните следующее предупреждение:

     Предупреждение C6282: неверный оператор: присваивание значения константе в контексте теста. WAS = = планировалось?

1. Исправьте это предупреждение, проверив его на равенство. Код должен выглядеть примерно так, как показано в следующем коде:

   ```cpp
   if ((len == ACCOUNT_DOMAIN_LEN) || (g_userAccount[len] != '\\'))
   ```

### <a name="to-treat-warning-as-an-error"></a>Обработка предупреждения как ошибки

1. В файле bug. cpp добавьте следующую инструкцию `#pragma` в начало файла, чтобы C6001 предупреждение в виде ошибки:

   ```cpp
   #pragma warning (error: 6001)
   ```

1. Перестройте проект Кодедефектс.

     В **Список ошибок**C6001 теперь отображается как ошибка.

1. Исправьте оставшиеся две ошибки C6001 в **Список ошибок** , инициализируя `i` и `j` до 0.

1. Перестройте проект Кодедефектс.

     Проект строится без предупреждений или ошибок.

### <a name="to-correct-the-source-code-annotation-warnings-in-annotationc"></a>Исправление предупреждений в заметке исходного кода в аннотации. c

1. В обозреватель решений выберите проект аннотации.

1. В меню **Проект** выберите **Свойства**.

     Откроется диалоговое окно **страницы свойств заметки** .

1. Щелкните **Анализ кода**.

1. Установите флажок **Включить анализ кода для C/C++ при сборке** .

1. Перестройте проект Annotations.

1. В **Список ошибок**дважды щелкните следующее предупреждение:

     предупреждение C6011: разыменование ПУСТого указателя "newNode".

     Это предупреждение указывает на сбой вызывающей стороны для проверки возвращаемого значения. В этом случае вызов **аллокатеноде** может вернуть значение null (см. h-файл заголовков аннотации для объявления функции для аллокатеноде).

1. Откройте файл Annotations. cpp.

1. Чтобы исправить это предупреждение, используйте оператор "If" для проверки возвращаемого значения. Код должен выглядеть следующим образом:

   ```cpp
   if (nullptr != newNode)
   {
       newNode->data = value;
       newNode->next = 0;
       node->next = newNode;
   }
   ```

1. Перестройте проект Annotations.

     Проект строится без предупреждений или ошибок.

### <a name="to-use-source-code-annotation"></a>Использование заметок к исходному коду

1. Закомментировать формальные параметры и возвращаемое значение функции `AddTail` чтобы указать, что значения указателя могут быть равны NULL:

   ```cpp
   _Ret_maybenull_ LinkedList* AddTail(_Maybenull_ LinkedList* node, int value)
   ```

1. Перестроение проекта заметок.

1. В **Список ошибок**дважды щелкните следующее предупреждение:

     предупреждение C6011: разыменование ПУСТого указателя "Node".

     Это предупреждение означает, что узел, переданный в функцию, может иметь значение NULL и указывает номер строки, в которой было вызвано предупреждение.

1. Чтобы исправить это предупреждение, используйте оператор "If" в начале функции, чтобы проверить переданное значение. Код должен выглядеть следующим образом:

   ```cpp
   if (nullptr == node)
   {
        return nullptr;
   }
   ```

1. Перестроение проекта заметок.

     Теперь проект строится без предупреждений или ошибок.

## <a name="see-also"></a>См. также раздел

[Пошаговое руководство. анализ управляемого кода на предмет дефектов кода](/visualstudio/code-quality/walkthrough-analyzing-managed-code-for-code-defects)\
[Анализ кода для C/C++](../code-quality/code-analysis-for-c-cpp-overview.md)
