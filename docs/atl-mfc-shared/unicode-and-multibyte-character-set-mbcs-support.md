---
title: Поддержка Юникода и многобайтовой кодировки
ms.date: 01/09/2017
helpviewer_keywords:
- MFC [C++], character set support
- MBCS [C++], strings and MFC support
- strings [C++], MBCS support in MFC
- character sets [C++], multibyte
- Unicode [C++], MFC strings
- Unicode [C++], string objects
- strings [C++], Unicode
- strings [C++], character set support
ms.openlocfilehash: efa90acd169aeb8739b0bf97a5ab27026cc80cc6
ms.sourcegitcommit: ec6dd97ef3d10b44e0fedaa8e53f41696f49ac7b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/25/2020
ms.locfileid: "88831987"
---
# <a name="unicode-and-multibyte-character-set-mbcs-support"></a>Поддержка Юникода и многобайтовой кодировки

Некоторые языки, например японский и китайский, имеют большие наборы символов. Для поддержки программирования этих рынков библиотека Microsoft Foundation Class (MFC) предоставляет два разных подхода к обработке больших наборов символов:

- [Юникод](#mfc-support-for-unicode-strings), **`wchar_t`** основанные на расширенных символах и строки в кодировке UTF-16.

- Многобайтовые [кодировки (MBCS)](#mfc-support-for-mbcs-strings), **`char`** основанные на одиночных или двухбайтовых символах и строки, закодированные в кодировке, зависящей от языкового стандарта.

Корпорация Майкрософт рекомендует использовать библиотеки Юникода MFC для всех новых сред разработки, а библиотеки MBCS не рекомендуются в Visual Studio 2013 и Visual Studio 2015. Этот режим больше не используется. Предупреждения об устаревании многобайтовых кодировок были удалены в Visual Studio 2017.

## <a name="mfc-support-for-unicode-strings"></a>Поддержка MFC для строк в Юникоде

Все библиотеки классов MFC условно поддерживаются для символов Юникода, а строки, хранящиеся в расширенных символах, — в кодировке UTF-16. В частности, класс [CString](../atl-mfc-shared/reference/cstringt-class.md) поддерживает Юникод.

Эти файлы библиотеки, отладчика и библиотеки DLL используются для поддержки Юникода в MFC:

:::row:::
   :::column span="":::
      MFC*версии*U. lib \
      MFC*версии*обновления. LIB
      МФКМ*версия*U. lib \
      МФКМ*версия*обновления. LIB
      МФКС*версия*U. lib \
      МФКС*версия*обновления. LIB
      УАФКСКВ. LIB
      УАФКСКВД. LIB
   :::column-end:::
   :::column span="":::
      Библиотека MFC*версии*U. pdb \
      MFC*версии*обновления. Файле
      МФКМ*версия*U. pdb \
      МФКМ*версия*обновления. Файле
      МФКС*версия*U. pdb \
      МФКС*версия*обновления. Файле
      УАФКСКВ. Файле
      УАФКСКВД. ФАЙЛЕ
   :::column-end:::
   :::column span="":::
      MFC*версии*U.DLL \
      MFC*версии*UD.DLL \
      МФКМ*версия*U.DLL \
      UD.DLL*версии* мфкм
   :::column-end:::
:::row-end:::

(*версия* представляет номер версии файла, например, "140" означает версию 14,0.)

`CString` основана на типе данных TCHAR. Если символ _UNICODE определен для сборки программы, то TCHAR определяется как тип **`wchar_t`** , 16-разрядный тип кодировки символов. В противном случае TCHAR определяется как **`char`** Обычная 8-разрядная кодировка символов. Таким образом, в Юникоде `CString` состоит из 16-разрядных символов. Без Юникода оно состоит из символов типа **`char`** .

Для завершения программирования в Юникоде приложения необходимо также:

- Используйте макрос _T, чтобы строковые литералы кода можно было перенести в Юникод.

- При передаче строк следует обратить внимание на то, требуется ли для аргументов функции длина в символах или длина в байтах. Разница важна при использовании строк Юникода.

- Используйте переносимые версии функций обработки строк времени выполнения языка C.

- Используйте следующие типы данных для символов и указателей символов:

  - Используйте TCHAR, где будет использоваться **`char`** .

  - Используйте LPTSTR, где будет использоваться **`char`** <strong>\*</strong> .

  - Используйте LPCTSTR, где будет использоваться **`const char`** <strong>\*</strong> . `CString` предоставляет оператор LPCTSTR для преобразования между `CString` и LPCTSTR.

`CString` также предоставляет конструкторы, поддерживающие Юникод, операторы присваивания и операторы сравнения.

[Ссылка на библиотеку времени выполнения](../c-runtime-library/c-run-time-library-reference.md) определяет переносимые версии всех функций обработки строк. Дополнительные сведения см. в разделе [Международная связь](../c-runtime-library/internationalization.md)категории.

## <a name="mfc-support-for-mbcs-strings"></a>Поддержка MFC для строк MBCS

Библиотека классов также включена для многобайтовых кодировок, но только для двухбайтовых наборов символов (DBCS).

В многобайтовой кодировке символ может иметь один или два байта в ширину. Если для него задано значение в два байта, его первый байт — это специальный "старший байт", который выбирается из определенного диапазона в зависимости от используемой кодовой страницы. Вместе, ведущий и «младший байт» задают уникальную кодировку символов.

Если для сборки программы определен символ _MBCS, то тип TCHAR, на котором `CString` основана, сопоставляется с **`char`** . Вы должны определить, какие байты a `CString` являются старшими байтами, а какие — конечными байтами. Библиотека времени выполнения языка C предоставляет функции, помогающие определить это.

В двухбайтовой кодировке DBCS заданная строка может содержать все однобайтовые ANSI-символы, все двухбайтовые символы или сочетание двух. Для этих возможностей требуется особая осторожность при анализе строк. Сюда входят `CString` объекты.

> [!NOTE]
> Сериализация строк Юникода в MFC может считывать строки как в Юникоде, так и в многобайтовой кодировке независимо от того, какая версия приложения используется. Файлы данных переносимы между Юникодом и многобайтовой версией программы.

`CString` функции-члены используют специальные "универсальные" версии функций среды выполнения C, которые они вызывают, или используют функции, поддерживающие Юникод. Поэтому, например, если `CString` функция обычно вызывает `strcmp` , вместо этого вызывается соответствующая универсальная функция `_tcscmp` . В зависимости от того, как определяются символы _MBCS и _UNICODE, `_tcscmp` сопоставляет их следующим образом:

|Символы|Функция|
|-|-|
|_MBCS определено|`_mbscmp`|
|_UNICODE определено|`wcscmp`|
|Не определен ни один символ|`strcmp`|

> [!NOTE]
> Символы _MBCS и _UNICODE являются взаимоисключающими.

Сопоставления универсальных текстовых функций для всех подпрограмм обработки строк во время выполнения обсуждаются в [справочнике по библиотеке времени выполнения C](../c-runtime-library/c-run-time-library-reference.md). Список см. в разделе [интернационализации](../c-runtime-library/internationalization.md).

Аналогичным образом, `CString` методы реализуются с помощью универсальных сопоставлений типов данных. Чтобы включить многобайтовую кодировку и Юникод, MFC использует TCHAR для **`char`** OR **`wchar_t`** , LPTSTR для **`char`** <strong>\*</strong> или `wchar_t*` и LPCTSTR для **const char** <strong>\*</strong> или `const wchar_t*` . Они обеспечивают правильное сопоставление для MBCS или Юникода.

## <a name="see-also"></a>См. также раздел

[Строки (ATL и MFC)](../atl-mfc-shared/strings-atl-mfc.md)<br/>
[Управление строками](../c-runtime-library/string-manipulation-crt.md)
