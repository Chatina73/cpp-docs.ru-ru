---
title: Управление строковыми данными
ms.date: 11/04/2016
helpviewer_keywords:
- Unicode, string objects
ms.assetid: 0b53a542-eeb1-4108-9ada-6700645b6f8f
ms.openlocfilehash: 7f92b38ac659faef2dd9319b2f204ba837f0d473
ms.sourcegitcommit: c123cc76bb2b6c5cde6f4c425ece420ac733bf70
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81317453"
---
# <a name="string-data-management"></a>Управление строковыми данными

Визуальный СЗ предлагает несколько способов управления строками данных:

- [Манипуляция строками](../c-runtime-library/string-manipulation-crt.md) для работы со строками с нулевым завершением C

- Функции API Win32 для управления строками

- Класс [CStringT класса](../atl-mfc-shared/reference/cstringt-class.md)MFC, который обеспечивает гибкие, изменяемые объекты строки

- [Класс CStringT Class,](../atl-mfc-shared/reference/cstringt-class.md)который предоставляет объект строки, независимую от MFC, с той же функциональностью, что и`CString`

Почти все программы работают со строками данных. `CString` Класс MFC часто является лучшим решением для гибкой обработки строк. Начиная с версии `CString` 7.0, можно использовать в программах MFC или MFC-независимых. Библиотека времени выполнения и `CString` строки поддержки, содержащие мультибайтные (широкие) символы, как в программировании Unicode или MBCS.

В этой статье описаны службы общего назначения, предоставляемые библиотекой классов, связанные с манипуляцией строками. Темы, затронутые в этой статье, включают:

- [Unicode и MBCS обеспечивают портативность](#_core_unicode_and_mbcs_provide_portability)

- [CStrings и конст-чар-указатели](#_core_cstrings_and_const_char_pointers)

- [CString Справочные Подсчет](#_core_cstring_reference_counting)

Класс [класса CStringT](../atl-mfc-shared/reference/cstringt-class.md) обеспечивает поддержку для манипулирования строками. Предназначен для замены и расширения функциональности, обычно предоставляемой пакетом строки c run-time. Класс `CString` поставляет функции членов и операторов для упрощенной обработки строк, аналогичных тем, которые содержатся в Basic. Класс также предоставляет конструкторам и операторам для построения, назначения и сравнения `CString`с и стандартных типов данных строксА СЗ. Поскольку `CString` вы не `CObject`являются производными от , вы можете использовать `CString` объекты независимо от большей части библиотеки класса Фонда Майкрософт (MFC).

`CString`объекты следуют «семантике значений». Объект `CString` представляет собой уникальное значение. Думайте о `CString` фактической строки, а не как указатель на строку.

Объект `CString` представляет собой последовательность переменного числа символов. `CString`объекты могут рассматриваться как массивы символов.

## <a name="unicode-and-mbcs-provide-portability"></a><a name="_core_unicode_and_mbcs_provide_portability"></a>Unicode и MBCS обеспечивают портативность

С версией MFC 3.0 и `CString`более поздними, MFC, включая, включен как для Unicode, так и для мультибайтных наборов символов (MBCS). Эта поддержка упрощает написание портативных приложений, которые можно создавать для символов Unicode или ANSI. Для включения этой переносимости `CString` каждый символ объекта имеет тип `wchar_t` TCHAR, который определяется как если `char` бы вы определили символ _UNICODE при создании приложения, или как будто нет. Ширина `wchar_t` персонажа составляет 16 битов. MBCS включен, если вы строите с символом _MBCS определены. Сам MFC построен либо с _MBCS символом (для библиотек NAFX) или _UNICODE символом (для библиотек UAFX) определены.

> [!NOTE]
> Примеры `CString` в этом и сопровождающих статьях на строках показывают буквальные строки, правильно отформатированные для переносимости Unicode, используя _T макрос, который переводит буквальную строку в форму:

`L"literal string"`

> [!NOTE]
> который компилятор рассматривает как строку Unicode. Например, приведенный ниже код

[!code-cpp[NVC_ATLMFC_Utilities#187](../atl-mfc-shared/codesnippet/cpp/string-data-management_1.cpp)]

> [!NOTE]
> переводится как строка Unicode, если _UNICODE определена или как строка ANSI, если нет. Для получения дополнительной информации смотрите статью [Unicode и Multibyte Набор символов (MBCS) Поддержка](../atl-mfc-shared/unicode-and-multibyte-character-set-mbcs-support.md).

Объект `CString` может хранить до INT_MAX (2 147 483 647) символов. Тип данных TCHAR используется для получения или `CString` установки отдельных символов внутри объекта. В отличие от `CString` массивов символов, класс имеет встроенную возможность распределения памяти. Это `CString` позволяет объектам автоматически расти по мере необходимости (т.е. вам не придется беспокоиться о том, чтобы создать `CString` объект, чтобы соответствовать более длинным струнам).

## <a name="cstrings-and-const-char-pointers"></a><a name="_core_cstrings_and_const_char_pointers"></a>CStrings и конст-чар-указатели

Объект `CString` также может действовать как буквальная строка `PCXSTR`в стиле C (an, который так же, как **const char,** <strong>\*</strong> если не под Unicode). [CSimpleStringT::оператор PCXSTR](../atl-mfc-shared/reference/csimplestringt-class.md#operator_pcxstr) конверсии оператор позволяет `CString` объектам свободно заменить указатели символов в функциональных вызовах. **Конструктор CString (LPCWSTR)** `pszSrc` **)** позволяет заменять указатели `CString` символов объектами.

Не предпринимается `CString` попытка сложить объекты. Если сделать `CString` два `Chicago`объекта, содержащих, например, символы, которые `Chicago` хранятся в двух местах. (Это не может быть верно в отношении будущих версий МФЦ, поэтому вы не должны зависеть от него.)

> [!NOTE]
> Используйте [CSimpleStringT::GetBuffer](../atl-mfc-shared/reference/csimplestringt-class.md#getbuffer) и [CSimpleStringT::ReleaseBuffer](../atl-mfc-shared/reference/csimplestringt-class.md#releasebuffer) член функции, `CString` когда вам нужно прямой доступ к непостоянной указатель на символ.

> [!NOTE]
> Используйте [CStringT::AllocSysString](../atl-mfc-shared/reference/cstringt-class.md#allocsysstring) и [CStringT::SetSysString](../atl-mfc-shared/reference/cstringt-class.md#setsysstring) функции члена для выделения и установки объектов BSTR, используемых в автоматизации (ранее известный как OL автоматизации).

> [!NOTE]
> По возможности `CString` выделите объекты на раме, а не на кучи. Это экономит память и упрощает прохождение параметра.

Класс `CString` не реализуется как класс коллекции библиотек `CString` и библиотек microsoft Foundation, хотя объекты, безусловно, могут храниться в качестве элементов в коллекциях.

## <a name="cstring-reference-counting"></a><a name="_core_cstring_reference_counting"></a>CString Справочные Подсчет

По версии MFC 4.0, когда объекты [класса CStringT](../atl-mfc-shared/reference/cstringt-class.md) копируются, MFC наращает количество ссылок, а не копирует данные. Это делает проходящие параметры `CString` по значениям и возврат объектов по значению более эффективным. Эти операции приводят к вызову конструктора копий, иногда более одного раза. Приравливание количества ссылок уменьшает накладные расходы для этих общих операций и делает использование `CString` более привлекательным вариантом.

Поскольку каждая копия уничтожается, количество ссылок в исходном объекте утилицируется. Исходный `CString` объект не уничтожается до тех пор, пока его количество ссылок не будет сведено к нулю.

Вы можете `CString` использовать функции членов [CSimpleStringT::LockBuffer](../atl-mfc-shared/reference/csimplestringt-class.md#lockbuffer) и [CSimpleStringT::UnlockBuffer](../atl-mfc-shared/reference/csimplestringt-class.md#unlockbuffer) отключить или включить подсчет ссылок.

## <a name="see-also"></a>См. также раздел

[Общие темы МФЦ](../mfc/general-mfc-topics.md)
