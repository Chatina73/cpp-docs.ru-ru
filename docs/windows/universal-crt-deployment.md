---
title: Развертывание универсальной библиотеки CRT
description: Узнайте, как, когда и где развертывать универсальную библиотеку CRT для приложения.
ms.date: 10/23/2020
helpviewer_keywords:
- deploying the CRT [C++]
- application CRT deployment [C++]
ms.openlocfilehash: 50ab23f3b0276b058685e9c9ef6634caf5a96186
ms.sourcegitcommit: bf54b407169900bb668c85a67b31dbc0f069fe65
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/24/2020
ms.locfileid: "92497211"
---
# <a name="universal-crt-deployment"></a>Развертывание универсальной библиотеки CRT

Начиная с Visual Studio .NET и заканчивая Visual Studio 2013 каждый основной выпуск инструментов и компилятора C++ содержал новую автономную версию библиотеки среды выполнения C (CRT) корпорации Майкрософт. Эти автономные версии CRT были независимыми друг от друга и в различной степени несовместимыми друг с другом. Например, библиотека CRT, используемая Visual Studio 2012, имела версию 11 и имя msvcr110.dll, а CRT в Visual Studio 2013 имела версию 12 и имя msvcr120.dll. Начиная с Visual Studio 2015, это больше не так. В Visual Studio 2015 и более поздних версиях используется одна универсальная CRT.

Универсальный CRT (UCRT) — это компонент операционной системы Microsoft Windows. Он входит в состав операционной системы Windows 10 и Windows Server 2016 или более поздней версии. UCRT доступен с помощью Центр обновления Windows в более старых операционных системах, которые по-прежнему доступны в расширенной поддержке. Локальное развертывание универсальной CRT поддерживается с некоторыми ограничениями.

## <a name="central-deployment"></a>Централизованное развертывание

Предпочитаемый способ централизованной установки универсальной CRT — Центр обновления Microsoft Windows. Универсальная CRT является рекомендуемым обновлением для всех поддерживаемых операционных систем Microsoft Windows, поэтому многие компьютеры устанавливают ее по умолчанию в рамках обычного процесса обновления. Первоначальный выпуск универсальной CRT был [KB2999226](https://support.microsoft.com/kb/2999226). Более позднее обновление с различными исправлениями ошибок было внесено в [KB3118401](https://support.microsoft.com/kb/3118401), и существуют дополнительные обновления с дальнейшими исправлениями ошибок и новыми функциями. Чтобы получить более актуальные обновления, выполните поиск по запросам "Universal C Runtime" (Универсальная среда выполнения C) или "Universal CRT" (Универсальная CRT) на сайте [support.microsoft.com](https://support.microsoft.com).

Не все компьютеры с Microsoft Windows регулярно получают обновления через Центр обновления Windows, а на некоторых могут устанавливаться не все рекомендуемые обновления. Для поддержки использования приложений, созданных с помощью инструментов Visual Studio 2015 и более поздних версий C++ на этих компьютерах, доступны распространяемые файлы универсальной библиотеки CRT, доступные для автономного распространения. Эти распространяемые файлы можно загрузить с одной из ссылок KB выше. Распространяемый компонент универсальной библиотеки CRT требует, чтобы компьютер был обновлен до текущего пакета обновления. Например, распространяемый пакет для Windows 7 будет устанавливаться только в Windows 7 с пакетом обновления 1 (SP1), но не в Windows 7 RTM.

Так как универсальная библиотека CRT является фундаментальной зависимостью библиотек C++, Visual C++ распространяемый пакет (VCRedist) устанавливает начальную версию универсальной библиотеки CRT (версии 10.0.10240) на компьютерах, на которых еще не установлены. Эта версия достаточна для удовлетворения зависимостей библиотеки C++. Если приложение зависит от более поздней версии универсальной библиотеки CRT, необходимо использовать Центр обновления Windows для полного обновления компьютера или установить эту версию явным образом. Перед установкой VCRedist рекомендуется установить универсальную среду выполнения C с помощью Центр обновления Windows или MSU, чтобы избежать потенциальных перезапусков.

Не все операционные системы подходят для последней универсальной среды выполнения C с помощью Центр обновления Windows. В Windows 10 версия, развернутая централизованно, соответствует версии операционной системы. Чтобы обновить универсальную среду выполнения C, необходимо обновить операционную систему. Для Windows Vista через Windows 8.1 Последняя доступная универсальная среда выполнения C в настоящее время основана на версии, включенной в годовщину обновления Windows 10, с дополнительными исправлениями (версия 10.0.14393).

## <a name="local-deployment"></a>Локальное развертывание

Локальное развертывание универсальной CRT поддерживается, хотя и не рекомендуется по соображениям безопасности и производительности. Библиотеки DLL для локального развертывания входят в состав пакета Windows SDK и находятся в подкаталоге Kits\\10\\Redist\\ucrt\\DLLs согласно архитектуре компьютера. Требуемые библиотеки DLL содержат ucrtbase.dll и набор библиотек DLL переадресации APISet с именем api-ms-win-\*.dll. Набор библиотек DLL, необходимых для каждой операционной системы, различается. Настоятельно рекомендуется включить все библиотеки DLL при развертывании локально.

Для локального развертывания существует два ограничения, которые следует учитывать:

- В Windows 10 универсальная CRT, расположенная в системном каталоге, используется всегда, даже если приложение имеет собственную локальную копию универсальной CRT. Это справедливо даже в том случае, если локальная копия является более новой, поскольку универсальная библиотека CRT является основным компонентом операционной системы в Windows 10.

- В версиях Windows до Windows 8 универсальную CRT нельзя упаковать локально с подключаемым модулем, если он находится в каталоге, отличном от каталога основного исполняемого файла приложения. В этом случае библиотеки DLL сервера пересылки APISet не могут успешно разрешить ucrtbase.dll. К рекомендуемым альтернативным способам относятся следующие.

  - Статическая компоновка универсальной CRT.
  - Централизованное развертывание универсальной CRT.
  - Помещение файлов универсальной CRT в один каталог с приложением.

## <a name="deployment-on-microsoft-windows-xp"></a>Развертывание в Microsoft Windows XP

Visual Studio 2015 и Visual Studio 2017 по-прежнему поддерживают разработку программного обеспечения для использования в Microsoft Windows XP. Для поддержки этой разработки версия универсальной библиотеки CRT работает в Microsoft Windows XP. Для операционной системы Microsoft Windows XP больше не предоставляется ни основная, ни расширенная поддержка, поэтому централизованное развертывание универсальной CRT в Microsoft Windows XP отличается от других операционных систем.

Если распространяемый компонент Visual C++ установлен в Windows XP, он непосредственно устанавливает универсальную CRT и все его зависимости в системный каталог. Он не устанавливается или не зависит от Центр обновления Windows. Распространяемые модули слияния — файлы Microsoft_VC*версия*_CRT_\*.msm — делают то же самое.

Локальное развертывание универсальной CRT в Windows XP осуществляется так же, как и в других поддерживаемых операционных системах.

## <a name="see-also"></a>См. также

- [Развертывание в Visual C++](deployment-in-visual-cpp.md)
