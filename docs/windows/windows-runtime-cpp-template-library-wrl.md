---
title: Библиотека шаблонов C++ среды выполнения Windows (WRL) | Документация Майкрософт
ms.custom: ''
ms.date: 11/04/2016
ms.technology:
- cpp-windows
ms.topic: reference
dev_langs:
- C++
ms.assetid: b915afce-553b-44a7-b8dc-0ab601758eb0
author: mikeblome
ms.author: mblome
ms.workload:
- cplusplus
- uwp
ms.openlocfilehash: 541a9d5064e9bdf9c4ddb9b410ab4dc0277626b0
ms.sourcegitcommit: a3c9e7888b8f437a170327c4c175733ad9eb0454
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/29/2018
ms.locfileid: "50204617"
---
# <a name="windows-runtime-c-template-library-wrl"></a>Библиотека шаблонов C++ среды выполнения Windows (WRL)

Библиотека шаблонов C++ среды выполнения Windows (WRL) — это библиотека шаблонов, которая предлагает низкоуровневый способ создания и использования компонентов среды выполнения Windows.

> [!NOTE]
> WRL теперь заменяется C + +/ WinRT, C ++ 17 проекция стандартного для API среды выполнения Windows. C + +/ WinRT доступна в пакете SDK для Windows 10 версии 1803 и далее. C + +/ WinRT реализуется полностью в файлах заголовков и предоставляющая с первоклассный доступ к современных API Windows.

> С использованием C + +/ WinRT, можно одновременно использовать и создавать интерфейсы API среды выполнения Windows, с помощью любой совместимый со стандартами C ++ 17 компилятор. C + +/ WinRT обычно работает быстрее и создает меньше двоичных файлов, чем любой другой параметр языка для среды выполнения Windows. Мы продолжим предоставлять поддержку C + +/ CX и WRL, но настоятельно рекомендуется, использовать новые приложения C + +/ WinRT. Дополнительные сведения см. в разделе [C + +/ WinRT](https://docs.microsoft.com/windows/uwp/cpp-and-winrt-apis/index).

## <a name="benefits"></a>Преимущества

Библиотека шаблонов C++ среды выполнения Windows позволяет более легко реализовать и использовать компоненты модели объектов компонента (COM). Он предоставляет такие методы обслуживания, таких как подсчет ссылок для управления временем существования объектов и тестирование значения HRESULT, чтобы определить, успешно ли выполнена операция. Чтобы успешно использовать библиотека шаблонов C++ среды выполнения Windows, вам необходимо тщательно следовать следующим правила и методам.

C + +/ CX является высокого уровня, на основе языка способ использования компонентов среды выполнения Windows. Библиотека шаблонов C++ среды выполнения Windows и C + +/ CX упростить написание кода для среды выполнения Windows путем автоматического выполнения задач обслуживания от вашего имени.

Библиотека шаблонов C++ среды выполнения Windows и C + +/ CX предоставляют различные преимущества. Ниже приведены некоторые причины, может потребоваться использовать библиотека шаблонов C++ среды выполнения Windows вместо C + +/ CX:

- Библиотека шаблонов C++ среды выполнения Windows добавляет небольшую абстракцию через Windows среды выполнения двоичным интерфейсом приложений (ABI), дает возможность управлять базовым кодом для повышения эффективности или использования API среды выполнения Windows.

- C + +/ CX представляет значения HRESULT в COM как исключения. Если вы наследуете базу кода, которая использует модель COM или использует исключения, может оказаться, что библиотека шаблонов C++ среды выполнения Windows является более естественным способом работы со средой выполнения Windows, так как нет необходимости использовать исключения.

   > [!NOTE]
   > Библиотека шаблонов C++ среды выполнения Windows использует значения HRESULT и не вызывает исключения. Кроме того библиотека шаблонов C++ среды выполнения Windows использует интеллектуальные указатели и шаблон RAII, которые позволяют гарантировать правильное уничтожение объектов когда код приложения вызывает исключение. Дополнительные сведения об интеллектуальных указателях и RAII см. в разделе [интеллектуальные указатели](../cpp/smart-pointers-modern-cpp.md) и [объектов собственные ресурсы объекта (RAII)](../cpp/objects-own-resources-raii.md).

- Назначение и структура библиотека шаблонов C++ среды выполнения Windows расширений по Active Template Library (ATL), который представляет собой набор основанных на шаблонах классов C++, которые упрощают программирование COM-объектов. Так как библиотека шаблонов C++ среды выполнения Windows использует стандартный язык C++ программы-оболочки для среды выполнения Windows, можно проще связываться и взаимодействовать с многих существующими COM-компонентами, написанными в библиотеке ATL для среды выполнения Windows. Если вы уже знаете, ATL, может оказаться, что библиотека шаблонов C++ среды выполнения Windows писать программы стало проще.

## <a name="getting-started"></a>Начало работы

Ниже приведены некоторые ресурсы, которые помогут вам начать работу с библиотека шаблонов C++ среды выполнения Windows, прямо сейчас.

[Библиотека среды выполнения Windows (WRL)](https://channel9.msdn.com/Events/Windows-Camp/Developing-Windows-8-Metro-style-apps-in-Cpp/The-Windows-Runtime-Library-WRL-)<br/>
В этом видео Channel 9 Дополнительные сведения о том, как библиотека шаблонов C++ среды выполнения Windows помогает написании приложений универсальной платформы Windows (UWP) и как создавать и использовать компоненты среды выполнения Windows.

[Практическое: активация и использование компонента среды выполнения Windows](../windows/how-to-activate-and-use-a-windows-runtime-component-using-wrl.md)<br/>
В этой статье демонстрируется использование библиотека шаблонов C++ среды выполнения Windows для инициализации среды выполнения Windows и активации и использования в компонент среды выполнения Windows.

[Практическое: завершение асинхронных операций](../windows/how-to-complete-asynchronous-operations-using-wrl.md)<br/>
В этой статье демонстрируется использование библиотека шаблонов C++ среды выполнения Windows для запуска асинхронных операций и выполнения работы при завершении операций.

[Практическое: обработка событий](../windows/how-to-handle-events-using-wrl.md)<br/>
В этой статье демонстрируется использование библиотека шаблонов C++ среды выполнения Windows, чтобы подписаться на и обрабатывать события объекта среды выполнения Windows.

[Пошаговое руководство. Создание приложения UWP с использованием WRL и Media Foundation](../windows/walkthrough-creating-a-windows-store-app-using-wrl-and-media-foundation.md)<br/>
Сведения о создании приложения UWP, которое использует [Microsoft Media Foundation](/windows/desktop/medfound/microsoft-media-foundation-sdk).

[Практическое: создание классического компонента COM](../windows/how-to-create-a-classic-com-component-using-wrl.md)<br/>
Показано, как использовать библиотека шаблонов C++ среды выполнения Windows для создания базового компонента COM и простой способ регистрации и использования COM-компонент из классического приложения.

[Практическое руководство. Непосредственное создание экземпляра компонентов WRL](../windows/how-to-instantiate-wrl-components-directly.md)<br/>
Сведения об использовании функций [Microsoft::WRL::Make](../windows/make-function.md) и [Microsoft::WRL::Details::MakeAndInitialize](../windows/makeandinitialize-function.md) для создания экземпляра компонента из определяющего его модуля.

[Практическое руководство. Использование winmdidl.exe и midlrt.exe для создания H-файлов из метаданных Windows](../windows/use-winmdidl-and-midlrt-to-create-h-files-from-windows-metadata.md)<br/>
Демонстрация использования пользовательских компонент среды выполнения Windows из WRL путем создания IDL-файла из метаданных WINMD.

[Пошаговое руководство. Подключение с использованием задач и HTTP-запросов XML](../parallel/concrt/walkthrough-connecting-using-tasks-and-xml-http-requests.md)<br/>
Демонстрируется использование [IXMLHTTPRequest2](/previous-versions/windows/desktop/api/msxml6/nn-msxml6-ixmlhttprequest2) и [IXMLHTTPRequest2Callback](/previous-versions/windows/desktop/api/msxml6/nn-msxml6-ixmlhttprequest2callback) интерфейсы вместе с задачами отправки запросов HTTP GET и POST для веб-службы в приложении UWP.

[Пример приложения Bing Maps Trip Optimizer](https://code.msdn.microsoft.com/Bing-Maps-trip-optimizer-c4e037f7)<br/>
Использует `HttpRequest` класс, который определен в [Пошаговое руководство: подключение с использованием задач и HTTP-запросов XML](../parallel/concrt/walkthrough-connecting-using-tasks-and-xml-http-requests.md) в контексте завершения приложения универсальной платформы Windows.

[Создание компонента DLL среды выполнения Windows с использованием примера C++](https://code.msdn.microsoft.com/windowsapps/Creating-a-Windows-Runtime-6c399797)<br/>
Показано, как использовать библиотека шаблонов C++ среды выполнения Windows для создания внутрипроцессного компонента библиотеки DLL и его использования в C + +/ CX, JavaScript и C#.

[Пример игры DirectX marble maze](https://code.msdn.microsoft.com/windowsapps/DirectX-Marble-Maze-Game-e4806345)<br/>
В этой статье демонстрируется использование библиотека шаблонов C++ среды выполнения Windows для управления временем жизни COM-компонентов, таких как DirectX и Media Foundation в контексте полностью созданной трехмерной игры.

[Отправка всплывающих уведомлений из примера классического приложения](https://code.msdn.microsoft.com/windowsdesktop/Sending-toast-notifications-71e230a2)<br/>
В этой статье демонстрируется использование библиотека шаблонов C++ среды выполнения Windows для работы с всплывающими уведомлениями из классического приложения.

## <a name="windows-runtime-c-template-library-compared-to-atl"></a>Библиотека шаблонов C++ среды выполнения Windows, по сравнению с ATL

Библиотека шаблонов C++ среды выполнения Windows напоминает Active Template Library (ATL), поскольку его можно использовать для создания небольших, быстрых COM-объектов. Библиотека шаблонов C++ среды выполнения Windows и ATL также общие понятия, например определение объектов в модулях, явная регистрация интерфейсов и открытое создание объектов с помощью фабрик. Возможно, вы привыкли использовать библиотека шаблонов C++ среды выполнения Windows, если вы знакомы с ATL.

Библиотека шаблонов C++ среды выполнения Windows поддерживает функциональные возможности модели COM, которая необходима для приложений универсальной платформы Windows. Поэтому она отличается от библиотеки ATL, поскольку в последней нет непосредственной поддержки таких функций модели COM, как:

- статистическая обработка

- стандартные реализации

- сдвоенные интерфейсы (`IDispatch`)

- стандартные интерфейсы перечислителя

- точки подключения

- перемещаемые интерфейсы

- внедрение OLE

- Элементы управления ActiveX

- COM+

## <a name="concepts"></a>Основные понятия

Библиотека шаблонов C++ среды выполнения Windows предоставляет типы, представляющие несколько основных понятий. Эти типы описаны в следующих разделах.

### <a name="comptr"></a>ComPtr

тип[ComPtr](../windows/comptr-class.md) — тип *интеллектуального указателя* , который представляет интерфейс, определяемый параметром шаблона. Тип `ComPtr` используется для объявления переменной, которая может получить доступ к членам объекта, производного от интерфейса. `ComPtr` автоматически поддерживает счетчик ссылок для указателя базового интерфейса и освобождает интерфейс, когда счетчик ссылок становится равен нулю.

### <a name="runtimeclass"></a>RuntimeClass

[RuntimeClass](../windows/runtimeclass-class.md) представляет собой экземпляр класса, который наследуется от набора указанных интерфейсов. Объект `RuntimeClass` объект может предоставлять сочетание поддерживает один или несколько интерфейсов COM среды выполнения Windows или слабую ссылку на компонент.

### <a name="module"></a>Module

[Module](../windows/module-class.md) представляет коллекцию связанных объектов. Объект `Module` управляет фабриками класса, создающими объекты, и регистрацией, которая позволяет другим приложениям использовать объект.

### <a name="callback"></a>Callback

Функция [Callback](../windows/callback-function-windows-runtime-cpp-template-library.md) создает объект, функция-член которого является обработчиком событий (метод обратного вызова). Функция `Callback` используется для записи асинхронных операций.

### <a name="eventsource"></a>EventSource

[EventSource](../windows/eventsource-class.md) используется для управления обработчиками событий *делегатов* . Использовать для реализации делегата и библиотека шаблонов C++ среды выполнения Windows `EventSource` для добавления, удаления и вызова делегатов.

### <a name="asyncbase"></a>AsyncBase

[AsyncBase](../windows/asyncbase-class.md) предоставляет виртуальные методы, которые представляют асинхронную модель программирования среды выполнения Windows. Переопределите члены этого класса для создания пользовательского класса, который может запускать и останавливать асинхронную операцию, а также проверять ход ее выполнения.

### <a name="ftmbase"></a>FtmBase

[FtmBase](../windows/ftmbase-class.md) представляет объект маршаллера в режиме свободного потока. `FtmBase` создает общую таблицу интерфейса (GIT) и помогает управлять маршалингом и прокси-объектами.

### <a name="weakref"></a>WeakRef

[WeakRef](../windows/weakref-class.md) — тип интеллектуального указателя, представляющий *слабую ссылку*на объект, который может быть доступен или недоступен. Объект `WeakRef` объект может использоваться только в среде выполнения Windows, а не классической модели COM.

Объект `WeakRef` обычно представляет объект, наличием которого управляет внешний поток или приложение. Например, объект `WeakRef` может ссылаться на объект файла. При открывании файла `WeakRef` является допустимым и файл, на который он ссылается, доступен. Однако после закрытия файла `WeakRef` перестает быть допустимым и файл становится недоступным.

## <a name="related-topics"></a>См. также

|||
|-|-|
|[Основные API по категориям](../windows/key-wrl-apis-by-category.md)|Выделяет основной типов, функций и макросов библиотека шаблонов C++ среды выполнения Windows.|
|[Ссылки](../windows/wrl-reference.md)|Содержит справочную информацию для библиотека шаблонов C++ среды выполнения Windows.|
|[Краткий справочник (среда выполнения Windows и Visual C++)](../cppcx/quick-reference-c-cx.md)|Кратко описывает C + +/ CX возможностей для поддержки среды выполнения Windows.|
|[Использование компонентов среды выполнения Windows в Visual C++](/windows/uwp/winrt-components/walkthrough-creating-a-basic-windows-runtime-component-in-cpp-and-calling-it-from-javascript-or-csharp)|Показано, как использовать C + +/ CX для создания базового компонента среды выполнения Windows.|
