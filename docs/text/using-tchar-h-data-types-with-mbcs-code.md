---
title: Использование типов данных TCHAR.H с кодом _MBCS
ms.date: 11/04/2016
helpviewer_keywords:
- mapping generic-text
- generic-text data types [C++]
- generic-text mappings [C++]
- MBCS [C++], generic-text mappings
- TCHAR.H data types, mapping
- mappings [C++], TCHAR.H
ms.assetid: 298583c5-22c3-40f6-920e-9ec96d42abd8
ms.openlocfilehash: 78e5d89e1e87d081e762fab1298eb990b914324c
ms.sourcegitcommit: 63784729604aaf526de21f6c6b62813882af930a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/17/2020
ms.locfileid: "79446591"
---
# <a name="using-tcharh-data-types-with-_mbcs-code"></a>Использование типов данных TCHAR.H с кодом _MBCS

Если определена константа манифеста `_MBCS`, данная универсальная текстовая подпрограммы сопоставляется с одним из следующих типов подпрограмм:

- Подпрограмма для однобайтовой кодировки, которая правильно обрабатывает многобайтовые символы и строки. В этом случае ожидается, что строковые аргументы будут иметь тип `char*`. Например, функция `_tprintf` сопоставляется с функцией `printf`; строковые аргументы функции `printf` имеют тип `char*`. При использовании универсального строкового типа данных `_TCHAR` типы формальных и фактических параметров функции `printf` совпадают, потому что `_TCHAR*` сопоставляется с `char*`.

- Подпрограмма, специально созданная для многобайтовой кодировки. В этом случае ожидается, что строковые аргументы будут иметь тип `unsigned char*`. Например, функция `_tcsrev`сопоставляется с функцией `_mbsrev`, которая ожидает и возвращает строку типа `unsigned char*`. Если для строковых типов используется тип данных `_TCHAR` Generic-Text, возможны конфликты типов, так как `_TCHAR` сопоставляется с типом `char`.

Есть три способа предотвратить такой конфликт типов (и избежать предупреждений компилятора C или ошибок компиляции C++).

- Использовать поведение по умолчанию. TCHAR. h предоставляет прототипы универсальных текстовых подпрограмм для подпрограмм в библиотеках времени выполнения, как показано в следующем примере.

    ```cpp
    char * _tcsrev(char *);
    ```

   В случае по умолчанию прототип для `_tcsrev` сопоставляется с `_mbsrev` с помощью преобразователя в libc. lib. Это изменяет типы `_mbsrev` входящих параметров и исходящего возвращаемого значения с `_TCHAR*` (то есть `char *`) на `unsigned char *`. Этот метод обеспечивает сопоставление типов при использовании `_TCHAR`, но это относительно медленный процесс, вызванный нагрузкой вызова функции.

- Использовать встраивание функций, включив в код следующую инструкцию препроцессора.

    ```cpp
    #define _USE_INLINING
    ```

   Этот метод вызывает преобразователь встроенных функций, указанный в файле Tchar. h, для непосредственного соответствия универсальной текстовой подпрограммы с соответствующей подпрограммы MBCS. В следующем фрагменте кода из TCHAR. h представлен пример того, как это делается.

    ```cpp
    __inline char *_tcsrev(char *_s1)
    {return (char *)_mbsrev((unsigned char *)_s1);}
    ```

   Это решение будет оптимальным, если используется встраивание, поскольку гарантирует соответствие типов и не замедляет работу.

- Используйте прямое сопоставление, включив в код следующую инструкцию препроцессора.

    ```cpp
    #define _MB_MAP_DIRECT
    ```

   Такой подход позволяет быстро решить проблему, если вы не хотите использовать поведение по умолчанию или не можете использовать встраивание. Это приводит к тому, что универсальная текстовая подсистема сопоставляется с помощью макроса непосредственно в многобайтовую версию подпрограммы, как показано в следующем примере из файла Tchar. h.

    ```cpp
    #define _tcschr _mbschr
    ```

   При использовании этого подхода необходимо соблюдать осторожность, чтобы обеспечить использование соответствующих типов данных для строковых аргументов и возвращаемых строковых значений. Можно воспользоваться явным приведением типов, чтобы гарантировать соответствие типов, либо универсальным строковым типом данных `_TXCHAR`. `_TXCHAR` сопоставляется с типом **char** в коде SBCS, но сопоставляется с типом **без знака** в коде MBCS. Дополнительные сведения о текстовых макросах см. в статье [универсальные текстовые сопоставления](../c-runtime-library/generic-text-mappings.md) в *справочнике по библиотеке времени выполнения*.

## <a name="see-also"></a>См. также раздел

[Универсальные текстовые сопоставления в файле tchar.h](../text/generic-text-mappings-in-tchar-h.md)
