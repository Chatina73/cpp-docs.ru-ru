---
title: Настройка проекта Linux на основе MSBuild C++ в Visual Studio
ms.date: 10/16/2020
description: Настройте в Visual Studio проект Linux на основе MSBuild, чтобы выполнить его сборку.
ms.assetid: 4d7c6adf-54b9-4b23-bd23-5de0c825b768
ms.openlocfilehash: 51837dc86d041b9120f984cc01f8db06d696b292
ms.sourcegitcommit: f19f02f217b80804ab321d463c76ce6f681abcc6
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/19/2020
ms.locfileid: "92176342"
---
# <a name="configure-a-linux-msbuild-c-project-in-visual-studio"></a>Настройка проекта Linux на основе MSBuild C++ в Visual Studio

::: moniker range="vs-2015"

Поддержка Linux реализована в Visual Studio версии 2017 и выше.

::: moniker-end

В этой статье показано, как настроить проект Linux на основе MSBuild, который описан в статье [Создание проекта Linux на основе MSBuild C++ в Visual Studio](create-a-new-linux-project.md). Сведения о проектах Linux CMake см. в разделе [Создание и настройка проекта Linux CMake](cmake-linux-project.md).

Вы можете настроить проект Linux для физического компьютера или виртуальной машины Linux, а также для [подсистемы Windows для Linux](/windows/wsl/about) (WSL).

::: moniker range="vs-2019"

**Visual Studio 2019 версии 16.1**

- Если в качестве целевой платформы используется WSL, можно избежать операций копирования, необходимых для сборки и получения компонентов IntelliSense для целевой удаленной системы Linux.

- Можно указать отдельные целевые объекты Linux для сборки и отладки.

::: moniker-end

## <a name="general-settings"></a>Общие параметры

Чтобы просмотреть параметры настройки, выберите **Проект > Свойства** или щелкните правой кнопкой мыши проект в **обозревателе решений** и выберите **Свойства** в контекстном меню. Появятся параметры **Общие** .

![Общая конфигурация](media/settings_general.png)

По умолчанию создается исполняемый файл (с расширением .out). Чтобы создать статическую или динамическую библиотеку либо использовать существующий файл Makefile, используйте параметр **Тип конфигурации** .

Если вы выполняете сборку для подсистемы Windows для Linux (WSL) версии 1, количество параллельных процессов компиляции будет ограничено 64. Это ограничение контролируется параметром **Максимальное количество параллельных заданий компиляции** в разделе **Свойства конфигурации > C/C++ > Общие** .

Независимо от версии WSL, если планируется использовать более 64 параллельных процессов компиляции, рекомендуется выполнять сборку с помощью Ninja, что в большинстве случаев будет быстрее и надежнее. Чтобы выполнить сборку с помощью Ninja, используйте параметр **Включить инкрементное построение** в разделе **Свойства конфигурации > Общие** .

См. подробнее о параметрах на страницах свойств в [справочнике по страницам свойств проекта Linux](prop-pages-linux.md).

## <a name="remote-settings"></a>Настройки удаленной системы

Изменить параметры для удаленного компьютера Linux можно в окне [Общие](prop-pages/general-linux.md).

- Чтобы указать целевой удаленный компьютер Linux, используйте запись **Компьютер удаленной сборки** . Это позволит выбрать одно из подключений, созданных ранее. Чтобы создать новую запись, см. раздел [Подключение к удаленному компьютеру Linux](connect-to-your-remote-linux-computer.md).

   ![Компьютер сборки](media/remote-build-machine-vs2019.png)

   ::: moniker range="vs-2019"

   **Visual Studio 2019 версии 16.7** . Чтобы выбрать подсистему Windows для Linux (WSL), задайте в раскрывающемся списке **Набор инструментов платформы** значение **GCC для подсистемы Windows для Linux** . Другие параметры удаленного взаимодействия исчезнут. Вместо них отобразится путь к оболочке WSL по умолчанию:

   ![Компьютер сборки WSL](media/wsl-remote-vs2019.png)

   Если у вас есть параллельные установки WSL, можно указать другой путь. См. подробнее об [управлении и настройке и администрировании подсистемы Windows для разных дистрибутивов Linux](/windows/wsl/wsl-config#set-a-default-distribution).

   Вы можете указать другой целевой объект для отладки на странице **Свойства конфигурации** > **Отладка** .

   ::: moniker-end

- Параметр **Корневой каталог удаленной сборки** определяет корневой каталог, где выполняется сборка проекта на удаленном компьютере Linux. По умолчанию это **~/projects** , пока не будет изменено.

- **Каталог проекта удаленной сборки**  — это место, где будет выполняться сборка этого конкретного проекта на удаленном компьютере Linux. По умолчанию это каталог **$(RemoteRootDir)/$(ProjectName)** , который будет развернут в каталог с именем текущего проекта в корневом каталоге, заданном выше.

> [!NOTE]
> Изменить компиляторы C и C++ или компоновщик и архиватор, которые используются для сборки проекта по умолчанию, можно в соответствующих записях в разделе **C/C++ > Общие** и разделе **Компоновщик > Общие** . Например, можно указать определенную версию GCC и Clang. Дополнительные сведения см. в статьях [Свойства C/C++ (Linux C++)](prop-pages/c-cpp-linux.md) и [Свойства компоновщика (Linux C++)](prop-pages/linker-linux.md).

## <a name="copy-sources-remote-systems-only"></a>Копирование источников (только для удаленных систем)

::: moniker range="vs-2019"

При использовании WSL этот раздел можно пропустить.

::: moniker-end

Во время сборки в удаленных системах исходные файлы на компьютере разработки копируются на компьютер Linux и компилируются там. По умолчанию все источники в проекте Visual Studio копируются в расположения, заданные в параметрах выше. Однако можно также добавить в список дополнительные источники или полностью отключить копирование источников, что используется по умолчанию для проекта Makefile.

- Параметр **Источники для копирования** определяет, какие источники копируются на удаленный компьютер. По умолчанию **\@(SourcesToCopyRemotely)** применяется ко всем файлам исходного кода в проекте, за исключением файлов ресурсов (например, изображений).

- **Копирование источников** можно включать и отключать, чтобы разрешать или запрещать копирование исходных файлов на удаленный компьютер.

- Параметр **Дополнительные источники для копирования** позволяет добавлять дополнительные исходные файлы, которые будут скопированы в удаленную систему. Вы можете задать список файлов, разделенных точкой с запятой, или использовать синтаксис **: =** , чтобы указать локальное и удаленное имя:

`C:\Projects\ConsoleApplication1\MyFile.cpp:=~/projects/ConsoleApplication1/ADifferentName.cpp;C:\Projects\ConsoleApplication1\MyFile2.cpp:=~/projects/ConsoleApplication1/ADifferentName2.cpp;`

## <a name="build-events"></a>События сборки

Так как вся компиляция происходит на удаленном компьютере (или в WSL), в раздел "События сборки" свойства проекта добавляются некоторые дополнительные события сборки. Это **удаленное событие перед сборкой** , **удаленное событие перед компоновкой** и **удаленное событие после сборки** , которые будут возникать на удаленном компьютере перед или после отдельных этапов процесса.

![События сборки](media/settings_buildevents.png)

## <a name="intellisense-for-headers-on-remote-systems"></a><a name="remote_intellisense"></a> IntelliSense для заголовков в удаленных системах

При добавлении нового подключения в **диспетчере подключений** Visual Studio автоматически обнаруживает каталоги включения (include) для компилятора на удаленной системе. Затем Visual Studio архивирует с помощью zip и копирует эти файлы в каталог на локальном компьютере Windows. После этого при каждом использовании данного соединения в проекте Visual Studio или CMake заголовки в этих каталогах используются для обеспечения поддержки технологии IntelliSense.

> [!NOTE]
> В Visual Studio 2019 версии 16.5 и более поздних удаленное копирование заголовков было оптимизировано. Заголовки теперь копируются по запросу при открытии проекта Linux или настройке CMake для целевого объекта Linux. Копирование выполняется в фоновом режиме для каждого проекта на основе указанных в проекте компиляторов. Дополнительные сведения см. в статье [Улучшения точности и производительности IntelliSense в Linux](https://devblogs.microsoft.com/cppblog/improvements-to-accuracy-and-performance-of-linux-intellisense/).

Для использования этой возможности необходимо, чтобы на компьютере Linux был установлен zip. Для установки zip можно использовать следующую команду пакетного менеджера apt-get:

```cmd
sudo apt install zip
```

Для управления кэшем заголовка перейдите в меню **Сервис > Параметры, кроссплатформенный > Диспетчер соединений > Диспетчер удаленных заголовков IntelliSense** . Для обновления кэша заголовка после внесения изменений на компьютере Linux выберите удаленное подключение и нажмите **Обновить** . Нажмите **Удалить** , чтобы удалить заголовки, не удаляя само подключение. Выберите **Проводник** , чтобы открыть локальный каталог, в **проводнике** . К этой папке необходимо относиться как к папке только для чтения. Чтобы скачать заголовки для существующего подключения, созданного в Visual Studio 2017 до версии 15.3, выберите подключение и щелкните **Скачать** .

::: moniker range="vs-2017"

![Снимок экрана: диалоговое окно "Параметры" с открытым разделом "Кроссплатформенные" > "Диспетчер подключений" > "Диспетчер удаленных заголовков IntelliSense"](media/remote-header-intellisense.png)

::: moniker-end

::: moniker range="vs-2019"

![Снимок экрана: диалоговое окно "Параметры" с открытым разделом "Кроссплатформенные" > "Диспетчер подключений"](media/connection-manager-vs2019.png)

Вы можете включить ведение журнала для устранения проблем:

![Удаленное ведение журнала](media/remote-logging-vs2019.png)

::: moniker-end

## <a name="linux-target-locale"></a><a name="locale"></a> Языковой стандарт целевого объекта Linux

Языковые параметры Visual Studio не распространяются на целевые объекты Linux, так как Visual Studio не управляет установленными пакетами и не настраивает их. Сообщения, отображаемые в окне **Вывод** , например ошибки сборки, отображаются с использованием языка и языкового стандарта целевого объекта Linux. Вам потребуется настроить целевые объекты Linux для требуемого языкового стандарта.

## <a name="see-also"></a>См. также

[Настройка компилятора и свойств сборки](../build/working-with-project-properties.md)<br/>
[Общие свойства C++ (Linux C++)](prop-pages/general-linux.md)<br/>
[Каталоги VC++ (Linux C++)](prop-pages/directories-linux.md)<br/>
[Свойства копирования источников проекта (Linux C++)](prop-pages/copy-sources-project.md)<br/>
[Свойства событий сборки (Linux C++)](prop-pages/build-events-linux.md)
