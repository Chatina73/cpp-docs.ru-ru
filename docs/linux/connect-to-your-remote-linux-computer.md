---
title: Подключение к целевой системе Linux из Visual Studio
description: Подключение к удаленному компьютеру Linux или подсистеме Windows для Linux из проекта C++ в Visual Studio.
ms.date: 01/8/2021
ms.openlocfilehash: 653a1832b4aac6b87c49102440181bb0e55a45a9
ms.sourcegitcommit: 3d9cfde85df33002e3b3d7f3509ff6a8dc4c0a21
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/21/2021
ms.locfileid: "98667592"
---
# <a name="connect-to-your-target-linux-system-in-visual-studio"></a>Подключение к целевой системе Linux из Visual Studio

::: moniker range="msvc-140"

Поддержка Linux реализована в Visual Studio версии 2017 и выше.

::: moniker-end

::: moniker range="msvc-150"

Вы можете настроить проект Linux для использования на удаленном компьютере или в подсистеме Windows для Linux (WSL). Для работы на удаленных компьютерах и в WSL необходимо настроить в Visual Studio 2017 удаленное подключение к ним.

::: moniker-end

::: moniker range="msvc-160"

Вы можете настроить проект Linux для использования на удаленном компьютере или в подсистеме Windows для Linux (WSL). Для работы на удаленном компьютере необходимо настроить в Visual Studio удаленное подключение к нему. Сведения о подключении к WSL см. в разделе [Подключение к WSL](#connect-to-wsl).

::: moniker-end

::: moniker range=">=msvc-150"

При использовании удаленного подключения Visual Studio создает проекты Linux C++ на удаленном компьютере. Неважно, является ли он физическим компьютером, виртуальной машиной в облаке или WSL.
Для сборки проекта Visual Studio копирует исходный код на удаленный компьютер Linux. Затем код компилируется в соответствии с параметрами Visual Studio.

::: moniker-end

::: moniker range="msvc-160"

> [!NOTE]
> Visual Studio 2019 версии 16.5 и более поздних версий также поддерживает безопасные совместимые с FIPS 140-2 криптографические подключения к системам Linux для удаленной разработки. Чтобы использовать FIPS-совместимое подключение, выполните действия, описанные в статье [Set up FIPS-compliant secure remote Linux development](set-up-fips-compliant-secure-remote-linux-development.md) (Настройка совместимой с FIPS безопасной удаленной разработки для Linux).

::: moniker-end

::: moniker range=">=msvc-150"

## <a name="set-up-the-ssh-server-on-the-remote-system"></a>Настройка сервера SSH в удаленной системе

Если сервер SSH еще не настроен и не запущен в вашей системе Linux, выполните следующие действия по его установке. В примерах в этой статье используется Ubuntu 18.04 LTS с сервером OpenSSH версии 7.6. Для всех дистрибутивов с относительно недавней версией OpenSSH следует придерживаться одинаковых инструкций.

1. В системе Linux установите и запустите сервер OpenSSH.

   ```bash
   sudo apt install openssh-server
   sudo service ssh start
   ```

1. Чтобы сервер SSH автоматически запускался при загрузке системы, выполните команду systemctl.

   ```bash
   sudo systemctl enable ssh
   ```

## <a name="set-up-the-remote-connection"></a>Настройка удаленного подключения

1. Чтобы в Visual Studio открыть диалоговое окно **Параметры**, в строке меню выберите **Сервис > Параметры**. Затем выберите **Кроссплатформенный > Диспетчер подключений**, чтобы открыть диалоговое окно диспетчера подключений.

   Если подключение в Visual Studio не было настроено ранее, это диалоговое окно откроется при первом создании проекта.

1. В диалоговом окне диспетчера подключений нажмите кнопку **Добавить**, чтобы добавить новое подключение.

   ![Диспетчер подключений](media/settings_connectionmanager.png)

   В любом сценарии отображается окно **Подключение к удаленной системе**.

   ![Подключение к удаленной системе](media/connect.png)

1. Введите следующую информацию.

   | Ввод | Описание
   | ----- | ---
   | **Имя узла**           | Имя или IP-адрес целевого устройства
   | **Порт**                | Порт, в котором работает служба SSH, обычно 22
   | **Имя пользователя**           | Пользователь для проверки подлинности
   | **Тип проверки подлинности** | Поддерживается и пароль, и закрытый ключ
   | **Пароль**            | Пароль для указанного имени пользователя
   | **Файл закрытого ключа**    | Закрытый ключ, созданный для подключения по SSH
   | **Парольная фраза**          | Парольная фраза, используемая с закрытым ключом, выбранным выше

   Вы можете использовать для проверки подлинности пароль или файл ключа с парольной фразой. Для многих сценариев разработки вполне достаточно проверки подлинности на основе пароля, но файлы ключей более надежны. Если у вас уже есть пара ключей, ее можно использовать повторно. Сейчас для удаленных подключений Visual Studio поддерживает только ключи RSA и DSA.

1. Нажмите кнопку **Подключить**, чтобы попытаться подключиться к удаленному компьютеру.

   Если соединение будет установлено успешно, Visual Studio настроит IntelliSense для использования удаленных заголовков. Подробнее см. раздел об [использовании IntelliSense для заголовков в удаленных системах](configure-a-linux-project.md#remote_intellisense).

   Если подключение установить не удастся, будут выделены красным цветом поля, информацию в которых нужно изменить.

   ![Ошибки диспетчера подключений](media/settings_connectionmanagererror.png)

   Если вы используете для аутентификации файлы ключей, убедитесь, что сервер SSH на целевом компьютере работает и настроен правильно.

   ::: moniker-end

   ::: moniker range="msvc-160"

## <a name="supported-ssh-algorithms"></a>Поддерживаемые алгоритмы SSH

Начиная с Visual Studio версии 16.9, была удалена поддержка старых и незащищенных алгоритмов SSH, используемых для шифрования данных и обмена ключами. Поддерживаются только следующие алгоритмы. Они поддерживают обмен данными как в направлении "клиент-сервер", так и в направлении "сервер-клиент" по протоколу SSH:

|Тип алгоритма|Поддерживаемые алгоритмы|
|---|---|
| Шифрование| aes128-cbc</br>aes128-cbc</br>aes192-cbc</br>aes192-ctr</br>aes256-cbc</br>aes256-ctr|
| Код проверки подлинности сообщений с помощью хэш-функций | hmac-sha2-256</br>hmac-sha2-256 |
| обмена ключами;| diffie-hellman-group14-sha256;</br>diffie-hellman-group16-sha512;</br>diffie-hellman-group-exchange-sha256;</br>ecdh-sha2-nistp256.</br>ecdh-sha2-nistp384</br>ecdh-sha2-nistp521|
|Ключ узла|ecdsa-sha2-nistp256</br>ecdsa-sha2-nistp384</br>ecdsa-sha2-nistp521</br>ssh-dss</br>ssh-rsa|

### <a name="configure-the-ssh-server"></a>Настройка сервера SSH

Сначала немного теории. Вам не удастся выбрать алгоритм SSH для использования в Visual Studio. Алгоритм определяется во время первоначального подтверждения с помощью сервера SSH. Каждая сторона (клиент и сервер) предоставляет список поддерживаемых алгоритмов, а затем выбирается первый алгоритм, общий для обоих. Если имеется хотя бы один алгоритм, общий для Visual Studio и сервера для шифрования, HMAC, обмена ключами и т. д., соединение будет работать.

Открытый файл конфигурации SSH (**sshd_config**) не определяет, какой алгоритм использовать по умолчанию. Если алгоритмы не указаны, сервер SSH должен использовать безопасные значения по умолчанию. Эти значения по умолчанию зависят от версии и поставщика сервера SSH.  Если Visual Studio не поддерживает эти значения по умолчанию или сервер SSH настроен на использование алгоритмов, которые не поддерживаются в Visual Studio, то, скорее всего, появится сообщение об ошибке следующего вида: **Не удалось подключиться к удаленной системе. Не найден алгоритм HMAC, общий для клиента и сервера.**

В большинстве современных дистрибутивов Linux сервер SSH, настроенный по умолчанию, должен работать в среде с Visual Studio. Ниже объясняется, как выполнить обновление до более безопасных версий, если вы используете более старый сервер SSH, который настроен на использование старых, незащищенных алгоритмов.

В следующем примере сервер SSH использует небезопасный алгоритм `hmac-sha1`, который не поддерживается в Visual Studio 16.9. Если сервер SSH использует OpenSSH, можно внести изменения в файл `/etc/ssh/sshd_config`, как показано ниже, чтобы включить более защищенные алгоритмы. Дополнительные сведения о настройке других серверов SSH см. в документации по серверу.

Во-первых, убедитесь, что набор алгоритмов, используемых сервером, включает алгоритмы, поддерживаемые Visual Studio. На удаленном компьютере выполните следующую команду, в которой будут перечислены алгоритмы, поддерживаемые сервером.

```bash
$ ssh -Q cipher; ssh -Q mac; ssh -Q kex; ssh -Q key
```

Результат будет выглядеть следующим образом.

```bash
3des-cbc
aes128-cbc
aes192-cbc
aes256-cbc
...
ecdsa-sha2-nistp521-cert-v01@openssh.com
sk-ecdsa-sha2-nistp256-cert-v01@openssh.com
```

Будут перечислены все алгоритмы шифрования, HMAC, обмена ключами и алгоритмы ключей узла, поддерживаемые сервером SSH. Если в этом списке не указаны алгоритмы, поддерживаемые Visual Studio, обновите сервер SSH, прежде чем продолжать работу.

Включить алгоритмы, поддерживаемые Visual Studio, можно путем изменения `/etc/ssh/sshd_config` на удаленном компьютере. В следующих примерах показано, как добавить различные типы алгоритмов в этот файл конфигурации.

Эти примеры можно добавить в любое место в `/etc/ssh/sshd_config` в отдельных строках.

После редактирования файла перезапустите сервер SSH (`sudo service ssh restart` в Ubuntu) и попробуйте снова подключиться из Visual Studio.

#### <a name="cipher--example"></a>Пример шифра

Добавьте: `Ciphers <algorithms to enable>`  
Пример: `Ciphers aes128-cbc,aes256-cbc`

#### <a name="hmac-example"></a>Пример HMAC

Добавьте: `MACs <algorithms to enable>`  
Пример: `MACs hmac-sha2-256,hmac-sha2-512`

#### <a name="key-exchange-example"></a>Пример обмена ключами

Добавьте: `KexAlgorithms <algorithms to enable>`  
Пример: `KexAlgorithms ecdh-sha2-nistp256,ecdh-sha2-nistp384`

#### <a name="host-key-example"></a>Пример ключа узла

Добавьте: `HostKeyAlgorithms <algorithms to enable>`  
Пример: `HostKeyAlgorithms ssh-dss,ssh-rsa`

## <a name="logging-for-remote-connections"></a>Ведение журнала для удаленных подключений

   Вы можете включить ведение журнала для устранения проблем с подключением. В строке меню выберите **Сервис > Параметры**. В диалоговом окне **Параметры** выберите **Кроссплатформенный > Ведение журнала**.

   ![Удаленное ведение журнала](media/remote-logging-vs2019.png)

   Журналы сохраняют все попытки подключения, все отправленные на удаленный компьютер команды (строка команды, код завершения и время выполнения), а также все данные, выводимые из Visual Studio в оболочку. Ведение журналов поддерживается в Visual Studio для любого кроссплатформенного проекта CMake или проекта Linux на основе MSBuild.

   Вы можете настроить вывод данных в файл или на панель **кроссплатформенного ведения журнала** в окне вывода. В проектах Linux на основе MSBuild команды MSBuild, передаваемые на удаленный компьютер, не отправляются в **окно вывода**, так как они порождаются вне основного процесса. Такие команды сохраняются в отдельный файл с префиксом "msbuild_".

## <a name="command-line-utility-for-the-connection-manager"></a>Служебная программа командной строки для диспетчера подключений  

**Visual Studio 2019 версии 16.5 или более поздней**: ConnectionManager.exe — это программа командной строки для управления подключениями удаленной разработки вне Visual Studio. Ее удобно использовать для выполнения таких задач, как подготовка нового компьютера разработчика. Кроме того, с ее помощью можно настроить Visual Studio для непрерывной интеграции. Примеры и полные справочные сведения по командам ConnectionManager см. в статье [Справка по ConnectionManager](connectionmanager-reference.md).  

::: moniker-end

::: moniker range=">=msvc-150"

## <a name="tcp-port-forwarding"></a>Перенаправление TCP-портов

Поддержка Linux в Visual Studio зависит от перенаправления TCP-портов. Если в удаленной системе отключено перенаправление TCP-портов, это повлияет на **rsync** и **gdbserver**. Если эта зависимость влияет на вас, вы можете оставить свое [предложение](https://developercommunity2.visualstudio.com/t/shDonshshtsh-shrelysh-s/840265?space=62) на сайте Сообщества разработчиков.

С помощью rsync в проектах Linux на основе MSBuild и проектах CMake можно [копировать заголовки, которые будут использоваться в IntelliSense, из удаленной системы в Windows](configure-a-linux-project.md#remote_intellisense). Если вы не можете включить перенаправление TCP-портов, отключите автоматическое скачивание удаленных заголовков. Для этого последовательно выберите **Сервис > Параметры > Кроссплатформенный > Диспетчер подключений > Диспетчер удаленных заголовков IntelliSense**. Если для удаленной системы не включено перенаправление TCP-портов, то при скачивании удаленных заголовков для IntelliSense будет отображаться приведенное ниже сообщение об ошибке.

![Ошибка, связанная с заголовками](media/port-forwarding-headers-error.png)

Кроме того, rsync используется при реализации поддержки CMake в Visual Studio для копирования исходных файлов в удаленную систему. Если вы не можете включить перенаправление TCP-портов, используйте SFTP в качестве метода копирования источников из удаленного расположения. SFTP обычно работает медленнее, чем rsync, но не зависит от перенаправления TCP-портов. Управлять методом копирования источников из удаленного расположения можно с помощью свойства **remoteCopySourcesMethod** в [редакторе параметров CMake](../build/cmakesettings-reference.md#additional-settings-for-cmake-linux-projects). Если в удаленной системе отключено перенаправление TCP-портов, то при первом вызове rsync в окне выходных данных CMake появится сообщение об ошибке.

![Ошибка, связанная с rsync](media/port-forwarding-copy-error.png)

С помощью gdbserver можно выполнять отладку на встроенных устройствах. Если вы не можете включить перенаправление TCP-портов, необходимо использовать gdb для всех сценариев удаленной отладки. gdb используется по умолчанию при отладке проектов в удаленной системе.

## <a name="connect-to-wsl"></a>Подключение к WSL

::: moniker-end

::: moniker range="msvc-150"

В Visual Studio 2017 подключение к WSL выполняется так же, как к удаленному компьютеру Linux. Укажите **localhost** в качестве **имени узла**.

::: moniker-end

::: moniker range="msvc-160"

В Visual Studio 2019 версии 16.1 добавлена собственная поддержка для использования C++ с [подсистемой Windows для Linux (WSL)](/windows/wsl/about). Это значит, что сборка и отладка локальной установки WSL выполняются напрямую. Больше не нужно добавлять удаленное подключение или настраивать SSH. Дополнительные сведения [об установке WSL](/windows/wsl/install-win10) можно найти здесь.

Чтобы настроить установку WSL для работы с Visual Studio, потребуется установить следующие средства: gcc or clang, gdb, make, ninja-build (требуется только для проектов CMake с использованием Visual Studio 2019 версии 16.6 и более поздней), rsync и zip. Их можно установить на дистрибутивах, использующих apt, с помощью этой команды, которая также устанавливает компилятор g++:

```bash
sudo apt install g++ gdb make ninja-build rsync zip
```

Ознакомьтесь с дополнительными сведениями о [скачивании, установке и настройке рабочей нагрузки для Linux](download-install-and-setup-the-linux-development-workload.md).

Сведения о настройке проекта MSBuild для WSL см. в статье [Настройка проекта Linux](configure-a-linux-project.md). Сведения о настройке проекта CMake для WSL см. в статье [Настройка проекта Linux CMake](cmake-linux-project.md). Пошаговые инструкции по созданию простого консольного приложения с помощью WSL приводятся в ознакомительной публикации блога о [C++ в Visual Studio 2019 и подсистеме Windows для Linux (WSL)](https://devblogs.microsoft.com/cppblog/c-with-visual-studio-2019-and-windows-subsystem-for-linux-wsl/).

::: moniker-end

## <a name="see-also"></a>См. также:

[Настройка проекта Linux](configure-a-linux-project.md)\
[Настройка проекта Linux CMake](cmake-linux-project.md)\
[Развертывание, запуск и отладка проекта Linux](deploy-run-and-debug-your-linux-project.md)\
[Настройка сеансов отладки CMake](../build/configure-cmake-debugging-sessions.md)
