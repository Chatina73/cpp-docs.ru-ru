---
title: Подключение к целевой системе Linux из Visual Studio
description: Подключение к удаленному компьютеру Linux или WSL из проекта C++ в Visual Studio.
ms.date: 09/04/2019
ms.assetid: 5eeaa683-4e63-4c46-99ef-2d5f294040d4
ms.openlocfilehash: 3d91faa7aa83c86e8c2f3544ee61c16f75f8c346
ms.sourcegitcommit: 0cfc43f90a6cc8b97b24c42efcf5fb9c18762a42
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/05/2019
ms.locfileid: "73626765"
---
# <a name="connect-to-your-target-linux-system-in-visual-studio"></a>Подключение к целевой системе Linux из Visual Studio

::: moniker range="vs-2015"

Поддержка Linux реализована в Visual Studio версии 2017 и выше.

::: moniker-end

::: moniker range=">=vs-2017"

Вы можете настроить проект Linux для использования на удаленном компьютере или в подсистеме Windows для Linux (WSL). Для работы на удаленных компьютерах и в WSL необходимо настроить в Visual Studio 2017 удаленное подключение к ним. 

## <a name="connect-to-a-remote-linux-computer"></a>Подключение к удаленному компьютеру Linux

При сборке проекта C++ для удаленной системы Linux (виртуальной машины или физического компьютера) исходный код Linux копируется на удаленный компьютер Linux, а затем компилируется в соответствии с параметрами Visual Studio.

Настройка удаленного подключения.

1. Постройте проект в первый раз или вручную создайте новую запись, выбрав в меню **> Параметры**, затем открыв узел **Кроссплатформенный > Диспетчер подключений** и нажав кнопку **Добавить**.

   ![Диспетчер подключений](media/settings_connectionmanager.png)

   В любом сценарии будет отображаться окно **Подключение к удаленной системе**.

   ![Подключение к удаленной системе](media/connect.png)

1. Введите следующую информацию.

   | Ввод | ОПИСАНИЕ
   | ----- | ---
   | **Имя узла**           | Имя или IP-адрес целевого устройства
   | **Порт**                | Порт, в котором работает служба SSH, обычно 22
   | **Имя пользователя**           | Пользователь для проверки подлинности
   | **Тип проверки подлинности** | Поддерживается и пароль, и закрытый ключ
   | **Пароль**            | Пароль для указанного имени пользователя
   | **Файл закрытого ключа**    | Закрытый ключ, созданный для подключения по SSH
   | **Парольная фраза**          | Парольная фраза, используемая с закрытым ключом, выбранным выше

   Вы можете использовать для аутентификации пароль или файл ключа с парольной фразой. Для многих сценариев разработки вполне достаточно проверки пароля. Если вы предпочитаете использовать файл с открытым или закрытым ключом, вы можете создать новый или [использовать уже существующий](https://security.stackexchange.com/questions/10203/reusing-private-public-keys) файл. Сейчас поддерживаются только ключи RSA и DSA. 
   
   Чтобы создать закрытый ключ RSA, сделайте следующее:

    1. На компьютере Windows создайте пару ключей SSH с помощью команды `ssh-keygen -t rsa`. Вы получите пару, состоящую из открытого и закрытого ключей. По умолчанию эти ключи размещаются в каталоге `C:\Users\%USERNAME%\.ssh` с именами `id_rsa.pub` и `id_rsa`.

    1. Скопируйте открытый ключ из Windows на компьютер Linux: `scp -p C:\Users\%USERNAME%\.ssh\id_rsa.pub user@hostname`.

    1. В системе Linux добавьте этот ключ в список авторизованных ключей (и убедитесь, что для файла установлены правильные разрешения): `cat ~/id_rsa.pub >> ~/.ssh/authorized_keys; chmod 600 ~/.ssh/authorized_keys`

1. Нажмите кнопку **Подключить**, чтобы попытаться подключиться к удаленному компьютеру. 

   Если соединение будет установлено успешно, Visual Studio начнет настраивать IntelliSense для использования удаленных заголовков. Подробнее см. раздел об [использовании IntelliSense для заголовков в удаленных системах](configure-a-linux-project.md#remote_intellisense).

   Если подключение установить не удастся, будут выделены красным цветом поля, информацию в которых нужно изменить.

   ![Ошибки диспетчера подключений](media/settings_connectionmanagererror.png)

   Если вы используете для аутентификации файлы ключей, убедитесь, что сервер SSH на целевом компьютере работает и настроен правильно.

   ::: moniker-end

   ::: moniker range="vs-2019"

   Откройте раздел **Сервис > Параметры > Кроссплатформенный > Ведение журнала**, чтобы включить ведение журнала для устранения проблем с подключением:

   ![Удаленное ведение журнала](media/remote-logging-vs2019.png)

   Журналы сохраняют все попытки подключения, все отправленные на удаленный компьютер команды (строка команды, код завершения и время выполнения), а также все данные, выводимые из Visual Studio в оболочку. Ведение журналов поддерживается в Visual Studio для любого кроссплатформенного проекта CMake или проекта Linux на основе MSBuild.

   Вы можете настроить вывод данных в файл или на панель **кроссплатформенного ведения журнала** в окне вывода. В проектах Linux на основе MSBuild команды, передаваемые из MSBuild на удаленный компьютер, не отправляются в **окно вывода**, так как они порождаются вне основного процесса. Такие команды сохраняются в отдельный файл с префиксом msbuild_.
   
## <a name="tcp-port-forwarding"></a>Перенаправление TCP-портов

Поддержка Linux в Visual Studio зависит от перенаправления TCP-портов. Если в удаленной системе отключено перенаправление TCP-портов, это повлияет на **rsync** и **gdbserver**. 

С помощью rsync в проектах Linux на основе MSBuild и проектах CMake можно [копировать заголовки, которые будут использоваться для IntelliSense, из удаленной системы в Windows](configure-a-linux-project.md#remote_intellisense). Если вы не можете включить перенаправление TCP-портов, можно отключить автоматическое скачивание удаленных заголовков, выбрав элементы "Средства" > "Параметры" > "Кроссплатформенные" > "Диспетчер подключений" > "Диспетчер удаленных заголовков IntelliSense". Если для удаленной системы, к которой вы пытаетесь подключиться, не включено перенаправление TCP-портов, то при скачивании удаленных заголовков для IntelliSense будет отображаться приведенное ниже сообщение об ошибке.

![Ошибка, связанная с заголовками](media/port-forwarding-headers-error.png)

Кроме того, rsync используется при реализации поддержки CMake в Visual Studio для копирования исходных файлов в удаленную систему. Если вы не можете включить перенаправление TCP-портов, используйте SFTP в качестве метода копирования источников из удаленного расположения. SFTP обычно работает медленнее, чем rsync, но не зависит от перенаправления TCP-портов. Управлять методом копирования источников из удаленного расположения можно с помощью свойства remoteCopySourcesMethod в [редакторе параметров CMake](../build/cmakesettings-reference.md#additional-settings-for-cmake-linux-projects). Если в удаленной системе отключено перенаправление TCP-портов, то при первом вызове rsync в окне выходных данных CMake появится сообщение об ошибке.

![Ошибка, связанная с rsync](media/port-forwarding-copy-error.png)

С помощью Gdbserver можно выполнять отладку на встроенных устройствах. Если вы не можете включить перенаправление TCP-портов, вам потребуется использовать gdb для всех сценариев удаленной отладки. Gdb по умолчанию используется при отладке проектов в удаленной системе. 

   ::: moniker-end

## <a name="connect-to-wsl"></a>Подключение к WSL

::: moniker range="vs-2017"

В Visual Studio 2017 подключение к WSL выполняется так же, как и к удаленному компьютеру Linux, как описано ранее в этой статье. Укажите **localhost** в качестве **имени узла**.

::: moniker-end

::: moniker range="vs-2019"

В Visual Studio 2019 версии 16.1 добавлена собственная поддержка для использования C++ с [подсистемой Windows для Linux (WSL)](https://docs.microsoft.com/windows/wsl/about).  Это значит, что для сборки и отладки локальной установки WSL больше не нужно добавлять удаленное подключение или настраивать SSH. Дополнительные сведения [об установке WSL](https://docs.microsoft.com/windows/wsl/install-win10) можно найти здесь.

Чтобы настроить установку WSL для работы с Visual Studio, потребуется установить следующие средства: gcc или clang, gdb, make, rsync и zip. Их можно установить на дистрибутивах, использующих apt, с помощью этой команды, которая также устанавливает компилятор g++: 

```bash
sudo apt install g++ gdb make rsync zip
```
Ознакомьтесь с дополнительными сведениями о [скачивании, установке и настройке рабочей нагрузки для Linux](download-install-and-setup-the-linux-development-workload.md).

Чтобы настроить проект для WSL, воспользуйтесь разделами [о настройке проекта Linux](configure-a-linux-project.md) или [проекта Linux CMake](cmake-linux-project.md) в зависимости от того, какой тип проекта вы используете. Пошаговые инструкции по созданию простого консольного приложения с помощью WSL приводятся в ознакомительной публикации блога о [C++ в Visual Studio 2019 и подсистеме Windows для Linux (WSL)](https://devblogs.microsoft.com/cppblog/c-with-visual-studio-2019-and-windows-subsystem-for-linux-wsl/).

::: moniker-end

## <a name="see-also"></a>См. также

[Настройка проекта Linux](configure-a-linux-project.md)<br />
[Настройка проекта Linux CMake](cmake-linux-project.md)<br />
[Развертывание, запуск и отладка проекта Linux](deploy-run-and-debug-your-linux-project.md)<br />
[Настройка сеансов отладки CMake](../build/configure-cmake-debugging-sessions.md)
