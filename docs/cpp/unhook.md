---
title: __unhook
description: Узнайте, как использовать ключевое слово расширения Microsoft C++ `__unhook` для обработки собственных событий.
ms.date: 11/04/2016
f1_keywords:
- __unhook
- __unhook_cpp
helpviewer_keywords:
- event handlers [C++], dissociating events
- __unhook keyword [C++]
ms.openlocfilehash: 74f8b814ea23c5513b7b73bf90ef59984742a266
ms.sourcegitcommit: b02c61667ff7f38e7add266d0aabd8463f2dbfa1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/23/2020
ms.locfileid: "95483325"
---
# <a name="__unhook-keyword"></a>`__unhook` This

Отменяет связь метода обработчика с событием.

> [!NOTE]
> Атрибуты событий в машинном коде C++ несовместимы со стандартным C++. Они не компилируются при указании [`/permissive-`](../build/reference/permissive-standards-conformance.md) режима соответствия.

## <a name="syntax"></a>Синтаксис

```cpp
long  __unhook(
   &SourceClass::EventMethod,
   source,
   &ReceiverClass::HandlerMethod
   [, receiver = this]
);

long  __unhook(
   interface,
   source
);

long  __unhook(
   source
);
```

### <a name="parameters"></a>Параметры

*`&SourceClass::EventMethod`*\
Указатель на метод события, с помощью которого отсоединяется метод обработчика событий.

- Собственные события C++: *`SourceClass`* является классом источника событий и *`EventMethod`* является событием.

- COM-события — *`SourceClass`* это интерфейс источника событий, который *`EventMethod`* является одним из методов.

- Управляемые события: *`SourceClass`* — это класс источника событий, а *`EventMethod`* — событие.

*`interface`*\
Имя интерфейса, которое отсоединяется от *получателя*, только для приемников событий COM, в которых параметром *layout_dependent* [`event_receiver`](../windows/attributes/event-receiver.md) атрибута является **`true`** .

*`source`*\
Указатель на экземпляр источника события. В зависимости от кода `type` , указанного в `event_receiver` , *источником* может быть один из следующих типов:

- Собственный указатель на объект источника события.

- `IUnknown`Указатель на основе объекта (com-источник).

- Указатель на управляемый объект (для управляемых событий).

*`&ReceiverClass::HandlerMethod`* Указатель на метод обработчика событий, который необходимо отсоединить от события. Обработчик указывается как метод класса или ссылки на один и тот же объект. Если не указать имя класса, **`__unhook`** предполагается, что класс будет называться.

- Собственные события C++: *`ReceiverClass`* — это класс приемника событий и `HandlerMethod` обработчик.

- COM-события — *`ReceiverClass`* это интерфейс приемника событий, который *`HandlerMethod`* является одним из его обработчиков.

- Управляемые события: *`ReceiverClass`* — это класс приемника событий, а *`HandlerMethod`* — обработчик.

*`receiver`* используемых Указатель на экземпляр класса приемника событий. Если получатель не указан, по умолчанию используется класс получателя или структура, в которой **`__unhook`** вызывается.

## <a name="usage"></a>Использование

Может использоваться в любой области видимости функции, включая `main` , за пределами класса приемника событий.

## <a name="remarks"></a>Комментарии

Используйте встроенную функцию **`__unhook`** в приемнике событий, чтобы разорвать связь или отсоединить метод обработчика от метода события.

Существует три формы **`__unhook`** . В большинстве случаев можно использовать первую форму (четыре аргумента). Вторую форму (с двумя аргументами) можно использовать **`__unhook`** только для приемника событий COM; она отсоединяет весь интерфейс событий. Третья форма (один аргумент) используется для отсоединения всех делегатов от указанного источника.

Ненулевое возвращаемое значение указывает на наличие ошибки (управляемые события создадут исключение).

При вызове **`__unhook`** для события и обработчика событий, которые еще не подключены, они не будут действовать.

Во время компиляции компилятор проверяет, что событие существует, и выполняет проверку типа параметра с указанным обработчиком.

Можно вызывать **`__hook`** и **`__unhook`** за пределами приемника событий, за исключением событий COM.

Альтернативой использованию **`__unhook`** является использование оператора-=.

Дополнительные сведения о кодировании управляемых событий в новом синтаксисе см. в разделе [event](../extensions/event-cpp-component-extensions.md).

> [!NOTE]
> Класс-шаблон или структура не могут содержать события.

## <a name="example"></a>Пример

Примеры см. [в разделе Обработка событий в машинном коде C++](../cpp/event-handling-in-native-cpp.md) и [Обработка событий в com](../cpp/event-handling-in-com.md) .

## <a name="see-also"></a>См. также

[Словами](../cpp/keywords-cpp.md)\
[`event_source`](../windows/attributes/event-source.md)\
[`event_receiver`](../windows/attributes/event-receiver.md)\
[`__event`](../cpp/event.md)\
[`__hook`](../cpp/hook.md)\
[`__raise`](../cpp/raise.md)
