---
title: __hook
description: Узнайте, как использовать ключевое слово расширения Microsoft C++ `__hook` для обработки собственных событий.
ms.date: 11/20/2020
f1_keywords:
- __hook_cpp
- __hook
helpviewer_keywords:
- __hook keyword [C++]
- event handlers [C++], connecting events to
ms.openlocfilehash: 2a2bde221c53f0e1d420e2ab3a88eb299f6c284c
ms.sourcegitcommit: b02c61667ff7f38e7add266d0aabd8463f2dbfa1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/23/2020
ms.locfileid: "95483260"
---
# <a name="__hook-keyword"></a>`__hook` This

Связывает метод обработчика с событием.

> [!NOTE]
> Атрибуты событий в машинном коде C++ несовместимы со стандартным C++. Они не компилируются при указании [`/permissive-`](../build/reference/permissive-standards-conformance.md) режима соответствия.

## <a name="syntax"></a>Синтаксис

```cpp
long __hook(
    &SourceClass::EventMethod,
    source,
    &ReceiverClass::HandlerMethod
    [, receiver = this]
);

long __hook(
    interface,
    source
);
```

### <a name="parameters"></a>Параметры

*`&SourceClass::EventMethod`*\
Указатель на метод события, к которому присоединяется метод обработчика событий.

- Собственные события C++: *`SourceClass`* является классом источника событий и *`EventMethod`* является событием.

- COM-события — *`SourceClass`* это интерфейс источника событий, который *`EventMethod`* является одним из методов.

- Управляемые события: *`SourceClass`* — это класс источника событий, а *`EventMethod`* — событие.

*`interface`*\
Имя интерфейса, к которому выполняется подключение *`receiver`* , только для приемников событий COM, в которых *`layout_dependent`* параметр [`event_receiver`](../windows/attributes/event-receiver.md) атрибута имеет значение **`true`** .

*`source`*\
Указатель на экземпляр источника события. В зависимости от кода `type` , указанного в `event_receiver` , *`source`* может иметь один из следующих типов:

- Собственный указатель на объект источника события.

- `IUnknown`Указатель на основе объекта (com-источник).

- Указатель на управляемый объект (для управляемых событий).

*`&ReceiverClass::HandlerMethod`*\
Указатель на метод обработчика событий, который необходимо присоединить к событию. Обработчик указывается как метод класса или ссылки на тот же объект. Если не указать имя класса, **`__hook`** предполагается, что класс является тем, из которого он вызывается.

- Собственные события C++: *`ReceiverClass`* — это класс приемника событий и `HandlerMethod` обработчик.

- COM-события — *`ReceiverClass`* это интерфейс приемника событий, который *`HandlerMethod`* является одним из его обработчиков.

- Управляемые события: *`ReceiverClass`* — это класс приемника событий, а *`HandlerMethod`* — обработчик.

*`receiver`*\
Используемых Указатель на экземпляр класса приемника событий. Если получатель не указан, по умолчанию используется класс получателя или структура, в которой **`__hook`** вызывается.

## <a name="usage"></a>Использование

Можно использовать в любой области видимости функции, включая функцию main, вне класса приемника событий.

## <a name="remarks"></a>Комментарии

Используйте встроенную функцию **`__hook`** в приемнике событий, чтобы связать метод обработчика или привязать его к методу события. Затем, когда этот источник вызывает указанное событие, вызывается указанный обработчик. Можно подключить несколько обработчиков к одному событию или несколько событий к одному обработчику.

Существует две формы **`__hook`** . В большинстве случаев можно использовать первую форму (с четырьмя аргументами), в частности, для приемников событий COM, в которых параметром *layout_dependent* [`event_receiver`](../windows/attributes/event-receiver.md) атрибута является **`false`** .

В таких случаях не нужно подключать все методы в интерфейсе перед срабатыванием события в одном из методов. Необходимо только подключить метод, обрабатывающий событие. Вторую форму (с двумя аргументами) можно использовать **`__hook`** только для приемника событий COM, в котором *`layout_dependent`* **`= true`** .

**`__hook`** Возвращает значение типа long. Ненулевое возвращаемое значение указывает на наличие ошибки (управляемые события создают исключение).

Компилятор проверяет наличие события и соответствие сигнатур события и делегата.

Можно вызывать **`__hook`** и **`__unhook`** за пределами приемника событий, за исключением событий COM.

Альтернативой использованию **`__hook`** является использование оператора + =.

Дополнительные сведения о кодировании управляемых событий в новом синтаксисе см [`event`](../extensions/event-cpp-component-extensions.md) . в разделе.

> [!NOTE]
> Класс-шаблон или структура не могут содержать события.

## <a name="example"></a>Пример

Примеры см. [в разделе Обработка событий в машинном коде C++](../cpp/event-handling-in-native-cpp.md) и [Обработка событий в com](../cpp/event-handling-in-com.md) .

## <a name="see-also"></a>См. также

[Словами](../cpp/keywords-cpp.md)\
[Обработка событий](../cpp/event-handling.md)\
[`event_source`](../windows/attributes/event-source.md)\
[`event_receiver`](../windows/attributes/event-receiver.md)\
[`__event`](../cpp/event.md)\
[`__unhook`](../cpp/unhook.md)\
[`__raise`](../cpp/raise.md)
