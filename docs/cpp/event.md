---
title: __event
ms.date: 11/04/2016
f1_keywords:
- __event_cpp
- __event
helpviewer_keywords:
- __event keyword [C++]
- events [C++], __event
ms.assetid: d3019b3e-722e-48df-8536-c05878461f9e
ms.openlocfilehash: 3a837e30d3cd66f7caa9b44971f432e00b0917ae
ms.sourcegitcommit: 0ab61bc3d2b6cfbd52a16c6ab2b97a8ea1864f12
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "62154429"
---
# <a name="event"></a>__event

Объявление события.

## <a name="syntax"></a>Синтаксис

```
__event method-declarator;
__event __interface interface-specifier;
__event member-declarator;
```

## <a name="remarks"></a>Примечания

Ключевое слово **__event** могут применяться к объявление метода, является объявлением интерфейса или объявление члена данных. Тем не менее, нельзя использовать **__event** ключевое слово для уточнения члена вложенного класса.

В зависимости от того, являются ли источник и получатель события неуправляемыми объектами C++, объектами COM или управляемыми объектами (в .NET Framework), в качестве событий можно использовать следующие конструкции:

|Неуправляемый C++|COM|Управляемый (.NET Framework)|
|------------------|---------|--------------------------------|
|Метод|—|метод|
|—|интерфейс|—|
|—|—|данные-член|

Используйте [__hook](../cpp/hook.md) в приемнике событий можно связать метод обработчика с методом события. Обратите внимание, что после создания события с помощью **__event** ключевое слово, все обработчики событий, которые впоследствии на удочку на это событие будет вызываться при вызове события.

**__Event** объявление метода не может иметь определения; определение создается неявно, поэтому метод события может вызываться, как если бы он был обычным методом.

> [!NOTE]
>  Класс-шаблон или структура не могут содержать события.

## <a name="native-events"></a>Собственные события

Собственные события являются методами. Тип возвращаемого значения обычно является HRESULT или **void**, но может быть любой целочисленный тип, включая **перечисления**. Если событие использует целочисленный тип возвращаемого значения, условие ошибки определяется как возврат обработчиком события ненулевого значения — в этом случае возникшее событие вызывает другие делегаты.

```cpp
// Examples of native C++ events:
__event void OnDblClick();
__event HRESULT OnClick(int* b, char* s);
```

См. в разделе [обработка событий в неуправляемом коде C++](../cpp/event-handling-in-native-cpp.md) пример кода.

## <a name="com-events"></a>События COM

События COM являются интерфейсами. Параметры метода в интерфейсе источника событий должны быть *в* параметров (но это не применяется принудительно тщательно), так как *out* параметр не может использоваться при многоадресной рассылки. Будет выдаваться предупреждение уровня 1, если вы используете *out* параметра.

Тип возвращаемого значения обычно является HRESULT или **void**, но может быть любой целочисленный тип, включая **перечисления**. Если событие использует целочисленный тип возвращаемого значения и обработчик события возвращает ненулевое значение, это состояние ошибки, в котором возникшее событие прерывает вызовы других делегатов. Обратите внимание, что компилятор автоматически помечает интерфейс источника события как [источника](../windows/attributes/source-cpp.md) в созданном IDL.

[__Interface](../cpp/interface.md) ключевое слово всегда является обязательным после **__event** для источника событий модели COM.

```cpp
// Example of a COM event:
__event __interface IEvent1;
```

См. в разделе [обработка событий в COM](../cpp/event-handling-in-com.md) пример кода.

## <a name="managed-events"></a>Управляемые события

Дополнительные сведения о кодировании событий в новом синтаксисе см. в разделе [событий](../extensions/event-cpp-component-extensions.md).

Управляемые события являются данными-членами или методами. При использовании с событием тип возвращаемого значения делегата должны соответствовать [спецификация CLS](/dotnet/standard/language-independence-and-language-independent-components). Возвращаемый тип обработчика события должен соответствовать возвращаемому типу делегата. Дополнительные сведения о делегатах см. в разделе [делегаты и события](../dotnet/delegates-and-events.md). Если управляемое событие является данными-членом, его тип должен быть указателем на делегат.

В платформе .NET Framework данные-член можно рассматривать, как если бы это был сам метод (т. е., метод `Invoke` соответствующего делегата). Необходимо заранее определить тип делегата для объявления данных-члена управляемого события. Напротив, метод управляемого события неявно определяет соответствующий управляемый делегат, если он еще не определен. Например, значение события, такое как `OnClick`, можно объявить как событие следующим образом:

```cpp
// Examples of managed events:
__event ClickEventHandler* OnClick;  // data member as event
__event void OnClick(String* s);  // method as event
```

При неявном объявлении управляемого события можно указать методы доступа добавления и удаления, которые будут вызываться в случае добавления или удаления обработчиков события. Можно также определить метод, который вызывает событие вне класса.

## <a name="example-native-events"></a>Пример Собственные события

```cpp
// EventHandling_Native_Event.cpp
// compile with: /c
[event_source(native)]
class CSource {
public:
   __event void MyEvent(int nValue);
};
```

## <a name="example-com-events"></a>Пример События COM

```cpp
// EventHandling_COM_Event.cpp
// compile with: /c
#define _ATL_ATTRIBUTES 1
#include <atlbase.h>
#include <atlcom.h>

[ module(dll, name="EventSource", uuid="6E46B59E-89C3-4c15-A6D8-B8A1CEC98830") ];

[ dual, uuid("00000000-0000-0000-0000-000000000002") ]
__interface IEventSource {
   [id(1)] HRESULT MyEvent();
};
[ coclass, uuid("00000000-0000-0000-0000-000000000003"),  event_source(com) ]
class CSource : public IEventSource {
public:
   __event __interface IEventSource;
   HRESULT FireEvent() {
      __raise MyEvent();
      return S_OK;
   }
};
```

## <a name="see-also"></a>См. также

[Ключевые слова](../cpp/keywords-cpp.md)<br/>
[Обработка событий](../cpp/event-handling.md)<br/>
[event_source](../windows/attributes/event-source.md)<br/>
[event_receiver](../windows/attributes/event-receiver.md)<br/>
[__hook](../cpp/hook.md)<br/>
[__unhook](../cpp/unhook.md)<br/>
[__raise](../cpp/raise.md)