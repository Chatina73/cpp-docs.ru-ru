---
description: 'Дополнительные сведения о: поддержка IDispEventImpl'
title: Поддержка IDispEventImpl
ms.date: 11/04/2016
helpviewer_keywords:
- event sink maps, declaring
- IDispEventImpl class, advising and unadvising
- SINK_ENTRY macro
- type libraries, importing
- ATL, IDispEventImpl support in COM objects
- BEGIN_SINK_MAP macro
- IDispEventImpl class, declaring
ms.assetid: b957f930-6a5b-4598-8e4d-8027759957e7
ms.openlocfilehash: 6a5c12e011ad0dc0f27594325a22dadddd5b92c0
ms.sourcegitcommit: d6af41e42699628c3e2e6063ec7b03931a49a098
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2020
ms.locfileid: "97157377"
---
# <a name="supporting-idispeventimpl"></a>Поддержка IDispEventImpl

Класс шаблона [IDispEventImpl](../atl/reference/idispeventimpl-class.md) можно использовать для обеспечения поддержки приемников точек соединения в классе ATL. Приемник точки подключения позволяет классу управлять событиями, возникающими во внешних COM-объектах. Эти приемники точек подключения сопоставляются с картой приемника событий, предоставленной вашим классом.

Чтобы правильно реализовать приемник точки подключения для класса, необходимо выполнить следующие действия.

- Импорт библиотек типов для каждого внешнего объекта

- Объявление `IDispEventImpl` интерфейсов

- Объявить карту приемника событий

- Посоветовать и отменять точки подключения

Действия, связанные с реализацией приемника точки подключения, выполняются путем изменения только файла заголовка (. h) класса.

## <a name="importing-the-type-libraries"></a>Импорт библиотек типов

Для каждого внешнего объекта, события которого требуется обработаны, необходимо импортировать библиотеку типов. Этот шаг определяет события, которые могут быть обработаны, и предоставляет сведения, используемые при объявлении схемы приемника событий. Для этого можно использовать директиву [#import](../preprocessor/hash-import-directive-cpp.md) . Добавьте необходимые `#import` строки директивы для каждого интерфейса диспетчеризации, который будет поддерживаться в файле заголовка (. h) класса.

В следующем примере импортируется библиотека типов внешнего COM-сервера ( `MSCAL.Calendar.7` ):

[!code-cpp[NVC_ATL_Windowing#141](../atl/codesnippet/cpp/supporting-idispeventimpl_1.h)]

> [!NOTE]
> Необходимо иметь отдельную `#import` инструкцию для каждой внешней библиотеки типов, которую вы будете поддерживать.

## <a name="declaring-the-idispeventimpl-interfaces"></a>Объявление интерфейсов IDispEventImpl

Теперь, когда вы импортировали библиотеки типов для каждого интерфейса диспетчеризации, необходимо объявить отдельные `IDispEventImpl` интерфейсы для каждого внешнего интерфейса диспетчеризации. Измените объявление класса, добавив `IDispEventImpl` объявление интерфейса для каждого внешнего объекта. Дополнительные сведения о параметрах см. в разделе [IDispEventImpl](../atl/reference/idispeventimpl-class.md).

Следующий код объявляет два приемника точек подключения для `DCalendarEvents` интерфейса для COM-объекта, реализуемого классом `CMyCompositCtrl2` :

[!code-cpp[NVC_ATL_Windowing#142](../atl/codesnippet/cpp/supporting-idispeventimpl_2.h)]

## <a name="declaring-an-event-sink-map"></a>Объявление схемы приемника событий

Чтобы уведомления о событиях обрабатывались правильной функцией, класс должен направить каждое событие в соответствующий обработчик. Это достигается путем объявления схемы приемника событий.

ATL предоставляет несколько макросов, [BEGIN_SINK_MAP](reference/composite-control-macros.md#begin_sink_map), [END_SINK_MAP](reference/composite-control-macros.md#end_sink_map)и [SINK_ENTRY_EX](reference/composite-control-macros.md#sink_entry_ex), которые упрощают это сопоставление. Стандартный формат выглядит следующим образом:

```cpp
BEGIN_SINK_MAP(comClass)
  SINK_ENTRY_EX(id, iid, dispid, func)
  . . . //additional external event entries
END_SINK_MAP()
```

В следующем примере объявляется схема приемника событий с двумя обработчиками событий:

[!code-cpp[NVC_ATL_Windowing#136](../atl/codesnippet/cpp/supporting-idispeventimpl_3.h)]

Реализация почти завершена. Последний шаг относится к рекомендуемым и нерекомендуемым внешним интерфейсам.

## <a name="advising-and-unadvising-the-idispeventimpl-interfaces"></a>Рекомендуется и не рекомендуется для интерфейсов IDispEventImpl

Последним шагом является реализация метода, который будет вырекомендовать (или отменять) все точки подключения в нужное время. Это необходимо сделать перед обменом данными между внешними клиентами и объектом. Перед тем как объект станет видимым, каждый внешний интерфейс диспетчеризации, поддерживаемый объектом, запрашивается для исходящих интерфейсов. Соединение установлено, и для управления событиями из объекта используется ссылка на исходящий интерфейс. Эта процедура называется «рекомендуется».

После завершения работы объекта с внешними интерфейсами исходящие интерфейсы должны быть уведомлены о том, что они больше не используются вашим классом. Этот процесс называется «не рекомендуется».

Из-за уникального характера объектов COM эта процедура может различаться в зависимости от реализации. Эти сведения выходят за рамки данного раздела и не решаются.

## <a name="see-also"></a>См. также раздел

[Основы COM-объектов ATL](../atl/fundamentals-of-atl-com-objects.md)
