---
title: Общие сведения о классе коллекции ATL
ms.date: 11/19/2018
helpviewer_keywords:
- DestructElements function
- collection classes, choosing
- ConstructElements function
- SerializeElements function
- traits classes
- collection classes, about collection classes
- CTraits classes
- collection classes
ms.assetid: 4d619d46-5b4e-41dd-b9fd-e86b1fbc00b5
ms.openlocfilehash: 039af388a3713540c6ba7d39e8b639cf83d291ff
ms.sourcegitcommit: 6280a4c629de0f638ebc2edd446de2a9b11f0406
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/12/2020
ms.locfileid: "90040864"
---
# <a name="atl-collection-classes"></a>Классы коллекций ATL

ATL предоставляет множество классов для хранения данных и доступа к ним. Выбор класса зависит от нескольких факторов, в том числе:

- Объем сохраняемых данных

- Эффективность и производительность при доступе к данным

- Возможность доступа к данным по индексу или по ключу

- Порядок упорядочения данных

- Личная настройка

## <a name="small-collection-classes"></a>Классы небольших коллекций

Библиотека ATL предоставляет следующие классы массивов для работы с небольшим количеством объектов. Однако эти классы ограничены и предназначены для внутреннего использования в библиотеке ATL. Не рекомендуется использовать их в программах.

|Class|Тип хранилища данных|
|-----------|--------------------------|
|[ксимплеаррай](../atl/reference/csimplearray-class.md)|Реализует класс массива для работы с небольшим количеством объектов.|
|[ксимплемап](../atl/reference/csimplemap-class.md)|Реализует класс сопоставления для работы с небольшим количеством объектов.|

## <a name="general-purpose-collection-classes"></a>Классы коллекций общего назначения

Следующие классы реализуют массивы, списки и карты и предоставляются в качестве классов коллекций общего назначения:

|Class|Тип хранилища данных|
|-----------|--------------------------|
|[CAtlArray](../atl/reference/catlarray-class.md)|Реализует массив.|
|[катллист](../atl/reference/catllist-class.md)|Реализует список.|
|[CAtlMap](../atl/reference/catlmap-class.md)|Реализует структуру сопоставления, с помощью которой можно ссылаться на данные по ключу или значению.|
|[крбмап](../atl/reference/crbmap-class.md)|Реализует структуру сопоставления с помощью алгоритма "красный-черный".|
|[крбмултимап](../atl/reference/crbmultimap-class.md)|Реализует структуру многоцветового отображения красного и черного.|

Эти классы будут выполнять перехват многих ошибок программирования при использовании в отладочных сборках, но в целях повышения производительности эти проверки не будут выполняться в розничных сборках.

## <a name="specialized-collection-classes"></a>Специализированные классы коллекций

Для управления указателями на память и указателями на интерфейсы также предоставляются более специализированные классы коллекций.

|Class|Назначение|
|-----------|-------------|
|[каутоптраррай](../atl/reference/cautoptrarray-class.md)|Предоставляет методы, полезные при построении массива смарт-указателей.|
|[каутоптрлист](../atl/reference/cautoptrlist-class.md)|Предоставляет методы, полезные при создании списка смарт-указателей.|
|[ккомункаррай](../atl/reference/ccomunkarray-class.md)|Хранит `IUnknown` указатели и предназначен для использования в качестве параметра для класса шаблона [иконнектионпоинтимпл](../atl/reference/iconnectionpointimpl-class.md) .|
|[чеапптрлист](../atl/reference/cheapptrlist-class.md)|Предоставляет методы, полезные при построении списка указателей на кучу.|
|[Цинтерфацеаррай](../atl/reference/cinterfacearray-class.md)|Предоставляет методы, полезные при построении массива указателей на COM-интерфейс.|
|[Цинтерфацелист](../atl/reference/cinterfacelist-class.md)|Предоставляет методы, полезные при создании списка указателей на COM-интерфейс.|

## <a name="choosing-a-collection-class"></a>Выбор класса коллекции

Каждый из доступных классов коллекций предлагает различные характеристики производительности, как показано в таблице ниже.

- Столбцы 2 и 3 описывают порядок и характеристики доступа каждого класса. В таблице термин "упорядочивается" означает, что порядок вставки и удаления элементов определяет их порядок в коллекции. Это не значит, что элементы сортируются по своему содержимому. Термин "индексируется" означает, что элементы в коллекции можно получать с помощью целочисленного индекса, как элементы в обычном массиве.

- Столбцы 4 и 5 описывают производительность каждого класса. В приложениях, требующих большого количества вставок в коллекцию, особое значение может иметь скорость вставки, тогда как в других приложениях наиболее важной может оказаться скорость поиска.

- В столбце 6 указывается допустимость повторяющихся элементов в форме.

- Производительность данной операции класса коллекции выражается в терминах связи между временем, требуемым для завершения операции, и числом элементов в коллекции. Операция, которая занимает много времени при увеличении числа элементов, описывается как алгоритм O (n). В отличие от этого, операция, которая занимает некоторое время и уменьшается при увеличении числа элементов, описывается алгоритмом O (log n). Таким образом, в плане производительности алгоритмы O (log n) более эффективны O (n) алгоритмы больше и больше по мере увеличения числа элементов.

### <a name="collection-shape-features"></a>Функции форм коллекции

|Фигурная|Заказано|Индексированного|Вставить объект<br /><br /> element|Искать:<br /><br /> указанный элемент|Дублирование<br /><br /> элементы|
|-----------|--------------|--------------|---------------------------|--------------------------------------|-----------------------------|
|List|Да|Нет|Быстрое (постоянное время)|Задержка O (n)|Да|
|Array|Да|По int (постоянное время)|Замедляют O (n), за исключением вставки в конец, в этом случае константное время|Задержка O (n)|Да|
|Схема|Нет|По ключу (постоянное время)|Быстрое (постоянное время)|Быстрое (постоянное время)|Нет (ключи) Да (значения)|
|Красная-черная схема|Да (по ключу)|По ключу O (log n)|Быстрый O (log n)|Быстрый O (log n)|Нет|
|Красный-черный multimap|Да (по ключу)|По ключу O (log n) (несколько значений на ключ)|Быстрый O (log n)|Быстрый O (log n)|Да (несколько значений на ключ)|

## <a name="using-ctraits-objects"></a>Использование объектов Ктраитс

Так как классы коллекций ATL можно использовать для хранения широкого спектра определяемых пользователем типов данных, может быть полезно иметь возможность переопределять важные функции, такие как сравнения. Это достигается с помощью классов Ктраитс.

Классы Ктраитс похожи на, но более гибкие, чем, вспомогательные функции класса коллекции MFC. Дополнительные сведения см. в разделе [вспомогательные методы класса Collection](../mfc/reference/collection-class-helpers.md) .

При конструировании класса коллекции имеется возможность указать класс Ктраитс. Этот класс будет содержать код, который будет выполнять такие операции, как сравнения, при вызове другими методами, которые составляют класс коллекции. Например, если объект списка содержит собственные пользовательские структуры, может потребоваться переопределить проверку на равенство, чтобы сравнивать только определенные переменные-члены. Таким образом, метод Find объекта List будет использоваться более удобным способом.

## <a name="example"></a>Пример

### <a name="code"></a>Код

[!code-cpp[NVC_ATL_Utilities#112](../atl/codesnippet/cpp/atl-collection-classes_1.cpp)]

## <a name="comments"></a>Комментарии

Список классов Ктраитс см. в разделе [классы коллекций](../atl/collection-classes.md).

На следующей диаграмме показана иерархия классов для классов Ктраитс.

![Иерархия характеристик классов коллекции](../atl/media/vctraitscollectionclasseshierarchy.gif "Иерархия характеристик классов коллекции")

## <a name="collection-classes-samples"></a>Примеры классов коллекций

В следующих примерах демонстрируются классы коллекций:

- [Пример Ммкссварм](../overview/visual-cpp-samples.md)

- [Пример Динамикконсумер](../overview/visual-cpp-samples.md)

- [Образец UpdatePV](https://github.com/Microsoft/VCSamples/tree/master/VC2010Samples/ATL/OLEDB/Provider/UPDATEPV)

- [Образец бегущей строки](../overview/visual-cpp-samples.md)

## <a name="see-also"></a>См. также раздел

[Концепции](../atl/active-template-library-atl-concepts.md)<br/>
[Классы коллекций](../atl/collection-classes.md)
