---
title: Часто задаваемые вопросы о вложении элементов управления ATL
ms.date: 11/04/2016
helpviewer_keywords:
- hosting controls using ATL
- ActiveX control containers [C++], ATL control hosting
- ATL, hosting ActiveX controls
- ActiveX controls [C++], hosting
- controls [ATL]
ms.assetid: d4bdfbe0-82ca-4f2f-bb95-cb89bdcc9b53
ms.openlocfilehash: 693617589f157d352972485396777cec587a5b8f
ms.sourcegitcommit: d9c94dcabd94537e304be0261b3263c2071b437b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/25/2020
ms.locfileid: "91352704"
---
# <a name="atl-control-containment-faq"></a>Часто задаваемые вопросы о вложении элементов управления ATL

## <a name="which-atl-classes-facilitate-activex-control-containment"></a>Какие классы ATL упрощают вложение элементов ActiveX?

В коде размещения элемента управления ATL не требуется использовать классы ATL. Вы можете просто создать окно **"AtlAxWin80"** и при необходимости использовать API размещения элементов управления (Дополнительные сведения см. **в разделе что такое API размещения ATL**. Однако следующие классы упрощают использование функций включения.

|Класс|Описание|
|-----------|-----------------|
|[каксвиндов](../atl/reference/caxwindow-class.md)|Заключает в оболочку окно **"AtlAxWin80"** , предоставляя методы для создания окна, создания элемента управления и/или присоединения элемента управления к окну и получения указателей интерфейса на объекте узла.|
|[CAxWindow2T](../atl/reference/caxwindow2t-class.md)|Заключает в оболочку окно **"AtlAxWinLic80"** , предоставляя методы для создания окна, создания элемента управления и/или присоединения лицензированного элемента управления к окну и получения указателей интерфейса на объекте узла.|
|[ккомкомпоситеконтрол](../atl/reference/ccomcompositecontrol-class.md)|Выступает в качестве базового класса для классов элементов управления ActiveX на основе ресурса диалогового окна. Такие элементы управления могут содержать другие элементы управления ActiveX.|
|[каксдиалогимпл](../atl/reference/caxdialogimpl-class.md)|Выступает в качестве базового класса для классов диалоговых окон на основе ресурса диалогового окна. Такие диалоговые окна могут содержать элементы управления ActiveX.|
|[CWindow](../atl/reference/cwindow-class.md)|Предоставляет метод [жетдлгконтрол](../atl/reference/cwindow-class.md#getdlgcontrol), возвращающий указатель интерфейса на элементе управления с учетом идентификатора главного окна. Кроме того, оболочки API Windows, предоставляемые, `CWindow` обычно упрощают управление окнами.|

## <a name="what-is-the-atl-control-hosting-api"></a>Что такое интерфейс API для размещения элементов управления ATL?

API размещения ATL — это набор функций, позволяющих любому окну работать в качестве контейнера элемента управления ActiveX. Эти функции могут быть статически или динамически связаны с проектом, так как они доступны в виде исходного кода и предоставляются ATL90.dll. Функции размещения элементов управления перечислены в следующей таблице.

|Компонент|Описание|
|--------------|-----------------|
|[AtlAxAttachControl](reference/composite-control-global-functions.md#atlaxattachcontrol)|Создает объект узла, подключает его к представленному окну, а затем присоединяет существующий элемент управления.|
|[AtlAxCreateControl](reference/composite-control-global-functions.md#atlaxcreatecontrol)|Создает объект узла, подключает его к представленному окну, а затем загружает элемент управления.|
|[AtlAxCreateControlLic](reference/composite-control-global-functions.md#atlaxcreatecontrollic)|Создает лицензированный элемент управления ActiveX, инициализирует его и размещает его в указанном окне аналогично [атлакскреатеконтрол](reference/composite-control-global-functions.md#atlaxcreatecontrol).|
|[AtlAxCreateControlEx](reference/composite-control-global-functions.md#atlaxcreatecontrolex)|Создает объект узла, подключает его к указанному окну, затем загружает элемент управления (также разрешает настройку приемников событий).|
|[AtlAxCreateControlLicEx](reference/composite-control-global-functions.md#atlaxcreatecontrollicex)|Создает лицензированный элемент управления ActiveX, инициализирует его и размещает его в указанном окне аналогично [атлакскреатеконтроллик](reference/composite-control-global-functions.md#atlaxcreatecontrollic).|
|[AtlAxCreateDialog](reference/composite-control-global-functions.md#atlaxcreatedialog)|Создает немодальное диалоговое окно из ресурса диалогового окна и возвращает маркер окна.|
|[AtlAxDialogBox](reference/composite-control-global-functions.md#atlaxdialogbox)|Создает модальное диалоговое окно из ресурса диалогового окна.|
|[AtlAxGetControl](reference/composite-control-global-functions.md#atlaxgetcontrol)|Возвращает указатель интерфейса **IUnknown** элемента управления, размещенного в окне.|
|[AtlAxGetHost](reference/composite-control-global-functions.md#atlaxgethost)|Возвращает указатель интерфейса **IUnknown** объекта узла, подключенного к окну.|
|[AtlAxWinInit](reference/composite-control-global-functions.md#atlaxwininit)|Инициализирует код размещения элемента управления.|
|[AtlAxWinTerm](reference/composite-control-global-functions.md#atlaxwinterm)|Отменяет инициализацию кода размещения элемента управления.|

`HWND`Параметры в первых трех функциях должны быть существующим окном любого типа. Если вы вызываете любую из этих трех функций явным образом (обычно это не требуется), не передавайте обработчик в окно, которое уже работает в качестве узла (если это так, существующий объект узла не будет освобожден).

Первые семь функций вызывают [атлаксвининит](reference/composite-control-global-functions.md#atlaxwininit) неявно.

> [!NOTE]
> API размещения элементов управления образует основу поддержки ATL элемента управления ActiveX. Однако обычно не требуется вызывать эти функции напрямую, если вы используете или полностью используете классы оболочки ATL. Дополнительные сведения см. в разделе [какие классы ATL упрощают включение элемента управления ActiveX](#which-atl-classes-facilitate-activex-control-containment).

## <a name="what-is-atlaxwin100"></a>Что такое AtlAxWin100?

`AtlAxWin100` имя класса окна, помогающего предоставлять функции размещения элемента управления ATL. При создании экземпляра этого класса процедура окна будет автоматически использовать API размещения элементов управления для создания объекта узла, связанного с окном, и загрузки его с элементом управления, указанным в качестве заголовка окна.

## <a name="when-do-i-need-to-call-atlaxwininit"></a>Когда нужно вызывать AtlAxWinInit?

[Атлаксвининит](reference/composite-control-global-functions.md#atlaxwininit) регистрирует класс окна **"AtlAxWin80"** (а также пару настраиваемых оконных сообщений), поэтому эту функцию необходимо вызвать перед созданием главного окна. Однако вам не всегда нужно вызывать эту функцию явным образом, так как API размещения (и классы, использующие их) часто вызывают эту функцию. Неважно вызывать эту функцию более одного раза.

## <a name="what-is-a-host-object"></a>Что такое основной объект?

Объект узла — это COM-объект, представляющий контейнер элементов управления ActiveX, предоставляемый библиотекой ATL для конкретного окна. Объект узла подклассировать окно контейнера таким образом, чтобы он мог отражать сообщения для элемента управления, он предоставляет необходимые интерфейсы контейнера для использования элементом управления и предоставляет интерфейсы [иаксвинхоствиндов](../atl/reference/iaxwinhostwindow-interface.md) и [иаксвинамбиентдиспатч](../atl/reference/iaxwinambientdispatch-interface.md) , позволяющие настроить среду элемента управления.

Объект Host можно использовать для задания свойств окружения контейнера.

## <a name="can-i-host-more-than-one-control-in-a-single-window"></a>Можно ли размещать несколько элементов управления в одном окне?

В одном окне узла ATL нельзя размещать больше одного элемента управления. Каждое главное окно предназначено для хранения только одного элемента управления за раз (это обеспечивает простой механизм обработки отражения сообщений и внешних свойств элементов управления). Однако если необходимо, чтобы пользователь проходил несколько элементов управления в одном окне, очень просто создать несколько ведущих окон в качестве дочерних для этого окна.

## <a name="can-i-reuse-a-host-window"></a>Можно ли использовать основное окно повторно?

Не рекомендуется повторно использовать окна размещения. Чтобы обеспечить надежность кода, следует привязать время существования главного окна к времени существования одного элемента управления.

## <a name="when-do-i-need-to-call-atlaxwinterm"></a>Когда нужно вызывать AtlAxWinTerm?

[Атлаксвинтерм](reference/composite-control-global-functions.md#atlaxwinterm) отменяет регистрацию класса окна **"AtlAxWin80"** . Эту функцию следует вызывать (если не требуется создавать ведущие окна) после уничтожения всех существующих окон размещения. Если не вызвать эту функцию, класс Window будет автоматически отменена при завершении процесса.

## <a name="hosting-activex-controls-using-atl-axhost"></a>Размещение элементов ActiveX с помощью ATL AXHost

В примере в этом разделе показано, как создать объект AXHost и как разместить элемент управления ActiveX с помощью различных функций ATL. Также показано, как получить доступ к событиям управления и приемника (с помощью [IDispEventImpl](../atl/reference/idispeventimpl-class.md)) из размещаемого элемента управления. В этом примере элемент управления Calendar размещается в главном окне или в дочернем окне.

Обратите внимание на определение `USE_METHOD` символа. Значение этого символа можно изменить в диапазоне от 1 до 8. Значение символа определяет, как будет создан элемент управления:

- В случае с четными числовыми значениями `USE_METHOD` вызов создает подкласс главного приложения и преобразует его в узел элемента управления. В случае с нечетными числовыми значениями код создает дочернее окно, которое выступает в качестве узла.

- Для значений `USE_METHOD` от 1 до 4 доступ к элементу управления и стоку событий осуществляется в вызове, который также создает узел. Значения от 5 до 8 запрашивают интерфейс хоста и присоединяются к приемнику.

Ниже приведена сводная информация о вариантах.

|USE_METHOD|Узел|Управление доступом и приемником событий|Продемонстрированные функции|
|-----------------|----------|--------------------------------------|---------------------------|
|1|Дочернее окно|Один шаг|креатеконтроллицекс|
|2|Главное окно|Один шаг|AtlAxCreateControlLicEx|
|3|Дочернее окно|Один шаг|креатеконтролекс|
|4|Главное окно|Один шаг|AtlAxCreateControlEx|
|5|Дочернее окно|Несколько шагов|креатеконтроллик|
|6|Главное окно|Несколько шагов|AtlAxCreateControlLic|
|7|Дочернее окно|Несколько шагов|CreateControl|
|8|Главное окно|Несколько шагов|AtlAxCreateControl|

[!code-cpp[NVC_ATL_AxHost#1](../atl/codesnippet/cpp/hosting-activex-controls-using-atl-axhost_1.cpp)]

## <a name="see-also"></a>См. также раздел

[Часто задаваемые вопросы о вложении элементов управления](../atl/atl-control-containment-faq.md)<br/>
[AtlAxCreateControl](reference/composite-control-global-functions.md#atlaxcreatecontrol)<br/>
[AtlAxCreateControlEx](reference/composite-control-global-functions.md#atlaxcreatecontrolex)<br/>
[AtlAxCreateControlLic](reference/composite-control-global-functions.md#atlaxcreatecontrollic)<br/>
[AtlAxCreateControlLicEx](reference/composite-control-global-functions.md#atlaxcreatecontrolex)<br/>
[Класс CAxWindow2T](../atl/reference/caxwindow2t-class.md)<br/>
[Интерфейс Иаксвинхоствиндовлик](../atl/reference/iaxwinhostwindowlic-interface.md)
