---
title: Реализация страницы свойств (ATL)
ms.date: 11/19/2018
helpviewer_keywords:
- property pages, implementing
ms.assetid: c30b67fe-ce08-4249-ae29-f3060fa8d61e
ms.openlocfilehash: a86393954cdebec59bd2c6a50cd5e547ef06acb7
ms.sourcegitcommit: c3093251193944840e3d0a068ecc30e6449624ba
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/04/2019
ms.locfileid: "57267242"
---
# <a name="example-implementing-a-property-page"></a>Пример Реализация страницы свойств

В этом примере показано, как создать страницу свойств, отображающий (и позволяет изменять) свойства [классы документов](../mfc/document-classes.md) интерфейс.

Пример построен на основе [пример ATLPages](../visual-cpp-samples.md).

Чтобы выполнить этот пример, вы научитесь:

- [Добавление класса страницы свойств ATL](#vcconusing_the_atl_object_wizard) с помощью диалогового окна добавления классов и мастер страницы свойств ATL.

- [Изменение ресурса диалогового окна](#vcconediting_the_dialog_resource) путем добавления новых элементов управления для интересных свойств `Document` интерфейс.

- [Добавление обработчиков сообщений](#vcconadding_message_handlers) для сохранения веб-узел страницы свойств сведения об изменениях, внесенных пользователем.

- Добавить некоторые `#import` инструкций и typedef в [по обслуживанию](#vcconhousekeeping) раздел.

- [Переопределить IPropertyPageImpl::SetObjects](#vcconoverriding_ipropertypageimpl_setobjects) для проверки объектов, передаваемого на страницу свойств.

- [Переопределить IPropertyPageImpl::Activate](#vcconoverriding_ipropertypageimpl_activate) инициализировать интерфейс на странице свойств.

- [Переопределить IPropertyPageImpl::Apply](#vcconoverride_ipropertypageimpl_apply) для обновления объекта последними значениями свойства.

- [Отобразить страницу «свойства»](#vccontesting_the_property_page) путем создания простой вспомогательный объект.

- [Создать макрос](#vcconcreating_a_macro) , проверите страницы свойств.

##  <a name="vcconusing_the_atl_object_wizard"></a> Добавление класса страницы свойств ATL

Во-первых, создайте новый проект ATL для сервере библиотеки DLL с именем `ATLPages7`. Теперь с помощью [мастер страницы свойств ATL](../atl/reference/atl-property-page-wizard.md) для создания страницы свойств. Присвойте странице свойство **короткое имя** из **DocProperties** переключитесь **строки** страницу, чтобы задать особые для страницы свойств элементов, как показано в следующей таблице.

|Элемент|Значение|
|----------|-----------|
|Заголовок|TextDocument|
|Строка документа|Свойства TextDocument VCUE|
|HelpFile|*\<пустой >*|

Значения, заданные на этой странице мастера будет возвращаться в контейнер свойств страницы, при вызове `IPropertyPage::GetPageInfo`. Что происходит на строки после, зависит, в контейнере, но обычно они будут использоваться для идентификации страницы для пользователя. Заголовок обычно будет отображаться на вкладке выше страницы и строка документации могут отображаться в строке состояния или подсказки (несмотря на то, что кадр стандартное свойство вообще не использовать эту строку).

> [!NOTE]
>  Строки, заданные здесь хранятся в виде строковых ресурсов в проекте с помощью мастера. Можно легко изменить эти строки, с помощью редактора ресурсов, если необходимо изменить эти данные, после создания кода для страницы.

Нажмите кнопку **ОК** чтобы мастер создания страницы свойств.

##  <a name="vcconediting_the_dialog_resource"></a> Изменение ресурса диалогового окна

Теперь, когда создан страницы свойств, необходимо добавить несколько элементов управления в ресурс диалогового окна, представляющий страницу. Добавьте поле ввода статического текста и типа "флажок" и задайте их идентификаторы, как показано ниже:

![Изменение ресурса диалогового окна](../atl/media/ppgresourcelabeled.gif "изменение ресурса диалогового окна")

Эти элементы управления будет использоваться для отображения имени файла документа и его состояние только для чтения.

> [!NOTE]
>  Ресурс диалогового окна не включает кадра или команды кнопок и не имеет с вкладками внешний вид, можно было бы ожидать. Эти возможности предоставляются фрейма страницы свойств, например в каталог, созданных вызывающими [OleCreatePropertyFrame](/windows/desktop/api/olectl/nf-olectl-olecreatepropertyframe).

##  <a name="vcconadding_message_handlers"></a> Добавление обработчиков сообщений

С помощью элементов управления, в месте можно добавить обработчики сообщений, чтобы обновить состояние "грязные" страницы, при изменении значения любого элемента управления:

[!code-cpp[NVC_ATL_Windowing#73](../atl/codesnippet/cpp/example-implementing-a-property-page_1.h)]

Этот код реагирует на изменения, внесенные в элемент управления или "флажок" путем вызова [IPropertyPageImpl::SetDirty](../atl/reference/ipropertypageimpl-class.md#setdirty), информирующий веб-узел страницы, страница была изменена. Обычно веб-узел страницы будет отвечать путем включения или отключения **применить** кнопку на фрейма страницы свойств.

> [!NOTE]
>  В собственных страницы свойств может потребоваться для отслеживания точно свойства, которые были изменены пользователем, чтобы избежать обновления свойств, которые еще не были изменены. Этот пример реализует этот код с отслеживает исходные значения свойств и их сравнения с текущими значениями из пользовательского интерфейса, когда придет время, чтобы применить изменения.

##  <a name="vcconhousekeeping"></a> По обслуживанию

Теперь добавьте несколько `#import` инструкции, чтобы DocProperties.h, чтобы компилятор знал о `Document` интерфейса:

[!code-cpp[NVC_ATL_Windowing#74](../atl/codesnippet/cpp/example-implementing-a-property-page_2.h)]

Также необходимо ссылаться на `IPropertyPageImpl` базового класса; добавьте следующие **typedef** для `CDocProperties` класса:

[!code-cpp[NVC_ATL_Windowing#75](../atl/codesnippet/cpp/example-implementing-a-property-page_3.h)]

##  <a name="vcconoverriding_ipropertypageimpl_setobjects"></a> Overriding IPropertyPageImpl::SetObjects

Первый `IPropertyPageImpl` — метод, который необходимо переопределить [SetObjects](../atl/reference/ipropertypageimpl-class.md#setobjects). Здесь вы добавите код для проверки, что был передан только один объект и поддерживает `Document` интерфейс, который вы ожидаете:

[!code-cpp[NVC_ATL_Windowing#76](../atl/codesnippet/cpp/example-implementing-a-property-page_4.h)]

> [!NOTE]
>  Смысл поддерживает только один объект для этой страницы, так как позволяет пользователю задать имя файла объекта — в любом расположении может существовать только один файл.

##  <a name="vcconoverriding_ipropertypageimpl_activate"></a> Переопределение IPropertyPageImpl::Activate

Далее необходимо инициализировать страницу свойств со значениями свойств базового объекта, при создании страницы.

В этом случае следует добавить следующие члены в класс, так как вы также будете использовать исходные значения свойств для сравнения при применении страницы свои изменения:

[!code-cpp[NVC_ATL_Windowing#77](../atl/codesnippet/cpp/example-implementing-a-property-page_5.h)]

Реализация базового класса [активировать](../atl/reference/ipropertypageimpl-class.md#activate) метод отвечает за создание диалогового окна и его элементы управления, можно переопределить этот метод, а также добавлять собственные инициализации после вызова базового класса:

[!code-cpp[NVC_ATL_Windowing#78](../atl/codesnippet/cpp/example-implementing-a-property-page_6.h)]

Этот код использует методы COM `Document` интерфейса для получения свойства, которые вас интересуют. Затем он использует оболочки Win32 API, предоставляемые [CDialogImpl](../atl/reference/cdialogimpl-class.md) и его базовых классов для отображения значений свойств для пользователя.

##  <a name="vcconoverride_ipropertypageimpl_apply"></a> Переопределение IPropertyPageImpl::Apply

Когда пользователям необходимо применять изменения к объектам, вызывает веб-узел страницы свойство [применить](../atl/reference/ipropertypageimpl-class.md#apply) метод. Это место, чтобы выполнить обратную операцию кода в `Activate` , тогда как `Activate` заняло значения из объекта, при передаче их в элементы управления на странице свойств `Apply` принимает значения от элементов управления на странице свойств и помещает их в объект.

[!code-cpp[NVC_ATL_Windowing#79](../atl/codesnippet/cpp/example-implementing-a-property-page_7.h)]

> [!NOTE]
>  Проверка [m_bDirty](../atl/reference/ipropertypageimpl-class.md#m_bdirty) в начале этой реализации является начальная проверка, чтобы избежать ненужных обновлений объектов в том случае, если `Apply` вызывается несколько раз. Существуют также каждого из значений свойств, чтобы гарантировать, что только изменения приведут к вызову метода для проверки `Document`.

> [!NOTE]
> `Document` предоставляет `FullName` как свойство только для чтения. Чтобы обновить имя файла документа, на основе изменений на страницу свойств, необходимо использовать `Save` метод, чтобы сохранить файл с другим именем. Таким образом, код на странице свойств не ограничено для получения или задания свойства.

##  <a name="vccontesting_the_property_page"></a> Отображается страница "Свойства"

Чтобы отобразить эту страницу, необходимо создать простой вспомогательный объект. Вспомогательный объект предоставляет метод, который упрощает `OleCreatePropertyFrame` API для отображения на одной странице, подключенных к одному объекту. Этого вспомогательного объекта будет разработана, чтобы его можно использовать из Visual Basic.

Используйте [диалоговое окно добавления класса](../ide/add-class-dialog-box.md) и [мастер простых объектов ATL](../atl/reference/atl-simple-object-wizard.md) для создания нового класса и использования `Helper` как его краткое имя. После создания, добавьте метод, как показано в следующей таблице.

|Элемент|Значение|
|----------|-----------|
|Имя метода|`ShowPage`|
|Параметры|`[in] BSTR bstrCaption, [in] BSTR bstrID, [in] IUnknown* pUnk`|

*BstrCaption* параметр имеет заголовок, отображаемый в качестве заголовка диалогового окна. *BstrID* параметра является строка, представляющая CLSID или ProgID страницы свойств для отображения. *PUnk* параметр будет иметь `IUnknown` указатель на объект, свойства которого будут настроены на странице свойств.

Реализуйте метод, как показано ниже:

[!code-cpp[NVC_ATL_Windowing#80](../atl/codesnippet/cpp/example-implementing-a-property-page_8.cpp)]

##  <a name="vcconcreating_a_macro"></a> Создание макроса

После создания проекта, вы можете проверить страницу свойств и вспомогательный объект, с помощью простой макрос, который можно создать и запустить в среде разработки Visual Studio. Этот макрос создает вспомогательный объект, а затем вызвать его `ShowPage` метод, используя идентификатор ProgID **DocProperties** страницу свойств и `IUnknown` указатель документа, активного в редакторе Visual Studio. Ниже приведен код, необходимый для этого макроса:

```vb
Imports EnvDTE
Imports System.Diagnostics

Public Module AtlPages

Public Sub Test()
    Dim Helper
    Helper = CreateObject("ATLPages7.Helper.1")

    On Error Resume Next
    Helper.ShowPage( ActiveDocument.Name, "ATLPages7Lib.DocumentProperties.1", DTE.ActiveDocument )
End Sub

End Module
```

При запуске этот макрос, страницы свойств будет отображаться отображается имя файла и его состояние только для чтения текущей активной текстового документа. Состояние только для чтения документа только отражает возможность записи в документ в среде разработки; он не влияет на атрибут только для чтения файла на диске.

## <a name="see-also"></a>См. также

[Страницы свойств](../atl/atl-com-property-pages.md)<br/>
[Пример ATLPages](../visual-cpp-samples.md)
