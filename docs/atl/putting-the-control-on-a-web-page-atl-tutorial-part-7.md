---
description: 'Дополнительные сведения: размещение элемента управления на веб-странице (учебник по ATL, часть 7)'
title: Размещение элемента управления на веб-странице (учебник ATL, часть 7)
ms.custom: get-started-article
ms.date: 05/06/2019
ms.assetid: 50dc4c95-c95b-4006-b88a-9826f7bdb222
ms.openlocfilehash: 738d847a6436a2afab2e336502ec3255d1a1e589
ms.sourcegitcommit: d6af41e42699628c3e2e6063ec7b03931a49a098
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2020
ms.locfileid: "97159184"
---
# <a name="putting-the-control-on-a-web-page-atl-tutorial-part-7"></a>Размещение элемента управления на веб-странице (учебник ATL, часть 7)

Теперь элемент управления завершен. Чтобы увидеть, как работает элемент управления в реальной ситуации, разместите его на веб-странице. HTML-файл, содержащий элемент управления, был создан при определении элемента управления. Откройте файл PolyCtl.htm из **Обозреватель решений**, и вы сможете увидеть свой элемент управления на веб-странице.

На этом шаге вы добавите в элемент управления функциональные возможности и задаете скрипт веб-странице для реагирования на события. Вы также измените элемент управления, чтобы позволить Internet Explorer убедиться, что элемент управления является надежным для сценариев.

## <a name="adding-new-functionality"></a>Добавление новых функциональных возможностей

### <a name="to-add-control-features"></a>Добавление функций управления

1. Откройте Поликтл. cpp и замените следующий код:

    ```cpp
    if (PtInRegion(hRgn, xPos, yPos))
        Fire_ClickIn(xPos, yPos);
    else
        Fire_ClickOut(xPos, yPos);
    ```

    на

    ```cpp
    short temp = m_nSides;
    if (PtInRegion(hRgn, xPos, yPos))
    {
        Fire_ClickIn(xPos, yPos);
        put_Sides(++temp);
    }
    else
    {
        Fire_ClickOut(xPos, yPos);
        put_Sides(--temp);
    }
    ```

Теперь фигура будет добавлять или удалять стороны в зависимости от того, где вы щелкнули.

## <a name="scripting-the-web-page"></a>Создание скрипта для веб-страницы

Элемент управления еще не выполняет никаких действий, поэтому измените веб-страницу, чтобы она отвечала на отправляемые события.

### <a name="to-script-the-web-page"></a>Создание скрипта для веб-страницы

1. Откройте PolyCtl.htm и выберите представление HTML. Добавьте следующие строки в код HTML. Их следует добавить после `</OBJECT>` , но до `</BODY>` .

    ```html
    <SCRIPT LANGUAGE="VBScript">
    <!--
        Sub PolyCtl_ClickIn(x, y)
            MsgBox("Clicked (" & x & ", " & y & ") - adding side")
        End Sub
        Sub PolyCtl_ClickOut(x, y)
            MsgBox("Clicked (" & x & ", " & y & ") - removing side")
        End Sub
    -->
    </SCRIPT>
    ```

1. Сохраните файл HTM.

Вы добавили код VBScript, который получает свойство стороны от элемента управления. При щелчке внутри элемента управления число сторон увеличивается на единицу. Если щелкнуть за пределами элемента управления, количество сторон уменьшается на единицу.

## <a name="indicating-that-the-control-is-safe-for-scripting"></a>, Указывающее, что элемент управления является надежным для сценариев

Веб-страницу можно просматривать только с помощью элемента управления в Internet Explorer. Другие браузеры больше не поддерживают элементы управления ActiveX из-за слабых мест в системе безопасности.

> [!NOTE]
> Если элемент управления не отображается, необходимо убедиться, что некоторым браузерам требуются настройки параметров для запуска элементов управления ActiveX. Сведения о том, как включить элементы управления ActiveX, см. в документации по браузеру.

В зависимости от текущих настроек безопасности Internet Explorer может появиться диалоговое окно предупреждения системы безопасности. В нем говорится, что элемент управления может быть небезопасен и потенциально может повредиться. Например, если у вас есть элемент управления, который отображает файл, но также имел `Delete` метод, который удалил файл, он был бы ненадежным, если вы только что Просмотрели его на странице. Однако было бы незащищенным скриптом, поскольку кто-то мог вызвать `Delete` метод.

> [!IMPORTANT]
> В этом руководстве можно изменить параметры безопасности в Internet Explorer для запуска элементов управления ActiveX, не помеченных как надежные. На панели управления щелкните **Свойства Интернета** и щелкните **Безопасность** , чтобы изменить соответствующие параметры. Завершив работу с этим руководством, измените параметры безопасности обратно на исходное состояние.

Можно программно предупредить Internet Explorer о том, что для этого конкретного элемента управления не требуется выводить диалоговое окно предупреждение системы безопасности. Это можно сделать с помощью `IObjectSafety` интерфейса. Библиотека ATL предоставляет реализацию этого интерфейса в классе [иобжектсафетимпл](../atl/reference/iobjectsafetyimpl-class.md). Чтобы добавить интерфейс к элементу управления, добавьте `IObjectSafetyImpl` его в список унаследованных классов и добавьте в карту com запись для него.

### <a name="to-add-iobjectsafetyimpl-to-the-control"></a>Добавление Иобжектсафетимпл к элементу управления

1. Добавьте следующую строку в конец списка унаследованных классов в Поликтл. h и добавьте запятую в предыдущую строку:

    [!code-cpp[NVC_ATL_Windowing#62](../atl/codesnippet/cpp/putting-the-control-on-a-web-page-atl-tutorial-part-7_1.h)]

1. Добавьте следующую строку в карту COM в Поликтл. h:

    [!code-cpp[NVC_ATL_Windowing#63](../atl/codesnippet/cpp/putting-the-control-on-a-web-page-atl-tutorial-part-7_2.h)]

## <a name="building-and-testing-the-control"></a>Сборка и тестирование элемента управления

Создайте элемент управления. После завершения сборки снова откройте PolyCtl.htm в представлении браузера. На этот раз веб-страница должна отображаться непосредственно без диалогового окна " **оповещение о безопасности** ". Если щелкнуть внутри многоугольника, число Сторон увеличится на единицу. Щелкните за пределами многоугольника, чтобы уменьшить число сторон.

[Назад к шагу 6](../atl/adding-a-property-page-atl-tutorial-part-6.md)

## <a name="next-steps"></a>Next Steps

На этом шаге учебник по ATL завершается. Ссылки на дополнительные сведения о ATL см. на [начальной странице ATL](../atl/active-template-library-atl-concepts.md).

## <a name="see-also"></a>См. также раздел

[Руководство](../atl/active-template-library-atl-tutorial.md)
