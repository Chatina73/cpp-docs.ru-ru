---
title: Макросы отладки и отчетов об ошибках
ms.date: 05/06/2019
f1_keywords:
- atldef/ATL::_ATL_DEBUG_INTERFACES
- atldef/ATL::_ATL_DEBUG_QI
- atldef/ATL::ATLASSERT
- afx/ATL::ATLENSURE
- atltrace/ATL::ATLTRACENOTIMPL
- atltrace/ATL::ATLTRACE
helpviewer_keywords:
- macros, error reporting
ms.assetid: 4da9b87f-ec5c-4a32-ab93-637780909b9d
ms.openlocfilehash: b666ba3debe164118c9b40b90313646592b04876
ms.sourcegitcommit: bf724dfc639b16d5410fab72183f8e6b781338bc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/17/2019
ms.locfileid: "71062040"
---
# <a name="debugging-and-error-reporting-macros"></a>Макросы отладки и отчетов об ошибках

Эти макросы предоставляют полезные средства отладки и трассировки.

|||
|-|-|
|[_ATL_DEBUG_INTERFACES](#_atl_debug_interfaces)|Операции записи в окно вывода — все утечки интерфейса, обнаруженные при `_Module.Term` вызове метода.|
|[_ATL_DEBUG_QI](#_atl_debug_qi)|Записывает все вызовы `QueryInterface` в окно вывода.|
|[АТЛАССЕРТ](#atlassert)|Выполняет те же функции, что и макрос [_ASSERTE](../../c-runtime-library/reference/assert-asserte-assert-expr-macros.md) , обнаруженный в библиотеке времени выполнения C.|
|[АТЛЕНСУРЕ](#atlensure)|Выполняет проверку параметров. Вызов `AtlThrow` при необходимости|
|[АТЛТРАЦЕНОТИМПЛ](#atltracenotimpl)|Отправляет сообщение устройству дампа, что указанная функция не реализована.|
|[ATLTRACE](#atltrace)|Сообщает о предупреждениях на выходное устройство, например в окно отладчика, в соответствии с указанными флагами и уровнями. Включается для обеспечения обратной совместимости.|
|[ATLTRACE2](#atltrace2)|Сообщает о предупреждениях на выходное устройство, например в окно отладчика, в соответствии с указанными флагами и уровнями.|

##  <a name="_atl_debug_interfaces"></a>  _ATL_DEBUG_INTERFACES

Определите этот макрос перед включением любых файлов заголовков ATL `AddRef` для `Release` трассировки всех и вызовов интерфейсов компонентов в окне вывода.

```
#define _ATL_DEBUG_INTERFACES
```

### <a name="remarks"></a>Примечания

Отобразятся выходные данные трассировки, как показано ниже.

`ATL: QIThunk - 2008         AddRef  :   Object = 0x00d81ba0   Refcount = 1   CBug - IBug`

Первая часть каждой трассировки всегда будет иметь `ATL: QIThunk`значение. Далее следует значение, определяющее используемый *преобразователь интерфейса* . Преобразователь интерфейса — это объект, используемый для поддержания счетчика ссылок и предоставления возможности трассировки, используемой здесь. Новый преобразователь интерфейса создается при каждом вызове функции `QueryInterface` , за исключением запросов `IUnknown` для интерфейса (в данном случае один и тот же преобразователь возвращается каждый раз, чтобы соответствовать правилам идентификации com).

Далее вы `AddRef` увидите или `Release` указываете, какой метод был вызван. После этого вы увидите значение, идентифицирующее объект, для которого был изменен счетчик ссылок на интерфейс. Значение, отслеживаемое, является **указателем** объекта.

Счетчик ссылок, который отслеживается, является счетчиком ссылок на этот преобразователь `AddRef` после `Release` вызова метода или. Обратите внимание, что этот счетчик ссылок может не соответствовать счетчику ссылок для объекта. Каждый преобразователь сохраняет свой собственный счетчик ссылок, что позволяет полностью соответствовать правилам подсчета ссылок COM.

Последняя часть сведений — это имя объекта и интерфейса, затрагиваемого `AddRef` вызовом или. `Release`

Утечки в интерфейсе, обнаруженные при завершении работы сервера `_Module.Term` и его вызов, будут регистрироваться следующим образом:

`ATL: QIThunk - 2005         LEAK    :   Object = 0x00d81ca0   Refcount = 1   MaxRefCount = 1   CBug - IBug`

Приведенные здесь сведения непосредственно сопоставлены с информацией, приведенной в предыдущих инструкциях трассировки, поэтому можно проверить счетчики ссылок в течение всего времени существования преобразователя интерфейса. Кроме того, вы получаете указание на максимальное количество ссылок на этот преобразователь интерфейса.

> [!NOTE]
> _ATL_DEBUG_INTERFACES можно использовать в розничных сборках.

##  <a name="_atl_debug_qi"></a>  _ATL_DEBUG_QI

Записывает все вызовы `QueryInterface` в окно вывода.

```
#define _ATL_DEBUG_QI
```

### <a name="remarks"></a>Примечания

В случае `QueryInterface` сбоя вызова в окне вывода отобразится следующее:

*имя интерфейса* - `failed`

##  <a name="atlassert"></a>АТЛАССЕРТ

Макрос АТЛАССЕРТ выполняет те же функции, что и макрос [_ASSERTE](../../c-runtime-library/reference/assert-asserte-assert-expr-macros.md) , находящийся в библиотеке времени выполнения C.

```
ATLASSERT(booleanExpression);
```

### <a name="parameters"></a>Параметры

*булеанекспрессион*<br/>
Выражение (включая указатели), результат вычисления которого отличен от нуля или равен нулю.

### <a name="remarks"></a>Примечания

В отладочных сборках АТЛАССЕРТ оценивает *булеанекспрессион* и создает отчет об отладке, если результат имеет значение false.

## <a name="requirements"></a>Требования

**Заголовок:** атлдеф. h

##  <a name="atlensure"></a>АТЛЕНСУРЕ

Этот макрос используется для проверки параметров, передаваемых в функцию.

```
ATLENSURE(booleanExpression);
ATLENSURE_THROW(booleanExpression, hr);
```

### <a name="parameters"></a>Параметры

*булеанекспрессион*<br/>
Указывает логическое выражение, которое необходимо проверить.

*кадров*<br/>
Указывает возвращаемый код ошибки.

### <a name="remarks"></a>Примечания

Эти макросы предоставляют механизм для обнаружения и уведомления пользователя о неправильном использовании параметра.

Макрос вызывает АТЛАССЕРТ и, если условие не выполняется, `AtlThrow`вызывает.

В атленсуре случае `AtlThrow` вызывается с параметром E_FAIL.

В ATLENSURE_THROW случае `AtlThrow` вызывается с указанным значением HRESULT.

Разница между АТЛЕНСУРЕ и АТЛАССЕРТ заключается в том, что АТЛЕНСУРЕ создает исключение в сборках выпуска, а также в отладочных сборках.

### <a name="example"></a>Пример

[!code-cpp[NVC_ATL_Utilities#108](../../atl/codesnippet/cpp/debugging-and-error-reporting-macros_1.cpp)]

## <a name="requirements"></a>Требования

**Заголовок:** afx.h

##  <a name="atltracenotimpl"></a>АТЛТРАЦЕНОТИМПЛ

В отладочных сборках ATL отправляет строку " *funcname* не реализована" на устройство дампа и ВОЗВРАЩАЕТ значение E_NOTIMPL.

```
ATLTRACENOTIMPL(funcname);
```

### <a name="parameters"></a>Параметры

*funcname*<br/>
окне Строка, содержащая имя функции, которая не реализована.

### <a name="remarks"></a>Примечания

В сборках выпуска просто возвращает значение E_NOTIMPL.

### <a name="example"></a>Пример

[!code-cpp[NVC_ATL_Utilities#127](../../atl/codesnippet/cpp/debugging-and-error-reporting-macros_2.cpp)]

## <a name="requirements"></a>Требования

**Заголовок:** ATLTRACE. h

##  <a name="atltrace"></a>ATLTRACE

Сообщает о предупреждениях на выходное устройство, например в окно отладчика, в соответствии с указанными флагами и уровнями. Включается для обеспечения обратной совместимости.

```
ATLTRACE(exp);

ATLTRACE(
    DWORD category,
    UINT  level,
    LPCSTR lpszFormat, ...);
```

### <a name="parameters"></a>Параметры

*exp*<br/>
окне Строка и переменные для отправки в окно вывода или любое приложение, которое перехватывает эти сообщения.

*category*<br/>
окне Тип события или метода для отчета. Список категорий см. в разделе "Примечания".

*level*<br/>
окне Уровень трассировки для отчета. Дополнительные сведения см. в примечаниях.

*лпсзформат*<br/>
окне Отформатированная строка для отправки на устройство дампа.

### <a name="remarks"></a>Примечания

Описание ATLTRACE см. в разделе [ATLTRACE2](#atltrace2) . ATLTRACE и ATLTRACE2 имеют одинаковое поведение, ATLTRACE входит в целях обратной совместимости.

##  <a name="atltrace2"></a>ATLTRACE2

Сообщает о предупреждениях на выходное устройство, например в окно отладчика, в соответствии с указанными флагами и уровнями.

```
ATLTRACE2(exp);

ATLTRACE2(
    DWORD category,
    UINT level,
    LPCSTR lpszFormat,  ...);
```

### <a name="parameters"></a>Параметры

*exp*<br/>
окне Строка для отправки в окно вывода или любое приложение, которое перехватывает эти сообщения.

*category*<br/>
окне Тип события или метода для отчета. Список категорий см. в разделе "Примечания".

*level*<br/>
окне Уровень трассировки для отчета. Дополнительные сведения см. в примечаниях.

*лпсзформат*<br/>
окне `printf`Строка формата в стиле, используемая для создания строки, отправляемой на устройство дампа.

### <a name="remarks"></a>Примечания

Краткая форма ATLTRACE2 записывает строку в окно вывода отладчика. Вторая форма ATLTRACE2 также записывает выходные данные в окно вывода отладчика, но в соответствии с настройками средства трассировки ATL/MFC (см. [Пример атлтрацетул](../../overview/visual-cpp-samples.md)). Например, если задать для параметра *уровень* значение 4, а для средства трассировки ATL/MFC — уровень 0, сообщение отображаться не будет. *уровень* может быть равен 0, 1, 2, 3 или 4. По умолчанию 0 сообщает только о самых серьезных проблемах.

Параметр *Category* Перечисляет заданные флаги трассировки. Эти флаги соответствуют типам методов, для которых необходимо создать отчет. В приведенных ниже таблицах перечислены допустимые флаги трассировки, которые можно использовать для параметра *Category* .

### <a name="atl-trace-flags"></a>Флаги трассировки ATL

|Категория ATL|Описание|
|------------------|-----------------|
|`atlTraceGeneral`|Отчеты по всем приложениям ATL. По умолчанию.|
|`atlTraceCOM`|Сообщает о методах COM.|
|`atlTraceQI`|Отчеты о вызовах QueryInterface.|
|`atlTraceRegistrar`|Сообщает о регистрации объектов.|
|`atlTraceRefcount`|Сообщает об изменении счетчика ссылок.|
|`atlTraceWindowing`|Отчеты по методам Windows; Например, сообщает о недопустимом ИДЕНТИФИКАТОРе схемы сообщения.|
|`atlTraceControls`|Отчеты по элементам управления; Например, сообщает об удалении элемента управления или его окна.|
|`atlTraceHosting`|Сообщает о размещении сообщений; Например, сообщает о том, что клиент в контейнере активирован.|
|`atlTraceDBClient`|Отчеты по шаблону потребителя OLE DB; Например, при сбое вызова метода GetData выходные данные могут содержать значение HRESULT.|
|`atlTraceDBProvider`|Отчеты по шаблону поставщика OLE DB; Например, сообщает, что при создании столбца произошел сбой.|
|`atlTraceSnapin`|Отчеты для приложения оснастки MMC.|
|`atlTraceNotImpl`|Сообщает о том, что указанная функция не реализована.|
|`atlTraceAllocation`|Сообщает о сообщениях, выводимых средствами отладки памяти в атлдбгмем. h.|

### <a name="mfc-trace-flags"></a>Флаги трассировки MFC

|Категория MFC|Описание|
|------------------|-----------------|
|`traceAppMsg`|Общее назначение, сообщения MFC. Рекомендуется всегда.|
|`traceDumpContext`|Сообщения от [CDumpContext](../../mfc/reference/cdumpcontext-class.md).|
|`traceWinMsg`|Сообщения из кода обработки сообщений MFC.|
|`traceMemory`|Сообщения из кода управления памятью MFC.|
|`traceCmdRouting`|Сообщения из кода маршрутизации команд Windows MFC.|
|`traceHtml`|Сообщения из поддержки диалогового окна DHTML в MFC.|
|`traceSocket`|Сообщения из поддержки сокетов MFC.|
|`traceOle`|Сообщения из поддержки OLE MFC.|
|`traceDatabase`|Сообщения из поддержки базы данных MFC.|
|`traceInternet`|Сообщения из службы поддержки Интернета MFC.|

Чтобы объявить пользовательскую категорию трассировки, объявите глобальный экземпляр `CTraceCategory` класса следующим образом:

[!code-cpp[NVC_ATL_Utilities#109](../../atl/codesnippet/cpp/debugging-and-error-reporting-macros_3.cpp)]

Имя категории, MY_CATEGORY в этом примере, — это имя, указанное в параметре *Category* . Первый параметр — это имя категории, которое будет отображаться в средстве трассировки ATL/MFC. Вторым параметром является уровень трассировки по умолчанию. Этот параметр является необязательным, а уровень трассировки по умолчанию — 0.

Чтобы использовать определенную пользователем категорию, выполните следующие действия.

[!code-cpp[NVC_ATL_Utilities#110](../../atl/codesnippet/cpp/debugging-and-error-reporting-macros_4.cpp)]

Чтобы указать, что необходимо отфильтровать сообщения трассировки, вставьте определения этих макросов в файл stdafx. h перед `#include <atlbase.h>` инструкцией.

Кроме того, можно задать фильтр в директивах препроцессора в диалоговом окне **страницы свойств** . Перейдите на вкладку **препроцессор** и вставьте параметр Global в поле ввода **определений препроцессора** .

Atlbase. h содержит определения по умолчанию для макросов ATLTRACE2, и эти определения будут использоваться, если эти символы не определены до начала обработки atlbase. h.

В сборках выпуска ATLTRACE2 компилируется в `(void) 0`.

ATLTRACE2 ограничивает содержимое строки для отправки на устройство дампа до 1023 символов после форматирования.

ATLTRACE и ATLTRACE2 имеют одинаковое поведение, ATLTRACE входит в целях обратной совместимости.

### <a name="example"></a>Пример

[!code-cpp[NVC_ATL_Utilities#111](../../atl/codesnippet/cpp/debugging-and-error-reporting-macros_5.cpp)]

## <a name="see-also"></a>См. также

[Макросы](../../atl/reference/atl-macros.md)<br/>
[Глобальные функции для отладки и создания отчетов об ошибках](../../atl/reference/debugging-and-error-reporting-global-functions.md)
