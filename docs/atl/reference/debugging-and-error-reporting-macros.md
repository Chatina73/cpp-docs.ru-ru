---
title: Макросы отладки и отчеты об ошибках
ms.date: 11/04/2016
f1_keywords:
- atldef/ATL::_ATL_DEBUG_INTERFACES
- atldef/ATL::_ATL_DEBUG_QI
- atldef/ATL::ATLASSERT
- afx/ATL::ATLENSURE
- atltrace/ATL::ATLTRACENOTIMPL
- atltrace/ATL::ATLTRACE
helpviewer_keywords:
- macros, error reporting
ms.assetid: 4da9b87f-ec5c-4a32-ab93-637780909b9d
ms.openlocfilehash: 5de597484db727646b80bd522f11465f442393fd
ms.sourcegitcommit: 6052185696adca270bc9bdbec45a626dd89cdcdd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/31/2018
ms.locfileid: "50522311"
---
# <a name="debugging-and-error-reporting-macros"></a>Макросы отладки и отчеты об ошибках

Эти макросы предоставляют полезные средства отладки и трассировки.

|||
|-|-|
|[_ATL_DEBUG_INTERFACES](#_atl_debug_interfaces)|Записывает, в окне вывода любого интерфейса утечек, при обнаружении `_Module.Term` вызывается.|
|[_ATL_DEBUG_QI](#_atl_debug_qi)|Записывает все вызовы `QueryInterface` в окне вывода.|
|[ATLASSERT](#atlassert)|Выполняет ту же функциональность, что [_ASSERTE](../../c-runtime-library/reference/assert-asserte-assert-expr-macros.md) макрос, найденный в библиотеке времени выполнения C.|
|[ATLENSURE](#atlensure)|Выполняет проверку параметров. Вызовите `AtlThrow` при необходимости|
|[ATLTRACENOTIMPL](#atltracenotimpl)|Отправляет сообщение на устройство дампа, что указанная функция не реализована.|
|[ATLTRACE](#alttrace)|Предупреждения в устройство вывода, например окна отладчика, в соответствии с указанных флагов и уровней. Включен для обеспечения обратной совместимости.|
|[ATLTRACE2](#atltrace2)|Предупреждения в устройство вывода, например окна отладчика, в соответствии с указанных флагов и уровней.|

##  <a name="_atl_debug_interfaces"></a>  _ATL_DEBUG_INTERFACES

Задать этот макрос перед включением всех файлов заголовков ATL для отслеживания всех `AddRef` и `Release` вызывает в интерфейсах компонентов в окне вывода.

```
#define _ATL_DEBUG_INTERFACES
```

### <a name="remarks"></a>Примечания

Выходные данные трассировки будет отображаться, как показано ниже:

`ATL: QIThunk - 2008         AddRef  :   Object = 0x00d81ba0   Refcount = 1   CBug - IBug`

В первой части каждой трассировки всегда будет `ATL: QIThunk`. Далее следует значение, идентифицирующее конкретного *интерфейс преобразователь* используется. Интерфейс преобразователь — это объект, который поддерживает счетчик ссылок и предоставляют возможность трассировки, используемый здесь. При каждом вызове создается новый интерфейс преобразователь `QueryInterface` за исключением запросов `IUnknown` интерфейс (в этом случае же преобразователь возвращается каждый раз в соответствии с правилами удостоверений COM).

Далее вы увидите `AddRef` или `Release` , указывающее, какой метод был вызван. После этого вы увидите значение, идентифицирующее объект, счетчик ссылок интерфейса был изменен. Трассируется оно **это** указатель объекта.

Счетчик ссылок, это событие регистрируется, является счетчик ссылок на этот преобразователь после `AddRef` или `Release` был вызван. Обратите внимание на то, что этот счетчик ссылок не может соответствовать счетчик ссылок для объекта. Каждый преобразователь поддерживает свой собственный счетчик ссылок, которые помогут полностью соответствовать требованиям, предъявляемым подсчет ссылок COM.

Заключительная часть сведений — это имя объекта и интерфейса, которые затрагивает `AddRef` или `Release` вызова.

Любой интерфейс утечки, которые обнаруживаются, когда сервер выключается и `_Module.Term` вызывается будет регистрироваться следующим образом:

`ATL: QIThunk - 2005         LEAK    :   Object = 0x00d81ca0   Refcount = 1   MaxRefCount = 1   CBug - IBug`

Приведенная здесь информация прямо сопоставляется с сведений, предоставленных в предыдущей инструкции трассировки, чтобы просмотреть количество ссылок на протяжении всего времени существования интерфейс преобразователя. Кроме того вы получаете указывает максимальное количество ссылок на этот интерфейс преобразователя.

> [!NOTE]
> _ATL_DEBUG_INTERFACES может использоваться в окончательных сборках.

##  <a name="_atl_debug_qi"></a>  _ATL_DEBUG_QI

Записывает все вызовы `QueryInterface` в окне вывода.

```
#define _ATL_DEBUG_QI
```

### <a name="remarks"></a>Примечания

Если в вызове `QueryInterface` сбой, будет отображаться в окне вывода:

*Имя интерфейса* - `failed`

##  <a name="atlassert"></a>  ATLASSERT

Макрос ATLASSERT выполняет ту же функциональность, что [_ASSERTE](../../c-runtime-library/reference/assert-asserte-assert-expr-macros.md) макрос, найденный в библиотеке времени выполнения C.

```
ATLASSERT(booleanExpression);
```

### <a name="parameters"></a>Параметры

*booleanExpression*<br/>
Выражение (включая указатели), результат вычисления которого отличен от нуля или равен нулю.

### <a name="remarks"></a>Примечания

В отладочных сборках, вычисляет ATLASSERT *booleanExpression* и создает отчет отладки, в том случае, когда результат равен false.

## <a name="requirements"></a>Требования

**Заголовок:** atldef.h

##  <a name="atlensure"></a>  ATLENSURE

Этот макрос используется для проверки параметров, передаваемых в функцию.

```
ATLENSURE(booleanExpression);
ATLENSURE_THROW(booleanExpression, hr);
```

### <a name="parameters"></a>Параметры

*booleanExpression*<br/>
Указывает логическое выражение, проверяемое.

*hr*<br/>
Указывает код ошибки для возврата.

### <a name="remarks"></a>Примечания

Эти макросы обеспечивают механизм для обнаружения и уведомлять пользователя об использовании неверный параметр.

Макрос вызывает ATLASSERT и если условие не выполняется вызовы `AtlThrow`.

В случае ATLENSURE `AtlThrow` вызывается с E_FAIL.

В случае ATLENSURE_THROW `AtlThrow` вызывается с указанным HRESULT.

Разница между ATLENSURE и ATLASSERT является то, что ATLENSURE возникло исключение в сборках выпуска, а также как и в отладочных сборках.

### <a name="example"></a>Пример

[!code-cpp[NVC_ATL_Utilities#108](../../atl/codesnippet/cpp/debugging-and-error-reporting-macros_1.cpp)]

## <a name="requirements"></a>Требования

**Заголовок:** afx.h

##  <a name="atltracenotimpl"></a>  ATLTRACENOTIMPL

В отладочных сборках библиотеки ATL, отправляет строку " *funcname* не реализован» устройство хранения и возвращает E_NOTIMPL.

```
ATLTRACENOTIMPL(funcname);
```

### <a name="parameters"></a>Параметры

*имя функции*<br/>
[in] Строка, содержащая имя функции, которая не определена.

### <a name="remarks"></a>Примечания

В сборках выпуска просто возвращает E_NOTIMPL.

### <a name="example"></a>Пример

[!code-cpp[NVC_ATL_Utilities#127](../../atl/codesnippet/cpp/debugging-and-error-reporting-macros_2.cpp)]

## <a name="requirements"></a>Требования

**Заголовок:** atltrace.h

##  <a name="atltrace"></a>  ATLTRACE

Предупреждения в устройство вывода, например окна отладчика, в соответствии с указанных флагов и уровней. Включен для обеспечения обратной совместимости.

```
ATLTRACE(exp);

ATLTRACE(
    DWORD category,
    UINT  level,
    LPCSTR lpszFormat, ...);
```

### <a name="parameters"></a>Параметры

*exp*<br/>
[in] Строка и переменные для отправки в окне вывода Visual C++ или любого приложения, который перехватывает эти сообщения.

*category*<br/>
[in] Тип события или метода, на котором в отчет. См. в разделе "Примечания" для списка категорий.

*level*<br/>
[in] Уровень трассировки для отчета. См. в разделе "Примечания" Дополнительные сведения.

*lpszFormat*<br/>
[in] Форматированная строка для отправки на устройство дампа.

### <a name="remarks"></a>Примечания

См. в разделе [ATLTRACE2](#atltrace2) описание ATLTRACE. ATLTRACE и ATLTRACE2 ведут себя так же, ATLTRACE включена для обратной совместимости.

##  <a name="atltrace2"></a>  ATLTRACE2

Предупреждения в устройство вывода, например окна отладчика, в соответствии с указанных флагов и уровней.

```
ATLTRACE2(exp);

ATLTRACE2(
    DWORD category,
    UINT level,
    LPCSTRlpszFormat,  ...);
```

### <a name="parameters"></a>Параметры

*exp*<br/>
[in] Строка, для отправки в окне вывода Visual C++ или любого приложения, который перехватывает эти сообщения.

*category*<br/>
[in] Тип события или метода, на котором в отчет. См. в разделе "Примечания" для списка категорий.

*level*<br/>
[in] Уровень трассировки для отчета. См. в разделе "Примечания" Дополнительные сведения.

*lpszFormat*<br/>
[in] `printf`-Стиля строку формата для использования, чтобы создать строку для отправки на устройство дампа.

### <a name="remarks"></a>Примечания

Краткая форма ATLTRACE2 записывает строку в окно вывода отладчика. Вторая форма ATLTRACE2 также записывает выходные данные в окне вывода отладчика, но зависит от параметров средство трассировки ATL/MFC (см. в разделе [ATLTraceTool выполняется образец](../../visual-cpp-samples.md)). Например, если задать *уровень* 4, и средство трассировки ATL/MFC к уровню 0, не отобразится сообщение. *уровень* может быть 0, 1, 2, 3 или 4. В отчетах по умолчанию, 0, только наиболее серьезные проблемы.

*Категории* флаги трассировки, чтобы задать списки параметров. Эти флаги соответствуют типы методов, для которых необходимо получить отчет. В таблицах ниже перечислены флаги допустимым трассировки, можно использовать для *категории* параметра.

### <a name="atl-trace-flags"></a>Флаги трассировки ATL

|Категории ATL|Описание|
|------------------|-----------------|
|`atlTraceGeneral`|Отчеты на все приложения ATL. По умолчанию.|
|`atlTraceCOM`|Сообщает об методы COM.|
|`atlTraceQI`|Отчеты на вызовы QueryInterface.|
|`atlTraceRegistrar`|Отчеты о регистрации объектов.|
|`atlTraceRefcount`|Отчеты об изменении счетчика ссылок.|
|`atlTraceWindowing`|Отчеты о методах windows; Например выдает идентификатор карты недопустимое сообщение.|
|`atlTraceControls`|Отчеты на элементы управления; Например сообщает, когда элемент управления или его окна уничтожается.|
|`atlTraceHosting`|Отчеты, размещение сообщений; Например отчеты, при активации клиента в контейнере.|
|`atlTraceDBClient`|Отчеты на шаблон потребителя OLE DB; например когда вызов происходит сбой GetData, выходных данных может содержать значение HRESULT.|
|`atlTraceDBProvider`|Отчеты о шаблона поставщика OLE DB. Например отчеты, если не удалось создать столбец.|
|`atlTraceSnapin`|Отчеты для приложения оснастку консоли MMC.|
|`atlTraceNotImpl`|Сообщает, что указанный функция не реализована.|
|`atlTraceAllocation`|Сообщает о печати, памяти, средства отладки в atldbgmem.h сообщения.|

### <a name="mfc-trace-flags"></a>Флаги трассировки MFC

|Категория MFC|Описание|
|------------------|-----------------|
|`traceAppMsg`|Общего назначения сообщения MFC. Рекомендуется всегда использовать.|
|`traceDumpContext`|Сообщения от [CDumpContext](../../mfc/reference/cdumpcontext-class.md).|
|`traceWinMsg`|Сообщения из кода для обработки сообщения MFC.|
|`traceMemory`|Сообщения от кода управления памяти в MFC.|
|`traceCmdRouting`|Сообщения от MFC Windows команда код маршрута.|
|`traceHtml`|Сообщения от службы поддержки диалоговое окно MFC DHTML.|
|`traceSocket`|Сообщения от доступной в MFC поддержки сокета.|
|`traceOle`|Сообщения от службы поддержки MFC OLE.|
|`traceDatabase`|Сообщения от доступной в MFC поддержки базы данных.|
|`traceInternet`|Сообщения от Интернет-поддержку MFC.|

Чтобы объявить категорию пользовательской точки трассировки, объявить глобальный экземпляр `CTraceCategory` следующим образом:

[!code-cpp[NVC_ATL_Utilities#109](../../atl/codesnippet/cpp/debugging-and-error-reporting-macros_3.cpp)]

Имя категории, MY_CATEGORY в этом примере — имя, указываемый для *категории* параметра. Первый параметр — имя категории, которое будет отображаться в средство трассировки ATL/MFC. Второй параметр — уровень трассировки по умолчанию. Этот параметр является необязательным, и уровень трассировки по умолчанию равно 0.

Использование определяемой пользователем категории:

[!code-cpp[NVC_ATL_Utilities#110](../../atl/codesnippet/cpp/debugging-and-error-reporting-macros_4.cpp)]

Чтобы указать, что необходимо для фильтрации сообщений трассировки, вставить определения для этих макросов в файле Stdafx.h до `#include <atlbase.h>` инструкции.

Кроме того, можно задать фильтр в директивы препроцессора в **страницы свойств** диалоговое окно. Нажмите кнопку **препроцессор** вкладке, а затем вставьте глобальный в **определения препроцессора** поле ввода.

Эти определения будут использоваться, если вы не определили эти символы перед обработкой atlbase.h atlbase.h содержит определения default макроса ATLTRACE2

В сборках выпуска ATLTRACE2 компилируется в код `(void) 0`.

ATLTRACE2 ограничивает содержимое строки отправки на устройство хранения не более 1023 символов после форматирования.

ATLTRACE и ATLTRACE2 ведут себя так же, ATLTRACE включена для обратной совместимости.

### <a name="example"></a>Пример

[!code-cpp[NVC_ATL_Utilities#111](../../atl/codesnippet/cpp/debugging-and-error-reporting-macros_5.cpp)]

## <a name="see-also"></a>См. также

[Макросы](../../atl/reference/atl-macros.md)<br/>
[Глобальные функции для отладки и создания отчетов об ошибках](../../atl/reference/debugging-and-error-reporting-global-functions.md)
