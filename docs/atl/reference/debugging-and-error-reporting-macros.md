---
title: Макросы отлады и отчетности об ошибках
ms.date: 05/06/2019
f1_keywords:
- atldef/ATL::_ATL_DEBUG_INTERFACES
- atldef/ATL::_ATL_DEBUG_QI
- atldef/ATL::ATLASSERT
- afx/ATL::ATLENSURE
- atltrace/ATL::ATLTRACENOTIMPL
- atltrace/ATL::ATLTRACE
helpviewer_keywords:
- macros, error reporting
ms.assetid: 4da9b87f-ec5c-4a32-ab93-637780909b9d
ms.openlocfilehash: 69ab6e17bfb1ec85ddb5b8c19c18010a9b4f3df6
ms.sourcegitcommit: c123cc76bb2b6c5cde6f4c425ece420ac733bf70
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81330190"
---
# <a name="debugging-and-error-reporting-macros"></a>Макросы отлады и отчетности об ошибках

Эти макросы обеспечивают полезную отладку и трассировку.

|||
|-|-|
|[_ATL_DEBUG_INTERFACES](#_atl_debug_interfaces)|Записывает, к выходному окну, любые `_Module.Term` утечки интерфейса, которые обнаруживаются, когда вызывается.|
|[_ATL_DEBUG_QI](#_atl_debug_qi)|Записывает все `QueryInterface` вызовы в окно вывода.|
|[АТЛСASSERT](#atlassert)|Выполняет ту же функциональность, что и [_ASSERTE](../../c-runtime-library/reference/assert-asserte-assert-expr-macros.md) макрос, найденный в библиотеке времени выполнения C.|
|[АТЛУСИЕВЕР](#atlensure)|Выполняет проверку параметров. Вызов `AtlThrow` при необходимости|
|[АТЛTRACENOTIMPL](#atltracenotimpl)|Отправляет на устройство свалки сообщение о том, что указанная функция не реализована.|
|[ATLtrace](#atltrace)|Сообщает предупреждения на выходное устройство, например окно отладчика, в соответствии с указанными флагами и уровнями. Включено для обратной совместимости.|
|[ATLTRACE2](#atltrace2)|Сообщает предупреждения на выходное устройство, например окно отладчика, в соответствии с указанными флагами и уровнями.|

## <a name="_atl_debug_interfaces"></a><a name="_atl_debug_interfaces"></a>_ATL_DEBUG_INTERFACES

Определите этот макрос перед включением любых `AddRef` `Release` файлов заголовка ATL для отслеживания всех и вызовов интерфейсов компонентов к выходному окну.

```
#define _ATL_DEBUG_INTERFACES
```

### <a name="remarks"></a>Remarks

Выход трассировки будет отображаться в приведенном ниже виде:

`ATL: QIThunk - 2008         AddRef  :   Object = 0x00d81ba0   Refcount = 1   CBug - IBug`

Первая часть каждого следа `ATL: QIThunk`всегда будет. Далее идет значение, определяющее конкретный *интерфейс thunk* используется. Интерфейс thunk — это объект, используемый для поддержания подсчета ссылок и обеспечения возможности отслеживания, используемой здесь. Новый интерфейс thunk создается `QueryInterface` на каждом вызове, за исключением запросов на `IUnknown` интерфейс (в этом случае, тот же thunk возвращается каждый раз, чтобы соответствовать правилам идентификации COM).

Далее вы `AddRef` увидите или `Release` упомянете, какой метод был вызван. После этого вы увидите значение, определяющее объект, количество ссылок на интерфейс которого было изменено. Прослеживаемый значение является **указателем** объекта.

Отслеженное число отсылок является отсчетом ссылки на то, что thunk после `AddRef` или `Release` был вызван. Обратите внимание, что этот подсчет ссылок может не совпадать с значением отсчета ссылок на объект. Каждый thunk поддерживает свой собственный подсчет ссылок, чтобы помочь вам полностью соответствовать правилам подсчета ссылок COM.

Последней прослеженной частью информации является название объекта `AddRef` `Release` и интерфейс, на который влияет вызов или вызов.

Любые утечки интерфейса, которые обнаруживаются при выключении сервера и `_Module.Term` вызываются, будут зарегистрированы следующим образом:

`ATL: QIThunk - 2005         LEAK    :   Object = 0x00d81ca0   Refcount = 1   MaxRefCount = 1   CBug - IBug`

Информация, представленная здесь, напрямую связана с информацией, представленной в предыдущих показаниях о трассировке, так что вы можете изучить подсчеты ссылок на протяжении всего срока действия интерфейса thunk. Кроме того, вы получаете указание максимального отсчета ссылки на этот интерфейс thunk.

> [!NOTE]
> _ATL_DEBUG_INTERFACES может быть использован в розничных сборках.

## <a name="_atl_debug_qi"></a><a name="_atl_debug_qi"></a>_ATL_DEBUG_QI

Записывает все `QueryInterface` вызовы в окно вывода.

```
#define _ATL_DEBUG_QI
```

### <a name="remarks"></a>Remarks

При `QueryInterface` сбой вызова будет отображаться в выходном окне:

*имя интерфейса* - `failed`

## <a name="atlassert"></a><a name="atlassert"></a>АТЛСASSERT

Макрос ATLASSERT выполняет ту же функциональность, что и [_ASSERTE](../../c-runtime-library/reference/assert-asserte-assert-expr-macros.md) макрос, найденный в библиотеке времени выполнения C.

```
ATLASSERT(booleanExpression);
```

### <a name="parameters"></a>Параметры

*booleanВыражение*<br/>
Выражение (включая указатели), результат вычисления которого отличен от нуля или равен нулю.

### <a name="remarks"></a>Remarks

В отладках сборки ATLASSERT оценивает *booleanExpression* и генерирует отчет об отладке, когда результат является ложным.

## <a name="requirements"></a>Требования

**Заголовок:** atldef.h

## <a name="atlensure"></a><a name="atlensure"></a>АТЛУСИЕВЕР

Этот макрос используется для проверки параметров, переданных функции.

```
ATLENSURE(booleanExpression);
ATLENSURE_THROW(booleanExpression, hr);
```

### <a name="parameters"></a>Параметры

*booleanВыражение*<br/>
Определяет выражение булеана для проверки.

*Hr*<br/>
Уотрежено код ошибки для возврата.

### <a name="remarks"></a>Remarks

Эти макросы обеспечивают механизм обнаружения и уведомления пользователя о неправильном использовании параметров.

Макро вызывает ATLASSERT и если `AtlThrow`условие не удается звонки .

В случае ATLENSURE, `AtlThrow` вызывается с E_FAIL.

В ATLENSURE_THROW случае, `AtlThrow` вызывается с указанным HRESULT.

Разница между ATLENSURE и ATLASSERT заключается в том, что ATLENSURE бросает исключение в сборках выпуска, а также в сборках Debug.

### <a name="example"></a>Пример

[!code-cpp[NVC_ATL_Utilities#108](../../atl/codesnippet/cpp/debugging-and-error-reporting-macros_1.cpp)]

## <a name="requirements"></a>Требования

**Заголовок:** afx.h

## <a name="atltracenotimpl"></a><a name="atltracenotimpl"></a>АТЛTRACENOTIMPL

В отладке сборки ATL, отправляет строку *"funcname* не реализован" на устройство свалки и возвращает E_NOTIMPL.

```
ATLTRACENOTIMPL(funcname);
```

### <a name="parameters"></a>Параметры

*funcname*<br/>
(в) Строка, содержащая название функции, которая не реализована.

### <a name="remarks"></a>Remarks

В релизе строит, просто возвращает E_NOTIMPL.

### <a name="example"></a>Пример

[!code-cpp[NVC_ATL_Utilities#127](../../atl/codesnippet/cpp/debugging-and-error-reporting-macros_2.cpp)]

## <a name="requirements"></a>Требования

**Заголовок:** atltrace.h

## <a name="atltrace"></a><a name="atltrace"></a>ATLtrace

Сообщает предупреждения на выходное устройство, например окно отладчика, в соответствии с указанными флагами и уровнями. Включено для обратной совместимости.

```
ATLTRACE(exp);

ATLTRACE(
    DWORD category,
    UINT  level,
    LPCSTR lpszFormat, ...);
```

### <a name="parameters"></a>Параметры

*Exp*<br/>
(в) Строка и переменные для отправки в окно вывода или любое приложение, которое ловушки этих сообщений.

*Категории*<br/>
(в) Тип события или метод, о котором можно сообщить. Смотрите Примечания для списка категорий.

*Уровень*<br/>
(в) Уровень отслеживания для отчета. Подробности смотрите в комментариях.

*lpszФормат*<br/>
(в) Отформатированная строка для отправки на устройство сброса.

### <a name="remarks"></a>Remarks

[См. ATLTRACE2](#atltrace2) для описания ATLTRACE. ATLTRACE и ATLTRACE2 имеют то же поведение, ATLTRACE включен для обратной совместимости.

## <a name="atltrace2"></a><a name="atltrace2"></a>ATLTrace2

Сообщает предупреждения на выходное устройство, например окно отладчика, в соответствии с указанными флагами и уровнями.

```
ATLTRACE2(exp);

ATLTRACE2(
    DWORD category,
    UINT level,
    LPCSTR lpszFormat,  ...);
```

### <a name="parameters"></a>Параметры

*Exp*<br/>
(в) Строка для отправки в окно вывода или любое приложение, которое ловушки этих сообщений.

*Категории*<br/>
(в) Тип события или метод, о котором можно сообщить. Смотрите Примечания для списка категорий.

*Уровень*<br/>
(в) Уровень отслеживания для отчета. Подробности смотрите в комментариях.

*lpszФормат*<br/>
(в) Строка формата `printf`-стиля, используемая для создания строки для отправки на устройство свалки.

### <a name="remarks"></a>Remarks

Короткая форма ATLTRACE2 записывает строку к выходу окна отладчика. Вторая форма ATLTRACE2 также записывает выход в выходное окно отладчика, но зависит от настроек инструмента ATL/MFC Trace Tool (см. [ATLTraceTool Sample).](../../overview/visual-cpp-samples.md) Например, если вы установите *уровень* до 4 и инструмент ATL/MFC Trace Tool до уровня 0, вы не увидите сообщение. *уровень* может быть 0, 1, 2, 3 или 4. По умолчанию, 0, сообщает только о самых серьезных проблемах.

Параметр *категории* перечисляет флаги трассировки для установки. Эти флаги соответствуют типам методов, о которых вы хотите сообщить. В приведенных ниже таблицах указаны допустимые флаги трассировки, которые можно использовать для параметра *категории.*

### <a name="atl-trace-flags"></a>Флаги ATL Trace

|Категория ATL|Описание|
|------------------|-----------------|
|`atlTraceGeneral`|Отчеты по всем приложениям ATL. По умолчанию.|
|`atlTraceCOM`|Отчеты о методах COM.|
|`atlTraceQI`|Отчеты о вызовах queryInterface.|
|`atlTraceRegistrar`|Отчеты о регистрации объектов.|
|`atlTraceRefcount`|Отчеты об изменении количества ссылок.|
|`atlTraceWindowing`|Отчеты о методах windows; например, сообщает об идентификаторе карты недействительных сообщений.|
|`atlTraceControls`|Отчеты о контроле; например, отчеты о разрушении элемента управления или его окна.|
|`atlTraceHosting`|Отчеты, размещающие сообщения; например, отчеты о том, когда клиент в контейнере активирован.|
|`atlTraceDBClient`|Отчеты по шаблону для потребителей OLE DB; например, когда вызов GetData не справляется, вывод может содержать HRESULT.|
|`atlTraceDBProvider`|Отчеты по шаблону поставщика УСЛУГ OLE DB; например, отчеты о недоумении создания столбца.|
|`atlTraceSnapin`|Отчеты для приложения MMC SnapIn.|
|`atlTraceNotImpl`|Сообщает, что указанная функция не выполняется.|
|`atlTraceAllocation`|Отчеты о сообщениях, напечатанных инструментами отладки памяти в atldbgmem.h.|

### <a name="mfc-trace-flags"></a>Флаги MFC Trace

|Категория МФЦ|Описание|
|------------------|-----------------|
|`traceAppMsg`|Общее назначение, сообщения МФЦ. Всегда рекомендуется.|
|`traceDumpContext`|Сообщения от [CDumpContext](../../mfc/reference/cdumpcontext-class.md).|
|`traceWinMsg`|Сообщения из кода обработки сообщений MFC.|
|`traceMemory`|Сообщения из кода управления памятью MFC.|
|`traceCmdRouting`|Сообщения из кода командной раминей MFC в Windows.|
|`traceHtml`|Сообщения из службы dHTML-группы MFC.|
|`traceSocket`|Сообщения от поддержки розетки MFC.|
|`traceOle`|Сообщения от поддержки OLE МФЦ.|
|`traceDatabase`|Сообщения из службы базы данных МФЦ.|
|`traceInternet`|Сообщения из интернет-поддержки МФЦ.|

Чтобы объявить категорию пользовательских следов, `CTraceCategory` объявить глобальный экземпляр класса следующим образом:

[!code-cpp[NVC_ATL_Utilities#109](../../atl/codesnippet/cpp/debugging-and-error-reporting-macros_3.cpp)]

Имя категории, MY_CATEGORY в данном примере, — это имя, указанное параметром *категории.* Первым параметром является название категории, которое появится в инструменте ATL/MFC Trace Tool. Вторым параметром является уровень трассировки по умолчанию. Этот параметр неявляется, а уровень трассировки по умолчанию радо 0.

Для использования категории, определяемой пользователем:

[!code-cpp[NVC_ATL_Utilities#110](../../atl/codesnippet/cpp/debugging-and-error-reporting-macros_4.cpp)]

Чтобы указать, что необходимо отфильтровать микросообщения, вставьте определения для этих `#include <atlbase.h>` макросов в Stdafx.h перед заявлением.

Кроме того, можно установить фильтр в предпроцессорных директивах в диалоговом поле **Страниц свойств.** Нажмите на вкладку **Preprocessor,** а затем вставьте глобальное в окно отсвасывания **предварительных определений.**

Atlbase.h содержит определения макросов ATLTRACE2 по умолчанию, и эти определения будут использоваться, если вы не определите эти символы до обработки atlbase.h.

В сборке релиза ATLTRACE2 `(void) 0`компилирует ся.

ATLTRACE2 ограничивает содержимое строки, отправленной на устройство свалки, не более чем 1023 символами после форматирования.

ATLTRACE и ATLTRACE2 имеют то же поведение, ATLTRACE включен для обратной совместимости.

### <a name="example"></a>Пример

[!code-cpp[NVC_ATL_Utilities#111](../../atl/codesnippet/cpp/debugging-and-error-reporting-macros_5.cpp)]

## <a name="see-also"></a>См. также раздел

[Макросы](../../atl/reference/atl-macros.md)<br/>
[Отладка и отчетность об ошибках глобальных функций](../../atl/reference/debugging-and-error-reporting-global-functions.md)
