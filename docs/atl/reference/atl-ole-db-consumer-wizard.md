---
title: Мастер потребителя ATL OLE DB
ms.date: 05/09/2019
helpviewer_keywords:
- ATL projects, adding ATL OLE DB consumers
ms.assetid: dcb68ed1-2224-422f-9f7b-108a74864204
ms.openlocfilehash: bd7af5c9788f5075f38f85bd035ba8cd09e8baec
ms.sourcegitcommit: fc1de63a39f7fcbfe2234e3f372b5e1c6a286087
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/15/2019
ms.locfileid: "65706997"
---
# <a name="atl-ole-db-consumer-wizard"></a>Мастер потребителя ATL OLE DB

::: moniker range="vs-2019"

Этот мастер недоступен в Visual Studio 2019 и более поздних версиях.

::: moniker-end

::: moniker range="<=vs-2017"

Этот мастер настраивает класс объекта-получателя OLE DB с помощью привязок данных, необходимых для доступа к указанному источнику данных через указанный поставщик OLE DB.

> [!NOTE]
> Для этого мастера необходимо нажать кнопку **Источник данных** и выбрать источник данных перед вводом имен в поля `Class` и **H-файл**.

## <a name="uielement-list"></a>Список элементов пользовательского интерфейса

- **Источник данных**

   С помощью кнопки **Источник данных** можно настроить указанный источник данных, используя указанный поставщик OLE DB. При нажатии этой кнопки появится диалоговое окно **Свойства канала передачи данных**. Дополнительные сведения о построении строк подключения и диалоговом окне **Свойства канала передачи данных** см. [в обзоре API канала передачи данных](/previous-versions/windows/desktop/ms718102) в документации по Windows SDK.

   В следующих дополнительных сведениях описаны вкладки в диалоговом окне **Свойства канала передачи данных**.

   - Вкладка **Поставщик**

      Выберите подходящего поставщика, чтобы управлять подключением к источнику данных. Тип поставщика обычно определяется типом базы данных, к которой выполняется подключение. Нажмите кнопку **Далее** или щелкните вкладку **Соединение**.

   - Вкладка **Соединение**

      Содержимое этой вкладки зависит от выбранного поставщика. Хотя существует много типов поставщиков, в этом разделе рассматриваются соединения для двух наиболее распространенных: данные SQL и ODBC. Другие типы аналогичны вариантам полей, описанных здесь.

      Для данных SQL:

      1. **Select or enter a server name** (Выберите или введите имя сервера). Щелкните меню раскрывающегося списка, чтобы отобразить все зарегистрированные серверы данных в сети, и выберите один.

      1. **Enter information to log on to the server** (Введите данные для входа на сервер). Введите имя пользователя и пароль, чтобы войти на сервер данных.

         > [!NOTE]
         > Имеется проблема безопасности с функцией "Разрешить сохранение пароля" диалогового окна "Свойства канала передачи данных". В области Enter information to log on to the server (Введите данные для входа на сервер) есть два переключателя:
         >
         > - **Использовать встроенную систему безопасности Windows NT**.
         > - **Использование указанных имени пользователя и пароля**.
         >
         > Если вы выберете **Использование указанных имени пользователя и пароля**, появится возможность сохранить пароль (с помощью флажка "Разрешить сохранение пароля"); тем не менее, этот параметр небезопасен. Мы советуем выбрать **Использовать встроенную систему безопасности Windows NT**; этот параметр безопасен, так как он шифрует пароль.
         > Могут возникнуть ситуации, в которых необходимо выбрать "Разрешить сохранение пароля". Например, если вы выпускаете библиотеку с решением частной базы данных, не следует напрямую получать доступ к базе данных, вместо этого необходимо использовать приложение промежуточного уровня, чтобы проверить пользователя (с помощью любой выбранной схемы проверки подлинности), а затем ограничить данные, доступные для пользователя.

      1. **Select the database on the server** (Выберите базу данных на сервере). Щелкните меню раскрывающегося списка, чтобы отобразить все зарегистрированные базы данных на сервере данных, и выберите одну.

         \- или -

         **Attach a database file as a database name** (Присоедините файл базы данных в качестве имени базы данных). Укажите файл для использования в качестве базы данных и введите явный путь.

      Для данных ODBC:

      1. **Specify the source of data** (Укажите источник данных). Вы можете использовать имя источника данных или строки подключения.

         **Использовать имя источника данных**. В этом раскрывающемся списке отображаются источники данных, зарегистрированных на компьютере. Вы можете заранее настроить источники данных, используя администратор источника данных ODBC

         \- или -

         **Использовать строку подключения**. Введите уже полученную строку подключения или нажмите кнопку **Сборка**; появится диалоговое окно **Выбор источника данных**. Выберите файл или источник данных компьютера и щелкните **OК**.

         > [!NOTE]
         > Строку подключения можно получить, просмотрев свойства имеющегося подключения в **обозревателе сервера**, или можно создать подключение, дважды щелкнув **Добавить подключение** в **обозревателе сервера**.

      1. **Enter information to log on to the server** (Введите данные для входа на сервер). Введите имя пользователя и пароль, чтобы войти на сервер данных.

      1. Введите исходный каталог для использования.

      1. Щелкните **Проверить подключение**; если проверка пройдет успешно, щелкните **ОК**. Если нет, проверьте данные для входа, попробуйте использовать другую базу данных или другой сервер данных.

   - Вкладка **Дополнительно**

      **Параметры сети**. Укажите **уровень олицетворения** (уровень, который сервер может использовать при олицетворении клиента; соответствует уровням олицетворения RPC) и **уровень защиты** (уровень защиты данных, переданных между клиентом и сервером; соответствует уровням защиты RPC).

      **Другое.** В поле **Время ожидания подключения** укажите количество секунд разрешенного времени простоя до истечения времени ожидания. В поле **Права доступа** укажите права доступа к подключению к базе данных.

      Дополнительные сведения о свойствах инициализации см. в документации к каждому определенному поставщику OLE DB.

   - Вкладка **Все**

      На этой вкладке отображается сводка свойств инициализации для источника данных и указанное подключение. Вы можете изменить эти значения.

      Щелкните **ОК** для завершения. Появится диалоговое окно **Выберите объект базы данных**. В диалоговом окне выберите таблицу, представление или хранимую процедуру, которую будет использовать объект-получатель.

- **Класс**

   После выбора источника данных это поле заполнится именем класса по умолчанию на основе выбранной таблицы или хранимой процедуры (см. **Выбор источника данных** ниже). Вы можете изменить имя класса.

- **H-файл**

   После выбора источника данных это поле заполнится именем класса заголовка по умолчанию на основе выбранной таблицы или хранимой процедуры (см. **Выбор источника данных** ниже). Вы можете изменить имя файла заголовка или выбрать имеющийся файл заголовка.

- **Attributed** (С атрибутами)

   Этот параметр определяет, будет ли мастер создавать классы объектов-получателей, используя атрибуты или объявления шаблона. При выборе этого параметра мастер использует атрибуты вместо объявлений шаблона (это параметр по умолчанию). При отмененном параметре мастер использует объявления шаблона вместо атрибутов.

   - Если вы выберете **тип** объекта-получателя из **таблицы**, мастер использует атрибуты `db_source` и `db_table`, чтобы создать объявления классов таблицы и метода доступа таблицы, и использует `db_column`, чтобы создать сопоставление столбцов. Например, он создает это сопоставление:

        ```cpp
        // Inject table class and table accessor class declarations
        [db_source("<initialization_string>"), db_table("dbo.Orders")]
        ...
        // Column map
        [ db_column(1, status=m_dwOrderIDStatus, length=m_dwOrderIDLength) ] LONG m_OrderID;
        [ db_column(2, status=m_dwCustomerIDStatus, length=m_dwCustomerIDLength) ] TCHAR m_CustomerID[6];
        ...
        ```

      вместо использования класса шаблона `CTable`, чтобы объявить класс таблицы и метода доступа таблицы, и макросов BEGIN_COLUMN_MAP и END_COLUMN_MAP, чтобы создать сопоставление столбцов, как показано в этом примере:

        ```cpp
        // Table accessor class
            class COrdersAccessor; // Table class
            class COrders : public CTable<CAccessor<COrdersAccessor>>;
        // ...
        // Column map
            BEGIN_COLUMN_MAP(COrderDetailsAccessor)
                COLUMN_ENTRY_LENGTH_STATUS(1, m_OrderID, m_dwOrderIDLength, m_dwOrderIDStatus)
                COLUMN_ENTRY_LENGTH_STATUS(2, m_CustomerID, m_dwCustomerIDLength, m_dwCustomerIDStatus)
                // ...
            END_COLUMN_MAP()
        ```

   - Если вы выберете **тип** объекта-получателя из **команды**, мастер использует атрибуты `db_source` и `db_command` и применит `db_column`, чтобы создать сопоставление столбцов. Например, он создает это сопоставление:

        ```cpp
        [db_source("<initialization_string>"), db_command("SQL_command")]
        ...
        // Column map using db_column is the same as for consumer type of 'table'
        ```

      вместо использования объявлений класса команды и метода доступа команды в H-файле класса, например:

        ```cpp
        // Command accessor class:
            class CListOrdersAccessor;
        // Command class:
            class CListOrders : public CCommand<CAccessor<CListOrdersAccessor>>;
        // ...
        // Column map using BEGIN_COLUMN_MAP ... END_COLUMN_MAP is the same as
        // for consumer type of 'table'
        ```

      Дополнительные сведения см. в статье [C++ Attributes for COM and .NET](../../windows/basic-mechanics-of-attributes.md) (Атрибуты C++ для COM и .NET).

- **Type**

   Выберите один из этих переключателей, чтобы указать, будет ли класс объекта-получателя производным от `CTable` или `CCommand` (по умолчанию).

   - **Таблица**

      Выберите этот параметр, если вы хотите использовать `CTable` или `db_table`, чтобы создать объявления класса таблицы и метода доступа таблицы.

   - **Команда**

      Выберите этот параметр, если вы хотите использовать `CCommand` или `db_command`, чтобы создать объявления класса команды и метода доступа команды. Это выбор по умолчанию.

- **Поддержка**

   Установите флажки, чтобы указать типы обновлений, которые должны поддерживаться в объекте-получателе (по умолчанию не используется). Каждое из перечисленных ниже задаст [DBPROP_IRowsetChange](/previous-versions/windows/desktop/ms715892) и соответствующие записи для [DBPROP_UPDATABILITY](/previous-versions/windows/desktop/ms722676) в сопоставлении набора свойств.

   - **Изменение**

      Указывает, что объект-получатель поддерживает обновления данных строки в наборе строк.

   - **Вставить**

      Указывает, что объект-получатель поддерживает вставку записей в наборе строк.

   - **Удалить**

      Указывает, что объект-получатель поддерживает удаление записей из набора строк.

::: moniker-end

## <a name="see-also"></a>См. также

[Adding an ATL OLE DB Consumer](../../atl/reference/adding-an-atl-ole-db-consumer.md) (Добавление объекта-получателя ATL OLE DB)<br/>
[Добавление функциональных возможностей с помощью мастеров кода](../../ide/adding-functionality-with-code-wizards-cpp.md)<br/>
[Connection Strings and Data Links (OLE DB)](/previous-versions/windows/desktop/ms718376) (Строки подключения и каналы передачи данных (OLE DB))
