---
description: 'Дополнительные сведения о: сбой CRegKey Class'
title: Класс сбой CRegKey
ms.date: 11/04/2016
f1_keywords:
- CRegKey
- ATLBASE/ATL::CRegKey
- ATLBASE/ATL::CRegKey::CRegKey
- ATLBASE/ATL::CRegKey::Attach
- ATLBASE/ATL::CRegKey::Close
- ATLBASE/ATL::CRegKey::Create
- ATLBASE/ATL::CRegKey::DeleteSubKey
- ATLBASE/ATL::CRegKey::DeleteValue
- ATLBASE/ATL::CRegKey::Detach
- ATLBASE/ATL::CRegKey::EnumKey
- ATLBASE/ATL::CRegKey::Flush
- ATLBASE/ATL::CRegKey::GetKeySecurity
- ATLBASE/ATL::CRegKey::NotifyChangeKeyValue
- ATLBASE/ATL::CRegKey::Open
- ATLBASE/ATL::CRegKey::QueryBinaryValue
- ATLBASE/ATL::CRegKey::QueryDWORDValue
- ATLBASE/ATL::CRegKey::QueryGUIDValue
- ATLBASE/ATL::CRegKey::QueryMultiStringValue
- ATLBASE/ATL::CRegKey::QueryQWORDValue
- ATLBASE/ATL::CRegKey::QueryStringValue
- ATLBASE/ATL::CRegKey::QueryValue
- ATLBASE/ATL::CRegKey::RecurseDeleteKey
- ATLBASE/ATL::CRegKey::SetBinaryValue
- ATLBASE/ATL::CRegKey::SetDWORDValue
- ATLBASE/ATL::CRegKey::SetGUIDValue
- ATLBASE/ATL::CRegKey::SetKeySecurity
- ATLBASE/ATL::CRegKey::SetKeyValue
- ATLBASE/ATL::CRegKey::SetMultiStringValue
- ATLBASE/ATL::CRegKey::SetQWORDValue
- ATLBASE/ATL::CRegKey::SetStringValue
- ATLBASE/ATL::CRegKey::SetValue
- ATLBASE/ATL::CRegKey::m_hKey
- ATLBASE/ATL::CRegKey::m_pTM
helpviewer_keywords:
- CRegKey class
- ATL, registry
- registry, deleting values
- registry, writing to
- registry, deleting keys
ms.assetid: 3afce82b-ba2c-4c1a-8404-dc969e1af74b
ms.openlocfilehash: f95a4f165d2d2d3d964c74c0c2c07db7a03e6fb3
ms.sourcegitcommit: d6af41e42699628c3e2e6063ec7b03931a49a098
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2020
ms.locfileid: "97140872"
---
# <a name="cregkey-class"></a>Класс сбой CRegKey

Этот класс предоставляет методы для управления записями в системном реестре.

> [!IMPORTANT]
> Этот класс и его члены не могут использоваться в приложениях, выполняемых в среда выполнения Windows.

## <a name="syntax"></a>Синтаксис

```
class CRegKey
```

## <a name="members"></a>Члены

### <a name="public-constructors"></a>Открытые конструкторы

|name|Описание|
|----------|-----------------|
|[Сбой CRegKey:: сбой CRegKey](#cregkey)|Конструктор.|
|[Сбой CRegKey:: ~ сбой CRegKey](#dtor)|Деструктор|

### <a name="public-methods"></a>Открытые методы

|name|Описание|
|----------|-----------------|
|[Сбой CRegKey:: Attach](#attach)|Вызовите этот метод, чтобы присоединить HKEY к `CRegKey` объекту, установив для [m_hKeyного](#m_hkey) маркера элемента значение `hKey` .|
|[Сбой CRegKey:: Close](#close)|Вызовите этот метод, чтобы освободить [m_hKeyный](#m_hkey) маркер элемента и присвоить ему значение null.|
|[Сбой CRegKey:: Create](#create)|Вызовите этот метод, чтобы создать указанный ключ, если он не существует в качестве подраздела `hKeyParent` .|
|[Сбой CRegKey::D Елетесубкэй](#deletesubkey)|Вызовите этот метод, чтобы удалить указанный ключ из реестра.|
|[Сбой CRegKey::D Елетевалуе](#deletevalue)|Вызовите этот метод, чтобы удалить поле значения из [m_hKey](#m_hkey).|
|[Сбой CRegKey::D етач](#detach)|Вызовите этот метод, чтобы отсоединить [m_hKeyный](#m_hkey) маркер элемента от `CRegKey` объекта и установить для него значение `m_hKey` null.|
|[Сбой CRegKey:: Енумкэй](#enumkey)|Вызовите этот метод, чтобы перечислить подразделы открытого раздела реестра.|
|[Сбой CRegKey:: Flush](#flush)|Вызовите этот метод, чтобы записать все атрибуты открытого раздела реестра в реестр.|
|[Сбой CRegKey:: Жеткэйсекурити](#getkeysecurity)|Вызовите этот метод, чтобы получить копию дескриптора безопасности, защищающего раздел Open реестра.|
|[Сбой CRegKey:: Нотифичанжекэйвалуе](#notifychangekeyvalue)|Этот метод уведомляет вызывающий объект об изменениях атрибутов или содержимого открытого раздела реестра.|
|[Сбой CRegKey:: Open](#open)|Вызовите этот метод, чтобы открыть указанный ключ и присвоить [m_hKey](#m_hkey) маркеру этого ключа.|
|[Сбой CRegKey:: Куерибинаривалуе](#querybinaryvalue)|Вызовите этот метод, чтобы получить двоичные данные для указанного имени значения.|
|[Сбой CRegKey:: Куеридвордвалуе](#querydwordvalue)|Вызовите этот метод, чтобы получить данные типа DWORD для указанного имени значения.|
|[Сбой CRegKey:: Куеригуидвалуе](#queryguidvalue)|Вызовите этот метод, чтобы получить данные GUID для указанного имени значения.|
|[Сбой CRegKey:: Куеримултистрингвалуе](#querymultistringvalue)|Вызовите этот метод, чтобы получить многострочные данные для указанного имени значения.|
|[Сбой CRegKey:: Куериквордвалуе](#queryqwordvalue)|Вызовите этот метод, чтобы получить данные типа QWORD для указанного имени значения.|
|[Сбой CRegKey:: Куеристрингвалуе](#querystringvalue)|Вызовите этот метод, чтобы получить строковые данные для указанного имени значения.|
|[Сбой CRegKey:: Куеривалуе](#queryvalue)|Вызовите этот метод, чтобы получить данные для указанного поля значения [m_hKey](#m_hkey). Более ранние версии этого метода больше не поддерживаются и помечаются как ATL_DEPRECATED.|
|[Сбой CRegKey:: Рекурседелетекэй](#recursedeletekey)|Вызовите этот метод, чтобы удалить указанный ключ из реестра и явным образом удалить все подразделы.|
|[Сбой CRegKey:: Сетбинаривалуе](#setbinaryvalue)|Вызовите этот метод, чтобы задать двоичное значение раздела реестра.|
|[Сбой CRegKey:: Сетдвордвалуе](#setdwordvalue)|Вызовите этот метод, чтобы задать значение DWORD раздела реестра.|
|[Сбой CRegKey:: Сетгуидвалуе](#setguidvalue)|Вызовите этот метод, чтобы задать значение GUID для раздела реестра.|
|[Сбой CRegKey:: Сеткэйсекурити](#setkeysecurity)|Вызовите этот метод, чтобы задать параметры безопасности для раздела реестра.|
|[Сбой CRegKey:: Сеткэйвалуе](#setkeyvalue)|Вызывайте этот метод для хранения данных в указанном поле значения указанного ключа.|
|[Сбой CRegKey:: Сетмултистрингвалуе](#setmultistringvalue)|Вызовите этот метод, чтобы задать многострочное значение раздела реестра.|
|[Сбой CRegKey:: Сетквордвалуе](#setqwordvalue)|Вызовите этот метод, чтобы задать значение QWORD раздела реестра.|
|[Сбой CRegKey:: SetStringValue](#setstringvalue)|Вызовите этот метод, чтобы задать строковое значение раздела реестра.|
|[Сбой CRegKey:: SetValue](#setvalue)|Вызывайте этот метод для хранения данных в поле указанного значения [m_hKey](#m_hkey). Более ранние версии этого метода больше не поддерживаются и помечаются как ATL_DEPRECATED.|

### <a name="public-operators"></a>Открытые операторы

|Имя|Описание|
|----------|-----------------|
|[Сбой CRegKey:: operator HKEY](#operator_hkey)|Преобразует `CRegKey` объект в hKey.|
|[Сбой CRegKey:: operator =](#operator_eq)|Оператор присвоения.|

### <a name="public-data-members"></a>Открытые члены данных

|Имя|Описание|
|----------|-----------------|
|[Сбой CRegKey:: m_hKey](#m_hkey)|Содержит маркер раздела реестра, связанного с `CRegKey` объектом.|
|[Сбой CRegKey:: m_pTM](#m_ptm)|Указатель на `CAtlTransactionManager` объект|

## <a name="remarks"></a>Комментарии

`CRegKey` предоставляет методы для создания и удаления ключей и значений в системном реестре. Реестр содержит набор определений для системных компонентов, например номера версий программного обеспечения, сопоставления логических и физических устройств установленного оборудования и COM-объекты.

`CRegKey` предоставляет программный интерфейс для системного реестра на данном компьютере. Например, чтобы открыть определенный раздел реестра, вызовите `CRegKey::Open` . Чтобы получить или изменить значение данных, вызовите `CRegKey::QueryValue` или `CRegKey::SetValue` соответственно. Чтобы закрыть ключ, вызовите `CRegKey::Close` .

При закрытии ключа данные реестра записываются (сбрасываются) на жесткий диск. Этот процесс может занять несколько секунд. Если приложение должно явно записать данные реестра на жесткий диск, можно вызвать функцию Win32 [функция RegFlushKey вернула](/windows/win32/api/winreg/nf-winreg-regflushkey) . Однако `RegFlushKey` использует много системных ресурсов, и его следует вызывать только при крайней необходимости.

> [!IMPORTANT]
> Все методы, позволяющие вызывающему объекту указать расположение реестра, могут считывать данные, которые не могут быть доверенными. Методы, использующие [процедура RegQueryValueEx](/windows/win32/api/winreg/nf-winreg-regqueryvalueexw) , должны учитывать, что эта функция явно не обрабатывает строки, которые завершаются нулем. Оба условия должны проверяться вызывающим кодом.

## <a name="requirements"></a>Требования

**Заголовок:** atlbase. h

## <a name="cregkeyattach"></a><a name="attach"></a> Сбой CRegKey:: Attach

Вызовите этот метод, чтобы присоединить HKEY к `CRegKey` объекту, установив для [m_hKeyного](#m_hkey) маркера элемента значение *hKey*.

```cpp
void Attach(HKEY hKey) throw();
```

### <a name="parameters"></a>Параметры

*hKey*<br/>
Маркер раздела реестра.

### <a name="remarks"></a>Комментарии

`Attach` будет утверждать, если `m_hKey` имеет значение, отличное от NULL.

## <a name="cregkeyclose"></a><a name="close"></a> Сбой CRegKey:: Close

Вызовите этот метод, чтобы освободить [m_hKeyный](#m_hkey) маркер элемента и присвоить ему значение null.

```
LONG Close() throw();
```

### <a name="return-value"></a>Возвращаемое значение

В случае успеха возвращает ERROR_SUCCESS; в противном случае возвращает значение ошибки.

## <a name="cregkeycreate"></a><a name="create"></a> Сбой CRegKey:: Create

Вызовите этот метод, чтобы создать указанный ключ, если он не существует в качестве подраздела *хкэйпарент*.

```
LONG Create(
    HKEY hKeyParent,
    LPCTSTR lpszKeyName,
    LPTSTR lpszClass = REG_NONE,
    DWORD dwOptions = REG_OPTION_NON_VOLATILE,
    REGSAM samDesired = KEY_READ | KEY_WRITE,
    LPSECURITY_ATTRIBUTES lpSecAttr = NULL,
    LPDWORD lpdwDisposition = NULL) throw();
```

### <a name="parameters"></a>Параметры

*хкэйпарент*<br/>
Маркер открытого ключа.

*лпсзкэйнаме*<br/>
Указывает имя создаваемого или открываемого ключа. Это имя должно быть подразделом *хкэйпарент*.

*лпсзкласс*<br/>
Указывает класс создаваемого или открываемого ключа. Значение по умолчанию — REG_NONE.

*двоптионс*<br/>
Параметры для ключа. Значение по умолчанию — REG_OPTION_NON_VOLATILE. Список возможных значений и описаний см. в разделе [регкреатекэйекс](/windows/win32/api/winreg/nf-winreg-regcreatekeyexw) в Windows SDK.

*самдесиред*<br/>
Защищенный доступ для ключа. Значение по умолчанию — KEY_READ &#124; KEY_WRITE. Список возможных значений и описаний см. в разделе `RegCreateKeyEx` .

*лпсекаттр*<br/>
Указатель на структуру [SECURITY_ATTRIBUTES](/previous-versions/windows/desktop/legacy/aa379560\(v=vs.85\)) , которая указывает, может ли маркер ключа наследоваться дочерним процессом. По умолчанию этот параметр имеет значение NULL (это означает, что маркер не может быть унаследован).

*лпдвдиспоситион*<br/>
заполняет Если значение не равно NULL, извлекает либо REG_CREATED_NEW_KEY (если ключ не существовал и был создан), либо REG_OPENED_EXISTING_KEY (если ключ существовал и был открыт).

### <a name="return-value"></a>Возвращаемое значение

В случае успеха возвращает ERROR_SUCCESS и открывает ключ. Если метод завершается ошибкой, возвращаемое значение является ненулевым кодом ошибки, определенным в файле WINERROR. H.

### <a name="remarks"></a>Комментарии

`Create` Задает для элемента [m_hKey](#m_hkey) маркер этого ключа.

## <a name="cregkeycregkey"></a><a name="cregkey"></a> Сбой CRegKey:: сбой CRegKey

Конструктор.

```
CRegKey() throw();
CRegKey(CRegKey& key) throw();
explicit CRegKey(HKEY hKey) throw();
CRegKey(CAtlTransactionManager* pTM) throw();
```

### <a name="parameters"></a>Параметры

*key*<br/>
Ссылка на объект `CRegKey`.

*hKey*<br/>
Маркер раздела реестра.

*pTM*<br/>
Указатель на объект CAtlTransactionManager.

### <a name="remarks"></a>Комментарии

Создает новый объект `CRegKey`. Объект может быть создан из существующего `CRegKey` объекта или из маркера в раздел реестра.

## <a name="cregkeycregkey"></a><a name="dtor"></a> Сбой CRegKey:: ~ сбой CRegKey

Деструктор

```
~CRegKey() throw();
```

### <a name="remarks"></a>Комментарии

Выпуски деструктора `m_hKey` .

## <a name="cregkeydeletesubkey"></a><a name="deletesubkey"></a> Сбой CRegKey::D Елетесубкэй

Вызовите этот метод, чтобы удалить указанный ключ из реестра.

```
LONG DeleteSubKey(LPCTSTR lpszSubKey) throw();
```

### <a name="parameters"></a>Параметры

*лпсзсубкэй*<br/>
Задает имя удаляемого ключа. Это имя должно быть подразделом [m_hKey](#m_hkey).

### <a name="return-value"></a>Возвращаемое значение

В случае успеха возвращает ERROR_SUCCESS. Если метод завершается ошибкой, возвращаемое значение является ненулевым кодом ошибки, определенным в файле WINERROR. H.

### <a name="remarks"></a>Комментарии

`DeleteSubKey` можно удалить только ключ, который не содержит подразделов. Если ключ содержит подразделы, вместо него следует вызывать [рекурседелетекэй](#recursedeletekey) .

## <a name="cregkeydeletevalue"></a><a name="deletevalue"></a> Сбой CRegKey::D Елетевалуе

Вызовите этот метод, чтобы удалить поле значения из [m_hKey](#m_hkey).

```
LONG DeleteValue(LPCTSTR lpszValue) throw();
```

### <a name="parameters"></a>Параметры

*лпсзвалуе*<br/>
Указывает поле значения для удаления.

### <a name="return-value"></a>Возвращаемое значение

В случае успеха возвращает ERROR_SUCCESS. Если метод завершается ошибкой, возвращаемое значение является ненулевым кодом ошибки, определенным в файле WINERROR. H.

## <a name="cregkeydetach"></a><a name="detach"></a> Сбой CRegKey::D етач

Вызовите этот метод, чтобы отсоединить [m_hKeyный](#m_hkey) маркер элемента от `CRegKey` объекта и установить для него значение `m_hKey` null.

```
HKEY Detach() throw();
```

### <a name="return-value"></a>Возвращаемое значение

HKEY, связанный с `CRegKey` объектом.

## <a name="cregkeyenumkey"></a><a name="enumkey"></a> Сбой CRegKey:: Енумкэй

Вызовите этот метод, чтобы перечислить подразделы открытого раздела реестра.

```
LONG EnumKey(
    DWORD iIndex,
    LPTSTR pszName,
    LPDWORD pnNameLength,
    FILETIME* pftLastWriteTime = NULL) throw();
```

### <a name="parameters"></a>Параметры

*ииндекс*<br/>
Индекс подраздела. Этот параметр должен быть равен нулю для первого вызова, а затем увеличиваться для последующих вызовов.

*pszName*<br/>
Указатель на буфер, который получает имя подраздела, включая завершающий нуль-символ. Только имя подраздела копируется в буфер, а не в полную иерархию ключей.

*пннамеленгс*<br/>
Указатель на переменную, указывающую размер (в Тчарс) буфера, указанного параметром *pszName* . Этот размер должен включать завершающий нуль символ. Когда метод возвращает значение, переменная, на которую указывает *пннамеленгс* , содержит количество символов, хранящихся в буфере. Возвращенное число не содержит завершающего нуль символа.

*пфтластвритетиме*<br/>
Указатель на переменную, которая получает время последней запись перечисленного подраздела.

### <a name="return-value"></a>Возвращаемое значение

Если метод завершился удачно, возвращается значение ERROR_SUCCESS. Если метод завершается ошибкой, возвращаемое значение является ненулевым кодом ошибки, определенным в файле WINERROR. H.

### <a name="remarks"></a>Комментарии

Чтобы перечислить подразделы, вызовите `CRegKey::EnumKey` с нулевым индексом. Увеличьте значение индекса и повторяйте, пока метод не возвратит ERROR_NO_MORE_ITEMS. Дополнительные сведения см. в разделе [реженумкэйекс](/windows/win32/api/winreg/nf-winreg-regenumkeyexw) в Windows SDK.

## <a name="cregkeyflush"></a><a name="flush"></a> Сбой CRegKey:: Flush

Вызовите этот метод, чтобы записать все атрибуты открытого раздела реестра в реестр.

```
LONG Flush() throw();
```

### <a name="return-value"></a>Возвращаемое значение

Если метод завершился удачно, возвращается значение ERROR_SUCCESS. Если метод завершается ошибкой, возвращаемое значение является ненулевым кодом ошибки, определенным в файле WINERROR. H.

### <a name="remarks"></a>Комментарии

Дополнительные сведения см. в разделе [реженумфлуш](/windows/win32/api/winreg/nf-winreg-regflushkey) в Windows SDK.

## <a name="cregkeygetkeysecurity"></a><a name="getkeysecurity"></a> Сбой CRegKey:: Жеткэйсекурити

Вызовите этот метод, чтобы получить копию дескриптора безопасности, защищающего раздел Open реестра.

```
LONG GetKeySecurity(
    SECURITY_INFORMATION si,
    PSECURITY_DESCRIPTOR psd,
    LPDWORD pnBytes) throw();
```

### <a name="parameters"></a>Параметры

*si*<br/>
Значение [SECURITY_INFORMATION](/windows/win32/SecAuthZ/security-information) , указывающее запрошенные сведения о безопасности.

*формате*<br/>
Указатель на буфер, который получает копию запрошенного дескриптора безопасности.

*пнбитес*<br/>
Размер (в байтах) буфера, на который указывает *PSD*.

### <a name="return-value"></a>Возвращаемое значение

Если метод завершился удачно, возвращается значение ERROR_SUCCESS. Если метод завершается ошибкой, возвращаемое значение является ненулевым кодом ошибки, определенным в файле WINERROR. H.

### <a name="remarks"></a>Комментарии

Дополнительные сведения см. в разделе [регжеткэйсекурити](/windows/win32/api/winreg/nf-winreg-reggetkeysecurity).

## <a name="cregkeym_hkey"></a><a name="m_hkey"></a> Сбой CRegKey:: m_hKey

Содержит маркер раздела реестра, связанного с `CRegKey` объектом.

```
HKEY m_hKey;
```

## <a name="cregkeym_ptm"></a><a name="m_ptm"></a> Сбой CRegKey:: m_pTM

Указатель на `CAtlTransactionManager` объект.

```
CAtlTransactionManager* m_pTM;
```

### <a name="remarks"></a>Комментарии

## <a name="cregkeynotifychangekeyvalue"></a><a name="notifychangekeyvalue"></a> Сбой CRegKey:: Нотифичанжекэйвалуе

Этот метод уведомляет вызывающий объект об изменениях атрибутов или содержимого открытого раздела реестра.

```
LONG NotifyChangeKeyValue(
    BOOL bWatchSubtree,
    DWORD dwNotifyFilter,
    HANDLE hEvent,
    BOOL bAsync = TRUE) throw();
```

### <a name="parameters"></a>Параметры

*бватчсубтри*<br/>
Указывает флаг, указывающий, следует ли сообщать об изменениях в указанном ключе и всех его подразделах или только в указанном ключе. Если этот параметр имеет значение TRUE, метод сообщает об изменениях в ключе и его подразделах. Если параметр имеет значение FALSE, то метод сообщает об изменениях только в ключе.

*двнотифифилтер*<br/>
Задает набор флагов, определяющих, какие изменения следует сообщать. Этот параметр может быть сочетанием следующих значений:

|Значение|Значение|
|-----------|-------------|
|REG_NOTIFY_CHANGE_NAME|Уведомлять вызывающего объекта о добавлении или удалении подраздела.|
|REG_NOTIFY_CHANGE_ATTRIBUTES|Уведомление вызывающей стороны об изменениях атрибутов ключа, таких как сведения о дескрипторе безопасности.|
|REG_NOTIFY_CHANGE_LAST_SET|Уведомление вызывающей стороны об изменениях значения ключа. Это может быть добавление или удаление значения или изменение существующего значения.|
|REG_NOTIFY_CHANGE_SECURITY|Уведомление вызывающей стороны об изменениях в дескрипторе безопасности ключа.|

*хевент*<br/>
Дескриптор события. Если параметр *басинк* имеет значение true, метод немедленно возвращает данные, и изменения выводятся с помощью сигнала этого события. Если *басинк* имеет значение false, *Хевент* игнорируется.

*басинк*<br/>
Задает флаг, который указывает, как метод сообщает об изменении. Если этот параметр имеет значение TRUE, метод немедленно возвращает данные и сообщает об изменениях с помощью сигнализации о заданном событии. Если этот параметр имеет значение FALSE, метод не возвращает результат, пока не произошло изменение. Если *Хевент* не указывает допустимое событие, параметр *басинк* не может иметь значение true.

### <a name="return-value"></a>Возвращаемое значение

Если метод завершился удачно, возвращается значение ERROR_SUCCESS. Если метод завершается ошибкой, возвращаемое значение является ненулевым кодом ошибки, определенным в файле WINERROR. H.

### <a name="remarks"></a>Комментарии

> [!NOTE]
> Этот метод не уведомляет вызывающий объект об удалении указанного ключа.

Дополнительные сведения и пример программы см. в разделе [регнотифичанжекэйвалуе](/windows/win32/api/winreg/nf-winreg-regnotifychangekeyvalue).

## <a name="cregkeyopen"></a><a name="open"></a> Сбой CRegKey:: Open

Вызовите этот метод, чтобы открыть указанный ключ и присвоить [m_hKey](#m_hkey) маркеру этого ключа.

```
LONG Open(
    HKEY hKeyParent,
    LPCTSTR lpszKeyName,
    REGSAM samDesired = KEY_READ | KEY_WRITE) throw();
```

### <a name="parameters"></a>Параметры

*хкэйпарент*<br/>
Маркер открытого ключа.

*лпсзкэйнаме*<br/>
Указывает имя создаваемого или открываемого ключа. Это имя должно быть подразделом *хкэйпарент*.

*самдесиред*<br/>
Защищенный доступ для ключа. Значение по умолчанию — KEY_ALL_ACCESS. Список возможных значений и описаний см. в разделе [регкреатекэйекс](/windows/win32/api/winreg/nf-winreg-regcreatekeyexw) в Windows SDK.

### <a name="return-value"></a>Возвращаемое значение

В случае успеха возвращает ERROR_SUCCESS; в противном случае значение ошибки, отличное от нуля, определено в файле WINERROR. H.

### <a name="remarks"></a>Комментарии

Если параметр *лпсзкэйнаме* имеет значение null или указывает на пустую строку, `Open` открывает новый маркер ключа, идентифицируемого *хкэйпарент*, но не закрывает ранее открытый обработчик.

В отличие от [сбой CRegKey:: Create](#create), `Open` не создаст указанный ключ, если он не существует.

## <a name="cregkeyoperator-hkey"></a><a name="operator_hkey"></a> Сбой CRegKey:: operator HKEY

Преобразует `CRegKey` объект в hKey.

```
operator HKEY() const throw();
```

## <a name="cregkeyoperator-"></a><a name="operator_eq"></a> Сбой CRegKey:: operator =

Оператор присвоения.

```
CRegKey& operator= (CRegKey& key) throw();
```

### <a name="parameters"></a>Параметры

*key*<br/>
Копируемый ключ.

### <a name="return-value"></a>Возвращаемое значение

Возвращает ссылку на новый ключ.

### <a name="remarks"></a>Комментарии

Этот оператор отключает *ключ* от текущего объекта и присваивает его `CRegKey` объекту.

## <a name="cregkeyquerybinaryvalue"></a><a name="querybinaryvalue"></a> Сбой CRegKey:: Куерибинаривалуе

Вызовите этот метод, чтобы получить двоичные данные для указанного имени значения.

```
LONG QueryBinaryValue(
    LPCTSTR pszValueName,
    void* pValue,
    ULONG* pnBytes) throw();
```

### <a name="parameters"></a>Параметры

*псзвалуенаме*<br/>
Указатель на строку с завершающим нулем, содержащую имя значения для запроса.

*pValue*<br/>
Указатель на буфер, который получает данные значения.

*пнбитес*<br/>
Указатель на переменную, указывающую размер буфера (в байтах), на который указывает параметр *pValue* . Когда метод возвращает значение, эта переменная содержит размер данных, копируемых в буфер.

### <a name="return-value"></a>Возвращаемое значение

Если метод выполнен, возвращается ERROR_SUCCESS. Если метод не считывает значение, он возвращает ненулевой код ошибки, определенный в файле WINERROR. H. Если данные, на которые имеются ссылки, не имеют тип REG_BINARY, возвращается ERROR_INVALID_DATA.

### <a name="remarks"></a>Комментарии

Этот метод использует `RegQueryValueEx` и подтверждает, что возвращается правильный тип данных. Дополнительные сведения см. в разделе [процедура RegQueryValueEx](/windows/win32/api/winreg/nf-winreg-regqueryvalueexw) .

> [!IMPORTANT]
> Этот метод позволяет вызывающему объекту указать любое расположение реестра, потенциально считывающее данные, которые не могут быть доверенными. Кроме того, функция [процедура RegQueryValueEx](/windows/win32/api/winreg/nf-winreg-regqueryvalueexw) , используемая этим методом, не обрабатывает строки, которые завершаются нулем. Оба условия должны проверяться вызывающим кодом.

## <a name="cregkeyquerydwordvalue"></a><a name="querydwordvalue"></a> Сбой CRegKey:: Куеридвордвалуе

Вызовите этот метод, чтобы получить данные типа DWORD для указанного имени значения.

```
LONG QueryDWORDValue(
    LPCTSTR pszValueName,
    DWORD& dwValue) throw();
```

### <a name="parameters"></a>Параметры

*псзвалуенаме*<br/>
Указатель на строку с завершающим нулем, содержащую имя значения для запроса.

*дввалуе*<br/>
Указатель на буфер, который получает DWORD.

### <a name="return-value"></a>Возвращаемое значение

Если метод выполнен, возвращается ERROR_SUCCESS. Если метод не считывает значение, он возвращает ненулевой код ошибки, определенный в файле WINERROR. H. Если данные, на которые имеются ссылки, не имеют тип REG_DWORD, возвращается ERROR_INVALID_DATA.

### <a name="remarks"></a>Комментарии

Этот метод использует `RegQueryValueEx` и подтверждает, что возвращается правильный тип данных. Дополнительные сведения см. в разделе [процедура RegQueryValueEx](/windows/win32/api/winreg/nf-winreg-regqueryvalueexw) .

> [!IMPORTANT]
> Этот метод позволяет вызывающему объекту указать любое расположение реестра, потенциально считывающее данные, которые не могут быть доверенными. Кроме того, функция [процедура RegQueryValueEx](/windows/win32/api/winreg/nf-winreg-regqueryvalueexw) , используемая этим методом, не обрабатывает строки, которые завершаются нулем. Оба условия должны проверяться вызывающим кодом.

## <a name="cregkeyqueryguidvalue"></a><a name="queryguidvalue"></a> Сбой CRegKey:: Куеригуидвалуе

Вызовите этот метод, чтобы получить данные GUID для указанного имени значения.

```
LONG QueryGUIDValue(
    LPCTSTR pszValueName,
    GUID& guidValue) throw();
```

### <a name="parameters"></a>Параметры

*псзвалуенаме*<br/>
Указатель на строку с завершающим нулем, содержащую имя значения для запроса.

*гуидвалуе*<br/>
Указатель на переменную, которая получает идентификатор GUID.

### <a name="return-value"></a>Возвращаемое значение

Если метод выполнен, возвращается ERROR_SUCCESS. Если метод не считывает значение, он возвращает ненулевой код ошибки, определенный в файле WINERROR. H. Если данные, на которые указывает ссылка, не являются допустимым идентификатором GUID, возвращается ERROR_INVALID_DATA.

### <a name="remarks"></a>Комментарии

Этот метод использует `CRegKey::QueryStringValue` и преобразует строку в GUID с помощью [клсидфромстринг](/windows/win32/api/combaseapi/nf-combaseapi-clsidfromstring).

> [!IMPORTANT]
> Этот метод позволяет вызывающему объекту указать любое расположение реестра, потенциально считывающее данные, которые не могут быть доверенными.

## <a name="cregkeyquerymultistringvalue"></a><a name="querymultistringvalue"></a> Сбой CRegKey:: Куеримултистрингвалуе

Вызовите этот метод, чтобы получить многострочные данные для указанного имени значения.

```
LONG QueryMultiStringValue(
    LPCTSTR pszValueName,
    LPTSTR pszValue,
    ULONG* pnChars) throw();
```

### <a name="parameters"></a>Параметры

*псзвалуенаме*<br/>
Указатель на строку с завершающим нулем, содержащую имя значения для запроса.

*псзвалуе*<br/>
Указатель на буфер, который получает многострочные данные. Многострочная — это массив строк, завершающихся нулем, заканчивающийся двумя символами NULL.

*пнчарс*<br/>
Размер (в Тчарс) буфера, на который указывает *псзвалуе*. Когда метод возвращает значение, *пнчарс* содержит размер (в тчарс) извлекаемой многострочной строки, включая завершающий нуль-символ.

### <a name="return-value"></a>Возвращаемое значение

Если метод выполнен, возвращается ERROR_SUCCESS. Если метод не считывает значение, он возвращает ненулевой код ошибки, определенный в файле WINERROR. H. Если данные, на которые имеются ссылки, не имеют тип REG_MULTI_SZ, возвращается ERROR_INVALID_DATA.

### <a name="remarks"></a>Комментарии

Этот метод использует `RegQueryValueEx` и подтверждает, что возвращается правильный тип данных. Дополнительные сведения см. в разделе [процедура RegQueryValueEx](/windows/win32/api/winreg/nf-winreg-regqueryvalueexw) .

> [!IMPORTANT]
> Этот метод позволяет вызывающему объекту указать любое расположение реестра, потенциально считывающее данные, которые не могут быть доверенными. Кроме того, функция [процедура RegQueryValueEx](/windows/win32/api/winreg/nf-winreg-regqueryvalueexw) , используемая этим методом, не обрабатывает строки, которые завершаются нулем. Оба условия должны проверяться вызывающим кодом.

## <a name="cregkeyqueryqwordvalue"></a><a name="queryqwordvalue"></a> Сбой CRegKey:: Куериквордвалуе

Вызовите этот метод, чтобы получить данные типа QWORD для указанного имени значения.

```
LONG QueryQWORDValue(
    LPCTSTR pszValueName,
    ULONGLONG& qwValue) throw();
```

### <a name="parameters"></a>Параметры

*псзвалуенаме*<br/>
Указатель на строку с завершающим нулем, содержащую имя значения для запроса.

*кввалуе*<br/>
Указатель на буфер, который получает значение QWORD.

### <a name="return-value"></a>Возвращаемое значение

Если метод выполнен, возвращается ERROR_SUCCESS. Если метод не считывает значение, он возвращает ненулевой код ошибки, определенный в файле WINERROR. H. Если данные, на которые имеются ссылки, не имеют тип REG_QWORD, возвращается ERROR_INVALID_DATA.

### <a name="remarks"></a>Комментарии

Этот метод использует `RegQueryValueEx` и подтверждает, что возвращается правильный тип данных. Дополнительные сведения см. в разделе [процедура RegQueryValueEx](/windows/win32/api/winreg/nf-winreg-regqueryvalueexw) .

> [!IMPORTANT]
> Этот метод позволяет вызывающему объекту указать любое расположение реестра, потенциально считывающее данные, которые не могут быть доверенными. Кроме того, функция [процедура RegQueryValueEx](/windows/win32/api/winreg/nf-winreg-regqueryvalueexw) , используемая этим методом, не обрабатывает строки, которые завершаются нулем. Оба условия должны проверяться вызывающим кодом.

## <a name="cregkeyquerystringvalue"></a><a name="querystringvalue"></a> Сбой CRegKey:: Куеристрингвалуе

Вызовите этот метод, чтобы получить строковые данные для указанного имени значения.

```
LONG QueryStringValue(
    LPCTSTR pszValueName,
    LPTSTR pszValue,
    ULONG* pnChars) throw();
```

### <a name="parameters"></a>Параметры

*псзвалуенаме*<br/>
Указатель на строку с завершающим нулем, содержащую имя значения для запроса.

*псзвалуе*<br/>
Указатель на буфер, который получает строковые данные.

*пнчарс*<br/>
Размер (в Тчарс) буфера, на который указывает *псзвалуе*. Когда метод возвращает значение, *пнчарс* содержит размер в тчарс извлекаемой строки, включая завершающий нуль-символ.

### <a name="return-value"></a>Возвращаемое значение

Если метод выполнен, возвращается ERROR_SUCCESS. Если метод не считывает значение, он возвращает ненулевой код ошибки, определенный в файле WINERROR. H. Если данные, на которые имеются ссылки, не имеют тип REG_SZ, возвращается ERROR_INVALID_DATA. Если метод возвращает ERROR_MORE_DATA, *пнчарс* равно нулю, а не требуемый размер буфера в байтах.

### <a name="remarks"></a>Комментарии

Этот метод использует `RegQueryValueEx` и подтверждает, что возвращается правильный тип данных. Дополнительные сведения см. в разделе [процедура RegQueryValueEx](/windows/win32/api/winreg/nf-winreg-regqueryvalueexw) .

> [!IMPORTANT]
> Этот метод позволяет вызывающему объекту указать любое расположение реестра, потенциально считывающее данные, которые не могут быть доверенными. Кроме того, функция [процедура RegQueryValueEx](/windows/win32/api/winreg/nf-winreg-regqueryvalueexw) , используемая этим методом, не обрабатывает строки, которые завершаются нулем. Оба условия должны проверяться вызывающим кодом.

## <a name="cregkeyqueryvalue"></a><a name="queryvalue"></a> Сбой CRegKey:: Куеривалуе

Вызовите этот метод, чтобы получить данные для указанного поля значения [m_hKey](#m_hkey). Более ранние версии этого метода больше не поддерживаются и помечаются как ATL_DEPRECATED.

```
LONG QueryValue(
    LPCTSTR pszValueName,
    DWORD* pdwType,
    void* pData,
    ULONG* pnBytes) throw();

ATL_DEPRECATED LONG QueryValue(
    DWORD& dwValue,
    LPCTSTR lpszValueName);

ATL_DEPRECATED LONG QueryValue(
    LPTSTR szValue,
    LPCTSTR lpszValueName,
    DWORD* pdwCount);
```

### <a name="parameters"></a>Параметры

*псзвалуенаме*<br/>
Указатель на строку с завершающим нулем, содержащую имя значения для запроса. Если *псзвалуенаме* имеет значение null или является пустой строкой, метод получает тип и данные для безымянного ключа или значения по умолчанию, если таковые имеются.

*пдвтипе*<br/>
Указатель на переменную, которая получает код, указывающий тип данных, хранящихся в указанном значении. Параметр *пдвтипе* может иметь значение null, если код типа не является обязательным.

*pData*<br/>
Указатель на буфер, который получает данные значения. Если данные не требуются, этот параметр может иметь значение NULL.

*пнбитес*<br/>
Указатель на переменную, указывающую размер буфера (в байтах), на который указывает параметр *pData* . Когда метод возвращает значение, эта переменная содержит размер данных, скопированных в *pData.*

*дввалуе*<br/>
Числовые данные поля значений.

*лпсзвалуенаме*<br/>
Указывает поле значения для запроса.

*сзвалуе*<br/>
Строковые данные поля значений.

*пдвкаунт*<br/>
Размер строковых данных. Его значение изначально равно размеру буфера *сзвалуе* .

### <a name="return-value"></a>Возвращаемое значение

В случае успеха возвращает ERROR_SUCCESS; в противном случае — ненулевой код ошибки, определенный в файле WINERROR. H.

### <a name="remarks"></a>Комментарии

Две исходные версии `QueryValue` больше не поддерживаются и помечаются как ATL_DEPRECATED. Если эти формы используются, компилятор выдаст предупреждение.

Оставшийся метод вызывает процедура RegQueryValueEx.

> [!IMPORTANT]
> Этот метод позволяет вызывающему объекту указать любое расположение реестра, потенциально считывающее данные, которые не могут быть доверенными. Кроме того, функция процедура RegQueryValueEx, используемая этим методом, не обрабатывает строки, которые завершаются нулем. Оба условия должны проверяться вызывающим кодом.

## <a name="cregkeyrecursedeletekey"></a><a name="recursedeletekey"></a> Сбой CRegKey:: Рекурседелетекэй

Вызовите этот метод, чтобы удалить указанный ключ из реестра и явным образом удалить все подразделы.

```
LONG RecurseDeleteKey(LPCTSTR lpszKey) throw();
```

### <a name="parameters"></a>Параметры

*лпсзкэй*<br/>
Задает имя удаляемого ключа. Это имя должно быть подразделом [m_hKey](#m_hkey).

### <a name="return-value"></a>Возвращаемое значение

В случае успеха возвращает ERROR_SUCCESS; в противном случае значение ошибки, отличное от нуля, определено в файле WINERROR. H.

### <a name="remarks"></a>Комментарии

Если ключ содержит подразделы, необходимо вызвать этот метод, чтобы удалить ключ.

## <a name="cregkeysetbinaryvalue"></a><a name="setbinaryvalue"></a> Сбой CRegKey:: Сетбинаривалуе

Вызовите этот метод, чтобы задать двоичное значение раздела реестра.

```
LONG SetBinaryValue(
    LPCTSTR pszValueName,
    const void* pValue,
    ULONG nBytes) throw();
```

### <a name="parameters"></a>Параметры

*псзвалуенаме*<br/>
Указатель на строку, содержащую имя заданной величины. Если значение с таким именем еще не указано, метод добавляет его в ключ.

*pValue*<br/>
Указатель на буфер, содержащий данные, которые необходимо сохранить с указанным именем значения.

*nBytes*<br/>
Задает размер (в байтах) сведений, на которые указывает параметр *pValue* .

### <a name="return-value"></a>Возвращаемое значение

Если метод завершился удачно, возвращается значение ERROR_SUCCESS. Если метод завершается ошибкой, возвращаемое значение является ненулевым кодом ошибки, определенным в файле WINERROR. H.

### <a name="remarks"></a>Комментарии

Этот метод использует [RegSetValueEx](/windows/win32/api/winreg/nf-winreg-regsetvalueexw) для записи значения в реестр.

## <a name="cregkeysetdwordvalue"></a><a name="setdwordvalue"></a> Сбой CRegKey:: Сетдвордвалуе

Вызовите этот метод, чтобы задать значение DWORD раздела реестра.

```
LONG SetDWORDValue(LPCTSTR pszValueName, DWORD dwValue) throw();
```

### <a name="parameters"></a>Параметры

*псзвалуенаме*<br/>
Указатель на строку, содержащую имя заданной величины. Если значение с таким именем еще не указано, метод добавляет его в ключ.

*дввалуе*<br/>
Данные типа DWORD, которые будут сохранены с указанным именем значения.

### <a name="return-value"></a>Возвращаемое значение

Если метод завершился удачно, возвращается значение ERROR_SUCCESS. Если метод завершается ошибкой, возвращаемое значение является ненулевым кодом ошибки, определенным в файле WINERROR. H.

### <a name="remarks"></a>Комментарии

Этот метод использует [RegSetValueEx](/windows/win32/api/winreg/nf-winreg-regsetvalueexw) для записи значения в реестр.

## <a name="cregkeysetguidvalue"></a><a name="setguidvalue"></a> Сбой CRegKey:: Сетгуидвалуе

Вызовите этот метод, чтобы задать значение GUID для раздела реестра.

```
LONG SetGUIDValue(LPCTSTR pszValueName, REFGUID guidValue) throw();
```

### <a name="parameters"></a>Параметры

*псзвалуенаме*<br/>
Указатель на строку, содержащую имя заданной величины. Если значение с таким именем еще не указано, метод добавляет его в ключ.

*гуидвалуе*<br/>
Ссылка на идентификатор GUID для сохранения с указанным именем значения.

### <a name="return-value"></a>Возвращаемое значение

Если метод завершился удачно, возвращается значение ERROR_SUCCESS. Если метод завершается ошибкой, возвращаемое значение является ненулевым кодом ошибки, определенным в файле WINERROR. H.

### <a name="remarks"></a>Комментарии

Этот метод использует `CRegKey::SetStringValue` и преобразует идентификатор GUID в строку с помощью [StringFromGUID2](/windows/win32/api/combaseapi/nf-combaseapi-stringfromguid2).

## <a name="cregkeysetkeyvalue"></a><a name="setkeyvalue"></a> Сбой CRegKey:: Сеткэйвалуе

Вызывайте этот метод для хранения данных в указанном поле значения указанного ключа.

```
LONG SetKeyValue(
    LPCTSTR lpszKeyName,
    LPCTSTR lpszValue,
    LPCTSTR lpszValueName = NULL) throw();
```

### <a name="parameters"></a>Параметры

*лпсзкэйнаме*<br/>
Указывает имя создаваемого или открываемого ключа. Это имя должно быть подразделом [m_hKey](#m_hkey).

*лпсзвалуе*<br/>
Задает сохраняемые данные. Этот параметр не должен иметь значение NULL.

*лпсзвалуенаме*<br/>
Указывает поле значения, которое должно быть задано. Если поле значения с таким именем еще не существует в ключе, оно добавляется.

### <a name="return-value"></a>Возвращаемое значение

В случае успеха возвращает ERROR_SUCCESS; в противном случае — ненулевой код ошибки, определенный в файле WINERROR. H.

### <a name="remarks"></a>Комментарии

Вызовите этот метод, чтобы создать или открыть ключ *лпсзкэйнаме* и сохранить данные *лпсзвалуе* в поле значения *лпсзвалуенаме* .

## <a name="cregkeysetkeysecurity"></a><a name="setkeysecurity"></a> Сбой CRegKey:: Сеткэйсекурити

Вызовите этот метод, чтобы задать параметры безопасности для раздела реестра.

```
LONG SetKeySecurity(SECURITY_INFORMATION si, PSECURITY_DESCRIPTOR psd) throw();
```

### <a name="parameters"></a>Параметры

*si*<br/>
Задает устанавливаемые компоненты дескриптора безопасности. Значение может быть сочетанием следующих значений:

|Значение|Значение|
|-----------|-------------|
|DACL_SECURITY_INFORMATION|Задает список управления доступом (DACL) для ключа. Ключ должен иметь WRITE_DAC доступ, либо вызывающий процесс должен быть владельцем объекта.|
|GROUP_SECURITY_INFORMATION|Задает идентификатор безопасности (SID) основной группы ключей. Ключ должен иметь WRITE_OWNER доступ, либо вызывающий процесс должен быть владельцем объекта.|
|OWNER_SECURITY_INFORMATION|Задает идентификатор безопасности владельца ключа. Ключ должен иметь WRITE_OWNER доступ, либо вызывающий процесс должен быть владельцем объекта или иметь разрешение SE_TAKE_OWNERSHIP_NAME.|
|SACL_SECURITY_INFORMATION|Задает системный список управления доступом (SACL) для ключа. Ключ должен иметь доступ ACCESS_SYSTEM_SECURITY. Правильный способ получить этот доступ — включить [привилегию](/windows/win32/secauthz/privileges) SE_SECURITY_NAME в текущем маркере доступа вызывающего объекта, открыть маркер для ACCESS_SYSTEM_SECURITY доступа, а затем отключить привилегию.|

*формате*<br/>
Указатель на структуру [SECURITY_DESCRIPTOR](/windows/win32/api/winnt/ns-winnt-security_descriptor) , указывающую атрибуты безопасности, которые необходимо задать для указанного ключа.

### <a name="return-value"></a>Возвращаемое значение

Если метод завершился удачно, возвращается значение ERROR_SUCCESS. Если метод завершается ошибкой, возвращаемое значение является ненулевым кодом ошибки, определенным в файле WINERROR. H.

### <a name="remarks"></a>Комментарии

Задает атрибуты безопасности ключа. Дополнительные сведения см. в разделе [регсеткэйсекурити](/windows/win32/api/winreg/nf-winreg-regsetkeysecurity) .

## <a name="cregkeysetmultistringvalue"></a><a name="setmultistringvalue"></a> Сбой CRegKey:: Сетмултистрингвалуе

Вызовите этот метод, чтобы задать многострочное значение раздела реестра.

```
LONG SetMultiStringValue(LPCTSTR pszValueName, LPCTSTR pszValue) throw();
```

### <a name="parameters"></a>Параметры

*псзвалуенаме*<br/>
Указатель на строку, содержащую имя заданной величины. Если значение с таким именем еще не указано, метод добавляет его в ключ.

*псзвалуе*<br/>
Указатель на многострочные данные, которые будут сохранены с указанным именем значения. Многострочная — это массив строк, завершающихся нулем, заканчивающийся двумя символами NULL.

### <a name="return-value"></a>Возвращаемое значение

Если метод завершился удачно, возвращается значение ERROR_SUCCESS. Если метод завершается ошибкой, возвращаемое значение является ненулевым кодом ошибки, определенным в файле WINERROR. H.

### <a name="remarks"></a>Комментарии

Этот метод использует [RegSetValueEx](/windows/win32/api/winreg/nf-winreg-regsetvalueexw) для записи значения в реестр.

## <a name="cregkeysetqwordvalue"></a><a name="setqwordvalue"></a> Сбой CRegKey:: Сетквордвалуе

Вызовите этот метод, чтобы задать значение QWORD раздела реестра.

```
LONG SetQWORDValue(LPCTSTR pszValueName, ULONGLONG qwValue) throw();
```

### <a name="parameters"></a>Параметры

*псзвалуенаме*<br/>
Указатель на строку, содержащую имя заданной величины. Если значение с таким именем еще не указано, метод добавляет его в ключ.

*кввалуе*<br/>
Данные QWORD, которые будут сохранены с указанным именем значения.

### <a name="return-value"></a>Возвращаемое значение

Если метод завершился удачно, возвращается значение ERROR_SUCCESS. Если метод завершается ошибкой, возвращаемое значение является ненулевым кодом ошибки, определенным в файле WINERROR. H.

### <a name="remarks"></a>Комментарии

Этот метод использует [RegSetValueEx](/windows/win32/api/winreg/nf-winreg-regsetvalueexw) для записи значения в реестр.

## <a name="cregkeysetstringvalue"></a><a name="setstringvalue"></a> Сбой CRegKey:: SetStringValue

Вызовите этот метод, чтобы задать строковое значение раздела реестра.

```
LONG SetStringValue(
    LPCTSTR pszValueName,
    LPCTSTR pszValue,
    DWORD dwType = REG_SZ) throw();
```

### <a name="parameters"></a>Параметры

*псзвалуенаме*<br/>
Указатель на строку, содержащую имя заданной величины. Если значение с таким именем еще не указано, метод добавляет его в ключ.

*псзвалуе*<br/>
Указатель на строковые данные, которые должны храниться с указанным именем значения.

*двтипе*<br/>
Тип строки, записываемой в реестр: либо REG_SZ (значение по умолчанию), либо REG_EXPAND_SZ (для многострочных строк).

### <a name="return-value"></a>Возвращаемое значение

Если метод завершился удачно, возвращается значение ERROR_SUCCESS. Если метод завершается ошибкой, возвращаемое значение является ненулевым кодом ошибки, определенным в файле WINERROR. H.

### <a name="remarks"></a>Комментарии

Этот метод использует [RegSetValueEx](/windows/win32/api/winreg/nf-winreg-regsetvalueexw) для записи значения в реестр.

## <a name="cregkeysetvalue"></a><a name="setvalue"></a> Сбой CRegKey:: SetValue

Вызывайте этот метод для хранения данных в поле указанного значения [m_hKey](#m_hkey). Более ранние версии этого метода больше не поддерживаются и помечаются как ATL_DEPRECATED.

```
LONG SetValue(
    LPCTSTR pszValueName,
    DWORD dwType,
    const void* pValue,
    ULONG nBytes) throw();

static LONG WINAPI SetValue(
    HKEY hKeyParent,
    LPCTSTR lpszKeyName,
    LPCTSTR lpszValue,
    LPCTSTR lpszValueName = NULL);

ATL_DEPRECATED LONG SetValue(
    DWORD dwValue,
    LPCTSTR lpszValueName);

ATL_DEPRECATED LONG SetValue(
    LPCTSTR lpszValue,
    LPCTSTR lpszValueName = NULL,
    bool bMulti = false,
    int nValueLen = -1);
```

### <a name="parameters"></a>Параметры

*псзвалуенаме*<br/>
Указатель на строку, содержащую имя заданной величины. Если значение с таким именем еще не существует в ключе, метод добавляет его в ключ. Если *псзвалуенаме* имеет значение null или является пустой строкой, метод задает тип и данные для безымянного или значения по умолчанию ключа.

*двтипе*<br/>
Указывает код, указывающий тип данных, на который указывает параметр *pValue* .

*pValue*<br/>
Указатель на буфер, содержащий данные, которые необходимо сохранить с указанным именем значения.

*nBytes*<br/>
Задает размер (в байтах) сведений, на которые указывает параметр *pValue* . Если данные имеют тип REG_SZ, REG_EXPAND_SZ или REG_MULTI_SZ, *nBytes* должен включать размер завершающего нуль-символа.

*хкэйпарент*<br/>
Маркер открытого ключа.

*лпсзкэйнаме*<br/>
Указывает имя создаваемого или открываемого ключа. Это имя должно быть подразделом *хкэйпарент*.

*лпсзвалуе*<br/>
Задает сохраняемые данные. Этот параметр не должен иметь значение NULL.

*лпсзвалуенаме*<br/>
Указывает поле значения, которое должно быть задано. Если поле значения с таким именем еще не существует в ключе, оно добавляется.

*дввалуе*<br/>
Задает сохраняемые данные.

*бмулти*<br/>
Если значение равно false, то указывает, что строка имеет тип REG_SZ. Значение true указывает, что строка является многострочной REG_MULTI_SZ типа.

*нвалуелен*<br/>
Если *бмулти* имеет значение true, *нвалуелен* — длина строки *лпсзвалуе* в символах. Если *бмулти* равно false, значение-1 указывает, что метод будет автоматически рассчитывать длину.

### <a name="return-value"></a>Возвращаемое значение

В случае успеха возвращает ERROR_SUCCESS; в противном случае — ненулевой код ошибки, определенный в файле WINERROR. H.

### <a name="remarks"></a>Комментарии

Две исходные версии `SetValue` помечены как ATL_DEPRECATED и больше не должны использоваться. Если эти формы используются, компилятор выдаст предупреждение.

Третий метод вызывает [RegSetValueEx](/windows/win32/api/winreg/nf-winreg-regsetvalueexw).

## <a name="see-also"></a>См. также раздел

[Пример DCOM](../../overview/visual-cpp-samples.md)<br/>
[Общие сведения о классах](../../atl/atl-class-overview.md)
