---
description: 'Дополнительные сведения: Добавление точек подключения в объект'
title: Добавление точек подключения к объектам
ms.date: 11/04/2016
helpviewer_keywords:
- connection points [C++], adding to ATL objects
- Implement Connection Point ATL wizard
ms.assetid: 843531be-4a36-4db0-9d54-e029b1a72a8b
ms.openlocfilehash: 7d8274ab37cef28a58666852aad24db7d945d26e
ms.sourcegitcommit: d6af41e42699628c3e2e6063ec7b03931a49a098
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2020
ms.locfileid: "97166243"
---
# <a name="adding-connection-points-to-an-object"></a>Добавление точек подключения к объектам

В [учебнике по ATL](../atl/active-template-library-atl-tutorial.md) показано, как создать элемент управления с поддержкой точек соединения, как добавить события и как реализовать точку подключения. ATL реализует точки соединения с классом [иконнектионпоинтимпл](../atl/reference/iconnectionpointimpl-class.md) .

Для реализации точки подключения существует два варианта:

- Реализуйте собственный источник исходящего события, добавив точку подключения к элементу управления или объекту.

- Повторное использование интерфейса точки подключения, определенного в другой библиотеке типов.

В любом случае мастер реализации точки подключения использует библиотеку типов для выполнения своей работы.

### <a name="to-add-a-connection-point-to-a-control-or-object"></a>Добавление точки подключения к элементу управления или объекту

1. Определите диспетчерский интерфейс в блоке библиотеки IDL-файла. Если включена поддержка точек подключения при создании элемента управления с помощью мастера элементов управления ATL, диспетчерский интерфейс уже будет создан. Если вы не включили поддержку точек подключения при создании элемента управления, необходимо вручную добавить в IDL-файл диспетчерский интерфейс. Ниже приведен пример disp-интерфейса. Исходящие интерфейсы не обязательно должны быть интерфейсами диспетчеризации, но для многих языков сценариев, таких как VBScript и JScript, это необходимо, поэтому в этом примере используются два DISP:

   [!code-cpp[NVC_ATL_Windowing#81](../atl/codesnippet/cpp/adding-connection-points-to-an-object_1.idl)]

   Для создания идентификатора GUID используйте служебную программу uuidgen.exe или guidgen.exe.

2. Добавьте DISP- `[default,source]` интерфейс в качестве интерфейса в компонентном классе для объекта в IDL-файле проекта. Опять же, если включена поддержка точек подключения при создании элемента управления, мастер элементов управления ATL создаст `[default,source` запись]. Чтобы добавить эту запись вручную, добавьте строку полужирным шрифтом:

   [!code-cpp[NVC_ATL_Windowing#82](../atl/codesnippet/cpp/adding-connection-points-to-an-object_2.idl)]

   Пример см. в IDL-файле в образце [Circ](../overview/visual-cpp-samples.md) ATL.

3. Используйте представление классов, чтобы добавить методы и свойства в интерфейс событий. Щелкните правой кнопкой мыши класс в представление классов, выберите пункт **Добавить** в контекстном меню и щелкните **Добавить точку подключения**.

4. В диалоговом окне список **исходных интерфейсов** в мастере реализации точек подключения выберите **интерфейсы проекта**. Если вы выбрали интерфейс для элемента управления и нажмете кнопку " **ОК**", вам потребуется:

   - Создайте файл заголовка с классом прокси события, который реализует код, который будет выполнять исходящие вызовы для события.

   - Добавьте запись в карту точек подключения.

   Кроме того, вы увидите список всех библиотек типов на компьютере. Для определения точки подключения следует использовать только одну из этих библиотек типов, если вы хотите реализовать тот же исходящий интерфейс, обнаруженный в другой библиотеке типов.

### <a name="to-reuse-a-connection-point-interface-defined-in-another-type-library"></a>Повторное использование интерфейса точки подключения, определенного в другой библиотеке типов

1. В представление классов щелкните правой кнопкой мыши класс, реализующий **BEGIN_COM_MAP** макрос, выберите пункт **Добавить** в контекстном меню и щелкните **Добавить точку подключения**.

2. В мастере реализации точки подключения выберите библиотеку типов и интерфейс в библиотеке типов и нажмите кнопку **Добавить**.

3. Измените IDL-файл так:

   - Скопируйте диспетчерский интерфейс из IDL-файла для объекта, для которого используется источник событий.

   - Используйте инструкцию **importlib** для этой библиотеки типов.

## <a name="see-also"></a>См. также раздел

[Точка подключения](../atl/atl-connection-points.md)
