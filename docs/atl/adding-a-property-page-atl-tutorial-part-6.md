---
title: Добавление страницы свойств (учебник ATL, часть 6)
ms.custom: get-started-article
ms.date: 09/27/2018
ms.assetid: df80d255-e7ea-49d9-b940-3f012e90cf9b
ms.openlocfilehash: 9287b7a15e3653212ed6a5428cdfe5a530ececc3
ms.sourcegitcommit: c3093251193944840e3d0a068ecc30e6449624ba
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/04/2019
ms.locfileid: "57264770"
---
# <a name="adding-a-property-page-atl-tutorial-part-6"></a>Добавление страницы свойств (учебник ATL, часть 6)

Страницы свойств, реализуются как отдельные объекты COM, которые позволяют им совместно при необходимости. На этом шаге будет выполнять следующие задачи для добавления страницы свойств для элемента управления:

- Создание ресурса страницы свойств

- Добавление кода для создания и управления ими на страницу свойств

- Добавление страницы свойств для элемента управления

## <a name="creating-the-property-page-resource"></a>Создание ресурса страницы свойств

Чтобы добавить страницы свойств в элемент управления, используйте страницы свойств ATL шаблон.

### <a name="to-add-a-property-page"></a>Чтобы добавить страницы свойств

1. В **обозревателе решений**, щелкните правой кнопкой мыши `Polygon`.

1. В контекстном меню, щелкните **добавить** > **новый элемент**.

1. В списке шаблонов выберите **ATL** > **страницы свойств ATL** и нажмите кнопку **добавить**.

1. Когда **мастер страницы свойств ATL** откроется, введите *PolyProp* как **короткие** имя.

1. Нажмите кнопку **строки** открыть **строки** и введите **& многоугольника** как **Title**.

   **Title** свойства страницы — это строка, которая появляется на вкладке этой страницы. **Строка документации** представляет собой описание, использующий фрейм свойства для перевода в состояние строки или в подсказках. Обратите внимание на то, что стандартное свойство фрейма в настоящее время не использовать эту строку, поэтому его можно оставить по умолчанию содержимым. Не будет формировать **файл справки** на данный момент, поэтому удалите запись в это текстовое поле.

1. Нажмите кнопку **Готово**, и создается объект страницы свойств.

Создаются следующие три файла:

|Файл|Описание|
|----------|-----------------|
|PolyProp.h|Содержит класс C++ `CPolyProp`, который реализует страницу свойств.|
|PolyProp.cpp|Включает файл PolyProp.h.|
|PolyProp.rgs|Скрипт реестра, который регистрирует объект страницы свойств.|

Кроме того внесены следующие изменения кода:

- Новая страница свойств добавляется сопоставление запись объекта в Polygon.cpp.

- `PolyProp` Класс добавляется к файлу Polygon.idl.

- Новый файл скрипта реестра PolyProp.rgs добавляется ресурс проекта.

- Шаблон диалогового окна добавляется к ресурсу для страницы свойств проекта.

- Строки свойств, которые вы указали добавляются к таблице строк ресурсов.

Теперь добавьте поля, которые нужно отобразить на странице свойств.

### <a name="to-add-fields-to-the-property-page"></a>Чтобы добавить поля на страницу свойств

1. В **обозревателе решений**, дважды щелкните файл ресурсов Polygon.rc. Откроется **представление ресурсов**.

1. В **представление ресурсов**, разверните `Dialog` узла и дважды щелкните `IDD_POLYPROP`. Обратите внимание, что диалоговое окно, которое отображается пуста, за исключением метку, которая сообщает вам вставить здесь элементы управления.

1. Выберите метку и измените его для чтения `Sides:` путем изменения **заголовок** текста в **свойства** окна.

1. Изменить размер поля метки, так, чтобы размер текста.

1. Перетащите **изменить элемент управления** из **элементов** справа от метки.

1. Наконец, измените **идентификатор** элемента управления редактированием для `IDC_SIDES` с помощью **свойства** окна.

На этом завершается процесс создания ресурса страницы свойств.

## <a name="adding-code-to-create-and-manage-the-property-page"></a>Добавление кода для создания и управления ими на страницу свойств

Теперь, когда вы создали ресурс страницы свойств, необходимо написать код реализации.

Во-первых, включите `CPolyProp` классу задать число сторон в объекте при **применить** нажатии кнопки.

### <a name="to-modify-the-apply-function-to-set-the-number-of-sides"></a>Чтобы изменить функцию применить для задания числа сторон

1. Замените `Apply` функции в PolyProp.h следующим кодом:

    [!code-cpp[NVC_ATL_Windowing#58](../atl/codesnippet/cpp/adding-a-property-page-atl-tutorial-part-6_1.h)]

Страница свойств может иметь больше одного клиента, подключенные к ней одновременно, поэтому `Apply` функция циклы вокруг и вызывает `put_Sides` на каждом клиенте с помощью значения, полученные из поля ввода. При использовании [CComQIPtr](../atl/reference/ccomqiptr-class.md) класс, который выполняет `QueryInterface` для каждого объекта, чтобы получить `IPolyCtl` интерфейс из `IUnknown` интерфейс (хранящиеся в `m_ppUnk` массива).

Код теперь проверяет значение этого параметра `Sides` свойство действительно работало. Если происходит сбой, код отображает окно сообщения, отображающее сведения об ошибке из `IErrorInfo` интерфейс. Как правило, контейнер запрашивает объект для `ISupportErrorInfo` интерфейс и вызывает метод `InterfaceSupportsErrorInfo` первой, чтобы определить, поддерживает ли объект параметра сведений об ошибке. Эту задачу можно пропустить.

[CComPtr](../atl/reference/ccomptr-class.md) помогает, автоматически обрабатывая подсчет ссылок, поэтому не нужно вызывать `Release` в интерфейсе. `CComBSTR` поможет вам с обработкой BSTR, поэтому необходимо выполнить последний `SysFreeString` вызова. Также использовании одного из различных классы преобразования строк, поэтому вы можете преобразовать строку BSTR, при необходимости (Вот почему макрос определить USES_CONVERSION — начало функции).

Необходимо также задать страницу свойств "грязный" флаг указывает, что **применить** кнопка должна быть включена. Это происходит, когда пользователь изменяет значение в **сторон** поле ввода.

### <a name="to-handle-the-apply-button"></a>Для обработки кнопки "Применить"

1. В **представление классов**, щелкните правой кнопкой мыши `CPolyProp` и нажмите кнопку **свойства** в контекстном меню.

1. В **свойства** окно, нажмите кнопку **события** значок.

1. Разверните `IDC_SIDES` узел в списке событий.

1. Выберите `EN_CHANGE`и выберите в раскрывающемся меню справа выберите  **\<Добавить > OnEnChangeSides**. `OnEnChangeSides` Polyprop.h и реализация обработчика для Polyprop.cpp будет добавлено объявление обработчика.

Далее предстоит изменить обработчик.

### <a name="to-modify-the-onenchangesides-method"></a>Чтобы изменить метод OnEnChangeSides

1. Добавьте следующий код в Polyprop.cpp для `OnEnChangeSides` метод (удаление любой код, который мастер помещены туда):

    [!code-cpp[NVC_ATL_Windowing#59](../atl/codesnippet/cpp/adding-a-property-page-atl-tutorial-part-6_2.cpp)]

`OnEnChangeSides` будет выполнен при вызове `WM_COMMAND` отправляется сообщение с `EN_CHANGE` уведомлений для `IDC_SIDES` элемента управления. `OnEnChangeSides` затем вызывает `SetDirty` и передает значение TRUE указывает на страницу свойств теперь является "грязным" и **применить** кнопка должна быть включена.

## <a name="adding-the-property-page-to-the-control"></a>Добавление страницы свойств для элемента управления

Мастера и страницы свойств ATL шаблона не добавляйте на страницу свойств в элемент управления для вас автоматически, поскольку может существовать несколько элементов управления в проекте. Необходимо добавить запись в схеме сопоставления свойств элемента управления.

### <a name="to-add-the-property-page"></a>Чтобы добавить на страницу свойств

1. Откройте PolyCtl.h и добавьте следующие строки в схеме сопоставления свойств:

    [!code-cpp[NVC_ATL_Windowing#60](../atl/codesnippet/cpp/adding-a-property-page-atl-tutorial-part-6_3.h)]

Сопоставление свойств элемента управления теперь выглядит следующим образом:

[!code-cpp[NVC_ATL_Windowing#61](../atl/codesnippet/cpp/adding-a-property-page-atl-tutorial-part-6_4.h)]

Можно добавить `PROP_PAGE` макрос с идентификатором CLSID страницы свойств, однако если `PROP_ENTRY` макрос, как показано, `Sides` значение свойства также сохраняется при сохранении элемента управления.

Три параметры макроса — свойство описание, идентификатор DISPID свойства, а также идентификатор CLSID страницы свойств со свойством, установленным на нем. Это полезно в том случае, если, например, загрузки элемента управления в Visual Basic и задано число сторон во время разработки. Поскольку число сторон сохраняется, если вы Перезагрузите проект Visual Basic, будут восстановлены числа сторон.

## <a name="building-and-testing-the-control"></a>Построение и тестирование элемента управления

Теперь построения, управления и вставить его в тестовый контейнер элементов управления ActiveX. В **тестовый контейнер**на **изменить** меню, щелкните **объекта PolyCtl класса**. Сведения, которые вы добавили откроется окно свойств.

**Применить** изначально будет отключена кнопка. Начните вводить значение в **сторон** поле и **применить** станет активной кнопка. После завершения ввода значения, нажмите кнопку **применить** кнопки. Содержимое элемента управления окна изменяется и **применить** снова будет отключена кнопка. Попробуйте ввести недопустимое значение. Появится окно сообщения, содержащее описание ошибки, от `put_Sides` функции.

Далее будет помещено в элемент управления на веб-страницы.

[Вернитесь к шагу 5](../atl/adding-an-event-atl-tutorial-part-5.md) &#124; [к шагу 7](../atl/putting-the-control-on-a-web-page-atl-tutorial-part-7.md)

## <a name="see-also"></a>См. также

[Руководство](../atl/active-template-library-atl-tutorial.md)
