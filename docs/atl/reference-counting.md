---
title: Подсчет ссылок (ATL)
ms.date: 11/04/2016
helpviewer_keywords:
- AddRef method [C++], reference counting
- reference counting
- AddRef method [C++]
- reference counts
- references, counting
ms.assetid: b1fd4514-6de6-429f-9e60-2777c0d07a3d
ms.openlocfilehash: f90c818e58ae7ef6e4a0b771cb53ae5b185d1617
ms.sourcegitcommit: 1f009ab0f2cc4a177f2d1353d5a38f164612bdb1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/27/2020
ms.locfileid: "87224348"
---
# <a name="reference-counting"></a>Подсчет ссылок

Сам COM не пытается автоматически удалять объект из памяти, когда он считает, что объект больше не используется. Вместо этого объектный программист должен удалить неиспользуемый объект. Программист определяет, можно ли удалить объект на основе счетчика ссылок.

COM использует `IUnknown` методы, [AddRef](/windows/win32/api/unknwn/nf-unknwn-iunknown-addref) и [Release](/windows/win32/api/unknwn/nf-unknwn-iunknown-release)для управления счетчиком ссылок интерфейсов в объекте. Общие правила для вызова этих методов:

- Каждый раз, когда клиент получает указатель интерфейса, `AddRef` он должен вызываться для интерфейса.

- Каждый раз, когда клиент завершает использование указателя интерфейса, он должен вызвать `Release` .

В простой реализации каждый `AddRef` инкремент вызова увеличивается, и каждый `Release` вызов уменьшает переменную счетчика внутри объекта. Когда число возвращается к нулю, интерфейс больше не имеет пользователей и может быть удален из памяти.

Подсчет ссылок можно также реализовать, чтобы подсчитать каждую ссылку на объект (не на отдельный интерфейс). В этом случае каждая `AddRef` и `Release` вызывает делегаты для Центральной реализации объекта и `Release` освобождает весь объект, когда его счетчик ссылок достигает нуля.

> [!NOTE]
> Если `CComObject` объект, производный от, создается с помощью **`new`** оператора, счетчик ссылок равен 0. Поэтому `AddRef` после успешного создания объекта, производного от, необходимо выполнить вызов метода `CComObject` .

## <a name="see-also"></a>См. также статью

[Введение в модель COM](../atl/introduction-to-com.md)<br/>
[Управление жизненным циклом объектов с помощью подсчета ссылок](/windows/win32/com/managing-object-lifetimes-through-reference-counting)
