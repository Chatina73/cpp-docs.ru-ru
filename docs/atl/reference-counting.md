---
title: Подсчет ссылок (ATL)
ms.date: 11/04/2016
helpviewer_keywords:
- AddRef method [C++], reference counting
- reference counting
- AddRef method [C++]
- reference counts
- references, counting
ms.assetid: b1fd4514-6de6-429f-9e60-2777c0d07a3d
ms.openlocfilehash: 565b74956280d4e80c41376ead4249e69980a80e
ms.sourcegitcommit: fcb48824f9ca24b1f8bd37d647a4d592de1cc925
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/15/2019
ms.locfileid: "69492223"
---
# <a name="reference-counting"></a>Подсчет ссылок

Сам COM не пытается автоматически удалять объект из памяти, когда он считает, что объект больше не используется. Вместо этого объектный программист должен удалить неиспользуемый объект. Программист определяет, можно ли удалить объект на основе счетчика ссылок.

COM использует `IUnknown` методы, [AddRef](/windows/win32/api/unknwn/nf-unknwn-iunknown-addref) и [Release](/windows/win32/api/unknwn/nf-unknwn-iunknown-release)для управления счетчиком ссылок интерфейсов в объекте. Общие правила для вызова этих методов:

- Каждый раз, когда клиент получает указатель интерфейса `AddRef` , он должен вызываться для интерфейса.

- Каждый раз, когда клиент завершает использование указателя интерфейса, он должен вызвать `Release`.

В простой реализации каждый `AddRef` инкремент вызова увеличивается, и каждый `Release` вызов уменьшает переменную счетчика внутри объекта. Когда число возвращается к нулю, интерфейс больше не имеет пользователей и может быть удален из памяти.

Подсчет ссылок можно также реализовать, чтобы подсчитать каждую ссылку на объект (не на отдельный интерфейс). В этом случае каждая `AddRef` и `Release` вызывает делегаты для Центральной реализации объекта и `Release` освобождает весь объект, когда его счетчик ссылок достигает нуля.

> [!NOTE]
>  При создании производного объекта с помощью оператора New счетчик ссылок равен 0. `CComObject` Поэтому после успешного `CComObject`создания объекта `AddRef` , производного от, необходимо выполнить вызов метода.

## <a name="see-also"></a>См. также

[Введение в модель COM](../atl/introduction-to-com.md)<br/>
[Управление жизненным циклом объектов с помощью подсчета ссылок](/windows/win32/com/managing-object-lifetimes-through-reference-counting)
