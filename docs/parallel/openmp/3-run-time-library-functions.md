---
title: 3. Функции библиотеки времени выполнения
ms.date: 01/17/2019
ms.assetid: b226e512-6822-4cbe-a2ca-74cc2bb7e880
ms.openlocfilehash: 7d48338683037c06ca208bff32c5c2e9b546a9fe
ms.sourcegitcommit: 774db6a005a85e2a1268ca34309b993792701819
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/25/2019
ms.locfileid: "55065026"
---
# <a name="3-run-time-library-functions"></a>3. Функции библиотеки времени выполнения

В этом разделе описаны функции библиотеки времени выполнения OpenMP C и C++. Заголовок  **\<omp.h >** объявляются два типа, несколько функций, которые могут использоваться для контроля и запроса у среды параллельного выполнения, а блокировка функций, которые могут использоваться для синхронизации доступа к данным.

Тип `omp_lock_t` не является типом объекта может представлять, что блокировка доступна, или поток владеет блокировкой. Эти блокировки называются *простые блокировки*.

Тип `omp_nest_lock_t` типа объекта, который может представлять, что блокировка доступна, или удостоверение потока, владеющего блокировкой и *вложение число* (как описано ниже). Эти блокировки называются *вкладываемых блокировок*.

Функции библиотеки используют внешние функции с компоновкой «C».

Описания в этой главе можно разделить на следующие разделы:

- [Функции среды выполнения](#31-execution-environment-functions)
- [Функции блокировки](#32-lock-functions)
- [Процедуры расписания](#33-timing-routines)

## <a name="31-execution-environment-functions"></a>3.1 функции среды выполнения

Функции, описанные в этом разделе влияет на и отслеживать потоки, процессоры и параллельные среды:

- [omp_set_num_threads](#311-omp_set_num_threads-function)
- [omp_get_num_threads](#312-omp_get_num_threads-function)
- [omp_get_max_threads](#313-omp_get_max_threads-function)
- [omp_get_thread_num](#314-omp_get_thread_num-function)
- [omp_get_num_procs](#315-omp_get_num_procs-function)
- [omp_in_parallel](#316-omp_in_parallel-function)
- [omp_set_dynamic](#317-omp_set_dynamic-function)
- [omp_get_dynamic](#318-omp_get_dynamic-function)
- [omp_set_nested](#319-omp_set_nested-function)
- [omp_get_nested](#3110-omp_get_nested-function)

### <a name="311-ompsetnumthreads-function"></a>3.1.1 функция omp_set_num_threads

`omp_set_num_threads` Функция задает значение по умолчанию количество потоков, используемых для более поздней версии параллельных регионов, которые не указывают `num_threads` предложение. Он следующий:

```cpp
#include <omp.h>
void omp_set_num_threads(int num_threads);
```

Значение параметра *num_threads* должно быть положительным целым числом. Ее результат зависит от того, включен ли динамическую настройку количество потоков. Доступен широкий набор правил о взаимодействии между `omp_set_num_threads` функция и динамическую настройку потоков, см. в разделе 2.3.

Эта функция имеет эффекты, описанных выше, при вызове из части программы где `omp_in_parallel` функция возвращает нуль. Если он вызывается из части программы где `omp_in_parallel` функция возвращает ненулевое значение, то поведение этой функции не определено.

Этот вызов имеет приоритет над `OMP_NUM_THREADS` переменной среды. Значение по умолчанию для количества потоков, которые могут быть установлены, вызвав `omp_set_num_threads` или задав `OMP_NUM_THREADS` переменной среды, можно явно переопределить на отдельном `parallel` директив, указав `num_threads` предложение.

#### <a name="cross-references"></a>Перекрестные ссылки

- [omp_set_dynamic](#317-omp_set_dynamic-function) функции
- [omp_get_dynamic](#318-omp_get_dynamic-function) функции
- [OMP_NUM_THREADS](4-environment-variables.md#42-omp_num_threads) переменной среды
- [num_threads](2-3-parallel-construct.md) предложение

### <a name="312-ompgetnumthreads-function"></a>3.1.2 функция omp_get_num_threads

`omp_get_num_threads` Функция возвращает число потоков в настоящее время в команде выполнения параллельной области, из которого он вызывается. Он следующий:

```cpp
#include <omp.h>
int omp_get_num_threads(void);
```

`num_threads` Предложение, `omp_set_num_threads` функции и `OMP_NUM_THREADS` переменной среды управлять количеством потоков в группе.

Если число потоков не было явно установлено пользователем, значение по умолчанию определяется реализацией. Эта функция выполняет привязку к ближайший включающий `parallel` директива. Если вызывается из последовательной часть программы, или из вложенных параллельных регион, который сериализуется, эта функция возвращает 1.

#### <a name="cross-references"></a>Перекрестные ссылки

- [OMP_NUM_THREADS](4-environment-variables.md#42-omp_num_threads)
- [num_threads](2-3-parallel-construct.md)
- [parallel](2-3-parallel-construct.md)

### <a name="313-ompgetmaxthreads-function"></a>3.1.3 функция omp_get_max_threads

`omp_get_max_threads` Функция возвращает целое число, которое гарантированно по крайней мере число потоков, которые используются для формирования команды, если параллельной области без `num_threads` предложения были распознается на этом этапе в коде. Он следующий:

```cpp
#include <omp.h>
int omp_get_max_threads(void);
```

Следующие выражает нижняя граница диапазона на значении `omp_get_max_threads`:

```

threads-used-for-next-team
<= omp_get_max_threads
```

Обратите внимание, что если другой параллельной использует регион `num_threads` предложение, чтобы запросить определенное количество потоков, гарантии на нижнюю границу результат `omp_get_max_threads` не содержит много.

`omp_get_max_threads` Возвращаемое значение функции можно использовать для динамического выделения достаточный объем хранилища для всех потоков в группе, сформированный в следующей области параллельной обработки.

#### <a name="cross-references"></a>Перекрестные ссылки

- [omp_get_num_threads](#312-omp_get_num_threads-function)
- [omp_set_num_threads](#311-omp_set_num_threads-function)
- [omp_set_dynamic](#317-omp_set_dynamic-function)
- [num_threads](2-3-parallel-construct.md)

### <a name="314-ompgetthreadnum-function"></a>3.1.4 функция omp_get_thread_num

`omp_get_thread_num` Функция возвращает номер потока, в его команды потока, выполняющего функции. Поток номеров лежит между 0 и `omp_get_num_threads()`-1, включительно. Главный поток команды является потоком 0.

Он следующий:

```cpp
#include <omp.h>
int omp_get_thread_num(void);
```

При вызове из последовательной регион `omp_get_thread_num` возвращает 0. Если вызывается внутри параллельной области вложенного, сериализуется, эта функция возвращает 0.

#### <a name="cross-references"></a>Перекрестные ссылки

- [omp_get_num_threads](#312-omp_get_num_threads-function) функции

### <a name="315-ompgetnumprocs-function"></a>3.1.5 функция omp_get_num_procs

`omp_get_num_procs` Функция возвращает количество процессоров, доступных для программы в момент вызова функции. Он следующий:

```cpp
#include <omp.h>
int omp_get_num_procs(void);
```

### <a name="316-ompinparallel-function"></a>3.1.6 функция omp_in_parallel

`omp_in_parallel` Функция возвращает ненулевое значение, если он вызывается в рамках динамического степень параллельной области, выполняя в параллельном режиме; в противном случае возвращает 0. Он следующий:

```cpp
#include <omp.h>
int omp_in_parallel(void);
```

Эта функция возвращает ненулевое значение при вызове из в пределах региона параллельного выполнения, включая вложенные области, которые сериализуются.

### <a name="317-ompsetdynamic-function"></a>3.1.7 функция omp_set_dynamic

`omp_set_dynamic` Функция включает или отключает динамическую настройку количество потоков, доступных для выполнения параллельных регионов. Он следующий:

```cpp
#include <omp.h>
void omp_set_dynamic(int dynamic_threads);
```

Если *dynamic_threads* оценивает ненулевое значение, число потоков, которые используются для выполнения будущих параллельных регионов может корректироваться автоматически средой выполнения, чтобы лучше всего использовать системные ресурсы. Как следствие число потоков, указанный пользователем — максимальное число потоков. Число потоков в группе, выполнения параллельной области остается предопределенной продолжительность, область параллельной обработки, а также сообщается с помощью `omp_get_num_threads` функции.

Если *dynamic_threads* результатом является 0, динамическую настройку отключен.

Эта функция имеет эффекты, описанных выше, при вызове из части программы где `omp_in_parallel` функция возвращает нуль. Если он вызывается из части программы где `omp_in_parallel` функция возвращает ненулевое значение, то поведение этой функции не определено.

Вызов `omp_set_dynamic` имеет приоритет над `OMP_DYNAMIC` переменной среды.

Значение по умолчанию для динамической корректировки потоков определяется реализацией. В результате коды пользователей, которые зависят от определенное количество потоков для правильного выполнения следует явно отключить динамические потоки. Реализаций не требуется предоставить возможность динамически корректировать число потоков, но от них требуется предоставляют интерфейс для поддержки переносимости на всех платформах.

#### <a name="cross-references"></a>Перекрестные ссылки

- [omp_get_num_threads](#312-omp_get_num_threads-function)
- [OMP_DYNAMIC](4-environment-variables.md#43-omp_dynamic)
- [omp_in_parallel](#316-omp_in_parallel-function)

### <a name="318-ompgetdynamic-function"></a>3.1.8 функция omp_get_dynamic

`omp_get_dynamic` Функция возвращает ненулевое значение, если динамическую настройку потоков и в противном случае возвращает 0. Он следующий:

```cpp
#include <omp.h>
int omp_get_dynamic(void);
```

Если реализация не реализует динамическую настройку число потоков, эта функция всегда возвращает 0.

#### <a name="cross-references"></a>Перекрестные ссылки

- Описание динамического потока коррекции, см. в разделе [omp_set_dynamic](#317-omp_set_dynamic-function).

### <a name="319-ompsetnested-function"></a>3.1.9 функция omp_set_nested

`omp_set_nested` Функция включает или отключает вложенных параллелизма. Он следующий:

```cpp
#include <omp.h>
void omp_set_nested(int nested);
```

Если *вложенных* принимает значение 0, вложенные параллелизм отключен, который используется по умолчанию и вложенных параллельных регионов сериализуются и выполнены текущим потоком. В противном случае включен вложенный параллелизм и параллельных регионов, которые вложены может развернуть дополнительные потоки для формирования вложенных групп.

Эта функция имеет эффекты, описанных выше, при вызове из части программы где `omp_in_parallel` функция возвращает нуль. Если он вызывается из части программы где `omp_in_parallel` функция возвращает ненулевое значение, то поведение этой функции не определено.

Этот вызов имеет приоритет над `OMP_NESTED` переменной среды.

При включении вложенного параллелизма, число потоков, используемых для выполнения вложенных параллельных регионов определяется реализацией. В результате OpenMP совместимым реализаций разрешены для сериализации вложенных параллельных регионов, даже в том случае, если включен вложенный параллелизм.

#### <a name="cross-references"></a>Перекрестные ссылки

- [OMP_NESTED](4-environment-variables.md#44-omp_nested)
- [omp_in_parallel](#316-omp_in_parallel-function)

### <a name="3110-ompgetnested-function"></a>3.1.10 функция omp_get_nested

`omp_get_nested` Функция возвращает ненулевое значение, если включен вложенный параллелизм, а значение 0, если она отключена. Дополнительные сведения о вложенных параллелизма, см. в разделе [omp_set_nested](#319-omp_set_nested-function). Он следующий:

```cpp
#include <omp.h>
int omp_get_nested(void);
```

Если реализация не реализует вложенный параллелизм, эта функция всегда возвращает 0.

## <a name="32-lock-functions"></a>3.2 функции блокировки

Функции, описанные в этом разделе описано управление блокировок, которые используются для синхронизации.

Перечисленные ниже функции блокировки переменная должна иметь тип `omp_lock_t`. Эта переменная должен осуществляться только через эти функции. Все функции блокировки требуется аргумент, который содержит указатель на `omp_lock_t` типа.

- [Функции omp_init_lock](#321-omp_init_lock-and-omp_init_nest_lock-functions) функция инициализирует простой блокировки.
- [Функции omp_destroy_lock](#322-omp_destroy_lock-and-omp_destroy_nest_lock-functions) функция удаляет простой блокировки.
- [Функции omp_set_lock](#323-omp_set_lock-and-omp_set_nest_lock-functions) функция ожидает, пока не будет доступен простой блокировки.
- [Функции omp_unset_lock](#324-omp_unset_lock-and-omp_unset_nest_lock-functions) функция освобождает простой блокировки.
- [Функции omp_test_lock](#325-omp_test_lock-and-omp_test_nest_lock-functions) функция проверяет простой блокировки.

Перечисленные ниже функции блокировки переменная должна иметь тип `omp_nest_lock_t`.  Эта переменная должен осуществляться только через эти функции. Все функции вкладываемых блокировки требуется аргумент, который содержит указатель на `omp_nest_lock_t` типа.

- [Omp_init_nest_lock](#321-omp_init_lock-and-omp_init_nest_lock-functions) функция инициализирует вкладываемых блокировок.
- [Omp_destroy_nest_lock](#322-omp_destroy_lock-and-omp_destroy_nest_lock-functions) функция удаляет вкладываемых блокировок.
- [Omp_set_nest_lock](#323-omp_set_lock-and-omp_set_nest_lock-functions) функция ожидает, пока не станет доступна вкладываемых блокировок.
- [Omp_unset_nest_lock](#324-omp_unset_lock-and-omp_unset_nest_lock-functions) функция освобождает вкладываемых блокировок.
- [Omp_test_nest_lock](#325-omp_test_lock-and-omp_test_nest_lock-functions) функция проверяет вкладываемых блокировок.

Функции OpenMP блокировки доступе к переменной блокировки таким образом, что они всегда чтения и обновления наиболее текущее значение переменной блокировки. Таким образом, нет необходимости для программы OpenMP для включения явных `flush` директивы, чтобы убедиться в том, что значение переменной блокировки согласована среди различных потоков. (Может возникнуть необходимость в `flush` директивы, чтобы согласовать значения других переменных.)

### <a name="321-ompinitlock-and-ompinitnestlock-functions"></a>3.2.1 функции omp_init_lock и omp_init_nest_lock

Эти функции представляют собой единственный способ инициализации блокировки. Каждая функция инициализирует блокировкой, связанной с параметром *блокировки* для использования в будущих вызовах. Он следующий:

```cpp
#include <omp.h>
void omp_init_lock(omp_lock_t *lock);
void omp_init_nest_lock(omp_nest_lock_t *lock);
```

Начальное состояние разблокируется (то есть, ни один поток не владеет блокировкой). Вкладываемых блокировок исходное количество вложенности равен нулю. Он не соответствует требованиям, если ни один из этих подпрограмм с переменной блокировки, который уже был инициализирован.

### <a name="322-ompdestroylock-and-ompdestroynestlock-functions"></a>3.2.2 функции omp_destroy_lock и omp_destroy_nest_lock функции

Эти функции убедитесь, что указывает заблокировать переменную *блокировки* не инициализирована. Он следующий:

```cpp
#include <omp.h>
void omp_destroy_lock(omp_lock_t *lock);
void omp_destroy_nest_lock(omp_nest_lock_t *lock);
```

Он не соответствует политике для вызова одной из этих подпрограмм с переменной блокировки, которая не инициализирована или разблокирован.

### <a name="323-ompsetlock-and-ompsetnestlock-functions"></a>3.2.3 функции omp_set_lock и omp_set_nest_lock функции

Каждая из этих функций блокирует поток, выполняющий функции, пока указанная блокировка доступна, а затем устанавливает блокировку. Простой блокировка доступна, если это разблокирован. Вкладываемых блокировка доступна, если это разблокирован или если он уже принадлежит поток, выполняющий функции. Он следующий:

```cpp
#include <omp.h>
void omp_set_lock(omp_lock_t *lock);
void omp_set_nest_lock(omp_nest_lock_t *lock);
```

Для простой блокировки, аргумент `omp_set_lock` функции должен указывать на переменную инициализированный блокировки. Поток, выполняющий функции предоставляется владельцем блокировки.

Вкладываемых блокировок, аргумент `omp_set_nest_lock` функции должен указывать на переменную инициализированный блокировки. Вложенности увеличивается, и предоставляется потоком, или же отслеживает владельца блокировки.

### <a name="324-ompunsetlock-and-ompunsetnestlock-functions"></a>3.2.4 функции omp_unset_lock и omp_unset_nest_lock функции

Эти функции предоставляют средства по освобождению владельца блокировки. Он следующий:

```cpp
#include <omp.h>
void omp_unset_lock(omp_lock_t *lock);
void omp_unset_nest_lock(omp_nest_lock_t *lock);
```

Аргумент для каждой из этих функций должен указывать на переменную инициализированный блокировки, принадлежащий потоку выполнения функции. Поведение не определено, если поток не является владельцем блокировки.

Для простой блокировки `omp_unset_lock` функция освобождает поток, выполняющий функции из владельца блокировки.

Вкладываемых блокировок `omp_unset_nest_lock` уменьшает число вложенности и функции выпусков поток, выполняющий функцию с владельцем блокировки, если счетчик принял значение ноль.

### <a name="325-omptestlock-and-omptestnestlock-functions"></a>3.2.5 функции omp_test_lock и omp_test_nest_lock функции

Эти функции пытаются установить блокировку, но не блокировать выполнение потока. Он следующий:

```cpp
#include <omp.h>
int omp_test_lock(omp_lock_t *lock);
int omp_test_nest_lock(omp_nest_lock_t *lock);
```

Аргумент должен указывать на переменную инициализированный блокировки. Эти функции пытаются установить блокировку так же, как `omp_set_lock` и `omp_set_nest_lock`, за исключением того, что они не блокировали выполнение потока.

Для простой блокировки `omp_test_lock` функция возвращает ненулевое значение, если блокировка успешно задан; в противном случае возвращается ноль.

Вкладываемых блокировок `omp_test_nest_lock` функция возвращает новый счетчик вложенности, если блокировка успешно задан; в противном случае возвращается ноль.

## <a name="33-timing-routines"></a>3.3 процедуры расписания

Функции, описанные в этом разделе поддерживают переносимой физическое таймера:

- [Omp_get_wtime](#331-omp_get_wtime-function) функция возвращает прошедшее время.
- [Omp_get_wtick](#332-omp_get_wtick-function) функция возвращает секунд между последовательными тактов.

### <a name="331-ompgetwtime-function"></a>3.3.1 функция omp_get_wtime

`omp_get_wtime` Функция возвращает значение с плавающей запятой двойной точности, равным затраченного реального времени в секундах с момента некоторые «времени в прошлом».  Фактическое «время в прошлом» может быть произвольным, но он гарантировано не изменяется во время выполнения программы приложения. Он следующий:

```cpp
#include <omp.h>
double omp_get_wtime(void);
```

Предполагается, что функция будет использоваться для измерения времени, затраченного на, как показано в следующем примере:

```cpp
double start;
double end;
start = omp_get_wtime();
... work to be timed ...
end = omp_get_wtime();
printf_s("Work took %f sec. time.\n", end-start);
```

Время, возвращаемое API являются «по потокам раз», что означало, что пользователям не нужно быть глобально согласованного для всех потоков, участвующих в приложении.

### <a name="332-ompgetwtick-function"></a>3.3.2 функция omp_get_wtick

`omp_get_wtick` Функция возвращает значение двойной точности с плавающей запятой, равное количеству секунд между последовательными тактов. Он следующий:

```cpp
#include <omp.h>
double omp_get_wtick(void);
```
