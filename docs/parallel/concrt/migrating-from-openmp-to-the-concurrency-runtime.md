---
title: Переход от OpenMP к среде выполнения с параллелизмом
ms.date: 11/04/2016
helpviewer_keywords:
- Concurrency Runtime, migrating from OpenMP
- OpenMP, migrating to the Concurrency Runtime
ms.assetid: 9bab7bb1-e45d-44b2-8509-3b226be2c93b
ms.openlocfilehash: 081d0ae8b312d827a0af98dd45c62f7563e81677
ms.sourcegitcommit: a1676bf6caae05ecd698f26ed80c08828722b237
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/29/2020
ms.locfileid: "91507764"
---
# <a name="migrating-from-openmp-to-the-concurrency-runtime"></a>Переход от OpenMP к среде выполнения с параллелизмом

Среда выполнения с параллелизмом позволяет использовать самые разные модели программирования. Эти модели могут перекрываться с моделями других библиотек или дополнять их. Документы в этом разделе сравнивают [OpenMP](../../parallel/concrt/comparing-the-concurrency-runtime-to-other-concurrency-models.md#openmp) с среда выполнения с параллелизмом и предоставляют примеры переноса существующего кода OpenMP для использования среда выполнения с параллелизмом.

Модель программирования OpenMP определяется открытым стандартом и обладает четко определенными привязками к языкам программирования Fortran и C/C++. OpenMP версий 2,0 и 2,5, которые поддерживаются компилятором Microsoft C++, хорошо подходят для параллельных алгоритмов, которые являются итеративными. то есть они выполняют параллельную итерацию по массиву данных. OpenMP 3,0 поддерживает неитеративные задачи в дополнение к итеративным задачам.

OpenMP работает наиболее эффективно при предопределенной степени параллелизма и соответствующем уровне доступных ресурсов в системе. Модель OpenMP особенно хорошо подходит для высокопроизводительных вычислений, где очень большие вычислительные проблемы распределяются по вычислительным ресурсам одного компьютера. В этом сценарии аппаратная среда обычно исправлена, и разработчик может рассчитывать на монопольный доступ ко всем вычислительным ресурсам при выполнении алгоритма.

Однако менее ограниченные вычислительные среды не могут быть хорошим соответствием OpenMP. Например, рекурсивные проблемы (например, алгоритм quicksort или поиск дерева данных) сложнее реализовать с помощью OpenMP 2,0 и 2,5. Среда выполнения с параллелизмом дополняет возможности OpenMP, предоставляя [библиотеку асинхронных агентов](../../parallel/concrt/asynchronous-agents-library.md) и [библиотеку параллельных шаблонов](../../parallel/concrt/parallel-patterns-library-ppl.md) (PPL). Библиотека асинхронных агентов поддерживает недетализированный параллелизм задач. PPL поддерживает более детализированные параллельные задачи. Среда выполнения с параллелизмом предоставляет инфраструктуру, необходимую для параллельного выполнения операций, что позволяет сосредоточиться на логике приложения. Однако, поскольку среда выполнения с параллелизмом поддерживает разнообразные модели программирования, затраты на его планирование могут быть больше других библиотек параллелизма, таких как OpenMP. Поэтому рекомендуется постепенно проверять производительность при преобразовании существующего кода OpenMP для использования среда выполнения с параллелизмом.

## <a name="when-to-migrate-from-openmp-to-the-concurrency-runtime"></a>Когда следует переходить с OpenMP на среда выполнения с параллелизмом

Перенос существующего кода OpenMP может оказаться предпочтительным для использования среда выполнения с параллелизмом в следующих случаях.

|Случаи|Преимущества среда выполнения с параллелизмом|
|-----------|-------------------------------------------|
|Требуется расширяемая среда параллельного программирования.|Многие функции в среде выполнения с параллелизмом можно расширить. Кроме того, можно объединять существующие функции для создания новых. Поскольку OpenMP опирается на директивы компилятора, ее нельзя легко расширить.|
|Приложение может воспользоваться преимуществами совместной блокировки.|Если задача блокируется, так как для нее требуется ресурс, который еще недоступен, среда выполнения с параллелизмом может выполнять другие задачи, пока первая задача ожидает ресурс.|
|Приложение может воспользоваться преимуществами динамической балансировки нагрузки.|Среда выполнения с параллелизмом использует алгоритм планирования, который корректирует распределение вычислительных ресурсов при изменении рабочих нагрузок. В OpenMP, когда планировщик выделяет вычислительные ресурсы в параллельной области, эти выделения ресурсов фиксируются во время вычисления.|
|Требуется поддержка обработки исключений.|PPL позволяет перехватывать исключения как внутри, так и вне параллельной области или цикла. В OpenMP необходимо выполнять обработку исключения внутри параллельной области или цикла.|
|Требуется механизм отмены.|PPL позволяет приложениям отменять как отдельные задачи, так и параллельные деревья работы. Для OpenMP требуется, чтобы приложение реализовало собственный механизм отмены.|
|Требуется, чтобы параллельный код запускался в другом контексте, с которого он запускается.|Среда выполнения с параллелизмом позволяет запускать задачу в одном контексте, а затем дожидаться или отменять эту задачу в другом контексте. В OpenMP вся параллельная работа должна завершиться в контексте, с которого она начинается.|
|Требуется расширенная поддержка отладки.|Visual Studio предоставляет окна **параллельных стеков** и **параллельных задач** , что упрощает отладку многопоточных приложений.<br /><br /> Дополнительные сведения о поддержке отладки для среда выполнения с параллелизмом см. в разделе [Использование окна "задачи](/visualstudio/debugger/using-the-tasks-window)" в окне ["Параллельные стеки](/visualstudio/debugger/using-the-parallel-stacks-window)" и [Пошаговое руководство. Отладка параллельного приложения](/visualstudio/debugger/walkthrough-debugging-a-parallel-application).|

## <a name="when-not-to-migrate-from-openmp-to-the-concurrency-runtime"></a>Когда не следует переходить с OpenMP на среда выполнения с параллелизмом

В следующих случаях описывается, когда может оказаться неуместной Миграция существующего кода OpenMP для использования среда выполнения с параллелизмом.

|Случаи|Объяснение|
|-----------|-----------------|
|Приложение уже соответствует вашим требованиям.|Если вы удовлетворены производительностью приложения и текущей поддержкой отладки, миграция может быть неуместной.|
|Тела параллельных циклов выполняют небольшие усилия.|Дополнительная нагрузка планировщика задач среда выполнения с параллелизмом может не компенсировать преимущества параллельного выполнения тела цикла, особенно если тело цикла относительно невелико.|
|Приложение написано на языке C.|Поскольку среда выполнения с параллелизмом использует многие функции C++, он может оказаться непригодным, если нельзя написать код, позволяющий приложению C полностью использовать его.|

## <a name="related-topics"></a>См. также

[Как преобразовать параллельный цикл for OpenMP в использование среда выполнения с параллелизмом](../../parallel/concrt/how-to-convert-an-openmp-parallel-for-loop-to-use-the-concurrency-runtime.md)

С учетом базового цикла, в котором используются директивы OpenMP [Parallel](../../parallel/concrt/how-to-use-parallel-invoke-to-write-a-parallel-sort-routine.md#parallel) и [for](../openmp/reference/openmp-directives.md#for-openmp) , показано, как преобразовать его для использования алгоритма среда выполнения с параллелизмом [Concurrency::p arallel_for](reference/concurrency-namespace-functions.md#parallel_for) .

[Как преобразовать цикл OpenMP, использующий отмену, для использования среда выполнения с параллелизмом](../../parallel/concrt/convert-an-openmp-loop-that-uses-cancellation.md)<br/>
При наличии [параллельного](../../parallel/concrt/how-to-use-parallel-invoke-to-write-a-parallel-sort-routine.md#parallel)цикла[for](../openmp/reference/openmp-directives.md#for-openmp) , который не требует выполнения всех итераций, демонстрирует, как преобразовать его для использования механизма отмены среда выполнения с параллелизмом.

[Как преобразовать цикл OpenMP, использующий обработку исключений, для использования среда выполнения с параллелизмом](../../parallel/concrt/convert-an-openmp-loop-that-uses-exception-handling.md)<br/>
При наличии [параллельного](../../parallel/concrt/how-to-use-parallel-invoke-to-write-a-parallel-sort-routine.md#parallel)цикла[for](../openmp/reference/openmp-directives.md#for-openmp) , выполняющего обработку исключений, демонстрируется способ его преобразования для использования механизма обработки исключений среда выполнения с параллелизмом.

[Как преобразовать цикл OpenMP, использующий переменную сокращения, для использования среда выполнения с параллелизмом](../../parallel/concrt/convert-an-openmp-loop-that-uses-a-reduction-variable.md)<br/>
При наличии цикла [параллельных](../../parallel/concrt/how-to-use-parallel-invoke-to-write-a-parallel-sort-routine.md#parallel)[for](../openmp/reference/openmp-directives.md#for-openmp) циклов OpenMP, в котором используется предложение [reduction](../openmp/reference/openmp-clauses.md#reduction) , демонстрируется преобразование для использования среда выполнения с параллелизмом.

## <a name="see-also"></a>См. также раздел

[Среда выполнения с параллелизмом](../../parallel/concrt/concurrency-runtime.md)<br/>
[OpenMP](../../parallel/concrt/comparing-the-concurrency-runtime-to-other-concurrency-models.md#openmp)<br/>
[Библиотека параллельных шаблонов](../../parallel/concrt/parallel-patterns-library-ppl.md)<br/>
[библиотеку асинхронных агентов](../../parallel/concrt/asynchronous-agents-library.md)
