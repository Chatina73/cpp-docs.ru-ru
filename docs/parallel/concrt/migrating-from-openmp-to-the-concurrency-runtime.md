---
title: Переход от OpenMP к среде выполнения с параллелизмом
ms.date: 11/04/2016
helpviewer_keywords:
- Concurrency Runtime, migrating from OpenMP
- OpenMP, migrating to the Concurrency Runtime
ms.assetid: 9bab7bb1-e45d-44b2-8509-3b226be2c93b
ms.openlocfilehash: 78fa83c30bc55d82ffa5d2ba1e7d65472643f86b
ms.sourcegitcommit: ee0103752884425843556a19cf418a504dc3cd02
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/21/2018
ms.locfileid: "53737628"
---
# <a name="migrating-from-openmp-to-the-concurrency-runtime"></a>Переход от OpenMP к среде выполнения с параллелизмом

Среда выполнения с параллелизмом позволяет использовать самые разные модели программирования. Эти модели могут перекрываться с моделями других библиотек или дополнять их. Документы в этом разделе сравнения [OpenMP](../../parallel/concrt/comparing-the-concurrency-runtime-to-other-concurrency-models.md#openmp) среду выполнения с параллелизмом и приводятся примеры о переносе существующего кода OpenMP для использования среды выполнения с параллелизмом.

Модель программирования OpenMP определяется открытым стандартом и обладает четко определенными привязками к языкам программирования Fortran и C/C++. OpenMP версий 2.0 и 2.5, в котором поддерживаются с помощью компилятора Visual C++, хорошо подходят для параллельных алгоритмов, которые являются итеративными; то есть они выполняют параллельные итерации по массиву данных. OpenMP 3.0 поддерживает не только итеративные задачи в дополнение к итеративной задачи.

OpenMP работает наиболее эффективно при предопределенной степени параллелизма и соответствующем уровне доступных ресурсов в системе. Модель OpenMP является особенно хорошо подходит для высокопроизводительных вычислительных систем, где очень крупные вычислительные задачи распределяются по вычислительным ресурсам на одном компьютере. В этом случае аппаратная среда обычно не меняется, и разработчик может рассчитывать на монопольный доступ к вычислительным ресурсам при выполнении алгоритма.

Тем не менее менее ограниченные вычислительные среды могут не быть хорошо подходит для использования OpenMP. Например рекурсивные задачи (например, алгоритм быстрой сортировки или поиск в дереве данных), более сложно реализовать с помощью OpenMP 2.0 и 2.5. Среда выполнения с параллелизмом дополняет возможности OpenMP, предоставляя [Asynchronous Agents Library](../../parallel/concrt/asynchronous-agents-library.md) и [библиотеку параллельных шаблонов](../../parallel/concrt/parallel-patterns-library-ppl.md) (PPL). Библиотека асинхронных агентов поддерживает параллелизма недетализированных задач; PPL поддерживает более детализированные параллельные задачи. Среда выполнения с параллелизмом предоставляет инфраструктуру, которая необходима для выполнения операций в параллельном режиме, что можно сосредоточиться на логике приложения. Тем не менее так как среда выполнения с параллелизмом позволяет использовать самые разные модели программирования, затраты на его планирование может быть больше, чем другие библиотеки параллелизма, например OpenMP. Поэтому рекомендуется провести тестирование производительности постепенно при преобразовании существующего кода OpenMP для использования среды выполнения с параллелизмом.

## <a name="when-to-migrate-from-openmp-to-the-concurrency-runtime"></a>Когда миграция из OpenMP в среду выполнения с параллелизмом

Может быть целесообразно для миграции существующего кода OpenMP для использования среды выполнения с параллелизмом в следующих случаях.

|Cases|Преимущества среды выполнения с параллелизмом|
|-----------|-------------------------------------------|
|Требуется расширяемой платформой параллельного программирования.|Многие функции в среде выполнения с параллелизмом можно расширить. Кроме того, можно объединять существующие функции для создания новых. Поскольку модель OpenMP основывается на директивах компилятора, он не так легко расширять.|
|Приложения могут с выгодой совместной блокировки.|Если задача блокируется, так как ему требуется ресурс, который еще не доступна, среда выполнения с параллелизмом можно выполнить другие задачи, пока первая задача ожидает ресурс.|
|Приложения получают преимущества от динамического распределения нагрузки.|Среда выполнения с параллелизмом использует алгоритм планирования, который изменяет выделение вычислительных ресурсов, при изменении рабочей нагрузки. В OpenMP, когда планировщик выделяет вычислительные ресурсы для параллельной области, эти применяется фиксированное выделение ресурсов на протяжении всего вычисления.|
|Требуется поддержку обработки исключений.|PPL позволяет перехватывать исключения внутри и вне параллельной области или цикла. В OpenMP необходимо обрабатывать исключение внутри параллельной области или цикла.|
|Требуется механизм отмены.|PPL позволяет приложениям отменять отдельные задачи и деревья параллельной работы. OpenMP приложению придется реализовать собственный механизм отмены.|
|Требуется параллельного кода в другом контексте, из которой он запускается.|Среда выполнения с параллелизмом позволяет запустить задачу в одном контексте и затем ждут или отменить эту задачу в другом контексте. В OpenMP вся параллельная работа должна быть завершена в контексте, из которой он запускается.|
|Вам требуется расширенная поддержка отладки.|Visual Studio предоставляет **Параллельные стеки** и **параллельных задач** windows, можно упростить отладку многопоточных приложений.<br /><br /> Дополнительные сведения об отладке поддержка среды выполнения с параллелизмом, см. в разделе [использование окна задач](/visualstudio/debugger/using-the-tasks-window), [в окне параллельных стеков](/visualstudio/debugger/using-the-parallel-stacks-window), и [Пошаговое руководство: Отладка параллельного приложения](/visualstudio/debugger/walkthrough-debugging-a-parallel-application).|

## <a name="when-not-to-migrate-from-openmp-to-the-concurrency-runtime"></a>Когда не следует миграция из OpenMP в среду выполнения с параллелизмом

Следующие варианты описания не может быть выгодна миграция существующего кода OpenMP для использования среды выполнения с параллелизмом.

|Cases|Объяснение|
|-----------|-----------------|
|Ваше приложение уже удовлетворяет вашим требованиям.|Если вас устраивает производительность приложения и поддержка отладки, миграция может не подойти.|
|Ваши основные части параллельных циклов выполняют слишком мало работы.|Затраты на планировщик задач среды выполнения с параллелизмом не могут компенсировать преимущества выполнения тело цикла в параллельном режиме, особенно в том случае, если тело цикла относительно невелико.|
|Ваше приложение написано на языке C.|Так как среда выполнения с параллелизмом использует множество функций C++, его могут не подходить при написании кода, которая позволяет приложению C, чтобы полностью использовать нельзя.|

## <a name="related-topics"></a>См. также

[Практическое руководство. Преобразование OpenMP параллельного цикла для использования среды выполнения с параллелизмом](../../parallel/concrt/how-to-convert-an-openmp-parallel-for-loop-to-use-the-concurrency-runtime.md)

Простой цикл, использующий OpenMP [параллельных](../../parallel/concrt/how-to-use-parallel-invoke-to-write-a-parallel-sort-routine.md#parallel) и [для](../../parallel/openmp/reference/for-openmp.md) директивы, показано, как преобразовать для использования среды выполнения с параллелизмом [concurrency::parallel_for](reference/concurrency-namespace-functions.md#parallel_for) алгоритм.

[Практическое руководство. Преобразование цикла OpenMP, использующего отмену для использования среды выполнения с параллелизмом](../../parallel/concrt/convert-an-openmp-loop-that-uses-cancellation.md)<br/>
Учитывая OpenMP [параллельных](../../parallel/concrt/how-to-use-parallel-invoke-to-write-a-parallel-sort-routine.md#parallel)[для](../../parallel/openmp/reference/for-openmp.md) цикл, который не требует всех итераций, выполняемых, показано, как преобразовать его для использования механизма отмены среда выполнения с параллелизмом.

[Практическое руководство. Преобразование цикла OpenMP, использующего обработку исключений для использования среды выполнения с параллелизмом](../../parallel/concrt/convert-an-openmp-loop-that-uses-exception-handling.md)<br/>
Учитывая OpenMP [параллельных](../../parallel/concrt/how-to-use-parallel-invoke-to-write-a-parallel-sort-routine.md#parallel)[для](../../parallel/openmp/reference/for-openmp.md) цикл, который выполняет обработку исключений, показано, как преобразовать его для использования механизма обработки исключений среды выполнения с параллелизмом.

[Практическое руководство. Преобразование цикла OpenMP, использующего переменную сокращения для использования среды выполнения с параллелизмом](../../parallel/concrt/convert-an-openmp-loop-that-uses-a-reduction-variable.md)<br/>
Учитывая OpenMP [параллельных](../../parallel/concrt/how-to-use-parallel-invoke-to-write-a-parallel-sort-routine.md#parallel)[для](../../parallel/openmp/reference/for-openmp.md) цикл, использующий [сокращения](../../parallel/openmp/reference/reduction.md) предложение, показано, как преобразовать для использования среды выполнения с параллелизмом.

## <a name="see-also"></a>См. также

[Среда выполнения с параллелизмом](../../parallel/concrt/concurrency-runtime.md)<br/>
[OpenMP](../../parallel/concrt/comparing-the-concurrency-runtime-to-other-concurrency-models.md#openmp)<br/>
[Библиотека параллельных шаблонов (PPL)](../../parallel/concrt/parallel-patterns-library-ppl.md)<br/>
[Библиотека асинхронных агентов](../../parallel/concrt/asynchronous-agents-library.md)

