---
title: Структура IScheduler
ms.date: 11/04/2016
f1_keywords:
- IScheduler
- CONCRTRM/concurrency::IScheduler
- CONCRTRM/concurrency::IScheduler::IScheduler::AddVirtualProcessors
- CONCRTRM/concurrency::IScheduler::IScheduler::GetId
- CONCRTRM/concurrency::IScheduler::IScheduler::GetPolicy
- CONCRTRM/concurrency::IScheduler::IScheduler::NotifyResourcesExternallyBusy
- CONCRTRM/concurrency::IScheduler::IScheduler::NotifyResourcesExternallyIdle
- CONCRTRM/concurrency::IScheduler::IScheduler::RemoveVirtualProcessors
- CONCRTRM/concurrency::IScheduler::IScheduler::Statistics
helpviewer_keywords:
- IScheduler structure
ms.assetid: 471de85a-2b1a-4b6d-ab81-2eff2737161e
ms.openlocfilehash: cd7b04b0dc5ca1bc496ce87a6459d00ed5813bf7
ms.sourcegitcommit: a8ef52ff4a4944a1a257bdaba1a3331607fb8d0f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/11/2020
ms.locfileid: "77142323"
---
# <a name="ischeduler-structure"></a>Структура IScheduler

Интерфейс для абстракции планировщика работы. Диспетчер ресурсов среды выполнения с параллелизмом использует этот интерфейс для взаимодействия с планировщиками работы.

## <a name="syntax"></a>Синтаксис

```cpp
struct IScheduler;
```

## <a name="members"></a>Члены

### <a name="public-methods"></a>Открытые методы

|Имя|Description|
|----------|-----------------|
|[IScheduler:: Аддвиртуалпроцессорс](#addvirtualprocessors)|Предоставляет планировщик с набором корней виртуального процессора для его использования. Каждый интерфейс `IVirtualProcessorRoot` представляет право на выполнение одного потока, который может выполнять работу от имени планировщика.|
|[IScheduler:: GetId](#getid)|Возвращает уникальный идентификатор для планировщика.|
|[IScheduler:: Policy](#getpolicy)|Возвращает копию политики планировщика. Дополнительные сведения о политиках планировщика см. в разделе [SchedulerPolicy](schedulerpolicy-class.md).|
|[IScheduler:: Нотифиресаурцесекстерналлибуси](#notifyresourcesexternallybusy)|Уведомляет этот планировщик о том, что аппаратные потоки, представленные набором корней виртуального процессора в массиве `ppVirtualProcessorRoots` теперь используются другими планировщиками.|
|[IScheduler:: Нотифиресаурцесекстерналлидле](#notifyresourcesexternallyidle)|Уведомляет этот планировщик о том, что аппаратные потоки, представленные набором корней виртуального процессора в массиве `ppVirtualProcessorRoots`, не используются другими планировщиками.|
|[IScheduler:: Ремовевиртуалпроцессорс](#removevirtualprocessors)|Инициирует удаление корней виртуального процессора, которые ранее были выделены этому планировщику.|
|[IScheduler:: Statistics](#statistics)|Предоставляет сведения, относящиеся к прибытии задач и тарифам на завершение, а также изменение длины очереди для планировщика.|

## <a name="remarks"></a>Remarks

При реализации пользовательского планировщика, взаимодействующего с диспетчер ресурсов, необходимо предоставить реализацию интерфейса `IScheduler`. Этот интерфейс является одним концом двустороннего канала связи между планировщиком и диспетчер ресурсов. Другой элемент представляется `IResourceManager` и `ISchedulerProxy` интерфейсами, которые реализуются диспетчер ресурсов.

## <a name="inheritance-hierarchy"></a>Иерархия наследования

`IScheduler`

## <a name="requirements"></a>Требования

**Заголовок:** concrtrm. h

**Пространство имен:** concurrency

## <a name="addvirtualprocessors"></a>Метод IScheduler:: Аддвиртуалпроцессорс

Предоставляет планировщик с набором корней виртуального процессора для его использования. Каждый интерфейс `IVirtualProcessorRoot` представляет право на выполнение одного потока, который может выполнять работу от имени планировщика.

```cpp
virtual void AddVirtualProcessors(
    _In_reads_(count) IVirtualProcessorRoot** ppVirtualProcessorRoots,
    unsigned int count) = 0;
```

### <a name="parameters"></a>Параметры

*ппвиртуалпроцессоррутс*<br/>
Массив `IVirtualProcessorRoot` интерфейсов, представляющих корни виртуального процессора, добавляемые в планировщик.

*count*<br/>
Число `IVirtualProcessorRoot` интерфейсов в массиве.

### <a name="remarks"></a>Remarks

Диспетчер ресурсов вызывает метод `AddVirtualProcessor`, чтобы предоставить планировщику начальный набор корней виртуального процессора. Он также может вызвать метод, чтобы добавить корни виртуального процессора в планировщик при повторной балансировке ресурсов между планировщиками.

## <a name="getid"></a>Метод IScheduler:: GetId

Возвращает уникальный идентификатор для планировщика.

```cpp
virtual unsigned int GetId() const = 0;
```

### <a name="return-value"></a>Возвращаемое значение

Уникальный целочисленный идентификатор.

### <a name="remarks"></a>Remarks

Для получения уникального идентификатора объекта, реализующего интерфейс `IScheduler`, следует использовать функцию [жетсчедулерид](concurrency-namespace-functions.md) , прежде чем использовать интерфейс в качестве параметра для методов, предоставляемых диспетчер ресурсов. При вызове функции `GetId` должен возвращаться тот же идентификатор.

Идентификатор, полученный из другого источника, может привести к неопределенному поведению.

## <a name="getpolicy"></a>Метод IScheduler:: Policy

Возвращает копию политики планировщика. Дополнительные сведения о политиках планировщика см. в разделе [SchedulerPolicy](schedulerpolicy-class.md).

```cpp
virtual SchedulerPolicy GetPolicy() const = 0;
```

### <a name="return-value"></a>Возвращаемое значение

Копия политики планировщика.

## <a name="notifyresourcesexternallybusy"></a>Метод IScheduler:: Нотифиресаурцесекстерналлибуси

Уведомляет этот планировщик о том, что аппаратные потоки, представленные набором корней виртуального процессора в массиве `ppVirtualProcessorRoots` теперь используются другими планировщиками.

```cpp
virtual void NotifyResourcesExternallyBusy(
    _In_reads_(count) IVirtualProcessorRoot** ppVirtualProcessorRoots,
    unsigned int count) = 0;
```

### <a name="parameters"></a>Параметры

*ппвиртуалпроцессоррутс*<br/>
Массив `IVirtualProcessorRoot` интерфейсов, связанных с аппаратными потоками, на которых перестают быть загружены другие планировщики.

*count*<br/>
Число `IVirtualProcessorRoot` интерфейсов в массиве.

### <a name="remarks"></a>Remarks

В то же время определенный аппаратный поток может быть назначен нескольким планировщикам одновременно. Одна из причин этого заключается в том, что в системе недостаточно аппаратных потоков для удовлетворения минимального параллелизма для всех планировщиков без совместного использования ресурсов. Другой вариант заключается в том, что ресурсы временно назначаются другим планировщикам, когда планировщик не использует их, путем отключения всех корней виртуального процессора в этом аппаратном потоке.

Уровень подписки аппаратного потока определяется количеством подписанных потоков и активированными корнями виртуальных процессоров, связанными с этим аппаратным потоком. С точки зрения определенного планировщика уровень внешней подписки аппаратного потока — это часть подписки, в которой участвуют другие планировщики. Уведомления о занятости ресурсов извне отправляются планировщику, когда уровень внешней подписки для аппаратного потока перемещается с нуля на положительную территорию.

Уведомления с помощью этого метода отправляются только планировщикам, имеющим политику, где значение ключа политики `MinConcurrency` равно значению для ключа политики `MaxConcurrency`. Дополнительные сведения о политиках планировщика см. в разделе [SchedulerPolicy](schedulerpolicy-class.md).

Планировщик, который соответствует уведомлениям, получает набор начальных уведомлений при его создании, уведомляя его о том, что ресурсы, которые были только что назначены, находятся вне зависимости от того, были ли они загружены.

## <a name="notifyresourcesexternallyidle"></a>Метод IScheduler:: Нотифиресаурцесекстерналлидле

Уведомляет этот планировщик о том, что аппаратные потоки, представленные набором корней виртуального процессора в массиве `ppVirtualProcessorRoots`, не используются другими планировщиками.

```cpp
virtual void NotifyResourcesExternallyIdle(
    _In_reads_(count) IVirtualProcessorRoot** ppVirtualProcessorRoots,
    unsigned int count) = 0;
```

### <a name="parameters"></a>Параметры

*ппвиртуалпроцессоррутс*<br/>
Массив `IVirtualProcessorRoot` интерфейсов, связанных с аппаратными потоками, в которых другие планировщики стали неактивными.

*count*<br/>
Число `IVirtualProcessorRoot` интерфейсов в массиве.

### <a name="remarks"></a>Remarks

В то же время определенный аппаратный поток может быть назначен нескольким планировщикам одновременно. Одна из причин этого заключается в том, что в системе недостаточно аппаратных потоков для удовлетворения минимального параллелизма для всех планировщиков без совместного использования ресурсов. Другой вариант заключается в том, что ресурсы временно назначаются другим планировщикам, когда планировщик не использует их, путем отключения всех корней виртуального процессора в этом аппаратном потоке.

Уровень подписки аппаратного потока определяется количеством подписанных потоков и активированными корнями виртуальных процессоров, связанными с этим аппаратным потоком. С точки зрения определенного планировщика уровень внешней подписки аппаратного потока — это часть подписки, в которой участвуют другие планировщики. Уведомления о занятости ресурсов извне отправляются планировщику, когда уровень внешней подписки для аппаратного потока становится нулевым из предыдущего положительного значения.

Уведомления с помощью этого метода отправляются только планировщикам, имеющим политику, где значение ключа политики `MinConcurrency` равно значению для ключа политики `MaxConcurrency`. Дополнительные сведения о политиках планировщика см. в разделе [SchedulerPolicy](schedulerpolicy-class.md).

Планировщик, который соответствует уведомлениям, получает набор начальных уведомлений при его создании, уведомляя его о том, что ресурсы, которые были только что назначены, находятся вне зависимости от того, были ли они загружены.

## <a name="removevirtualprocessors"></a>Метод IScheduler:: Ремовевиртуалпроцессорс

Инициирует удаление корней виртуального процессора, которые ранее были выделены этому планировщику.

```cpp
virtual void RemoveVirtualProcessors(
    _In_reads_(count) IVirtualProcessorRoot** ppVirtualProcessorRoots,
    unsigned int count) = 0;
```

### <a name="parameters"></a>Параметры

*ппвиртуалпроцессоррутс*<br/>
Массив `IVirtualProcessorRoot` интерфейсов, представляющих удаляемые корни виртуального процессора.

*count*<br/>
Число `IVirtualProcessorRoot` интерфейсов в массиве.

### <a name="remarks"></a>Remarks

Диспетчер ресурсов вызывает метод `RemoveVirtualProcessors`, чтобы вернуть набор корней виртуального процессора из планировщика. Предполагается, что планировщик вызывает метод [Remove](iexecutionresource-structure.md#remove) для каждого интерфейса, когда он выполняется с корнями виртуального процессора. Не используйте `IVirtualProcessorRoot` интерфейс после вызова метода `Remove`.

Параметр `ppVirtualProcessorRoots` указывает на массив интерфейсов. В наборе корней виртуального процессора, которые необходимо удалить, никогда не были активированы корневые элементы, которые можно возвратить немедленно с помощью метода `Remove`. Корневые элементы, которые были активированы и которые либо выполняют работу, либо были отключены и ожидают поступления работы, должны возвращаться асинхронно. Планировщик должен сделать все попытки удалить корень виртуального процессора как можно быстрее. Задержка удаления корней виртуального процессора может привести к непреднамеренной превышению лимита подписки в планировщике.

## <a name="statistics"></a>Метод IScheduler:: Statistics

Предоставляет сведения, относящиеся к прибытии задач и тарифам на завершение, а также изменение длины очереди для планировщика.

```cpp
virtual void Statistics(
    _Out_ unsigned int* pTaskCompletionRate,
    _Out_ unsigned int* pTaskArrivalRate,
    _Out_ unsigned int* pNumberOfTasksEnqueued) = 0;
```

### <a name="parameters"></a>Параметры

*птасккомплетионрате*<br/>
Число задач, выполненных планировщиком с момента последнего вызова этого метода.

*птаскарривалрате*<br/>
Число задач, поступающих в планировщик с момента последнего вызова этого метода.

*пнумберофтасксенкуеуед*<br/>
Общее число задач во всех очередях планировщика.

### <a name="remarks"></a>Remarks

Этот метод вызывается диспетчер ресурсов для сбора статистики для планировщика. Статистические данные, собранные здесь, будут использоваться для создания динамических алгоритмов обратной связи, чтобы определить, когда нужно назначить больше ресурсов планировщику и когда ресурсы будут выводиться из использования. Значения, предоставленные планировщиком, могут быть оптимистичными и не обязательно должны точно отражать текущее число.

Необходимо реализовать этот метод, если требуется, чтобы диспетчер ресурсов использовал отзывы о таких действиях, как прибытие задачи, чтобы определить способ распределения ресурсов между данным планировщиком и другими планировщиками, зарегистрированными диспетчером ресурсов. Если вы решили не собирать статистику, можно задать для ключа политики `DynamicProgressFeedback` значение `DynamicProgressFeedbackDisabled` в политике планировщика, и диспетчер ресурсов не будет вызывать этот метод в планировщике.

В случае отсутствия статистических данных диспетчер ресурсов будет использовать уровни подписки аппаратного потока для принятия решений о выделении ресурсов и миграции. Дополнительные сведения об уровнях подписки см. в разделе [IExecutionResource:: куррентсубскриптионлевел](iexecutionresource-structure.md#currentsubscriptionlevel).

## <a name="see-also"></a>См. также раздел

[Пространство имен concurrency](concurrency-namespace.md)<br/>
[полициелементкэй](concurrency-namespace-enums.md)<br/>
[Класс SchedulerPolicy](schedulerpolicy-class.md)<br/>
[Структура IExecutionContext](iexecutioncontext-structure.md)<br/>
[Структура IThreadProxy](ithreadproxy-structure.md)<br/>
[Структура IVirtualProcessorRoot](ivirtualprocessorroot-structure.md)<br/>
[Структура IResourceManager](iresourcemanager-structure.md)
