---
title: Структура IVirtualProcessorRoot
ms.date: 11/04/2016
f1_keywords:
- IVirtualProcessorRoot
- CONCRTRM/concurrency::IVirtualProcessorRoot
- CONCRTRM/concurrency::IVirtualProcessorRoot::IVirtualProcessorRoot::Activate
- CONCRTRM/concurrency::IVirtualProcessorRoot::IVirtualProcessorRoot::Deactivate
- CONCRTRM/concurrency::IVirtualProcessorRoot::IVirtualProcessorRoot::EnsureAllTasksVisible
- CONCRTRM/concurrency::IVirtualProcessorRoot::IVirtualProcessorRoot::GetId
helpviewer_keywords:
- IVirtualProcessorRoot structure
ms.assetid: 5ef371b8-9e4f-4fef-bb0d-49099693dd2b
ms.openlocfilehash: f642a29d0a80568f7a5f2a5e89f6951d4819243e
ms.sourcegitcommit: c123cc76bb2b6c5cde6f4c425ece420ac733bf70
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81364260"
---
# <a name="ivirtualprocessorroot-structure"></a>Структура IVirtualProcessorRoot

Абстракция для аппаратного потока, в котором может выполняться прокси-поток.

## <a name="syntax"></a>Синтаксис

```cpp
struct IVirtualProcessorRoot : public IExecutionResource;
```

## <a name="members"></a>Участники

### <a name="public-methods"></a>Открытые методы

|Имя|Описание|
|----------|-----------------|
|[IVirtualProcessorRoot::Активировать](#activate)|Вызывает прокси потока, связанный `pContext` с интерфейсом контекста выполнения, чтобы начать выполнение на этом виртуальном корне процессора.|
|[IVirtualProcessorRoot::Dэактив](#deactivate)|Вызывает прокси потока в настоящее время выполнения на этом виртуальном корне процессора, чтобы остановить отправку контекста выполнения. Прокси потока возобновит выполнение по вызову к методу. `Activate`|
|[IVirtualProcessorRoot::EnsureAllTasksVisible](#ensurealltasksvisible)|Вызывает, что данные, хранящиеся в иерархии памяти отдельных процессоров, становятся видимыми для всех процессоров системы. Это гарантирует, что полный забор памяти был выполнен на всех процессорах до того, как метод возвращается.|
|[IVirtualProcessorRoot::GetId](#getid)|Возвращает уникальный идентификатор для корней виртуального процессора.|

## <a name="remarks"></a>Remarks

Каждый универса виртуального процессора имеет связанный ресурс выполнения. Интерфейс `IVirtualProcessorRoot` наследует от интерфейса [IExecutionResource.](iexecutionresource-structure.md) Несколько корней виртуального процессора могут соответствовать одной и той же основной аппаратной нити.

Менеджер ресурсов предоставляет виртуальные корни процессора планировщикам в ответ на запросы о ресурсах. Планировщик может использовать корень виртуального процессора для выполнения работы, активируя его с контекстом выполнения.

## <a name="inheritance-hierarchy"></a>Иерархия наследования

[IExecutionРесурс](iexecutionresource-structure.md)

`IVirtualProcessorRoot`

## <a name="requirements"></a>Требования

**Заголовок:** concrtrm.h

**Название:** параллелизм

## <a name="ivirtualprocessorrootactivate-method"></a><a name="activate"></a>IVirtualProcessorRoot::Активировать метод

Вызывает прокси потока, связанный `pContext` с интерфейсом контекста выполнения, чтобы начать выполнение на этом виртуальном корне процессора.

```cpp
virtual void Activate(_Inout_ IExecutionContext* pContext) = 0;
```

### <a name="parameters"></a>Параметры

*pContext*<br/>
Интерфейс к контексту выполнения, который будет отправлен на этом виртуальном корне процессора.

### <a name="remarks"></a>Remarks

Диспетчер ресурсов предоставит прокси-сервер потока, если он не связан с интерфейсом контекста выполнения`pContext`

Метод `Activate` может быть использован для начала выполнения работы на новом корне виртуального процессора, возвращенного менеджером ресурсов, или для возобновления прокси-сервера потока на корне виртуального процессора, который отключился или вот-вот отключится. Смотрите [IVirtualProcessorRoot: :Dактивировать](#deactivate) для получения дополнительной информации о деактивации. При возобновлении деактивированного корня виртуального `pContext` процессора параметр должен быть таким же, как и параметр, используемый для деактивации корня виртуального процессора.

После того, как корень виртуального процессора был активирован в `Deactivate` `Activate` первый раз, последующие пары вызовов и могут мчаться друг с другом. Это означает, что менеджер ресурсов может получить `Activate` звонок до `Deactivate` того, как он получит вызов, для него он был предназначен.

Когда вы активируете корень виртуального процессора, вы сигнализируете менеджеру ресурсов, что этот виртуальный корень процессора в настоящее время занят работой. Если планировщик не может найти работу для выполнения этого корня, `Deactivate` ожидается, что он будет вызывать метод, информирующий диспетчера ресурсов о том, что корень виртуального процессора простаивает. Менеджер ресурсов использует эти данные для загрузки баланса системы.

`invalid_argument`брошена, если `pContext` аргумент `NULL`имеет значение.

`invalid_operation`брошен, если `pContext` аргумент не представляет контекст выполнения, который был совсем недавно отправлен этим корнем виртуального процессора.

Акт активации корня виртуального процессора увеличивает уровень подписки базового аппаратного потока на один. Для получения дополнительной информации об уровнях подписки см. [IExecutionResource::CurrentSubscriptionLevel](iexecutionresource-structure.md#currentsubscriptionlevel).

## <a name="ivirtualprocessorrootdeactivate-method"></a><a name="deactivate"></a>IVirtualProcessorRoot: :Dэактивный метод

Вызывает прокси потока в настоящее время выполнения на этом виртуальном корне процессора, чтобы остановить отправку контекста выполнения. Прокси потока возобновит выполнение по вызову к методу. `Activate`

```cpp
virtual bool Deactivate(_Inout_ IExecutionContext* pContext) = 0;
```

### <a name="parameters"></a>Параметры

*pContext*<br/>
Контекст, который в настоящее время отправляется этим корнем.

### <a name="return-value"></a>Возвращаемое значение

Логическое значение. Значение **истины** указывает на то, `Deactivate` что прокси-сервер потока `Activate` вернулся из метода в ответ на вызов методу. Значение `false` указывает на то, что прокси-сервер потока вернулся из метода в ответ на событие уведомления в диспетчере ресурсов. На планировщике потоков для schedulable (UMS) пользовательского режима (UMS) это означает, что элементы появились в списке завершения планировщика, и планировщик требуется для их обработки.

### <a name="remarks"></a>Remarks

Используйте этот метод, чтобы временно прекратить выполнение корней виртуального процессора, когда вы не можете найти работу в планировщике. Вызов методу `Deactivate` должен исходить из `Dispatch` контекста выполнения, с которым последний раз активировался корень виртуального процессора. Другими словами, прокси-сервер `Deactivate` потока, ссылающийся на метод, должен быть тем, который в настоящее время выполняется на корне виртуального процессора. Вызов метода на корне виртуального процессора, который вы не выражаете, может привести к неопределенному поведению.

Деактивированный корень виртуального процессора может быть разбужен с вызовом `Activate` к методу, с тем же аргументом, который был передан в `Deactivate` метод. Планировщик отвечает за обеспечение сопряжения `Activate` `Deactivate` вызовов и методов, но они не должны быть получены в определенном порядке. Менеджер ресурсов может обрабатывать получение `Activate` вызова методу до того, как он получит вызов `Deactivate` методу, для него он был предназначен.

Если корень виртуального процессора пробуждается, а значение возврата от `Deactivate` метода является **ложным**значением, планировщик должен загонять список завершения UMS с помощью `IUMSCompletionList::GetUnblockNotifications` метода, действовать на эту информацию, а затем затем вызывать `Deactivate` метод снова. Это должно быть повторено `Deactivate` до тех `true`пор, пока метод не вернет значение.

`invalid_argument`брошен, если `pContext` аргумент имеет значение NULL.

`invalid_operation`брошен, если корень виртуального процессора никогда `pContext` не был активирован, или аргумент не представляет контекст выполнения, который был совсем недавно отправлен этим корнем виртуального процессора.

Акт деактивации корня виртуального процессора снижает уровень подписки базового аппаратного потока на один. Для получения дополнительной информации об уровнях подписки см. [IExecutionResource::CurrentSubscriptionLevel](iexecutionresource-structure.md#currentsubscriptionlevel).

## <a name="ivirtualprocessorrootensurealltasksvisible-method"></a><a name="ensurealltasksvisible"></a>IVirtualProcessorRoot::EnsureAllTasksVisible Метод

Вызывает, что данные, хранящиеся в иерархии памяти отдельных процессоров, становятся видимыми для всех процессоров системы. Это гарантирует, что полный забор памяти был выполнен на всех процессорах до того, как метод возвращается.

```cpp
virtual void EnsureAllTasksVisible(_Inout_ IExecutionContext* pContext) = 0;
```

### <a name="parameters"></a>Параметры

*pContext*<br/>
Контекст, который в настоящее время отправляется этим корнем виртуального процессора.

### <a name="remarks"></a>Remarks

Вы можете найти этот метод полезным, когда вы хотите синхронизировать деактивацию виртуального корневика процессора с добавлением новой работы в планировщик. По причинам производительности вы можете добавить рабочие элементы в планировщик без выполнения барьера памяти, что означает, что рабочие элементы, добавленные выполнением потоков на одном процессоре, не сразу видны всем другим процессорам. Используя этот метод в `Deactivate` сочетании с методом, вы можете гарантировать, что ваш планировщик не отключает все свои виртуальные корни процессора, в то время как рабочие элементы существуют в коллекциях планировщика.

Вызов методу `EnsureAllTasksVisibleThe` должен исходить из `Dispatch` контекста выполнения, с которым последний раз активировался корень виртуального процессора. Другими словами, прокси-сервер `EnsureAllTasksVisible` потока, ссылающийся на метод, должен быть тем, который в настоящее время выполняется на корне виртуального процессора. Вызов метода на корне виртуального процессора, который вы не выражаете, может привести к неопределенному поведению.

`invalid_argument`брошена, если `pContext` аргумент `NULL`имеет значение.

`invalid_operation`брошен, если корень виртуального процессора никогда `pContext` не был активирован, или аргумент не представляет контекст выполнения, который был совсем недавно отправлен этим корнем виртуального процессора.

## <a name="ivirtualprocessorrootgetid-method"></a><a name="getid"></a>IVirtualProcessorRoot::GetId Метод

Возвращает уникальный идентификатор для корней виртуального процессора.

```cpp
virtual unsigned int GetId() const = 0;
```

### <a name="return-value"></a>Возвращаемое значение

Идентификатор инкгер.

## <a name="see-also"></a>См. также раздел

[Пространство имен concurrency](concurrency-namespace.md)
