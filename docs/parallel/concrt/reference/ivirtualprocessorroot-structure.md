---
title: Структура IVirtualProcessorRoot
ms.date: 11/04/2016
f1_keywords:
- IVirtualProcessorRoot
- CONCRTRM/concurrency::IVirtualProcessorRoot
- CONCRTRM/concurrency::IVirtualProcessorRoot::IVirtualProcessorRoot::Activate
- CONCRTRM/concurrency::IVirtualProcessorRoot::IVirtualProcessorRoot::Deactivate
- CONCRTRM/concurrency::IVirtualProcessorRoot::IVirtualProcessorRoot::EnsureAllTasksVisible
- CONCRTRM/concurrency::IVirtualProcessorRoot::IVirtualProcessorRoot::GetId
helpviewer_keywords:
- IVirtualProcessorRoot structure
ms.assetid: 5ef371b8-9e4f-4fef-bb0d-49099693dd2b
ms.openlocfilehash: 25ede76a81a77d489d0f2316bd3ae4cb7f84d704
ms.sourcegitcommit: c3093251193944840e3d0a068ecc30e6449624ba
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/04/2019
ms.locfileid: "57268620"
---
# <a name="ivirtualprocessorroot-structure"></a>Структура IVirtualProcessorRoot

Абстракция для аппаратного потока, в котором может выполняться прокси-поток.

## <a name="syntax"></a>Синтаксис

```
struct IVirtualProcessorRoot : public IExecutionResource;
```

## <a name="members"></a>Участники

### <a name="public-methods"></a>Открытые методы

|Имя|Описание:|
|----------|-----------------|
|[IVirtualProcessorRoot::Activate](#activate)|Приводит к прокси-поток, связанный с интерфейсом контекста выполнения `pContext` для запуска выполнения на этот корневой виртуальный процессор.|
|[IVirtualProcessorRoot::Deactivate](#deactivate)|Приводит к прокси-поток, выполняющийся на этот корневой виртуальный процессор, чтобы остановить управлять контекстом выполнения. Прокси-поток продолжит выполнение во время вызова `Activate` метод.|
|[IVirtualProcessorRoot::EnsureAllTasksVisible](#ensurealltasksvisible)|Вызывает данные, хранящиеся в иерархии памяти отдельных процессоров, чтобы стать видимым для всех процессоров в системе. Это гарантирует, что полная памяти граница выполнена на всех процессорах перед возвращением метода.|
|[IVirtualProcessorRoot::GetId](#getid)|Возвращает уникальный идентификатор для корневого виртуального процессора.|

## <a name="remarks"></a>Примечания

Каждый корень виртуального процессора имеет связанный ресурс выполнения. `IVirtualProcessorRoot` Интерфейс наследует от [IExecutionResource](iexecutionresource-structure.md) интерфейс. Несколько виртуальных корневых элементов процессора могут соответствовать один и тот же базовый поток оборудования.

Диспетчер ресурсов предоставляет корни виртуального процессора планировщикам в ответ на запросы к ресурсам. Планировщик может использовать корневой виртуальный процессор для выполнения работы, активировав его с контекстом выполнения.

## <a name="inheritance-hierarchy"></a>Иерархия наследования

[IExecutionResource](iexecutionresource-structure.md)

`IVirtualProcessorRoot`

## <a name="requirements"></a>Требования

**Заголовок:** concrtrm.h

**Пространство имен:** concurrency

##  <a name="activate"></a>  Метод IVirtualProcessorRoot::Activate

Приводит к прокси-поток, связанный с интерфейсом контекста выполнения `pContext` для запуска выполнения на этот корневой виртуальный процессор.

```
virtual void Activate(_Inout_ IExecutionContext* pContext) = 0;
```

### <a name="parameters"></a>Параметры

*pContext*<br/>
Интерфейс для контекста выполнения, который будет передан на этот корневой виртуальный процессор.

### <a name="remarks"></a>Примечания

Диспетчер ресурсов предоставит прокси-поток, если он не связан с интерфейсом контекста выполнения `pContext`

`Activate` Метод может использоваться для запуска выполнения работы на новый корневой виртуальный процессор, возвращаемых диспетчером ресурсов или возобновить прокси-поток на корневом виртуальном процессоре, отключен или деактивирован. См. в разделе [IVirtualProcessorRoot::Deactivate](#deactivate) Дополнительные сведения о деактивации. Когда Вы возобновляете отключенный корень виртуального процессора, параметр `pContext` должен быть таким же, как параметр, используемый для отключения корневого виртуального процессора.

Активированная корневой виртуальный процессор в первый раз, последующие пары вызовов к `Deactivate` и `Activate` стремятся друг с другом. Это означает, что это допустимо для диспетчера ресурсов для получения вызов `Activate` прежде чем получит `Deactivate` он был предназначен для вызова.

При активации корневом виртуальном процессоре, сигнал к Resource Manager этот корневой виртуальный процессор в данный момент занят работы. Если у вас планировщик не удается найти любую работу для выполнения на этом корне, ожидается для вызова `Deactivate` метод, информирующий диспетчера ресурсов, что корневой виртуальный процессор бездействует. Диспетчер ресурсов использует эти данные для системы балансировки нагрузки.

`invalid_argument` возникает, если аргумент `pContext` имеет значение `NULL`.

`invalid_operation` возникает, если аргумент `pContext` не представляет контекст выполнения, который был отправлен недавно этим корневой виртуальный процессор.

Процесс активации корневой виртуальный процессор увеличивает уровень подписки базовой аппаратный поток на единицу. Дополнительные сведения об уровнях подписки см. в разделе [IExecutionResource::CurrentSubscriptionLevel](iexecutionresource-structure.md#currentsubscriptionlevel).

##  <a name="deactivate"></a>  Метод IVirtualProcessorRoot::Deactivate

Приводит к прокси-поток, выполняющийся на этот корневой виртуальный процессор, чтобы остановить управлять контекстом выполнения. Прокси-поток продолжит выполнение во время вызова `Activate` метод.

```
virtual bool Deactivate(_Inout_ IExecutionContext* pContext) = 0;
```

### <a name="parameters"></a>Параметры

*pContext*<br/>
Контекст, который в настоящий момент осуществляемым этим корнем.

### <a name="return-value"></a>Возвращаемое значение

Логическое значение. Значение **true** указывает, что прокси-поток возвращается из `Deactivate` метода в ответ на вызов `Activate` метод. Значение `false` указывает, что прокси-поток, возвращенный методом, в ответ на событие уведомления в диспетчере ресурсов. Для пользовательского режима планируемые (UMS) планировщике потоков это означает возникли элементы в список завершения планировщика, что планировщик необходимо обработать.

### <a name="remarks"></a>Примечания

Используйте этот метод, чтобы временно остановить выполнение корневого виртуального процессора, когда не удается найти какой-либо работы в вашем планировщике. Вызов `Deactivate` метод должен инициироваться в `Dispatch` метод контекста выполнения, активированное корневого виртуального процессора с. Другими словами, прокси-поток вызова `Deactivate` метод должен быть тот, который в данный момент на корневой виртуальный процессор. Вызова метода, не выполняется на корневом виртуальном процессоре может привести к неопределенному поведению.

Отключенный корень виртуального процессора может быть активирован с помощью вызова `Activate` метод с тем же аргументом, который был передан в `Deactivate` метод. Планировщик отвечает за то, что при вызове метода `Activate` и `Deactivate` объединены в пару методов, но они не должны быть получены в определенном порядке. Диспетчер ресурсов может обрабатывать получение вызова `Activate` метод, прежде чем получит вызов `Deactivate` метод, он был предназначен.

Если корневой виртуальный процессор пробуждающий режима сна и возвращаемое значение из `Deactivate` метод значение по **false**, планировщик должен запросить список выполнения UMS через `IUMSCompletionList::GetUnblockNotifications` метод act на основе этих данных, а затем впоследствии воспользоваться вызовом `Deactivate` метод снова. Это должно повторяться до времени, таких как `Deactivate` метод возвращает значение `true`.

`invalid_argument` возникает, если аргумент `pContext` имеет значение NULL.

`invalid_operation` возникает, если никогда не был активирован корневого виртуального процессора, или аргумент `pContext` не представляет контекст выполнения, который был отправлен недавно этим корневой виртуальный процессор.

Процесс деактивации корневом виртуальном процессоре и уменьшает уровень подписки базовой аппаратный поток на единицу. Дополнительные сведения об уровнях подписки см. в разделе [IExecutionResource::CurrentSubscriptionLevel](iexecutionresource-structure.md#currentsubscriptionlevel).

##  <a name="ensurealltasksvisible"></a>  Метод IVirtualProcessorRoot::EnsureAllTasksVisible

Вызывает данные, хранящиеся в иерархии памяти отдельных процессоров, чтобы стать видимым для всех процессоров в системе. Это гарантирует, что полная памяти граница выполнена на всех процессорах перед возвращением метода.

```
virtual void EnsureAllTasksVisible(_Inout_ IExecutionContext* pContext) = 0;
```

### <a name="parameters"></a>Параметры

*pContext*<br/>
Контекст, который отправляется в настоящее время этот корневой виртуальный процессор.

### <a name="remarks"></a>Примечания

Этот метод может оказаться полезным для синхронизации с добавлением новых приложений в планировщик деактивации корневой виртуальный процессор. Для повышения производительности можно добавить рабочие элементы на планировщик без выполнения барьер памяти, который означает, что рабочие элементы, добавленные в потоке, выполняемом на одном процессоре, не видны сразу для всех процессоров. С помощью этого метода в сочетании с `Deactivate` корней метод, убедитесь, что планировщик не приводит к деактивации всех виртуального процессора, пока существуют рабочие элементы в коллекции вашего планировщика.

Вызов `EnsureAllTasksVisibleThe` метод должен инициироваться в `Dispatch` метод контекста выполнения, активированное корневого виртуального процессора с. Другими словами, прокси-поток вызова `EnsureAllTasksVisible` метод должен быть тот, который в данный момент на корневой виртуальный процессор. Вызова метода, не выполняется на корневом виртуальном процессоре может привести к неопределенному поведению.

`invalid_argument` возникает, если аргумент `pContext` имеет значение `NULL`.

`invalid_operation` возникает, если никогда не был активирован корневого виртуального процессора, или аргумент `pContext` не представляет контекст выполнения, который был отправлен недавно этим корневой виртуальный процессор.

##  <a name="getid"></a>  Метод IVirtualProcessorRoot::GetId

Возвращает уникальный идентификатор для корневого виртуального процессора.

```
virtual unsigned int GetId() const = 0;
```

### <a name="return-value"></a>Возвращаемое значение

Целочисленный идентификатор.

## <a name="see-also"></a>См. также

[Пространство имен concurrency](concurrency-namespace.md)
