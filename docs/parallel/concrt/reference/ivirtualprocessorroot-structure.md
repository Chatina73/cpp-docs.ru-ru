---
title: Структура IVirtualProcessorRoot
ms.date: 11/04/2016
f1_keywords:
- IVirtualProcessorRoot
- CONCRTRM/concurrency::IVirtualProcessorRoot
- CONCRTRM/concurrency::IVirtualProcessorRoot::IVirtualProcessorRoot::Activate
- CONCRTRM/concurrency::IVirtualProcessorRoot::IVirtualProcessorRoot::Deactivate
- CONCRTRM/concurrency::IVirtualProcessorRoot::IVirtualProcessorRoot::EnsureAllTasksVisible
- CONCRTRM/concurrency::IVirtualProcessorRoot::IVirtualProcessorRoot::GetId
helpviewer_keywords:
- IVirtualProcessorRoot structure
ms.assetid: 5ef371b8-9e4f-4fef-bb0d-49099693dd2b
ms.openlocfilehash: 60757b0edea6b60d080c2175d4df4830ffec0cc3
ms.sourcegitcommit: a8ef52ff4a4944a1a257bdaba1a3331607fb8d0f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/11/2020
ms.locfileid: "77139885"
---
# <a name="ivirtualprocessorroot-structure"></a>Структура IVirtualProcessorRoot

Абстракция для аппаратного потока, в котором может выполняться прокси-поток.

## <a name="syntax"></a>Синтаксис

```cpp
struct IVirtualProcessorRoot : public IExecutionResource;
```

## <a name="members"></a>Члены

### <a name="public-methods"></a>Открытые методы

|Имя|Description|
|----------|-----------------|
|[Ивиртуалпроцессоррут:: Activate](#activate)|Приводит к тому, что прокси-поток, связанный с интерфейсом контекста выполнения, `pContext` начать выполнение на этом корне виртуального процессора.|
|[Ивиртуалпроцессоррут::D еактивате](#deactivate)|Приводит к тому, что прокси-сервер потока, выполняемый в этом корне виртуального процессора, прекратит отправку контекста выполнения. Прокси-сервер потока продолжит выполнение при вызове метода `Activate`.|
|[Ивиртуалпроцессоррут:: Енсуреаллтасксвисибле](#ensurealltasksvisible)|Приводит к тому, что данные, хранящиеся в иерархии памяти отдельных процессоров, становятся видимыми для всех процессоров в системе. Это гарантирует, что на всех процессорах будет выполнена полная граница памяти, прежде чем метод вернет значение.|
|[Ивиртуалпроцессоррут:: GetId](#getid)|Возвращает уникальный идентификатор для корня виртуального процессора.|

## <a name="remarks"></a>Remarks

С каждым корнем виртуального процессора связан ресурс выполнения. Интерфейс `IVirtualProcessorRoot` наследуется от интерфейса [IExecutionResource](iexecutionresource-structure.md) . Несколько корней виртуального процессора может соответствовать одному и тому же базовому аппаратному потоку.

Диспетчер ресурсов предоставляет для планировщиков корни виртуального процессора в ответ на запросы ресурсов. Планировщик может использовать корневой виртуальный процессор для выполнения работы, активируя его с помощью контекста выполнения.

## <a name="inheritance-hierarchy"></a>Иерархия наследования

[IExecutionResource](iexecutionresource-structure.md)

`IVirtualProcessorRoot`

## <a name="requirements"></a>Требования

**Заголовок:** concrtrm. h

**Пространство имен:** concurrency

## <a name="activate"></a>Метод Ивиртуалпроцессоррут:: Activate

Приводит к тому, что прокси-поток, связанный с интерфейсом контекста выполнения, `pContext` начать выполнение на этом корне виртуального процессора.

```cpp
virtual void Activate(_Inout_ IExecutionContext* pContext) = 0;
```

### <a name="parameters"></a>Параметры

*pContext*<br/>
Интерфейс к контексту выполнения, который будет отправлен в этом корне виртуального процессора.

### <a name="remarks"></a>Remarks

Диспетчер ресурсов будет предоставлять прокси-поток, если он не связан с интерфейсом контекста выполнения `pContext`

Метод `Activate` можно использовать для начала выполнения работы над новым корнем виртуального процессора, возвращенного диспетчер ресурсов, или для возобновления прокси-сервера потока на корневом виртуальном процессоре, который был отключен или будет отключен. Дополнительные сведения о деактивации см. в разделе [ивиртуалпроцессоррут::D еактивате](#deactivate) . При возобновлении деактивированного корня виртуального процессора параметр `pContext` должен совпадать с параметром, используемым для деактивации корня виртуального процессора.

После первой активации корня виртуального процессора последующие пары вызовов `Deactivate` и `Activate` могут состязания друг с другом. Это означает, что диспетчер ресурсов может получить вызов `Activate` перед получением `Deactivate` вызова, предназначенного для.

При активации корня виртуального процессора вы сообщаете диспетчер ресурсов, что этот корень виртуального процессора в данный момент занят с работой. Если вашему планировщику не удается найти какую-либо работу для выполнения в этом корне, ожидается вызов метода `Deactivate`, который сообщает диспетчер ресурсов о том, что корень виртуального процессора бездействует. Диспетчер ресурсов использует эти данные для балансировки нагрузки системы.

`invalid_argument` возникает, если аргумент `pContext` имеет значение `NULL`.

`invalid_operation` создается, если аргумент `pContext` не представляет контекст выполнения, который был последним передан этим корнем виртуального процессора.

Процедура активации корня виртуального процессора увеличивает уровень подписки базового аппаратного потока на единицу. Дополнительные сведения об уровнях подписки см. в разделе [IExecutionResource:: куррентсубскриптионлевел](iexecutionresource-structure.md#currentsubscriptionlevel).

## <a name="deactivate"></a>Ивиртуалпроцессоррут: метод:D еактивате

Приводит к тому, что прокси-сервер потока, выполняемый в этом корне виртуального процессора, прекратит отправку контекста выполнения. Прокси-сервер потока продолжит выполнение при вызове метода `Activate`.

```cpp
virtual bool Deactivate(_Inout_ IExecutionContext* pContext) = 0;
```

### <a name="parameters"></a>Параметры

*pContext*<br/>
Контекст, который в данный момент отправляется этим корнем.

### <a name="return-value"></a>Возвращаемое значение

Логическое значение. Значение **true** указывает, что прокси-поток, возвращенный методом `Deactivate` в ответ на вызов метода `Activate`. Значение `false` указывает, что прокси-поток, возвращенный методом в ответ на событие уведомления в диспетчер ресурсов. В планировщике потоков, планируемом для пользовательского режима (UMS), это означает, что элементы появлялись в списке завершения планировщика, и для их обработки требуется планировщик.

### <a name="remarks"></a>Remarks

Используйте этот метод, чтобы временно остановить выполнение корня виртуального процессора, если не удается найти какую-либо работу в планировщике. Вызов метода `Deactivate` должен исходить из метода `Dispatch` контекста выполнения, с которым последний раз был активирован корневой виртуальный процессор. Иными словами, прокси-сервер потока, вызывающий метод `Deactivate`, должен быть тем, который выполняется в данный момент в корне виртуального процессора. Вызов метода для корня виртуального процессора, который не выполняется, может привести к неопределенному поведению.

Деактивированный корень виртуального процессора может быть пробуждении с вызовом метода `Activate` с тем же аргументом, который был передан методу `Deactivate`. Планировщик отвечает за то, чтобы вызовы методов `Activate` и `Deactivate` были парными, но их не требуется получать в определенном порядке. Диспетчер ресурсов может выполнять получение вызова метода `Activate` перед получением вызова метода `Deactivate`, для которого он был предназначен.

Если корень виртуального обработчика пробуждения и возвращаемое значение метода `Deactivate` имеет значение **false**, планировщик должен запрашивать список завершения UMS через метод `IUMSCompletionList::GetUnblockNotifications`, действовать с этими сведениями, а затем снова вызывать метод `Deactivate`. Это следует повторять до тех пор, пока метод `Deactivate` не вернет значение `true`.

`invalid_argument` возникает, если аргумент `pContext` имеет значение NULL.

`invalid_operation` создается, если корень виртуального процессора никогда не был активирован, или аргумент `pContext` не представляет контекст выполнения, который был последним передан этим корнем виртуального процессора.

Процесс деактивации корня виртуального процессора уменьшает уровень подписки базового аппаратного потока на единицу. Дополнительные сведения об уровнях подписки см. в разделе [IExecutionResource:: куррентсубскриптионлевел](iexecutionresource-structure.md#currentsubscriptionlevel).

## <a name="ensurealltasksvisible"></a>Метод Ивиртуалпроцессоррут:: Енсуреаллтасксвисибле

Приводит к тому, что данные, хранящиеся в иерархии памяти отдельных процессоров, становятся видимыми для всех процессоров в системе. Это гарантирует, что на всех процессорах будет выполнена полная граница памяти, прежде чем метод вернет значение.

```cpp
virtual void EnsureAllTasksVisible(_Inout_ IExecutionContext* pContext) = 0;
```

### <a name="parameters"></a>Параметры

*pContext*<br/>
Контекст, который в данный момент отправляется этим корнем виртуального процессора.

### <a name="remarks"></a>Remarks

Этот метод может оказаться полезным, если требуется синхронизировать деактивацию корня виртуального процессора с добавлением новой работы в планировщик. Из соображений производительности можно добавлять рабочие элементы в планировщик без выполнения барьера памяти, что означает, что рабочие элементы, добавленные потоком, которые выполняются на одном процессоре, не сразу видны всем остальным процессорам. С помощью этого метода в сочетании с методом `Deactivate` можно гарантировать, что ваш планировщик не отключит все корни виртуального процессора, пока рабочие элементы существуют в коллекциях планировщика.

Вызов метода `EnsureAllTasksVisibleThe` должен исходить из метода `Dispatch` контекста выполнения, с которым последний раз был активирован корневой виртуальный процессор. Иными словами, прокси-сервер потока, вызывающий метод `EnsureAllTasksVisible`, должен быть тем, который выполняется в данный момент в корне виртуального процессора. Вызов метода для корня виртуального процессора, который не выполняется, может привести к неопределенному поведению.

`invalid_argument` возникает, если аргумент `pContext` имеет значение `NULL`.

`invalid_operation` создается, если корень виртуального процессора никогда не был активирован, или аргумент `pContext` не представляет контекст выполнения, который был последним передан этим корнем виртуального процессора.

## <a name="getid"></a>Метод Ивиртуалпроцессоррут:: GetId

Возвращает уникальный идентификатор для корня виртуального процессора.

```cpp
virtual unsigned int GetId() const = 0;
```

### <a name="return-value"></a>Возвращаемое значение

Целочисленный идентификатор.

## <a name="see-also"></a>См. также раздел

[Пространство имен concurrency](concurrency-namespace.md)
