---
description: 'Дополнительные сведения о: структура Исреадпрокси'
title: Структура IThreadProxy
ms.date: 11/04/2016
f1_keywords:
- IThreadProxy
- CONCRTRM/concurrency::IThreadProxy
- CONCRTRM/concurrency::IThreadProxy::IThreadProxy::GetId
- CONCRTRM/concurrency::IThreadProxy::IThreadProxy::SwitchOut
- CONCRTRM/concurrency::IThreadProxy::IThreadProxy::SwitchTo
- CONCRTRM/concurrency::IThreadProxy::IThreadProxy::YieldToSystem
helpviewer_keywords:
- IThreadProxy structure
ms.assetid: feb89241-a555-4e61-ad48-40add54daeca
ms.openlocfilehash: e63a4d2bc29a1ae846e30d1b7e93c125def971b9
ms.sourcegitcommit: d6af41e42699628c3e2e6063ec7b03931a49a098
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2020
ms.locfileid: "97334388"
---
# <a name="ithreadproxy-structure"></a>Структура IThreadProxy

Абстракция для потока выполнения. В зависимости от ключа политики `SchedulerType` созданного планировщика, диспетчер ресурсов предоставит прокси-поток, поддерживаемый обычным потоком Win32 или потоком планировщика пользовательского режима (UMS). Потоки UMS поддерживаются в 64-разрядных операционных системах Windows 7 и более поздних версий.

## <a name="syntax"></a>Синтаксис

```cpp
struct IThreadProxy;
```

## <a name="members"></a>Члены

### <a name="public-methods"></a>Открытые методы

|name|Описание|
|----------|-----------------|
|[Исреадпрокси:: GetId](#getid)|Возвращает уникальный идентификатор прокси-сервера потока.|
|[Исреадпрокси:: переключение](#switchout)|Отсоединяет контекст от базового корневого виртуального процессора.|
|[Исреадпрокси:: Свитчто](#switchto)|Выполняет переключение совместного контекста из текущего выполняемого контекста в другой.|
|[Исреадпрокси:: Иелдтосистем](#yieldtosystem)|Позволяет вызвавшему потоку передать выполнение другому потоку, готовому к использованию на текущем процессоре. Операционная система выбирает следующий поток для выполнения.|

## <a name="remarks"></a>Комментарии

Прокси-серверы потоков связаны с контекстами выполнения, представленными интерфейсом `IExecutionContext` , в качестве средства диспетчеризации работы.

## <a name="inheritance-hierarchy"></a>Иерархия наследования

`IThreadProxy`

## <a name="requirements"></a>Требования

**Заголовок:** concrtrm. h

**Пространство имен:** параллелизм

## <a name="ithreadproxygetid-method"></a><a name="getid"></a> Метод Исреадпрокси:: GetId

Возвращает уникальный идентификатор прокси-сервера потока.

```cpp
virtual unsigned int GetId() const = 0;
```

### <a name="return-value"></a>Возвращаемое значение

Уникальный целочисленный идентификатор.

## <a name="ithreadproxyswitchout-method"></a><a name="switchout"></a> Метод Исреадпрокси:: Switching

Отсоединяет контекст от базового корневого виртуального процессора.

```cpp
virtual void SwitchOut(SwitchingProxyState switchState = Blocking) = 0;
```

### <a name="parameters"></a>Параметры

*свитчстате*<br/>
Указывает состояние прокси-сервера потока, который исполняет параметр. Параметр имеет тип `SwitchingProxyState` .

### <a name="remarks"></a>Комментарии

Используйте `SwitchOut` при необходимости отсоединения контекста от корневого виртуального процессора, на котором он выполняется, по любой причине. В зависимости от значения, переданного параметру `switchState`, и от того, выполняется ли он на корневом виртуальном процессоре, вызов немедленно вернет управление или заблокирует прокси-поток, связанный с контекстом. Вызов `SwitchOut` с параметром со значением `Idle` является ошибочным. Это приведет к возникновению исключения [invalid_argument](../../../standard-library/invalid-argument-class.md) .

Метод `SwitchOut` полезен, когда требуется сократить число корневых виртуальных процессоров у вашего планировщика либо потому, что диспетчер ресурсов рекомендовал так сделать, либо потому, что вы запросили корневой виртуальный процессор, который временно переподписан, и завершили работу с ним. В этом случае следует вызвать метод [ивиртуалпроцессоррут:: Remove](iexecutionresource-structure.md#remove) в корне виртуального процессора перед вызовом метода `SwitchOut` с параметром, для которого `switchState` задано значение `Blocking` . Это заблокирует прокси-поток и возобновит выполнение, когда другой корневой виртуальный процессор в планировщике будет доступен для его выполнения. Блокирующий прокси-поток можно возобновить, вызвав функцию, `SwitchTo` чтобы переключиться на контекст выполнения прокси-сервера потока. Вы также можете возобновить прокси-сервер потока, используя связанный с ним контекст для активации корня виртуального процессора. Дополнительные сведения о том, как это сделать, см. в разделе [ивиртуалпроцессоррут:: Activate](ivirtualprocessorroot-structure.md#activate).

`SwitchOut` также может использоваться, когда требуется повторная инициализация виртуального процессора, чтобы его можно было активировать в будущем либо при блокировке прокси-потока, либо при временном отсоединении его от корневого виртуального процессора, на котором он выполняется, и от планировщика, который обслуживается потоком. Используйте `SwitchOut` с параметром `switchState` со значением `Blocking`, если необходимо заблокировать прокси-поток. Позже его можно будет возобновить с помощью или `SwitchTo`, или `IVirtualProcessorRoot::Activate`, как указано выше. Используйте `SwitchOut` со значением `Nesting` для этого параметра, если необходимо временно отсоединить этот прокси-поток от корневого виртуального процессора, на котором он выполняется, и от планировщика, с которым связан виртуальный процессор. Вызов `SwitchOut` с параметром `switchState` со значением `Nesting` при выполнении на корневом виртуальном процессоре вызовет повторную инициализацию корня и продолжение работы текущего прокси-потока, когда это не будет требоваться. Прокси-сервер потока считается, что он оставил планировщик, пока он не вызовет метод [исреадпрокси:: Switch](#switchout) с `Blocking` более поздней точки во времени. Второй вызов `SwitchOut` со значением параметра `Blocking` предназначен для возврата контекста в заблокированное состояние, чтобы он мог быть возобновлен с помощью или `SwitchTo`, или `IVirtualProcessorRoot::Activate` в планировщике, от которого его отсоединили. Поскольку он не выполнялся на корневом виртуальном процессоре, повторная инициализация не происходит.

Повторно инициализированный корневой виртуальный процессор ничем не отличается от абсолютно нового виртуального процессора, выделенного диспетчером ресурсов планировщику. Его можно использовать для выполнения, активировав его с контекстом выполнения с помощью `IVirtualProcessorRoot::Activate`.

`SwitchOut` должен вызываться для `IThreadProxy` интерфейса, представляющего выполняющийся в данный момент поток, или результаты не определены.

В библиотеках и заголовках, поставляемых вместе с Visual Studio 2010, этот метод не принимает параметров и не инициализирует повторно корневой виртуальный процессор. Для сохранения старого поведения значение параметра по умолчанию задано как `Blocking`.

## <a name="ithreadproxyswitchto-method"></a><a name="switchto"></a> Метод Исреадпрокси:: Свитчто

Выполняет переключение совместного контекста из текущего выполняемого контекста в другой.

```cpp
virtual void SwitchTo(
    _Inout_ IExecutionContext* pContext,
    SwitchingProxyState switchState) = 0;
```

### <a name="parameters"></a>Параметры

*pContext*<br/>
Контекст выполнения для совместного переключения.

*свитчстате*<br/>
Указывает состояние прокси-сервера потока, который исполняет параметр. Параметр имеет тип `SwitchingProxyState` .

### <a name="remarks"></a>Комментарии

Этот метод используется для переключения из одного контекста выполнения в другой из метода [IExecutionContext::D Patch](iexecutioncontext-structure.md#dispatch) первого контекста выполнения. Метод связывает контекст выполнения `pContext` с прокси-сервером потока, если он еще не связан с одним потоком. Владение текущим прокси-сервером потока определяется значением, указанным для `switchState` аргумента.

Используйте значение, `Idle` Если требуется вернуть текущий выполняющийся в данный момент прокси-сервер потока в Диспетчер ресурсов. Вызов `SwitchTo` с параметром, `switchState` для которого задано значение, `Idle` приведет к тому, что контекст выполнения `pContext` начнет выполнение на базовом ресурсе выполнения. Владение этим прокси-потоком передается в диспетчер ресурсов, и ожидается возвращение из метода контекста выполнения `Dispatch` вскоре после `SwitchTo` возврата, чтобы завершить передачу. Контекст выполнения, который направляет прокси-сервер потока, не связан с прокси-сервером потока, и планировщик может свободно использовать его или уничтожать его по своему усмотрению.

Используйте значение, `Blocking` Если этот прокси-поток должен перейти в состояние блокировки. Вызов `SwitchTo` с параметром, `switchState` для которого задано значение, `Blocking` приведет к запуску контекста выполнения `pContext` и блокировке текущего прокси-сервера потока, пока он не будет возобновлен. Планировщик удерживает владение прокси-сервером потока, когда прокси-сервер потока находится в `Blocking` состоянии. Блокирующий прокси-поток можно возобновить, вызвав функцию, `SwitchTo` чтобы переключиться на контекст выполнения прокси-сервера потока. Вы также можете возобновить прокси-сервер потока, используя связанный с ним контекст для активации корня виртуального процессора. Дополнительные сведения о том, как это сделать, см. в разделе [ивиртуалпроцессоррут:: Activate](ivirtualprocessorroot-structure.md#activate).

Используйте значение, `Nesting` Если вы хотите временно отсоединить этот прокси-сервер потока от корня виртуального процессора, на котором он выполняется, и планировщика, для которого он работает. Вызов `SwitchTo` с параметром, `switchState` для которого задано значение, `Nesting` приведет к запуску контекста выполнения `pContext` , а текущий прокси-сервер потока также продолжит выполнение без необходимости в корне виртуального процессора. Прокси-сервер потока считается, что он оставил планировщик, пока он не вызовет метод [исреадпрокси:: Switch](#switchout) в более поздний момент времени. `IThreadProxy::SwitchOut`Метод может заблокировать прокси-сервер потока до тех пор, пока не будет доступен корень виртуального процессора для его перепланирования.

`SwitchTo` должен вызываться для `IThreadProxy` интерфейса, представляющего выполняющийся в данный момент поток, или результаты не определены. Функция создает, `invalid_argument` Если параметру `pContext` присвоено значение `NULL` .

## <a name="ithreadproxyyieldtosystem-method"></a><a name="yieldtosystem"></a> Метод Исреадпрокси:: Иелдтосистем

Позволяет вызвавшему потоку передать выполнение другому потоку, готовому к использованию на текущем процессоре. Операционная система выбирает следующий поток для выполнения.

```cpp
virtual void YieldToSystem() = 0;
```

### <a name="remarks"></a>Комментарии

При вызове прокси-потоком, поддерживаемым обычным потоком Windows, `YieldToSystem` ведет себя точно так же, как и функция Windows `SwitchToThread` . Однако при вызове из потоков, планируемых для пользовательского режима (UMS), `SwitchToThread` функция делегирует задачу комплектации следующего потока для выполнения в планировщике пользовательского режима, а не операционной системе. Для достижения желаемого результата переключения на другой готовый поток в системе используйте `YieldToSystem` .

`YieldToSystem` должен вызываться для `IThreadProxy` интерфейса, представляющего выполняющийся в данный момент поток, или результаты не определены.

## <a name="see-also"></a>См. также раздел

[Пространство имен Concurrency](concurrency-namespace.md)<br/>
[Структура IExecutionContext](iexecutioncontext-structure.md)<br/>
[Структура IScheduler](ischeduler-structure.md)<br/>
[Структура IVirtualProcessorRoot](ivirtualprocessorroot-structure.md)
