---
title: Структура IThreadProxy
ms.date: 11/04/2016
f1_keywords:
- IThreadProxy
- CONCRTRM/concurrency::IThreadProxy
- CONCRTRM/concurrency::IThreadProxy::IThreadProxy::GetId
- CONCRTRM/concurrency::IThreadProxy::IThreadProxy::SwitchOut
- CONCRTRM/concurrency::IThreadProxy::IThreadProxy::SwitchTo
- CONCRTRM/concurrency::IThreadProxy::IThreadProxy::YieldToSystem
helpviewer_keywords:
- IThreadProxy structure
ms.assetid: feb89241-a555-4e61-ad48-40add54daeca
ms.openlocfilehash: b87694393af4634ec97d05070aa5513cd132098a
ms.sourcegitcommit: 7ecd91d8ce18088a956917cdaf3a3565bd128510
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/16/2020
ms.locfileid: "79424257"
---
# <a name="ithreadproxy-structure"></a>Структура IThreadProxy

Абстракция для потока выполнения. В зависимости от ключа политики `SchedulerType` созданного планировщика, диспетчер ресурсов предоставит прокси-поток, поддерживаемый обычным потоком Win32 или потоком планировщика пользовательского режима (UMS). Потоки UMS поддерживаются в 64-разрядных операционных системах Windows 7 и более поздних версий.

## <a name="syntax"></a>Синтаксис

```cpp
struct IThreadProxy;
```

## <a name="members"></a>Члены

### <a name="public-methods"></a>Открытые методы

|Имя|Description|
|----------|-----------------|
|[Исреадпрокси:: GetId](#getid)|Возвращает уникальный идентификатор прокси-сервера потока.|
|[Исреадпрокси:: переключение](#switchout)|Отсоединяет контекст от базового корневого виртуального процессора.|
|[Исреадпрокси:: Свитчто](#switchto)|Выполняет переключение совместного контекста из текущего выполняемого контекста в другой.|
|[Исреадпрокси:: Иелдтосистем](#yieldtosystem)|Позволяет вызвавшему потоку передать выполнение другому потоку, готовому к использованию на текущем процессоре. Операционная система выбирает следующий поток для выполнения.|

## <a name="remarks"></a>Remarks

Прокси-серверы потоков связаны с контекстами выполнения, представленными интерфейсом `IExecutionContext` как способ диспетчеризации работы.

## <a name="inheritance-hierarchy"></a>Иерархия наследования

`IThreadProxy`

## <a name="requirements"></a>Требования

**Заголовок:** concrtrm. h

**Пространство имен:** concurrency

## <a name="getid"></a>Метод Исреадпрокси:: GetId

Возвращает уникальный идентификатор прокси-сервера потока.

```cpp
virtual unsigned int GetId() const = 0;
```

### <a name="return-value"></a>Возвращаемое значение

Уникальный целочисленный идентификатор.

## <a name="switchout"></a>Метод Исреадпрокси:: Switching

Отсоединяет контекст от базового корневого виртуального процессора.

```cpp
virtual void SwitchOut(SwitchingProxyState switchState = Blocking) = 0;
```

### <a name="parameters"></a>Параметры

*свитчстате*<br/>
Указывает состояние прокси-сервера потока, который исполняет параметр. Параметр имеет тип `SwitchingProxyState`.

### <a name="remarks"></a>Remarks

Используйте `SwitchOut` при необходимости отсоединения контекста от корневого виртуального процессора, на котором он выполняется, по любой причине. В зависимости от значения, переданного параметру `switchState`, и от того, выполняется ли он на корневом виртуальном процессоре, вызов немедленно вернет управление или заблокирует прокси-поток, связанный с контекстом. Вызов `SwitchOut` с параметром со значением `Idle` является ошибочным. Это приведет к возникновению исключения [invalid_argument](../../../standard-library/invalid-argument-class.md) .

Метод `SwitchOut` полезен, когда требуется сократить число корневых виртуальных процессоров у вашего планировщика либо потому, что диспетчер ресурсов рекомендовал так сделать, либо потому, что вы запросили корневой виртуальный процессор, который временно переподписан, и завершили работу с ним. В этом случае следует вызвать метод [ивиртуалпроцессоррут:: Remove](iexecutionresource-structure.md#remove) в корне виртуального процессора перед вызовом `SwitchOut` с параметром `switchState` задать значение `Blocking`. Это заблокирует прокси-поток и возобновит выполнение, когда другой корневой виртуальный процессор в планировщике будет доступен для его выполнения. Блокирующий прокси-поток можно возобновить, вызвав функцию `SwitchTo`, чтобы переключиться на контекст выполнения прокси-сервера потока. Вы также можете возобновить прокси-сервер потока, используя связанный с ним контекст для активации корня виртуального процессора. Дополнительные сведения о том, как это сделать, см. в разделе [ивиртуалпроцессоррут:: Activate](ivirtualprocessorroot-structure.md#activate).

`SwitchOut` также может использоваться, когда требуется повторная инициализация виртуального процессора, чтобы его можно было активировать в будущем либо при блокировке прокси-потока, либо при временном отсоединении его от корневого виртуального процессора, на котором он выполняется, и от планировщика, который обслуживается потоком. Используйте `SwitchOut` с параметром `switchState` со значением `Blocking`, если необходимо заблокировать прокси-поток. Позже его можно будет возобновить с помощью или `SwitchTo`, или `IVirtualProcessorRoot::Activate`, как указано выше. Используйте `SwitchOut` со значением `Nesting` для этого параметра, если необходимо временно отсоединить этот прокси-поток от корневого виртуального процессора, на котором он выполняется, и от планировщика, с которым связан виртуальный процессор. Вызов `SwitchOut` с параметром `switchState` со значением `Nesting` при выполнении на корневом виртуальном процессоре вызовет повторную инициализацию корня и продолжение работы текущего прокси-потока, когда это не будет требоваться. Прокси-сервер потока считается, что он оставил планировщик, пока он не вызовет метод [исреадпрокси:: Switch](#switchout) с `Blocking` в более поздний момент времени. Второй вызов `SwitchOut` со значением параметра `Blocking` предназначен для возврата контекста в заблокированное состояние, чтобы он мог быть возобновлен с помощью или `SwitchTo`, или `IVirtualProcessorRoot::Activate` в планировщике, от которого его отсоединили. Поскольку он не выполнялся на корневом виртуальном процессоре, повторная инициализация не происходит.

Повторно инициализированный корневой виртуальный процессор ничем не отличается от абсолютно нового виртуального процессора, выделенного диспетчером ресурсов планировщику. Его можно использовать для выполнения, активировав его с контекстом выполнения с помощью `IVirtualProcessorRoot::Activate`.

`SwitchOut` должен быть вызван в интерфейсе `IThreadProxy`, который представляет выполняющийся в данный момент поток, или результаты не определены.

В библиотеках и заголовках, поставляемых вместе с Visual Studio 2010, этот метод не принимает параметров и не инициализирует повторно корневой виртуальный процессор. Для сохранения старого поведения значение параметра по умолчанию задано как `Blocking`.

## <a name="switchto"></a>Метод Исреадпрокси:: Свитчто

Выполняет переключение совместного контекста из текущего выполняемого контекста в другой.

```cpp
virtual void SwitchTo(
    _Inout_ IExecutionContext* pContext,
    SwitchingProxyState switchState) = 0;
```

### <a name="parameters"></a>Параметры

*pContext*<br/>
Контекст выполнения для совместного переключения.

*свитчстате*<br/>
Указывает состояние прокси-сервера потока, который исполняет параметр. Параметр имеет тип `SwitchingProxyState`.

### <a name="remarks"></a>Remarks

Этот метод используется для переключения из одного контекста выполнения в другой из метода [IExecutionContext::D Patch](iexecutioncontext-structure.md#dispatch) первого контекста выполнения. Метод связывает контекст выполнения `pContext` с прокси-сервером потока, если он еще не связан с одним. Владение текущим прокси-сервером потока определяется значением, указанным для аргумента `switchState`.

Используйте значение `Idle`, если требуется возвратить текущий выполняющийся в данный момент прокси-сервер потока в диспетчер ресурсов. Вызов `SwitchTo` с параметром `switchState` значение `Idle` приведет к тому, что контекст выполнения `pContext` начнет выполнение на базовом ресурсе выполнения. Владение этим прокси-потоком передается в диспетчер ресурсов, и ожидается возвращение из метода `Dispatch` контекста выполнения вскоре после `SwitchTo` возвращается, чтобы завершить передачу. Контекст выполнения, который направляет прокси-сервер потока, не связан с прокси-сервером потока, и планировщик может свободно использовать его или уничтожать его по своему усмотрению.

Используйте значение `Blocking`, если необходимо, чтобы этот прокси-поток перейдет в заблокированное состояние. Вызов `SwitchTo` с параметром, `switchState` задать значение `Blocking`, приведет к тому, что контекст выполнения `pContext` начнет выполнение, и блокирует текущий прокси-сервер потока до возобновления. Планировщик удерживает владение прокси-сервером потока, когда прокси-сервер потока находится в состоянии `Blocking`. Блокирующий прокси-поток можно возобновить, вызвав функцию `SwitchTo`, чтобы переключиться на контекст выполнения прокси-сервера потока. Вы также можете возобновить прокси-сервер потока, используя связанный с ним контекст для активации корня виртуального процессора. Дополнительные сведения о том, как это сделать, см. в разделе [ивиртуалпроцессоррут:: Activate](ivirtualprocessorroot-structure.md#activate).

Используйте значение `Nesting`, если необходимо временно отключить этот прокси-сервер из корневого виртуального процессора, на котором он выполняется, и планировщик, для которого он работает. Вызов `SwitchTo` с параметром, `switchState` значение `Nesting` приведет к тому, что контекст выполнения `pContext` начать выполнение, а текущий прокси-сервер потока также продолжит выполнение без корня виртуального процессора. Прокси-сервер потока считается, что он оставил планировщик, пока он не вызовет метод [исреадпрокси:: Switch](#switchout) в более поздний момент времени. Метод `IThreadProxy::SwitchOut` может блокировать прокси-сервер потока до тех пор, пока не будет доступен корень виртуального процессора для его перепланирования.

`SwitchTo` должен быть вызван в интерфейсе `IThreadProxy`, который представляет выполняющийся в данный момент поток, или результаты не определены. Функция вызывает `invalid_argument`, если параметр `pContext` имеет значение `NULL`.

## <a name="yieldtosystem"></a>Метод Исреадпрокси:: Иелдтосистем

Позволяет вызвавшему потоку передать выполнение другому потоку, готовому к использованию на текущем процессоре. Операционная система выбирает следующий поток для выполнения.

```cpp
virtual void YieldToSystem() = 0;
```

### <a name="remarks"></a>Remarks

При вызове прокси-потоком, поддерживаемым обычным потоком Windows, `YieldToSystem` ведет себя точно так же, как `SwitchToThread`функции Windows. Однако при вызове из потоков, планируемых для пользовательского режима (UMS), функция `SwitchToThread` делегирует задачу комплектации следующего потока для выполнения в планировщике пользовательского режима, а не операционной системе. Чтобы получить желаемый результат переключения на другой готовый поток в системе, используйте `YieldToSystem`.

`YieldToSystem` должен быть вызван в интерфейсе `IThreadProxy`, который представляет выполняющийся в данный момент поток, или результаты не определены.

## <a name="see-also"></a>См. также раздел

[Пространство имен concurrency](concurrency-namespace.md)<br/>
[Структура IExecutionContext](iexecutioncontext-structure.md)<br/>
[Структура IScheduler](ischeduler-structure.md)<br/>
[Структура IVirtualProcessorRoot](ivirtualprocessorroot-structure.md)
