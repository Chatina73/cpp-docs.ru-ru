---
title: Структура IThreadProxy
ms.date: 11/04/2016
f1_keywords:
- IThreadProxy
- CONCRTRM/concurrency::IThreadProxy
- CONCRTRM/concurrency::IThreadProxy::IThreadProxy::GetId
- CONCRTRM/concurrency::IThreadProxy::IThreadProxy::SwitchOut
- CONCRTRM/concurrency::IThreadProxy::IThreadProxy::SwitchTo
- CONCRTRM/concurrency::IThreadProxy::IThreadProxy::YieldToSystem
helpviewer_keywords:
- IThreadProxy structure
ms.assetid: feb89241-a555-4e61-ad48-40add54daeca
ms.openlocfilehash: 906b05800711e89592e5230bec7fa0fe1640379f
ms.sourcegitcommit: c6f8e6c2daec40ff4effd8ca99a7014a3b41ef33
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/24/2019
ms.locfileid: "64346238"
---
# <a name="ithreadproxy-structure"></a>Структура IThreadProxy

Абстракция для потока выполнения. В зависимости от ключа политики `SchedulerType` созданного планировщика, диспетчер ресурсов предоставит прокси-поток, поддерживаемый обычным потоком Win32 или потоком планировщика пользовательского режима (UMS). Потоки UMS поддерживаются в 64-разрядных операционных системах Windows 7 и более поздних версий.

## <a name="syntax"></a>Синтаксис

```
struct IThreadProxy;
```

## <a name="members"></a>Участники

### <a name="public-methods"></a>Открытые методы

|name|Описание|
|----------|-----------------|
|[IThreadProxy::GetId](#getid)|Возвращает уникальный идентификатор для прокси-поток.|
|[IThreadProxy::SwitchOut](#switchout)|Отсоединяет контекст от базового корневого виртуального процессора.|
|[IThreadProxy::SwitchTo](#switchto)|Выполняет совместное переключение контекста с текущего выполняемого контекста на другой ресурс.|
|[IThreadProxy::YieldToSystem](#yieldtosystem)|Позволяет вызвавшему потоку передать выполнение другому потоку, готовому к использованию на текущем процессоре. Операционная система выбирает следующий поток для выполнения.|

## <a name="remarks"></a>Примечания

Прокси-потоки связаны друг с другом для контекстов выполнения, представленное интерфейс `IExecutionContext` как средство управления работой.

## <a name="inheritance-hierarchy"></a>Иерархия наследования

`IThreadProxy`

## <a name="requirements"></a>Требования

**Заголовок:** concrtrm.h

**Пространство имен:** concurrency

##  <a name="getid"></a>  Метод IThreadProxy::GetId

Возвращает уникальный идентификатор для прокси-поток.

```
virtual unsigned int GetId() const = 0;
```

### <a name="return-value"></a>Возвращаемое значение

Уникальный целочисленный идентификатор.

##  <a name="switchout"></a>  Метод IThreadProxy::SwitchOut

Отсоединяет контекст от базового корневого виртуального процессора.

```
virtual void SwitchOut(SwitchingProxyState switchState = Blocking) = 0;
```

### <a name="parameters"></a>Параметры

*switchState*<br/>
Указывает состояние прокси потока, выполняющего переключателя. Параметр имеет тип `SwitchingProxyState`.

### <a name="remarks"></a>Примечания

Используйте `SwitchOut` при необходимости отсоединения контекста от корневого виртуального процессора, на котором он выполняется, по любой причине. В зависимости от значения, переданного параметру `switchState`, и от того, выполняется ли он на корневом виртуальном процессоре, вызов немедленно вернет управление или заблокирует прокси-поток, связанный с контекстом. Вызов `SwitchOut` с параметром со значением `Idle` является ошибочным. Это приведет к [invalid_argument](../../../standard-library/invalid-argument-class.md) исключение.

Метод `SwitchOut` полезен, когда требуется сократить число корневых виртуальных процессоров у вашего планировщика либо потому, что диспетчер ресурсов рекомендовал так сделать, либо потому, что вы запросили корневой виртуальный процессор, который временно переподписан, и завершили работу с ним. В этом случае необходимо вызвать метод [IVirtualProcessorRoot::Remove](iexecutionresource-structure.md#remove) на корневом виртуальном процессоре, прежде чем вызов `SwitchOut` с параметром `switchState` присвоено `Blocking`. Это заблокирует прокси-поток и возобновит выполнение, когда другой корневой виртуальный процессор в планировщике будет доступен для его выполнения. Блокирующий прокси-поток можно возобновить путем вызова функции `SwitchTo` переключиться на контекст выполнения этот прокси-поток. Также можно возобновить прокси-поток с помощью соответствующего контекста для активации корневой виртуальный процессор. Дополнительные сведения о том, как это сделать, см. в разделе [IVirtualProcessorRoot::Activate](ivirtualprocessorroot-structure.md#activate).

`SwitchOut` также может использоваться, когда требуется повторная инициализация виртуального процессора, чтобы его можно было активировать в будущем либо при блокировке прокси-потока, либо при временном отсоединении его от корневого виртуального процессора, на котором он выполняется, и от планировщика, который обслуживается потоком. Используйте `SwitchOut` с параметром `switchState` со значением `Blocking`, если необходимо заблокировать прокси-поток. Позже его можно будет возобновить с помощью или `SwitchTo`, или `IVirtualProcessorRoot::Activate`, как указано выше. Используйте `SwitchOut` со значением `Nesting` для этого параметра, если необходимо временно отсоединить этот прокси-поток от корневого виртуального процессора, на котором он выполняется, и от планировщика, с которым связан виртуальный процессор. Вызов `SwitchOut` с параметром `switchState` со значением `Nesting` при выполнении на корневом виртуальном процессоре вызовет повторную инициализацию корня и продолжение работы текущего прокси-потока, когда это не будет требоваться. Прокси-поток считается покинувшим планировщик, пока он не вызовет [IThreadProxy::SwitchOut](#switchout) метод с `Blocking` последующий момент времени. Второй вызов `SwitchOut` со значением параметра `Blocking` предназначен для возврата контекста в заблокированное состояние, чтобы он мог быть возобновлен с помощью или `SwitchTo`, или `IVirtualProcessorRoot::Activate` в планировщике, от которого его отсоединили. Поскольку он не выполнялся на корневом виртуальном процессоре, повторная инициализация не происходит.

Повторно инициализированный корневой виртуальный процессор ничем не отличается от абсолютно нового виртуального процессора, выделенного диспетчером ресурсов планировщику. Его можно использовать для выполнения, активировав его с контекстом выполнения с помощью `IVirtualProcessorRoot::Activate`.

`SwitchOut` должен быть вызван для `IThreadProxy` интерфейс, который представляет текущий выполняемый поток или результаты не определены.

В библиотеках и заголовках, поставляемых вместе с Visual Studio 2010, этот метод не принимает параметров и не инициализирует повторно корневой виртуальный процессор. Для сохранения старого поведения значение параметра по умолчанию задано как `Blocking`.

##  <a name="switchto"></a>  Метод IThreadProxy::SwitchTo

Выполняет совместное переключение контекста с текущего выполняемого контекста на другой ресурс.

```
virtual void SwitchTo(
    _Inout_ IExecutionContext* pContext,
    SwitchingProxyState switchState) = 0;
```

### <a name="parameters"></a>Параметры

*pContext*<br/>
Контекст выполнения, чтобы переключиться совместно.

*switchState*<br/>
Указывает состояние прокси потока, выполняющего переключателя. Параметр имеет тип `SwitchingProxyState`.

### <a name="remarks"></a>Примечания

Этот метод позволяет перейти от одного контекста выполнения к другому, из [IExecutionContext::Dispatch](iexecutioncontext-structure.md#dispatch) метод первого контекста выполнения. Метод связывает контекст выполнения `pContext` с прокси-поток, если он еще не связан с одним. Владение текущий прокси-поток определяется значение, указываемое для `switchState` аргумент.

Используйте значение `Idle` при необходимости вернуть текущий выполняемый прокси-поток для диспетчера ресурсов. Вызов `SwitchTo` с параметром `switchState` присвоено `Idle` вызовет контекст выполнения `pContext` для запуска выполнения на основной ресурс выполнения. Владение этот прокси-поток передается диспетчеру ресурсов, и вы должны возвращать из контекста выполнения `Dispatch` метод вскоре после `SwitchTo` возвращает, чтобы выполнить передачу. Контекст выполнения, который был управляем прокси-поток отсоединяется от прокси-поток, а планировщик может свободно использовать его повторно или уничтожить его, как считает нужным.

Используйте значение `Blocking` при необходимости этот прокси-поток переходит в состояние блокировки. Вызов `SwitchTo` с параметром `switchState` присвоено `Blocking` вызовет контекст выполнения `pContext` запуска выполнения, и блокировать текущий прокси-поток, пока он не будет возобновлена. Планировщик сохраняет владение прокси-поток, когда прокси-поток находится в `Blocking` состояние. Блокирующий прокси-поток можно возобновить путем вызова функции `SwitchTo` переключиться на контекст выполнения этот прокси-поток. Также можно возобновить прокси-поток с помощью соответствующего контекста для активации корневой виртуальный процессор. Дополнительные сведения о том, как это сделать, см. в разделе [IVirtualProcessorRoot::Activate](ivirtualprocessorroot-structure.md#activate).

Используйте значение `Nesting` когда необходимо временно отсоединить этот прокси-поток от корневого виртуального процессора, он работает под управлением, и планировщик, который обслуживается потоком для. Вызов `SwitchTo` с параметром `switchState` присвоено `Nesting` вызовет контекст выполнения `pContext` запустить выполнение и текущий прокси-поток также продолжает выполнение без необходимости в корневом виртуальном процессоре. Прокси-поток считается покинувшим планировщик, пока он не вызовет [IThreadProxy::SwitchOut](#switchout) метод последующий момент времени. `IThreadProxy::SwitchOut` Метод может заблокировать прокси-поток, пока не будет доступным для перепланирования корневой виртуальный процессор.

`SwitchTo` должен быть вызван для `IThreadProxy` интерфейс, который представляет текущий выполняемый поток или результаты не определены. Функция создает `invalid_argument` Если параметр `pContext` присваивается `NULL`.

##  <a name="yieldtosystem"></a>  Метод IThreadProxy::YieldToSystem

Позволяет вызвавшему потоку передать выполнение другому потоку, готовому к использованию на текущем процессоре. Операционная система выбирает следующий поток для выполнения.

```
virtual void YieldToSystem() = 0;
```

### <a name="remarks"></a>Примечания

При вызове с помощью прокси-поток, поддерживаемый Обычный поток Windows, `YieldToSystem` ведет себя так же, как функции Windows `SwitchToThread`. Тем не менее, при вызове из пользовательского режима планируемые (UMS) потоки, `SwitchToThread` функция делегирует задачу подбора следующий поток для запуска для планировщика режима пользователя, а не операционной системы. Для достижения желаемого эффекта переключения на другой поток готов в системе, используйте `YieldToSystem`.

`YieldToSystem` должен быть вызван для `IThreadProxy` интерфейс, который представляет текущий выполняемый поток или результаты не определены.

## <a name="see-also"></a>См. также

[Пространство имен concurrency](concurrency-namespace.md)<br/>
[Структура IExecutionContext](iexecutioncontext-structure.md)<br/>
[Структура IScheduler](ischeduler-structure.md)<br/>
[Структура IVirtualProcessorRoot](ivirtualprocessorroot-structure.md)
