---
title: Общие сведения о среде выполнения с параллелизмом
ms.date: 07/20/2018
helpviewer_keywords:
- Concurrency Runtime, requirements
- Concurrency Runtime, architecture
- Concurrency Runtime, overview
- Concurrency Runtime, lambda expressions
ms.assetid: 56237d96-10b0-494a-9cb4-f5c5090436c5
ms.openlocfilehash: c1b9f9ca0565bfb04c3bff56b23ea1ef1dfa42d6
ms.sourcegitcommit: 6052185696adca270bc9bdbec45a626dd89cdcdd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/31/2018
ms.locfileid: "50613672"
---
# <a name="overview-of-the-concurrency-runtime"></a>Общие сведения о среде выполнения с параллелизмом
В этом документе содержатся общие сведения о среде выполнения с параллелизмом. Здесь рассматриваются преимущества среды выполнения с параллелизмом, указывается, когда следует ее использовать, и описывается, как ее компоненты взаимодействуют друг с другом, с операционной системой и приложениями.

##  <a name="top"></a> Разделы

Этот документ содержит следующие разделы.

- [Журнал реализации среды выполнения параллелизма](#dlls)

- [Почему важна среда выполнения с параллелизмом](#runtime)

- [Архитектура](#architecture)

- [Лямбда-выражения C++](#lambda)

- [Требования](#requirements)

## <a name="dlls"></a> Журнал реализации среды выполнения параллелизма

В Visual Studio 2010 с помощью 2013 среда выполнения с параллелизмом был включен в msvcr100.dll через msvcr120.dll.  Время их UCRT оптимизацию кода в Visual Studio 2015, был выполнен рефакторинг библиотеки DLL на три части:

- ucrtbase.dll – C API, в Windows 10, а также предоставление нижнего уровня с помощью Windows Update-

- vcruntime140.dll — компилятор поддерживает функции и обработки исключений среды выполнения, поставляемых с помощью Visual Studio

- concrt140.dll — среда выполнения с параллелизмом, поставляемых с помощью Visual Studio. Требуется для параллельные контейнеры и алгоритмы, такие как `concurrency::parallel_for`. Кроме того STL требуется эта библиотека DLL в Windows XP power примитивы синхронизации, так как Windows XP не поддерживает переменные условия.

В Visual Studio 2015 и более поздних версиях планировщик задач среды выполнения с параллелизмом более не является планировщиком класса задач и связанных типов в ppltasks.h. Эти типы теперь используют Windows ThreadPool для повышения производительности и взаимодействия с примитивами синхронизации Windows.

##  <a name="runtime"></a> Почему важна среда выполнения с параллелизмом

Среда выполнения с параллелизмом обеспечивает единообразие и предсказуемость приложений и компонентов приложений, выполняемых одновременно. Два примера преимуществ среды выполнения с параллелизмом — *совместное планирование задач* и *совместное блокирование*.

Среда выполнения с параллелизмом использует совместный планировщик задач, реализующий алгоритм переноса нагрузки для эффективного распределения вычислительных ресурсов. Например, рассмотрим приложение, имеющее два потока, управляемых одной средой выполнения. Если один поток завершает свою запланированную задачу, он может разгрузить другой поток. Этот механизм позволяет балансировать общую рабочую нагрузку приложения.

Среда выполнения с параллелизмом также предоставляет примитивы синхронизации, использующие совместное блокирование для синхронизации доступа к ресурсам. Например, рассмотрим задачу, которая должна получить монопольный доступ к общему ресурсу. Выполняя совместное блокирование, среда выполнения может использовать оставшийся квант времени для выполнения другой задачи, пока первая задача ожидает ресурс. Этот механизм обеспечивает максимально эффективное использование вычислительных ресурсов.

[[В начало](#top)]

##  <a name="architecture"></a> Архитектура

Среда выполнения с параллелизмом состоит из четырех компонентов: библиотеки параллельных шаблонов (PPL), библиотеки асинхронных агентов, планировщика задач и диспетчера ресурсов. Эти компоненты распределены между операционной системой и приложениями. На следующем рисунке показано взаимодействие компонентов среды выполнения с параллелизмом в операционной системе и приложениях.

**Архитектура параллельной среды выполнения**

![Архитектура параллельной среды выполнения](../../parallel/concrt/media/concurrencyrun.png "concurrencyrun")

> [!IMPORTANT]
>  Компоненты планировщика заданий и Resource Manager недоступны из приложения универсальной платформы Windows (UWP), или при использовании класса задач или других типов в файле ppltasks.h.

Среда выполнения с параллелизмом предоставляет широкие *составную*, то есть можно объединять существующие функциональные возможности, чтобы расширить. Среда выполнения с параллелизмом объединяет множество возможностей, таких как параллельные алгоритмы, от компонентов более низкого уровня.

Среда выполнения с параллелизмом также предоставляет примитивы синхронизации, использующие совместное блокирование для синхронизации доступа к ресурсам. Дополнительные сведения об этих примитивах синхронизации см. в разделе [структуры данных синхронизации](../../parallel/concrt/synchronization-data-structures.md).

В следующих разделах представлен краткий обзор возможностей каждого компонента и рекомендации по его использованию.

### <a name="parallel-patterns-library"></a>Библиотека параллельных шаблонов

Библиотека параллельных шаблонов (PPL) предоставляет алгоритмы и контейнеры общего назначения для выполнения детального параллелизма. PPL обеспечивает поддержку *императивного параллелизма данных* , предоставляя параллельные алгоритмы, которые распределяют вычисления в коллекциях или наборах данных по вычислительным ресурсам. Она также позволяет *параллелизм задач* , предоставляя объекты задач, которые распределяют несколько независимых операций по вычислительным ресурсам.

Используйте библиотеку параллельных шаблонов при наличии локальных вычислений, которые могут использовать преимущества параллельного выполнения. Например, можно использовать [concurrency::parallel_for](reference/concurrency-namespace-functions.md#parallel_for) алгоритма для преобразования существующего `for` цикл для параллельной работы.

Дополнительные сведения о библиотеке параллельных шаблонов, см. в разделе [библиотеки параллельных шаблонов (PPL)](../../parallel/concrt/parallel-patterns-library-ppl.md).

### <a name="asynchronous-agents-library"></a>библиотеку асинхронных агентов

Библиотека асинхронных агентов (или просто *Библиотека агентов*) предоставляет модель программирования на основе субъектов и интерфейсы передачи сообщений для недетализированного потока данных и задач по конвейеризации. Асинхронные агенты позволяют эффективно использовать задержку, выполняя работу, пока другие компоненты ожидают данные.

Используйте библиотеку агентов, если существует несколько сущностей, асинхронно взаимодействующих друг с другом. Например, можно создать агент, который читает данные из файла или сетевого подключения, а затем использует интерфейсы передачи сообщений для отправки этих данных другому агенту.

Дополнительные сведения о библиотеке агентов см. в разделе [Asynchronous Agents Library](../../parallel/concrt/asynchronous-agents-library.md).

### <a name="task-scheduler"></a>Планировщик задач

Планировщик задач планирует и координирует задачи во время выполнения. Планировщик задач является совместным и использует алгоритм переноса нагрузки для максимально эффективного использования вычислительных ресурсов.

Среда выполнения с параллелизмом предоставляет планировщик по умолчанию, поэтому нет необходимости управлять деталями инфраструктуры. Однако для удовлетворения качественных требований приложения можно также предоставить собственную политику планирования или связать конкретные планировщики с конкретными задачами.

Дополнительные сведения о планировщике см. в разделе [планировщик](../../parallel/concrt/task-scheduler-concurrency-runtime.md).

### <a name="resource-manager"></a>Диспетчер ресурсов

Роли диспетчера ресурсов заключается в управлении вычислительными ресурсами, такими как процессоры и память. Диспетчер ресурсов реагирует на изменение рабочих нагрузок во время выполнения, назначая ресурсы тем нагрузкам, где они могут быть наиболее эффективными.

Диспетчер ресурсов выступает в качестве абстракции вычислительных ресурсов и в основном взаимодействует с планировщиком задач. Хотя диспетчер ресурсов можно использовать для точной настройки производительности библиотек и приложений, обычно используются функциональные возможности, предоставляемые библиотекой параллельных шаблонов, библиотекой агентов и планировщиком задач. Эти библиотеки используют диспетчер ресурсов для динамической балансировки ресурсов при изменении рабочей нагрузки.

[[В начало](#top)]

##  <a name="lambda"></a> Лямбда-выражения C++

Многие типы и алгоритмы, определяемые средой выполнения с параллелизмом, реализованы как шаблоны C++. Некоторые из этих типов и алгоритмов принимают в качестве параметра подпрограмму, которая выполняет работу. Этот параметр может быть лямбда-функцией, объектом функции или указателем функции. Эти сущности также называются *рабочих функций* или *рабочие процедуры*.

Лямбда-выражения — важный новый компонент языка Visual C++, так как они позволяют в сжатой форме определять рабочие функции для параллельной обработки. Объекты функций и указатели функций позволяют использовать среду выполнения с параллелизмом с существующим кодом. Тем не менее рекомендуется использовать лямбда-выражения при написании нового кода из-за преимуществ безопасности и производительности, которые они предоставляют.

В следующем примере сравнивается синтаксис лямбда-функций, объектов функций и указателей функций в нескольких вызовах [concurrency::parallel_for_each](reference/concurrency-namespace-functions.md#parallel_for_each) алгоритм. Каждый вызов `parallel_for_each` используют разные способы вычисления квадрата каждого элемента в [std::array](../../standard-library/array-class-stl.md) объекта.

[!code-cpp[concrt-comparing-work-functions#1](../../parallel/concrt/codesnippet/cpp/overview-of-the-concurrency-runtime_1.cpp)]

**Вывод**

```Output
1
256
6561
65536
390625
```

Дополнительные сведения о лямбда-функции в C++, см. в разделе [лямбда-выражения](../../cpp/lambda-expressions-in-cpp.md).

[[В начало](#top)]

##  <a name="requirements"></a> Требования

В следующей таблице показаны файлы заголовков, связанные с каждым компонентом среды выполнения с параллелизмом.

|Компонент|Файлы заголовка|
|---------------|------------------|
|Библиотека параллельных шаблонов|ppl.h<br /><br /> concurrent_queue.h<br /><br /> concurrent_vector.h|
|библиотеку асинхронных агентов|agents.h|
|Планировщик задач|concrt.h|
|Диспетчер ресурсов|concrtrm.h|

Среда выполнения с параллелизмом объявляется в [параллелизма](../../parallel/concrt/reference/concurrency-namespace.md) пространства имен. (Можно также использовать [параллелизма](../../parallel/concrt/reference/concurrency-namespace.md), который является псевдонимом для данного пространства имен.) Пространство имен `concurrency::details` поддерживает инфраструктуру среды выполнения с параллелизмом и не предназначено для использования непосредственно из кода.

Среда выполнения с параллелизмом предоставляется как часть библиотеки времени выполнения C (CRT). Дополнительные сведения о том, как создавать приложения, использующего CRT см. в разделе [функций библиотеки CRT](../../c-runtime-library/crt-library-features.md).

[[В начало](#top)]

