---
description: 'Дополнительные сведения о: экземпляры планировщика'
title: Экземпляры планировщика
ms.date: 11/04/2016
helpviewer_keywords:
- scheduler instances
ms.assetid: 4819365f-ef99-49cc-963e-50a2a35a8d6b
ms.openlocfilehash: a11c22815c7a73c39033e51ccf47a64ceb47a92d
ms.sourcegitcommit: d6af41e42699628c3e2e6063ec7b03931a49a098
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2020
ms.locfileid: "97188057"
---
# <a name="scheduler-instances"></a>Экземпляры планировщика

В этом документе описывается роль экземпляров планировщика в среда выполнения с параллелизмом и использование классов [Concurrency:: Scheduler](../../parallel/concrt/reference/scheduler-class.md) и [Concurrency:: CurrentScheduler](../../parallel/concrt/reference/currentscheduler-class.md) для создания экземпляров планировщика и управления ими. Экземпляры планировщика полезны, когда необходимо связать явные политики планирования с конкретными типами рабочих нагрузок. Например, можно создать один экземпляр планировщика для выполнения некоторых задач с повышенным приоритетом потока и использовать планировщик по умолчанию для выполнения задач с обычным приоритетом потока.

> [!TIP]
> Среда выполнения с параллелизмом предоставляет планировщик по умолчанию, и таким образом не требуется создавать планировщик в приложении. Поскольку планировщик задач помогает точно настроить производительность приложений, рекомендуется начать с [библиотеки параллельных шаблонов (PPL)](../../parallel/concrt/parallel-patterns-library-ppl.md) или [библиотеки асинхронных агентов](../../parallel/concrt/asynchronous-agents-library.md) , если вы не знакомы с среда выполнения с параллелизмом.

## <a name="sections"></a><a name="top"></a> Священ

- [Классы Scheduler и CurrentScheduler](#classes)

- [Создание экземпляра планировщика](#creating)

- [Управление временем существования экземпляра планировщика](#managing)

- [Методы и функции](#features)

- [Пример](#example)

## <a name="the-scheduler-and-currentscheduler-classes"></a><a name="classes"></a> Классы Scheduler и CurrentScheduler

Планировщик задач позволяет приложениям использовать один или несколько *экземпляров планировщика* для планирования работы. Класс [Concurrency:: Scheduler](../../parallel/concrt/reference/scheduler-class.md) представляет экземпляр планировщика и инкапсулирует функциональные возможности, связанные с задачами планирования.

Поток, присоединенный к планировщику, называется *контекстом выполнения* или просто *контекстом*. Один планировщик может быть активным в текущем контексте в любое время. Активный планировщик также называется *текущим планировщиком*. Среда выполнения с параллелизмом использует класс [Concurrency:: CurrentScheduler](../../parallel/concrt/reference/currentscheduler-class.md) для предоставления доступа к текущему планировщику. Текущий планировщик для одного контекста может отличаться от текущего планировщика для другого контекста. Среда выполнения не предоставляет представление текущего планировщика на уровне процесса.

Как правило, `CurrentScheduler` класс используется для доступа к текущему планировщику. `Scheduler`Класс полезен, если требуется управлять планировщиком, который не является текущим.

В следующих разделах описывается создание экземпляра планировщика и управление им. Полный пример, демонстрирующий эти задачи, см. [в разделе руководство. Управление экземпляром планировщика](../../parallel/concrt/how-to-manage-a-scheduler-instance.md).

[[Top](#top)]

## <a name="creating-a-scheduler-instance"></a><a name="creating"></a> Создание экземпляра планировщика

Существует три способа создания `Scheduler` объекта:

- Если планировщик не существует, среда выполнения создает планировщик по умолчанию при использовании функциональности среды выполнения, например, параллельного алгоритма для выполнения работы. Планировщик по умолчанию преобразуется в текущий планировщик для контекста, который инициирует параллельную работу.

- Метод [Concurrency:: CurrentScheduler:: Create](reference/currentscheduler-class.md#create) создает `Scheduler` объект, который использует определенную политику и связывает этот планировщик с текущим контекстом.

- Метод [Concurrency:: Scheduler:: Create](reference/scheduler-class.md#create) создает `Scheduler` объект, использующий определенную политику, но не связывает его с текущим контекстом.

Предоставление среде выполнения разрешения на создание планировщика по умолчанию позволяет всем параллельным задачам совместно использовать один и тот же планировщик. Как правило, функции, предоставляемые [библиотекой параллельных шаблонов](../../parallel/concrt/parallel-patterns-library-ppl.md) (PPL) или [библиотеки асинхронных агентов](../../parallel/concrt/asynchronous-agents-library.md) , используются для выполнения параллельной работы. Поэтому нет необходимости работать непосредственно с планировщиком, чтобы управлять его политикой или временем существования. При использовании PPL или библиотеки агентов среда выполнения создает планировщик по умолчанию, если он не существует, и делает его текущим планировщиком для каждого контекста. Когда вы создаете планировщик и устанавливаете его в качестве текущего планировщика, среда выполнения использует этот планировщик для планирования задач. Создавайте дополнительные экземпляры планировщика, только если требуется определенная политика планирования. Дополнительные сведения о политиках, связанных с планировщиком, см. в разделе [политики планировщика](../../parallel/concrt/scheduler-policies.md).

[[Top](#top)]

## <a name="managing-the-lifetime-of-a-scheduler-instance"></a><a name="managing"></a> Управление временем существования экземпляра планировщика

Среда выполнения использует механизм подсчета ссылок для управления временем существования `Scheduler` объектов.

При использовании `CurrentScheduler::Create` метода или `Scheduler::Create` метода для создания `Scheduler` объекта среда выполнения устанавливает начальное число ссылок для этого планировщика на единицу. Среда выполнения увеличивает счетчик ссылок при вызове метода [Concurrency:: Scheduler:: Attach](reference/scheduler-class.md#attach) . `Scheduler::Attach`Метод связывает `Scheduler` объект вместе с текущим контекстом. Это делает его текущим планировщиком. При вызове `CurrentScheduler::Create` метода среда выполнения создает `Scheduler` объект и прикрепляет его к текущему контексту (и устанавливает счетчик ссылок в один). Для увеличения счетчика ссылок объекта можно также использовать метод [Concurrency:: Scheduler:: Reference](reference/scheduler-class.md#reference) `Scheduler` .

Среда выполнения уменьшает счетчик ссылок при вызове метода [Concurrency:: CurrentScheduler::D етач](reference/currentscheduler-class.md#detach) для отсоединения текущего планировщика или вызов метода [Concurrency:: Scheduler:: Release](reference/scheduler-class.md#release) . Когда счетчик ссылок достигнет нуля, среда выполнения уничтожает `Scheduler` объект после завершения всех запланированных задач. Выполняемая задача может увеличить число ссылок текущего планировщика. Таким образом, если счетчик ссылок достигает нуля, а задача увеличивает значение счетчика ссылок, среда выполнения не уничтожает `Scheduler` объект до тех пор, пока счетчик ссылок не достигнет нуля и не завершится выполнение всех задач.

Среда выполнения поддерживает внутренний стек `Scheduler` объектов для каждого контекста. При вызове `Scheduler::Attach` метода или `CurrentScheduler::Create` Среда выполнения помещает этот объект в `Scheduler` стек текущего контекста. Это делает его текущим планировщиком. При вызове `CurrentScheduler::Detach` Среда выполнения извлекает текущий планировщик из стека для текущего контекста и устанавливает предыдущее значение в качестве текущего планировщика.

Среда выполнения предоставляет несколько способов управления жизненным циклом экземпляра планировщика. В следующей таблице показан соответствующий метод, который освобождает или отсоединяет планировщик от текущего контекста для каждого метода, который создает или прикрепляет планировщик к текущему контексту.

|Создание или присоединение метода|Метод Release или Detach|
|-----------------------------|------------------------------|
|`CurrentScheduler::Create`|`CurrentScheduler::Detach`|
|`Scheduler::Create`|`Scheduler::Release`|
|`Scheduler::Attach`|`CurrentScheduler::Detach`|
|`Scheduler::Reference`|`Scheduler::Release`|

Вызов недопустимого метода выпуска или отсоединения приводит к неопределенному поведению в среде выполнения.

Если вы используете функцию, например PPL, которая заставляет среду выполнения создать планировщик по умолчанию, не освобождайте и не отменяйте этот планировщик. Среда выполнения управляет временем существования любого создаваемого планировщика.

Поскольку среда выполнения не уничтожает `Scheduler` объект до завершения всех задач, можно использовать метод [Concurrency:: Scheduler:: регистершутдовневент](reference/scheduler-class.md#registershutdownevent) или метод [Concurrency:: CurrentScheduler:: регистершутдовневент](reference/currentscheduler-class.md#registershutdownevent) для получения уведомления при `Scheduler` уничтожении объекта. Это полезно, когда необходимо дождаться завершения каждой задачи, запланированной `Scheduler` объектом.

[[Top](#top)]

## <a name="methods-and-features"></a><a name="features"></a> Методы и функции

В этом разделе перечислены важные методы `CurrentScheduler` `Scheduler` классов и.

Представьте `CurrentScheduler` класс как вспомогательный объект для создания планировщика для использования в текущем контексте. `Scheduler`Класс позволяет управлять планировщиком, принадлежащим другому контексту.

В следующей таблице показаны важные методы, определяемые `CurrentScheduler` классом.

|Метод|Описание|
|------------|-----------------|
|[Создание](reference/currentscheduler-class.md#create)|Создает `Scheduler` объект, который использует указанную политику и связывает его с текущим контекстом.|
|[Получить](reference/currentscheduler-class.md#get)|Извлекает указатель на `Scheduler` объект, связанный с текущим контекстом. Этот метод не увеличивает значение счетчика ссылок `Scheduler` объекта.|
|[Отсоединить](reference/currentscheduler-class.md#detach)|Отсоединяет текущий планировщик от текущего контекста и устанавливает предыдущий из них в качестве текущего планировщика.|
|[регистершутдовневент](reference/currentscheduler-class.md#registershutdownevent)|Регистрирует событие, которое среда выполнения задает при уничтожении текущего планировщика.|
|[CreateScheduleGroup](reference/currentscheduler-class.md#createschedulegroup)|Создает объект [Concurrency:: ScheduleGroup](../../parallel/concrt/reference/schedulegroup-class.md) в текущем планировщике.|
|[ScheduleTask](reference/currentscheduler-class.md#scheduletask)|Добавляет упрощенную задачу в очередь планирования текущего планировщика.|
|[GetPolicy](reference/currentscheduler-class.md#getpolicy)|Извлекает копию политики, которая связана с текущим планировщиком.|

В следующей таблице показаны важные методы, определяемые `Scheduler` классом.

|Метод|Описание|
|------------|-----------------|
|[Создание](reference/scheduler-class.md#create)|Создает `Scheduler` объект, использующий указанную политику.|
|[Attach](reference/scheduler-class.md#attach)|Связывает `Scheduler` объект вместе с текущим контекстом.|
|[Ссылки](reference/scheduler-class.md#reference)|Увеличивает счетчик ссылок `Scheduler` объекта.|
|[Релиз](reference/scheduler-class.md#release)|Уменьшает значение счетчика ссылок `Scheduler` объекта.|
|[регистершутдовневент](reference/scheduler-class.md#registershutdownevent)|Регистрирует событие, которое среда выполнения задает при `Scheduler` уничтожении объекта.|
|[CreateScheduleGroup](reference/scheduler-class.md#createschedulegroup)|Создает объект [Concurrency:: ScheduleGroup](../../parallel/concrt/reference/schedulegroup-class.md) в `Scheduler` объекте.|
|[ScheduleTask](reference/scheduler-class.md#scheduletask)|Планирует упрощенную задачу из `Scheduler` объекта.|
|[GetPolicy](reference/scheduler-class.md#getpolicy)|Извлекает копию политики, связанной с `Scheduler` объектом.|
|[SetDefaultSchedulerPolicy](reference/scheduler-class.md#setdefaultschedulerpolicy)|Задает политику, используемую средой выполнения при создании планировщика по умолчанию.|
|[ресетдефаултсчедулерполици](reference/scheduler-class.md#resetdefaultschedulerpolicy)|Восстанавливает политику по умолчанию до того, как она была активна до вызова `SetDefaultSchedulerPolicy` . Если после этого вызова создается планировщик по умолчанию, среда выполнения использует параметры политики по умолчанию для создания планировщика.|

[[Top](#top)]

## <a name="example"></a><a name="example"></a> Пример

Основные примеры создания экземпляра планировщика и управления им см. [в разделе Управление экземпляром](../../parallel/concrt/how-to-manage-a-scheduler-instance.md)планировщика.

## <a name="see-also"></a>См. также раздел

[Планировщик заданий](../../parallel/concrt/task-scheduler-concurrency-runtime.md)<br/>
[Руководство. Управление экземпляром планировщика](../../parallel/concrt/how-to-manage-a-scheduler-instance.md)<br/>
[Политики планировщика](../../parallel/concrt/scheduler-policies.md)<br/>
[Планирование групп](../../parallel/concrt/schedule-groups.md)
