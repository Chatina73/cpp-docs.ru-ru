---
title: _CrtSetAllocHook
ms.date: 11/04/2016
apiname:
- _CrtSetAllocHook
apilocation:
- msvcrt.dll
- msvcr80.dll
- msvcr90.dll
- msvcr100.dll
- msvcr100_clr0400.dll
- msvcr110.dll
- msvcr110_clr0400.dll
- msvcr120.dll
- msvcr120_clr0400.dll
- ucrtbase.dll
apitype: DLLExport
f1_keywords:
- _CrtSetAllocHook
- CrtSetAllocHook
helpviewer_keywords:
- _CrtSetAllocHook function
- CrtSetAllocHook function
ms.assetid: 405df37b-2fd1-42c8-83bc-90887f17f29d
ms.openlocfilehash: cfa466ec4bce6034c15a627ccab4ee4bb0ef8f5b
ms.sourcegitcommit: 0ab61bc3d2b6cfbd52a16c6ab2b97a8ea1864f12
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "62347406"
---
# <a name="crtsetallochook"></a>_CrtSetAllocHook

Устанавливает определяемую клиентом функцию выделения памяти путем ее прикрепления к отладочному процессу выделения памяти среды выполнения языка C (только отладочная версия).

## <a name="syntax"></a>Синтаксис

```C
_CRT_ALLOC_HOOK _CrtSetAllocHook(
   _CRT_ALLOC_HOOK allocHook
);
```

### <a name="parameters"></a>Параметры

*allocHook*<br/>
Новая, определенная клиентом функция выделения памяти, которую требуется прикрепить к отладочному процессу выделения памяти среды выполнения C.

## <a name="return-value"></a>Возвращаемое значение

Возвращает функции-ловушки ранее определенного выделения, или **NULL** Если *allocHook* — **NULL**.

## <a name="remarks"></a>Примечания

**_CrtSetAllocHook** позволяет приложению необходимо прикрепить к отладочному процессу выделения памяти библиотеки среды выполнения C свою собственную функцию выделения. В результате каждый вызов функции отладочного выделения памяти для выделения, перераспределения или освобождения блока памяти запускает вызов функции-обработчика приложения. **_CrtSetAllocHook** предоставляет приложению простой метод тестирования, как приложение обрабатывает ситуации недостатка памяти, возможность проверять шаблоны выделения и возможность записывать в журнал данные выделения памяти для более поздней версии анализ. Когда [_DEBUG](../../c-runtime-library/debug.md) не определен, вызовы функций **_CrtSetAllocHook** удаляются во время предварительной обработки.

**_CrtSetAllocHook** функция устанавливает новую определяемую клиентом выделения функцию, указанную в *allocHook* и возвращает ранее определенную функцию-обработчик. В следующем примере показано, как должен объявляться прототип определяемого клиентом обработчика выделения памяти:

```C
int YourAllocHook( int allocType, void *userData, size_t size,
                   int blockType, long requestNumber,
                   const unsigned char *filename, int lineNumber);
```

**AllocType** аргумента которого определяет тип операции выделения памяти (**_HOOK_ALLOC**, **_HOOK_REALLOC**, и **_HOOK_FREE**), запустила вызов функции-ловушки выделения. Если запускающим типом выделения памяти является **_HOOK_FREE**, *userData* — это указатель на раздел пользовательских данных освобождаемого блока памяти. Однако если запускающим типом выделения памяти равно **_HOOK_ALLOC** или **_HOOK_REALLOC**, *userData* — **NULL** так, как блокировать память есть еще не выделен.

*размер* определяет объем памяти блока в байтах, *blockType* указывает тип блока памяти, *requestNumber* — это порядковый номер выделения объекта блока памяти и, если доступно, *filename* и **lineNumber** укажите исходный файл имя и номер строки где была инициирована бы операция выделения памяти.

После обработки функция-обработчик должна возвращать логическое значение, которое указывает главному процессу выделения памяти среды выполнения C, как продолжить выполнение. Когда функция-обработчик требует главный процесс выделения продолжал выполнение, как если бы никогда не вызывалась функция-обработчик, функция-обработчик должна возвращать **TRUE**. Это приводит к запуску выполнения исходной операции выделения памяти. С помощью этой реализации функция-обработчик может получать и сохранять данные о выделении памяти для дальнейшего анализа, не препятствуя текущей операции выделения памяти и не изменяя состояние отладочной кучи.

Когда функция-обработчик требует главный процесс выделения для продолжения, как если бы операция выделения памяти был вызван и ему не удалось, то функция-обработчик должна возвращать **FALSE**. С помощью этой реализации функция-обработчик может имитировать широкий спектр состояний памяти и состояний отладочной кучи для проверки обработки приложением каждой ситуации.

Чтобы очистить функция-обработчик, передайте **NULL** для **_CrtSetAllocHook**.

Дополнительные сведения о том, как **_CrtSetAllocHook** может использоваться с другими функциями управления памятью или как создавать свои собственные функции-ловушки, определяемую клиентом, см. в разделе [написание функций отладочных ловушек](/visualstudio/debugger/debug-hook-function-writing).

> [!NOTE]
> **_CrtSetAllocHook** не поддерживается в **/CLR: pure**. **/CLR: pure** и **/CLR: safe** параметры компилятора признаны устаревшими в Visual Studio 2015 и удалена в Visual Studio 2017.

## <a name="requirements"></a>Требования

|Подпрограмма|Обязательный заголовок|
|-------------|---------------------|
|**_CrtSetAllocHook**|\<crtdbg.h>|

Дополнительные сведения о совместимости см. в разделе [Совместимость](../../c-runtime-library/compatibility.md).

## <a name="libraries"></a>Библиотеки

Только отладочные версии [библиотек времени выполнения языка C](../../c-runtime-library/crt-library-features.md).

## <a name="example"></a>Пример

Пример использования **_CrtSetAllocHook**, см. в разделе [crt_dbg2](https://github.com/Microsoft/VCSamples/tree/master/VC2010Samples/crt/crt_dbg2).

## <a name="see-also"></a>См. также

[Процедуры отладки](../../c-runtime-library/debug-routines.md)<br/>
[_CrtGetAllocHook](crtgetallochook.md)<br/>
