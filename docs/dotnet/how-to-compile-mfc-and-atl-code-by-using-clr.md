---
description: Дополнительные сведения см. в статье как скомпилировать код MFC и ATL с помощью параметра/clr
title: Инструкции. Компиляция кода MFC и ATL с помощью среды CLR
ms.custom: get-started-article
ms.date: 11/04/2016
helpviewer_keywords:
- MFC [C++], interoperability
- ATL [C++], interoperability
- mixed assemblies [C++], MFC code
- mixed assemblies [C++], ATL code
- /clr compiler option [C++], compiling ATL and MFC code
- interoperability [C++], /clr compiler option
- regular MFC DLLs [C++], /clr compiler option
- interop [C++], /clr compiler option
- extension DLLs [C++], /clr compiler option
ms.assetid: 12464bec-33a4-482c-880a-c078de7f6ea5
ms.openlocfilehash: 67a861dac3b4c4b454f4fbde4a500c3677ce0e25
ms.sourcegitcommit: d6af41e42699628c3e2e6063ec7b03931a49a098
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2020
ms.locfileid: "97304497"
---
# <a name="how-to-compile-mfc-and-atl-code-by-using-clr"></a>Практическое руководство. Компиляция кода MFC и ATL с помощью параметра /clr

В этом разделе описывается компиляция существующих программ MFC и ATL для поддержки среды CLR.

### <a name="to-compile-an-mfc-executable-or-regular-mfc-dll-by-using-clr"></a>Компиляция исполняемого файла MFC или обычной библиотеки DLL MFC с помощью/CLR

1. Щелкните правой кнопкой мыши проект в **Обозреватель решений** и выберите пункт **свойства**.

1. В диалоговом окне **Свойства проекта** разверните узел **Свойства конфигурации** и выберите **Общие**. В области справа в разделе **Параметры проекта по умолчанию** установите для параметра **Поддержка среды** CLR значение **CLR**.

   В той же области убедитесь, что **Использование MFC** настроено на **Использование MFC в общей библиотеке DLL**.

1. В разделе **Свойства конфигурации** разверните узел рядом с **C/C++** и выберите **Общие**. Убедитесь, что для параметра **Формат отладочной информации** задано значение **/Zi в базе данных программы** (не **/Zi**).

1. Выберите узел **создания кода** . Установите для параметра **включить минимальное перестроение** значение **нет (/ГМ-)**. Также установите для **основных проверок среды выполнения** значение **по умолчанию**.

1. В разделе **Свойства конфигурации** выберите **C/C++** , а затем — **Создание кода**. Убедитесь, что для **библиотеки времени выполнения** задана либо **многопоточная библиотека DLL (/MDD)** , либо **Многопоточная DLL (/MD)**.

1. В файле stdafx. h добавьте следующую строку.

    ```
    #using <System.Windows.Forms.dll>
    ```

### <a name="to-compile-an-mfc-extension-dll-by-using-clr"></a>Компиляция библиотеки DLL расширения MFC с помощью параметра/clr

1. Выполните действия, описанные в разделе "Компиляция исполняемого файла MFC или обычной библиотеки MFC с помощью/CLR".

1. В разделе **Свойства конфигурации** разверните узел рядом с **C/C++** и выберите **предварительно скомпилированные заголовки**. Задайте для параметра **создать или использовать предкомпилированный заголовок** значение **не использовать предварительно скомпилированные заголовки**.

   В качестве альтернативы в **Обозреватель решений** щелкните правой кнопкой мыши файл stdafx. cpp и выберите пункт **свойства**. В разделе **Свойства конфигурации** разверните узел рядом с **C/C++** и выберите **Общие**. Задайте для параметра **Compile в среде CLR поддержку** среды CLR без поддержки общеязыковой **среды выполнения**.

1. Для файла, содержащего функцию DllMain и все, что она вызывает, в **Обозреватель решений** щелкните правой кнопкой мыши файл и выберите пункт **свойства**. В разделе **Свойства конфигурации** разверните узел рядом с **C/C++** и выберите **Общие**. В области справа в разделе **Параметры проекта по умолчанию** задайте для параметра **компилировать с поддержкой среды** CLR значение **не поддерживать общеязыковую среду выполнения**.

### <a name="to-compile-an-atl-executable-by-using-clr"></a>Компиляция исполняемого файла ATL с помощью параметра/clr

1. В **Обозреватель решений** щелкните правой кнопкой мыши проект и выберите пункт **свойства**.

1. В диалоговом окне **Свойства проекта** разверните узел **Свойства конфигурации** и выберите **Общие**. В области справа в разделе **Параметры проекта по умолчанию** установите для параметра **Поддержка среды** CLR значение **CLR**.

1. В разделе **Свойства конфигурации** разверните узел рядом с **C/C++** и выберите **Общие**. Убедитесь, что для параметра **Формат отладочной информации** задано значение **/Zi в базе данных программы** (не **/Zi**).

1. Выберите узел **создания кода** . Установите для параметра **включить минимальное перестроение** значение **нет (/ГМ-)**. Также установите для **основных проверок среды выполнения** значение **по умолчанию**.

1. В разделе **Свойства конфигурации** выберите **C/C++** , а затем — **Создание кода**. Убедитесь, что для **библиотеки времени выполнения** задана либо **многопоточная библиотека DLL (/MDD)** , либо **Многопоточная DLL (/MD)**.

1. Для каждого созданного MIDL файла (C-файлов) щелкните правой кнопкой мыши файл в **Обозреватель решений** и выберите пункт **свойства**. В разделе **Свойства конфигурации** разверните узел рядом с **C/C++** и выберите **Общие**. Задайте для параметра **Compile в среде CLR поддержку** среды CLR без поддержки общеязыковой **среды выполнения**.

### <a name="to-compile-an-atl-dll-by-using-clr"></a>Компиляция библиотеки DLL библиотеки ATL с помощью параметра/clr

1. Выполните действия, описанные в разделе "Компиляция исполняемого файла ATL с помощью параметра/clr".

1. В разделе **Свойства конфигурации** разверните узел рядом с **C/C++** и выберите **предварительно скомпилированные заголовки**. Задайте для параметра **создать или использовать предкомпилированный заголовок** значение **не использовать предварительно скомпилированные заголовки**.

   В качестве альтернативы в **Обозреватель решений** щелкните правой кнопкой мыши файл stdafx. cpp и выберите пункт **свойства**. В разделе **Свойства конфигурации** разверните узел рядом с **C/C++** и выберите **Общие**. Задайте для параметра **Compile в среде CLR поддержку** среды CLR без поддержки общеязыковой **среды выполнения**.

1. Для файла, содержащего функцию DllMain и все, что она вызывает, в **Обозреватель решений** щелкните правой кнопкой мыши файл и выберите пункт **свойства**. В разделе **Свойства конфигурации** разверните узел рядом с **C/C++** и выберите **Общие**. В области справа в разделе **Параметры проекта по умолчанию** задайте для параметра **компилировать с поддержкой среды** CLR значение **не поддерживать общеязыковую среду выполнения**.

## <a name="see-also"></a>См. также раздел

[Смешанные (собственные и управляемые) сборки](../dotnet/mixed-native-and-managed-assemblies.md)
