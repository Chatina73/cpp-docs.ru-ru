---
description: 'Дополнительные сведения: Преобразование проектов из смешанного режима в чистый промежуточный язык'
title: Преобразование проектов из смешанного режима в чистый промежуточный язык
ms.date: 04/15/2021
helpviewer_keywords:
- intermediate language, mixed-mode applications
- mixed-mode applications
- mixed-mode applications, intermediate language
- projects [C++], converting to intermediate language
ms.openlocfilehash: af16c9f179aa9bb6cc88ba3e47debbcdcc63cb04
ms.sourcegitcommit: d531c567c268b676b44abbc8416ba7e20d22044b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2021
ms.locfileid: "107539234"
---
# <a name="converting-projects-from-mixed-mode-to-pure-intermediate-language"></a>Преобразование проектов из смешанного режима в чистый промежуточный язык

Все проекты Visual C++ CLR связываются с библиотеками времени выполнения C по умолчанию. В результате эти проекты классифицируются как приложения в *смешанном режиме* , так как они объединяют машинный код с кодом, предназначенным для среды CLR (управляемый код). При компиляции они компилируются в промежуточный язык (IL), также известный как язык MSIL.

> [!IMPORTANT]
> Visual Studio 2015 устарела и Visual Studio 2017 больше не поддерживает создание **`/clr:pure`** **`/clr:safe`** программного кода для приложений CLR. Если вам нужны сборки для чистого или безопасного языка, мы рекомендуем перевести приложение на C#.

Если вы используете более раннюю версию набора инструментов компилятора Microsoft C++, которая поддерживает **`/clr:pure`** или **`/clr:safe`** , эту процедуру можно использовать для преобразования кода в чистый MSIL:

### <a name="to-convert-your-mixed-mode-application-into-pure-intermediate-language"></a>Преобразование приложения в смешанном режиме в чистый промежуточный язык

1. Удалите ссылки на [библиотеки времени выполнения C](../c-runtime-library/crt-library-features.md) (CRT):

   1. В cpp – файле, определяющем точку входа приложения, измените точку входа на `Main()` . Использование `Main()` указывает, что проект не связан с CRT.

   1. В обозреватель решений щелкните правой кнопкой мыши проект и выберите в контекстном меню пункт **Свойства** , чтобы открыть страницы свойств для приложения.

   1. На странице свойств " **Расширенный** проект" для **компоновщика** выберите **точку входа** и введите " **Main** " в этом поле.

   1. Для консольных приложений на странице свойств **системного** проекта **компоновщика** выберите поле **подсистема** и измените его на **`Console (/SUBSYSTEM:CONSOLE)`** .

      > [!NOTE]
      > Не нужно задавать это свойство для Windows Forms приложений, так как поле **подсистемы** **`Windows (/SUBSYSTEM:WINDOWS)`** по умолчанию имеет значение.

   1. В *`stdafx.h`* закомментируйте все `#include` инструкции. Например, в консольных приложениях:

      ```cpp
      // #include <iostream>
      // #include <tchar.h>
      ```

       -или-

       Например, в Windows Forms приложениях:

      ```cpp
      // #include <stdlib.h>
      // #include <malloc.h>
      // #include <memory.h>
      // #include <tchar.h>
      ```

   1. Для Windows Forms приложений в *`Form1.cpp`* закомментируйте `#include` инструкцию, которая ссылается на *`windows.h`* . Пример:

      ```cpp
      // #include <windows.h>
      ```

1. Добавьте следующий код в *`stdafx.h`* :

   ```cpp
   #ifndef __FLTUSED__
   #define __FLTUSED__
      extern "C" __declspec(selectany) int _fltused=1;
   #endif
   ```

1. Удалите все неуправляемые типы:

   Везде, где это необходимо, замените неуправляемые типы ссылками на структуры из [`System`](/dotnet/api/system) пространства имен. В следующей таблице перечислены общие управляемые типы.

   |Структура|Описание|
   |---------------|-----------------|
   |[`Boolean`](/dotnet/api/system.boolean)|Представляет логическое значение.|
   |[`Byte`](/dotnet/api/system.byte)|Представляет 8-битовое целое число без знака.|
   |[`Char`](/dotnet/api/system.char)|Представляет символ Юникода.|
   |[`DateTime`](/dotnet/api/system.datetime)|Представляет текущее время, обычно выраженное как дата и время суток.|
   |[`Decimal`](/dotnet/api/system.decimal)|Представляет десятичное число.|
   |[`Double`](/dotnet/api/system.double)|Представляет число двойной точности с плавающей запятой.|
   |[`Guid`](/dotnet/api/system.guid)|Представляет глобальный уникальный идентификатор (GUID).|
   |[`Int16`](/dotnet/api/system.int16)|Представляет 16-разрядное целое число со знаком.|
   |[`Int32`](/dotnet/api/system.int32)|Представляет 32-разрядное целое число со знаком.|
   |[`Int64`](/dotnet/api/system.int64)|Представляет 64-разрядное целое число со знаком.|
   |[`IntPtr`](/dotnet/api/system.intptr)|Определяемый платформой тип, который используется для представления указателя или дескриптора.|
   |[`SByte`](/dotnet/api/system.byte)|Представляет 8-разрядное целое число со знаком.|
   |[`Single`](/dotnet/api/system.single)|Представляет число одиночной точности с плавающей запятой.|
   |[`TimeSpan`](/dotnet/api/system.timespan)|Представляет интервал времени.|
   |[`UInt16`](/dotnet/api/system.uint16)|Представляет 16-битовое целое число без знака.|
   |[`UInt32`](/dotnet/api/system.uint32)|Представляет 32-битовое целое число без знака.|
   |[`UInt64`](/dotnet/api/system.uint64)|Представляет 64-битовое целое число без знака.|
   |[`UIntPtr`](/dotnet/api/system.uintptr)|Определяемый платформой тип, который используется для представления указателя или дескриптора.|
   |[`Void`](/dotnet/api/system.void)|Указывает метод, который не возвращает значение. Это значит, что метод имеет `void` тип возвращаемого значения.|
