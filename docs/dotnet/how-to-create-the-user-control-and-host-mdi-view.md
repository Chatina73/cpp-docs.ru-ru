---
title: Практическое руководство. Создание пользовательского элемента управления и просмотр ведущего интерфейса MDI
ms.custom: get-started-article
ms.date: 11/04/2016
helpviewer_keywords:
- MFC [C++], Windows Forms Controls
- Windows Forms [C++], MFC support
ms.assetid: 625b5821-f923-4701-aca0-c1a4ceca4f63
ms.openlocfilehash: 634dd9c1ad2ce9199cec0dfa7ef067bd45f242f6
ms.sourcegitcommit: 9d4ffb8e6e0d70520a1e1a77805785878d445b8a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2019
ms.locfileid: "79544726"
---
# <a name="how-to-create-the-user-control-and-host-mdi-view"></a>Практическое руководство. Создание пользовательского элемента управления и просмотр ведущего интерфейса MDI

В следующих шагах показано, как создать .NET Framework пользовательский элемент управления, разработать пользовательский элемент управления в библиотеке классов элементов управления (в частности, в проекте библиотеки элементов управления Windows), а затем скомпилировать проект в сборку. Затем элемент управления можно использовать в приложении MFC, использующем классы, производные от [класса CView](../mfc/reference/cview-class.md) и [класса квинформсвиев](../mfc/reference/cwinformsview-class.md).

Сведения о создании Windows Forms пользовательского элемента управления и создании библиотеки классов элементов управления см. [в разделе руководство. Создание пользовательских элементов](/dotnet/framework/winforms/controls/how-to-author-composite-controls)управления.

> [!NOTE]
>  В некоторых случаях элементы управления Windows Forms, такие как сторонний элемент управления Grid, могут работать ненадежно при размещении в приложении MFC. Рекомендуемый обходной путь заключается в размещении Windows Forms пользовательского элемента управления в приложении MFC и помещении элемента управления Grid стороннего разработчика в пользовательский элемент управления.

В этой процедуре предполагается, что вы создали Windows Forms проект библиотеки элементов управления с именем WindowsFormsControlLibrary1, как в процедуре [Создание пользовательского элемента управления и узла в диалоговом окне](../dotnet/how-to-create-the-user-control-and-host-in-a-dialog-box.md).

### <a name="to-create-the-mfc-host-application"></a>Создание ведущего приложения MFC

1. Создайте проект приложения MFC.

   В меню **файл** выберите пункт **создать**, а затем выберите пункт **проект**. В папке **визуальные элементы C++**  выберите **приложение MFC**.

   В поле **имя** введите `MFC02` и измените параметр **решения** , чтобы добавить его **в решение**. Нажмите кнопку **ОК**.

   В **мастере приложений MFC**примите все значения по умолчанию и нажмите кнопку **Готово**. При этом создается приложение MFC с интерфейсом нескольких документов.

1. Настройте проект для поддержки среды CLR.

   В **Обозреватель решений**щелкните правой кнопкой мыши узел проекта `MFC01` и выберите в контекстном меню пункт **свойства** . Откроется диалоговое окно **страницы свойств** .

   В разделе **Свойства конфигурации**выберите **Общие**. В разделе **проекты по умолчанию** установите **поддержку среды** CLR для поддержки среды CLR **(/CLR)** .

   В разделе **Свойства конфигурации**разверните узел **CC++ /** и щелкните узел **Общие** . Задайте для параметра **Формат отладочной информации** значение **база данных программы (/Zi)** .

   Щелкните узел **Создание кода** . Установите для параметра **включить минимальное перестроение** значение **нет (/ГМ-)** . Также установите для **основных проверок среды выполнения** значение **по умолчанию**.

   Нажмите кнопку **ОК** , чтобы применить изменения.

1. В файле *PCH. h* (*stdafx. h* в Visual Studio 2017 и более ранних версиях) добавьте следующую строку:

    ```
    #using <System.Windows.Forms.dll>
    ```

1. Добавьте ссылку на элемент управления .NET.

   В **Обозреватель решений**щелкните правой кнопкой мыши узел проекта `MFC02` и выберите **Добавить**, **ссылки**. На **странице свойств**щелкните **Добавить новую ссылку**, выберите WindowsFormsControlLibrary1 (на вкладке **проекты** ) и нажмите кнопку **ОК**. В результате будет добавлена ссылка в виде параметра компилятора [/Fu](../build/reference/fu-name-forced-hash-using-file.md) , чтобы программа была скомпилирована. Он также копирует файл WindowsFormsControlLibrary1. dll в каталог проекта `MFC02`, чтобы программа запускалась.

1. Найдите следующую строку в файле stdafx. h:

    ```
    #endif // _AFX_NO_AFXCMN_SUPPORT
    ```

   Добавьте следующие строки.

    ```
    #include <afxwinforms.h>   // MFC Windows Forms support
    ```

1. Измените класс представления так, чтобы он наследовался от [квинформсвиев](../mfc/reference/cwinformsview-class.md).

   В MFC02View. h замените [CView](../mfc/reference/cview-class.md) на [квинформсвиев](../mfc/reference/cwinformsview-class.md) , чтобы код был представлен следующим образом:

    ```
    class CMFC02View : public CWinFormsView
    {
    };
    ```

   Если требуется добавить дополнительные представления в приложение MDI, необходимо вызвать метод [CWinApp:: AddDocTemplate](../mfc/reference/cwinapp-class.md#adddoctemplate) для каждого создаваемого представления.

1. Измените файл MFC02View. cpp, чтобы изменить значение CView на Квинформсвиев в макросе IMPLEMENT_DYNCREATE и схеме сообщений, а затем замените существующий пустой конструктор следующим конструктором:

    ```
    IMPLEMENT_DYNCREATE(CMFC02View, CWinFormsView)

    CMFC02View::CMFC02View(): CWinFormsView(WindowsFormsControlLibrary1::UserControl1::typeid)
    {
    }
    BEGIN_MESSAGE_MAP(CMFC02View, CWinFormsView)
    //leave existing body as is
    END_MESSAGE_MAP()
    ```

1. Постройте и запустите проект.

   В **Обозреватель решений**щелкните правой кнопкой мыши MFC02 и выберите пункт **Назначить запускаемым проектом**.

   В меню **Сборка** выберите **Построить решение**.

   В меню **Отладка** выберите команду **Запуск без отладки**.

## <a name="see-also"></a>См. также:

[Размещение пользовательского элемента управления формы Windows Forms в качестве представления MFC](../dotnet/hosting-a-windows-forms-user-control-as-an-mfc-view.md)
