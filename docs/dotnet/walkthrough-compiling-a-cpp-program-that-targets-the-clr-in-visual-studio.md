---
title: Компиляция программы C++/CLI, предназначенной для среды CLR
description: Используйте Microsoft C++ для создания программ и библиотек, которые могут подключаться к машинному коду C++ и программам .NET.
ms.date: 04/23/2019
helpviewer_keywords:
- command-line applications [C++], managed code
- compiling programs [C++]
- Visual C++, managed code
- managed code [C++]
ms.assetid: 339f89df-a5d2-4040-831a-ddbe25b5dce4
ms.openlocfilehash: d6d06104cc007ae5ff20f579225c885690a704e4
ms.sourcegitcommit: 9c2b3df9b837879cd17932ae9f61cdd142078260
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/29/2020
ms.locfileid: "92924226"
---
# <a name="walkthrough-compile-a-ccli-program-that-targets-the-clr-in-visual-studio"></a>Пошаговое руководство. Компиляция программы C++/CLI, предназначенной для среды CLR, в Visual Studio

С помощью C++/CLI можно создавать программы на C++, использующие классы .NET, а также собственные типы C++. C++/CLI предназначен для использования в консольных приложениях и в библиотеках DLL, которые создают оболочку для машинного кода C++ и делают его доступными из программ .NET. Чтобы создать пользовательский интерфейс Windows на основе .NET, используйте C# или Visual Basic.

Для этой процедуры можно ввести собственную программу на языке C++ или использовать один из примеров программ. Пример программы, используемый в этой процедуре, создает текстовый файл textfile.txt и сохраняет его в каталог проекта.

## <a name="prerequisites"></a>Предварительные требования

- Для работы необходимо владеть основами языка C++.
- В Visual Studio 2017 и более поздних версиях поддержка C++/CLI является необязательным компонентом. Чтобы установить его, откройте **Visual Studio Installer** из меню "Пуск" Windows. Убедитесь, что установлен флажок **Разработка классических приложений на C++** , и в разделе **Дополнительные** компоненты также следует проверить **поддержку C++/CLI** .

## <a name="create-a-new-project"></a>Создание нового проекта

Приведенные ниже инструкции немного отличаются в зависимости от используемой версии Visual Studio. Чтобы ознакомиться с документацией по предпочтительной версии Visual Studio, используйте селектор **Версия** . Он находится в верхней части оглавления на этой странице.

::: moniker range="msvc-160"

### <a name="to-create-a-ccli-project-in-visual-studio-2019"></a>Создание проекта C++/CLI в Visual Studio 2019

1. В **Обозреватель решений** щелкните правой кнопкой мыши вверху, чтобы открыть диалоговое окно **Создание нового проекта** .

1. В верхней части диалогового окна введите **CLR** в поле поиска, а затем выберите в списке результатов пункт **пустой проект CLR** .

1. Нажмите кнопку **Создать** , чтобы создать проект.

::: moniker-end

::: moniker range="msvc-150"

### <a name="to-create-a-ccli-project-in-visual-studio-2017"></a>Создание проекта C++/CLI в Visual Studio 2017

1. Создайте новый проект. В меню **Файл** укажите **Создать** , затем нажмите **Проект** .

1. В списке типов проектов Visual C++ щелкните **CLR** , а затем — **Пустой проект CLR** .

1. Введите имя проекта. По умолчанию содержащее проект решение имеет то же имя, что и новый проект, но можно ввести другое имя. При необходимости можно ввести другое расположение для проекта.

1. Нажмите кнопку **ОК** для создания проекта.

::: moniker-end

::: moniker range="msvc-140"

### <a name="to-create-a-ccli-project-in-visual-studio-2015"></a>Создание проекта C++/CLI в Visual Studio 2015

1. Создайте новый проект. В меню **Файл** укажите **Создать** , затем нажмите **Проект** .

1. В списке типов проектов Visual C++ щелкните **CLR** , а затем — **Пустой проект CLR** .

1. Введите имя проекта. По умолчанию содержащее проект решение имеет то же имя, что и новый проект, но можно ввести другое имя. При необходимости можно ввести другое расположение для проекта.

1. Нажмите кнопку **ОК** для создания проекта.

::: moniker-end

## <a name="add-a-source-file"></a>Добавить исходный файл

1. Если **обозреватель решений** не отображается, в меню **Вид** выберите пунукт **Обозреватель решений** .

1. Добавьте новый исходный файл в проект:

   - Щелкните правой кнопкой мыши папку **исходные файлы** в **Обозреватель решений** , наведите указатель на пункт **добавить** и выберите пункт **новый элемент** .

   - Щелкните элемент **Файл C++ (.cpp)** , введите имя файла и нажмите кнопу **Добавить** .

   **Cpp** -файл появится в папке " **исходные файлы** " в **Обозреватель решений** и откроется окно с вкладками, где вы вводите необходимый код в этом файле.

1. Щелкните только что созданную вкладку в Visual Studio и введите допустимую программу Visual C++ или скопируйте и вставьте один из примеров.

   Например, можно использовать пример [Практическое руководство. Запись данных в текстовый файл (C++/CLI)](./file-handling-and-i-o-cpp-cli.md#write_text) (в узле **File Handling and I/O** (Работа с файлами и операции ввода-вывода) руководства по программированию).

   Если используется пример программы, обратите внимание, что **`gcnew`** вместо создания объекта .NET используется ключевое слово, **`new`** которое **`gcnew`** возвращает маркер ( `^` ), а не указатель ( `*` ):

   `StreamWriter^ sw = gcnew StreamWriter(fileName);`

   Дополнительные сведения о синтаксисе C++/CLI см. в разделе [расширения компонентов для платформ среды выполнения](../extensions/component-extensions-for-runtime-platforms.md).

1. В меню **Сборка** выберите **Собрать решение** .

   Окно **Вывод** отображает сведения о ходе компиляции, такие как расположение журнала сборки и сообщение о состоянии сборки.

   Если внести изменения и запустить программу, не выполняя сборку, диалоговое окно может сообщить, что проект устарел. Установите флажок в этом диалоговом окне, прежде чем нажимать кнопку **ОК** , если вы хотите, чтобы Visual Studio всегда использовала актуальные версии файлов вместо того, чтобы выводить запрос при каждой сборке приложения.

1. В меню **Отладка** выберите команду **Запуск без отладки** .

1. Если использовался пример программы, при выполнении программы отображается командное окно, указывающее, что текстовый файл был создан.

   Теперь текстовый файл **textfile.txt** находится в каталоге проекта. Этот файл можно открыть с помощью Блокнота.

   > [!NOTE]
   > При выборе пустого шаблона проекта CLR автоматически задается параметр компилятора `/clr`. Чтобы проверить это, щелкните правой кнопкой мыши проект в **обозревателе решений** и выберите **Свойства** , а затем установите флажок **Поддержка общеязыковой среды выполнения (CLR)** в узле **Общие** окна **Свойства конфигурации** .

## <a name="see-also"></a>См. также

[Справочник по языку C++](../cpp/cpp-language-reference.md)<br/>
[Проекты и системы сборки](../build/projects-and-build-systems-cpp.md)<br/>
