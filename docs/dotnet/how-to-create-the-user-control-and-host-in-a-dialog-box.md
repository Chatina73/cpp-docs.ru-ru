---
title: Практическое руководство. Создание пользовательского элемента управления и ведущего приложения в диалоговом окне
ms.custom: get-started-article
ms.date: 11/04/2016
helpviewer_keywords:
- MFC [C++], hosting a Windows Forms Control
- Windows Forms [C++], MFC support
ms.assetid: 03a53032-2f03-4fa2-b567-031615a26011
ms.openlocfilehash: bdf7e2f4961a16e6538c7bbcc690ef44ba87fcaf
ms.sourcegitcommit: 0ab61bc3d2b6cfbd52a16c6ab2b97a8ea1864f12
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "62378981"
---
# <a name="how-to-create-the-user-control-and-host-in-a-dialog-box"></a>Практическое руководство. Создание пользовательского элемента управления и ведущего приложения в диалоговом окне

В этой статье предполагается, что вы создаете основе диалоговых окон ([класса CDialog](../mfc/reference/cdialog-class.md)) проекта Microsoft Foundation Classes (MFC), но можно также добавить поддержку для элемента управления Windows Forms в существующем диалоговом окне MFC.

### <a name="to-create-the-net-user-control"></a>Создание пользовательского элемента управления .NET

1. Создание проекта Visual C# Windows Forms библиотеки элементов управления с именем `WindowsFormsControlLibrary1`.

   В меню **Файл** последовательно выберите пункты **Создать** и **Проект**. В **Visual C#** папку, выберите **Библиотека элементов управления Windows Forms**.

   Принять `WindowsFormsControlLibrary1` имя проекта, щелкнув **ОК**.

   По умолчанию элемент управления .NET будет называться `UserControl1`.

1. Добавление дочерних элементов управления к `UserControl1`.

   В **элементов**откройте **все формы Windows Forms** списка. Перетащите **кнопку** управления `UserControl1` область конструктора.

   Кроме того, добавить **TextBox** элемента управления.

1. В **обозревателе решений**, дважды щелкните **UserControl1.Designer.cs** чтобы открыть его для редактирования. Измените объявления для объектов TextBox и Button с `private` для `public`.

1. Выполните построение проекта.

   В меню **Сборка** выберите **Собрать решение**.

### <a name="to-create-the-mfc-host-application"></a>Создание ведущего приложения MFC

1. Создайте проект приложения MFC.

   В меню **Файл** последовательно выберите пункты **Создать** и **Проект**. В **Visual C++** папку, выберите **приложения MFC**.

   В поле **Имя файла** введите `MFC01`. Измените параметр решение для **добавить решение**. Нажмите кнопку **ОК**.

   В **мастер приложений MFC**, для типа приложения выберите **на основе диалоговых окон**. Примите остальные значения по умолчанию и нажмите кнопку **Готово**. Это создает приложение MFC с диалоговым окном MFC.

1. Диалоговое окно MFC добавьте прототип элемента управления.

   На **представление** меню, щелкните **представление ресурсов**. В **представление ресурсов**, разверните **диалоговое окно** папку и дважды щелкните `IDD_MFC01_DIALOG`. Ресурс диалогового окна будет показан в **редактора ресурсов**.

   В **элементов**откройте **редактор диалоговых окон** списка. Перетащите **статический текст** элемента управления в ресурс диалогового окна. **Статический текст** элемент управления будет использоваться в качестве заполнителя для элемента управления .NET Windows Forms. Измените его размер до приблизительного размера элемента управления Windows Forms.

   В **свойства** измените **идентификатор** из **статический текст** управления `IDC_CTRL1` и измените **TabStop** свойства **True**.

1. Настройка проекта для поддержки Common Language Runtime (CLR).

   В **обозревателе решений**, щелкните правой кнопкой мыши узел проекта MFC01 и выберите команду **свойства**.

   В **страницы свойств** диалогового **свойства конфигурации**выберите **Общие**. В **проекта по умолчанию** задайте **поддержки Common Language Runtime** для **поддержка среды CLR (/ clr)**.

   В разделе **свойства конфигурации**, разверните **C/C++** и выберите **Общие** узла. Задайте **формат отладочной информации** для **база данных (/Zi) программы**.

   Выберите **создание кода** узла. Задайте **включить минимальное перестроение** для **нет (/ Gm-)**. Также задайте **основные проверки времени выполнения** для **по умолчанию**.

   Нажмите кнопку **ОК** для применения изменений.

1. Добавьте ссылку на элемент управления .NET.

   В **обозревателе решений**, щелкните правой кнопкой мыши узел проекта MFC01 и выберите **добавить**, **ссылки**. На **страницу свойств**, нажмите кнопку **добавить новую ссылку**выберите **WindowsFormsControlLibrary1** (в разделе **проекты** вкладку) и нажмите кнопку **ОК**. Это действие добавляет ссылку в виде [/FU](../build/reference/fu-name-forced-hash-using-file.md) -параметр компилятора, чтобы программа будет скомпилирована. Он также помещается копия библиотеки WindowsFormsControlLibrary1.dll в папку проекта \MFC01\ что программа будет выполняться.

1. В файле Stdafx.h найдите следующую строку:

    ```
    #endif // _AFX_NO_AFXCMN_SUPPORT
    ```

   Добавьте над ней следующие строки:

    ```
    #include <afxwinforms.h>   // MFC Windows Forms support
    ```

1. Добавьте код для создания управляемого элемента управления.

   Сначала объявите управляемый элемент управления. Перейти к объявлению класса диалогового окна в файле MFC01Dlg.h и добавьте элемент данных для пользовательского элемента управления в области Protected следующим образом.

    ```
    class CMFC01Dlg : public CDialog
    {
       // ...
       // Data member for the .NET User Control:
       CWinFormsControl<WindowsFormsControlLibrary1::UserControl1> m_ctrl1;
    ```

   Затем предоставить реализацию управляемого элемента управления. В MFC01Dlg.cpp в диалоговом окне переопределения `CMFC01Dlg::DoDataExchange` , созданный с помощью мастера приложений MFC (не `CAboutDlg::DoDataExchange`, который находится в том же файле), добавьте следующий код для создания управляемого элемента управления и свяжите его с прототипом статического элемента управления IDC_CTRL1.

    ```
    void CMFC01Dlg::DoDataExchange(CDataExchange* pDX)
    {
       CDialog::DoDataExchange(pDX);
       DDX_ManagedControl(pDX, IDC_CTRL1, m_ctrl1);
    }
    ```

1. Постройте и запустите проект.

   В **обозревателе решений**, щелкните правой кнопкой мыши **MFC01** и нажмите кнопку **Назначить запускаемым проектом**.

   В меню **Сборка** выберите **Собрать решение**.

   На **Отладка** меню, щелкните **Запуск без отладки**. В диалоговом окне MFC должен отображать элемент управления Windows Forms.

## <a name="see-also"></a>См. также

[Размещение пользовательского элемента управления формы Windows Forms в диалоговом окне MFC](../dotnet/hosting-a-windows-form-user-control-in-an-mfc-dialog-box.md)
