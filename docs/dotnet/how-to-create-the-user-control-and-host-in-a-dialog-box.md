---
description: Дополнительные сведения о том, как создать пользовательский элемент управления и узел в диалоговом окне.
title: Практическое руководство. Создание пользовательского элемента управления и ведущего приложения в диалоговом окне
ms.custom: get-started-article
ms.date: 11/04/2016
helpviewer_keywords:
- MFC [C++], hosting a Windows Forms Control
- Windows Forms [C++], MFC support
ms.assetid: 03a53032-2f03-4fa2-b567-031615a26011
ms.openlocfilehash: 400906344f47f7100e52319adb37c39d1fb370e7
ms.sourcegitcommit: d6af41e42699628c3e2e6063ec7b03931a49a098
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2020
ms.locfileid: "97283969"
---
# <a name="how-to-create-the-user-control-and-host-in-a-dialog-box"></a>Практическое руководство. Создание пользовательского элемента управления и ведущего приложения в диалоговом окне

В этом разделе предполагается, что создается проект на основе диалогового окна ([класс CDialog](../mfc/reference/cdialog-class.md)) Microsoft Foundation Classes (MFC), но также можно добавить поддержку элемента управления Windows Forms в существующее диалоговое окно MFC.

### <a name="to-create-the-net-user-control"></a>Создание пользовательского элемента управления .NET

1. Создайте проект библиотеки элементов управления Windows Forms Visual C# с именем `WindowsFormsControlLibrary1` .

   В меню **Файл** выберите пункт **Создать**, а затем щелкните **Проект**. В папке **Visual C#** выберите **библиотека элементов управления Windows Forms**.

   Чтобы принять `WindowsFormsControlLibrary1` имя проекта, нажмите кнопку " **ОК**".

   По умолчанию элемент управления .NET будет иметь имя `UserControl1` .

1. Добавьте дочерние элементы управления в `UserControl1` .

   На **панели элементов** откройте список **все Windows Forms** . Перетащите элемент управления **Button** в `UserControl1` область конструктора.

   Также добавьте элемент управления **TextBox** .

1. В **Обозреватель решений** дважды щелкните **UserControl1.Designer.CS** , чтобы открыть его для редактирования. Измените объявления текстового поля и кнопки с `private` на `public` .

1. Выполните построение проекта.

   В меню **Сборка** выберите **Собрать решение**.

### <a name="to-create-the-mfc-host-application"></a>Создание ведущего приложения MFC

1. Создайте проект приложения MFC.

   В меню **Файл** выберите пункт **Создать**, а затем щелкните **Проект**. В папке **Visual C++** выберите **приложение MFC**.

   В поле **Имя файла** введите `MFC01`. Измените параметр решения, чтобы **добавить его в решение**. Нажмите кнопку **ОК**.

   В **мастере приложений MFC** для типа приложения выберите **диалоговое окно на основе**. Примите остальные параметры по умолчанию и нажмите кнопку **Готово**. При этом создается приложение MFC с диалоговым окном MFC.

1. Добавьте элемент управления PlaceHolder в диалоговое окно MFC.

   В меню **вид** выберите пункт **представление ресурсов**. В **представление ресурсов** разверните папку **диалогового окна** и дважды щелкните `IDD_MFC01_DIALOG` . В **редакторе ресурсов** откроется диалоговое окно ресурс.

   На **панели элементов** откройте список **Редактор диалоговых окон** . Перетащите элемент управления " **статический текст** " в ресурс диалогового окна. Элемент управления " **статический текст** " будет служить заполнителем для элемента управления .NET Windows Forms. Измените его размер, чтобы он был примерно равным размеру элемента управления Windows Forms.

   В окне **Свойства** измените **идентификатор** элемента управления **статического текста** на `IDC_CTRL1` и измените значение свойства **TabStop** на **true**.

1. Настройте проект для поддержки среды CLR.

   В **Обозреватель решений** щелкните правой кнопкой мыши узел проекта MFC01 и выберите пункт **свойства**.

   В диалоговом окне **страницы свойств** в разделе **Свойства конфигурации** выберите **Общие**. В разделе **проекты по умолчанию** установите **поддержку среды** CLR для поддержки среды CLR **(/CLR)**.

   В разделе **Свойства конфигурации** разверните узел **C/C++** и выберите узел **Общие** . Задайте для параметра **Формат отладочной информации** значение **база данных программы (/Zi)**.

   Выберите узел **создания кода** . Установите для параметра **включить минимальное перестроение** значение **нет (/ГМ-)**. Также установите для **основных проверок среды выполнения** значение **по умолчанию**.

   Нажмите кнопку **ОК** , чтобы применить изменения.

1. Добавьте ссылку на элемент управления .NET.

   В **Обозреватель решений** щелкните правой кнопкой мыши узел проекта MFC01 и выберите **Добавить**, **ссылки**. На **странице свойств** щелкните **Добавить новую ссылку**, выберите **WindowsFormsControlLibrary1** (на вкладке **проекты** ) и нажмите кнопку **ОК**. В результате будет добавлена ссылка в виде параметра компилятора [/Fu](../build/reference/fu-name-forced-hash-using-file.md) , чтобы программа была скомпилирована. Он также помещает копию WindowsFormsControlLibrary1.dll в папку проекта \MFC01\, чтобы программа запускалась.

1. Найдите следующую строку в файле stdafx. h:

    ```
    #endif // _AFX_NO_AFXCMN_SUPPORT
    ```

   Над ним добавьте следующие строки:

    ```
    #include <afxwinforms.h>   // MFC Windows Forms support
    ```

1. Добавьте код для создания управляемого элемента управления.

   Сначала объявите управляемый элемент управления. В MFC01Dlg. h перейдите к объявлению класса диалогового окна и добавьте элемент данных для пользовательского элемента управления в защищенной области, как показано ниже.

    ```
    class CMFC01Dlg : public CDialog
    {
       // ...
       // Data member for the .NET User Control:
       CWinFormsControl<WindowsFormsControlLibrary1::UserControl1> m_ctrl1;
    ```

   Затем предоставьте реализацию управляемого элемента управления. В MFC01Dlg. cpp в переопределении диалогового окна `CMFC01Dlg::DoDataExchange` , созданном мастером приложений MFC (не `CAboutDlg::DoDataExchange` в том же файле), добавьте следующий код, чтобы создать управляемый элемент управления и связать его со статическим заполнителем IDC_CTRL1.

    ```
    void CMFC01Dlg::DoDataExchange(CDataExchange* pDX)
    {
       CDialog::DoDataExchange(pDX);
       DDX_ManagedControl(pDX, IDC_CTRL1, m_ctrl1);
    }
    ```

1. Постройте и запустите проект.

   В **Обозреватель решений** щелкните правой кнопкой мыши **MFC01** и выберите пункт **Назначить запускаемым проектом**.

   В меню **Сборка** выберите **Собрать решение**.

   В меню **Отладка** выберите команду **Запуск без отладки**. В диалоговом окне MFC должен отобразиться элемент управления Windows Forms.

## <a name="see-also"></a>См. также раздел

[Размещение пользовательского элемента управления формы Windows Forms в диалоговом окне MFC](../dotnet/hosting-a-windows-form-user-control-in-an-mfc-dialog-box.md)
