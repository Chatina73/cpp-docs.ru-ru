---
title: Оператор try-finally (C)
ms.date: 11/04/2016
helpviewer_keywords:
- try-finally keyword [C]
- __finally keyword [C], try-finally statement syntax
- __finally keyword [C]
- structured exception handling, try-finally
ms.assetid: 514400c1-c322-4bf3-9e48-3047240b8a82
ms.openlocfilehash: ada38f80ff16f91a676803134854bca0b0dd4f14
ms.sourcegitcommit: 6052185696adca270bc9bdbec45a626dd89cdcdd
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/31/2018
ms.locfileid: "50523959"
---
# <a name="try-finally-statement-c"></a>Оператор try-finally (C)

**Блок, относящийся только к системам Microsoft**

Оператор `try-finally` является расширением Microsoft для языка C и позволяет приложениям гарантировать выполнение кода очистки при прерывании выполнения блока кода. Очистка включает такие задачи, как отмена распределения памяти, закрытие файлов и освобождение их дескрипторов. Оператор `try-finally` особенно полезен для подпрограмм, в которых в нескольких местах выполняется проверка на наличие ошибок, способных вызвать преждевременное возвращение из подпрограммы.

*try-finally-statement*: **__try** *compound-statement*

**__finally**  *compound-statement*

Составной оператор после предложения `__try` представляет собой защищенный раздел. Составной оператор после предложения `__finally` является обработчиком завершения. Такой обработчик определяет набор действий, выполняемых при выходе из защищенного раздела, независимо от того, происходит ли выход в результате исключения (ненормальное завершение) или в результате стандартной передачи управления дальше (нормальное завершение).

Управление достигает оператора `__try` в процессе обычного последовательного выполнения (передачи управления дальше). При достижении оператора `__try` становится активным соответствующий обработчик. Выполнение происходит следующим образом:

1. Сначала выполняется защищенный раздел.

1. Вызывается обработчик завершения.

1. По окончании работы обработчика завершения выполнение продолжается после оператора `__finally`. Независимо от того, как завершается защищенный раздел (например, оператором `goto` выхода из защищенного тела или оператором `return`), перед выходом потока управления из защищенного раздела выполняется обработчик завершения.

В блоке оператора `__leave` можно использовать ключевое слово `try-finally`. Результат использования `__leave` — переход в конец блока `try-finally`. Сразу же выполняется обработчик завершения. Хотя для получения того же результата можно использовать оператор `goto`, он (оператор `goto`) приводит к освобождению стека. Оператор `__leave` более эффективен, поскольку не вызывает освобождение стека.

Выход из оператора `try-finally` с помощью оператора `return` или функции времени выполнения `longjmp` считается ненормальным завершением. Переход к оператору `__try` недопустим, но допустим выход из него. Все операторы `__finally`, которые активны между исходной точкой и точкой назначения, должны быть выполнены. Это называется локальной раскруткой.

Если при выполнении оператора `try-finally` процесс удаляется, обработчик завершения не вызывается.

> [!NOTE]
>  Структурированная обработка исключений поддерживается с исходными файлами C и C++. Однако она не предназначена специально для C++. Для того чтобы ваш код лучше переносился, лучше использовать механизм обработки исключений языка C++. Кроме того, механизм обработки исключений C++ обеспечивает намного более высокую гибкость, поскольку может обрабатывать исключения любого типа.

> [!NOTE]
>  Для программ C++ вместо структурированной обработки исключений следует использовать обработку исключений C++. Дополнительные сведения см. в разделе [Обработка исключений](../cpp/exception-handling-in-visual-cpp.md) в *справочнике по языку C++*.

Чтобы увидеть, как работает оператор `try-finally`, обратитесь к примеру [try-except statement](../c-language/try-except-statement-c.md).

**Завершение блока, относящегося только к системам Майкрософт**

## <a name="see-also"></a>См. также

[Оператор try-finally](../cpp/try-finally-statement.md)