---
title: Учебник. вкперф и анализатор производительности Windows
description: Руководство по использованию вкперф и WPA для анализа C++ трассировок сборки.
ms.date: 11/03/2019
helpviewer_keywords:
- C++ Build Insights
- throughput analysis
- build time analysis
- vcperf.exe
ms.openlocfilehash: 091e366da9342f2561620d975ead2f01b5439bad
ms.sourcegitcommit: 3e8fa01f323bc5043a48a0c18b855d38af3648d4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/05/2020
ms.locfileid: "78334046"
---
# <a name="tutorial-vcperf-and-windows-performance-analyzer"></a>Учебник. вкперф и анализатор производительности Windows

::: moniker range="<=vs-2017"

Средства C++ сборки Insights доступны в Visual Studio 2019. Чтобы просмотреть документацию по этой версии, присвойте элементу управления выбора версии Visual Studio для этой статьи значение Visual Studio 2019.

::: moniker-end
::: moniker range="vs-2019"

В этом руководстве вы узнаете, как с помощью *вкперф. exe* собрать трассировку C++ сборки. Вы также узнаете, как просматривать эту трассировку в анализаторе производительности Windows.

## <a name="step-1-install-and-configure-windows-performance-analyzer"></a>Шаг 1. Установка и настройка анализатора производительности Windows

WPA — это средство просмотра трассировки, доступное в комплекте средств для развертывания и оценки Windows (ADK). Это отдельная служебная программа, которая не является частью компонентов, которые можно установить с помощью установщика Visual Studio.

Версия WPA, которая поддерживает C++ аналитические сведения, в настоящее время доступна только в предварительной версии Windows ADK Preview. Для доступа к этой предварительной версии необходимо зарегистрироваться в [программе предварительной оценки Windows](https://insider.windows.com). Чтобы получить предварительную версию Windows ADK, не нужно устанавливать операционную систему предварительной версии Windows 10 Preview. Вам нужно только зарегистрировать учетная запись Майкрософт в программе предварительной оценки Windows.

### <a name="to-download-and-install-wpa"></a>Загрузка и установка WPA

Примечание. для установки анализатора производительности Windows требуется Windows 8 или более поздняя версии.

1. Перейдите на [страницу скачивания](https://www.microsoft.com/en-us/software-download/windowsinsiderpreviewADK)предварительной версии Windows ADK Insider Preview.

1. Загрузите предварительную версию Windows ADK Insider Preview. Это образ диска.

1. Откройте образ диска и запустите установщик *адксетуп. exe* .

1. При появлении запроса на выбор компонентов, которые необходимо установить, выберите **набор средств производительности Windows**. При желании вы можете выбрать другие компоненты, но не обязательно устанавливать WPA.

   ![Экран выбора компонентов установщика Windows Performance Analyzer](media/wpa-installation.png)

### <a name="configuration-steps"></a>Настройка аналитики для сборки

1. Запустите WPA.

1. Выберите **окно** > **выберите таблицы (экспериментальные)** .

1. Прокрутите вниз до раздела **Диагностика** .

1. Выберите все представления КОМПИЛЯТОРОМ MSVC Build Insights.

   ![Панель выбора таблиц анализатора производительности Windows](media/wpa-configuration.png)

## <a name="step-2-trace-your-build-with-vcperfexe"></a>Шаг 2. трассировка сборки с помощью вкперф. exe

Чтобы просмотреть C++ данные сборки Insights, сначала соберите их в файл трассировки, выполнив следующие действия:

1. Откройте командную строку разработчика собственных средств или средств для перекрестных инструментов для Visual Studio 2019 в режиме администратора. (Щелкните правой кнопкой мыши пункт меню "Пуск" и выберите **больше** > **Запуск от имени администратора**.)

1. В окне командной строки введите следующую команду:

   **вкперф. exe/Start _SessionName_**

   Выберите имя сеанса, которое будет запоминать при вводе *в сеанс.*

1. Создайте проект обычным образом. Для сборки не нужно использовать то же окно командной строки.

1. В окне командной строки введите следующую команду:

   **вкперф. exe/stop _SessionName_ _traceFile. ETL_**

   Используйте то же имя сеанса, которое вы выбрали для параметра *SessionName* . Выберите подходящее имя для файла трассировки *traceFile. ETL* .

Вот как выглядит стандартная Командная последовательность *вкперф. exe* в окне командной строки разработчика:

![Простой сценарий использования вкперф. exe](media/vcperf-simple-usage.png)

### <a name="important-notes-about-vcperfexe"></a>Важные замечания о вкперф. exe

- Для запуска или завершения трассировки *вкперф. exe* требуются права администратора. Используйте окно командной строки разработчика, открываемое с помощью команды **Запуск от имени администратора**.

- На компьютере может выполняться только один сеанс трассировки.

- Обязательно запомните имя сеанса, использованное для запуска трассировки. Выполнение сеанса может быть проблематичным, не зная его имени.

- Как и *CL. exe* и *Link. exe*, программа командной строки *вкперф. exe* включена в установку компилятором MSVC. Для получения этого компонента никаких дополнительных действий не требуется.

- *вкперф. exe* собирает сведения обо всех средствах компилятором MSVC, выполняющихся в системе. В результате вы не должны запускать сборку из той же командной строки, которая использовалась для накопления трассировки. Проект можно построить из другой командной строки или даже в Visual Studio.

## <a name="step-3-view-your-trace-in-windows-performance-analyzer"></a>Шаг 3. Просмотр трассировки в анализаторе производительности Windows

Запустите WPA и откройте только что собранную трассировку. WPA должен распознать его как C++ трассировку Build Insights, и следующие представления должны отображаться на панели проводника графов слева:

- Обозреватель сборки
- Файлы
- Компонент

Если эти представления не отображаются, проверьте правильность настройки WPA, как описано в [шаге 1](#configuration-steps). Вы можете просмотреть данные сборки, перетащив представления в пустое окно анализа справа, как показано ниже:

![Просмотр трассировки C++ по сборке Insights в анализаторе производительности Windows](media/wpa-viewing-trace.gif)

Другие представления доступны на панели Обозреватель графов. Перетащите их в окно анализ, когда вас интересует информация, которую они содержат. Полезным является представление ЦП (выборка), которое показывает загрузку ЦП во время сборки.

## <a name="more-information"></a>Дополнительные сведения

[Учебник. основные\ анализатора производительности Windows](wpa-basics.md)
Сведения об общих операциях WPA, которые могут помочь при анализе трассировок сборки.

[Ссылка: команды вкперф](/cpp/build-insights/reference/vcperf-commands)\
В справочнике по командам *вкперф. exe* перечислены все доступные параметры команды.

[Справочник: представления анализатора производительности Windows](/cpp/build-insights/reference/wpa-views)\
Дополнительные сведения о представлениях C++ Build Insights в WPA см. в этой статье.

[Анализатор производительности Windows](/windows-hardware/test/wpt/windows-performance-analyzer)\
Официальный сайт документации по WPA.

::: moniker-end
