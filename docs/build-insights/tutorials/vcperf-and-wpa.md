---
title: 'Учебник: vcperf и анализатор производительности Windows'
description: Учебник по использованию vcperf и WPA для анализа следов сборки СЗ.
ms.date: 11/03/2019
helpviewer_keywords:
- C++ Build Insights
- throughput analysis
- build time analysis
- vcperf.exe
ms.openlocfilehash: c22f3dfddfd346d4f0eee898cb5164fd8923336e
ms.sourcegitcommit: c123cc76bb2b6c5cde6f4c425ece420ac733bf70
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81323412"
---
# <a name="tutorial-vcperf-and-windows-performance-analyzer"></a>Учебник: vcperf и анализатор производительности Windows

::: moniker range="<=vs-2017"

Инструменты для построения СЗ доступны в Visual Studio 2019. Чтобы увидеть документацию для этой версии, установите элемент управления **селектора** визуальной версии для этой статьи на Visual Studio 2019. Он находится в верхней части таблицы содержимого на этой странице.

::: moniker-end
::: moniker range="vs-2019"

В этом учебнике вы узнаете, как использовать *vcperf.exe* для сбора следов сборки се. Вы также узнаете, как просмотреть этот след в Windows Performance Analyzer.

## <a name="step-1-install-and-configure-windows-performance-analyzer"></a>Шаг 1: Установка и настройка анализатора производительности Windows

WPA — это отслеживающий элемент, доступный в комплекте для оценки и развертывания Windows (ADK). Это отдельная утилита, которая не является частью компонентов, которые можно установить с помощью установки Visual Studio.

Версия WPA, которая поддерживает исследования сборки сс. в настоящее время доступна только в предварительном просмотре предварительного просмотра Windows ADK Insider. Чтобы получить доступ к этому предварительному просмотру, необходимо подписаться на [программу предварительной оценки Windows.](https://insider.windows.com) Вам не нужно устанавливать операционную систему предварительного просмотра Windows 10 Insider Preview для получения предварительного просмотра Windows ADK. Вам нужно зарегистрировать учетную запись Майкрософт в программе предварительной оценки Windows.

### <a name="to-download-and-install-wpa"></a>Для загрузки и установки WPA

ПРИМЕЧАНИЕ: Windows 8 или выше требуется для установки windows Performance Analyzer.

1. Просмотрите [страницу загрузки](https://www.microsoft.com/en-us/software-download/windowsinsiderpreviewADK)windows ADK Insider Preview.

1. Скачать предварительный просмотр Предварительного просмотра Windows ADK. Это изображение диска.

1. Откройте изображение диска и запустите установку *adksetup.exe.*

1. При запросе функций, которые вы хотите установить, выберите **набор инструментов производительности Windows.** Вы можете выбрать другие функции, если хотите, но они не обязаны устанавливать WPA.

   ![Экран выбора функций установщика производительности Windows](media/wpa-installation.png)

### <a name="to-configure-build-insights"></a><a name="configuration-steps"></a>Настройка анализа сборки

1. Запуск WPA.

1. Выберите таблицы **выбора окна** > **(экспериментальные)**.

1. Прокрутите вниз в разделе **Диагностика.**

1. Выберите все представления MSVC Build Insights.

   ![Панель выбора таблицы анализа производительности Windows](media/wpa-configuration.png)

## <a name="step-2-trace-your-build-with-vcperfexe"></a>Шаг 2: Проследите сборку с помощью vcperf.exe

Для просмотра данных СЗ Build Insights сначала соберите их в файл трассировки, выдыхая следующие действия:

1. Откройте нативные инструменты или кросс-инструменты разработчику команды запрос для Visual Studio 2019 в режиме администратора. (Право нажмите элемент меню «Пуск» и выберите **«Больше** > **запуска» в качестве администратора.)**

1. В окне запроса команды введите эту команду:

   **vcperf.exe /начало _SessionName_**

   Выберите имя сеанса, которое вы запомните для *SessionName.*

1. Создайте свой проект, как обычно. Вам не нужно использовать то же окно оперативного запроса команды для построения.

1. В окне запроса команды введите эту команду:

   **vcperf.exe/stop _SessionName_ _traceFile.etl_**

   Используйте то же имя сеанса, которое вы выбрали для *SessionName* раньше. Выберите подходящее имя для файла трассировки *traceFile.*

Вот как выглядит типичная последовательность команд *vcperf.exe* в окне запроса команды разработчика:

![Простой сценарий использования vcperf.exe](media/vcperf-simple-usage.png)

### <a name="important-notes-about-vcperfexe"></a>Важные заметки о vcperf.exe

- Привилегии администратора необходимы для запуска или остановки трассы *vcperf.exe.* Используйте окно запроса команды разработчика, которое открывается, используя **Run в качестве администратора.**

- На машине может работать только один сеанс отслеживания.

- Убедитесь в том, чтобы запомнить имя сеанса, которое вы использовали, чтобы начать свой след. Это может быть хлопотно, чтобы остановить запуск сессии, не зная его имя.

- Так же, как *cl.exe* и *link.exe*, командная линия утилиты *vcperf.exe* включена в установку MSVC. Для получения этого компонента не требуется никаких дополнительных шагов.

- *vcperf.exe* собирает информацию обо всех инструментах MSVC, работающих в вашей системе. В результате вам не придется запускать сборку с той же команды, которая используется для сбора трассы. Вы можете построить свой проект либо из другой команды запрос, или даже в Visual Studio.

## <a name="step-3-view-your-trace-in-windows-performance-analyzer"></a>Шаг 3: Просмотр трассировки в анализаторе производительности Windows

Запустите WPA и откройте только что собранный вами след. WPA должна признать его в качестве следа исследования сборки, и следующие представления должны отображаться в панели Graph Explorer слева:

- Обозреватель построений
- Файлы
- Компонент

Если вы не видите эти представления, перепроверьте, что WPA настроен правильно, как описано в [шаге 1](#configuration-steps). Можно просмотреть данные сборки, перетащив представления в пустое окно анализа справа, как показано здесь:

![Просмотр трассы «Исследования сборки» в анализаторе производительности Windows](media/wpa-viewing-trace.gif)

Другие представления доступны в панели Graph Explorer. Перетащите их в окно анализа, когда вы заинтересованы в информации, которая они содержат. Полезным является представление процессора (Sampled), которое показывает использование процессора на протяжении всей сборки.

## <a name="more-information"></a>Дополнительные сведения

[Учебник: Основы анализа производительности Windows](wpa-basics.md)\
Узнайте об общих операциях WPA, которые помогут вам проанализировать следы сборки.

[Справка: команды vcperf](/cpp/build-insights/reference/vcperf-commands)\
Ссылка на команду *vcperf.exe* перечисляет все доступные параметры команд.

[Справка: Представления анализа производительности Windows](/cpp/build-insights/reference/wpa-views)\
Обратитесь к этой статье для получения подробной информации о представлениях «Сборка» в WPA.

[Анализатор производительности Windows](/windows-hardware/test/wpt/windows-performance-analyzer)\
Официальный сайт документации WPA.

::: moniker-end
