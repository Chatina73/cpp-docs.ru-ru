---
title: Пошаговое руководство. Создание и использование статической библиотеки (C++)
description: Создание статической библиотеки (LIB) в Visual Studio с использованием C++
ms.custom: get-started-article
ms.date: 04/13/2020
helpviewer_keywords:
- libraries [C++], static
- static libraries [C++]
ms.assetid: 3cc36411-7d66-4240-851e-dacb9a8fd6ac
ms.openlocfilehash: 6cb379baafc506570b1bdc1b286b35c40f8cd0d8
ms.sourcegitcommit: 9c2b3df9b837879cd17932ae9f61cdd142078260
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/29/2020
ms.locfileid: "92924376"
---
# <a name="walkthrough-create-and-use-a-static-library"></a>Пошаговое руководство. Создание и использование статической библиотеки

В этом пошаговом руководстве описывается создание статической библиотеки (LIB-файла) для использования с приложениями C++. Статические библиотеки являются хорошим способом повторного использования кода. Вместо того чтобы каждый раз реализовывать одни и те же подпрограммы для обеспечения той или иной функциональности в каждом создаваемом приложении, их можно создать единожды и затем вызывать из приложений. Код, подключенный из статической библиотеки, становится частью вашего приложения — для использования кода не нужно устанавливать еще какой-либо файл.

В этом пошаговом руководстве рассматриваются следующие задачи:

- [Создание проекта статической библиотеки](#CreateLibProject)

- [Добавление класса в статическую библиотеку](#AddClassToLib)

- [Создание консольного приложения C++, ссылающегося на статическую библиотеку](#CreateAppToRefTheLib)

- [Использование функциональности из статической библиотеки в приложении](#UseLibInApp)

- [Запуск приложения](#RunApp)

## <a name="prerequisites"></a>Предварительные требования

Для работы необходимо владеть основами языка C++.

## <a name="create-a-static-library-project"></a><a name="CreateLibProject"></a> Создание проекта статической библиотеки

Инструкции по созданию проекта зависят от используемой версии Visual Studio. Чтобы ознакомиться с документацией по предпочтительной версии Visual Studio, используйте селектор **Версия**. Он находится в верхней части оглавления на этой странице.

::: moniker range="msvc-160"

### <a name="to-create-a-static-library-project-in-visual-studio-2019"></a>Создание проекта статической библиотеки в Visual Studio 2019

1. В строке меню выберите **Файл**  > **Создать**  > **Проект** , чтобы открыть диалоговое окно **Создание проекта**.

1. В верхней части диалогового окна для параметра **Язык** установите значение **C++** , для параметра **Платформа**  — значение **Windows** , а для параметра **Тип проекта**  — значение **Библиотека**.

1. В отфильтрованном списке типов проектов выберите пункт **Мастер классических приложений Windows** , а затем нажмите кнопку **Далее**.

1. На странице **Настроить новый проект** введите *MathLibrary* в поле **Имя проекта**. В поле **Имя решения** введите *StaticMath*. Нажмите кнопку **Создать** , чтобы открыть диалоговое окно **Проект классического приложения Windows**.

1. В диалоговом окне **Проект классического приложения Windows** в разделе **Тип приложения** выберите **Статическая библиотека (.lib)** .

1. В разделе **Дополнительные параметры** снимите флажок **Предварительно откомпилированный заголовок** , если он установлен. Установите флажок **Пустой проект**.

1. Нажмите кнопку **ОК** , чтобы создать проект.

::: moniker-end

::: moniker range="msvc-150"

### <a name="to-create-a-static-library-project-in-visual-studio-2017"></a>Создание проекта статической библиотеки в Visual Studio 2017

1. В строке меню щелкните **Файл** > **Создать** > **Проект**.

1. В диалоговом окне **Новый проект** выберите **Установленные** > **Visual C++**  > **Классическое приложение для Windows**. На центральной панели выберите **Мастер классических приложений Windows**.

1. Укажите имя для проекта, например *MathLibrary* , в поле **Имя**. Укажите имя для решения, например *StaticMath* , в поле **Имя решения**. Нажмите кнопку **ОК** .

1. В диалоговом окне **Проект классического приложения Windows** в разделе **Тип приложения** выберите **Статическая библиотека (.lib)** .

1. В разделе **Дополнительные параметры** снимите флажок **Предварительно откомпилированный заголовок** , если он установлен. Установите флажок **Пустой проект**.

1. Нажмите кнопку **ОК** , чтобы создать проект.

::: moniker-end

::: moniker range="msvc-140"

### <a name="to-create-a-static-library-project-in-visual-studio-2015"></a>Создание проекта статической библиотеки в Visual Studio 2015

1. В строке меню щелкните **Файл** > **Создать** > **Проект**.

1. В диалоговом окне **Новый проект** выберите **Установленные** > **Шаблоны** > **Visual C++**  > **Win32**. В центральной области выберите **Консольное приложение Win32**.

1. Укажите имя для проекта, например *MathLibrary* , в поле **Имя**. Укажите имя для решения, например *StaticMath* , в поле **Имя решения**. Нажмите кнопку **ОК** .

1. В **мастере приложений Win32** нажмите кнопку **Далее**.

1. На странице **Параметры приложения** в разделе **Тип приложения** выберите **Статическая библиотека**. В разделе **Дополнительные параметры** снимите флажок **Предварительно откомпилированный заголовок**. Чтобы создать проект, нажмите кнопку **Готово**.

::: moniker-end

## <a name="add-a-class-to-the-static-library"></a><a name="AddClassToLib"></a> Добавление класса в статическую библиотеку

### <a name="to-add-a-class-to-the-static-library"></a>Добавление класса в статическую библиотеку

1. Чтобы создать файл заголовка для нового класса откройте контекстное меню проекта **MathLibrary** в **обозревателе решений** , а затем выберите **Добавить** > **Новый элемент**.

1. В диалоговом окне **Добавление нового элемента** выберите пункт **Visual C++**  > **Код**. В центральной области выберите **Заголовочный файл (.h)** . Укажите имя для файла заголовка, например *MathLibrary.h* , и нажмите кнопку **Добавить**. Отобразится почти пустой файл заголовка.

1. Добавьте объявление класса с именем `Arithmetic` для выполнения обычных арифметических операций, таких как сложение, вычитание, умножение и деление. Код должен выглядеть примерно так:

    ```cpp
    // MathLibrary.h
    #pragma once

    namespace MathLibrary
    {
        class Arithmetic
        {
        public:
            // Returns a + b
            static double Add(double a, double b);

            // Returns a - b
            static double Subtract(double a, double b);

            // Returns a * b
            static double Multiply(double a, double b);

            // Returns a / b
            static double Divide(double a, double b);
        };
    }
    ```

1. Чтобы создать исходный файл для нового класса, откройте контекстное меню проекта **MathLibrary** в **обозревателе решений** , а затем выберите **Добавить** > **Новый элемент**.

1. В диалоговом окне **Добавление нового элемента** в центральной области выберите **Файл C++ (.cpp)** . Укажите имя исходного файла, например *MathLibrary.cpp* , и нажмите кнопку **Добавить**. Отобразится пустой исходный файл.

1. Используйте этот исходный файл для реализации функций класса `Arithmetic`. Код должен выглядеть примерно так:

    ```cpp
    // MathLibrary.cpp
    // compile with: cl /c /EHsc MathLibrary.cpp
    // post-build command: lib MathLibrary.obj

    #include "MathLibrary.h"

    namespace MathLibrary
    {
        double Arithmetic::Add(double a, double b)
        {
            return a + b;
        }

        double Arithmetic::Subtract(double a, double b)
        {
            return a - b;
        }

        double Arithmetic::Multiply(double a, double b)
        {
            return a * b;
        }

        double Arithmetic::Divide(double a, double b)
        {
            return a / b;
        }
    }
    ```

1. Чтобы выполнить сборку статической библиотеки, выберите в строке меню команду **Сборка** > **Собрать решение**. В результате будет создана статическая библиотека *MathLibrary.lib* , которая может использоваться другими программами.

   > [!NOTE]
   > При выполнении сборки из командной строки Visual Studio программа собирается в два этапа. Сначала запустите `cl /c /EHsc MathLibrary.cpp`, чтобы скомпилировать код и создать объектный файл с именем *MathLibrary.obj*. (Команда `cl` вызывает компилятор Cl.exe, а параметр `/c` дает указание компилировать без компоновки. Дополнительные сведения см. в разделе [Параметр /c (компиляция без связывания)](../build/reference/c-compile-without-linking.md). Во-вторых, запустите файл `lib MathLibrary.obj`, чтобы связать код и создать статическую библиотеку *MathLibrary.lib*. (Команда `lib` вызывает диспетчер библиотек, Lib.exe. Дополнительные сведения см. в разделе [LIB Reference](../build/reference/lib-reference.md).)

## <a name="create-a-c-console-app-that-references-the-static-library"></a><a name="CreateAppToRefTheLib"></a> Создание консольного приложения C++, ссылающегося на статическую библиотеку

::: moniker range="msvc-160"

### <a name="to-create-a-c-console-app-that-references-the-static-library-in-visual-studio-2019"></a>Создание консольного приложения C++, ссылающегося на статическую библиотеку, в Visual Studio 2019

1. В **обозревателе решений** щелкните правой кнопкой мыши узел верхнего уровня **Решение StaticMath** , чтобы открыть контекстное меню. Выберите пункты **Добавить** > **Новый проект** , чтобы открыть диалоговое окно **Добавить новый проект**.

1. В верхней части диалогового окна задайте для фильтра **Тип проекта** значение **Консоль**.

1. В отфильтрованном списке типов проектов щелкните **Консольное приложение** , а затем нажмите кнопку **Далее**. На следующей странице в поле **Имя** введите имя проекта *MathClient*.

1. Нажмите кнопку **Создать** , чтобы создать клиентский проект.

1. После создания консольного приложения будет создана пустая программа. Имя исходного файла будет совпадать с ранее выбранным именем. В этом примере он имеет имя `MathClient.cpp`.

::: moniker-end

::: moniker range="msvc-150"

### <a name="to-create-a-c-console-app-that-references-the-static-library-in-visual-studio-2017"></a>Создание консольного приложения C++, ссылающегося на статическую библиотеку, в Visual Studio 2017

1. В **обозревателе решений** щелкните правой кнопкой мыши узел верхнего уровня **Решение StaticMath** , чтобы открыть контекстное меню. Выберите пункты **Добавить** > **Новый проект** , чтобы открыть диалоговое окно **Добавить новый проект**.

1. В диалоговом окне **Добавление нового проекта** выберите **Установленные** > **Visual C++**  > **Классическое приложение для Windows**. На центральной панели выберите **Мастер классических приложений Windows**.

1. Укажите имя для проекта, например *MathClient* , в поле **Имя**. Нажмите кнопку **ОК** .

1. В диалоговом окне **Проект классического приложения Windows** в разделе **Тип приложения** выберите **Консольное приложение (EXE)** .

1. В разделе **Дополнительные параметры** снимите флажок **Предварительно откомпилированный заголовок** , если он установлен.

1. Нажмите кнопку **ОК** , чтобы создать проект.

1. После создания консольного приложения будет создана пустая программа. Имя исходного файла будет совпадать с ранее выбранным именем. В этом примере он имеет имя `MathClient.cpp`.

::: moniker-end

::: moniker range="msvc-140"

### <a name="to-create-a-c-console-app-that-references-the-static-library-in-visual-studio-2015"></a>Создание консольного приложения C++, ссылающегося на статическую библиотеку, в Visual Studio 2015

1. В **обозревателе решений** щелкните правой кнопкой мыши узел верхнего уровня **Решение StaticMath** , чтобы открыть контекстное меню. Выберите пункты **Добавить** > **Новый проект** , чтобы открыть диалоговое окно **Добавить новый проект**.

1. В диалоговом окне **Добавление нового проекта** выберите **Установленные** > **Visual C++**  > **Win32**. В центральной области выберите **Консольное приложение Win32**.

1. Укажите имя для проекта, например *MathClient* , в поле **Имя**. Нажмите кнопку **ОК** .

1. В диалоговом окне **Мастер приложений Win32** нажмите кнопку **Далее**.

1. На странице **Параметры приложения** выберите в поле **Тип приложения** пункт **Консольное приложение**. В разделе **Дополнительные параметры** снимите флажок **Предварительно откомпилированный заголовок** , а затем установите флажок **Пустой проект**. Чтобы создать проект, нажмите кнопку **Готово**.

1. Чтобы добавить исходный файл в пустой проект, откройте контекстное меню проекта **MathClient** в **обозревателе решений** , а затем выберите команду **Добавить**  > **Новый элемент**.

1. В диалоговом окне **Добавление нового элемента** выберите пункт **Visual C++**  > **Код**. В центральной области выберите **Файл C++ (.cpp)** . Укажите имя исходного файла, например *MathClient.cpp* , и нажмите кнопку **Добавить**. Отобразится пустой исходный файл.

::: moniker-end

## <a name="use-the-functionality-from-the-static-library-in-the-app"></a><a name="UseLibInApp"></a> Использование функциональности из статической библиотеки в приложении

### <a name="to-use-the-functionality-from-the-static-library-in-the-app"></a>Использование функциональности из статической библиотеки в приложении

1. Для использования математических процедур из статической библиотеки необходимо сослаться на эту библиотеку. В **обозревателе решений** откройте контекстное меню проекта **MathClient** , а затем выберите команду **Добавить** > **Ссылка**.

1. В диалоговом окне **Добавление ссылки** перечислены библиотеки, на которые можно создать ссылку. На вкладке **Проекты** перечислены проекты текущего решения и все библиотеки, на которые они ссылаются. На вкладке **Проекты** установите флажок **MathLibrary** , а затем нажмите кнопку **ОК**.

1. Для создания ссылки на файл заголовка `MathLibrary.h` необходимо изменить путь к каталогам включаемых файлов. В **обозревателе решений** щелкните правой кнопкой мыши проект **MathClient** , чтобы открыть контекстное меню. Выберите пункт **Свойства** , чтобы открыть диалоговое окно **Страницы свойств MathClient**.

1. В диалоговом окне **Страницы свойств MathClient** в раскрывающемся списке **Конфигурация** выберите пункт **Все конфигурации**. В раскрывающемся списке **Платформа** выберите пункт **Все платформы**.

1. Перейдите на страницу свойств **Свойства конфигурации** > **C/C++**  > **Общие**. В свойстве **Дополнительные каталоги включаемых файлов** укажите путь к каталогу **MathLibrary** или найдите этот каталог.

   Чтобы найти путь к каталогу, выполните указанные ниже действия.

   1. Откройте раскрывающийся список значений свойства **Дополнительные каталоги включаемых файлов** , а затем выберите **Изменить**.

   1. В диалоговом окне **Дополнительные каталоги включаемых файлов** дважды щелкните в верхней части текстового поля. Нажмите кнопку с многоточием ( **...** ) в конце строки.

   1. В диалоговом окне **Выбор каталога** перейдите на уровень вверх и выберите каталог **MathLibrary**. Затем нажмите кнопку **Выбрать папку** , чтобы сохранить выбор.

   1. В диалоговом окне **Дополнительные каталоги включаемых файлов** нажмите кнопку **ОК**.

   1. В диалоговом окне **Страницы свойств** нажмите кнопку **OK** , чтобы сохранить изменения в проекте.

1. Теперь в этом приложении можно использовать класс `Arithmetic`, включив в код заголовок `#include "MathLibrary.h"`. Замените содержимое `MathClient.cpp` на следующий код:

    ```cpp
    // MathClient.cpp
    // compile with: cl /EHsc MathClient.cpp /link MathLibrary.lib

    #include <iostream>
    #include "MathLibrary.h"

    int main()
    {
        double a = 7.4;
        int b = 99;

        std::cout << "a + b = " <<
            MathLibrary::Arithmetic::Add(a, b) << std::endl;
        std::cout << "a - b = " <<
            MathLibrary::Arithmetic::Subtract(a, b) << std::endl;
        std::cout << "a * b = " <<
            MathLibrary::Arithmetic::Multiply(a, b) << std::endl;
        std::cout << "a / b = " <<
            MathLibrary::Arithmetic::Divide(a, b) << std::endl;

        return 0;
    }
    ```

1. Чтобы выполнить сборку исполняемого файла, выберите в строке меню команду **Сборка** > **Собрать решение**.

## <a name="run-the-app"></a><a name="RunApp"></a> Запуск приложения

### <a name="to-run-the-app"></a>Запуск приложения

1. Убедитесь в том, что проект **MathClient** выбран в качестве проекта по умолчанию. Чтобы выбрать его, в **обозревателе решений** откройте контекстное меню проекта **MathClient** и выберите команду **Назначить запускаемым проектом**.

1. Чтобы запустить проект, в строке меню выберите **Отладка** > **Запуск без отладки**. Выходные данные должны выглядеть примерно так:

    ```Output
    a + b = 106.4
    a - b = -91.6
    a * b = 732.6
    a / b = 0.0747475
    ```

## <a name="see-also"></a>См. также

[Пошаговое руководство: Создание и использование библиотеки DLL (C++)](../build/walkthrough-creating-and-using-a-dynamic-link-library-cpp.md)<br/>
[Классические приложения (Visual C++)](../windows/desktop-applications-visual-cpp.md)<br/>
