---
title: Пошаговое руководство. Создание и использование статической библиотеки (C++)
description: Используйте C++ для создания статической библиотеки (. lib) в Visual Studio.
ms.custom: get-started-article
ms.date: 04/25/2019
helpviewer_keywords:
- libraries [C++], static
- static libraries [C++]
ms.assetid: 3cc36411-7d66-4240-851e-dacb9a8fd6ac
ms.author: corob
ms.openlocfilehash: c81ccd970383c8571a7d0d1e77d4b8fe44900bcf
ms.sourcegitcommit: 8e285a766523e653aeeb34d412dc6f615ef7b17b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/21/2020
ms.locfileid: "80078178"
---
# <a name="walkthrough-creating-and-using-a-static-library-c"></a>Пошаговое руководство. Создание и использование статической библиотеки (C++)

В этом пошаговом руководстве описывается создание статической библиотеки (LIB-файла) для использования с приложениями C++. Статические библиотеки являются хорошим способом повторного использования кода. Вместо того чтобы повторно реализовывать одни и те же подпрограммы в каждом приложении, требующем функциональности, вы пишете их один раз в статическую библиотеку, а затем ссылаетесь на нее из приложений. Код, подключенный из статической библиотеки, становится частью вашего приложения — для использования кода не нужно устанавливать еще какой-либо файл.

В этом пошаговом руководстве рассматриваются следующие задачи:

- [Создание проекта статической библиотеки](#CreateLibProject)

- [Добавление класса в статическую библиотеку](#AddClassToLib)

- [Создание консольного приложения C++, ссылающегося на статическую библиотеку](#CreateAppToRefTheLib)

- [Использование функциональности из статической библиотеки в приложении](#UseLibInApp)

- [Запуск приложения](#RunApp)

## <a name="prerequisites"></a>Предварительные требования

Для работы необходимо владеть основами языка C++.

##  <a name="creating-a-static-library-project"></a><a name="CreateLibProject"></a> Создание проекта статической библиотеки

Инструкции по созданию проекта зависят от того, используется ли Visual Studio 2019 или более ранняя версия. Убедитесь, что в левом верхнем углу этой страницы установлен правильный набор версий.

::: moniker range="vs-2019"

### <a name="to-create-a-static-library-project-in-visual-studio-2019"></a>Создание проекта статической библиотеки в Visual Studio 2019

1. В строке меню последовательно выберите **файл** > **создать** > **проект** , чтобы открыть диалоговое окно **Создание нового проекта** .

1. В верхней части диалогового окна для параметра **Язык** установите значение **C++** , для параметра **Платформа** — значение **Windows**, а для параметра **Тип проекта** — значение **Библиотека**.

1. В отфильтрованном списке типов проектов выберите **статическая библиотека** , а затем нажмите кнопку **Далее**. На следующей странице введите *MathFuncsLib* в поле **имя** , чтобы указать имя проекта, и при необходимости укажите расположение проекта.

1. Нажмите кнопку **Создать**, чтобы создать клиентский проект.

::: moniker-end

::: moniker range="vs-2017"

### <a name="to-create-a-static-library-project-in-visual-studio-2017"></a>Создание проекта статической библиотеки в Visual Studio 2017

1. В строке меню щелкните **Файл** > **Создать** > **Проект**.

1. В левой области диалогового окна **Новый проект** разверните узел **установленные** > **C++визуальный**элемент, а затем выберите пункт **Windows Desktop**. На центральной панели выберите **Мастер классических приложений Windows**.

1. Укажите имя для проекта, например *MathFuncsLib*, в поле **Имя** . Укажите имя для решения, например *StaticLibrary*, в поле **Имя решения** . Выберите кнопку **ОК**.

1. В разделе **Тип приложения**выберите **статическая библиотека (. lib)** .

1. В разделе **Дополнительные параметры**снимите флажок **предкомпилированный заголовок** .

1. Нажмите кнопку **ОК** , чтобы создать проект.

::: moniker-end

::: moniker range="vs-2015"

### <a name="to-create-a-static-library-project-in-visual-studio-2015"></a>Создание проекта статической библиотеки в Visual Studio 2015

1. В строке меню щелкните **Файл** > **Создать** > **Проект**.

1. В диалоговом окне **Новый проект** разверните узел **установленные** **шаблоны** >  > **визуальный C++** элемент, а затем выберите **Win32**. В центральной области выберите **Консольное приложение Win32**.

1. Укажите имя для проекта, например *MathFuncsLib*, в поле **Имя** . Укажите имя для решения, например *StaticLibrary*, в поле **Имя решения** . Выберите кнопку **ОК**.

1. Нажмите кнопку **Далее**.

1. В разделе **Тип приложения**выберите **статическая библиотека**. Снимите флажок в поле **предварительно скомпилированный заголовок** и нажмите кнопку **Готово**.

::: moniker-end

##  <a name="adding-a-class-to-the-static-library"></a><a name="AddClassToLib"></a> Добавление класса в статическую библиотеку

### <a name="to-add-a-class-to-the-static-library"></a>Добавление класса в статическую библиотеку

1. Чтобы создать файл заголовка для нового класса, откройте контекстное меню проекта **MathFuncsLib** в **Обозреватель решений**, а затем выберите **добавить** > **новый элемент**. В диалоговом окне **Добавление нового элемента** в левой области в разделе **Visual C++** выберите **Код**. В центральной области выберите **Заголовочный файл (.h)** . Укажите имя для файла заголовка, например *MathFuncsLib.h*, и нажмите кнопку **Добавить** . Отобразится пустой файл заголовка.

1. Добавьте класс с именем `MyMathFuncs` для выполнения стандартных математических операций, таких как сложение, вычитание, умножение и деление. Код должен выглядеть следующим образом:

   [!code-cpp[NVC_Walkthrough_Create_Static_Lib#100](../windows/codesnippet/CPP/walkthrough-creating-and-using-a-static-library-cpp_1.h)]

1. Чтобы создать исходный файл для нового класса, откройте контекстное меню проекта **MathFuncsLib** в **Обозреватель решений**, а затем выберите **добавить** > **новый элемент**. В диалоговом окне **Добавление нового элемента** в левой области в разделе **Visual C++** выберите **Код**. В центральной области выберите **Файл C++ (.cpp)** . Укажите имя исходного файла, например *MathFuncsLib.cpp*, и нажмите кнопку **Добавить** . Отобразится пустой исходный файл.

1. Используйте этот исходный файл для реализации функций **MyMathFuncs**. Код должен выглядеть следующим образом:

   [!code-cpp[NVC_Walkthrough_Create_Static_Lib#110](../windows/codesnippet/CPP/walkthrough-creating-and-using-a-static-library-cpp_2.cpp)]

1. Скомпилируйте статическую библиотеку, выбрав **сборка** > **Сборка решение** в строке меню. При компиляции создается статическая библиотека, которая может использоваться другими программами.

   > [!NOTE]
   > При выполнении сборки из командной строки Visual Studio программа собирается в два этапа. Сначала запустите `cl /c /EHsc MathFuncsLib.cpp`, чтобы скомпилировать код и создать объектный файл с именем `MathFuncsLib.obj`. (Команда `cl` вызывает компилятор Cl.exe, а параметр `/c` дает указание компилировать без компоновки. Дополнительные сведения см. в разделе [/c (компиляция без компоновки)](../build/reference/c-compile-without-linking.md). Во вторых, запустите `lib MathFuncsLib.obj`, чтобы связать код и создать статическую библиотеку `MathFuncsLib.lib`. (Команда `lib` вызывает диспетчер библиотек, Lib.exe. Дополнительные сведения см. в разделе [LIB Reference](../build/reference/lib-reference.md).)

##  <a name="creating-a-c-console-app-that-references-the-static-library"></a><a name="CreateAppToRefTheLib"></a> Создание консольного приложения C++, ссылающегося на статическую библиотеку

::: moniker range="vs-2019"

### <a name="to-create-a-c-console-app-that-references-the-static-library-in-visual-studio-2019"></a>Создание C++ консольного приложения, ссылающегося на статическую библиотеку в Visual Studio 2019

1. В **Обозреватель решений**щелкните правой кнопкой мыши верхний узел решения и выберите **Добавить** > **Новый проект** , чтобы открыть диалоговое окно **Добавление нового проекта** .

1. В верхней части диалогового окна для параметра **Язык** выберите значение **C++** , для параметра **Платформа** — значение **Windows**, а для параметра **Тип проекта** — значение **Консоль**.

1. В отфильтрованном списке типов проектов щелкните **Консольное приложение**, а затем нажмите кнопку **Далее**. На следующей странице в поле **имя** введите *MyExecRefsLib* , чтобы указать имя проекта, и при необходимости укажите расположение проекта.

1. Нажмите кнопку **Создать**, чтобы создать клиентский проект.

::: moniker-end

::: moniker range="vs-2017"

### <a name="to-create-a-c-console-app-that-references-the-static-library-in-visual-studio-2017"></a>Создание C++ консольного приложения, ссылающегося на статическую библиотеку в Visual Studio 2017

1. В строке меню щелкните **Файл** > **Создать** > **Проект**.

1. В левой области диалогового окна **Новый проект** разверните узел **установленные** > **C++визуальный**элемент, а затем выберите пункт **Windows Desktop**. На центральной панели выберите **Мастер классических приложений Windows**.

1. Укажите имя проекта, например *MyExecRefsLib*, в поле **Имя** . В раскрывающемся списке рядом с полем **Решение**выберите **Добавить в решение**. Команда добавляет новый проект в решение, содержащее статическую библиотеку. Выберите кнопку **ОК**.

1. В разделе **Тип приложения**выберите **консольное приложение (. exe)** .

1. В разделе **Дополнительные параметры**снимите флажок **предкомпилированный заголовок** .

1. Нажмите кнопку **ОК** , чтобы создать проект.

::: moniker-end

::: moniker range="vs-2015"

### <a name="to-create-a-c-console-app-that-references-the-static-library-in-visual-studio-2015"></a>Создание C++ консольного приложения, ссылающегося на статическую библиотеку в Visual Studio 2015

1. В строке меню щелкните **Файл** > **Создать** > **Проект**.

1. В диалоговом окне **Новый проект** разверните узел **установленные** **шаблоны** >  > **визуальный C++** элемент, а затем выберите **Win32**. В центральной области выберите **Консольное приложение Win32**.

1. Укажите имя проекта, например *MyExecRefsLib*, в поле **Имя** . В раскрывающемся списке рядом с полем **Решение**выберите **Добавить в решение**. Команда добавляет новый проект в решение, содержащее статическую библиотеку. Выберите кнопку **ОК**.

1. Нажмите кнопку **Далее**.

1. Убедитесь, что выбрано **консольное приложение** . Затем установите флажок **пустой проект** и нажмите кнопку **Готово**.

::: moniker-end

##  <a name="using-the-functionality-from-the-static-library-in-the-app"></a><a name="UseLibInApp"></a> Использование функциональности из статической библиотеки в приложении

### <a name="to-use-the-functionality-from-the-static-library-in-the-app"></a>Использование функциональности из статической библиотеки в приложении

1. После создания консольного приложения будет создана пустая программа. Имя исходного файла будет совпадать с ранее выбранным именем. В этом примере он называется `MyExecRefsLib.cpp`.

1. Для использования математических процедур из статической библиотеки необходимо сослаться на эту библиотеку. Откройте контекстное меню проекта **MyExecRefsLib** в **Обозреватель решений**, а затем выберите **добавить** > **ссылку**.

1. В диалоговом окне **Добавление ссылки** перечислены библиотеки, на которые можно создать ссылку. На вкладке **проекты** перечислены проекты в текущем решении и все библиотеки, на которые они ссылаются. На вкладке **Проекты** установите флажок **MathFuncsLib** , а затем нажмите кнопку **ОК** .

1. Чтобы сослаться на файл заголовка `MathFuncsLib.h`, необходимо изменить путь к включаемым каталогам. Для этого в диалоговом окне **Окна свойств** библиотеки **MyExecRefsLib**последовательно разверните узлы **Свойства конфигурации** , **C/C++** , а затем выберите **Общие**. Рядом с **дополнительными каталогами включения**укажите путь к каталогу **MathFuncsLib** или найдите его.

   Чтобы найти путь к каталогу, откройте раскрывающийся список значений свойства и выберите **Изменить**. В диалоговом окне **Дополнительные каталоги включаемых** данных в текстовом поле выберите пустую строку и нажмите кнопку с многоточием ( **...** ) в конце строки. В диалоговом окне **Выбор каталога** выберите каталог **MathFuncsLib** и нажмите кнопку **Выбор папки** , чтобы сохранить выбранное значение и закрыть диалоговое окно. В диалоговом окне **Дополнительные каталоги включаемых файлов** , нажмите кнопку **ОК** , затем в диалоговом окне **Окна свойств** нажмите кнопку **ОК** для сохранения изменений в проект.

1. Теперь можно использовать класс `MyMathFuncs` в этом приложении, включив в код заголовок `#include "MathFuncsLib.h"`. Замените содержимое `MyExecRefsLib.cpp` следующим кодом:

   [!code-cpp[NVC_Walkthrough_Create_Static_Lib#120](../windows/codesnippet/CPP/walkthrough-creating-and-using-a-static-library-cpp_3.cpp)]

1. Создайте исполняемый файл, выбрав **сборка** > **Сборка решение** в строке меню.

##  <a name="running-the-app"></a><a name="RunApp"></a> Запуск приложения

### <a name="to-run-the-app"></a>Запуск приложения

1. Убедитесь, что проект **MyExecRefsLib** выбран в качестве проекта по умолчанию, открыв контекстное меню для **MyExecRefsLib** в **обозревателе решений**и выбрав пункт **Назначить запускаемым проектом**.

1. Чтобы запустить проект, в строке меню выберите **Отладка** > **Запуск без отладки**. Выходные данные должны выглядеть следующим образом:

    ```Output
    a + b = 106.4
    a - b = -91.6
    a * b = 732.6
    a / b = 0.0747475
    ```

## <a name="see-also"></a>См. также:

[Пошаговое руководство. Создание и использование библиотеки DLL (C++)](../build/walkthrough-creating-and-using-a-dynamic-link-library-cpp.md)<br/>
[Классические приложения (Visual C++)](../windows/desktop-applications-visual-cpp.md)<br/>
