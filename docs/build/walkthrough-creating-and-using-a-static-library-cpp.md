---
title: 'Прохождение: Создайте и используйте статическую библиотеку'
description: Используйте СЗ для создания статической библиотеки (.lib) в Visual Studio.
ms.custom: get-started-article
ms.date: 04/13/2020
helpviewer_keywords:
- libraries [C++], static
- static libraries [C++]
ms.assetid: 3cc36411-7d66-4240-851e-dacb9a8fd6ac
ms.openlocfilehash: 7148cc1de7c06ae57d61560311b342a1fc9dda1f
ms.sourcegitcommit: c123cc76bb2b6c5cde6f4c425ece420ac733bf70
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81335139"
---
# <a name="walkthrough-create-and-use-a-static-library"></a>Прохождение: Создание и использование статической библиотеки

В этом пошаговом руководстве описывается создание статической библиотеки (LIB-файла) для использования с приложениями C++. Статические библиотеки являются хорошим способом повторного использования кода. Вместо того, чтобы повторно реализовать одни и те же процедуры в каждом приложении, которое требует функциональности, вы пишете их один раз в статической библиотеке, а затем ссылаетесь на него из приложений. Код, связанный со статической библиотекой, становится частью приложения — для использования кода не нужно устанавливать другой файл.

В этом пошаговом руководстве рассматриваются следующие задачи:

- [Создание проекта статической библиотеки](#CreateLibProject)

- [Добавление класса в статическую библиотеку](#AddClassToLib)

- [Создайте приложение для консоли СЗ, которое ссылается на статическую библиотеку](#CreateAppToRefTheLib)

- [Используйте функциональность из статической библиотеки в приложении](#UseLibInApp)

- [Запустите приложение](#RunApp)

## <a name="prerequisites"></a>Предварительные требования

Для работы необходимо владеть основами языка C++.

## <a name="create-a-static-library-project"></a><a name="CreateLibProject"></a>Создание проекта статической библиотеки

Инструкции по созданию проекта варьируются в зависимости от вашей версии Visual Studio. Чтобы просмотреть документацию для предпочтительной версии Visual Studio, используйте элемент управления селектора **версии.** Он находится в верхней части таблицы содержимого на этой странице.

::: moniker range="vs-2019"

### <a name="to-create-a-static-library-project-in-visual-studio-2019"></a>Создание проекта статической библиотеки в Visual Studio 2019

1. В строке меню выберите **Файл** > **Создать** > **Проект**, чтобы открыть диалоговое окно **Создание проекта**.

1. В верхней части диалогового окна для параметра **Язык** установите значение **C++**, для параметра **Платформа** — значение **Windows**, а для параметра **Тип проекта** — значение **Библиотека**.

1. Из отфильтрованного списка типов проектов выберите **Windows Desktop Wizard,** затем выберите **Следующий**.

1. На новой странице проекта На **настройке** введите *MathLibrary* в поле **с названием проекта,** чтобы указать имя проекта. Введите *StaticMath* в поле **имени решения.** Выберите кнопку **«Создание»,** чтобы открыть диалог **проекта Windows Desktop** Project.

1. В диалоге **проекта Windows Desktop,** под **типом приложения,** выберите **Статическую библиотеку (.lib).**

1. Под **дополнительными опциями**отоверьте **предсоштабированное** окно проверки заголовка, если оно проверено. Проверьте пустой ящик **проекта.**

1. Выберите **OK** для создания проекта.

::: moniker-end

::: moniker range="vs-2017"

### <a name="to-create-a-static-library-project-in-visual-studio-2017"></a>Создание проекта статической библиотеки в Visual Studio 2017

1. В строке меню щелкните **Файл** > **Создать** > **Проект**.

1. В диалоговом окне **нового проекта** выберите **установленный** > **визуальный** > **рабочий стол Windows**Desktop. На центральной панели выберите **Мастер классических приложений Windows**.

1. Укажите название проекта, например, *MathLibrary*— в поле **«Имя».** Укажите имя для решения, например, *StaticMath*в поле **«Имя решения».** Выберите кнопку **ОК**.

1. В диалоге **проекта Windows Desktop,** под **типом приложения,** выберите **Статическую библиотеку (.lib).**

1. В **дополнительных опциях**отоверьте **предсборникзанный заголовок,** если оно проверено. Проверьте пустой ящик **проекта.**

1. Выберите **OK** для создания проекта.

::: moniker-end

::: moniker range="vs-2015"

### <a name="to-create-a-static-library-project-in-visual-studio-2015"></a>Создание проекта статической библиотеки в Visual Studio 2015

1. В строке меню щелкните **Файл** > **Создать** > **Проект**.

1. В диалоговом окне **нового проекта** выберите **установленные** > **шаблоны** > Visual**C'Win32** > **Win32**. В центральной области выберите **Консольное приложение Win32**.

1. Укажите название проекта, например, *MathLibrary*— в поле **«Имя».** Укажите имя для решения, например, *StaticMath*в поле **«Имя решения».** Выберите кнопку **ОК**.

1. В **Win32 Приложение Мастер**, выберите **Следующий**.

1. На странице **Настройки приложений** под **типом приложения**выберите **библиотеку Static.** Под **дополнительными опциями**отоверьте предсборникный флажок **заголовка.** Выберите **finish** для создания проекта.

::: moniker-end

## <a name="add-a-class-to-the-static-library"></a><a name="AddClassToLib"></a>Добавление класса в статическую библиотеку

### <a name="to-add-a-class-to-the-static-library"></a>Добавление класса в статическую библиотеку

1. Чтобы создать файл заголовка для нового класса, нажмите правой кнопкой мыши, чтобы открыть меню ярлыка для проекта **MathLibrary** в **Solution Explorer,** а затем выберите **Добавить** > **новый элемент.**

1. В диалоговом окне **Добавить новый элемент** выберите**визуальный код** **C .** >  В центральной области выберите **Заголовочный файл (.h)**. Укажите имя файла заголовка, например, *MathLibrary.h,* а затем выберите кнопку **«Добавить».** Отображается почти пустой файл заголовка.

1. Добавьте декларацию для `Arithmetic` класса, названного для проведения общих математических операций, таких как добавление, вычитание, умножение и деление. Код должен напоминать:

    ```cpp
    // MathLibrary.h
    #pragma once

    namespace MathLibrary
    {
        class Arithmetic
        {
        public:
            // Returns a + b
            static double Add(double a, double b);

            // Returns a - b
            static double Subtract(double a, double b);

            // Returns a * b
            static double Multiply(double a, double b);

            // Returns a / b
            static double Divide(double a, double b);
        };
    }
    ```

1. Чтобы создать исходный файл для нового класса, откройте меню ярлыка для проекта **MathLibrary** в **Solution Explorer,** а затем выберите **Добавить** > **новый элемент.**

1. В диалоговом окне **Добавить новый элемент,** в центральной панели, выберите **файл C '(.cpp)**. Укажите имя исходного файла, например, *MathLibrary.cpp,* а затем выберите кнопку **«Добавить».** Отобразится пустой исходный файл.

1. Используйте этот исходный файл для `Arithmetic`реализации функциональности для класса. Код должен напоминать:

    ```cpp
    // MathLibrary.cpp
    // compile with: cl /c /EHsc MathLibrary.cpp
    // post-build command: lib MathLibrary.obj

    #include "MathLibrary.h"

    namespace MathLibrary
    {
        double Arithmetic::Add(double a, double b)
        {
            return a + b;
        }

        double Arithmetic::Subtract(double a, double b)
        {
            return a - b;
        }

        double Arithmetic::Multiply(double a, double b)
        {
            return a * b;
        }

        double Arithmetic::Divide(double a, double b)
        {
            return a / b;
        }
    }
    ```

1. Чтобы создать статическую библиотеку, выберите решение **Build** > **Build в** панели меню. Сборка создает статическую *библиотеку, MathLibrary.lib*, которые могут быть использованы другими программами.

   > [!NOTE]
   > При выполнении сборки из командной строки Visual Studio программа собирается в два этапа. Во-первых, запустите `cl /c /EHsc MathLibrary.cpp` для компиляции кода и создания файла объекта, который называется *MathLibrary.obj*. (Команда `cl` вызывает компилятор, Cl.exe, `/c` и опция определяет компиляцию без ссылок. Для получения дополнительной информации [см. /c (Compile Without Linking)](../build/reference/c-compile-without-linking.md).) Во-вторых, запустите, `lib MathLibrary.obj` чтобы связать код и создать статическую библиотеку *MathLibrary.lib*. (Команда `lib` вызывает диспетчер библиотек, Lib.exe. Дополнительные сведения см. в разделе [LIB Reference](../build/reference/lib-reference.md).)

## <a name="create-a-c-console-app-that-references-the-static-library"></a><a name="CreateAppToRefTheLib"></a>Создайте приложение для консоли СЗ, которое ссылается на статическую библиотеку

::: moniker range="vs-2019"

### <a name="to-create-a-c-console-app-that-references-the-static-library-in-visual-studio-2019"></a>Создать приложение для консоли СЗ, которое ссылается на статическую библиотеку в Visual Studio 2019

1. В **Solution Explorer**, правое нажатие на верхний узла, решение **'StaticMath',** чтобы открыть меню ярлыка. Выберите **Добавить** > **новый проект,** чтобы открыть диалоговую коробку **Добавить новый проект.**

1. В верхней части диалога установите фильтр **типа project** на **консоль.**

1. В отфильтрованном списке типов проектов щелкните **Консольное приложение**, а затем нажмите кнопку **Далее**. На следующей странице введите *MathClient* в поле **Name,** чтобы указать имя проекта.

1. Нажмите кнопку **Создать**, чтобы создать клиентский проект.

1. После создания консольного приложения будет создана пустая программа. Имя исходного файла будет совпадать с ранее выбранным именем. В примере он называется `MathClient.cpp`.

::: moniker-end

::: moniker range="vs-2017"

### <a name="to-create-a-c-console-app-that-references-the-static-library-in-visual-studio-2017"></a>Создать приложение для консоли СЗ, которое ссылается на статическую библиотеку в Visual Studio 2017

1. В **Solution Explorer**, правое нажатие на верхний узла, решение **'StaticMath',** чтобы открыть меню ярлыка. Выберите **Добавить** > **новый проект,** чтобы открыть диалоговую коробку **Добавить новый проект.**

1. В диалоговом окне **Добавить новый проект** выберите **установленный** > **визуальный** > **рабочий стол Windows**Desktop. На центральной панели выберите **Мастер классических приложений Windows**.

1. Укажите название проекта, например, *MathClient*— в поле **«Имя».** Выберите кнопку **ОК**.

1. В диалоге **проекта Windows Desktop,** под **типом приложения,** выберите **консольное приложение (.exe).**

1. В **дополнительных опциях**отоверьте **предсборникзанный заголовок,** если оно проверено.

1. Выберите **OK** для создания проекта.

1. После создания консольного приложения будет создана пустая программа. Имя исходного файла будет совпадать с ранее выбранным именем. В примере он называется `MathClient.cpp`.

::: moniker-end

::: moniker range="vs-2015"

### <a name="to-create-a-c-console-app-that-references-the-static-library-in-visual-studio-2015"></a>Создать приложение для консоли СЗ, которое ссылается на статическую библиотеку в Visual Studio 2015

1. В **Solution Explorer**, правое нажатие на верхний узла, решение **'StaticMath',** чтобы открыть меню ярлыка. Выберите **Добавить** > **новый проект,** чтобы открыть диалоговую коробку **Добавить новый проект.**

1. В диалоговом окне **Добавить новый проект** выберите **Установленный** > **визуальный C'** > **Win32**. В центральной области выберите **Консольное приложение Win32**.

1. Укажите название проекта, например, *MathClient*— в поле **«Имя».** Выберите кнопку **ОК**.

1. В диалоге **Win32 Wizard,** выберите **Следующий**.

1. На странице **Настройки приложений,** в **типе приложения,** убедитесь, что **приложение Console** выбрано. Под **дополнительными опциями,** отсеивайте **предварительно собранный заголовок,** затем проверьте **флажок Пустой проект.** Выберите **finish** для создания проекта.

1. Чтобы добавить исходный файл в пустой проект, нажмите правой кнопкой мыши, чтобы открыть меню ярлыка для проекта **MathClient** в **Solution Explorer**, а затем выберите **Добавить** > **новый элемент.**

1. В диалоговом окне **Добавить новый элемент** выберите**визуальный код** **C .** >  В центральной области выберите **Файл C++ (.cpp)**. Укажите имя исходного файла, например, *MathClient.cpp,* а затем выберите кнопку **«Добавить».** Отобразится пустой исходный файл.

::: moniker-end

## <a name="use-the-functionality-from-the-static-library-in-the-app"></a><a name="UseLibInApp"></a>Используйте функциональность из статической библиотеки в приложении

### <a name="to-use-the-functionality-from-the-static-library-in-the-app"></a>Использование функциональности из статической библиотеки в приложении

1. Для использования математических процедур из статической библиотеки необходимо сослаться на эту библиотеку. Откройте меню ярлыка для проекта **MathClient** в **Solution Explorer,** а затем выберите **Добавить** > **справку.**

1. В диалоговом окне **Добавление ссылки** перечислены библиотеки, на которые можно создать ссылку. Вкладка **«Проекты»** перечисляет проекты в текущем решении и любые библиотеки, на которые они ссылаются. Откройте вкладку **«Проекты»,** выберите флажок **MathLibrary,** а затем выберите кнопку **OK.**

1. Чтобы ссылаться на `MathLibrary.h` файл заголовка, необходимо изменить траекторию включенного каталога. В **Solution Explorer**, право езду на **MathClient,** чтобы открыть меню ярлыка. Выберите **Свойства,** чтобы открыть диалоговую коробку **MathClient Property Pages.**

1. В диалоговом окне **Страниц ы свойства MathClient** установите падение **конфигурации** на **все конфигурации.** Установите **падение платформы** на **все платформы.**

1. Выберите страницу свойства **конфигурации** > **C/C'.** > **Общее** свойство. В свойстве **Дополнительных каталогов** указано путь каталога **MathLibrary** или просмотрите его.

   Для просмотра пути каталога:

   1. Откройте дополнительный список значений **свойств,** а затем выберите **Edit.**

   1. В диалоговом окне **дополнительных каталогов** дважды щелкните в верхней части текстового окна. Затем выберите кнопку эллипсис **(...**) в конце строки.

   1. В диалоговом окне **Select Directory** перейдите на уровень, а затем выберите каталог **MathLibrary.** Затем выберите кнопку **Select Folder,** чтобы сохранить выбор.

   1. В поле диалога **Дополнительных каталогов выберите** кнопку **OK.**

   1. В диалоговом окне **Страницы свойств** выберите кнопку **OK,** чтобы сохранить изменения в проекте.

1. Теперь вы `Arithmetic` можете использовать класс в `#include "MathLibrary.h"` этом приложении, включив заголовок в свой код. Замените содержимое `MathClient.cpp` с помощью этого кода:

    ```cpp
    // MathClient.cpp
    // compile with: cl /EHsc MathClient.cpp /link MathLibrary.lib

    #include <iostream>
    #include "MathLibrary.h"

    int main()
    {
        double a = 7.4;
        int b = 99;

        std::cout << "a + b = " <<
            MathLibrary::Arithmetic::Add(a, b) << std::endl;
        std::cout << "a - b = " <<
            MathLibrary::Arithmetic::Subtract(a, b) << std::endl;
        std::cout << "a * b = " <<
            MathLibrary::Arithmetic::Multiply(a, b) << std::endl;
        std::cout << "a / b = " <<
            MathLibrary::Arithmetic::Divide(a, b) << std::endl;

        return 0;
    }
    ```

1. Чтобы создать исполняемое решение, выберите решение **Build** > **Build в** панели меню.

## <a name="run-the-app"></a><a name="RunApp"></a>Выполнить приложение

### <a name="to-run-the-app"></a>Запуск приложения

1. Убедитесь, что **MathClient** выбран в качестве проекта по умолчанию. Чтобы выбрать его, нажмите правой кнопкой мыши, чтобы открыть меню ярлыка для **MathClient** в **Solution Explorer**, а затем выбрать **Установить как StartUp проекта**.

1. Для запуска проекта в панели меню выберите **Debug** > **Start Without Debugging.** Выход должен напоминать:

    ```Output
    a + b = 106.4
    a - b = -91.6
    a * b = 732.6
    a / b = 0.0747475
    ```

## <a name="see-also"></a>См. также раздел

[Прохождение: Создание и использование библиотеки динамических ссылок (СЗ)](../build/walkthrough-creating-and-using-a-dynamic-link-library-cpp.md)<br/>
[Классические приложения (Visual C++)](../windows/desktop-applications-visual-cpp.md)<br/>
