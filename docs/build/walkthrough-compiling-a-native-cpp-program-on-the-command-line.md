---
title: Пошаговое руководство. Компиляция машинной программы на языке C++ из командной строки
description: Используйте компилятор Майкрософт C++ из командной строки.
ms.custom: conceptual
ms.date: 04/23/2019
helpviewer_keywords:
- native code [C++]
- Visual C++, native code
- compiling programs [C++]
- command-line applications [C++], native
ms.assetid: b200cfd1-0440-498f-90ee-7ecf92492dc0
ms.openlocfilehash: daab00768f8140869a8db39c73f4fec3ab6304c7
ms.sourcegitcommit: 458dcc794e3841919c01a3a5ff6b9a3767f8861b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/13/2019
ms.locfileid: "74051515"
---
# <a name="walkthrough-compiling-a-native-c-program-on-the-command-line"></a>Пошаговое руководство. Компиляция машинной программы на языке C++ из командной строки

Visual Studio включает компилятор командной строки C++ , который можно использовать для создания всех элементов из базовых консольных приложений для универсальная платформа Windows приложений, классических приложений, драйверов устройств и компонентов .NET.

В этом пошаговом руководстве вы создадите программу в стиле C++ "обычный", "Привет, мир", используя текстовый редактор, а затем компилируете ее в командной строке. Если вы хотите опробовать интегрированную среду разработки Visual Studio вместо использования командной строки, см. раздел [Пошаговое руководство. Работа с проектамиC++и решениями ()](../ide/walkthrough-working-with-projects-and-solutions-cpp.md) или [Использование интегрированной среды разработки Visual Studio для C++ разработки классических приложений](../ide/using-the-visual-studio-ide-for-cpp-desktop-development.md).

В этом пошаговом руководстве вместо примера программы, приведенного далее, можно использовать собственную программу на Visual C++. Кроме того, можно использовать образец кода на языке Visual C++ из другого раздела справки.

## <a name="prerequisites"></a>Необходимые компоненты

Для выполнения этого пошагового руководства необходимо установить Visual Studio и необязательную **разработку настольных C++ приложений с** рабочей нагрузкой или средства сборки командной строки для Visual Studio.

Visual Studio — это мощная интегрированная среда разработки (IDE), которая поддерживает полнофункциональный редактор, диспетчеры ресурсов, отладчики и компиляторы для многих языков и платформ. Сведения о том, как скачать и установить Visual Studio, включая бесплатный выпуск Visual Studio Community Edition, а также включить поддержку C/C++ Development, см. в разделе [Поддержка установки C++ в Visual Studio](vscpp-step-0-installation.md).

Средства сборки для Visual Studio устанавливают только компиляторы, средства и библиотеки командной строки, необходимые для сборки C и C++ программ. Это идеальный вариант для создания лабораторий и учебных занятий, а установка выполняется относительно быстро. Чтобы установить только программы командной строки, найдите средства сборки для Visual Studio на странице [загрузки Visual Studio](https://visualstudio.microsoft.com/downloads/#build-tools-for-visual-studio-2019) .

Прежде чем можно будет выполнить сборку C C++ или программы в командной строке, необходимо убедиться, что средства установлены и к ним можно получить доступ из командной строки. Визуальный C++ элемент имеет сложные требования к среде командной строки для поиска используемых инструментов, заголовков и библиотек. **C++ Визуальный элемент нельзя использовать в простом окне командной строки** без выполнения какой-либо подготовки. К счастью, C++ визуальные элементы устанавливают ярлыки для запуска командной строки разработчика, для которой настроена среда для сборок с командной строкой. К сожалению, имена ярлыков командной строки разработчика и места их расположения отличаются практически во всех версиях визуальных C++ элементов и в различных версий Windows. Первая задача пошагового руководства — поиск нужной для использования.

> [!NOTE]
> Ярлык командной строки разработчика автоматически задает правильные пути для компилятора и средств, а также для всех необходимых заголовков и библиотек. Эти значения среды необходимо задать самостоятельно, если используется обычный окно **командной строки** . Дополнительные сведения см. в статье [Установка переменных пути и среды при построении из командной строки](setting-the-path-and-environment-variables-for-command-line-builds.md). Рекомендуется использовать ярлык командной строки разработчика вместо создания собственных.

### <a name="open-a-developer-command-prompt"></a>Открытие командной строки разработчика

1. Если вы установили Visual Studio 2017 или более поздней версии в Windows 10, откройте меню Пуск и выберите **все приложения**. Прокрутите вниз и откройте папку **Visual Studio** (не приложение Visual Studio). Выберите **Командная строка разработчика для VS** , чтобы открыть окно командной строки.

   Если вы установили Microsoft Visual C++ Build tools 2015 в Windows 10, откройте меню **Пуск** и выберите **все приложения**. Прокрутите вниз и откройте **папку C++ средства визуальной сборки** . Выберите **Visual C++ 2015 Командная строка Native Tools x86** , чтобы открыть окно командной строки.

   Можно также использовать функцию поиска Windows для поиска "Командная строка разработчика" и выбрать ту, которая соответствует установленной версии Visual Studio. Используйте ярлык, чтобы открыть окно командной строки.

1. Затем убедитесь, что Командная C++ строка Visual Developer настроена правильно. В окне командной строки введите `cl` и убедитесь, что выходные данные выглядят примерно так:

   ```Output
   C:\Program Files (x86)\Microsoft Visual Studio\2017\Enterprise>cl
   Microsoft (R) C/C++ Optimizing Compiler Version 19.10.25017 for x86
   Copyright (C) Microsoft Corporation.  All rights reserved.

   usage: cl [ option... ] filename... [ /link linkoption... ]
   ```

   В зависимости от версии Visual C++ и установленных обновлений могут возникать различия в текущем каталоге или номерах версий. Если приведенный выше результат похож на отображаемый, то можно приступать к сборке C или C++ программ в командной строке.

   > [!NOTE]
   > Если при выполнении команды **CL** выдается сообщение об ошибке "CL" не распознается как внутренняя или внешняя команда, возможно, используется программа или пакетный файл, ошибка C1034 или ошибка LNK1104, то либо вы не используете командную строку разработчика, либо что-то не так с установкой Visual C++. Для продолжения работы необходимо устранить эту проблему.

   Если вы не можете найти ярлык командной строки разработчика или при вводе `cl`появляется сообщение об ошибке, то, возможно, возникла проблема с установкой визуального C++ элемента. Попробуйте переустановить визуальный C++ компонент в Visual Studio или переустановите средства Microsoft Visual C++ Build Tools. Не перейдем к следующему разделу, пока он не будет работать. Дополнительные сведения об установке и устранении неполадок C++визуального элемента см. в [статье Установка Visual Studio](/visualstudio/install/install-visual-studio).

   > [!NOTE]
   > В зависимости от версии Windows на компьютере и конфигурации безопасности системы может потребоваться щелкнуть правой кнопкой мыши, чтобы открыть контекстное меню для ярлыка командной строки разработчика, а затем выбрать **Запуск от имени администратора** , чтобы успешно выполнить сборку и запустить программу, созданную в ходе этого пошагового руководства.

### <a name="create-a-visual-c-source-file-and-compile-it-on-the-command-line"></a>Создание исходного файла C++ с визуальным кодом и его компиляция в командной строке

1. В окне командной строки разработчика введите `md c:\hello`, чтобы создать каталог, а затем введите `cd c:\hello`, чтобы перейти к этому каталогу. В этом каталоге создаются исходный файл и скомпилированная программа.

1. Введите `notepad hello.cpp` в окне командной строки.

   Выберите **Да** , когда Блокнот предложит создать файл. На этом шаге открывается пустое окно блокнота, готовое к вводу кода в файл с именем Hello. cpp.

1. В Блокноте введите следующие строки кода:

   ```cpp
   #include <iostream>
   using namespace std;
   void main()
   {
       cout << "Hello, world, from Visual C++!" << endl;
   }
   ```

   Этот код представляет собой простую программу, которая записывает на экран одну строку текста, а затем выполнит выход. Для сведения числа ошибок к минимуму скопируйте этот код и вставьте его в Блокнот.

1. Сохраните файл. В Блокноте, в меню **Файл** выберите **Сохранить**.

   Поздравляем, вы создали C++ исходный файл Hello. cpp, который готов к компиляции.

1. Вернитесь в окно командной строки разработчика. Введите `dir` в командной строке, чтобы получить список содержимого каталога к:\хелло. Вы увидите исходный файл Hello. cpp в списке каталогов, который выглядит примерно так:

   ```Output
   c:\hello>dir
    Volume in drive C has no label.
    Volume Serial Number is CC62-6545

    Directory of c:\hello

   05/24/2016  05:36 PM    <DIR>          .
   05/24/2016  05:36 PM    <DIR>          ..
   05/24/2016  05:37 PM               115 hello.cpp
                  1 File(s)            115 bytes
                  2 Dir(s)  571,343,446,016 bytes free

   ```

   Даты и другие сведения будут отличаться на вашем компьютере. Если вы не видите файл исходного кода Hello. cpp, убедитесь, что вы изменили созданный вами каталог к:\хелло, и в блокноте сохраните исходный файл в этом каталоге. Также убедитесь, что исходный код сохранен с расширением CPP, а не с расширением txt.

1. В командной строке разработчика введите `cl /EHsc hello.cpp`, чтобы скомпилировать программу.

   Компилятор cl.exe создаст OBJ-файл, содержащий скомпилированный код, а затем запустит компоновщик для создания исполняемой программы с именем hello.exe. Это имя отображается в строках информации, выводимой компилятором. Выходные данные компилятора должны выглядеть примерно так:

   ```Output
   c:\hello>cl /EHsc hello.cpp
   Microsoft (R) C/C++ Optimizing Compiler Version 19.10.25017 for x86
   Copyright (C) Microsoft Corporation.  All rights reserved.

   hello.cpp
   Microsoft (R) Incremental Linker Version 14.10.25017.0
   Copyright (C) Microsoft Corporation.  All rights reserved.

   /out:hello.exe
   hello.obj
   ```

   > [!NOTE]
   > Если появляется сообщение об ошибке "CL" не распознается как внутренняя или внешняя команда, исполняемая программа или пакетный файл, ошибка C1034 или ошибка LNK1104, Командная строка разработчика настроена неправильно. Чтобы получить сведения о том, как устранить эту проблему, вернитесь к разделу **Открытие командной строки разработчика** .

   > [!NOTE]
   > Если вы получаете другое сообщение об ошибке компилятора или компоновщика, просмотрите исходный код, чтобы исправить ошибки, а затем сохраните его и снова запустите компилятор. Для получения сведений о конкретных ошибках используйте поле поиска на этой странице MSDN, чтобы найти номер ошибки.

1. Чтобы запустить программу hello.exe, в командной строке введите `hello`.

   Программа выводит следующий текст и закрывается:

   ```Output
   Hello, world, from Visual C++!
   ```

   Поздравляем, вы выполнили компиляцию и C++ запуск программы с помощью программ командной строки.

## <a name="next-steps"></a>Следующие шаги

Этот пример «Hello, World» состоит в том, что это C++ так же просто, как программа может получить. Реальные программы имеют файлы заголовков и другие исходные файлы, связываются в библиотеках и выполняют полезную работу.

Вы можете использовать шаги, описанные в этом пошаговом C++ руководстве, для создания собственного кода вместо того, чтобы вводить приведенный пример кода. Вы также можете создать множество C++ программных примеров кода, которые можно найти в других местах. Вы можете разместить исходный код и собрать приложения в любой доступный для записи каталог. По умолчанию интегрированная среда разработки Visual Studio создает проекты в папке «документы» в подпапке «проекты» папки Visual Studio с именем для вашей версии Visual Studio.

Чтобы скомпилировать программу с дополнительными файлами исходного кода, введите их в командной строке, например:

`cl /EHsc file1.cpp file2.cpp file3.cpp`

Параметр командной строки `/EHsc` указывает компилятору на необходимость обработки исключений C++. Дополнительные сведения см. в статье [/EH (модель обработки исключений)](reference/eh-exception-handling-model.md).

При указании дополнительных исходных файлов компилятор использует первый входной файл для создания имени программы. В этом случае выводится программа с именем file1. exe. Чтобы изменить имя на PROGRAM1. exe, добавьте параметр компоновщика [/out](reference/out-output-file-name.md) :

`cl /EHsc file1.cpp file2.cpp file3.cpp /link /out:program1.exe`

Чтобы автоматически перехватывать другие ошибки программирования, рекомендуется выполнить компиляцию с помощью параметра уровня предупреждений [/W3](reference/compiler-option-warning-level.md) или [/W4](reference/compiler-option-warning-level.md) :

`cl /W4 /EHsc file1.cpp file2.cpp file3.cpp /link /out:program1.exe`

Компилятор CL. exe содержит множество дополнительных параметров, которые можно применять для создания, оптимизации, отладки и анализа кода. Для быстрого списка введите `cl /?` в командной строке разработчика. Можно также выполнять компиляцию и компоновку отдельно и применять параметры компоновщика в более сложных сценариях сборки. Дополнительные сведения о параметрах компилятора и компоновщика и использовании см. в разделе [Справочник по языкуC++ C/здание](reference/c-cpp-building-reference.md).

Для настройки и создания более сложных проектов в командной строке можно использовать NMAKE и файлы Makefile, а также файл MSBuild и проект. Дополнительные сведения об использовании этих средств см. в разделе [Справочник по NMAKE](reference/nmake-reference.md) и [MSBuild](msbuild-visual-cpp.md).

C и C++ языки похожи, но не совпадают. Компилятор КОМПИЛЯТОРОМ MSVC использует простое правило для определения языка, используемого при компиляции кода. По умолчанию компилятор КОМПИЛЯТОРОМ MSVC обрабатывает все файлы, которые заканчиваются на c как исходный код C, и все файлы, заканчивающиеся на CPP, C++ как исходный код. Чтобы заставить компилятор обрабатывать все файлы как C++ независимые от расширения имени файла, используйте параметр компилятора [/TP](reference/tc-tp-tc-tp-specify-source-file-type.md) .

Компилятор КОМПИЛЯТОРОМ MSVC включает библиотеку времени выполнения C (CRT), совместимую с ISO C99 Standard, но не строго соответствующей требованиям. В большинстве случаев переносимый код будет компилироваться и выполняться должным образом. Визуальный C++ элемент не поддерживает некоторые изменения CRT в ISO C11. Некоторые библиотечные функции и имена функций POSIX не рекомендуются компилятором КОМПИЛЯТОРОМ MSVC. Функции поддерживаются, но предпочтительные имена изменились. Дополнительные сведения см. [в разделе функции безопасности в CRT](../c-runtime-library/security-features-in-the-crt.md) и [Предупреждение компилятора (уровень 3) C4996](../error-messages/compiler-warnings/compiler-warning-level-3-c4996.md).

## <a name="see-also"></a>См. также

[Справочник по языку C++](../cpp/cpp-language-reference.md)<br/>
[Проекты и системы сборки](projects-and-build-systems-cpp.md)<br/>
[Параметры компилятора MSVC](reference/compiler-options.md)
