---
title: Пошаговое руководство. Компиляция собственной программы на языке C++ из командной строки
description: Используйте компилятор Майкрософт C++ из командной строки.
ms.custom: conceptual
ms.date: 04/02/2020
helpviewer_keywords:
- native code [C++]
- Visual C++, native code
- compiling programs [C++]
- command-line applications [C++], native
ms.assetid: b200cfd1-0440-498f-90ee-7ecf92492dc0
ms.openlocfilehash: 8af104598f56aa6c8eb5a9a87905324700da3d37
ms.sourcegitcommit: 31a443c9998cf5cfbaff00fcf815b133f55b2426
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/14/2020
ms.locfileid: "86373675"
---
# <a name="walkthrough-compiling-a-native-c-program-on-the-command-line"></a>Пошаговое руководство. Компиляция собственной программы на языке C++ из командной строки

Visual Studio включает в себя командную строку C и компилятор C++. Его можно использовать для создания всех элементов — от базовых консольных приложений до приложений универсальной платформы Windows, классических приложений, драйверов устройств и компонентов .NET.

В этом пошаговом руководстве приводятся инструкции по созданию программы на языке C++ в стиле "Hello, Wolrd" в текстовом редакторе с последующей компиляцией из командной строки. Если вы хотите попробовать интегрированную среду разработки Visual Studio вместо командной строки, см. статью [Пошаговое руководство. Работа с проектами и решениями (C++)](../ide/walkthrough-working-with-projects-and-solutions-cpp.md) или [Использование интегрированной среды разработки Visual Studio для разработки приложений для настольных систем на языке C++](../ide/using-the-visual-studio-ide-for-cpp-desktop-development.md).

В этом пошаговом руководстве вместо ввода показанного кода можно использовать собственную программу на языке C++. Также можно использовать пример кода C++ из другой статьи справки.

## <a name="prerequisites"></a>Предварительные требования

Для выполнения этого пошагового руководства необходимо установить Visual Studio и дополнительную рабочую нагрузку **Разработка настольных приложений на C++** или Build Tools командной строки для Visual Studio.

Visual Studio — *интегрированная среда разработки* (IDE). Она поддерживает полнофункциональный редактор, диспетчеры ресурсов, отладчики и компиляторы для многих языков и платформ. Доступные версии включают бесплатный выпуск Visual Studio Community Edition, и все они могут поддерживать разработку на C и C++. Сведения о скачивании и установке Visual Studio см. в статье [Установка поддержки C++ в Visual Studio](vscpp-step-0-installation.md).

Build Tools для Visual Studio устанавливают только средства, библиотеки и компиляторы командной строки, необходимые для сборки программ C и C++. Это идеальный вариант для создания заданий и упражнений, а установка выполняется относительно быстро. Чтобы установить только средства командной строки, найдите Build Tools для Visual Studio на странице [загрузки Visual Studio](https://visualstudio.microsoft.com/downloads/#build-tools-for-visual-studio-2019).

Прежде чем можно будет выполнить сборку программ C или C++ в командной строке, убедитесь, что эти средства установлены и к ним можно получить доступ из командной строки. Visual C++ имеет сложные требования к среде командной строки для поиска используемых средств, заголовков и библиотек. **Visual C++ нельзя использовать в простом окне командной строки** без предварительной подготовки. К счастью, Visual C++ устанавливает ярлыки для запуска командной строки разработчика, для которой настроена среда для сборок из командной строки. К сожалению, имена ярлыков командной строки разработчика и места их расположения отличаются практически во всех версиях Visual C++ и в различных версиях Windows. Первая задача пошагового руководства — найти нужную командную строку.

> [!NOTE]
> Ярлык командной строки разработчика автоматически задает правильные пути для компилятора и средств, а также для всех необходимых заголовков и библиотек. Эти значения среды необходимо задавать самостоятельно, если используется обычное окно **командной строки**. Дополнительные сведения см. в статье [Установка переменных пути и среды при построении из командной строки](setting-the-path-and-environment-variables-for-command-line-builds.md). Рекомендуется использовать ярлык командной строки разработчика вместо создания собственного.

### <a name="open-a-developer-command-prompt"></a>Открытие командной строки разработчика

1. Если вы установили Visual Studio 2017 или более поздней версии в Windows 10, откройте меню "Пуск" и выберите **Все приложения**. Прокрутите вниз и откройте папку **Visual Studio** (не приложение Visual Studio). Выберите элемент **Командная строка разработчика для VS**, чтобы открыть окно командной строки.

   Если вы установили Microsoft Visual C++ Build Tools 2015 в Windows 10, откройте меню **Пуск** и выберите **Все приложения**. Прокрутите вниз и откройте папку **Microsoft Visual C++ Build Tools**. Выберите элемент **Командная строка Native Tools x86 Visual C++ 2015**, чтобы открыть окно командной строки.

   Можно также ввести "командная строка разработчика" в строке поиска в Windows и выбрать командную строку, которая соответствует установленной версии Visual Studio. Откройте окно командной строки с помощью ярлыка.

1. Затем убедитесь в том, что командная строка разработчика Visual C++ настроена правильно. В окне командной строки введите `cl` и убедитесь в том, что выходные данные выглядят примерно так:

   ```Output
   C:\Program Files (x86)\Microsoft Visual Studio\2017\Enterprise>cl
   Microsoft (R) C/C++ Optimizing Compiler Version 19.10.25017 for x86
   Copyright (C) Microsoft Corporation.  All rights reserved.

   usage: cl [ option... ] filename... [ /link linkoption... ]
   ```

   Возможно, существуют различия в текущем каталоге или номерах версий. Эти значения зависят от версии Visual C++ и установленных обновлений. Если приведенный выше результат похож на отображаемый, можно приступать к сборке программ C или C++ в командной строке.

   > [!NOTE]
   > Если при выполнении команды **`cl`** появляется сообщение о том, что "cl не распознается как внутренняя или внешняя команда, исполняемая программа или пакетный файл", или возникают ошибки C1034 или LNK1104, дело в том, что вы не используете командную строку разработчика или что-то не так с установкой Visual C++. Для продолжения нужно будет исправить ошибку.

   Если вы не можете найти ярлык командной строки разработчика или при вводе `cl` появляется сообщение об ошибке, возможно, возникла проблема с установкой Visual C++. Попробуйте переустановить компонент Visual C++ в Visual Studio или Microsoft Visual C++ Build Tools. Не переходите к следующему разделу, пока команда **`cl`** не сработает. Дополнительные сведения об установке Visual C++ и устранении неполадок см. в статье [Установка Visual Studio](/visualstudio/install/install-visual-studio).

   > [!NOTE]
   > В зависимости от версии Windows, установленной на компьютере, и конфигурации системы безопасности может потребоваться правой кнопкой мыши открыть контекстное меню для ярлыка командной строки разработчика и выбрать пункт **Запуск от имени администратора**, чтобы успешно выполнить сборку и запуск программы, созданной в этом пошаговом руководстве.

### <a name="create-a-visual-c-source-file-and-compile-it-on-the-command-line"></a>Создание файла исходного кода на языке Visual C++ и его компиляция из командной строки

1. В окне командной строки разработчика введите `md c:\hello`, чтобы создать каталог, а затем введите `cd c:\hello`, чтобы перейти к этому каталогу. В этом каталоге создаются исходный файл и скомпилированная программа.

1. В окне командной строки введите `notepad hello.cpp`.

   Выберите **Да**, когда блокнот предложит создать файл. Откроется пустое окно Блокнота, в котором можно ввести код для файла hello.cpp.

1. В окне блокнота введите следующие строки кода:

   ```cpp
   #include <iostream>
   using namespace std;
   int main()
   {
       cout << "Hello, world, from Visual C++!" << endl;
   }
   ```

   Это простая программа, которая выведет одну строку текста на экран, а затем завершит работу. Для сведения числа ошибок к минимуму скопируйте этот код и вставьте его в Блокнот.

1. Сохраните файл. В Блокноте, в меню **Файл** выберите **Сохранить**.

   Поздравляем, вы создали исходный файл C++ hello.cpp, который готов к компиляции.

1. Вернитесь к окну командной строки разработчика. Введите `dir` в командной строке, чтобы получить список содержимого каталога c:\hello. Вы увидите исходный файл hello.cpp в списке каталогов, который выглядит примерно так:

   ```Output
   c:\hello>dir
    Volume in drive C has no label.
    Volume Serial Number is CC62-6545

    Directory of c:\hello

   05/24/2016  05:36 PM    <DIR>          .
   05/24/2016  05:36 PM    <DIR>          ..
   05/24/2016  05:37 PM               115 hello.cpp
                  1 File(s)            115 bytes
                  2 Dir(s)  571,343,446,016 bytes free

   ```

   Даты и некоторые другие данные будут отличаться на вашем компьютере. Если файл с исходным кодом *hello.cpp* не отображается, убедитесь, что вы перешли в созданный каталог *c:\\hello*. В блокноте убедитесь, что исходный файл сохранен в этом каталоге. Также убедитесь, что исходный код был сохранен с расширением имени файла *`.cpp`* , а не *`.txt`* .

1. В командной строке разработчика введите `cl /EHsc hello.cpp`, чтобы скомпилировать свою программу.

   Компилятор cl.exe создаст OBJ-файл, содержащий скомпилированный код, а затем запустит компоновщик для создания исполняемой программы с именем hello.exe. Это имя отображается в строках информации, выводимой компилятором. Выходные данные компилятора должны выглядеть следующим образом:

   ```Output
   c:\hello>cl /EHsc hello.cpp
   Microsoft (R) C/C++ Optimizing Compiler Version 19.10.25017 for x86
   Copyright (C) Microsoft Corporation.  All rights reserved.

   hello.cpp
   Microsoft (R) Incremental Linker Version 14.10.25017.0
   Copyright (C) Microsoft Corporation.  All rights reserved.

   /out:hello.exe
   hello.obj
   ```

   > [!NOTE]
   > Если вы получаете сообщение об ошибке, например "cl не распознается как внутренняя или внешняя команда, исполняемая программа или пакетный файл", ошибке C1034 или LNK1104, командная строка разработчика настроена неправильно. Чтобы получить сведения о том, как устранить эту проблему, вернитесь к разделу **Открыть командную строку разработчика**.

   > [!NOTE]
   > Если вы получаете другое сообщение об ошибке или предупреждение компилятора или компоновщика, проверьте исходный код, исправьте ошибки, сохраните его и снова запустите компилятор. Для получения сведений о конкретных ошибках введите номер ошибки в поле поиска.

1. Чтобы запустить программу hello.exe, в командной строке введите `hello`.

   Программа выводит следующий текст и закрывается:

   ```Output
   Hello, world, from Visual C++!
   ```

   Поздравляем, вы скомпилировали и запустили программу C++ с помощью средств командной строки.

## <a name="next-steps"></a>Следующие шаги

Этот пример "Hello, World" является самой простой программой C++. Реальные программы обычно имеют файлы заголовков, дополнительные исходные файлы и ссылки на библиотеки.

Вы можете использовать шаги, описанные в этом пошаговом руководстве по C++, для создания собственного кода, чтобы не вводить приведенный пример. Эти шаги также позволяют собрать множество примеров кода C++, которые можно найти в других местах. Вы можете разместить исходный код и собрать приложения в любом доступном для записи каталоге. По умолчанию интегрированная среда разработки Visual Studio создает проекты в папке пользователя во вложенной папке *source\\repos*. Более старые версии могут помещать проекты в папку *Документы\\Visual Studio \<version>\\* Проекты*.

Чтобы скомпилировать программу с дополнительными файлами исходного кода, введите их все в командной строке, например:

`cl /EHsc file1.cpp file2.cpp file3.cpp`

Параметр командной строки `/EHsc` указывает компилятору на необходимость стандартной обработки исключений C++. В противном случае созданные исключения могут привести к неуничтоженным объектам и утечкам ресурсов. Дополнительные сведения см. в статье [/EH (модель обработки исключений)](reference/eh-exception-handling-model.md).

При указании дополнительных исходных файлов компилятор использует первый входной файл для создания имени программы. В этом случае выводится программа с именем file1.exe. Чтобы изменить имя на program1.exe, добавьте параметр компоновщика [/out](reference/out-output-file-name.md):

`cl /EHsc file1.cpp file2.cpp file3.cpp /link /out:program1.exe`

Чтобы автоматически перехватывать другие ошибки программирования, рекомендуется выполнить компиляцию с помощью порога предупреждений [/W3](reference/compiler-option-warning-level.md) или [/W4](reference/compiler-option-warning-level.md):

`cl /W4 /EHsc file1.cpp file2.cpp file3.cpp /link /out:program1.exe`

В компиляторе cl.exe есть множество дополнительных параметров. Их можно применять для создания, оптимизации, отладки и анализа кода. Чтобы просмотреть краткий список, введите `cl /?` в командной строке разработчика. Можно также выполнять компиляцию и компоновку отдельно и применять параметры компоновщика в более сложных сценариях сборки. Дополнительные сведения о параметрах и использовании компилятора и компоновщика см. в [справочнике по сборке для C/C++](reference/c-cpp-building-reference.md).

Для настройки и создания более сложных проектов в командной строке можно использовать NMAKE и файлы makefile, MSBuild и файл проекта или CMake. Дополнительные сведения об использовании этих средств см. в разделах [Справочник по NMAKE](reference/nmake-reference.md), [MSBuild](msbuild-visual-cpp.md) и [Проекты CMake в Visual Studio](cmake-projects-in-visual-studio.md).

Языки C и C++ похожи, но имеют различия. Компилятор MSVC использует простое правило для определения языка, используемого при компиляции кода. По умолчанию компилятор MSVC рассматривает файлы с расширением *`.c`* как исходные файлы на языке С, а файлы с расширением *`.cpp`*  — как исходные файлы на языке С++. Если указан параметр компилятора [/TP](reference/tc-tp-tc-tp-specify-source-file-type.md), компилятор будет рассматривать все файлы как исходные файлы на языке С++ вне зависимости от расширения.

Компилятор MSVC содержит библиотеку времени выполнения C (CRT), которая соответствует стандарту ISO C99 с небольшими исключениями. Переносимый код обычно компилируется и выполняется, как ожидалось. Некоторые устаревшие функции библиотеки и несколько имен функций POSIX не рекомендуется использовать в компиляторе MSVC. Функции поддерживаются, но предпочтительные имена изменились. Дополнительные сведения см. в статьях [Функции безопасности в CRT](../c-runtime-library/security-features-in-the-crt.md) и [Предупреждение компилятора (уровень 3) C4996](../error-messages/compiler-warnings/compiler-warning-level-3-c4996.md).

## <a name="see-also"></a>См. также

[Справочник по языку C++](../cpp/cpp-language-reference.md)<br/>
[Проекты и системы сборки](projects-and-build-systems-cpp.md)<br/>
[Параметры компилятора MSVC](reference/compiler-options.md)
