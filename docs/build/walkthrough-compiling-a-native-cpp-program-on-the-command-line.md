---
title: Пошаговое руководство. Компиляция машинной программы на языке C++ из командной строки
description: Используйте компилятор Microsoft C's из командного запроса.
ms.custom: conceptual
ms.date: 04/02/2020
helpviewer_keywords:
- native code [C++]
- Visual C++, native code
- compiling programs [C++]
- command-line applications [C++], native
ms.assetid: b200cfd1-0440-498f-90ee-7ecf92492dc0
ms.openlocfilehash: c24fdfdaef612059d5c2fbaaa58f10d83f5fe3a8
ms.sourcegitcommit: c123cc76bb2b6c5cde6f4c425ece420ac733bf70
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81335234"
---
# <a name="walkthrough-compiling-a-native-c-program-on-the-command-line"></a>Пошаговое руководство. Компиляция машинной программы на языке C++ из командной строки

Visual Studio включает в себя компилятор командной строки C и C. Вы можете использовать его для создания всего, от базовых консольных приложений до универсальных приложений платформы Windows, настольных приложений, драйверов устройств и компонентов .NET.

В этом пошаговом шаге вы создаете основную программу в стиле «Здравствуйте, мир» с помощью текстового редактора, а затем компилируете ее в командной строке. Если вы хотите попробовать Visual Studio IDE вместо того, чтобы использовать командную строку, [Using the Visual Studio IDE for C++ Desktop Development](../ide/using-the-visual-studio-ide-for-cpp-desktop-development.md)см. [Walkthrough: Working with Projects and Solutions (C++)](../ide/walkthrough-working-with-projects-and-solutions-cpp.md)

В этом пошаговом шаге вы можете использовать свою собственную программу C'е вместо того, чтобы печатать на показе. Или вы можете использовать образец кода СЗ из другой статьи справки.

## <a name="prerequisites"></a>Предварительные требования

Для завершения этого пошагового обхода необходимо установить либо Visual Studio, либо дополнительную разработку Desktop с рабочей нагрузкой **на C-образную,** либо командную строку Build Tools для Visual Studio.

Visual Studio – это *интегрированная среда разработки* (IDE). Он поддерживает полнофункциональный редактор, менеджеров ресурсов, отладчиков и компиляторов для многих языков и платформ. Доступные версии включают в себя бесплатное издание Visual Studio Community, и все они могут поддерживать разработку C и C. Для получения информации о том, как скачать и установить Visual Studio, [см.](vscpp-step-0-installation.md)

Инструменты сборки для визуальной студии устанавливают только компиляторы, инструменты и библиотеки командной строки, необходимые для создания программ C и C. Он идеально подходит для создания лабораторий или классных упражнений и устанавливает сявок относительно быстро. Чтобы установить только инструменты командной строки, ищите build Tools для визуальной студии на странице [Visual Studio Downloads.](https://visualstudio.microsoft.com/downloads/#build-tools-for-visual-studio-2019)

Прежде чем вы сможете построить программу C или C' на командной строке, убедитесь, что инструменты установлены, и вы можете получить к ним доступ с командной строки. Визуальный КЗ имеет сложные требования к среде командной строки, чтобы найти инструменты, заголовки и библиотеки, которые она использует. **Вы не можете использовать Visual C ' в простом командном быстром окне,** не делая некоторую подготовку. К счастью, Visual C's устанавливает ярлыки для запуска запроса команды разработчика, который настроен на среду для сборки командной строки. К сожалению, имена командных запросов разработчика и места их расположения отличаются практически в каждой версии Visual C и в разных версиях Windows. Ваша первая пошаговая задача заключается в поиске правильного для использования.

> [!NOTE]
> Быстрый ярлык команды разработчика автоматически устанавливает правильные пути для компилятора и инструментов, а также для любых необходимых заголовков и библиотек. Вы должны установить эти значения среды самостоятельно, если вы используете обычное окно **Командно-оперативную.** Дополнительные сведения см. в статье [Установка переменных пути и среды при построении из командной строки](setting-the-path-and-environment-variables-for-command-line-builds.md). Мы рекомендуем использовать быстрое сокращение команды разработчика вместо создания собственного.

### <a name="open-a-developer-command-prompt"></a>Откройте запрос команды разработчика

1. Если вы установили Visual Studio 2017 или позже на Windows 10, откройте меню «Пуск» и выберите **все приложения.** Прокрутите вниз и откройте папку **Visual Studio** (не приложение Visual Studio). Выберите **командный запрос разработчика для VS,** чтобы открыть окно запроса команды.

   Если вы установили на Windows 10 инструменты сборки Microsoft Visual C'S 2015, откройте меню **«Пуск»** и выберите **все приложения.** Прокрутите вниз и откройте папку **Visual C' Build Tools.** Выберите **команду Visual C'2015 x86 Native Tools Command Prompt,** чтобы открыть окно оперативного управления.

   Вы также можете использовать функцию поиска Windows для поиска "запрос команды разработчика" и выбрать тот, который соответствует установленной версии Visual Studio. Используйте ярлык, чтобы открыть окно запроса команды.

1. Затем убедитесь, что запрос команды разработчика Visual C'' настроен правильно. В окне запроса `cl` команды введите и убедитесь, что выход выглядит примерно так:

   ```Output
   C:\Program Files (x86)\Microsoft Visual Studio\2017\Enterprise>cl
   Microsoft (R) C/C++ Optimizing Compiler Version 19.10.25017 for x86
   Copyright (C) Microsoft Corporation.  All rights reserved.

   usage: cl [ option... ] filename... [ /link linkoption... ]
   ```

   В текущем каталоге или номерах версий могут быть различия. Эти значения зависят от версии Visual C и любых установленных обновлений. Если вышеуказанный выход аналогичен тому, что вы видите, то вы готовы построить программы C или C's в командной строке.

   > [!NOTE]
   > Если вы получаете ошибку, такую как "'cl' не признается как внутренняя или внешняя команда, оперативная программа или пакетный файл", ошибка C1034 или ошибка LNK1104 при запуске **`cl`** команды, то либо вы не используете запрос команды разработчика, либо что-то не так с установкой Visual C . Вы должны исправить эту проблему, прежде чем вы сможете продолжить.

   Если вы не можете найти быстрое сокращение команды разработчика, или `cl`если вы получаете сообщение об ошибке при вводе, то ваша установка Visual C'' может возникнуть проблема. Попробуйте переустановить компонент Visual C' в Visual Studio или переустановите инструменты сборки Microsoft Visual C. Не перейдите к следующему разделу, пока **`cl`** команда не заработает. Для получения более подробной информации об установке и устранении неполадок Visual C, [см.](/visualstudio/install/install-visual-studio)

   > [!NOTE]
   > В зависимости от версии Windows на компьютере и конфигурации безопасности системы, возможно, вам придется нажать правой кнопкой, чтобы открыть меню быстрого поиска команды разработчика, а затем выбрать Run в **качестве администратора,** чтобы успешно построить и запустить программу, которую вы создаете, следуя этому пошаговому шагу.

### <a name="create-a-visual-c-source-file-and-compile-it-on-the-command-line"></a>Создайте исходный файл Visual C и компилируйте его на командной строке

1. В окне запроса `md c:\hello` команды разработчика введите `cd c:\hello` для создания каталога, а затем введите для изменения в этот каталог. В этом каталоге создается исходный файл и компилированная программа.

1. Введите `notepad hello.cpp` окно запроса команды.

   Выберите **Да,** когда Notepad подсказывает вам создать файл. Этот шаг открывает пустое окно Блокнота, готовое для ввода кода в файле hello.cpp.

1. В Notepad введите следующие строки кода:

   ```cpp
   #include <iostream>
   using namespace std;
   int main()
   {
       cout << "Hello, world, from Visual C++!" << endl;
   }
   ```

   Этот код представляет собой простую программу, которая будет писать одну строку текста на экране, а затем выйти. Для сведения числа ошибок к минимуму скопируйте этот код и вставьте его в Блокнот.

1. Сохраните файл. В Блокноте, в меню **Файл** выберите **Сохранить**.

   Поздравляем, вы создали исходный файл СЗ, hello.cpp, который готов к компиляции.

1. Переключиться обратно в окно запроса команды разработчика. Введите `dir` в команде запрос, чтобы перечислить содержимое каталога c: «привет. Вы должны увидеть исходный файл hello.cpp в каталоге список, который выглядит что-то вроде:

   ```Output
   c:\hello>dir
    Volume in drive C has no label.
    Volume Serial Number is CC62-6545

    Directory of c:\hello

   05/24/2016  05:36 PM    <DIR>          .
   05/24/2016  05:36 PM    <DIR>          ..
   05/24/2016  05:37 PM               115 hello.cpp
                  1 File(s)            115 bytes
                  2 Dir(s)  571,343,446,016 bytes free

   ```

   Даты и другие детали будут отличаться на вашем компьютере. Если вы не видите файл исходного кода, *hello.cpp,* убедитесь, что вы изменили на *\\c: hello* каталог, который вы создали. В Notepad убедитесь, что вы сохранили исходный файл в этом каталоге. Также убедитесь, что вы сохранили исходный код с расширением *`.cpp`* имени файла, а не расширение. *`.txt`*

1. В запросе команды `cl /EHsc hello.cpp` разработчика введите для компиляции программы.

   Компилятор cl.exe создаст OBJ-файл, содержащий скомпилированный код, а затем запустит компоновщик для создания исполняемой программы с именем hello.exe. Это имя отображается в строках информации, выводимой компилятором. Выход компилятора должен выглядеть примерно так:

   ```Output
   c:\hello>cl /EHsc hello.cpp
   Microsoft (R) C/C++ Optimizing Compiler Version 19.10.25017 for x86
   Copyright (C) Microsoft Corporation.  All rights reserved.

   hello.cpp
   Microsoft (R) Incremental Linker Version 14.10.25017.0
   Copyright (C) Microsoft Corporation.  All rights reserved.

   /out:hello.exe
   hello.obj
   ```

   > [!NOTE]
   > Если вы получаете ошибку, такую как "'cl' не признается как внутренняя или внешняя команда, оперативная программа или пакетный файл", ошибка C1034 или ошибка LNK1104, ваш запрос команды разработчика настроен неправильно. Для получения информации о том, как устранить эту проблему, вернитесь в раздел **запроса команды Open.**

   > [!NOTE]
   > Если вы получаете другой компилятор или ошибку или предупреждение, просмотрите исходный код, чтобы исправить любые ошибки, а затем сохраните его и запустите компилятор снова. Для получения информации о конкретных ошибках используйте поле поиска на этой странице MSDN для поиска номера ошибки.

1. Чтобы запустить программу hello.exe, в командной строке введите `hello`.

   Программа выводит следующий текст и закрывается:

   ```Output
   Hello, world, from Visual C++!
   ```

   Поздравляем, вы составили и запустите программу СЗ с помощью инструментов командной строки.

## <a name="next-steps"></a>Дальнейшие действия

Этот пример «Здравствуйте, мир» примерно так же прост, как и программа СЗЗ. В реальных программах обычно есть файлы заголовка, больше исходных файлов и ссылка на библиотеки.

Вы можете использовать шаги в этом пошаговом шаге, чтобы создать свой собственный код C' вместо ввода показанного образца кода. Эти шаги также позволяют создавать много программ, которые вы найдете в других местах. Вы можете поместить исходный код и создать приложения в любом каталоге, который можно записывать. По умолчанию Visual Studio IDE создает проекты в папке пользователя в подфедере *репо исходного\\кода.* Более старые версии могут поместить проекты в *версию Documents\\Visual Studio \<>\\ *папку Projects.

Чтобы собрать программу с дополнительными файлами исходного кода, введите их все на командной строке, например:

`cl /EHsc file1.cpp file2.cpp file3.cpp`

Опция `/EHsc` командной строки инструктирует компилятор для включения стандартного поведения обработки исключений сот. Без него брошенные исключения могут привести к неуничтоженным объектам и утечке ресурсов. Дополнительные сведения см. в статье [/EH (модель обработки исключений)](reference/eh-exception-handling-model.md).

При поставке дополнительных исходных файлов компилятор использует первый файл ввода для создания имени программы. В этом случае он выводит программу под названием file1.exe. Чтобы изменить имя на programme1.exe, добавьте опцию [/out](reference/out-output-file-name.md) linker:

`cl /EHsc file1.cpp file2.cpp file3.cpp /link /out:program1.exe`

И чтобы поймать больше ошибок программирования автоматически, мы рекомендуем вам компилировать с помощью [либо /W3](reference/compiler-option-warning-level.md) или [/W4](reference/compiler-option-warning-level.md) предупреждение уровня вариант:

`cl /W4 /EHsc file1.cpp file2.cpp file3.cpp /link /out:program1.exe`

Компилятор, cl.exe, имеет гораздо больше вариантов. Их можно применить для создания, оптимизации, отладки и анализа кода. Для получения быстрого `cl /?` списка введите запрос команды разработчика. Вы также можете компилировать и связывать отдельно и применять параметры связующим звена в более сложных сценариях сборки. Для получения более подробной информации о компиляторе и вариантах ссылки и использовании, [см.](reference/c-cpp-building-reference.md)

Вы можете использовать NMAKE и makefiles, MSBuild и файлы проекта, или CMake, для настройки и создания более сложных проектов на командной строке. Для получения дополнительной информации об использовании этих инструментов, [см. NMAKE Справочник](reference/nmake-reference.md), [MSBuild](msbuild-visual-cpp.md), и [CMake проектов в Visual Studio](cmake-projects-in-visual-studio.md).

Языки С и СЗ схожи, но не одинаковы. Компилятор MSVC использует простое правило для определения языка для компиляции кода. По умолчанию компилятор MSVC рассматривает *`.c`* файлы, которые заканчиваются *`.cpp`* как исходный код C, и файлы, которые заканчиваются как исходный код C. Чтобы заставить компилятор рассматривать все файлы как C', не зависяотные от расширения имени файла, используйте опцию компилятора [/TP.](reference/tc-tp-tc-tp-specify-source-file-type.md)

Компилятор MSVC включает библиотеку C Runtime Library (CRT), которая соответствует стандарту ISO C99, за незначительными исключениями. Портативный код обычно компилируется и выполняется, как и ожидалось. Некоторые устаревшие функции библиотеки и несколько названий функций POSIX унижаются компилятором MSVC. Функции поддерживаются, но предпочтительные имена изменились. Для получения дополнительной информации [см. Функции безопасности в CRT](../c-runtime-library/security-features-in-the-crt.md) и [Компилятор Предупреждение (уровень 3) C4996](../error-messages/compiler-warnings/compiler-warning-level-3-c4996.md).

## <a name="see-also"></a>См. также раздел

[Языковая справка к СЗ](../cpp/cpp-language-reference.md)<br/>
[Проекты и системы сборки](projects-and-build-systems-cpp.md)<br/>
[Параметры компилятора MSVC](reference/compiler-options.md)
