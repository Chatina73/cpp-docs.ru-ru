---
title: Учебник. Отладка проекта CMake на удаленном компьютере Windows
ms.date: 12/4/2020
ms.topic: tutorial
description: Использование Visual Studio C++ в Windows для создания и сборки проекта CMake. Его развертывания и отладка на удаленном компьютере Windows.
ms.openlocfilehash: 742ee831fc30ffe291d68ff97ad4238e57c7e21d
ms.sourcegitcommit: 3d9cfde85df33002e3b3d7f3509ff6a8dc4c0a21
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/21/2021
ms.locfileid: "98668860"
---
# <a name="tutorial-debug-a-cmake-project-on-a-remote-windows-machine"></a>Учебник. Отладка проекта CMake на удаленном компьютере Windows

В этом руководстве используется Visual Studio C++ в Windows для создания и построения проекта CMake, который можно развернуть и отладить на удаленном компьютере Windows. Это руководство относится только к Windows ARM64, однако описываемые в нем действия можно обобщить для других архитектур.

Процесс отладки по умолчанию для ARM64 в Visual Studio — это удаленная отладка компьютера Windows ARM64. Если вы попытаетесь выполнить отладку проекта CMake ARM64 без настройки параметров отладки в соответствии с этим руководством, то вы получите сообщение об ошибке: "Visual Studio не удается найти удаленный компьютер".

Из этого руководства вы узнаете, как выполнять следующие задачи:

> [!div class="checklist"]
>
> * создание проекта CMake;
> * настройка проекта CMake для сборки для ARM64;
> * настройка проекта CMake для запуска на удаленном компьютере Windows ARM64;
> * отладка проекта CMake, выполняющегося на удаленном компьютере Windows ARM64.

## <a name="prerequisites"></a>Предварительные требования

### <a name="on-the-host-machine"></a>На хост-компьютере

Для настройки Visual Studio для кроссплатформенной разработки C++ следует установить средства сборки для целевой архитектуры. В рамках этого руководства установите средства сборки ARM64, выполнив указанные ниже действия.

1. Запустите установщик Visual Studio. [Установите Visual Studio](https://docs.microsoft.com/visualstudio/install/install-visual-studio#:~:text=Install%20Visual%20Studio%201%20Make%20sure%20your%20computer,...%204%20Choose%20workloads.%20...%20More%20items...%20), если вы еще не сделали этого.
1. На начальном экране установщика Visual Studio Installer нажмите **Изменить**.
1. В верхней части выберите **Отдельные компоненты**.
1. Прокрутите вниз до раздела **Компиляторы, средства сборки и среды выполнения**.
1. Убедитесь, что выбраны следующие компоненты:
    - **Средства CMake C++ для Windows**
    - **Средства сборки MSVC версии 142 - VS 2019 C++ ARM64 (актуальная версия)** Важно выбрать средства сборки `ARM64`, а не средства сборки `ARM` (обратите внимание на 64), а также убедиться, что выбрана версия `VS 2019`.
1. Выберите **Изменить**, чтобы установить средства.

### <a name="on-the-remote-machine"></a>На удаленном компьютере

1. Установите средства на удаленном компьютере. Для работы с этим руководством установите средства ARM64, следуя инструкциям в разделе [Скачивание и установка инструментов удаленной отладки](https://docs.microsoft.com/visualstudio/debugger/remote-debugging-cpp?%23download-and-install-the-remote-tools#download-and-install-the-remote-tools).
1. Запустите и настройте удаленный отладчик на удаленном компьютере. Для работы с этим руководством следуйте указаниям, приведенным в разделе [настройки удаленного отладчика](https://docs.microsoft.com/visualstudio/debugger/remote-debugging-cpp?%23download-and-install-the-remote-tools#BKMK_setup) на удаленном компьютере Windows.

## <a name="create-a-cmake-project"></a>Создание проекта CMake

На хост-компьютере Windows:
1. Запустите Visual Studio.
1. В главном меню выберите **Файл** > **Создать** > **Проект**.
1. Выберите **Проект CMake** > **Далее**.
1. Присвойте проекту имя и выберите расположение. Щелкните **Создать**.

Дайте Visual Studio несколько секунд, чтобы создать проект и заполнить **обозреватель решений**.

## <a name="configure-for-arm64"></a>Настройка для ARM64

Чтобы настроить проект для компьютера Windows ARM64, необходимо выполнить сборку с помощью средств сборки ARM64.

В Visual Studio в раскрывающемся меню **Конфигурация** выберите **Управление конфигурациями**.

![Выбор пункта "Управление конфигурациями" в раскрывающемся списке конфигураций в Visual Studio.](media/vs2019-cmake-manage-configurations.png)

Добавьте новую конфигурацию, выбрав **Добавить новую конфигурацию** (зеленая кнопка **+** ).
В появившемся диалоговом окне **CMakeSettings** выберите **arm64-Debug**, а затем нажмите **Выбрать**.

![Добавление конфигурации arm64-debug](media/cmake-add-config-icon-with-target-dialog.png)

В файл *`CmakeSettings.json`* будет добавлена конфигурация отладки с именем **arm64-Debug**. Это имя конфигурации представляет собой уникальное понятное имя, которое упрощает поиск этих параметров в раскрывающемся списке **Конфигурация**.

В раскрывающемся списке **Набор инструментов** будет выбрано значение **msvc_arm64_x64**. Настройки должны выглядеть так:

![Диалоговое окно настроек CMake](media/cmake-settings-editor2.png)

> [!Note]
> При выборе в раскрывающемся списке **Набор инструментов** параметра **msvc_arm64** выбираются 32-разрядные средства узла для перекрестной компиляции в ARM64, а при выборе параметра **msvc_arm64 x64** — 64-разрядные средства узла для перекрестной компиляции в ARM64, чем вы и будете заниматься в этом руководстве.

Сохраните файл `CMakeSettings.json`. В раскрывающемся списке "Конфигурация" выберите **arm64-Debug** (отображение файла `CMakeSettings.json` в списке может занять некоторое время после сохранения):

![Убедитесь, что в раскрывающемся списке конфигураций в Visual Studio выбран параметр arm64-Debug.](media/vs2019-cmake-manage-configurations-arm.png) 

## <a name="add-a-debug-configuration-file"></a>Добавление файла конфигурации отладки

Затем добавьте сведения о конфигурации, которые сообщают Visual Studio, где найти удаленный компьютер, а также другие сведения о конфигурации.

Измените представление **Обозреватель решений** для отображения конечных объектов, выбрав **Переключить представления**.

![Кнопка переключения представлений в обозревателе решений](media/solution-explorer-switch-view.png)

Затем в **обозревателе решений** дважды щелкните **Представление целевых объектов CMake**, чтобы увидеть проект.

Откройте папку проекта (в этом примере — **Проект CMakeProject3**), а затем щелкните исполняемый файл правой кнопкой мыши и выберите **Добавить конфигурацию отладки**.

![Выбор параметра "Добавить конфигурацию отладки"](media/cmake-targets-add-debug-configuration.png)

В проекте будет создан файл `launch.vs.json`. Откройте его и измените следующие записи, чтобы включить удаленную отладку:

- `projectTarget`: устанавливается в случае, если вы добавили файл конфигурации отладки из представления целевых объектов в **обозревателе решений** в соответствии с инструкциями выше.
- `remoteMachineName`: укажите IP-адрес удаленного компьютера ARM64 или его имя компьютера.

Дополнительные сведения о настройках `launch.vs.json` см. в разделе [Справочник по схеме Launch.vs.json](launch-vs-schema-reference-cpp.md).

> [!Note]
>  Если в **обозревателе решений** вы используете представление папок вместо представления целевых объектов, щелкните правой кнопкой мыши файл `CMakeLists.txt` и выберите **Добавить конфигурацию отладки**. Этот процесс отличается от добавления конфигурации отладки из представления целевых объектов следующим:
> - Вам будет предложено выбрать отладчик (выберите  **Удаленная отладка Windows C/C++** ).
> - Visual Studio предоставит меньше сведений о шаблоне конфигурации в файле `launch.vs.json`, поэтому вам потребуется добавить его самостоятельно. Необходимо указать записи `remoteMachineName` и `projectTarget`. При добавлении конфигурации из представления целевых объектов необходимо указать только `remoteMachineName`.
> - Для значения параметра `projectTarget` проверьте раскрывающийся список элементов автозагрузки, чтобы получить уникальное имя целевого объекта, например, в этом учебнике это "CMakeProject3.exe".

## <a name="start-the-remote-debugger-monitor-on-the-remote-windows-machine"></a>Запуск монитора удаленного отладчика на удаленном компьютере Windows

Перед запуском проекта CMake убедитесь, что на удаленном компьютере Windows запущен удаленный отладчик Visual Studio 2019.  В зависимости от проверки подлинности может потребоваться изменить параметры удаленного отладчика.

Например, на удаленном компьютере в строке меню удаленного отладчика Visual Studio выберите **Сервис** > **Параметры**. Задайте **режим проверки подлинности** в соответствии с настройками среды.

![Параметры проверки подлинности удаленного отладчика](media/remote-debugger-options.png)

Затем в Visual Studio на хост-компьютере обновите файл `launch.vs.json` соответствующим образом. Например, если в удаленном отладчике выбрать **Без проверки подлинности**, обновите файл `launch.vs.json` в проекте, добавив **"authenticationType": "none"** в раздел `configurations` `launch.vs.json`. В противном случае `"authenticationType"` по умолчанию имеет значение `"windows"` и его не нужно указывать явно. В этом примере показан файл `launch.vs.json`, настроенный для без проверки подлинности:

``` XAML
{
  "version": "0.2.1",
  "defaults": {},
  "configurations": [
    {
        "type": "remoteWindows",
        "authenticationType": "none"
        "name": "CMakeLists.txt",
        "project": "CMakeLists.txt",
        "projectTarget": "CMakeProject3.exe",
        "remoteMachineName": "<ip address goes here>",
        "cwd": "${debugInfo.defaultWorkingDirectory}",
        "program": "${debugInfo.fullTargetPath}",
        "deploy": [],
        "args": [],
        "env": {}
    },
    {
      "type": "default",
      "project": "CMakeLists.txt",
      "projectTarget": "CMakeProject3.exe",
      "name": "CMakeProject3.exe"
    }
  ]
}
```

## <a name="debug-the-app"></a>Отладка приложения

На хост-компьютере в **обозревателе решений** в Visual Studio откройте файл CPP для проекта CMake. Если вы все еще находитесь в **представлении целевых объектов CMake**, необходимо открыть узел **(исполняемый файл)** , чтобы увидеть его.

Файл CPP по умолчанию — это простое консольное приложение Hello World. Задайте точку останова в `return 0;`.

На панели инструментов Visual Studio используйте раскрывающийся список **Элемент автозагрузки**, чтобы выбрать имя, указанное для `"name"` в файле `launch.vs.json`:

![Пример раскрывающегося списка элементов автозапуска с выбранным файлом CMakeProject3.exe](media/startup-item.png)

Чтобы начать отладку, на панели инструментов Visual Studio выберите **Отладка** > **Начать отладку** (или нажмите клавишу **F5**).

Если отладка не запускается, убедитесь, что в файле `launch.vs.json` правильно заданы следующие значения:
- В качестве значения параметра `"remoteMachineName"` следует задать IP-адрес удаленного компьютера Windows ARM64 или его имя компьютера.
- Значение параметра `"name"` должно соответствовать выбору в раскрывающемся списке элементов автозагрузки Visual Studio.
- Значение `"projectTarget"` должно соответствовать имени целевого объекта CMake, который необходимо отладить.
- переменная `"type"` должна иметь значение `"remoteWindows"`;
- Если для типа проверки подлинности в удаленном отладчике установлено значение **Без проверки подлинности**, в файле `launch.vs.json` должен быть задан параметр `"authenticationType": "none"`.
- При использовании проверки подлинности Windows войдите в систему, используя учетную запись, распознанную удаленным компьютером.

После сборки проекта приложение должно отобразиться на удаленном компьютере Windows ARM64:

![Приложение командной строки Hello CMake, работающее на удаленном компьютере Windows ARM64](media/remote-cmake-app.png)

Visual Studio на хост-компьютере следует остановить в точке останова `return 0;`.

## <a name="what-you-learned"></a>Чему вы научились

В этом руководстве вы создали проект CMake, настроили его для создания Windows на ARM64 и выполнили его отладку на удаленном компьютере Windows ARM64.

## <a name="next-steps"></a>Следующие шаги

Дополнительные сведения о настройке и отладке проектов CMake в Visual Studio:

> [!div class="nextstepaction"]
> [Проекты CMake в Visual Studio](cmake-projects-in-visual-studio.md)\
> [Настройка параметров сборки CMake](customize-cmake-settings.md)\
> [Настройка сеансов отладки CMake](configure-cmake-debugging-sessions.md)\
> [Справочник по предопределенной конфигурации CMake](cmake-predefined-configuration-reference.md)\
[Справочник по схеме launch.vs.json](launch-vs-schema-reference-cpp.md)
