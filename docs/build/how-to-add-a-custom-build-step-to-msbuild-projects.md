---
title: Практическое руководство. Добавление пользовательского шага построения в проекты MSBuild
ms.date: 10/16/2019
helpviewer_keywords:
- 'msbuild (c++), howto: add a custom build step'
ms.assetid: a20a0c47-4df4-4754-a1f0-a94a99958916
ms.openlocfilehash: 78d40a5b4a02fe9b065bbbdde33afc6180d75381
ms.sourcegitcommit: 9aab425662a66825772f091112986952f341f7c8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/16/2019
ms.locfileid: "72444920"
---
# <a name="how-to-add-a-custom-build-step-to-msbuild-projects"></a>Практическое руководство. Добавление пользовательского шага построения в проекты MSBuild

Настраиваемый этап сборки — это определяемый пользователем шаг в сборке. Настраиваемый этап сборки ведет себя так же, как и любой другой шаг *программы командной строки* , такой как стандартный шаг инструмента компиляции или компоновки.

Укажите настраиваемый шаг сборки в файле проекта (VCXPROJ). На этом шаге можно указать командную строку для выполнения, дополнительные входные или выходные файлы, а также отображаемое сообщение. Если **MSBuild** определяет, что выходные файлы устарели по отношению к входным файлам, он отображает сообщение и выполняет команду.

Чтобы указать расположение настраиваемого этапа сборки в последовательности целевых объектов сборки, используйте один или оба элемента XML `CustomBuildAfterTargets` и `CustomBuildBeforeTargets` в файле проекта. Например, можно указать, что настраиваемый этап сборки выполняется после целевого объекта инструмента Link и перед целевым объектом средства манифеста. Фактический набор доступных целевых объектов зависит от конкретной сборки.

Укажите элемент `CustomBuildBeforeTargets` для выполнения настраиваемого этапа сборки перед выполнением определенного целевого объекта, `CustomBuildAfterTargets`, чтобы выполнить шаг после выполнения определенного целевого объекта, или оба элемента для выполнения шага между двумя смежными целевыми объектами. Если ни один из элементов не указан, настраиваемое средство сборки выполняется в расположении по умолчанию, которое находится после целевого объекта **ссылки** .

Настраиваемые шаги сборки и настраиваемые средства сборки совместно используют сведения, указанные в элементах XML `CustomBuildBeforeTargets` и `CustomBuildAfterTargets`. Поэтому следует указать эти целевые объекты только один раз в файле проекта.

### <a name="to-define-what-is-executed-by-the-custom-build-step"></a>Определение действий, выполняемых настраиваемым этапом сборки

1. Добавьте группу свойств в файл проекта. В этой группе свойств укажите команду, ее входные и выходные данные, а также сообщение, как показано в следующем примере. В этом примере создается CAB-файл из файла main. cpp, созданного в [разделе Пошаговое руководство. Создание C++ проекта с помощью MSBuild](walkthrough-using-msbuild-to-create-a-visual-cpp-project.md).

    ```
    <ItemDefinitionGroup>
      <CustomBuildStep>
        <Command>makecab.exe $(ProjectDir)main.cpp $(TargetName).cab</Command>
        <Outputs>$(TargetName).cab</Outputs>
        <Inputs>$(ProjectDir)main.cpp</Inputs>
      </CustomBuildStep>
    </ItemDefinitionGroup>
    ```

### <a name="to-define-where-in-the-build-the-custom-build-step-will-execute"></a>Определение того, где в сборке будет выполняться настраиваемый этап сборки

1. Добавьте следующую группу свойств в файл проекта. Можно указать обе цели или опустить один из них, если требуется, чтобы настраиваемый шаг выполнялся до или после определенного целевого объекта. В этом примере **MSBuild** выполняет настраиваемый шаг после этапа компиляции, но перед этапом компоновки.

    ```
    <PropertyGroup>
      <CustomBuildAfterTargets>ClCompile</CustomBuildAfterTargets>
      <CustomBuildBeforeTargets>Link</CustomBuildBeforeTargets>
    </PropertyGroup>
    ```

## <a name="see-also"></a>См. также

[Пошаговое руководство. Создание C++ проекта с помощью MSBuild](walkthrough-using-msbuild-to-create-a-visual-cpp-project.md)<br/>
[Практическое руководство. Использование событий сборки в проектах MSBuild](how-to-use-build-events-in-msbuild-projects.md)<br/>
[Практическое руководство. Добавление пользовательских средств сборки в проекты MSBuild](how-to-add-custom-build-tools-to-msbuild-projects.md)
