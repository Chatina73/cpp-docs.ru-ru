---
title: Настройка сеансов отладки CMake в Visual Studio
description: Описание использования Visual Studio для настройки параметров отладчика CMak
ms.date: 01/13/2020
helpviewer_keywords:
- CMake debugging
ms.openlocfilehash: 5e627f02b5245baede6e92268cedfc43957f3abc
ms.sourcegitcommit: 49e4fb3e0300fe86c814130661f1bf68b16e72e2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/15/2020
ms.locfileid: "76031336"
---
# <a name="configure-cmake-debugging-sessions"></a>Настройка сеансов отладки CMake

::: moniker range="vs-2015"

Собственная поддержка CMak доступна в Visual Studio 2017 и более поздних версиях.

::: moniker-end

::: moniker range=">=vs-2017"

Все исполняемые целевые объекты CMake отображаются в раскрывающемся списке **Автозапускаемый элемент** на панели инструментов **Общие**. Чтобы запустить сеанс отладки, выберите один из них и запустите отладчик.

![Раскрывающийся список элементов автозагрузки](media/cmake-startup-item-dropdown.png "Раскрывающийся список элементов автозагрузки")

Можно также запустить сеанс отладки из обозреватель решений. Сначала перейдите в **представление "целевые объекты CMAK** " в окне **Обозреватель решений** .

![Кнопка просмотра целевых объектов CMak](media/cmake-targets-view.png  "Пункт меню "Просмотр целевых объектов CMak"")

Затем щелкните правой кнопкой мыши любой исполняемый файл и выберите **Отладка** или **Отладка и параметры запуска**. **Отладка** автоматически начинает отладку выбранного целевого объекта на основе активной конфигурации. **Параметры отладки и запуска** открывает файл *Launch. vs. JSON* и добавляет новую конфигурацию отладки для выбранного целевого объекта.

## <a name="customize-debugger-settings"></a>Настройка параметров отладчика

Параметры отладчика можно настроить для любого исполняемого объекта CMak в проекте в файле с именем *Launch. vs. JSON*. Этот файл содержит три точки входа:

- Выберите **отладка > параметры отладки и запуска для $ {активедебугтаржет}** в главном меню, чтобы изменить конфигурацию отладки, относящуюся к активному целевому объекту отладки. Если вы не выбрали активный целевой объект, этот параметр будет неактивен.

- Перейдите к **представлению "целевые объекты** " в Обозреватель решений. Затем щелкните правой кнопкой мыши целевой объект отладки и выберите **параметры отладки и запуска** , чтобы изменить конфигурацию отладки, относящуюся к выбранному целевому объекту.

- Щелкните правой кнопкой мыши корневой CMakeLists. txt и выберите **параметры отладки и запуска** , чтобы открыть диалоговое окно **Выбор отладчика** . Диалоговое окно позволяет добавить любую конфигурацию отладки, но необходимо вручную указать целевой объект CMak для вызова через свойство `projectTarget`.

Чтобы сослаться на любой ключ в файле *CMakeSettings. JSON* , добавьте его в `cmake.` *Launch. vs. JSON*. В следующем примере показан простой файл *Launch. vs. JSON* , который извлекает значение ключа `remoteCopySources` в файле *CMakeSettings. JSON* для текущей выбранной конфигурации:

```json
{
  "version": "0.2.1",
  "defaults": {},
  "configurations": [
    {
      "type": "default",
      "project": "CMakeLists.txt",
      "projectTarget": "CMakeHelloWorld.exe (Debug\\CMakeHelloWorld.exe)",
      "name": "CMakeHelloWorld.exe (Debug\\CMakeHelloWorld.exe)",
      "args": ["${cmake.remoteCopySources}"]
    }
  ]
}
```

При сохранении файла *Launch. vs. JSON* Visual Studio создает запись для нового имени в раскрывающемся списке **автозагружаемый элемент** . Файл *Launch. vs. JSON* можно изменить для создания нескольких конфигураций отладки для любого числа целевых объектов CMAK.

## <a name="launchvsjson-reference"></a>Справочник по Launch. vs. JSON

Существует множество свойств *Launch. vs. JSON* для поддержки всех сценариев отладки. Следующие свойства являются общими для всех конфигураций отладки, как удаленных, так и локальных.

- `projectTarget`: указывает целевой объект CMak, который вызывается при сборке проекта. Visual Studio автоматически заполняет это свойство, если ввести *Launch. vs. JSON* из **отладки > Отладка и параметры запуска для представления $ {Активедебугтаржет}** или **целевых объектов**.

- `program`: полный путь к исполняемому файлу программы в удаленной системе. Вы можете использовать макрос `${debugInfo.fullTargetPath}` здесь.

- `args`: аргументы командной строки, передаваемые в программу для отладки.

## <a name="launchvsjson-reference-for-remote-linux-projects"></a>Справочник по Launch. vs. JSON для удаленных проектов Linux

Следующие свойства относятся к **конфигурациям удаленной отладки**. Вы также можете [выполнить пользовательские команды gdb](https://github.com/microsoft/MIEngine/wiki/Executing-custom-gdb-lldb-commands) для отправки команд непосредственно в базовый отладчик и [включить ведение журнала миенгине](https://github.com/microsoft/MIEngine/wiki/Logging) , чтобы узнать, какие команды будут отправлены в gdb, какие выходные данные gdb возвращаются и сколько времени занимает каждая команда.

- `cwd`: текущий рабочий каталог для поиска зависимостей и других файлов на удаленном компьютере. Можно использовать макрос `${debugInfo.defaultWorkingDirectory}`. Значение по умолчанию — это корневой каталог удаленной рабочей области, если он не переопределен в *CMakeLists. txt*. Это свойство используется только для удаленных конфигураций. `currentDir` используется для задания текущего каталога запуска приложения для локального проекта.

- `environment`: дополнительные переменные среды для добавления в среду для программы с использованием этого синтаксиса:

```json
  "environment": [
      {
        "name": "ENV1",
        "value": "envvalue1"
      },
      {
        "name": "ENV2",
        "value": "envvalue2"
      }
    ]
```

- `pipeArgs`: аргументы командной строки, передаваемые программе канала для настройки соединения. Программа канала используется для ретрансляции стандартных входных и выходных данных между Visual Studio и gdb. Команда `${debuggerCommand}` запускает gdb в удаленной системе и может быть изменена следующим образом:

  - Экспортируйте значение переменной среды, ОТОБРАЖАЕМое в системе Linux. В следующем примере это значение равно `:1`.

  ```json
  "pipeArgs": [
      "/s",
      "${debugInfo.remoteMachineId}",
      "/p",
      "${debugInfo.parentProcessId}",
      "/c",
      "export DISPLAY=:1;${debuggerCommand}",
      "--tty=${debugInfo.tty}"
    ],
  ```

  - Запустите скрипт перед выполнением gdb. Убедитесь, что для скрипта заданы разрешения на выполнение.

    ```json
    "pipeArgs": [
        "/s",
        "${debugInfo.remoteMachineId}",
        "/p",
        "${debugInfo.parentProcessId}",
        "/c",
        "/path/to/script.sh;${debuggerCommand}",
        "--tty=${debugInfo.tty}"
      ],
    ```

- `stopOnEntry`: логическое значение, указывающее, следует ли прерывать работу сразу после запуска процесса. Значение по умолчанию: false.

- `visualizerFile`: [Natvis-файл](/visualstudio/debugger/create-custom-views-of-native-objects) , используемый при отладке этого процесса. Этот параметр несовместим с gdb печати. Также задайте `showDisplayString` при задании этого свойства.

- `showDisplayString`: логическое значение, которое включает отображаемую строку при указании `visualizerFile`. Установка этого параметра в `true` может привести к снижению производительности во время отладки.

- `setupCommands`: одна или несколько команд gdb для выполнения, чтобы настроить базовый отладчик.

- `externalConsole`: логическое значение, указывающее, запущена ли консоль для отлаживаемой программы.

- `miDebuggerPath`: полный путь к gdb. Если не указано, Visual Studio сначала ищет путь для отладчика.

::: moniker-end

::: moniker range="vs-2017"

- `remoteMachineName`: удаленная система Linux, в которой размещается gdb, и программа для отладки.

::: moniker-end

::: moniker range="vs-2019"

Следующие свойства можно использовать для отделения **удаленной системы сборки** от **удаленной системы отладки**. Дополнительные сведения см. в разделе [Указание различных компьютеров для сборки и отладки](../linux/deploy-run-and-debug-your-linux-project.md#cmake-projects).

- `remoteMachineName`: удаленная система Linux, в которой размещается gdb, и программа для отладки. Эта запись не обязательно должна совпадать с удаленной системой Linux, используемой для сборки, указанной в *CMakeSettings. JSON*. Нажмите клавиши **Ctrl + пробел** , чтобы просмотреть список всех удаленных соединений, хранящихся в [диспетчере соединений](../linux/connect-to-your-remote-linux-computer.md).

- `disableDeploy`: указывает, отключено ли разделение сборки или отладки. Если эта функция включена, она позволяет выполнять сборку и отладку на двух отдельных компьютерах.

- `deployDirectory`: каталог на компьютере удаленной отладки (заданный параметром `remoteMachineName`), в который будет скопирован исполняемый файл.

- `deploy`: массив дополнительных параметров развертывания. Эти параметры необходимо настроить только в том случае, если требуется более детальный контроль над процессом развертывания. По умолчанию на удаленном компьютере отладки будут развернуты только файлы, необходимые для процесса отладки.

  - `sourceMachine`: компьютер, на котором будет скопирован файл или каталог. Нажмите клавиши **Ctrl + пробел** , чтобы просмотреть список всех удаленных соединений, хранящихся в диспетчере соединений.

  - `targetMachine`: компьютер, куда будет скопирован файл или каталог. Нажмите клавиши **Ctrl + пробел** , чтобы просмотреть список всех удаленных соединений, хранящихся в диспетчере соединений.

  - `sourcePath`: расположение файла или каталога на `sourceMachine`.

  - `targetPath`: расположение файла или каталога на `targetMachine`.

  - `deploymentType`: описание типа развертывания. поддерживаются `LocalRemote` и `RemoteRemote`. `LocalRemote` означает копирование из локальной файловой системы в удаленную систему, указанную `remoteMachineName` в файле *Launch. vs. JSON*. `RemoteRemote` означает копирование из удаленной системы сборки, указанной в *CMakeSettings. JSON* , в другую удаленную систему, указанную в *Launch. vs. JSON*.

  - `executable`: указывает, является ли развернутый файл исполняемым.

::: moniker-end

::: moniker range=">=vs-2017"

## <a name="attach-to-a-remote-process"></a>Присоединение к удаленному процессу

Вы можете присоединиться к процессу, работающему в системе Linux, присвоив параметру `processId` идентификатор процесса, чтобы присоединить отладчик к. Дополнительные сведения см. в разделе [Устранение неполадок присоединения к процессам с помощью gdb](https://github.com/Microsoft/MIEngine/wiki/Troubleshoot-attaching-to-processes-using-GDB).

::: moniker-end

::: moniker range="vs-2019"

## <a name="debug-on-linux-using-gdbserver"></a>Отладка в Linux с помощью gdbserver

Visual Studio 2019 версии 16,5 Предварительная версия 1 или более поздней поддерживает удаленную отладку проектов CMak с помощью gdbserver. Дополнительные сведения см. в разделе [Отладка проектов Linux CMAK с помощью gdbserver](https://devblogs.microsoft.com/cppblog/debugging-linux-cmake-projects-with-gdbserver/).

::: moniker-end

::: moniker range=">=vs-2017"

## <a name="see-also"></a>См. также:

[Проекты CMAK в Visual Studio](cmake-projects-in-visual-studio.md)\
[Настройка проекта Linux CMake](../linux/cmake-linux-project.md)\
[Подключитесь к удаленному компьютеру Linux](../linux/connect-to-your-remote-linux-computer.md)\
[Настройка параметров сборки cmak](customize-cmake-settings.md)\
[Настройте сеансы отладки cmak](configure-cmake-debugging-sessions.md)\
[Развертывание, запуск и отладка проекта Linux](../linux/deploy-run-and-debug-your-linux-project.md)\
[Справочник по предопределенной конфигурации CMake](cmake-predefined-configuration-reference.md)

::: moniker-end
