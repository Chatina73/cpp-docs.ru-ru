---
title: Настройка сеансов отладки CMake в Visual Studio
description: Описывает, как использовать Visual Studio для настройки настроек отладчика CMake.
ms.date: 04/02/2020
helpviewer_keywords:
- CMake debugging
ms.openlocfilehash: 8364e5b3dd3316a4ed7e754a104a14373040aa6e
ms.sourcegitcommit: c123cc76bb2b6c5cde6f4c425ece420ac733bf70
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81328812"
---
# <a name="configure-cmake-debugging-sessions"></a>Настройка сеансов отладки CMake

::: moniker range="vs-2015"

Поддержка Родных CMake доступна в Visual Studio 2017 и позже. Чтобы увидеть документацию для этих версий, установите элемент управления **селектора** визуальной версии для этой статьи на Visual Studio 2017 или Visual Studio 2019. Он находится в верхней части таблицы содержимого на этой странице.

::: moniker-end

::: moniker range=">=vs-2017"

Все исполняемые целевые объекты CMake отображаются в раскрывающемся списке **Автозапускаемый элемент** на панели инструментов **Общие**. Выберите один, чтобы начать сеанс отладки и запустить отладку.

![CMake запуска пункта отпадения](media/cmake-startup-item-dropdown.png "CMake запуска пункта отпадения")

Вы также можете начать сеанс отладки от Solution Explorer. Во-первых, переключитесь на **просмотр целей CMake** в окне **Solution Explorer.**

![Кнопка "Представление целевых объектов CMake"](media/cmake-targets-view.png  "Пункт меню CMake Targets View")

Затем, право ездуна на исполняемый и выберите **Debug**. Эта команда автоматически начинает отладку выбранной цели в зависимости от активной конфигурации.

## <a name="customize-debugger-settings"></a>Настройка параметров отладчика

Настройки отладчика можно настроить для любой исполняемой цели CMake в вашем проекте. Они находятся в файле конфигурации под названием *launch.vs.json,* расположенном *`.vs`* в папке в корне проекта. Файл конфигурации запуска полезен в большинстве сценариев отладки, так как можно настроить и сохранить детали настройки отладки. В этом файле есть три точки входа:

- **Меню отладки:** Выберите **настройки debug > debug и Launch для $'activeDebugTarget»** из основного меню, чтобы настроить конфигурацию отладки, специфичную для вашей активной цели отладки. Если у вас нет выбранной цели отладки, эта опция посеяла.

![Точка входа в меню отугиваем](media/cmake-debug-menu.png "Точка входа в меню отугиваем")

- **Просмотр целей:** Перейдите к **просмотру целей** в Solution Explorer. Затем нажмите правой кнопкой мыши на цель отладки и выберите **Добавить конфигурацию отладки,** чтобы настроить конфигурацию отладки, специфичную для выбранной цели.

![Точка входа целей](media/cmake-targets-add-debug-configuration.png "Точка входа целей")

- **Корень CMakeLists.txt:** Нажмите правой кнопкой мыши на корневой *CMakeLists.txt* и выберите **Конфигурацию Добавить Debug,** чтобы открыть диалоговую будку **Select a Debugger.** Диалог позволяет добавлять *любой* тип конфигурации отладки, но вы должны вручную `projectTarget` указать цель CMake, чтобы вызвать через свойство.

![Выберите диалоговую коробку отладчика](media/cmake-select-a-debugger.png "Выберите диалоговую коробку отладчика")

Вы можете отсеить файл *launch.vs.json* для создания конфигураций отладки для любого количества целей CMake. При сохранении файла Visual Studio создает запись для каждой новой конфигурации в выпадении **элемента запуска.**

## <a name="reference-keys-in-cmakesettingsjson"></a>Справочные ключи в CMakeSettings.json

Чтобы ссылаться на любой ключ в файле *CMakeSettings.json,* подготовьте `cmake.` его в *launch.vs.json*. Следующий пример показывает простой файл *launch.vs.json,* который `remoteCopySources` притягивает значение ключа в файле *CMakeSettings.json* для выбранной в настоящее время конфигурации:

```json
{
  "version": "0.2.1",
  "defaults": {},
  "configurations": [
    {
      "type": "default",
      "project": "CMakeLists.txt",
      "projectTarget": "CMakeHelloWorld.exe (Debug\\CMakeHelloWorld.exe)",
      "name": "CMakeHelloWorld.exe (Debug\\CMakeHelloWorld.exe)",
      "args": ["${cmake.remoteCopySources}"]
    }
  ]
}
```

**Переменные среды,** определенные в *CMakeSettings.json,* также могут быть `${env.VARIABLE_NAME}`использованы в launch.vs.json с помощью синтаксиса. В Visual Studio 2019 версия 16.4 и позже, отладить цели автоматически запускаются с помощью среды вы указываете в *CMakeSettings.json*. Вы можете вывести переменную среды, установив ее на **нуле.**

## <a name="launchvsjson-reference"></a>Ссылка Launch.vs.json

Есть много *свойств launch.vs.json* для поддержки всех сценариев отладки. Следующие свойства являются общими для всех конфигураций отладки, как удаленных, так и локальных:

- `projectTarget`: Определяет цель CMake, чтобы вызвать при построении проекта. Visual Studio автоматически заселяет это свойство, если вы вводите *launch.vs.json* из **меню Debug** или **Просмотро целей.** Это значение должно соответствовать названию существующей цели отладки, указанной в пункте отсечки **Startup.**

- `env`: Дополнительные переменные среды для добавления с помощью синтаксиса:

  ```json
  "env": {
        "DEBUG_LOGGING_LEVEL": "trace;info",
        "ENABLE_TRACING": "true"
      }
  ```

- `args`: Аргументы командной строки перешли в программу для отладки.

## <a name="launchvsjson-reference-for-remote-projects-and-wsl"></a>Launch.vs.json ссылка на удаленные проекты и WSL

В версии Visual Studio 2019 16.6 мы `type: cppgdb` добавили новую конфигурацию отладки для упрощения отладки на удаленных системах и WSL. Старые конфигурации `type: cppdbg` отжутов по-прежнему поддерживаются.

### <a name="configuration-type-cppgdb"></a>Тип конфигурации`cppgdb`

- `name`: Дружественное имя для определения конфигурации в выпадении **элемента запуска.**
- `project`: Опознавательный относительный путь к файлу проекта. Обычно вам не нужно менять этот путь при отладке проекта CMake.
- `projectTarget`: Определяет цель CMake, чтобы вызвать при построении проекта. Visual Studio автоматически заселяет это свойство, если вы вводите *launch.vs.json* из **меню Debug** или **Просмотро целей.** Это целевое значение должно соответствовать названию существующей цели отладки, указанной в пункте отсечки **Startup.**
- `debuggerConfiguration`: Указывает, какой набор отладки значений по умолчанию использовать. В Visual Studio 2019 версия 16.6, `gdb`единственный действительный вариант . Более ранние `gdbserver`версии также поддерживают .
- `args`: Аргументы командной строки перешли к запуску программы, которая отлажалась.
- `env`: Дополнительные переменные среды перешли к отладке программы. Например, `{"DISPLAY": "0.0"}`.
- `processID`: Идентификатор процесса Linux для присоединения. Используется только при подключении к удаленному процессу. Для получения дополнительной информации [см.](https://github.com/Microsoft/MIEngine/wiki/Troubleshoot-attaching-to-processes-using-GDB)

#### <a name="additional-options-for-the-gdb-configuration"></a>Дополнительные опции для конфигурации `gdb`

- `program`: По `"${debugInfo.fullTargetPath}"`умолчанию . Путь Unix к приложению для отладки. Требуется только в том случае, если он отличается от цели, исполняемой в местоположении сборки или развертывания.
- `remoteMachineName`: По `"${debugInfo.remoteMachineName}"`умолчанию . Название удаленной системы, хостов программы для отладки. Требуется только в том случае, если система сборки отличается от системы сборки. Должна иметь существующую запись в [менеджере соединения.](../linux/connect-to-your-remote-linux-computer.md) Нажмите **ctrl-Space,** чтобы просмотреть список всех существующих удаленных соединений.
- `cwd`: По `"${debugInfo.defaultWorkingDirectory}"`умолчанию . Путь Unix к каталогу на удаленной системе, где `program` он работает. Этот каталог должен существовать.
- `gdbpath`: По `/usr/bin/gdb`умолчанию . Полный путь Unix к используемому `gdb` для отладки. Требуется только при использовании пользовательской версии `gdb`.
- `preDebugCommand`: Команда Linux для запуска непосредственно `gdb`перед тем, как выскакивать. `gdb`не начинается до тех пор, пока команда не завершится. Можно использовать опцию для выполнения скрипта `gdb`до выполнения.

#### <a name="deployment-options"></a>Варианты развертывания

Используйте следующие параметры, чтобы отделить вашу машину сборки (определенную в CMakeSettings.json) от машины удаленного отладки.

- `remoteMachineName`: Удаленная отладка машины. Требуется только в том случае, если отличается от машины сборки. Должна иметь существующую запись в [менеджере соединения.](../linux/connect-to-your-remote-linux-computer.md) Нажмите **ctrl-Space,** чтобы просмотреть список всех существующих удаленных соединений.
- `disableDeploy`: По `false`умолчанию . Указывает, отключена ли разделение сборки/отладки. Когда `false`эта опция позволяет строить и отлаживать на двух отдельных машинах.
- `deployDirectory`: Полный путь Unix `remoteMachineName` к каталогу о том, что исполняемые получает скопированы.
- `deploy`: Массив расширенных настроек развертывания. Эти настройки необходимо настроить только тогда, когда требуется более детальный контроль над процессом развертывания. По умолчанию в пульт удаленного отладки развертываются только файлы, необходимые для отладки процесса.
  - `sourceMachine`: Машина, с которой копируется файл или каталог. Нажмите **ctrl-Space,** чтобы просмотреть список всех удаленных подключений, хранящихся в диспетчере подключения. При построении на WSL эта опция игнорируется.
  - `targetMachine`: Машина, скопированная файлом или каталогом. Нажмите **ctrl-Space,** чтобы просмотреть список всех удаленных подключений, хранящихся в диспетчере подключения.
  - `sourcePath`: Файл или местоположение `sourceMachine`каталога на .
  - `targetPath`: Файл или местоположение `targetMachine`каталога на .
  - `deploymentType`: Описание типа развертывания. `LocalRemote`и `RemoteRemote` поддерживаются. `LocalRemote`означает копирование из локальной файловой системы в удаленную систему, указанную `remoteMachineName` в *launch.vs.json*. `RemoteRemote`означает копирование из системы удаленной сборки, указанной в *CMakeSettings.json* для другой удаленной системы, указанной в *launch.vs.json*.
  - `executable`: Указывает, является ли развернутый файл исполняемым.

### <a name="execute-custom-gdb-commands"></a>Выполнение `gdb` пользовательских команд

Visual Studio поддерживает выполнение `gdb` пользовательских команд для прямого взаимодействия с базовым отладчиком. Для получения дополнительной [информации `gdb` ](https://github.com/microsoft/MIEngine/wiki/Executing-custom-gdb-lldb-commands)см.

### <a name="enable-logging"></a>Включение ведения журналов

Включите журнал MIEngine, чтобы `gdb`увидеть, `gdb` какие команды отправляются в, какие выходные возвращается, и сколько времени занимает каждая команда. [Дополнительные сведения](https://github.com/microsoft/MIEngine/wiki/Logging)

### <a name="configuration-type-cppdbg"></a>Тип конфигурации`cppdbg`

Следующие параметры могут быть использованы при отладке `cppdbg` в удаленной системе или WSL с использованием типа конфигурации. В Visual Studio 2019 версия 16.6 `cppgdb` или более поздний, тип конфигурации рекомендуется.

- `name`: Дружественное имя для определения конфигурации в выпадении **элемента запуска.**

- `project`: Опознавательный относительный путь к файлу проекта. Обычно вам не нужно изменять это значение при отладке проекта CMake.

- `projectTarget`: Определяет цель CMake, чтобы вызвать при построении проекта. Visual Studio автоматически заселяет это свойство, если вы вводите *launch.vs.json* из **меню Debug** или **Просмотро целей.** Это значение должно соответствовать названию существующей цели отладки, указанной в пункте отсечки **Startup.**

- `args`: Аргументы командной строки перешли к запуску программы, которая отлажалась.

- `processID`: Идентификатор процесса Linux для присоединения. Используется только при подключении к удаленному процессу. Для получения дополнительной информации [см.](https://github.com/Microsoft/MIEngine/wiki/Troubleshoot-attaching-to-processes-using-GDB)

- `program`: По `"${debugInfo.fullTargetPath}"`умолчанию . Путь Unix к приложению для отладки. Требуется только в том случае, если он отличается от цели, исполняемой в местоположении сборки или развертывания.

- `remoteMachineName`: По `"${debugInfo.remoteMachineName}"`умолчанию . Название удаленной системы, хостов программы для отладки. Требуется только в том случае, если система сборки отличается от системы сборки. Должна иметь существующую запись в [менеджере соединения.](../linux/connect-to-your-remote-linux-computer.md) Нажмите **ctrl-Space,** чтобы просмотреть список всех существующих удаленных соединений.

- `cwd`: По `"${debugInfo.defaultWorkingDirectory}"`умолчанию . Полный путь Unix к каталогу `program` на удаленной системе, где запущен. Этот каталог должен существовать.

- `environment`: Дополнительные переменные среды перешли к отладке программы. Например,

  ```json
    "environment": [
        {
          "name": "ENV1",
          "value": "envvalue1"
        },
        {
          "name": "ENV2",
          "value": "envvalue2"
        }
      ]
  ```

- `pipeArgs`: Массив аргументов командной строки, переданных в программу труб для настройки соединения. Программа труб используется для ретрансляции стандартного ввода/вывода между Visual Studio и `gdb`. Большая часть этого массива **не требуется настраивать** при отладке проектов CMake. Исключением `${debuggerCommand}`является, который `gdb` запускает на удаленной системе. Его можно модифицировать до:

  - Экспорт значение переменной среды DISPLAY на вашей системе Linux. В следующем примере это `:1`значение .

    ```json
    "pipeArgs": [
        "/s",
        "${debugInfo.remoteMachineId}",
        "/p",
        "${debugInfo.parentProcessId}",
        "/c",
        "export DISPLAY=:1;${debuggerCommand}",
        "--tty=${debugInfo.tty}"
      ],
    ```

  - Выполнить скрипт перед `gdb`выполнением . Убедитесь, что разрешения на выполнение установлены на вашем скрипте.

    ```json
    "pipeArgs": [
        "/s",
        "${debugInfo.remoteMachineId}",
        "/p",
        "${debugInfo.parentProcessId}",
        "/c",
        "/path/to/script.sh;${debuggerCommand}",
        "--tty=${debugInfo.tty}"
      ],
    ```

- `stopOnEntry`: Булеан, который определяет, следует ли разорвать, как только процесс запущен. Значение по умолчанию — false.

- `visualizerFile`: [файл .natvis](/visualstudio/debugger/create-custom-views-of-native-objects) для использования при отладке этого процесса. Этот вариант несовместим `gdb` с довольно печати. Также `showDisplayString` устанавливается при установке этого свойства.

- `showDisplayString`: булей, который позволяет строку отображения при указании. `visualizerFile` Установка этой `true` опции может привести к снижению производительности во время отладки.

- `setupCommands`: Одна `gdb` или несколько команд (ы) для выполнения, для настройки основного отладчика.

- `miDebuggerPath`: Полный `gdb`путь к . Когда не указано, Visual Studio ищет PATH сначала для отладчика.

- Наконец, все параметры развертывания, `cppgdb` определенные для типа `cppdbg` конфигурации, также могут быть использованы типом конфигурации.

### <a name="debug-using-gdbserver"></a>Ошибка с использованием`gdbserver`

Можно настроить конфигурацию `cppdbg` для отладки с помощью. `gdbserver` Вы можете найти более подробную информацию и пример запуска конфигурации в Microsoft C ' Команда блог пост [отладка `gdbserver`Linux CMake проектов с ](https://devblogs.microsoft.com/cppblog/debugging-linux-cmake-projects-with-gdbserver/).

::: moniker-end

::: moniker range=">=vs-2017"

## <a name="see-also"></a>См. также раздел

[Проекты CMake в Visual Studio](cmake-projects-in-visual-studio.md)\
[Настройка проекта Linux CMake](../linux/cmake-linux-project.md)\
[Подключитесь к удаленному компьютеру Linux](../linux/connect-to-your-remote-linux-computer.md)\
[Настройка настроек сборки CMake](customize-cmake-settings.md)\
[Настройка сеансов отладки CMake](configure-cmake-debugging-sessions.md)\
[Развертывание, запуск и отладка проекта Linux](../linux/deploy-run-and-debug-your-linux-project.md)\
[Справочник по предопределенной конфигурации CMake](cmake-predefined-configuration-reference.md)

::: moniker-end
