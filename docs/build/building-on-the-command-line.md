---
title: Использование набора инструментов C++ Microsoft из командной строки
description: Используйте цепочку инструментов компилятора Microsoft C++ (MSVC) из командной строки вне интегрированной среды разработки Visual Studio.
ms.custom: conceptual
ms.date: 11/12/2019
helpviewer_keywords:
- command-line builds [C++]
- compiling source code [C++], command line
- builds [C++], command-line
- command line [C++], building from
- command line [C++], compilers
ms.assetid: 7ca9daed-a003-4162-842d-908f79058365
ms.openlocfilehash: ec30cba8e119f96efc5bca156fa565db77904520
ms.sourcegitcommit: 7ecd91d8ce18088a956917cdaf3a3565bd128510
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/16/2020
ms.locfileid: "79422904"
---
# <a name="use-the-microsoft-c-toolset-from-the-command-line"></a>Использование набора инструментов C++ Microsoft из командной строки

Вы можете выполнять сборку приложений на языках C и C++ из командной строки с помощью средств, включенных в Visual Studio. Набор средств C++ компилятора Microsoft (компилятором MSVC) также можно скачать как отдельный пакет, который не включает интегрированную среду разработки Visual Studio.

## <a name="download-and-install-the-tools"></a>Загрузка и установка средств

Если вы установили Visual Studio и C++ рабочую нагрузку, у вас есть все программы командной строки. Сведения о том, как установить C++ и Visual Studio, см [. C++ в разделе Установка поддержки в Visual Studio](vscpp-step-0-installation.md). Если требуется только набор средств командной строки, скачайте [средства сборки для Visual Studio](https://visualstudio.microsoft.com/downloads/#build-tools-for-visual-studio-2019). При запуске скачанного исполняемого файла он обновляет и запускает Visual Studio Installer. Чтобы установить только те средства, которые необходимы C++ для разработки, выберите рабочую нагрузку  **C++ средства сборки** . Можно выбрать дополнительные библиотеки и наборы инструментов для включения в раздел **сведения об установке**. Чтобы создать код с помощью набора инструментов Visual Studio 2015 или 2017, выберите необязательные средства сборки КОМПИЛЯТОРОМ MSVC V140 или КОМПИЛЯТОРОМ MSVC v141. Когда вы удовлетворены выбранными параметрами, нажмите кнопку **установить**.

## <a name="how-to-use-the-command-line-tools"></a>Практическое руководство. Использование программ командной строки

Когда вы выбираете одну из рабочих нагрузок C++ в Visual Studio Installer, он устанавливает *набор инструментов платформы* Visual Studio. Набор инструментов платформы содержит все средства и C++ C для конкретной версии Visual Studio. К этим средствам относятся CC++ /компиляторы, компоновщики, сборки, другие средства сборки и соответствующие библиотеки. Все эти средства можно использовать в командной строке. Они также используются внутри интегрированной среды разработки Visual Studio. Для создания кода для целевых объектов x86, x64, ARM и ARM64 существуют отдельные компиляторы, размещенные на процессорах x86 и x64. Каждый набор средств для конкретного узла и целевой архитектуры сборки хранится в собственном каталоге.

Для правильной работы инструментам требуется несколько переменных среды. Эти переменные используются для добавления средств к пути, а также для задания включаемого файла, файла библиотеки и расположений пакетов SDK. Чтобы упростить процесс задания этих переменных среды, программа установки создает настраиваемые *командные файлы*, или пакетные файлы, во время установки. Можно запустить один из этих командных файлов, чтобы задать определенную и целевую архитектуру сборки, Windows SDK версию и набор инструментов платформы. Для удобства установщик также создает ярлыки в меню "Пуск". Ярлыки запускают окна командной строки разработчика с помощью этих командных файлов для конкретных сочетаний узла и целевого объекта. Эти сочетания клавиш гарантируют, что все необходимые переменные среды установлены и готовы к использованию.

Необходимые переменные среды относятся к установке и к выбранной архитектуре сборки. Они также могут быть изменены обновлениями продукта или их обновлением. Поэтому рекомендуется использовать установленный ярлык командной строки или командный файл вместо задания переменных среды самостоятельно. Дополнительные сведения см. [в разделе Задание переменных пути и среды для сборок из командной строки](setting-the-path-and-environment-variables-for-command-line-builds.md).

Установленные наборы инструментов, командные файлы и ярлыки зависят от процессора компьютера и параметров, выбранных во время установки. Средства, размещаемые на платформе x86 и кросс-платформенные средства, которые создают код x86 и x64, всегда устанавливаются. При наличии 64-разрядной версии Windows также устанавливаются средства для размещения на платформе x64 и кросс-платформенные средства, создающие код x86 и x64. Если выбрать необязательные C++ средства универсальная платформа Windows, то будут также установлены средства x86 и x64, создающие код ARM и ARM64. Другие рабочие нагрузки могут устанавливать дополнительные средства.

## <a name="developer_command_prompt_shortcuts"></a>Ярлыки командной строки разработчика

Ярлыки командной строки устанавливаются в папке конкретной версии Visual Studio в меню "Пуск". Ниже приведен список основных ярлыков командной строки и архитектуры сборки, которые они поддерживают:

- **Командная строка разработчика** — указывает среде использовать 32-разрядные собственные инструменты x86 для сборки 32-разрядного машинного кода x86.
- **Командная строка Native Tools x86** — указывает среде использовать 32-разрядные собственные инструменты x86 для сборки 32-разрядного машинного кода x86.
- **Командная строка Native Tools x64** — указывает среде использовать 64-разрядные собственные инструменты x64 для сборки 64-разрядного машинного кода x64.
- **Командная строка Cross Tools x86_x64** — указывает среде использовать 32-разрядные собственные инструменты x86 для сборки 64-разрядного машинного кода x64.
- **Командная строка Cross Tools x64_x86** — указывает среде использовать 64-разрядные собственные инструменты x64 для сборки 32-разрядного машинного кода x86.

::: moniker range=">= vs-2019"

Папка меню Пуск и имена ярлыков зависят от установленной версии Visual Studio. Если задать его, они также зависят от **псевдонима**установки. Например, предположим, что вы установили Visual Studio 2019 и присвоили ему псевдоним *последней версии*. Ярлык командной строки разработчика называется **Командная строка разработчика для VS 2019 (последняя версия)** в папке с именем **Visual Studio 2019**.

::: moniker-end
::: moniker range="= vs-2017"

Папка меню Пуск и имена ярлыков зависят от установленной версии Visual Studio. Если задать его, они также зависят от **псевдонима**установки. Например, предположим, что вы установили Visual Studio 2017 и присвоили ему псевдоним *последней версии*. Ярлык командной строки разработчика называется **Командная строка разработчика для VS 2017 (последняя версия)** в папке с именем **Visual Studio 2017**.

::: moniker-end
::: moniker range="< vs-2017"

Папка меню Пуск и имена ярлыков зависят от установленной версии Visual Studio. Например, предположим, что вы установили Visual Studio 2015. Ярлык командной строки разработчика называется **Командная строка разработчика для VS 2015**.

::: moniker-end

### <a name="developer_command_prompt"></a> Открытие окна "Командная строка разработчика"

1. На рабочем столе откройте меню **Пуск** Windows, прокрутите вниз, чтобы найти и открыть папку вашей версии Visual Studio, например **Visual Studio 2019**.

1. В папке выберите ярлык **Командная строка разработчика** для вашей версии Visual Studio. Этот ярлык запускает окно командной строки разработчика, которое использует архитектуру сборки по умолчанию: 32-разрядные собственные инструменты x86 для сборки 32-разрядного машинного кода x86. Если вы предпочитаете архитектуру сборки не по умолчанию, выберите одну из собственных командных строк или командную строку инструментов кросс-компиляции, чтобы указать узел и целевую архитектуру.

Чтобы еще более быстро открыть командную строку разработчика, введите в поле поиска на рабочем столе *командную строку разработчика* . Затем выберите нужный результат.

## <a name="developer_command_file_locations"></a> Расположение командных файлов разработчика

Если вы предпочитаете задать среду сборки в существующем окне командной строки, можно использовать один из командных файлов, созданных установщиком. Мы рекомендуем задать среду в новом окне командной строки. Позже мы не рекомендуем переключать среды в одном командном окне.

::: moniker range=">= vs-2019"

Расположение командного файла зависит от установленной версии Visual Studio и от параметров, сделанных во время установки. Для Visual Studio 2019 стандартное расположение установки в 64-разрядной системе находится в \\Program Files (x86)\\Microsoft Visual Studio\\2019\\*Edition*. *Выпуск* может быть сообществом, профессиональным, корпоративным, BuildTools или другим введенным псевдонимом.

::: moniker-end
::: moniker range="= vs-2017"

Расположение командного файла зависит от установленной версии Visual Studio и от параметров, сделанных во время установки. Для Visual Studio 2017 стандартное расположение установки в 64-разрядной системе находится в \\Program Files (x86)\\Microsoft Visual Studio\\2017\\*Edition*. *Выпуск* может быть сообществом, профессиональным, корпоративным, BuildTools или другим введенным псевдонимом.

::: moniker-end
::: moniker range="< vs-2017"

Расположение командного файла зависит от версии Visual Studio и каталога установки. Для Visual Studio 2015 типичным расположением установки является \\Program Files (x86)\\Microsoft Visual Studio 14,0.

::: moniker-end

Основной файл командной строки разработчика VsDevCmd. bat находится в подкаталоге Common7\\Tools. Если параметры не указаны, среда устанавливает для среды использование собственных средств x86 для сборки 32-разрядного кода x86.

::: moniker range=">= vs-2017"

Для настройки конкретных архитектур сборки доступны дополнительные командные файлы. Доступные командные файлы зависят от установленных рабочих нагрузок и параметров Visual Studio. В Visual Studio 2017 и Visual Studio 2019 их можно найти в подкаталоге VC\\вспомогательной\\сборки.

::: moniker-end
::: moniker range="< vs-2017"

Для настройки конкретных архитектур сборки доступны дополнительные командные файлы. Доступные командные файлы зависят от установленных рабочих нагрузок и параметров Visual Studio. В Visual Studio 2015 они находятся в VC, VC\\bin или VC\\bin\\*архитектурных* подкаталогах, где *архитектура* является одним из параметров машинного или кросс-компилятора.

::: moniker-end

Эти командные файлы устанавливают параметры по умолчанию и вызывают VsDevCmd.bat, чтобы настроить указанную среду архитектуры сборки. Обычная установка может включать следующие командные файлы:

|Командный файл|Узел и целевые архитектуры|
|---|---|
|**vcvars32.bat**| Использует 32-разрядные собственные инструменты x86 для сборки 32-разрядного машинного кода x86.|
|**vcvars64.bat**| Использует 64-разрядные собственные инструменты x64 для сборки 64-разрядного кода x64.|
|**vcvarsx86_amd64.bat**| Использует 32-разрядные собственные инструменты кросс-компиляции x86 для сборки 64-разрядного кода x64.|
|**vcvarsamd64_x86.bat**| Использует 64-разрядные собственные инструменты кросс-компиляции x64 для сборки 32-разрядного кода x86.|
|**vcvarsx86_arm.bat**| Использует 32-разрядные собственные инструменты кросс-компиляции x86 для сборки кода ARM.|
|**vcvarsamd64_arm.bat**| Использует 64-разрядные собственные инструменты кросс-компиляции x64 для сборки кода ARM.|
|**vcvarsall.bat**| Используйте параметры, чтобы указать архитектуру узла и целевые архитектуры, Windows SDK и выбор платформы. Список поддерживаемых вариантов можно вызвать параметром **/help**.|

> [!CAUTION]
> Файл vcvarsall.bat и другие командные файлы Visual Studio могут различаться на разных компьютерах. Не заменяйте отсутствующий или поврежденный файл vcvarsall.bat файлом с другого компьютера. Перезапустите Visual Studio Installer, чтобы заменить отсутствующий файл.
>
> Файл vcvarsall.bat также может иметь отличия в разных версиях. Если текущая версия Visual Studio установлена на компьютере, на котором также имеется более ранняя версия Visual Studio, не запускайте файл vcvarsall.bat или другой командный файл других версий в том же окне командной строки.

## <a name="use-the-developer-tools-in-an-existing-command-window"></a>Использование средств разработчика в существующем окне командной строки

Самый простой способ указать конкретную архитектуру сборки в существующем окне команд — использовать файл vcvarsall.bat. Используйте файла Vcvarsall. bat, чтобы задать переменные среды для настройки командной строки для собственной 32-разрядной или 64-разрядной компиляции. Аргументы позволяют указать перекрестную компиляцию для процессоров x86, x64, ARM или ARM64. Вы можете выбрать Microsoft Store, универсальная платформа Windows или платформы Windows для настольных компьютеров. Можно даже указать, какие Windows SDK использовать, и выбрать версию набора инструментов платформы.

При использовании без аргументов файла Vcvarsall. bat настраивает переменные среды для использования текущего компилятора x86 для 32-разрядных целевых объектов Windows. Можно добавить аргументы, чтобы настроить среду для использования любого из средств машинного или кроссного компилятора. файла Vcvarsall. bat выводит сообщение об ошибке, если вы указали конфигурацию, которая не установлена или недоступна на компьютере.

### <a name="vcvarsall-syntax"></a>Синтаксис vcvarsall

> **vcvarsall.bat** [*architecture*] [*platform_type*] [*winsdk_version*] [ **-vcvars_ver=** _vcversion_]

*architecture*<br/>
Этот необязательный аргумент указывает узел и целевую архитектуру для использования. Если *архитектура* не указана, используется среда сборки по умолчанию. Поддерживаются следующие аргументы:

|*architecture*|Компилятор|Архитектура главного компьютера|Архитектура выходных данных сборки (целевая)|
|----------------------------|--------------|----------------------------------|-------------------------------|
|**x86**|собственный 32-разрядный x86|x86, x64|x86|
|**x86\_amd64** или **x86\_x64**|x64 для x86 (кросс-компилятор)|x86, x64|x64|
|**x86_arm**|ARM для x86 (кросс-компилятор)|x86, x64|ARM|
|**x86_arm64**|ARM64 для x86 (кросс-компилятор)|x86, x64|ARM64|
|**amd64** или **x64**|Собственный 64-разрядный x64|x64|x64|
|**amd64\_x86** или **x64\_x86**|x86 для x64 (кросс-компилятор)|x64|x86|
|**amd64\_arm** или **x64\_arm**|ARM для x64 (кросс-компилятор)|x64|ARM|
|**amd64\_arm64** или **x64\_arm64**|ARM64 для x64 (кросс-компилятор)|x64|ARM64|

*platform_type*<br/>
Этот необязательный аргумент позволяет указать **store** или **uwp** в качестве типа платформы. По умолчанию среда настроена на сборку классических или консольных приложений.

*winsdk_version*<br/>
При необходимости указывает версию Windows SDK для использования. По умолчанию используется последняя установленная версия Windows SDK. Чтобы указать версию Windows SDK, можно использовать полный номер пакета Windows 10 SDK, например **10.0.10240.0**, или указать **8.1**, чтобы использовать Windows 8.1 SDK.

*vcversion*<br/>
При необходимости указывает набор инструментов компилятора Visual Studio для использования. По умолчанию среда должна использовать текущий набор инструментов компилятора Visual Studio.

::: moniker range=">= vs-2019"

Используйте параметр **-vcvars_ver = 14.2 x. гггг** , чтобы указать конкретную версию набора инструментов компилятора Visual Studio 2019.

Используйте параметр **-vcvars_ver = 14.16** , чтобы указать последнюю версию набора инструментов компилятора Visual Studio 2017.

::: moniker-end
::: moniker range="= vs-2017"

Используйте параметр **-vcvars_ver = 14.16** , чтобы указать последнюю версию набора инструментов компилятора Visual Studio 2017.

Используйте параметр **-vcvars_ver = 14,1 x. гггг** , чтобы указать конкретную версию набора инструментов компилятора Visual Studio 2017.

::: moniker-end

Чтобы указать набор инструментов компилятора Visual Studio 2015, используйте параметр **-vcvars_ver =** ".

#### <a name="vcvarsall"></a>Настройка среды сборки в существующем окне командной строки

1. В командной строке выполните команду CD, чтобы перейти на каталог установки Visual Studio. Затем снова используйте CD, чтобы перейти в подкаталог, который содержит зависящие от конфигурации командные файлы. Для Visual Studio 2019 и Visual Studio 2017 используйте подкаталог *VC\\вспомогательный\\сборки* . Для Visual Studio 2015 используйте подкаталог *VC* .

1. Введите команду для вашей среды разработки. Например, чтобы создать код ARM для UWP на 64-разрядной платформе, используя последнюю версию набора средств компилятора Windows SDK и Visual Studio, используйте следующую командную строку:

   `vcvarsall.bat amd64_arm uwp`

## <a name="create-your-own-command-prompt-shortcut"></a>Создание собственных ярлыков командной строки

::: moniker range=">= vs-2019"

Откройте диалоговое окно свойств для ярлыка командной строки разработчика, чтобы увидеть используемый целевой объект команды. Например, целевой объект для ярлыка **командной строки Native Tools x64 для VS 2019** выглядит примерно следующим образом:

`%comspec% /k "C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Auxiliary\Build\vcvars64.bat"`

::: moniker-end
::: moniker range="= vs-2017"

Откройте диалоговое окно свойств для ярлыка командной строки разработчика, чтобы увидеть используемый целевой объект команды. Например, цель для ярлыка **Командная строка Native Tools x64 для VS 2017** выглядит примерно так:

`%comspec% /k "C:\Program Files (x86)\Microsoft Visual Studio\2017\Community\VC\Auxiliary\Build\vcvars64.bat"`

::: moniker-end
::: moniker range="< vs-2017"

Откройте диалоговое окно свойств для ярлыка командной строки разработчика, чтобы увидеть используемый целевой объект команды. Например, цель для ярлыка **Командная строка Native Tools x64 VS2015** выглядит примерно так:

`%comspec% /k "C:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\vcvarsall.bat" amd64`

::: moniker-end

Пакетные файлы конкретной архитектуры задают параметр *architecture* и вызывают vcvarsall.bat. Те же параметры можно передать в эти пакетные файлы, как если бы вы передали в файла Vcvarsall. bat, или просто вызвать файла Vcvarsall. bat напрямую. Чтобы задать параметры для ярлыка своей командной строки, добавьте их в конец команды в двойных кавычках. Например, вот ярлык для создания кода ARM для UWP на 64-разрядной платформе с использованием последней Windows SDK. Чтобы использовать более раннюю версию набора инструментов компилятора, укажите номер версии. Используйте подобный целевой объект команды в ярлыке:

::: moniker range=">= vs-2019"

`%comspec% /k "C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Auxiliary\Build\vcvarsall.bat" amd64_arm uwp -vcvars_ver=14.16`

::: moniker-end
::: moniker range="= vs-2017"

`%comspec% /k "C:\Program Files (x86)\Microsoft Visual Studio\2017\Community\VC\Auxiliary\Build\vcvarsall.bat" amd64_arm uwp -vcvars_ver=14.0`

::: moniker-end
::: moniker range="< vs-2017"

`%comspec% /k "C:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\vcvarsall.bat" amd64 -vcvars_ver=12.0`

::: moniker-end

Измените путь в соответствии с каталогом установки Visual Studio. Файл vcvarsall.bat содержит дополнительную информацию об определенных номерах версии.

## <a name="command-line-tools"></a>Программы командной строки

Для сборки C/C++ Project в командной строке Visual Studio предоставляет следующие средства командной строки:

[CL](reference/compiling-a-c-cpp-program.md)<br/>
Используйте компилятор (cl.exe) для компиляции и компоновки файлов исходного кода в приложения, библиотеки и DLL.

[Ссылка](reference/linking.md)<br/>
Используйте компоновщик (link.exe) для компоновки скомпилированных объектных файлов и библиотек в приложения и DLL.

[MSBuild](msbuild-visual-cpp.md)<br/>
Используйте MSBuild (msbuild.exe) и файл проекта (VCXPROJ) для настройки сборки и косвенного вызова набора инструментов. Это эквивалентно выполнению команды **Build** Project или **Build Solution** в интегрированной среде разработки Visual Studio. Запуск MSBuild из командной строки — это расширенный сценарий, который обычно не рекомендуется.

[DEVENV](/visualstudio/ide/reference/devenv-command-line-switches)<br/>
Используйте DEVENV (devenv. exe) в сочетании с параметром командной строки, таким как **/Build** или **/Clean** , для выполнения определенных команд сборки без отображения интегрированной среды разработки Visual Studio. Как правило, команда DEVENV предпочтительнее непосредственного использования MSBuild, так как позволяет Visual Studio управлять сложностями MSBuild.

[NMAKE](reference/nmake-reference.md)<br/>
Используйте NMAKE (nmake.exe) в Windows для создания проектов C++ на основе традиционного файла makefile.

При выполнении сборки в командной строке команда F1 недоступна для мгновенной справки. Вместо этого используйте поисковую систему для получения сведений о предупреждениях, ошибках и сообщениях или используйте автономные файлы справки. Чтобы использовать поиск в [docs.Microsoft.com](https://docs.microsoft.com/cpp/), используйте поле поиска в верхней части страницы.

## <a name="in-this-section"></a>В этом разделе

В этих статьях показано, как создавать приложения в командной строке, а также описано, как настроить среду сборки командной строки. В некоторых примерах показано, как использовать 64-разрядные наборы инструментов и целевые платформы x86, x64, ARM и ARM64. Они также описывают использование средств сборки командной строки MSBuild и NMAKE.

[Пошаговое руководство. Компиляция C++ собственной программы в командной строке](walkthrough-compiling-a-native-cpp-program-on-the-command-line.md)<br/>
Содержит пример, демонстрирующий создание и компиляцию C++ программы в командной строке.

[Пошаговое руководство. Компиляция программы на языке C из командной строки](walkthrough-compile-a-c-program-on-the-command-line.md)<br/>
Описывается компиляция программы, написанной на языке программирования C.

[Пошаговое руководство. C++Компиляция программы/CLI в командной строке](walkthrough-compiling-a-cpp-cli-program-on-the-command-line.md)<br/>
Описывается создание и компиляция программы C++/CLI, в которой используется платформа .NET Framework.

[Пошаговое руководство. C++Компиляция программы/CX в командной строке](walkthrough-compiling-a-cpp-cx-program-on-the-command-line.md)<br/>
Описывается создание и компиляция программы C++/CX, в которой используется среда выполнения Windows.

[Задание пути и переменных среды для сборок из командной строки](setting-the-path-and-environment-variables-for-command-line-builds.md)<br/>
Настройка переменных среды для 32 использования 32-разрядного или 64-разрядного набора инструментов для платформ x86, x64, ARM и ARM64.

[NMAKE reference](reference/nmake-reference.md) (Справочник по NMAKE)<br/>
Содержит ссылки на статьи, в которых описывается служебная программа обслуживания программ Майкрософт (NMAKE.EXE).

[MSBuild в командной строке — C++](msbuild-visual-cpp.md)<br/>
Содержит ссылки на статьи, в которых рассматривается использование программы msbuild.exe из командной строки.

## <a name="related-sections"></a>См. также

[/MD,/MT,/LD (использование библиотеки времени выполнения)](reference/md-mt-ld-use-run-time-library.md)<br/>
Описывается использование этих параметров компилятора для работы с библиотекой времени выполнения отладки или выпуска.

[Параметры компилятораC++ C/](reference/compiler-options.md)<br/>
Содержит ссылки на статьи, посвященные параметрам компилятора C и C++, а также программе CL.exe.

[Параметры компоновщика КОМПИЛЯТОРОМ MSVC](reference/linker-options.md)<br/>
Содержит ссылки на статьи, посвященные параметрам компоновщика и программе LINK.exe.

[Дополнительные средства сборки MSVC](reference/c-cpp-build-tools.md)<br/>
Содержит ссылки на средства сборки C/C++, включенные в состав Visual Studio.

## <a name="see-also"></a>См. также раздел

[Проекты и системы сборки](projects-and-build-systems-cpp.md)
