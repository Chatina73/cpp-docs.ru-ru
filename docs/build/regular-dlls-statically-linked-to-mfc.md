---
title: Регулярные MFC DLL, статически компонуемые с MFC
ms.date: 11/04/2016
helpviewer_keywords:
- regular MFC DLLs [C++]
- DLLs [C++], regular
- USRDLLs
- USRDLLs, statically linked to MFC
- statically linked DLLs [C++]
- regular MFC DLLs [C++], statically linked to MFC
ms.assetid: 2eed531c-726a-4b8a-b936-f721dc00a7fa
ms.openlocfilehash: 1f05b5e3c268935cf3161fb7184e04b3e3ea1446
ms.sourcegitcommit: 0ab61bc3d2b6cfbd52a16c6ab2b97a8ea1864f12
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "62314784"
---
# <a name="regular-mfc-dlls-statically-linked-to-mfc"></a>Регулярные MFC DLL, статически компонуемые с MFC

Обычный, библиотеки DLL MFC, статически компонуемые с MFC представляет собой библиотеку DLL, который внутренне использует MFC, а экспортированные функции в библиотеке DLL могут быть вызваны исполняемые файлы MFC или не являющихся MFC. Как описывается в его имени, такого рода DLL создается с помощью статическая компоновка версии библиотеки MFC. Обычно функции экспортируются из библиотеки DLL MFC, с использованием стандартного интерфейса C обычного. Пример для написания, сборки и использовать обычную библиотеку DLL MFC, см. в образце [DLLScreenCap](https://github.com/Microsoft/VCSamples/tree/master/VC2010Samples/MFC/advanced/DllScreenCap).

Обратите внимание, что термин USRDLL больше не используется в документации по Visual C++. Обычной MFC DLL, статически компонуемые с MFC имеет те же характеристики, как бывший USRDLL.

Обычная библиотека DLL MFC, статически компонуемые с MFC, обладает следующими функциями:

- Исполняемый файл клиента могут быть написаны на любом языке, поддерживающем использование библиотек DLL (C, C++, Pascal, Visual Basic и т. д.); его не нужно быть в приложении MFC.

- Библиотеки DLL можно связать с тем же статическая компоновка библиотеки MFC, используемые приложениями. Больше не существует отдельная версия статических библиотек для библиотек DLL.

- До версии MFC 4.0 библиотеки USRDLL обеспечивали тот же тип, часть возможностей обычные библиотеки DLL MFC, статически компонуемые с MFC. Начиная с Visual C++ версии 4.0, термин USRDLL устарел.

Обычная библиотека DLL MFC, статически компонуемые с MFC, необходимо соблюдать следующие требования:

- Этот тип из библиотеки DLL, необходимо создать экземпляр класса, производного от `CWinApp`.

- Этот тип DLL использует `DllMain` предоставляемая MFC. Поместите все DLL-специфичная код инициализации `InitInstance` члена функции и завершение кода в `ExitInstance` как обычного приложения MFC.

- Несмотря на то, что термин USRDLL устарел, по-прежнему необходимо определить "**макрос _USRDLL**» в командной строке компилятора. Это определение указывает, какие объявления должны выбираться из файлах заголовков MFC.

Обычные библиотеки DLL MFC должен иметь `CWinApp`-производный класс и один объект этого класса, как в приложении MFC. Тем не менее `CWinApp` объект библиотеки DLL не имеет цикла обработки сообщений, как `CWinApp` приложения.

Обратите внимание, что `CWinApp::Run` механизм не применяется к библиотеке DLL, так как приложение, которому принадлежит основной конвейер сообщений. Если библиотеки DLL открывает немодальные диалоговые окна или фрейма главного окна свои собственные, приложения главный цикл обработки сообщений должен вызывать процедуру, экспортировать DLL, в свою очередь вызывает `CWinApp::PreTranslateMessage` функция-член объекта приложения библиотеки DLL.

Пример этой функции ознакомьтесь с примером DLLScreenCap.

Символы обычно экспортируются из библиотеки DLL MFC, с использованием стандартного интерфейса C обычного. Объявление функции, экспортированные из обычной библиотеки DLL MFC будет выглядеть следующим образом:

```
extern "C" __declspec(dllexport) MyExportedFunction( );
```

Всех операций выделения памяти в обычной библиотеки DLL MFC должны оставаться в пределах DLL. библиотеки DLL не следует передавать или получать из вызывающего исполняемого файла из следующих:

- Указатели на объекты MFC

- Указатели на память, выделенную с MFC

Если вам нужно выполнять какие-либо из перечисленных выше или передавать объекты, производные от вызывающего исполняемого файла и библиотеки DLL, необходимо построить библиотеки DLL расширения MFC.

Можно безопасно передавать указатели памяти, выделенной с помощью библиотек времени выполнения C между приложением и библиотеки DLL только в том случае, если следует создать копию данных. Не должен удалить или изменить эти указатели или их использовать без создания копии памяти.

Библиотека DLL, статически компонуемые с MFC не может ссылаться на общих библиотек DLL MFC также динамически. Библиотека DLL, статически компонуемые с MFC, динамически связанной с приложения так же, как и любой другой DLL; приложение связывается с ней так же, как и любой другой DLL.

Стандартный статическая компоновка библиотеки MFC присваиваются в соответствии с соглашением, описанным в [соглашения об именовании библиотек DLL MFC](../mfc/mfc-library-versions.md#mfc-static-library-naming-conventions). Тем не менее с MFC версии 3.0 и более поздних, он больше не необходимо вручную указать компоновщику версии библиотеки MFC, нужные в. Вместо этого, файлах заголовков MFC автоматически определять определяет правильную версию библиотеки MFC на основе препроцессора, таких как  **\_Отладка** или **_UNICODE**. Файлы заголовков MFC добавьте/DEFAULTLIB директивы для связывания в определенную версию библиотеки MFC.

## <a name="what-do-you-want-to-do"></a>Выберите действие

- [Инициализация обычных библиотек DLL MFC](run-time-library-behavior.md#initializing-regular-dlls)

## <a name="what-do-you-want-to-know-more-about"></a>Дополнительные сведения

- [Использование MFC как часть библиотеки DLL](../mfc/tn011-using-mfc-as-part-of-a-dll.md)

- [Использование библиотек DLL расширений MFC для баз данных, OLE и сокетов в обычных DLL-библиотеках MFC](using-database-ole-and-sockets-extension-dlls-in-regular-dlls.md)

- [Создание библиотеки DLL MFC](../mfc/reference/mfc-dll-wizard.md)

- [Обычные DLL-библиотеки MFC, динамически связанные с MFC](regular-dlls-dynamically-linked-to-mfc.md)

- [Библиотеки DLL расширений MFC](extension-dlls-overview.md)

## <a name="see-also"></a>См. также

[Типы библиотек DLL](kinds-of-dlls.md)
