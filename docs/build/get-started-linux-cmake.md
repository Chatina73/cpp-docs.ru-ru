---
title: Создание кроссплатформенных проектов C++ в Visual Studio
description: Как настроить, компилировать и отладить проект C с открытым исходным кодом CMake в Visual Studio, который ориентирован как на Linux, так и на Windows.
ms.topic: tutorial
ms.date: 01/08/2020
ms.openlocfilehash: aac536f488cf22adf5aa835c9fe5b884fc5d7298
ms.sourcegitcommit: c123cc76bb2b6c5cde6f4c425ece420ac733bf70
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81328743"
---
# <a name="tutorial-create-c-cross-platform-projects-in-visual-studio"></a>Учебник: Создание кросс-платформенных проектов в Visual Studio

Разработка Visual Studio C и C++ теперь подходит не только для Windows. В этом учебнике показано, как использовать Visual Studio для разработки кросс-платформы на Windows и Linux. Он основан на CMake, так что вам не придется создавать или создавать проекты Visual Studio. При открытии папки, содержащей файл CMakeLists.txt, Visual Studio настраивает настройки IntelliSense и автоматически создает настройки. Вы можете быстро начать редактирование, создание и отладку кода локально в Windows. Затем переключите конфигурацию, чтобы сделать то же самое на Linux, все из Visual Studio.

В этом руководстве описано следующее:

> [!div class="checklist"]
>
> * Клонировать проект CMake с открытым кодом с сайта GitHub.
> * Открывать проект в Visual Studio.
> * Собирать и отлаживать исполняемый целевой объект на Windows.
> * Добавлять подключение к компьютеру Linux.
> * Собирать и отлаживать тот же целевой объект в Linux.

## <a name="prerequisites"></a>Предварительные требования

* Настройка Visual Studio для кроссплатформенной разработки на C++
  * Во-первых, [установите Visual Studio](https://visualstudio.microsoft.com/vs/) и выберите **разработку рабочего стола с** разработкой C и Linux с **рабочими нагрузками**. Эта минимальная установка составляет всего 3 ГБ. В зависимости от скорости загрузки, установка не должна занять более 10 минут.

* Настройка компьютера Linux для кроссплатформенной разработки на C++
  * Visual Studio не требует конкретный дистрибутив Linux. ОС может работать на физическом компьютере, в VM или в облаке. Вы также можете использовать подсистему Windows для Linux (WSL). Тем не менее, для этого учебника требуется графическая среда. WSL здесь не рекомендуется, так как предназначен в первую очередь для командных операций.
  * Visual Studio требует этих инструментов на машине Linux: компиляторы C-образного индекса, gdb, ssh, rsync, ниндзя и zip. В системах на основе Debian можно использовать эту команду для установки следующих зависимостей:

    ```cmd
    sudo apt install -y openssh-server build-essential gdb rsync ninja-build zip
    ```

  * Visual Studio требует сявречную версию CMake на машине Linux с включенным серверным режимом (по крайней мере 3.8). Корпорация Майкрософт предлагает универсальную сборку CMake, которую можно установить на любой дистрибутив Linux. Мы рекомендуем вам использовать эту сборку, чтобы убедиться, что у вас есть последние функции. Вы можете получить двоичные файлы CMake из [вилки Майкрософт репозитория CMake](https://github.com/Microsoft/CMake/releases) на сайте GitHub. Перейти на эту страницу и скачать версию, которая соответствует архитектуре системы на вашей машине Linux, а затем пометить его как исполняемый:

    ```cmd
    wget <path to binary>
    chmod +x cmake-3.11.18033000-MSVC_2-Linux-x86_64.sh
    ```

  * Вы увидите параметры для запуска скрипта с `-–help`. Мы рекомендуем вам `–prefix` использовать опцию для указания установки в **/usr** пути, потому что **/usr/bin** является местом по умолчанию, где Visual Studio ищет CMake. В следующем примере показан скрипт Linux x86_64. Измените его по мере необходимости, если вы используете другую целевую платформу.

    ```cmd
    sudo ./cmake-3.11.18033000-MSVC_2-Linux-x86_64.sh --skip-license --prefix=/usr
    ```

* Git для Windows, установленный на компьютере Windows.
* Учетная запись GitHub.

## <a name="clone-an-open-source-cmake-project-from-github"></a>Клонирование проекта CMake с открытым кодом с сайта GitHub

В этом учебнике используется SDK Пуля физики на GitHub. Он обеспечивает обнаружение столкновений и моделирование физики для многих приложений. SDK включает в себя примеры исполняемых программ, которые компилируются и запускаться без необходимости написания дополнительного кода. Этот учебник не изменяет ни исходный код, ни сценариев сборки. Для начала клонируйте репозиторий *bullet3* от GitHub на машине, где установлена Visual Studio.

```cmd
git clone https://github.com/bulletphysics/bullet3.git
```

1. В главном меню Visual Studio выберите **File > Open > CMake.** Перейдите к файлу CMakeLists.txt в корне репо bullet3, который вы только что скачали.

    ![Меню Visual Studio: Файл > Открыть > CMake](media/cmake-open-cmake.png)

    Как только вы открываете папку, структура папки становится видимой в **Solution Explorer**.

    ![Представление папки в обозревателе решений Visual Studio](media/cmake-bullet3-solution-explorer.png)

    В этом представлении показано, что фактически находится на диске. Это не логическое или отфильтрованное представление. По умолчанию оно не показывает скрытые файлы.

1. Выберите кнопку **Показать все файлы,** чтобы просмотреть все файлы в папке.

    ![Кнопка "Показать все файлы" в обозревателе решений Visual Studio](media/cmake-bullet3-show-all-files.png)

## <a name="switch-to-targets-view"></a>Переключение на представление целевых объектов

Когда вы откроете папку, которая использует CMake, Visual Studio автоматически создаст кэш CMake. Эта операция может занять некоторое время в зависимости от размера проекта.

1. В **окне вывода** выберите **Показать выходные данные из** и выберите **CMake** для отслеживания состояния процесса создания кэша. По завершении операции отображается надпись: "Извлечение сведений о целевом объекте выполнено".

   ![Окно вывода Visual Studio с выходными данными из CMake](media/cmake-bullet3-output-window.png)

   После завершения этой операции настроен IntelliSense. Вы можете построить проект и отладить приложение. Visual Studio теперь показывает логическое представление о решении, основанное на целевых показателях, указанных в файлах CMakeLists.

1. Нажмите кнопку **Решения и папки** в **обозревателе решений**, чтобы переключиться на представление целевых объектов CMake.

   ![Кнопка "Решения и папки" в обозревателе решений для вывода представления целевых объектов CMake](media/cmake-bullet3-show-targets.png)

   Вот как это представление выглядит для пакета SDK Bullet:

   ![Представление целевых объектов CMake в обозревателе решений](media/cmake-bullet3-targets-view.png)

   Представление целевых объектов обеспечивает более интуитивное отображение содержимого исходной базы. Вы увидите, что некоторые целевые объекты являются библиотеками, а другие — исполняемыми файлами.

1. Разверните узел в представлении целевых объектов CMake, чтобы просмотреть его файлы исходного кода, где бы эти файлы ни находились на диске.

## <a name="add-an-explicit-windows-x64-debug-configuration"></a>Добавление явной конфигурации Windows x64-Debug

Visual Studio создает конфигурацию **x64-Debug** по умолчанию для Windows. Конфигурации указывают Visual Studio, какую платформу она будет использовать для CMake. Конфигурация по умолчанию не представлена на диске. При явном добавлении конфигурации Visual Studio создает файл под названием *CMakeSettings.json.* Он заполняется настройками для всех указанных конфигураций.

1. Добавьте новую конфигурацию. Откройте выпадение **конфигурации** в панели инструментов и выберите **Конфигурации управления.**

   ![Раскрывающийся список управления конфигурациями](media/cmake-bullet3-manage-configurations.png)

   Открывается [редактор настроек CMake.](customize-cmake-settings.md) Выберите зеленый знак плюс на левой стороне редактора, чтобы добавить новую конфигурацию. Появляется конфигурация Добавления в диалог **CMakeSettings.**

   ![Диалоговое окно "Добавление конфигурации в CMakeSettings"](media/cmake-bullet3-add-configuration-x64-debug.png)

   В этом диалоге показаны все конфигурации, включенные в Visual Studio, а также любые пользовательские конфигурации, которые вы создаете. Если вы хотите продолжать использовать конфигурацию **x64-Debug,** это должно быть первым, который вы добавляете. Выберите **x64-Debug,** а затем выберите кнопку **«Выберите».** Visual Studio создает файл CMakeSettings.json с конфигурацией для **x64-Debug**и сохраняет его на диске. Вы можете назвать конфигурацию как угодно, изменив параметр имени непосредственно в CMakeSettings.json.

## <a name="set-a-breakpoint-build-and-run-on-windows"></a>Установите точку разрыва, сборку и запуск на Windows

На этом шаге нам предстоит отладить пример программы, демонстрирующий библиотеку Bullet Physics.
  
1. В **обозревателе решений** выберите AppBasicExampleGui и разверните его.

1. Откройте файл `BasicExample.cpp`.

1. Установите точку разрыва, которая получает удар при нажатии в запущенном приложении. Событие щелчка обрабатывается в методе внутри вспомогательного класса. Для быстрого перехода:

   1. Выберите, `CommonRigidBodyBase` из `BasicExample` которого происходит структура. Это около 30-й линии.

   1. Щелкните правой кнопкой мыши и выберите **Перейти к определению**. Теперь вы находитесь в заголовке CommonRigidBodyBase.h.

   1. В представлении браузера над вашим источником, вы `CommonRigidBodyBase`должны видеть, что вы находитесь в . Справа можно выбрать элементы для проверки. Откройте выпадение и `mouseButtonCallback` выберите, чтобы перейти к определению этой функции в заголовке.

      ![Панель инструментов со списком элементов Visual Studio](media/cmake-bullet3-member-list-toolbar.png)

1. Поместите точку останова на первой строке в этой функции. Он получает удар, когда вы нажимаете кнопку мыши в окне приложения, при запуске под Visual Studio отладчика.

1. Для запуска приложения выберите выпадение пуска в панели инструментов. Это тот, с зеленой иконкой воспроизведения, которая говорит: "Выберите элемент запуска". В падении выберите AppBasicExampleGui.exe. Имя исполняемого файла теперь отображается на кнопке запуска:

   ![Раскрывающийся список запуска на панели инструментов Visual Studio, "Выбрать элемент запуска"](media/cmake-bullet3-launch-button.png)

1. Выберите кнопку запуска для создания приложения и необходимых зависимостей, а затем запустите его с помощью отладчика Visual Studio. Через некоторое время появится работающее приложение:

   ![Отладка приложения Windows в Visual Studio](media/cmake-bullet3-launched.png)

1. Переместите указатель мыши в окно приложения, а затем нажмите кнопку для вызова точки останова. Точка разрыва возвращает Visual Studio на передний план, а редактор показывает строку, в которой приостанавливается выполнение. Вы можете проверить переменные приложения, объекты, потоки и память или пройти через код в интерактивном режиме. Выберите **Продолжить,** чтобы приложение возобновить, а затем выйти из него нормально. Или остановить выполнение в Visual Studio с помощью кнопки "Стоп".

## <a name="add-a-linux-configuration-and-connect-to-the-remote-machine"></a>Добавление конфигурации Linux и подключение к удаленному компьютеру

1. Добавьте конфигурацию Linux. Щелкните правой кнопкой мыши файл CMakeSettings.json в **обозревателе решений** и выберите **Добавить конфигурацию**. Вы увидите то же диалоговое окно "Добавление конфигурации в CMakeSettings", что и раньше. Выберите **Linux-Debug** на этот раз, а затем сохраните файл CMakeSettings.json (ctrl s).

1. Выберите **Linux-Debug** в падении конфигурации.

   ![Раскрывающийся список конфигурации запуска с вариантами X64-Debug и Linux-Debug](media/cmake-bullet3-linux-configuration-item.png)

   Если вы впервые подключаетесь к системе Linux, отображается диалог **Connect to Remote System.**

   ![Диалоговое окно "Подключение к удаленной системе" в Visual Studio](media/cmake-bullet3-connection-manager.png)

   Если вы уже добавили удаленное соединение, вы можете открыть это окно, перенаправившись в **> опций > Cross Platform > менеджера подключения.**

1. Предоставьте информацию о [подключении к вашей машине Linux](/cpp/linux/connect-to-your-remote-linux-computer) и выберите **Connect.** Visual Studio добавляет, что машина, как к CMakeSettings.json как подключение по умолчанию для **Linux-Debug**. Он также тянет вниз заголовки из удаленной машины, так что вы получите [IntelliSense специфичны для этого удаленного соединения.](/cpp/linux/configure-a-linux-project?view=vs-2019#remote_intellisense) Далее Visual Studio отправляет ваши файлы в пульт дистанционного управления и генерирует кэш CMake в удаленной системе. Эти шаги могут занять некоторое время, в зависимости от скорости вашей сети и мощности вашего удаленного аппарата. Вы будете знать, что это завершено, когда сообщение "Целевой объем извлечения информации сделано" появляется в окне вывода CMake.

## <a name="set-a-breakpoint-build-and-run-on-linux"></a>Установите точку разрыва, сборку и запуск на Linux

Поскольку это настольное приложение, необходимо предоставить некоторую дополнительную информацию о конфигурации конфигурации отладки.

1. В представлении CMake Targets, правой кнопкой мыши AppBasicExampleGui и выбрать **Настройки отнажатия и запуска,** чтобы открыть файл launch.vs.json, который в скрытом **.vs** subfolder. Этот локальный файл для среды разработки. Вы можете переместить его в корень проекта, если хотите проверить его и сохранить для своей команды. В этом файле была добавлена конфигурация для AppBasicExampleGui. Эти настройки по умолчанию работают в большинстве случаев, но не здесь. Поскольку это настольное приложение, необходимо предоставить дополнительную информацию для запуска программы, чтобы вы могли видеть ее на вашем компьютере Linux.

1. Чтобы найти значение переменной `DISPLAY` среды на вашей машине Linux, запустите эту команду:

   ```cmd
   echo $DISPLAY
   ```

   В конфигурации для AppBasicExampleGui есть параметр, "pipeArgs". Он содержит строку: "$'debuggerCommand". Это команда, которая запускает gdb на удаленной машине. Visual Studio должна экспортировать дисплей в этот контекст до запуска этой команды. Например, если значение дисплея, `:1`изменить эту строку следующим образом:

   ```cmd
   "export DISPLAY=:1;${debuggerCommand}",
   ```

1. Запуск и отладка приложения. Откройте выпадение **элемента запуска** в панели инструментов и выберите **AppBasicExampleGui.** Далее, либо выбрать зеленый значок воспроизведения в панели инструментов, или нажмите **F5**. Приложение и его зависимости построены на удаленной машине Linux, а затем запущен с Visual Studio отладчик прилагается. На удаленном компьютере Linux вы увидите окно приложения.

1. Переместите мышь в окно приложения и нажмите кнопку. Точка разрыва поражена. Выполнение программы приостанавливается, Visual Studio возвращается на передний план, и вы видите точку разрыва. Кроме того, вы увидите окно консоли Linux в Visual Studio. Окно обеспечивает выход из удаленной машины Linux, а `stdin`также может принимать входные данные для . Как и любое окно Visual Studio, вы можете пристыковаться туда, где вы предпочитаете его видеть. Его позиция сохраняется на будущих сессиях.

   ![Окно консоли Linux в Visual Studio](media/cmake-bullet3-linux-console.png)

1. Вы можете проверить переменные, объекты, потоки и память приложения и пошагово выполнить код с помощью Visual Studio. Но на этот раз вы делаете все это на удаленной машине Linux вместо локальной среды Windows. Вы можете выбрать **Продолжить,** чтобы приложение возобновить и выйти нормально, или вы можете выбрать кнопку остановки, так же, как с локальным исполнением.

1. Посмотрите на окно стека вызовов и увидите вызовы к `x11OpenGLWindow`, поскольку среда Visual Studio запустила приложение в Linux.

   ![Окно стека вызовов со стеком вызовов Linux](media/cmake-bullet3-linux-callstack.png)

## <a name="what-you-learned"></a>Чему вы научились

В этом уроке вы клонировали кодовую базу непосредственно с GitHub. Вы построили, запустили и отладили его на Windows без изменений. Затем вы использовали ту же базу кода, с незначительными изменениями конфигурации, для создания, запуска и отладки на удаленной машине Linux.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о настройке и отладке проектов CMake в Visual Studio:

> [!div class="nextstepaction"]
> [Проекты CMake в визуальной студии](cmake-projects-in-visual-studio.md)<br/><br/>
> [Настройка проекта Linux CMake](../linux/cmake-linux-project.md)<br/><br/>
> [Подключение к удаленному компьютеру Linux](../linux/connect-to-your-remote-linux-computer.md)<br/><br/>
> [Настройка параметров сборки CMake](customize-cmake-settings.md)<br/><br/>
> [Настройка сеансов отладки CMake](configure-cmake-debugging-sessions.md)<br/><br/>
> [Развертывание, запуск и отладка проекта Linux](../linux/deploy-run-and-debug-your-linux-project.md)<br/><br/>
> [Справочник по предопределенной конфигурации CMake](cmake-predefined-configuration-reference.md)
>
