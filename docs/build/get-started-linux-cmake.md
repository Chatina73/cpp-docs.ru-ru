---
title: Создание кроссплатформенных проектов C++ в Visual Studio
description: В этом учебнике показано, как настраивать, компилировать и отлаживать проект CMake с открытым исходным кодом C++ в Visual Studio, ориентированный на Linux и Windows.
author: mikeblome
ms.topic: tutorial
ms.date: 03/05/2019
ms.openlocfilehash: f184cc2ce3eaf3adcc936bd723019956b5b23dc9
ms.sourcegitcommit: da32511dd5baebe27451c0458a95f345144bd439
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/07/2019
ms.locfileid: "65220856"
---
# <a name="tutorial-create-c-cross-platform-projects-in-visual-studio"></a>Учебник. Создание кроссплатформенных проектов C++ в Visual Studio 

Разработка Visual Studio C и C++ теперь подходит не только для Windows. В этом учебнике показано, как использовать Visual Studio для кроссплатформенной разработки на C++ на базе CMake без необходимости создавать проекты Visual Studio. При открытии папки с файлом CMakeLists.txt Visual Studio настраивает IntelliSense и параметры сборки автоматически. Вы можете быстро редактировать, собирать и отлаживать код локально на Windows, а затем менять конфигурацию и делать то же самое в Linux, и все это в Visual Studio.

В этом руководстве вы узнаете, как:

> [!div class="checklist"]
> * Клонировать проект CMake с открытым кодом с сайта GitHub.
> * Открывать проект в Visual Studio. 
> * Собирать и отлаживать исполняемый целевой объект на Windows.
> * Добавлять подключение к компьютеру Linux.
> * Собирать и отлаживать тот же целевой объект в Linux.

## <a name="prerequisites"></a>Предварительные требования

- Настройка Visual Studio для кроссплатформенной разработки на C++
    - Во-первых, вам нужно [установить Visual Studio](https://visualstudio.microsoft.com/vs/). Затем убедитесь, что у вас установлены рабочие нагрузки **Разработка классических приложений на C++** и **Разработка для Linux на C++**. Это минимальная установка имеет объем всего 3 ГБ, и в зависимости от скорости загрузки установка не должна занять более 10 минут.
- Настройка компьютера Linux для кроссплатформенной разработки на C++
    - Visual Studio не требует конкретный дистрибутив Linux. Операционная система может выполняться на физическом компьютере, в виртуальной машине, облачной службе или подсистеме Windows для Linux (WSL). Тем не менее для этого учебника требуется графическая среда, поэтому WSL не рекомендуется, так как она предназначена главным образом для операций из командной строки.
    - Ниже приведены средства, которые требуются Visual Studio на компьютере Linux: Компиляторы C++, GDB, ssh и zip. В системах на основе Debian можно установить эти зависимости следующим образом.
    
    ```cmd
        sudo apt install -y openssh-server build-essential gdb zip
    ```
    - Visual Studio требует наличия последней версии CMake с включенным режимом сервера (по крайней мере 3.8) на компьютере Linux. Корпорация Майкрософт предлагает универсальную сборку CMake, которую можно установить на любой дистрибутив Linux. Мы рекомендуем использовать эту сборку, чтобы у вас были самые новые функции. Вы можете получить двоичные файлы CMake из [вилки Майкрософт репозитория CMake](https://github.com/Microsoft/CMake/releases) на сайте GitHub. Перейдите на эту страницу и загрузите версию, соответствующую архитектуре вашей системы на компьютере Linux, а затем пометьте ее как исполняемый файл:
    
    ```cmd
        wget <path to binary>
        chmod +x cmake-3.11.18033000-MSVC_2-Linux-x86_64.sh
    ```
    - Вы увидите параметры для запуска скрипта с `-–help`. Мы рекомендуем использовать параметр `–prefix`, чтобы указать установку в пути **/usr/local**, потому что это расположение по умолчанию, где Visual Studio выполняет поиск CMake. В следующем примере показан скрипт Linux x86_64. Измените этот параметр на нужный, если вы используете другую целевую платформу. 
    
    ```cmd
        sudo ./cmake-3.11.18033000-MSVC_2-Linux-x86_64.sh --skip-license --prefix=/usr/local
    ```
- Git для Windows, установленный на компьютере Windows.
- Учетная запись GitHub.

## <a name="clone-an-open-source-cmake-project-from-github"></a>Клонирование проекта CMake с открытым кодом с сайта GitHub

В этом учебнике используется пакет SDK Bullet Physics на GitHub, который позволяет обнаруживать столкновения и предоставляет физические симуляции для различных приложений. Он включает примеры исполняемых программ, которые компилируются и запускаются без дополнительного кода. В этом учебнике не изменяются исходный код или скрипты сборки. Для начала клонируйте репозиторий bullet3 из GitHub на компьютер, где установлена среда Visual Studio. 

```cmd

git clone https://github.com/bulletphysics/bullet3.git

```

1. В главном меню Visual Studio выберите **Файл > Открыть > CMake** и перейдите к файлу CMakeLists.txt в корне репозитория bullet3, который вы только что загрузили.

    ![Меню Visual Studio: Файл > Открыть > CMake](media/cmake-open-cmake.png)

    Когда вы откроете эту папку, структура папок будет отображаться в **обозревателе решений**.

    ![Представление папки в обозревателе решений Visual Studio](media/cmake-bullet3-solution-explorer.png)

    В этом представлении показано, что фактически находится на диске. Это не логическое или отфильтрованное представление. По умолчанию оно не показывает скрытые файлы. 

2. Нажмите кнопку **Показать все файлы**, чтобы просмотреть полный список файлов в папке.

    ![Кнопка "Показать все файлы" в обозревателе решений Visual Studio](media/cmake-bullet3-show-all-files.png)

## <a name="switch-to-targets-view"></a>Переключение на представление целевых объектов

Когда вы откроете папку, которая использует CMake, Visual Studio автоматически создаст кэш CMake. Эта операция может занять некоторое время в зависимости от размера проекта. 

1. В **окне вывода** выберите **Показать выходные данные из** и выберите **CMake** для отслеживания состояния процесса создания кэша. По завершении операции отображается надпись: "Извлечение сведений о целевом объекте выполнено".

    ![Окно вывода Visual Studio с выходными данными из CMake](media/cmake-bullet3-output-window.png)

    После завершения операции IntelliSense будет настроен, и вы можете собрать проект и отлаживать приложение. Visual Studio теперь может предоставлять логическое представление решения, основанное на целевых объектах, заданных в файлах CMakeLists. 

2. Нажмите кнопку **Решения и папки** в **обозревателе решений**, чтобы переключиться на представление целевых объектов CMake.

    ![Кнопка "Решения и папки" в обозревателе решений для вывода представления целевых объектов CMake](media/cmake-bullet3-show-targets.png)

    Вот как это представление выглядит для пакета SDK Bullet:

    ![Представление целевых объектов CMake в обозревателе решений](media/cmake-bullet3-targets-view.png)

    Представление целевых объектов обеспечивает более интуитивное отображение содержимого исходной базы. Вы увидите, что некоторые целевые объекты являются библиотеками, а другие — исполняемыми файлами. 

3. Разверните узел в представлении целевых объектов CMake, чтобы просмотреть его файлы исходного кода, где бы эти файлы ни находились на диске.

## <a name="set-a-breakpoint-build-and-run"></a>Установка точки останова, сборка и запуск

На этом шаге нам предстоит отладить пример программы, демонстрирующий библиотеку Bullet Physics.
  
1. В **обозревателе решений** выберите AppBasicExampleGui и разверните его. 
1. Откройте файл `BasicExample.cpp`. 
1. Задайте точку останова, которая будет достигнута при щелчке кнопки в работающем приложении. Событие щелчка обрабатывается в методе внутри вспомогательного класса. Для быстрого перехода:

    1. Выберите `CommonRigidBodyBase`, из которого происходит структура `BasicExample`, около строки 30.
    1. Щелкните правой кнопкой мыши и выберите **Перейти к определению**. Вы находитесь в заголовке CommonRigidBodyBase.h. 
    1. В представлении браузера выше вы увидите, что находитесь в `CommonRigidBodyBase`. Справа можно выбрать элементы для проверки. Щелкните раскрывающийся список и выберите `mouseButtonCallback`, чтобы перейти к определению функции в заголовке.

        ![Панель инструментов со списком элементов Visual Studio](media/cmake-bullet3-member-list-toolbar.png)

1. Поместите точку останова на первой строке в этой функции. Она будет достигнута при нажатии кнопки мыши в окне приложения при запуске в отладчике Visual Studio.

1. Для запуска приложения выберите раскрывающийся список запуска со значком воспроизведения с текстом "Выбрать элемент запуска" на панели инструментов. В раскрывающемся списке выберите AppBasicExampleGui.exe. Имя исполняемого файла теперь отображается на кнопке запуска:

    ![Раскрывающийся список запуска на панели инструментов Visual Studio, "Выбрать элемент запуска"](media/cmake-bullet3-launch-button.png)

5.  Нажмите кнопку запуска, чтобы собрать приложение и необходимые зависимости, а затем запустите его с подключенным отладчиком Visual Studio. Через некоторое время появится работающее приложение:

    ![Отладка приложения Windows в Visual Studio](media/cmake-bullet3-launched.png)

6. Переместите указатель мыши в окно приложения, а затем нажмите кнопку для вызова точки останова. Visual Studio снова перейдет на передний план с редактором, в котором отображается строка, где выполнение приостановлено. Вы сможете просмотреть переменные, объекты, потоки и память приложения. Вам доступно пошаговое выполнение кода в интерактивном режиме. Нажмите **Продолжить**, чтобы приложение возобновило работу, выйдите из него обычным образом или прекратите выполнение в Visual Studio с помощью кнопки остановки.

## <a name="add-an-explicit-windows-x64-debug-configuration"></a>Добавление явной конфигурации Windows x64-Debug

На данный момент вы используете конфигурацию по умолчанию **x64-Debug** для Windows. Конфигурации указывают Visual Studio, какую платформу она будет использовать для CMake. Конфигурация по умолчанию не представлена на диске. Когда вы явным образом добавляете конфигурацию, Visual Studio создает файл с именем CMakeSettings.json, который заполняется с помощью параметров для всех конфигураций, которые вы указали. 

1. Добавьте новую конфигурацию, щелкнув раскрывающийся список конфигурации на панели инструментов и выбрав **Управление конфигурациями...**

    ![Раскрывающийся список управления конфигурациями](media/cmake-bullet3-manage-configurations.png)

    Откроется диалоговое окно **Добавление конфигурации в CMakeSettings**.

    ![Диалоговое окно "Добавление конфигурации в CMakeSettings"](media/cmake-bullet3-add-configuration-x64-debug.png)

    Это диалоговое окно показывает все конфигурации, которые входят в состав Visual Studio, а также все созданные вами пользовательские конфигурации. Если вы хотите продолжать использовать конфигурацию по умолчанию **x64-Debug**, добавьте ее в первую очередь. Если вы добавите эту конфигурацию, вы сможете переключаться между конфигурациями Windows и Linux. Выберите **x64-Debug** и нажмите **Выбрать**. Будет создан файл CMakeSettings.json с конфигурацией для **x64-Debug**, и Visual Studio переключится на использование этой конфигурации вместо значения по умолчанию. В имени раскрывающегося списка конфигураций больше не будет указано, что это конфигурация по умолчанию. Вы можете назвать конфигурацию как угодно, изменив параметр имени непосредственно в CMakeSettings.json.

##  <a name="add-a-linux-configuration-and-connect-to-the-remote-machine"></a>Добавление конфигурации Linux и подключение к удаленному компьютеру

1. Теперь добавьте конфигурацию Linux. Щелкните правой кнопкой мыши файл CMakeSettings.json в **обозревателе решений** и выберите **Добавить конфигурацию**. Вы увидите то же диалоговое окно "Добавление конфигурации в CMakeSettings", что и раньше. На этот раз выберите **Linux-Debug**, а затем сохраните файл CMakeSettings.json. 
2. Теперь выберите **Linux-Debug** в раскрывающемся списке конфигураций.

    ![Раскрывающийся список конфигурации запуска с вариантами X64-Debug и Linux-Debug](media/cmake-bullet3-linux-configuration-item.png)

    Если это первое подключение к системе Linux, откроется диалоговое окно **Подключение к удаленной системе**.

    ![Диалоговое окно "Подключение к удаленной системе" в Visual Studio](media/cmake-bullet3-connection-manager.png)

    Если вы уже добавили удаленное подключение, вы можете открыть это окно в разделе **Сервис > Параметры > Кроссплатформенный > Диспетчер подключений**.
 
3. Укажите сведения о подключении к компьютеру Linux и нажмите **Подключить**. Visual Studio добавляет этот компьютер в CMakeSettings.json как компьютер по умолчанию для **Linux-Debug**. Он также извлекает заголовки из удаленного компьютера, чтобы вы могли получить IntelliSense специально для этого компьютера при его использовании. Теперь Visual Studio будет отправлять файлы на удаленный компьютер, а затем создаст там кэш CMake, а после этого Visual Studio будет настроен для использования той же исходной базы с этим удаленным компьютером Linux. Эти действия могут занять некоторое время в зависимости от скорости сети и мощности удаленного компьютера. Вы узнаете, что операция завершена, когда в окне вывода CMake появится сообщение: "Извлечение сведений о целевом объекте выполнено".

## <a name="set-a-breakpoint-build-and-run-on-linux"></a>Установка точки останова, сборка и запуск в Linux

Так как это классическое приложение, необходимо предоставить некоторые дополнительные сведения о конфигурации для конфигурации отладки. 

1. В представлении целевых объектов CMake щелкните правой кнопкой мыши AppBasicExampleGui и выберите **Параметры отладки и запуска**, чтобы открыть файл launch.vs.json, который находится в скрытой вложенной папке **.vs**. Этот локальный файл для среды разработки. Вы можете переместить его в корень проекта, если хотите проверить его и сохранить для своей команды. В этот файл была добавлена конфигурация для AppBasicExampleGui. Эти параметры по умолчанию работают в большинстве случаев, но так как это классическое приложение, необходимо предоставить некоторые дополнительные сведения, чтобы запустить программу и увидеть ее на компьютере Linux. 
2. Вам необходимо знать значение переменной среды `DISPLAY` на компьютере Linux, поэтому выполните следующую команду, чтобы получить его.

    ```cmd
    echo $DISPLAY
    ```

    В конфигурации для AppBasicExampleGui существует массив параметров "pipeArgs". В нем есть строка "${debuggerCommand}". Это команда, которая запускает gdb на удаленном компьютере. Visual Studio необходимо экспортировать соответствующие элементы в этот контекст перед выполнением этой команды. Например, если значение экрана: 1, измените эту строку следующим образом:

    ```cmd
    "export DISPLAY=:1;${debuggerCommand}",
    ```
3. Теперь для запуска и отладки приложения выберите раскрывающийся список **Выбрать элемент запуска** на панели инструментов и выберите AppBasicExampleGui. Теперь нажмите эту кнопку или **F5**. Приложение и его зависимости будут собраны на удаленном компьютере Linux. Запустите приложение с подключенным отладчиком Visual Studio. На удаленном компьютере Linux вы увидите окно приложения.

4. Переместите указатель мыши в окно приложения и нажмите кнопку для вызова точки останова. Выполнение программы приостанавливается, Visual Studio возвращается на передний план, вы оказываетесь в точке останова. Кроме того, вы увидите окно консоли Linux в Visual Studio. Это окно предоставляет выходные данные с удаленного компьютера Linux, а также может принимать входные данные для `stdin`. Как и любое окно Visual Studio, его можно закрепить в любом месте, и его положение сохранится в будущих сеансах.

    ![Окно консоли Linux в Visual Studio](media/cmake-bullet3-linux-console.png)

5. Вы можете проверить переменные, объекты, потоки и память приложения и пошагово выполнить код с помощью Visual Studio. Но на этот раз вы выполняете все это на удаленном компьютере Linux вместо локальной среды Windows. Нажмите **Продолжить**, чтобы приложение возобновило работу, выйдите из него обычным образом или нажмите кнопку остановки, как и при локальном выполнении.

6. Посмотрите на окно стека вызовов и увидите вызовы к `x11OpenGLWindow`, поскольку среда Visual Studio запустила приложение в Linux.

    ![Окно стека вызовов со стеком вызовов Linux](media/cmake-bullet3-linux-callstack.png)

## <a name="what-you-learned"></a>Чему вы научились 

В этом учебнике вы узнали, как код, клонированный непосредственно из GitHub, можно собирать, запускать и отлаживать в Windows без изменений. Эта же самая база кода, с незначительными изменениями конфигурации, была собрана, запущена и отлажена на удаленном компьютере Linux. 

## <a name="next-steps"></a>Следующие шаги

Дополнительные сведения о настройке и отладке проектов CMake в Visual Studio:

> [!div class="nextstepaction"]
> [Проекты CMake в Visual Studio](cmake-projects-in-visual-studio.md)<br/><br/>
> [Настройка проекта Linux CMake](../linux/cmake-linux-project.md)<br/><br/>
> [Подключение к удаленному компьютеру Linux](../linux/connect-to-your-remote-linux-computer.md)<br/><br/>
> [Настройка параметров сборки CMake](customize-cmake-settings.md)<br/><br/>
> [Настройка сеансов отладки CMake](configure-cmake-debugging-sessions.md)<br/><br/>
> [Развертывание, запуск и отладка проекта Linux](../linux/deploy-run-and-debug-your-linux-project.md)<br/><br/>
> [Справочник по предопределенной конфигурации CMake](cmake-predefined-configuration-reference.md)
> 
