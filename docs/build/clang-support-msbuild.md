---
description: 'Подробнее о следующем: Поддержка Clang и LLVM в проектах Visual Studio'
title: Поддержка Clang и LLVM в проектах Visual Studio
ms.date: 02/05/2021
ms.description: Configure a Visual Studio MSBuild project to use the Clang/LLVM toolchain.
helpviewer_keywords:
- Clang support for C++ MSBuild projects
ms.openlocfilehash: 31f79280e51bcf277bd3a992c4d7d2e39e679f30
ms.sourcegitcommit: c0c9cdae79f19655e809a4979227c51bb19cff63
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/05/2021
ms.locfileid: "102236625"
---
# <a name="clangllvm-support-in-visual-studio-projects"></a>Поддержка Clang и LLVM в проектах Visual Studio

::: moniker range="<=msvc-150"

В Visual Studio 2019 доступна поддержка Clang для проектов CMake и MSBuild.

::: moniker-end

::: moniker range="msvc-160"

Visual Studio 2019 версии 16.2 и более поздних версий с Clang можно использовать для изменения, сборки и отладки проектов Visual Studio на C++ (MSBuild), предназначенных для Windows или Linux.

## <a name="install"></a>Установка

Для лучшей поддержки интегрированной среды разработки в Visual Studio рекомендуется использовать новейшие средства компилятора Clang для Windows. Если они еще не установлены, их можно установить, открыв Visual Studio Installer и выбрав **Средства C++ Clang для Windows** в разделе дополнительных компонентов **Разработка классических приложений на C++** . Если вы предпочитаете использовать существующую установку Clang на компьютере, выберите необязательный компонент **Средства сборки C++ Clang-cl для версии 142**. .

Для стандартной библиотеки Microsoft C++ требуется по крайней мере Clang 8.0.0.

![Снимок экрана: установщик Visual Studio с выбранной вкладкой "Отдельные компоненты" и видимыми компонентами "С++ Clang".](media/clang-install-vs2019.png)

В позднейших версиях Visual Studio предоставляются более новые версии набора инструментов Clang. Пакетная версия Clang обновляется автоматически, чтобы оставаться актуальной с учетом обновлений в реализации стандартной библиотеки Майкрософт. Например, Visual Studio 2019 версии 16.9 включает Clang версии 11.

## <a name="configure-a-windows-project-to-use-clang-tools"></a>Настройка проекта Windows для использования средств Clang

Чтобы настроить использование Clang в проекте Visual Studio, в **обозревателе решений** щелкните узел проекта правой кнопкой мыши и выберите пункт **Свойства**. Как правило, сначала следует выбрать элемент **Все конфигурации** в верхней части диалогового окна. Затем в разделе **Общие** > **Набор инструментов платформы** выберите **LLVM (clang-cl)** и нажмите кнопку **ОК**.

![Снимок экрана: диалоговое окно "Страницы свойств" с открытым разделом "Свойства конфигурации" > "Общие" и выделенными пунктами "Набор средств платформы" и "LLVM (clang-cl)".](media/clang-msbuild-prop-page.png)

Если вы используете средства Clang, входящие в состав Visual Studio, никаких дополнительных действий не требуется. Для проектов Windows программа Visual Studio по умолчанию вызывает Clang в режиме [clang-cl](https://llvm.org/devmtg/2014-04/PDFs/Talks/clang-cl.pdf). Он связывается с реализацией стандартной библиотеки Майкрософт. По умолчанию **clang-cl.exe** находится в каталогах *%VCINSTALLDIR%\\Tools\\Llvm\\bin\\* и *%VCINSTALLDIR%\\Tools\\Llvm\\x64\\bin\\* .

Если используется настраиваемая установка Clang, можно изменить свойство **Проект** > **Свойства** > **Каталоги VC++**  > **Свойства конфигурации** > **Каталоги исполняемых файлов**, добавив корневой каталог настраиваемой установки Clang в качестве первого каталога, или изменить значение свойства `LLVMInstallDir`. Дополнительные сведения см. в разделе [Задание настраиваемого расположения LLVM](#custom_llvm_location).

## <a name="configure-a-linux-project-to-use-clang-tools"></a>Настройка проекта Linux для использования средств Clang

Для проектов Linux среда Visual Studio использует интерфейс, совместимый с Clang GCC. Свойства проекта и почти все флаги компилятора идентичны.

Чтобы настроить использование Clang в проекте Visual Studio для Linux, выполните указанные ниже действия.

1. Щелкните правой кнопкой мыши узел проекта в **обозревателе решений** и выберите пункт **Свойства**.
1. Как правило, сначала следует выбрать элемент **Все конфигурации** в верхней части диалогового окна.
1. В разделе **Общие** > **Набор инструментов платформы** выберите **WSL_Clang_1_0**, если вы используете подсистему Windows для Linux (WSL). Выберите **Remote_Clang_1_0**, если вы используете удаленный компьютер или виртуальную машину.
1. Нажмите кнопку **ОК**.

![Снимок экрана: диалоговое окно "Страницы свойств ConsoleApp_clang_vs2019" с открытым разделом "Свойства конфигурации" > "Общие" и выделенными пунктами "Набор средств платформы" и "LLVM (clang-cl)".](media/clang-msbuild-prop-page.png)

В Linux среда Visual Studio по умолчанию использует первое расположение Clang, которое встречается в свойстве среды PATH. Если используется настраиваемая установка Clang, измените значение свойства `LLVMInstallDir` или подставьте путь в свойстве **Проект** > **Свойства** > **Свойства конфигурации** > **Каталоги VC++**  > **Каталоги исполняемых файлов**. Дополнительные сведения см. в разделе [Задание настраиваемого расположения LLVM](#custom_llvm_location).

## <a name="set-a-custom-llvm-location"></a><a name="custom_llvm_location"></a> Задание настраиваемого расположения LLVM

Можно задать настраиваемый путь к LLVM для одного или нескольких проектов, создав файл *Directory.build.props*. Затем добавьте этот файл в корневую папку любого проекта. Его можно добавить в корневую папку решения, чтобы применить его ко всем проектам в решении. Файл должен выглядеть следующим образом (только с фактическим путем LLVM):

```xml
<Project>
  <PropertyGroup>
    <LLVMInstallDir>C:\MyLLVMRootDir</LLVMInstallDir>
  </PropertyGroup>
</Project>
```

Это свойство можно объединить с пользовательской версией набора инструментов LLVM. Дополнительные сведения см. в разделе [Установка пользовательской версии набора инструментов LLVM](#custom_llvm_toolset).

## <a name="set-a-custom-llvm-toolset-version"></a><a name="custom_llvm_toolset"></a> Задание пользовательской версии набора инструментов LLVM

Начиная с Visual Studio 2019 версии 16.9, можно задать пользовательскую версию набора инструментов для LLVM. Чтобы задать это свойство в проекте в Visual Studio, выполните следующие действия:

1. Откройте диалоговое окно **Страницы свойств** проекта. Подробнее см. в статье [Настройка компилятора C++ и свойства сборки в Visual Studio](./working-with-project-properties.md).

1. Перейдите на страницу свойств **Свойства конфигурации** > **Общие**.

1. Измените значение свойства **Набор инструментов платформы** на *LLVM (clang-cl)* , если оно еще не задано.

1. Перейдите на страницу свойств **Свойства конфигурации** > **Расширенные**.

1. Измените свойство **Версия инструментов LLVM** на предпочитаемую версию, а затем нажмите кнопку **ОК**, чтобы сохранить изменения.

Свойство **Версия набора инструментов LLVM** отображается только при выборе набора инструментов платформы LLVM.

Версию набора инструментов можно задать для одного или нескольких проектов, создав файл *Directory.build.props*. Затем добавьте этот файл в корневую папку любого проекта. Добавьте его в корневую папку решения, чтобы применить его ко всем проектам в решении. Файл должен выглядеть следующим образом (только с фактическим путем LLVM):

```xml
<Project>
  <PropertyGroup>
    <LLVMToolsVersion>11.0.0</LLVMToolsVersion>
  </PropertyGroup>
</Project>
```

Это свойство также можно объединить с пользовательским расположением LLVM. Например, файл *Directory.build.props* может выглядеть следующим образом:

```xml
<Project>
  <PropertyGroup>
    <LLVMInstallDir>C:\MyLLVMRootDir</LLVMInstallDir>
    <LLVMToolsVersion>11.0.0</LLVMToolsVersion>
  </PropertyGroup>
</Project>
```

При добавлении файла *Directory.build.props* параметры отображаются по умолчанию в диалоговом окне страницы свойств проекта. Однако при изменении этих свойств в Visual Studio они переопределяют параметры в файле *Directory.build.props*.

## <a name="set-additional-properties-edit-build-and-debug"></a>Настройка дополнительных свойств, изменение, сборка и отладка

После настройки конфигурации Clang снова щелкните правой кнопкой мыши узел проекта и выберите пункт **Перезагрузить проект**. Теперь можно выполнять сборку и отладку проекта с помощью средств Clang. Visual Studio обнаруживает, что используется компилятор Clang, и предоставляет IntelliSense, выделение, навигацию и другие функции редактирования. Ошибки и предупреждения отображаются в **окне вывода**. Страницы свойств проекта для конфигурации Clang похожи на параметры для MSVC. Однако некоторые зависящие от компилятора функции, такие как "Изменить и продолжить", недоступны для конфигураций Clang. Можно задать компилятор Clang или параметр компоновщика, который недоступен на страницах свойств. Добавьте его вручную на страницах свойств в разделе **Свойства конфигурации** > **C/ C++ (или "Компоновщик")**  > **Командная строка** > **Дополнительные параметры**.

При отладке можно использовать точки останова, память и визуализацию данных, а также большинство других функций отладки.  

![Отладка Clang](media/clang-debug-msbuild.png)

::: moniker-end
