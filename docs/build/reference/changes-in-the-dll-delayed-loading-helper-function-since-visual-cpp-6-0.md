---
title: Изменения вспомогательной функции отложенной загрузки библиотек DLL по сравнению с Visual C++ версии 6.0
ms.date: 11/04/2016
helpviewer_keywords:
- delayed loading of DLLs, what's changed
- PFromRva method
- __delayLoadHelper2 function
- helper functions, what's changed
ms.assetid: 99f0be69-105d-49ba-8dd5-3be7939c0c72
ms.openlocfilehash: 536729e27c89d068957ea451355957e4a35348ee
ms.sourcegitcommit: c123cc76bb2b6c5cde6f4c425ece420ac733bf70
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81320612"
---
# <a name="changes-in-the-dll-delayed-loading-helper-function-since-visual-c-60"></a>Изменения вспомогательной функции отложенной загрузки библиотек DLL по сравнению с Visual C++ версии 6.0

Если на вашем компьютере есть несколько версий Visual C, или если вы определили собственную функцию помощника, на вас могут повлиять изменения, внесенные в функцию помощника по загрузке DLL. Пример:

- **__delayLoadHelper** сейчас **__delayLoadHelper2**

- **__pfnDliNotifyHook** сейчас **__pfnDliNotifyHook2**

- **__pfnDliFailureHook** теперь **__pfnDliFailureHook2**

- **__FUnloadDelayLoadedDLL** теперь **__FUnloadDelayLoadedDLL2**

> [!NOTE]
> Если вы используете функцию помощника по умолчанию, эти изменения не повлияют на вас. Нет никаких изменений относительно того, как вы вызываете linker.

## <a name="multiple-versions-of-visual-c"></a>Несколько версий визуального C

Если у вас есть несколько версий Visual C ' на вашем компьютере, убедитесь, что связующий соответствует delayimp.lib. Если есть несоответствие, вы получите ссылка `___delayLoadHelper2@8` `___delayLoadHelper@8` ошибка отчетности либо или в качестве нерешенного внешнего символа. Первый подразумевает новый связующий со старым delayimp.lib, а второй подразумевает старый связующий с новым delayimp.lib.

Если вы получаете неразрешенную ошибку связующего, запустите [dumpbin /linkermember](linkermember.md):1 на delayimp.lib, который вы ожидаете содержать функцию помощника, чтобы увидеть, какая функция помощника определяется вместо этого. Функция помощника также может быть определена в файле объекта; запустить [dumpbin /символы](symbols.md) и искать `delayLoadHelper(2)`.

Если вы знаете, что у вас есть связующее звено Visual C'6.0, то:

- Выполнить dumpbin на задержке нагрузки помощника .lib или .obj файл, чтобы определить, является ли он определяет **__delayLoadHelper2.** В противном случае ссылка выйдет из строя.

- Определите **__delayLoadHelper** в файле .lib или .obj.obj.obj.

## <a name="user-defined-helper-function"></a>Функция помощника пользователя

Если вы определили свою собственную функцию помощника и используете текущую версию Visual C , сделайте следующее:

- Переименуй функцию помощника в **__delayLoadHelper2.**

- Так как указатели в дескрипторе задержки (ImgDelayDescr in delayimp.h) были изменены с абсолютных адресов (VAs) на относительные адреса (RVAs) для работы, как ожидалось, как ожидается, как в 32- и 64-битных программах, необходимо преобразовать их обратно в указатели. Введена новая функция: PFromRva, найденная в delayhlp.cpp. Эту функцию можно использовать на каждом из полей дескриптора, чтобы преобразовать их обратно в 32- или 64-битные указатели. Функция помощи задержки по умолчанию продолжает оставаться хорошим шаблоном для использования в качестве примера.

## <a name="load-all-imports-for-a-delay-loaded-dll"></a>Загрузите все импорты для Загруженного DLL с задержкой

Связующее звено может загрузить весь импорт из DLL, указанный вами для загрузки задержки. Для [получения](loading-all-imports-for-a-delay-loaded-dll.md) дополнительной информации см.

## <a name="see-also"></a>См. также раздел

[Понимание функции помощника](understanding-the-helper-function.md)
