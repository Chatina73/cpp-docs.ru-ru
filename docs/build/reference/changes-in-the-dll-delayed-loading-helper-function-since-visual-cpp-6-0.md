---
description: 'Дополнительные сведения: изменения в вспомогательной функции отложенной загрузки DLL с момента Visual C++ 6,0'
title: Изменения вспомогательной функции отложенной загрузки библиотек DLL по сравнению с Visual C++ версии 6.0
ms.date: 11/04/2016
helpviewer_keywords:
- delayed loading of DLLs, what's changed
- PFromRva method
- __delayLoadHelper2 function
- helper functions, what's changed
ms.assetid: 99f0be69-105d-49ba-8dd5-3be7939c0c72
ms.openlocfilehash: 0141467aab0b804cf82d21c15510d8f9941853a6
ms.sourcegitcommit: d6af41e42699628c3e2e6063ec7b03931a49a098
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2020
ms.locfileid: "97182493"
---
# <a name="changes-in-the-dll-delayed-loading-helper-function-since-visual-c-60"></a>Изменения вспомогательной функции отложенной загрузки библиотек DLL по сравнению с Visual C++ версии 6.0

Если на компьютере установлено несколько версий Visual C++ или если вы определили собственную вспомогательную функцию, изменения, внесенные в вспомогательную функцию отложенной загрузки DLL, могут быть затронуты. Пример:

- **__delayLoadHelper** теперь **__delayLoadHelper2**

- **__pfnDliNotifyHook** теперь **__pfnDliNotifyHook2**

- **__pfnDliFailureHook** теперь **__pfnDliFailureHook2**

- **__FUnloadDelayLoadedDLL** теперь **__FUnloadDelayLoadedDLL2**

> [!NOTE]
> Если вы используете вспомогательную функцию по умолчанию, эти изменения не будут влиять на вас. Нет изменений, касающихся того, как вы вызываете компоновщик.

## <a name="multiple-versions-of-visual-c"></a>Несколько версий Visual C++

Если на компьютере установлено несколько версий Visual C++, убедитесь, что компоновщик соответствует делайимп. lib. В случае несоответствия вы получите сообщение об ошибке компоновщика, сообщающее `___delayLoadHelper2@8` либо `___delayLoadHelper@8` как неразрешенный внешний символ. Первое подразумевает новый компоновщик со старым делайимп. lib, а второй — старый компоновщик с новой делайимп. lib.

При получении неразрешенной ошибки компоновщика запустите [dumpbin/линкермембер](linkermember.md): 1 в делайимп. lib, который предполагается включить в вспомогательную функцию, чтобы увидеть, какая вспомогательная функция определена. Вспомогательная функция также может быть определена в объектном файле. Запустите [dumpbin/Symbols](symbols.md) и найдите `delayLoadHelper(2)` .

Если вы уверены, что у вас есть компоновщик Visual C++ 6,0, то:

- Запустите DUMPBIN в файле. lib или OBJ вспомогательной программы отложенной загрузки, чтобы определить, определяет ли он **__delayLoadHelper2**. В противном случае произойдет сбой связи.

- Определите **__delayLoadHelper** в lib-или OBJ-файле вспомогательного приложения для отложенной загрузки.

## <a name="user-defined-helper-function"></a>Вспомогательная функция User-Defined

Если вы определили собственную вспомогательную функцию и используете текущую версию Visual C++, выполните следующие действия.

- Переименуйте вспомогательную функцию в **__delayLoadHelper2**.

- Поскольку указатели в дескрипторе задержки (Имгделайдескр в делайимп. h) были изменены с абсолютных адресов (VAs) на относительные адреса (RVA) для работы в 32-и 64-разрядных программах, их необходимо преобразовать обратно в указатели. Появилась новая функция: Пфромрва, найденная в делайхлп. cpp. Эту функцию можно использовать для каждого поля в дескрипторе, чтобы преобразовать их обратно в 32 или 64-разрядные указатели. Вспомогательная функция отложенной загрузки по умолчанию остается хорошим шаблоном для использования в качестве примера.

## <a name="load-all-imports-for-a-delay-loaded-dll"></a>Загрузка всех импортов для Delay-Loaded DLL

Компоновщик может загрузить все импорты из библиотеки DLL, которую вы указали для загрузки с задержкой. Дополнительные сведения см. [в разделе Загрузка всех импортов для Delay-Loaded DLL](loading-all-imports-for-a-delay-loaded-dll.md) .

## <a name="see-also"></a>См. также раздел

[Основные сведения о вспомогательной функции](understanding-the-helper-function.md)
