---
description: 'Дополнительные сведения: изменения в вспомогательной функции отложенной загрузки DLL с момента Visual C++ 6,0'
title: Изменения во вспомогательной функции отложенной загрузки библиотеки DLL по сравнению с Visual C++ версии 6.0
ms.date: 01/19/2021
helpviewer_keywords:
- delayed loading of DLLs, what's changed
- PFromRva method
- __delayLoadHelper2 function
- helper functions, what's changed
ms.openlocfilehash: a83d5e2895863efde396c48d68316e32aa42a2a1
ms.sourcegitcommit: 3d9cfde85df33002e3b3d7f3509ff6a8dc4c0a21
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/21/2021
ms.locfileid: "98666970"
---
# <a name="changes-in-the-dll-delayed-loading-helper-function-since-visual-c-60"></a>Изменения во вспомогательной функции отложенной загрузки библиотеки DLL по сравнению с Visual C++ версии 6.0

Если на компьютере установлено несколько версий Visual C++ или если вы определили собственную вспомогательную функцию, изменения, вносимые в вспомогательную функцию отложенной загрузки DLL, могут повлиять на работу. Пример:

- **`__delayLoadHelper`** Теперь `__delayLoadHelper2`

- `__pfnDliNotifyHook` изменено на `__pfnDliNotifyHook2`.

- `__pfnDliFailureHook` изменено на `__pfnDliFailureHook2`.

- `__FUnloadDelayLoadedDLL` изменено на `__FUnloadDelayLoadedDLL2`.

> [!NOTE]
> Если вы используете вспомогательную функцию по умолчанию, эти изменения не повлияют на вас. Нет изменений, касающихся того, как вы вызываете компоновщик.

## <a name="multiple-versions-of-visual-c"></a>Несколько версий Visual C++

Если на компьютере установлено несколько версий Visual C++, убедитесь, что компоновщик соответствует *`delayimp.lib`* . В случае несоответствия вы получите ошибку компоновщика, сообщающую об ошибке `___delayLoadHelper2@8` или `___delayLoadHelper@8` как неразрешенный внешний символ. Первый подразумевает новый компоновщик со старым *`delayimp.lib`* , а второй — старый компоновщик с новым *`delayimp.lib`* .

Если возникает ошибка неразрешенного компоновщика, запустите [`dumpbin /linkermember:1`](linkermember.md) в *`delayimp.lib`* , который предполагается включить в вспомогательную функцию, чтобы увидеть, какая вспомогательная функция определена. Вспомогательная функция также может быть определена в объектном файле. выполните команду [`dumpbin /symbols`](symbols.md) и найдите `delayLoadHelper` или `delayLoadHelper2` .

Если вы уверены, что у вас есть компоновщик Visual C++ 6,0, то:

- Выполните **`dumpbin`** команду в файле модуля поддержки с отложенной загрузкой *`.lib`* или, *`.obj`* чтобы определить, определен ли он `__delayLoadHelper2` . В противном случае произойдет сбой связи.

- Определите `__delayLoadHelper` в вспомогательной функции или файле модуля поддержки задержки загрузки *`.lib`* *`.obj`* .

## <a name="user-defined-helper-function"></a>Определяемая пользователем вспомогательная функция

Если вы определили собственную вспомогательную функцию и используете текущую версию Visual C++, выполните следующие действия.

- Переименуйте вспомогательную функцию в `__delayLoadHelper2` .

- Поскольку указатели в дескрипторе задержки ( `ImgDelayDescr` в *`delayimp.h`* ) были изменены с абсолютных адресов (VAs) на относительные адреса (RVA) для работы как в 32-разрядных, так и в 64-разрядных программах, необходимо преобразовать эти RVA обратно в указатели. Появилась новая функция: `PFromRva` , найденная в *`delayhlp.cpp`* . Эту функцию можно использовать для каждого поля в дескрипторе, чтобы преобразовать их обратно в 32-разрядные или 64-битовые указатели. Вспомогательная функция отложенной загрузки по умолчанию остается хорошим шаблоном для использования в качестве примера.

## <a name="load-all-imports-for-a-delay-loaded-dll"></a>Загрузка всех импортов для DLL с отложенной загрузкой

Компоновщик может загрузить все импорты из библиотеки DLL, которую вы указали для загрузки с задержкой. Дополнительные сведения см. [в разделе Загрузка всех импортов для DLL с отложенной загрузкой](loading-all-imports-for-a-delay-loaded-dll.md).

## <a name="see-also"></a>См. также раздел

[Понятие вспомогательной функции](understanding-the-helper-function.md)
