---
title: Параметр /OPT (оптимизация)
ms.date: 05/18/2018
f1_keywords:
- VC.Project.VCLinkerTool.OptimizeReferences
- /opt
- VC.Project.VCLinkerTool.OptimizeForWindows98
- VC.Project.VCLinkerTool.EnableCOMDATFolding
- VC.Project.VCLinkerTool.OptimizeFolding
- VC.Project.VCLinkerTool.FoldingIterations
- VC.Project.VCLinkerTool.OptimizeFoldingIterations
helpviewer_keywords:
- LINK tool [C++], controlling optimizations
- -OPT linker option
- linker [C++], optimizations
- OPT linker option
- optimization, linker
- /OPT linker option
ms.assetid: 8f229863-5f53-48a8-9478-243a647093ac
ms.openlocfilehash: b25db4d6c260c3c6751de293aa2a82df8aa05e7e
ms.sourcegitcommit: c123cc76bb2b6c5cde6f4c425ece420ac733bf70
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81336227"
---
# <a name="opt-optimizations"></a>Параметр /OPT (оптимизация)

Управляет оптимизацией, выполняемой во время сборки с помощью программы LINK.

## <a name="syntax"></a>Синтаксис

> **/OPT:**-**РЕФ** | **НОРЕФ**<br/>
> **/OPT:****ICF****=**-_итерации_ **NOICF**<br/>
> **/OPT:**-**LBR** | **NOLBR**

## <a name="arguments"></a>Аргументы

**REF** &#124; **NOREF**

**/OPT:REF** устраняет функции и данные, на которые никогда не ссылаются; **/OPT:NOREF** сохраняет функции и данные, на которые никогда не ссылаются.

Когда /OPT:REF включен, LINK удаляет неотвеченные упакованные функции и данные, известные как *COMDATs*. Такой способ оптимизации называется транзитивным исключением функций COMDAT. Опция **/OPT:REF** также отстраняет от инкрементных ссылок.

Встроенные функции и функции членов, определенные внутри объявления класса, всегда являются COMDATs. Все функции в файле объекта вносятся в COMDATs, если он компилируется с помощью опции [/Gy.](gy-enable-function-level-linking.md) Чтобы разместить **конст-данные** в COMDATs, вы должны объявить его с помощью `__declspec(selectany)`. Для получения информации о том, как [selectany](../../cpp/selectany.md)указать данные для удаления или складывания, см.

По **умолчанию/OPT:REF** включен связующим, если **не указано /OPT:NOREF** или [/DEBUG.](debug-generate-debug-info.md) Чтобы преодолеть этот дефолт и сохранить неуказанные COMDATs в программе, укажите **/OPT:NOREF**. Вы можете использовать опцию [/INCLUDE](include-force-symbol-references.md) для переопределения удаления определенного символа.

Если [/DEBUG](debug-generate-debug-info.md) указан, по умолчанию для **/OPT** является **NOREF,** и все функции сохраняются на изображении. Чтобы переопределить этот по умолчанию и оптимизировать сборку отладки, укажите **/OPT:REF**. Это может уменьшить размер выполнения, и может быть полезной оптимизации даже в отладки строит. Мы рекомендуем также указать **/OPT:NOICF,** чтобы сохранить идентичные функции в отладковых сборках. Это упрощает чтение трассировки стека и задание точек останова в функциях, которые в противном случае были бы объединены.

**ICF**\[**=**_Итерации_ICF - &#124; **NOICF**

Используйте_итерации_ **ICF**\[**=** для выполнения идентичных складывающихся COMDAT. Избыточные записи COMDAT можно удалить из выходных данных компоновщика. Параметр факультативных *итераций* определяет количество раз, чтобы пройти символы для дубликатов. Число итераций по умолчанию составляет 1. При большем числе итераций возможно обнаружение дополнительных дубликатов, появляющихся после свертывания в предыдущих итерациях.

По **умолчанию/OPT:ICF** включен связующим, если **не указаны /OPT:NOICF** или [/DEBUG.](debug-generate-debug-info.md) Чтобы переопределить этот дефолт и предотвратить складывание COMDATs в программу, укажите **/OPT:NOICF**.

При отладке сборки необходимо четко указать **/OPT:ICF** для включения comDAT в складку. Однако, поскольку **/OPT:ICF** может объединять идентичные данные или функции, он может изменять имена функций, которые отображаются в следах стека. Это также может сделать невозможным установку точек разрыва в определенных функциях или изучить некоторые данные в отладчике, и может принять вас в неожиданные функции, когда вы один шаг через код. Поведение кода идентично, но представление отладчика может быть очень запутанным. Поэтому мы не рекомендуем использовать **/OPT:ICF** в отладковых сборках, если преимущества меньшего кода не перевешивают эти недостатки.

> [!NOTE]
> Потому что **/OPT:ICF** может привести к тому, что один и тот же адрес будет присвоен различным функциям или только для чтения членов данных (т.е. **конст переменные** при компилировании с помощью **/Gy),** он может нарушить программу, которая зависит от уникальных адресов для функций или только для чтения членов данных. Дополнительные сведения см. в разделе [/Gy (включение компоновки на уровне функций)](gy-enable-function-level-linking.md).

**LBR** &#124; **NOLBR**

Параметры **/OPT:LBR** и **/OPT:NOLBR** применяются только к бинаритам ARM. Поскольку некоторые инструкции по ветке процессора ARM имеют ограниченный диапазон, если ссылка обнаруживает переход на адрес вне диапазона, он заменяет адрес назначения инструкции ветви адресом кода "остров", содержащий инструкцию ветви, нацеленную на фактическое назначение. Вы можете использовать **/OPT:LBR** для оптимизации обнаружения длинных инструкций филиала и размещения промежуточных островов кода, чтобы свести к минимуму общий размер кода. **/OPT:NOLBR** инструктирует связующее звено для создания кодовых островов для длинных инструкций по ветви по мере их возникновения, без оптимизации.

По умолчанию опция **/OPT:LBR** устанавливается, когда не включена инкрементная ссылка. Если вы хотите неинкрементную ссылку, но не длительную оптимизацию филиала, укажите **/OPT:NOLBR**. Опция **/OPT:LBR** отстраняет от инкрементных ссылок.

## <a name="remarks"></a>Remarks

При использовании на командной строке ссылка по умолчанию **/OPT:REF,ICF,LBR**. Если **/DEBUG** указан, по умолчанию **является /OPT:NOREF,NOICF,NOLBR**.

Оптимизация **/OPT** обычно уменьшает размер изображения и увеличивает скорость программы. Эти улучшения могут быть существенными в более крупных программах, поэтому они включены по умолчанию для розничных сборок.

Оптимизация linker занимает дополнительное время вперед, но оптимизированный код также экономит время, когда у связующей имеет меньше перемещений, чтобы исправить и создает меньшее окончательное изображение, и это экономит еще больше времени, когда он имеет меньше информации об отливке для обработки и записи в PDB. При включении оптимизации это может привести к более быстрому времени соединения в целом, так как небольшие дополнительные затраты в анализе могут быть более чем компенсированы экономией времени в связующем, перемещающемся по более мелким файлам.

Аргументы **/OPT** могут быть определены вместе, разделены запятыми. Например, вместо **/OPT:REF/OPT:NOICF**, вы можете указать **/OPT:REF,NOICF**.

Вы можете использовать опцию [для связующих /VERBOSE,](verbose-print-progress-messages.md) чтобы увидеть функции, которые удаляются **/OPT:REF,** и функции, складываемые **/OPT:ICF.**

Аргументы **/OPT** часто устанавливаются для проектов, созданных с помощью диалога **Нового проекта** в Visual Studio IDE, и обычно имеют различные значения для конфигураций отладки и выпуска. Если значение не установлено для этих параметров связующим в проекте, то вы можете получить по умолчанию проекта, которые могут отличаться от значений по умолчанию, используемых связующим звеном в командной строке.

### <a name="to-set-the-opticf-or-optref-linker-option-in-the-visual-studio-development-environment"></a>Установка параметра компоновщика OPT:ICF или OPT:REF в среде разработки Visual Studio

1. Откройте диалоговое окно **Страницы свойств** проекта. Подробнее см. в статье [Настройка компилятора C++ и свойства сборки в Visual Studio](../working-with-project-properties.md).

1. Выберите страницу свойства оптимизации **свойств Configuration** > **Properties.** > **Optimization**

1. Измените одно из следующих свойств:

   - **Включить свертывание записей COMDAT**

   - **Ссылки**

### <a name="to-set-the-optlbr-linker-option-in-the-visual-studio-development-environment"></a>Установка параметра компоновщика OPT:LBR в среде разработки Visual Studio

1. Откройте диалоговое окно **Страницы свойств** проекта. Подробнее см. в статье [Настройка компилятора C++ и свойства сборки в Visual Studio](../working-with-project-properties.md).

1. Выберите страницу свойства **configuration Properties** > **Linker** > **Command Line.**

1. Введите опцион в **дополнительных опциях:**

   `/opt:lbr` или `/opt:nolbr`

### <a name="to-set-this-linker-option-programmatically"></a>Задание данного параметра компоновщика программным способом

- См. описание свойств <xref:Microsoft.VisualStudio.VCProjectEngine.VCLinkerTool.EnableCOMDATFolding%2A> и <xref:Microsoft.VisualStudio.VCProjectEngine.VCLinkerTool.OptimizeReferences%2A>.

## <a name="see-also"></a>См. также раздел

- [Справочник по компоновщику MSVC](linking.md)
- [Варианты MSVC Linker](linker-options.md)
