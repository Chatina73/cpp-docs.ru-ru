---
title: Параметр /OPT (оптимизация)
ms.date: 05/18/2018
f1_keywords:
- VC.Project.VCLinkerTool.OptimizeReferences
- /opt
- VC.Project.VCLinkerTool.OptimizeForWindows98
- VC.Project.VCLinkerTool.EnableCOMDATFolding
- VC.Project.VCLinkerTool.OptimizeFolding
- VC.Project.VCLinkerTool.FoldingIterations
- VC.Project.VCLinkerTool.OptimizeFoldingIterations
helpviewer_keywords:
- LINK tool [C++], controlling optimizations
- -OPT linker option
- linker [C++], optimizations
- OPT linker option
- optimization, linker
- /OPT linker option
ms.assetid: 8f229863-5f53-48a8-9478-243a647093ac
ms.openlocfilehash: 1a6fa8b9c923ff697831c29b8004ce360baf7d77
ms.sourcegitcommit: ae2f71fe0d64f1a90ef722759fe93c82abc064ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/18/2018
ms.locfileid: "53587893"
---
# <a name="opt-optimizations"></a>Параметр /OPT (оптимизация)

Управляет оптимизацией, выполняемой во время сборки с помощью программы LINK.

## <a name="syntax"></a>Синтаксис

> **/ OPT:**{**REF** | **NOREF**}<br/>
> **/ OPT:**{**ICF**[**=**_итераций_] | **NOICF**}<br/>
> **/ OPT:**{**LBR** | **NOLBR**}

## <a name="arguments"></a>Аргументы

**REF** &AMP;#124; **NOREF**

**Предотвратят** удаляет функции и данные, которые никогда не указываются; **/OPT:NOREF** хранит такие функции и данные, которые никогда не ссылаются.

При включении предотвратят LINK удаляет неиспользуемые упакованные функции и данные, известный как *COMDAT*. Такой способ оптимизации называется транзитивным исключением функций COMDAT. **Предотвратят** параметр также отключает инкрементную компоновку.

Встроенных функций и функций-членов определенных внутри объявления класса всегда являются COMDAT. Все функции в объектный файл выполняются в записи COMDAT, если он компилируется с помощью [/Gy](../../build/reference/gy-enable-function-level-linking.md) параметр. Чтобы поместить **const** данные в записи COMDAT, необходимо объявить ее с помощью `__declspec(selectany)`. Сведения о способах указания данных для удаления или свертывание см. в разделе [selectany](../../cpp/selectany.md).

По умолчанию **предотвратят** включен компоновщиком, если не **/OPT:NOREF** или [/DEBUG](../../build/reference/debug-generate-debug-info.md) указан. Чтобы переопределить поведение по умолчанию и сохранить функции COMDAT без ссылки в программе, укажите **/OPT:NOREF**. Можно использовать [/INCLUDE](../../build/reference/include-force-symbol-references.md) возможность переопределения удаления конкретного символа.

Если [/DEBUG](../../build/reference/debug-generate-debug-info.md) указан, по умолчанию для **/OPT** — **NOREF**, и в образе сохраняются все функции. Чтобы переопределить это значение по умолчанию и оптимизировать отладочную сборку, укажите **предотвратят**. Это можно уменьшить размер исполняемого файла и может быть построений полезная оптимизация даже в режиме отладки. Рекомендуется также задать **/OPT: NOICF** для сохранения идентичных функций в отладочных сборок. Это упрощает чтение трассировки стека и задание точек останова в функциях, которые в противном случае были бы объединены.

**ICF**\[**=**_итераций_] &#124; **NOICF**

Используйте **ICF**\[**=**_итераций_] для выполнения аналогичное свертывание записей COMDAT. Избыточные записи COMDAT можно удалить из выходных данных компоновщика. Необязательный *итераций* указывает количество проходов символов для поиска дубликатов. Число итераций по умолчанию равно 1. При большем числе итераций возможно обнаружение дополнительных дубликатов, появляющихся после свертывания в предыдущих итерациях.

По умолчанию **/OPT: ICF** включен компоновщиком, если не **/OPT: NOICF** или [/DEBUG](../../build/reference/debug-generate-debug-info.md) указан. Чтобы переопределить поведение по умолчанию и предотвратить COMDAT свертывается в программе, укажите **/OPT: NOICF**.

В сборке отладки, необходимо явно указать **/OPT: ICF** для включения свертывания записей COMDAT. Тем не менее так как **/OPT: ICF** может объединять идентичные данные или функции, он может изменять имена функций, которые отображаются в трассировках стека. Он может также не позволять устанавливать точки останова в определенных функций или изучения некоторых данные в отладчике и можно перейти в непредвиденную функцию при пошаговом режиме код. Поведение кода идентична, но презентация отладчик может быть очень неудобно. Таким образом, мы не рекомендуем использовать **/OPT: ICF** в отладочных сборках, если только преимущества меньшего объема кода не перевешивают эти недостатки.

> [!NOTE]
> Так как **/OPT: ICF** может вызвать один и тот же адрес должен назначаться различным функциям или членам данных только для чтения (то есть **const** переменных при компиляции с помощью **/Gy**), Это может нарушить работу программы, которая зависит от уникальный адресов для функций или данным-членам только для чтения. Дополнительные сведения см. в разделе [/Gy (включение компоновки на уровне функций)](../../build/reference/gy-enable-function-level-linking.md).

**LBR** &AMP;#124; **NOLBR**

**/OPT:LBR** и **/OPT:NOLBR** параметры применяются только к двоичные файлы ARM. Поскольку некоторые инструкции ветвления процессора ARM имеют ограниченный диапазон, если компоновщик обнаруживает переход к адресу вне допустимого диапазона, он заменяет адрес места назначения инструкции ветвления адресом "островка" кода, содержащим инструкцию ветвления, нацеленную на фактическое место назначения. Можно использовать **/OPT:LBR** оптимизировать обнаружение длинных команд ветвления и размещения промежуточных островков кода для минимизации общего объема кода. **/OPT:NOLBR** указывает компоновщику на необходимость создания островков кода для длинных команд ветвления, так как они встречаются, без оптимизации.

По умолчанию **/OPT:LBR** был установлен при инкрементная компоновка не включена. Если требуется неинкрементная компоновка, но не оптимизация длинных команд ветвления, укажите **/OPT:NOLBR**. **/OPT:LBR** параметр отключает инкрементную компоновку.

## <a name="remarks"></a>Примечания

При использовании в командной строке, по умолчанию используется компоновщик **LBR предотвратят ICF,**. Если **/DEBUG** указан, по умолчанию используется **NOLBR /OPT:NOREF NOICF,**.

**/OPT** оптимизаций обычно уменьшить размер образа и повысить производительность программы. Эти улучшения могут быть существенными в более крупных программ, поэтому они включены по умолчанию в розничных сборках.

Оптимизации компоновщика заранее занять дополнительное время, но оптимизированный код также экономит время, когда компоновщик имеет меньшее число перемещений для устранения ошибок и создает меньше окончательного образа, и сохраняет еще больше времени, когда на него установлен уменьшить объем отладочной информации для обработки и записи в PDB-ФАЙЛ. При включенной оптимизации, это может привести быстрее ссылку в целом, как небольшой дополнительные затраты при анализе может быть больше, чем смещения, к моменту экономия в компоновщик оказывается над двоичные файлы меньшего размера.

**/OPT** следует указывать аргументы друг с другом, разделенных запятыми. Например, а не из **предотвратят/OPT: NOICF**, можно указать **предотвратят, NOICF**.

Можно использовать [/VERBOSE](../../build/reference/verbose-print-progress-messages.md) параметр компоновщика, чтобы просмотреть функции, которые будут удалены с **предотвратят** и функций, свертываемых при **/OPT: ICF**.

**/OPT** аргументы часто настраиваются для проектов, созданных с помощью **новый проект** диалоговое окно в Visual Studio IDE, и обычно имеют разные значения для отладки и конфигурации выпуска. Если значение не задано для этих параметров компоновщика в проекте, может появиться проекта по умолчанию, которые могут быть разными, от значений по умолчанию, используемые компоновщиком в командной строке.

### <a name="to-set-the-opticf-or-optref-linker-option-in-the-visual-studio-development-environment"></a>Установка параметра компоновщика OPT:ICF или OPT:REF в среде разработки Visual Studio

1. Откройте диалоговое окно **Страницы свойств** проекта. Дополнительные сведения см. в разделе [Работа со свойствами проекта](../../ide/working-with-project-properties.md).

1. Выберите **свойства конфигурации** > **компоновщика** > **оптимизации** страницу свойств.

1. Измените одно из следующих свойств:

   - **Включить свертывание записей COMDAT**

   - **Ссылки**

### <a name="to-set-the-optlbr-linker-option-in-the-visual-studio-development-environment"></a>Установка параметра компоновщика OPT:LBR в среде разработки Visual Studio

1. Откройте диалоговое окно **Страницы свойств** проекта. Дополнительные сведения см. в разделе [свойств проекта Visual C++ параметр](../../ide/working-with-project-properties.md).

1. Выберите **свойства конфигурации** > **компоновщика** > **командной строки** страницу свойств.

1. Введите параметр в **Дополнительные параметры**:

   `/opt:lbr` или `/opt:nolbr`

### <a name="to-set-this-linker-option-programmatically"></a>Задание данного параметра компоновщика программным способом

- См. описание свойств <xref:Microsoft.VisualStudio.VCProjectEngine.VCLinkerTool.EnableCOMDATFolding%2A> и <xref:Microsoft.VisualStudio.VCProjectEngine.VCLinkerTool.OptimizeReferences%2A>.

## <a name="see-also"></a>См. также

- [Настройка параметров компоновщика](../../build/reference/setting-linker-options.md)
- [Параметры компоновщика](../../build/reference/linker-options.md)
