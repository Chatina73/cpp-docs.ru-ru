---
description: 'Дополнительные сведения о:/Zc: threadSafeInit (потокобезопасная локальная статическая инициализация)'
title: '/Zc: threadSafeInit (потокобезопасная локальная статическая инициализация)'
ms.date: 03/14/2018
f1_keywords:
- threadSafeInit
- /Zc:threadSafeInit
helpviewer_keywords:
- -Zc compiler options (C++)
- threadSafeInit
- Thread-safe Local Static Initialization
- /Zc compiler options (C++)
- Zc compiler options (C++)
ms.assetid: a0fc4b34-2cf0-45a7-a642-b8afc4ca19f2
ms.openlocfilehash: ac14e7979d2adab0b21229f426e00a489c14f38f
ms.sourcegitcommit: d6af41e42699628c3e2e6063ec7b03931a49a098
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2020
ms.locfileid: "97271217"
---
# <a name="zcthreadsafeinit-thread-safe-local-static-initialization"></a>/Zc: threadSafeInit (потокобезопасная локальная статическая инициализация)

Параметр компилятора **/Zc: threadSafeInit** указывает компилятору инициализировать статические локальные переменные (область видимости функции) потокобезопасным способом, устраняя необходимость синхронизации вручную. Только инициализация является потокобезопасной. Использование и изменение статических локальных переменных несколькими потоками должно по-прежнему синхронизироваться вручную. Этот параметр доступен начиная с Visual Studio 2015. По умолчанию Visual Studio включает этот параметр.

## <a name="syntax"></a>Синтаксис

> **/Zc: threadSafeInit**[ **-** ]

## <a name="remarks"></a>Комментарии

В стандарте C++ 11 переменные области блокировки со статической или длительностью хранилища потоков должны быть инициализированы нулем перед любой другой инициализацией. Инициализация происходит, когда управление впервые проходит через объявление переменной. Если во время инициализации возникает исключение, переменная считается неинициализированной, а повторная инициализация выполняется повторно при следующем прохождении через объявление. Если элемент управления входит в объявление параллельно с инициализацией, параллельное выполнение блокируется во время инициализации. Поведение не определено, если элемент управления повторно вводит объявление в процессе инициализации рекурсивно. По умолчанию Visual Studio, начиная с Visual Studio 2015, реализует это стандартное поведение. Это поведение можно явно указать с помощью параметра компилятора **/Zc: threadSafeInit** .

Параметр компилятора **/Zc: threadSafeInit** включен по умолчанию. Параметр [/permissive-](permissive-standards-conformance.md) не влияет на **/Zc: threadSafeInit**.

Поточно-ориентированная Инициализация статических локальных переменных зависит от кода, реализованного в универсальной библиотеке времени выполнения C (UCRT). Чтобы избежать зависимости от UCRT или сохранить поведение инициализации, не являющееся потокобезопасным, для версий Visual Studio до Visual Studio 2015, используйте параметр **/Zc: threadSafeInit** . Если известно, что потокобезопасность не требуется, используйте этот параметр для создания немного меньшего, более быстрого кода для статических локальных объявлений.

Потокобезопасные статические локальные переменные используют локальное хранилище потока (TLS) для обеспечения эффективного выполнения, когда статический объект уже инициализирован. Реализация этой функции основана на функциях поддержки операционной системы Windows в Windows Vista и более поздних операционных системах. Windows XP, Windows Server 2003 и более старые операционные системы не поддерживают эту поддержку, поэтому они не имеют преимуществ для повышения эффективности. Эти операционные системы также имеют меньше ограничений на количество разделов TLS, которые могут быть загружены. Превышение лимита раздела TLS может привести к сбою. Если это проблема в коде, особенно в коде, который должен выполняться в более старых операционных системах, используйте **/Zc: threadSafeInit —** для отключения поточно-ориентированного кода инициализации.

Дополнительные сведения о вопросах соответствия в Visual C++ см. в статье [Nonstandard Behavior](../../cpp/nonstandard-behavior.md).

### <a name="to-set-this-compiler-option-in-the-visual-studio-development-environment"></a>Установка данного параметра компилятора в среде разработки Visual Studio

1. Откройте диалоговое окно **Страницы свойств** проекта. Подробнее см. в статье [Настройка компилятора C++ и свойства сборки в Visual Studio](../working-with-project-properties.md).

1. В раскрывающемся меню **конфигурации** выберите пункт **все конфигурации**.

1. Выберите страницу свойств **Свойства конфигурации**  >  **C/C++**  >  **Командная строка** .

1. Измените свойство **Дополнительные параметры** , чтобы включить **/Zc: threadSafeInit** или **/Zc: ThreadSafeInit-** и нажмите кнопку **ОК**.

## <a name="see-also"></a>См. также раздел

[Параметры компилятора MSVC](compiler-options.md)<br/>
[Синтаксис Command-Line компилятора КОМПИЛЯТОРОМ MSVC](compiler-command-line-syntax.md)<br/>
[/Zc (соответствие)](zc-conformance.md)<br/>
