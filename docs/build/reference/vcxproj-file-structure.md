---
title: Структура файлов VCXPROJ и PROPS
ms.date: 09/18/2018
helpviewer_keywords:
- .vcxproj file structure
ms.assetid: 14d0c552-29db-480e-80c1-7ea89d6d8e9c
ms.openlocfilehash: 3b7c7bdad8848a3755db4ea565117459c72e939b
ms.sourcegitcommit: 0ab61bc3d2b6cfbd52a16c6ab2b97a8ea1864f12
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "62317124"
---
# <a name="vcxproj-and-props-file-structure"></a>Структура файлов VCXPROJ и PROPS

[MSBuild](../msbuild-visual-cpp.md) — это система проектов по умолчанию в Visual Studio. Выбирая **Файл** > **Создать проект** в Visual C++, вы создаете проект MSBuild, параметры которого хранятся в XML-файле проекта с расширением `.vcxproj`. Файл проекта также может импортировать файлы PROPS и TARGETS, где могут храниться параметры. Вручную изменять файл проекта в большинстве случаев не требуется и даже не следует, если только у вас нет четкого представления о работе MSBuild. По возможности следует использовать страницы свойств Visual Studio для изменения параметров проекта (см. в разделе [свойств компилятора и собранной задать C++ в Visual Studio](../working-with-project-properties.md). Однако в некоторых случаях может потребоваться изменить файл проекта или страницу свойств вручную. Для этих сценариев в этой статье приведены основные сведения о структуре данного файла.

**Внимание!**

Если вы решили изменить файл VCXPROJ вручную, нужно учитывать следующие факты:

1. Структура файла должна соответствовать предписанной форме, которая описана в этой статье.

1. Сейчас система проектов Visual C++ не поддерживает подстановочные знаки в элементах проекта. Например, не поддерживается следующее:

   ```xml
   <ClCompile Include="*.cpp"/>
   ```

1. Сейчас система проектов Visual C++ не поддерживает макросы в путях элементов проекта. Например, не поддерживается следующее:

   ```xml
   <ClCompile Include="$(IntDir)\generated.cpp"/>
   ```

   "Не поддерживается" означает, что макросы, возможно, будут работать не для всех операций в IDE. Макросы, которые не предполагают изменения значений в различных конфигурациях, будут работать, но не будут сохраняться, если элемент перемещается в другой фильтр или проект. Макросы, значения которых будут меняться в различных конфигурациях проекта, приведут к проблемам, так как IDE не предполагает, что пути к элементам проекта будут другими.

1. Чтобы обеспечить правильное добавление, удаление или изменение свойств проекта при редактировании в диалоговом окне **Свойства проекта**, этот файл должен содержать отдельные группы для каждой конфигурации проекта и эти условия должны иметь следующую форму:

   ```xml
   Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'"
   ```

1. Каждое свойство должно быть указано в группе с правильной меткой, как указано в файле правил свойств. Дополнительные сведения см. в разделе [XML-файлы правил для страниц свойств](property-page-xml-files.md).

## <a name="vcxproj-file-elements"></a>Элементы файла VCXPROJ

Вы можете просмотреть содержимое файла VCXPROJ, используя любой текстовый или XML-редактор. Просмотреть можно и в Visual Studio, щелкнув проект в обозревателе решений, выбрав **Выгрузить проект** и затем **Изменить Foo.vcxproj**.

Первое, на что нужно обратить внимание, — это определенный порядок следования элементов верхнего уровня. Пример:

- Большинство групп свойств и групп определений элементов расположено после импорта для Microsoft.Cpp.Default.props.

- Все целевые объекты импортируются в конце файла.

- Существует несколько групп свойств, каждая из которых имеет уникальную метку, и все они расположены в определенном порядке.

Порядок элементов в файле проекта очень важен, так как система MSBuild основана на модели последовательной оценки.  Если файл проекта, включая все импортированные файлы PROPS и TARGETS, состоит из нескольких определений одного свойства, последнее определение переопределяет предыдущие. В примере ниже значение xyz задается во время компиляции, так как подсистема MSBUild обнаруживает его последним во время оценки.

```xml
  <MyProperty>abc</MyProperty>
  <MyProperty>xyz</MyProperty>
```

В следующем фрагменте кода показан минимальный вариант файла VCXPROJ. Файл VCXPROJ, созданный Visual Studio, будет содержать эти элементы верхнего уровня MSBuild, и они будут расположены в указанном порядке (несмотря на то что может присутствовать несколько копий каждого такого элемента верхнего уровня). Обратите внимание, что атрибуты `Label` — это произвольные теги, которые используются в Visual Studio лишь в качестве ориентиров для редактирования; никакой другой функции у них нет.

```xml
<Project DefaultTargets="Build" ToolsVersion="4.0" xmlns='http://schemas.microsoft.com/developer/msbuild/2003'>
  <ItemGroup Label="ProjectConfigurations" />
  <PropertyGroup Label="Globals" />
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.default.props" />
  <PropertyGroup Label="Configuration" />
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.props" />
  <ImportGroup Label="ExtensionSettings" />
  <ImportGroup Label="PropertySheets" />
  <PropertyGroup Label="UserMacros" />
  <PropertyGroup />
  <ItemDefinitionGroup />
  <ItemGroup />
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.targets" />
  <ImportGroup Label="ExtensionTargets" />
</Project>
```

Следующие разделы описывают назначение каждого из этих элементов и причину подобного упорядочивания.

### <a name="project-element"></a>Элемент Project

```xml
<Project DefaultTargets="Build" ToolsVersion="4.0" xmlns='http://schemas.microsoft.com/developer/msbuild/2003' >
```

`Project` является корневым узлом. Он указывает используемую версию MSBuild, а также целевой объект по умолчанию, используемый при передаче этого файла в MSBuild.exe.

### <a name="projectconfigurations-itemgroup-element"></a>Элемент ProjectConfigurations ItemGroup

```xml
<ItemGroup Label="ProjectConfigurations" />
```

`ProjectConfigurations` содержит описание конфигурации проекта. В качестве примера можно привести Debug|Win32, Release|Win32, Debug|ARM и т. д. Многие параметры проекта относятся к конкретной конфигурации. Например, вам может потребоваться задать свойства оптимизации для сборки выпуска, но не для сборки отладки.

Группа элементов `ProjectConfigurations` не используется во время сборки. Она нужна интегрированной среде разработки Visual Studio для загрузки проекта. Эту группу элементов можно переместить в файл PROPS и импортировать в файл VCXPROJ. Однако если в этом случае требуется добавить или удалить конфигурации, нужно вручную изменить файл PROPS, так как использовать интегрированную среду разработки невозможно.

### <a name="projectconfiguration-elements"></a>Элементы ProjectConfiguration

В следующем фрагменте кода показана конфигурация проекта. В этом примере используется имя конфигурации "Debug|x64". Имя конфигурации проекта должно иметь формат $(Конфигурация)|$(Платформа). У узла конфигурации проекта может быть два свойства: Конфигурации и платформы. При активной конфигурации этим свойствам автоматически назначаются указанные здесь значения.

```xml
<ProjectConfiguration Include="Debug|x64">
  <Configuration>Debug</Configuration>
  <Platform>x64</Platform>
</ProjectConfiguration>
```

Интегрированная среда разработки ожидает найти конфигурацию проекта для любого сочетания значений "Конфигурация" и "Платформа", используемых во всех элементах ProjectConfiguration. Часто это означает, что для выполнения данного требования в проект могут включаться бесполезные конфигурации. Например, если проект имеет следующие конфигурации:

- Debug|Win32;

- Retail|Win32;

- Special 32-bit Optimization|Win32;

то он должен содержать и следующие конфигурации, хотя конфигурация Special 32-bit Optimization не имеет смысла для x64:

- Отладка|x64

- Retail|x64;

- Special 32-bit Optimization|x64.

Вы можете отключить команды сборки и развертывания для любой конфигурации в **диспетчере конфигурации решения**.

### <a name="globals-propertygroup-element"></a>Элемент Globals PropertyGroup

```xml
<PropertyGroup Label="Globals" />
```

`Globals` содержит параметры уровня проекта, такие как ProjectGuid, RootNamespace и ApplicationType/ApplicationTypeRevision. Последние два часто определяют целевую ОС. Проект можно ориентировать только на одну целевую ОС, так как ссылки и элементы проекта пока не могут иметь условий. Эти свойства обычно не переопределяются в другом месте в файле проекта. Эта группа не зависит от конфигурации, и поэтому в файле проекта обычно существует только одна группа Globals.

### <a name="microsoftcppdefaultprops-import-element"></a>Элемент Microsoft.Cpp.default.props Import

```xml
<Import Project="$(VCTargetsPath)\Microsoft.Cpp.default.props" />
```

Страница свойств **Microsoft.Cpp.default.props** входит в состав Visual Studio и недоступна для изменения. Она содержит параметры по умолчанию для проекта. Эти значения по умолчанию могут различаться в зависимости от ApplicationType.

### <a name="configuration-propertygroup-elements"></a>Элементы Configuration PropertyGroup

```xml
<PropertyGroup Label="Configuration" />
```

Группа свойств `Configuration` имеет прикрепленное условие конфигурации (например, `Condition=”'$(Configuration)|$(Platform)'=='Debug|Win32'”`) и представлена несколькими копиями — по одной на конфигурации. Эта группа свойств содержит свойства, заданные для конкретной конфигурации. Свойства конфигурации включают PlatformToolset и управляют включением системных страниц свойств в **Microsoft.Cpp.props**. Например, если определено свойство `<CharacterSet>Unicode</CharacterSet>`, то системная страница свойств **microsoft.Cpp.unicodesupport.props** будет включена. Если вы просмотрите **Microsoft.Cpp.props**, то увидите строку: `<Import Condition=”'$(CharacterSet)' == 'Unicode'”   Project=”$(VCTargetsPath)\microsoft.Cpp.unicodesupport.props”/>`.

### <a name="microsoftcppprops-import-element"></a>Элемент Microsoft.Cpp.props Import

```xml
<Import Project="$(VCTargetsPath)\Microsoft.Cpp.props" />
```

Страница свойств **Microsoft.Cpp.props** (напрямую или через операции импорта) определяет значения по умолчанию для многих свойств, связанных с конкретным инструментом, например, свойства уровня предупреждения и оптимизации для компилятора, свойство TypeLibraryName инструмента MIDL и т. п. Она также импортирует различные системные страницы свойств на основании свойств конфигурации, которые определены выше в группе свойств.

### <a name="extensionsettings-importgroup-element"></a>Элемент ExtensionSettings ImportGroup

```xml
<ImportGroup Label="ExtensionSettings" />
```

Группа `ExtensionSettings` содержит операции импорта для страниц свойств, входящих в настройки сборки. Для определения настройки сборки используется до трех файлов: TARGETS, PROPS и XML. Эта группа импорта содержит операции импорта для файла PROPS.

### <a name="propertysheets-importgroup-elements"></a>Элемент PropertySheets ImportGroup

```xml
<ImportGroup Label="PropertySheets" />
```

Группа `PropertySheets` содержит операции импорта для страниц свойств. Это страницы свойств, добавляемые с помощью представления диспетчера свойств в Visual Studio. Порядок, в котором указаны эти операции импорта, имеет значение и отражен в диспетчере свойств. Обычно файл проекта содержит несколько экземпляров этого типа группы импорта, по одному для каждой конфигурации проекта.

### <a name="usermacros-propertygroup-element"></a>Элемент UserMacros PropertyGroup

```xml
<PropertyGroup Label="UserMacros" />
```

`UserMacros` содержит свойства, создаваемые в качестве переменных, которые используются для настройки процесса сборки. Например, можно определить пользовательский макрос для задания настраиваемого пути выходных данных как $(CustomOutputPath) и использовать его для определения других переменных. Эта группа свойств содержит такие свойства. Обратите внимание, что в Visual Studio эта группа не заполняется в файле проекта, так как Visual C++ не поддерживает пользовательские макросы для конфигураций. Пользовательские макросы поддерживаются на страницах свойств.

### <a name="per-configuration-propertygroup-elements"></a>Элементы PropertyGroup для отдельных конфигураций

```xml
<PropertyGroup />
```

Существует несколько экземпляров этой группы свойств, по одному на конфигурацию для всех конфигураций проекта. Каждая группа свойств должна иметь одно прикрепленное условие конфигурации. Если отсутствуют какие-либо конфигурации, диалоговое окно **Свойства проекта** будет работать неправильно. В отличие от приведенных выше групп свойств у этой группы метки нет. Она содержит параметры на уровне конфигурации проекта. Эти параметры применяются ко всем файлам, входящим в указанную группу элементов. Здесь происходит инициализация метаданных для определения элемента настройки сборки.

Этот элемент PropertyGroup должен находиться после `<Import Project="$(VCTargetsPath)\Microsoft.Cpp.props" />`, кроме того, перед ним не должно быть другого PropertyGroup без метки (в противном случае изменение свойств проекта будет работать неправильно).

### <a name="per-configuration-itemdefinitiongroup-elements"></a>Элементы ItemDefinitionGroup для отдельных конфигураций

```xml
<ItemDefinitionGroup />
```

Содержит определения элемента. Они должны соответствовать тем же правилам условий, что и элементы PropertyGroup без метки для отдельных конфигураций.

### <a name="itemgroup-elements"></a>Элементы ItemGroup

```xml
<ItemGroup />
```

Содержит элементы (исходные файлы и т. д.) в проекте. Для элементов проекта (то есть типов элементов, которые обрабатываются определениями правил как элементы проекта) условия не поддерживаются.

Метаданные должны иметь условия конфигурации для каждой конфигурации, даже если они все одинаковые. Пример:

```xml
<ItemGroup>
  <ClCompile Include="stdafx.cpp">
    <TreatWarningAsError Condition="‘$(Configuration)|$(Platform)’==’Debug|Win32’">true</TreatWarningAsError>
    <TreatWarningAsError Condition="‘$(Configuration)|$(Platform)’==’Debug|x64’">true</TreatWarningAsError>
  </ClCompile>
</ItemGroup>
```

Сейчас система проектов Visual C++ не поддерживает подстановочные знаки в элементах проекта.

```xml
<ItemGroup>
  <ClCompile Include="*.cpp"> <!--Error-->
</ItemGroup>
```

Сейчас система проектов Visual C++ не поддерживает макросы в элементах проекта.

```xml
<ItemGroup>
  <ClCompile Include="$(IntDir)\generated.cpp"> <!--not guaranteed to work in all scenarios-->
</ItemGroup>
```

Ссылки указываются в ItemGroup и имеют следующие ограничения:

- Ссылки не поддерживают условия.

- Метаданные ссылок не поддерживают условия.

### <a name="microsoftcpptargets-import-element"></a>Элемент Microsoft.Cpp.targets Import

```xml
<Import Project="$(VCTargetsPath)\Microsoft.Cpp.targets" />
```

Определяет (напрямую или с помощью операций импорта) целевые объекты Visual C++, такие как сборка, очистка и т. п.

### <a name="extensiontargets-importgroup-element"></a>Элемент ExtensionTargets ImportGroup

```xml
<ImportGroup Label="ExtensionTargets" />
```

Эта группа содержит операции импорта для целевых файлов настройки сборки.

## <a name="impact-of-incorrect-ordering"></a>Влияние неправильного порядка

Интегрированная среда разработки Visual Studio требует, чтобы файл проекта был упорядочен описанным выше образом. Например, при определении значения свойства на страницах свойств интегрированная среда разработки обычно помещает определение свойства в группу свойств с пустой меткой. Это гарантирует, что значения по умолчанию, обозначенные на системных страницах свойств, переопределяются пользовательскими значениями. Аналогичным образом целевые файлы импортируются в конце, так как они используют свойства, определенные выше, а сами обычно не определяют свойства. Пользовательские страницы свойств тоже импортируются после системных страниц свойств (включаемых посредством **Microsoft.Cpp.props**). Это гарантирует, что пользователь может переопределить любые значения по умолчанию, указанные на системных страницах свойств.

Если файл VCXPROJ не соответствует данному макету, результаты сборки могут отличаться от ожидаемых. Например, если вы по ошибке импортируете системную страницу свойств после страниц свойств, определенных пользователем, пользовательские параметры будут переопределены системными страницами свойств.

Даже процесс, реализуемый в интегрированной среде разработки во время разработки, в некоторой степени зависит от правильного порядка элементов. Например, если у файла VCXPROJ нет группы импорта `PropertySheets`, интегрированная среда разработки может быть не в состоянии определить, куда поместить новую страницу свойств, созданную пользователем в **диспетчере свойств**. Это может привести к переопределению пользовательской страницы системной. Хотя эвристика, используемая интегрированной средой разработки, может преодолеть небольшие несоответствия в макете файла VCXPROJ, настоятельно рекомендуется не отклоняться от приведенной выше структуры.

## <a name="how-the-ide-uses-element-labels"></a>Использование меток элемента интегрированной средой разработки

Когда вы задаете свойство **UseOfAtl** на общей странице свойств в интегрированной среде разработки, оно записывается в группу свойств конфигурации в файле проекта, а свойство **TargetName** той же страницы свойств записывается в группу свойств без метки для отдельных конфигураций. Visual Studio ищет в XML-файле страницы свойств сведения о том, куда нужно записать каждое свойство. Для страницы свойств**Общие** (при условии что вы используете англоязычную версию выпуска Visual Studio Enterprise) это файл `%ProgramFiles(x86)%\Microsoft Visual Studio\2017\Enterprise\Common7\IDE\VC\VCTargets\1033\general.xml`. XML-файл правил страницы свойств определяет статические данные о правиле и всех его свойствах. В эти данные входит предпочтительное положение свойства правила в конечном файле (файл, куда будет записано его значение). Предпочтительное положение задается атрибутом Label в элементах файла проекта.

## <a name="property-sheet-layout"></a>Макет страницы свойств

В следующем фрагменте XML-кода приведен минимальный макет файла (PROPS) страницы свойств. Он похож на файл VCXPROJ, поэтому функции элементов PROPS можно определить из приведенных выше сведений.

```xml
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ImportGroup Label="PropertySheets" />
  <PropertyGroup Label="UserMacros" />
  <PropertyGroup />
  <ItemDefinitionGroup />
  <ItemGroup />
</Project>
```

Чтобы создать собственную страницу свойств, скопируйте один из файлов PROPS в папке VCTargets и измените его необходимым образом. Для выпуска Visual Studio 2017 Enterprise путем VCTargets по умолчанию является `%ProgramFiles%\Microsoft Visual Studio\2017\Enterprise\Common7\IDE\VC\VCTargets`.

## <a name="see-also"></a>См. также

[Настройка компилятора C++ и свойства сборки в Visual Studio](../working-with-project-properties.md)<br/>
[XML-файлы страницы свойств](property-page-xml-files.md)
