---
title: Блоки описания
description: NMAKE использует блоки описания для привязки целевых объектов, зависимостей и команд в файле Makefile.
ms.date: 10/29/2019
helpviewer_keywords:
- description blocks
- NMAKE program, description blocks
- blocks, description
ms.assetid: 1321f228-d389-40ac-b0cd-4f6e9293602b
ms.openlocfilehash: 8f7bf3a26eadde91471e8b45ec26e0abea906244
ms.sourcegitcommit: a1676bf6caae05ecd698f26ed80c08828722b237
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/29/2020
ms.locfileid: "91506596"
---
# <a name="description-blocks"></a>Блоки описания

Блоки Description формируют ядро файла makefile. Они описывают *целевые объекты*, файлы для создания и их *зависимости*, а также файлы, необходимые для создания целевых объектов. Блок описания может включать *команды*, которые описывают, как создать целевые объекты из зависимостей. Блок описания — это строка зависимости, при необходимости за которой следует блок команд:

```makefile
targets... : dependents...
    commands...
```

## <a name="dependency-lines"></a>Линии зависимостей

В *строке зависимости* указывается один или несколько целевых объектов, а также ноль или более зависимых элементов. Если целевой объект не существует или имеет более раннюю отметку времени, чем зависимый, NMAKE выполняет команды в блоке команд. NMAKE также выполняет блок команды, если целевым объектом является [псеудотаржет](#pseudotargets). Ниже приведен пример строки зависимости:

```makefile
hi_bye.exe : hello.obj goodbye.obj helper.lib
```

В этой строке зависимости `hi_bye.exe` целевым объектом является. Его зависимости: `hello.obj` , `goodbye.obj` и `helper.lib` . Строка зависимости указывает программе NMAKE построить целевой объект каждый раз `hello.obj` , когда, `goodbye.obj` или `helper.lib` изменился более поздней, чем `hi_bye.exe` .

Целевой объект должен находиться в начале строки. Отступ не может быть таким же, как пробелы или символы табуляции. Используйте двоеточие ( `:` ), чтобы разделить цели от зависимых объектов. Пробелы или символы табуляции разрешены между конечными объектами, разделителем двоеточия ( `:` ) и зависимыми. Чтобы разделить линию зависимости, используйте обратную косую черту ( `\` ) после целевого или зависимого объекта.

Перед выполнением блоков команд NMAKE сканирует все зависимости и применимые правила вывода для построения *дерева зависимостей*. Дерево зависимостей задает шаги, необходимые для полного обновления целевого объекта. Программа NMAKE проверяет рекурсивно, является ли зависимый объект целевым объектом в другом списке зависимостей. После построения дерева зависимостей программа NMAKE проверяет метки времени. Если все зависимости в дереве новее целевого объекта, NMAKE создает целевой объект.

## <a name="targets"></a><a name="targets"></a> Целевые объекты

Раздел целевых объектов в строке зависимости указывает одну или несколько целевых объектов. Целевым объектом может быть любое допустимое имя файла, каталога или [псеудотаржет](#pseudotargets). Разделите несколько целевых объектов, используя один или несколько пробелов или символов табуляции. Целевые объекты не учитывают регистр. Пути разрешены с именами файлов. Длина целевого объекта и его пути не может превышать 256 символов. Если целевой объект, предшествующий двоеточию, является одним символом, используйте разделительный пробел. В противном случае NMAKE интерпретирует сочетание буквы и двоеточия как спецификатор диска.

### <a name="multiple-targets"></a><a name="multiple-targets"></a> Несколько целевых объектов

NMAKE вычисляет несколько целевых объектов в одной зависимости, как если бы они были указаны в отдельном блоке описания.

Например, это правило:

```makefile
bounce.exe leap.exe : jump.obj
   echo Building...
```

вычисляется следующим образом:

```makefile
bounce.exe : jump.obj
   echo Building...

leap.exe : jump.obj
   echo Building...
```

### <a name="cumulative-dependencies"></a><a name="cumulative-dependencies"></a> Совокупные зависимости

Зависимости являются кумулятивными в блоке описания, если целевой объект повторяется.

Например, этот набор правил

```makefile
bounce.exe : jump.obj
bounce.exe : up.obj
   echo Building bounce.exe...
```

вычисляется следующим образом:

```makefile
bounce.exe : jump.obj up.obj
   echo Building bounce.exe...
```

При наличии нескольких целевых объектов в нескольких строках зависимости в одном блоке описания NMAKE вычисляет их, как если бы они были указаны в отдельном блоке описания. Однако только целевые объекты в последней строке зависимости используют блок Commands. NMAKE пытается использовать правило вывода для других целевых объектов.

Например, этот набор правил

```makefile
leap.exe bounce.exe : jump.obj
bounce.exe climb.exe : up.obj
   echo Building bounce.exe...
```

вычисляется следующим образом:

```makefile
leap.exe : jump.obj
# invokes an inference rule

bounce.exe : jump.obj up.obj
   echo Building bounce.exe...

climb.exe : up.obj
   echo Building bounce.exe...
```

### <a name="targets-in-multiple-description-blocks"></a><a name="targets-in-multiple-description-blocks"></a> Целевые объекты в нескольких блоках описания

Чтобы обновить целевой объект в нескольких блоках описания с помощью разных команд, укажите два последовательных двоеточия (::) между целями и зависимыми объектами.

```makefile
target.lib :: one.asm two.asm three.asm
    ml one.asm two.asm three.asm
    lib target one.obj two.obj three.obj
target.lib :: four.c five.c
    cl /c four.c five.c
    lib target four.obj five.obj
```

### <a name="dependency-side-effects"></a><a name="dependency-side-effects"></a> Побочные эффекты зависимости

Вы можете указать целевой объект с помощью двоеточия (:) в двух строках зависимости в разных местах. Если команды появляются только после одной строки, NMAKE интерпретирует зависимости, как если бы строки были смежными или объединенными. Он не вызывает правило вывода для зависимости, не имеющей команд. Вместо этого NMAKE предполагает, что зависимости относятся к одному блоку описания, и выполняет команды, указанные в другой зависимости. Рассмотрим этот набор правил:

```makefile
bounce.exe : jump.obj
   echo Building bounce.exe...

bounce.exe : up.obj
```

вычисляется следующим образом:

```makefile
bounce.exe : jump.obj up.obj
   echo Building bounce.exe...
```

Этот результат не возникает, если используется двойное двоеточие ( `::` ). Например, этот набор правил:

```makefile
bounce.exe :: jump.obj
   echo Building bounce.exe...

bounce.exe :: up.obj
```

вычисляется следующим образом:

```makefile
bounce.exe : jump.obj
   echo Building bounce.exe...

bounce.exe : up.obj
# invokes an inference rule
```

### <a name="pseudotargets"></a><a name="pseudotargets"></a> псеудотаржетс

*Псеудотаржет* — это метка, используемая вместо имени файла в строке зависимости. Он интерпретируется как файл, который не существует, и поэтому устарел. В NMAKE предполагается, что метка времени псеудотаржет совпадает с последней из всех зависимых элементов. Если он не имеет зависимых объектов, то предполагается текущее время. Если псеудотаржет используется в качестве целевого объекта, его команды всегда выполняются. Псеудотаржет, используемый в качестве зависимого, также должен быть целевым объектом в другой зависимости. Однако для этой зависимости не требуется блокировать команды.

Имена псеудотаржет соответствуют правилам синтаксиса filename для целевых объектов. Однако если имя не имеет расширения, оно может превышать ограничение в 8 символов для имен файлов и может иметь длину до 256 символов.

Псеудотаржетс удобно использовать, если требуется, чтобы программа NMAKE была автоматически строить несколько целевых объектов. NMAKE создает только целевые объекты, указанные в командной строке. Или, если не указан целевой объект командной строки, он создает только первый целевой объект в первой зависимости в файле Makefile. Вы можете указать NMAKE создавать несколько целевых объектов, не перечисляя их по отдельности в командной строке. Напишите блок описания с зависимостью, содержащей псеудотаржет, и перечислите целевые объекты, которые требуется собрать как зависимые. Затем поместите этот блок описания сначала в файл makefile или укажите псеудотаржет в командной строке NMAKE.

В этом примере UPDATE является псеудотаржет.

```makefile
UPDATE : *.*
!COPY $** c:\product\release
```

При оценке обновления NMAKE копирует все файлы из текущего каталога в указанный диск и каталог.

В следующем файле Makefile псеудотаржет `all` создает `project1.exe` и, и, `project2.exe` Если `all` в командной строке не указано ни одного целевого объекта. Псеудотаржет `setenv` изменяет переменную среды LIB перед `.exe` обновлением файлов:

```makefile
all : setenv project1.exe project2.exe

project1.exe : project1.obj
    LINK project1;

project2.exe : project2.obj
    LINK project2;

setenv :
    set LIB=\project\lib
```

## <a name="dependents"></a><a name="dependents"></a> Зависимые объекты

В строке зависимости укажите ноль или более зависимых элементов после двоеточия ( `:` ) или двойного двоеточия ( `::` ), используя любое допустимое имя файла или [псеудотаржет](#pseudotargets). Разделите несколько зависимых объектов, используя один или несколько пробелов или символов табуляции. Зависимые элементы не учитывают регистр. Пути разрешены с именами файлов.

### <a name="inferred-dependents"></a><a name="inferred-dependents"></a> Выводимые зависимые объекты

Наряду с зависимыми, которые явно перечислены в строке зависимости, NMAKE может считать *выводимую зависимость*. Выводимый зависимый объект является производным от правила вывода и вычисляется перед явными зависимостями. Если выводимая зависимость устарела по сравнению с ее целевым объектом, NMAKE вызывает блок команды для зависимости. Если выводимая зависимость не существует или устарела по сравнению с собственными зависимыми элементами, NMAKE сначала обновляет выводимую зависимость. Дополнительные сведения о выводимых зависимых элементах см. в разделе [правила вывода](inference-rules.md).

### <a name="search-paths-for-dependents"></a><a name="search-paths-for-dependents"></a> Пути поиска для зависимых объектов

Можно указать необязательный путь поиска для каждого зависимого объекта. Ниже приведен синтаксис для указания набора каталогов для поиска.

> **{**_Directory_ \[ **;** _Каталог_...] **}**_зависимый_

Заключите имена каталогов в фигурные скобки ( `{ }` ). Разделяйте несколько каталогов точкой с запятой ( `;` ). Пробелы и символы табуляции не допускаются. NMAKE ищет зависимый объект в текущем каталоге, а затем в списке каталогов в указанном порядке. Макрос можно использовать для указания части или всего пути поиска. Только указанный зависимый объект использует этот путь поиска.

#### <a name="directory-search-path-example"></a>Пример пути поиска в каталоге

Эта линия зависимости показывает, как создать спецификацию каталога для поиска:

```makefile
reverse.exe : {\src\omega;e:\repo\backwards}retro.obj
```

Целевой объект `reverse.exe` имеет один зависимый, `retro.obj` . Заключенный в фигурные скобки список указывает два каталога. Сначала NMAKE ищет `retro.obj` в текущем каталоге. Если это не так, NMAKE выполняет поиск в `\src\omega` каталоге, а затем в `e:\repo\backwards` каталоге.

## <a name="see-also"></a>См. также раздел

[Справочник по NMAKE](nmake-reference.md)
