---
title: Внутренние компоненты MSBuild для проектов C++ в Visual Studio
description: Файлы поддержки, свойства и целевые объекты, используемые MSBuild для проектов Visual Studio C++.
ms.date: 10/14/2020
helpviewer_keywords:
- MSBuild overview
ms.openlocfilehash: e99b9a428d9c6149debc06e1dfab7a69c3590196
ms.sourcegitcommit: 9c2b3df9b837879cd17932ae9f61cdd142078260
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/29/2020
ms.locfileid: "92924384"
---
# <a name="msbuild-internals-for-c-projects"></a>Внутренние компоненты MSBuild для проектов C++

Когда вы задаете свойства проекта в интегрированной среде разработки, а затем сохраняете проект, Visual Studio записывает параметры проекта в файл проекта. Файл проекта содержит параметры, уникальные для проекта. Однако он не содержит все параметры, необходимые для сборки проекта. Файл проекта содержит `Import` элементы, включающие в себя набор дополнительных *файлы поддержки.* Файлы поддержки содержат оставшиеся свойства, целевые объекты и параметры, необходимые для построения проекта.

Большинство целевых объектов и свойств в файлах поддержки существуют исключительно для реализации системы построения. В этой статье обсуждаются полезные целевые объекты и свойства, которые можно указать в командной строке MSBuild. Чтобы найти дополнительные целевые объекты и свойства, просмотрите файлы в каталогах файлов поддержки.

## <a name="support-file-directories"></a>Каталоги файлов поддержки

По умолчанию основные файлы поддержки Visual Studio расположены в указанных ниже каталогах. Эти сведения относятся к конкретной версии.

::: moniker range=">=msvc-160"

### <a name="visual-studio-2019"></a>Visual Studio 2019

- *`%VSINSTALLDIR%MSBuild\Microsoft\VC\<version>\`*

  Содержит основные файлы целевых (с расширением TARGETS) и файлы свойств (с расширением PROPS), используемые целевыми объектами. По умолчанию макрос $(VCTargetsPath) ссылается на этот каталог. *`<version>`* Заполнитель ссылается на версию Visual Studio: V160 для Visual studio 2019, V150 для Visual studio 2017.

- *`%VSINSTALLDIR%MSBuild\Microsoft\VC\<version>\Platforms\<platform>\`*

  Содержит файлы цель и свойство платформы, которые переопределяют целевые объекты и свойства в родительском каталоге. Этот каталог также содержит DLL-файл, который определяет задачи, используемые целевыми объектами в данном каталоге. *`<platform>`* Заполнитель представляет ПОДКАТАЛОГ ARM, ARM64, Win32 или x64.

- *`%VSINSTALLDIR%MSBuild\Microsoft\VC\<version>\Platforms\<platform>\PlatformToolsets\<toolset>\`*

  Содержит каталоги, позволяющие сборке создавать приложения на языке C++ с помощью указанного *`<toolset>`* . *`<platform>`* Заполнитель представляет ПОДКАТАЛОГ ARM, ARM64, Win32 или x64. *`<toolset>`* Заполнитель представляет подкаталог набора инструментов.

::: moniker-end

::: moniker range=">=msvc-150"

### <a name="visual-studio-2017"></a>Visual Studio 2017

- *`%VSINSTALLDIR%Common7\IDE\VC\VCTargets\`*

  Содержит основные целевые файлы ( *`.targets`* ) и файлы свойств ( *`.props`* ), используемые целевыми объектами. По умолчанию `$(VCTargetsPath)` макрос ссылается на этот каталог.

- *`%VSINSTALLDIR%Common7\IDE\VC\VCTargets\Platforms\<platform>\`*

  Содержит файлы цель и свойство платформы, которые переопределяют целевые объекты и свойства в родительском каталоге. Этот каталог также содержит DLL-файл, который определяет задачи, используемые целевыми объектами в данном каталоге. *`<platform>`* Заполнитель представляет ПОДКАТАЛОГ ARM, ARM64, Win32 или x64.

- *`%VSINSTALLDIR%Common7\IDE\VC\VCTargets\Platforms\<platform>\PlatformToolsets\<toolset>\`*

  Содержит каталоги, позволяющие сборке создавать приложения на языке C++ с помощью указанного *`<toolset>`* . *`<platform>`* Заполнитель представляет ПОДКАТАЛОГ ARM, Win32 или x64. *`<toolset>`* Заполнитель представляет подкаталог набора инструментов.

::: moniker-end

### <a name="visual-studio-2015-and-earlier"></a>Visual Studio 2015 и более ранние версии

- *`<drive>:\Program Files (x86)\MSBuild\Microsoft.Cpp\v4.0\<version>\`*

  Содержит основные файлы целевых (с расширением TARGETS) и файлы свойств (с расширением PROPS), используемые целевыми объектами. По умолчанию макрос $(VCTargetsPath) ссылается на этот каталог.

- *`<drive>:\Program Files (x86)\MSBuild\Microsoft.Cpp\v4.0\<version>\Platforms\<platform>\`*

  Содержит файлы цель и свойство платформы, которые переопределяют целевые объекты и свойства в родительском каталоге. Этот каталог также содержит DLL-файл, который определяет задачи, используемые целевыми объектами в данном каталоге. *`<platform>`* Заполнитель представляет ПОДКАТАЛОГ ARM, Win32 или x64.

- *`<drive>:\Program Files (x86)\MSBuild\Microsoft.Cpp\v4.0\<version>\Platforms\<platform>\PlatformToolsets\<toolset>\`*

  Содержит каталоги, позволяющие сборке создавать приложения на языке C++ с помощью указанного *`<toolset>`* . *`<version>`* Заполнитель — V110 для Visual studio 2012, v120 для Visual Studio 2013 и V140 для Visual studio 2015. *`<platform>`* Заполнитель представляет ПОДКАТАЛОГ ARM, Win32 или x64. *`<toolset>`* Заполнитель представляет подкаталог набора инструментов. Например, это V140 для создания приложений Windows с помощью набора инструментов Visual Studio 2015. Или v120_xp для сборки для Windows XP с помощью набора инструментов Visual Studio 2013.

- *`<drive>:\Program Files (x86)\MSBuild\Microsoft.Cpp\v4.0\Platforms\<platform>\PlatformToolsets\<toolset>\`*

  Пути, позволяющие сборке создавать приложения Visual Studio 2008 или Visual Studio 2010, не включают *`<version>`* . В этих версиях *`<platform>`* заполнитель представляет подкаталог Itanium, Win32 или x64. *`<toolset>`* Заполнитель представляет подкаталог набора инструментов V90 или V100.

## <a name="support-files"></a>Файлы поддержки

Каталоги файлов поддержки содержат файлы со следующими расширениями:

| Расширение | Описание |
| --------- | ----------- |
| *`.targets`* | Содержит `Target` элементы XML, которые задают задачи, выполняемые целевым объектом. Может также содержать `PropertyGroup`, `ItemGroup`, `ItemDefinitionGroup`, и определяемых пользователем `Item` элементов, используемых для назначения параметров задачи файлы и параметры командной строки.<br /><br /> Дополнительные сведения см. в разделе [элемент Target (MSBuild)](/visualstudio/msbuild/target-element-msbuild). |
| *`.props`* | Содержит `Property Group` и определяемых пользователем `Property` XML-элементов, укажите файл и параметры, которые используются во время построения.<br /><br /> Может также содержать `ItemDefinitionGroup` и определяемых пользователем `Item` XML-элементы, задающие Дополнительные параметры. Элементы, определенные в группе определений элементов, похожи на свойства, но недоступны из командной строки. В файлах проекта Visual Studio для представления параметров часто вместо свойств используются элементы.<br /><br /> Дополнительные сведения см. в разделе [элемент ItemGroup (MSBuild)](/visualstudio/msbuild/itemgroup-element-msbuild), [элемент ItemDefinitionGroup (MSBuild)](/visualstudio/msbuild/itemdefinitiongroup-element-msbuild), и [элемент Item (MSBuild)](/visualstudio/msbuild/item-element-msbuild). |
| *`.xml`* | Содержит XML-элементы, объявляющие и инициализирующие элементы пользовательского интерфейса IDE. Например, вкладки свойств, страницы свойств, элементы управления TextBox и элементы управления ListBox.<br /><br /> *`.xml`* Файлы непосредственно поддерживают интегрированную среду разработки, а не MSBuild. Тем не менее присваиваются значения свойств интегрированной среды Разработки для создания свойств и элементов.<br /><br /> Большинство *`.xml`* файлов находятся в подкаталоге, зависящем от языкового стандарта. Например, файлы для региона "Английский (США)" находятся в `$(VCTargetsPath)\1033\` . |

## <a name="user-targets-and-properties"></a>Пользовательские целевые объекты и свойства

Чтобы эффективно использовать MSBuild, он помогает понять, какие свойства и целевые объекты являются полезными и релевантными. Большинство свойств и целевых объектов помогают реализовать систему сборки Visual Studio и, следовательно, не относится к пользователю. В этом разделе описываются ориентированные на пользователей свойства и целевые объекты, о которых стоит знать.

### <a name="platformtoolset-property"></a>Свойство`PlatformToolset`

Свойство `PlatformToolset` определяет, какой набор средств MSVC используется для сборки. По умолчанию используется текущий набор средств. Если это свойство задано, его значение объединяется с литеральными строками для формирования пути. Это каталог, содержащий свойства и целевые файлы, необходимые для построения проекта для конкретной платформы. Версия набора средств платформы, требуемая для сборки, должна быть установлена.

Например, чтобы использовать для сборки приложения средства и библиотеки Visual Studio 2015, присвойте свойству `PlatformToolset` значение `v140`:

`msbuild myProject.vcxproj /p:PlatformToolset=v140`

### <a name="preferredtoolarchitecture-property"></a>Свойство`PreferredToolArchitecture`

`PreferredToolArchitecture` Свойство определяет 32-разрядной или 64-разрядных компилятора и средств, используются ли в сборке. Это свойство не влияет на архитектуру или конфигурацию платформы вывода. По умолчанию MSBuild использует версию компилятора и средств для x86, если это свойство не задано.

Например, чтобы использовать для сборки приложения 64-разрядный компилятор и средства, присвойте свойству `PreferredToolArchitecture` значение `x64`:

`msbuild myProject.vcxproj /p:PreferredToolArchitecture=x64`

### <a name="useenv-property"></a>Свойство`UseEnv`

По умолчанию параметры платформы для текущего проекта переопределение переменных среды PATH, INCLUDE, LIB, LIBPATH, КОНФИГУРАЦИИ и ПЛАТФОРМЫ. Задайте для `UseEnv` свойства значение, **`true`** чтобы гарантировать, что переменные среды не переопределены.

> `msbuild myProject.vcxproj /p:UseEnv=true`

### <a name="targets"></a>Цели

Существуют сотни целевых объектов в файлах поддержки Visual Studio. Однако большинство являются целевых объектов, ориентированных на системы, пользователь может их игнорировать. Большинство системных целевых объектов имеют префикс подчеркивания ( `_` ) или имеют имя, начинающееся с `PrepareFor` , `Compute` , `Before` , `After` , `Pre` или `Post` .

В таблице ниже перечислены несколько полезных целевых объектов, ориентированных на пользователя.

| целевого объекта | Описание |
| ------ | ----------- |
| BscMake | Выполняет программу Microsoft Обзор программы управления информацией bscmake.exe. |
| Сборка | Выполняет построение проекта.<br /><br /> Этот целевой объект является значением по умолчанию для проекта. |
| ClCompile | Выполняет средство компилятора MSVC (cl.exe). |
| Clean | Удаляет временные и промежуточные файлы сборки. |
| LIB | Выполняет программу Microsoft 32-разрядной библиотеки диспетчера lib.exe. |
| Ссылка | Выполняет средство компоновщика MSVC (link.exe). |
| ManifestResourceCompile | Извлекает список ресурсов из манифеста и затем запускает средство компилятор ресурсов Microsoft Windows rc.exe. |
| MIDL | Запускает средство компилятора Microsoft интерфейс определения языка MIDL midl.exe. |
| Перестроение | Выполняет очистку, а затем выполняет построение проекта. |
| ResourceCompile | Запускает средство компилятор ресурсов Microsoft Windows rc.exe. |
| Программа XdcMake | Выполняет программу XML-документации xdcmake.exe. |
| XSD | Запускает средство определения схемы XML xsd.exe. *См. Примечание.* |

> [!NOTE]
> В Visual Studio 2017 и более поздних версий поддержка проектов C++ для файлов **XSD** отмечена как нерекомендуемая. Вы можете продолжать использовать **Microsoft.VisualC.CppCodeProvider** , вручную добавив **CppCodeProvider.dll** в глобальный кэш сборок.

## <a name="see-also"></a>См. также статью

[Справочник по задачам MSBuild](/visualstudio/msbuild/msbuild-task-reference)\
[Задача BscMake](/visualstudio/msbuild/bscmake-task)\
[Задача CL](/visualstudio/msbuild/cl-task)\
[Задача задача CPPClean](/visualstudio/msbuild/cppclean-task)\
[Задача LIB](/visualstudio/msbuild/lib-task)\
[Связать задачу](/visualstudio/msbuild/link-task)\
[Задача MIDL](/visualstudio/msbuild/midl-task)\
[Задача MT](/visualstudio/msbuild/mt-task)\
[Задача RC](/visualstudio/msbuild/rc-task)\
[Задача SetEnv](/visualstudio/msbuild/setenv-task)\
[Задача VCMessage](/visualstudio/msbuild/vcmessage-task)\
[Задача XDCMake](/visualstudio/msbuild/xdcmake-task)
