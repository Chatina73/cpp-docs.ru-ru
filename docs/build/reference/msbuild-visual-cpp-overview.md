---
title: Внутренние компоненты MSBuild для проектов C++ в Visual Studio
ms.date: 05/16/2019
helpviewer_keywords:
- MSBuild overview
ms.assetid: dd258f6f-ab51-48d9-b274-f7ba911d05ca
ms.openlocfilehash: b3348320a1468fea03f39e43cc847f1085f3d319
ms.sourcegitcommit: a10c9390413978d36b8096b684d5ed4cf1553bc8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/17/2019
ms.locfileid: "65837233"
---
# <a name="msbuild-internals-for-c-projects"></a>Внутренние компоненты MSBuild для проектов C++

Когда вы задаете свойства проекта в интегрированной среде разработки, а затем сохраняете проект, Visual Studio записывает параметры проекта в файл проекта. Файл проекта содержит параметры, уникальные для данного проекта, но не содержит все параметры, необходимые для построения проекта. Файл проекта содержит `Import` элементы, включающие в себя набор дополнительных *файлы поддержки.* Файлы поддержки содержат оставшиеся свойства, целевые объекты и параметры, необходимые для построения проекта.

Большинство целевых объектов и свойств в файлах поддержки существуют исключительно для реализации системы построения. В следующем разделе описываются некоторые полезные целевые объекты и свойства, которые можно указать в командной строке MSBuild. Чтобы найти дополнительные целевые объекты и свойства, просмотрите файлы в каталогах файлов поддержки.

## <a name="support-file-directories"></a>Каталоги файлов поддержки

По умолчанию основные файлы поддержки Visual Studio расположены в указанных ниже каталогах. Подкаталоги в каталоге Microsoft Visual Studio используются средой Visual Studio 2017 и более поздних версий, а подкаталоги в каталоге MSBuild — средой Visual Studio 2015 и более ранних версий.

|Каталог|Описание|
|---------------|-----------------|
|*диск*:\Program Files *(x86)* \Microsoft Visual Studio\\*год*\\*выпуск*\Common7\IDE\VC\VCTargets\ <br /><br />*диск*:\Program Files *(x86)* \MSBuild\Microsoft.Cpp (x86)\v4.0\\*версия*\ |Содержит основные файлы целевых (с расширением TARGETS) и файлы свойств (с расширением PROPS), используемые целевыми объектами. По умолчанию макрос $(VCTargetsPath) ссылается на этот каталог.|
|*диск*:\Program Files *(x86)* \Microsoft Visual Studio\\*год*\\*выпуск*\Common7\IDE\VC\VCTargets\Platforms\\*платформа*\ <br /><br />*диск*:\Program Files *(x86)* \MSBuild\Microsoft.Cpp\v4.0\\*версия*\Platforms\\*платформа*\ |Содержит файлы цель и свойство платформы, которые переопределяют целевые объекты и свойства в родительском каталоге. Этот каталог также содержит DLL-файл, который определяет задачи, используемые целевыми объектами в данном каталоге.<br /><br /> Заполнитель *платформа* представляет подкаталог ARM, Win32 или x64.|
|*диск*:\Program Files *(x86)* \Microsoft Visual Studio\\*год*\\*выпуск*\Common7\IDE\VC\VCTargets\Platforms\\*платформа*\PlatformToolsets\\*набор_средств*\ <br /><br />*диск*:\Program Files *(x86)* \MSBuild\Microsoft.Cpp\v4.0\\*версия*\Platforms\\*платформа*\PlatformToolsets\\*набор_средств*\ <br /><br />*диск*:\Program Files *(x86)* \MSBuild\Microsoft.Cpp\v4.0\Platforms\\*платформа*\PlatformToolsets\\*набор_средств*\ |Содержит каталоги, которые обеспечивают сборку приложений C++ с помощью указанного *набора средств*.<br /><br /> Заполнители *год* и *выпуск* используются для Visual Studio 2017 и более поздних выпусков. Заполнитель *версия* представляет подкаталог V110 для Visual Studio 2012, V120 для Visual Studio 2013, V140 для Visual Studio 2015, v141 для Visual Studio 2017 и v142 для Visual Studio 2019. Заполнитель *платформа* представляет подкаталог ARM, Win32 или x64. Заполнитель *набор_средств* представляет подкаталог набора средств, например v140 для сборки приложений Windows с помощью набора средств Visual Studio 2015 или v120_xp для сборки приложений Windows XP с помощью набора средств Visual Studio 2013.<br /><br />Путь, который включает в себя подкаталоги, обеспечивающие сборку приложений Visual Studio 2008 или Visual Studio 2010, не содержит заполнителя *версия*, а заполнитель *платформа* представляет подкаталог Itanium, Win32 или x64. Заполнитель *набор_средств* представляет подкаталог v90 или v100.|

## <a name="support-files"></a>Файлы поддержки

Каталоги файлов поддержки содержат файлы со следующими расширениями:

|Расширение|Описание|
|---------------|-----------------|
|.targets|Содержит `Target` элементы XML, которые задают задачи, выполняемые целевым объектом. Может также содержать `PropertyGroup`, `ItemGroup`, `ItemDefinitionGroup`, и определяемых пользователем `Item` элементов, используемых для назначения параметров задачи файлы и параметры командной строки.<br /><br /> Дополнительные сведения см. в разделе [элемент Target (MSBuild)](/visualstudio/msbuild/target-element-msbuild).|
|.props|Содержит `Property Group` и определяемых пользователем `Property` XML-элементов, укажите файл и параметры, которые используются во время построения.<br /><br /> Может также содержать `ItemDefinitionGroup` и определяемых пользователем `Item` XML-элементы, задающие Дополнительные параметры. Элементы, определенные в группу определений элемента напоминают свойства, но нельзя получить доступ из командной строки. В файлах проекта Visual Studio для представления параметров часто вместо свойств используются элементы.<br /><br /> Дополнительные сведения см. в статьях [Элемент ItemGroup (MSBuild)](/visualstudio/msbuild/itemgroup-element-msbuild), 
[Элемент ItemDefinitionGroup (MSBuild)](/visualstudio/msbuild/itemdefinitiongroup-element-msbuild) и [Элемент Item (MSBuild)](/visualstudio/msbuild/item-element-msbuild).|
|XML|Содержит XML-элементы, объявления и инициализации элементов пользовательского интерфейса интегрированной среды Разработки, например вкладки свойств и страницы свойств и поле и список текстовых полей.<br /><br /> XML-файлы непосредственно поддерживают интегрированную среду Разработки, не MSBuild. Тем не менее присваиваются значения свойств интегрированной среды Разработки для создания свойств и элементов.<br /><br /> Большинство XML-файлы хранятся в подкаталоге языковому стандарту. Например, файлы для региона английский (США) находятся в $(VCTargetsPath) \1033\\.|

## <a name="user-targets-and-properties"></a>Пользовательские целевые объекты и свойства

Для наиболее эффективного использования MSBuild в командной строке, полезно знать, какие свойства и целевые объекты являются полезным и нужным. Большинство свойств и целевых объектов упрощают реализацию системы сборки Visual Studio и поэтому не важны для пользователя. В этом разделе описаны некоторые оправданной свойства, ориентированные на пользователей и целевых объектов.

### <a name="platformtoolset-property"></a>Свойство PlatformToolset

Свойство `PlatformToolset` определяет, какой набор средств MSVC используется для сборки. По умолчанию используется текущий набор средств. Когда это свойство задано, его значение сцепляется со строковыми литералами для формирования пути к каталогу, содержащему файлы свойств и целевых объектов, которые необходимы для сборки проекта для определенной платформы. Версия набора средств платформы, требуемая для сборки, должна быть установлена.

Например, чтобы использовать для сборки приложения средства и библиотеки Visual Studio 2015, присвойте свойству `PlatformToolset` значение `v140`:

`msbuild myProject.vcxproj /p:PlatformToolset=v140`

### <a name="preferredtoolarchitecture-property"></a>Свойство PreferredToolArchitecture

`PreferredToolArchitecture` Свойство определяет 32-разрядной или 64-разрядных компилятора и средств, используются ли в сборке. Это свойство не влияет на вывод архитектура платформы или конфигурации. Если это свойство не задано, по умолчанию MSBuild использует 32-разрядную версию компилятора и средств.

Например, чтобы использовать для сборки приложения 64-разрядный компилятор и средства, присвойте свойству `PreferredToolArchitecture` значение `x64`:

`msbuild myProject.vcxproj /p:PreferredToolArchitecture=x64`

### <a name="useenv-property"></a>Свойство UseEnv

По умолчанию параметры платформы для текущего проекта переопределение переменных среды PATH, INCLUDE, LIB, LIBPATH, КОНФИГУРАЦИИ и ПЛАТФОРМЫ. Чтобы запретить переопределение переменных среды, присвойте свойству `UseEnv` значение **true**.

`msbuild myProject.vcxproj /p:UseEnv=true`

### <a name="targets"></a>Целевые объекты

Существуют сотни целевых объектов в файлах поддержки Visual Studio. Однако большинство являются целевых объектов, ориентированных на системы, пользователь может их игнорировать. Большинство целевых объектов системы имеют префикс в виде символа подчеркивания (_) или иметь имя, которое начинается с «PrepareFor», «Вычисления», «До», «После», «Pre» или «Post».

В таблице ниже перечислены несколько полезных целевых объектов, ориентированных на пользователя.

|целевого объекта|Описание|
|------------|-----------------|
|BscMake|Выполняет программу Microsoft Обзор программы управления информацией bscmake.exe.|
|Построить|Выполняет построение проекта.<br /><br /> Это является целевым объектом по умолчанию для проекта.|
|ClCompile|Выполняет средство компилятора MSVC (cl.exe).|
|Очистить|Удаляет временные и промежуточные файлы сборки.|
|LIB|Выполняет программу Microsoft 32-разрядной библиотеки диспетчера lib.exe.|
|Ссылка|Выполняет средство компоновщика MSVC (link.exe).|
|ManifestResourceCompile|Извлекает список ресурсов из манифеста и затем запускает средство компилятор ресурсов Microsoft Windows rc.exe.|
|MIDL|Запускает средство компилятора Microsoft интерфейс определения языка MIDL midl.exe.|
|Перестроить|Выполняет очистку, а затем выполняет построение проекта.|
|ResourceCompile|Запускает средство компилятор ресурсов Microsoft Windows rc.exe.|
|Программа XdcMake|Выполняет программу XML-документации xdcmake.exe.|
|XSD|Запускает средство определения схемы XML xsd.exe. *См. примечание ниже.*|

> [!NOTE]
> В Visual Studio 2017 и более поздних версий поддержка проектов C++ для файлов **XSD** отмечена как нерекомендуемая. Вы можете продолжать использовать **Microsoft.VisualC.CppCodeProvider**, вручную добавив **CppCodeProvider.dll** в глобальный кэш сборок.

## <a name="see-also"></a>См. также

[Справочник по задачам MSBuild](/visualstudio/msbuild/msbuild-task-reference)<br/>
[Задача BscMake](/visualstudio/msbuild/bscmake-task)<br/>
[Задача CL](/visualstudio/msbuild/cl-task)<br/>
[Задача CPPClean](/visualstudio/msbuild/cppclean-task)<br/>
[Задача LIB](/visualstudio/msbuild/lib-task)<br/>
[Связывание задачи](/visualstudio/msbuild/link-task)<br/>
[Задача MIDL](/visualstudio/msbuild/midl-task)<br/>
[Задача MT](/visualstudio/msbuild/mt-task)<br/>
[Задача RC](/visualstudio/msbuild/rc-task)<br/>
[Задача SetEnv](/visualstudio/msbuild/setenv-task)<br/>
[Задача VCMessage](/visualstudio/msbuild/vcmessage-task)<br/>
[Задача XDCMake](/visualstudio/msbuild/xdcmake-task)<br/>
