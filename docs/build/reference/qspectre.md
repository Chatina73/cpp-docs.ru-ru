---
title: /Qspectre
ms.date: 10/12/2018
f1_keywords:
- /Qspectre
helpviewer_keywords:
- /Qspectre
ms.openlocfilehash: e44416a44a9f772c17bc734d26c62ff87be775c8
ms.sourcegitcommit: a10c9390413978d36b8096b684d5ed4cf1553bc8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/17/2019
ms.locfileid: "65837418"
---
# <a name="qspectre"></a>/Qspectre

Настраивает создание компилятором инструкций для устранения некоторых уязвимостей Spectre варианта 1.

## <a name="syntax"></a>Синтаксис

> **/Qspectre**

## <a name="remarks"></a>Примечания

Параметр **/Qspectre** доступен в Visual Studio 2017 версии 15.5.5 и более поздних версий, а также в Visual Studio 2015 с обновлением 3 посредством исправления [KB 4338871](https://support.microsoft.com/help/4338871/visual-studio-2015-update-3-spectre-variant-1-toolset-qspectre). При его указании компилятор добавляет инструкции для устранения некоторых [уязвимостей Spectre](https://spectreattack.com/spectre.pdf). Эти уязвимости, называемые *атаками по сторонним каналам, направленными на механизм спекулятивного выполнения*, затрагивают множество операционных систем и современных процессоров, включая процессоры от Intel, AMD и ARM.

Параметр **/Qspectre** по умолчанию отключен.

Изначально параметр **/Qspectre** работал только применительно к оптимизированному коду. В Visual Studio 2017 версии 15.7 и более поздних параметр **/Qspectre** поддерживается на всех уровнях оптимизации.

Для библиотек Microsoft Visual C++ также доступны версии с устранением уязвимостей Spectre. Библиотеки с устранением уязвимостей Spectre для Visual Studio 2017 и более поздних версий можно скачать в Visual Studio Installer. Они находятся на вкладке **Отдельные компоненты** в разделе **Компиляторы, средства сборки и среды выполнения**. В их именах есть строка "Libs for Spectre" (Библиотеки для Spectre). Как библиотеки DLL, так и статические библиотеки с включенной защитой доступны для подмножества сред выполнения Visual C++: VC++ start-up code, vcruntime140, msvcp140, concrt140 и vcamp140. Библиотеки DLL поддерживаются только для локального развертывания приложений; содержимое распространяемого компонента библиотек сред выполнения для Visual C++ 2017 и более поздних версий не изменилось. Вы также можете установить библиотеки с защитой от уязвимостей Spectre для MFC и ATL. Они находятся на вкладке **Отдельные компоненты** в разделе **Пакеты SDK, библиотеки и платформы**.

### <a name="applicability"></a>Применимость

Если ваш код работает с данными, пересекающими границу доверия, рекомендуется как можно скорее перестроить и повторно развернуть код с использованием параметра **/Qspectre**. Примером такого кода может быть код, загружающий ненадежные входные данные, которые могут повлиять на выполнение, например код, который выполняет удаленные вызовы процедур, анализирует ненадежные входные данные или файлы либо использует другие локальные интерфейсы межпроцессного взаимодействия. Стандартных приемов организации песочницы может быть недостаточно. Песочницы следует тщательно проверять, чтобы убедиться в том, что код не пересекает границу доверия.

### <a name="availability"></a>Доступность

Параметр **/Qspectre** доступен в Visual Studio 2017 версии 15.5.5 и во всех обновлениях для компиляторов Microsoft MSVC (MSVC), выпущенных с 23 января 2018 г. Используйте Visual Studio Installer, чтобы обновить компилятор и установить библиотеки с устраненными уязвимостями Spectre как отдельные компоненты. Параметр **/Qspectre** также доступен в Visual Studio 2015 с обновлением 3 посредством исправления. Дополнительные сведения см. в [статье базы знаний 4338871](https://support.microsoft.com/help/4338871).

Во всех версиях 15.5 Visual Studio 2017 и во всех предварительных версиях 15.6 Visual Studio 2017 есть недокументированный параметр **/d2guardspecload**, который действует так же, как действовал изначально параметр **/Qspectre**. С помощью параметра **/d2guardspecload** можно применять к коду те же средства защиты в этих версиях компилятора. Обновите сборку, чтобы применить параметр **/Qspectre** в поддерживающих его компиляторах. В более поздних версиях компилятора параметр **/Qspectre** может также устранять новые уязвимости.

### <a name="effect"></a>Действие

Параметр **/Qspectre** создает код, в котором устраняется вариант 1 уязвимости Specter: "Обход проверки границ", [CVE-2017-5753](https://nvd.nist.gov/vuln/detail/CVE-2017-5753). Для этого вставляются инструкции, которые препятствуют спекулятивному выполнению кода. Конкретные инструкции, препятствующие спекулятивному выполнению, зависят от процессора и его микроархитектуры. В будущих версиях компилятора они могут меняться.

Когда параметр **/Qspectre** включен, компилятор пытается выявить случаи, в которых в результате спекулятивного выполнения могут обходиться проверки границ, и вставляет инструкции для защиты от обхода. Важно отметить, что возможности компилятора по выявлению уязвимостей варианта 1 ограничены. Гарантии того, что все случаи таких уязвимостей будут устранены с помощью параметра **/Qspectre**, нет.

### <a name="performance-impact"></a>Влияние на производительность

В случае с рядом очень больших баз кода снижение производительности в результате использования параметра **/Qspectre** оказалось пренебрежимо малым, однако гарантии того, что при применении **/Qspectre** производительность вашего кода не снизится, нет. Чтобы определить последствия, следует провести тесты производительности. Если точно известно, что в критическом с точки зрения производительности блоке или цикле устранение уязвимостей не требуется, его можно выборочно отключить с помощью директивы [__declspec(spectre(nomitigation))](../../cpp/spectre.md). Эта директива недоступна в компиляторах, поддерживающих только параметр **/d2guardspecload**.

### <a name="required-libraries"></a>Требуемые библиотеки

Параметр компилятора **/Qspectre** создает код, с которым неявно связываются версии библиотек сред выполнения, предназначенных для устранения уязвимостей Spectre. Эти библиотеки представляют собой необязательные компоненты, которые необходимо установить с помощью Visual Studio Installer:

- Библиотеки MSVC версии *номера_версий* для Spectre \[(32- и 64-разрядные) | (ARM) | (ARM64)]
- Visual C++ ATL для \[(x86/x64) | ARM | ARM64] с устранением уязвимостей Spectre
- Visual C++ MFC для \[x86/x64 | ARM | ARM64] с устранением уязвимостей Spectre

Если при сборке кода используется параметр **/Qspectre**, но эти библиотеки не установлены, система сборки выдает **предупреждение MSB8038: устранение рисков Spectre включено, однако библиотеки Spectre с устраненными рисками не найдены**. Если не удается выполнить сборку кода MFC или ATL, причем компоновщик выдает такую ошибку, как **неустранимая ошибка LNK1104: не удается открыть файл oldnames.lib**, причина может быть в отсутствии этих библиотек.

### <a name="additional-information"></a>Дополнительные сведения

Дополнительные сведения см. в [руководстве Microsoft Security Advisory по устранению уязвимостей спекулятивного выполнения по сторонним каналам (ADV180002)](https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/ADV180002). Доступны также руководства от Intel: [Speculative Execution Side Channel Mitigations](https://software.intel.com/sites/default/files/managed/c5/63/336996-Speculative-Execution-Side-Channel-Mitigations.pdf) (Устранение уязвимостей спекулятивного выполнения по сторонним каналам) и ARM: [Cache Speculation Side-channels](https://developer.arm.com/-/media/Files/pdf/Cache_Speculation_Side-channels.pdf) (Сторонние каналы спекулятивного кэширования). Обзор способов устранения уязвимостей Spectre и Meltdown в Windows см. в записи [Understanding the performance impact of Spectre and Meltdown mitigations on Windows Systems](https://cloudblogs.microsoft.com/microsoftsecure/2018/01/09/understanding-the-performance-impact-of-spectre-and-meltdown-mitigations-on-windows-systems/) (Влияние устранения уязвимостей Spectre и Meltdown на производительность систем Windows) в блоге Microsoft Secure. Общие сведения об устранении уязвимости Spectre в MSVC см. в записи [Spectre mitigations in MSVC](https://blogs.msdn.microsoft.com/vcblog/2018/01/15/spectre-mitigations-in-msvc./) (Устранение уязвимости Spectre в MSVC) в блоге команды разработчиков Visual C++.

### <a name="to-set-this-compiler-option-in-the-visual-studio-development-environment"></a>Установка данного параметра компилятора в среде разработки Visual Studio

1. Откройте диалоговое окно **Страницы свойств** проекта. Подробнее см. в статье [Настройка компилятора C++ и свойства сборки в Visual Studio](../working-with-project-properties.md).

1. Перейдите на страницу свойств **Свойства конфигурации** > **C/C++** > **Командная строка**.

1. Введите параметр компилятора **/Qspectre** в поле **Дополнительные параметры**. Чтобы применить изменение, нажмите кнопку **ОК**.

### <a name="to-set-this-compiler-option-programmatically"></a>Установка данного параметра компилятора программным способом

- См. раздел <xref:Microsoft.VisualStudio.VCProjectEngine.VCCLCompilerTool.AdditionalOptions%2A>.

## <a name="see-also"></a>См. также

[Параметры /Q (низкоуровневые операции)](q-options-low-level-operations.md)<br/>
[Параметры компилятора MSVC](compiler-options.md)<br/>
[Синтаксис командной строки компилятора MSVC](compiler-command-line-syntax.md)
