---
title: /Qspectre
ms.date: 10/12/2018
f1_keywords:
- VC.Project.VCCLCompilerTool.SpectreMitigation
helpviewer_keywords:
- /Qspectre
ms.openlocfilehash: 2b784e464f98ae6a1f9285f799d903ae689bf6d5
ms.sourcegitcommit: 0867d648e0955ebad7260b5fbebfd6cd4d58f3c7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/19/2019
ms.locfileid: "68340991"
---
# <a name="qspectre"></a>/Qspectre

Настраивает создание компилятором инструкций для устранения некоторых уязвимостей Spectre варианта 1.

## <a name="syntax"></a>Синтаксис

> **/Qspectre**

## <a name="remarks"></a>Примечания

Параметр **/Qspectre** доступен в Visual Studio 2017 версии 15.5.5 и более поздних версий, а также в Visual Studio 2015 с обновлением 3 посредством исправления [KB 4338871](https://support.microsoft.com/help/4338871/visual-studio-2015-update-3-spectre-variant-1-toolset-qspectre). При его указании компилятор добавляет инструкции для устранения некоторых [уязвимостей Spectre](https://spectreattack.com/spectre.pdf). Эти уязвимости называются с точки зрения *выполнения атак с использованием побочного канала*. Они влияют на множество операционных систем и современных процессоров, включая процессоры Intel, AMD и ARM.

Параметр **/Qspectre** по умолчанию отключен.

Изначально параметр **/Qspectre** работал только применительно к оптимизированному коду. В Visual Studio 2017 версии 15.7 и более поздних параметр **/Qspectre** поддерживается на всех уровнях оптимизации.

Для библиотек Microsoft Visual C++ также доступны версии с устранением уязвимостей Spectre. Библиотеки с устранением уязвимостей Spectre для Visual Studio 2017 и более поздних версий можно скачать в Visual Studio Installer. Они находятся на вкладке **отдельные компоненты** в разделе **компиляторы, средства сборки и среды выполнения**, в имени которых есть "библиотеки для устранением рисков Spectre". Как библиотеки DLL, так и статические библиотеки с включенной защитой доступны для подмножества сред выполнения Visual C++: VC++ start-up code, vcruntime140, msvcp140, concrt140 и vcamp140. Библиотеки DLL поддерживаются только для локального развертывания приложения. Содержимое распространяемого пакета библиотек C++ среды выполнения Visual 2017 и более поздних версий не было изменено.

Можно также установить библиотеки устранением рисков Spectre-смягчения для MFC и ATL. Они находятся на вкладке **отдельные компоненты** в разделе **пакеты SDK, библиотеки и платформы**.

### <a name="applicability"></a>Применимость

Если код работает с данными, которые пересекают границу доверия, мы рекомендуем использовать параметр **/Qspectre** для повторной сборки и повторного развертывания кода, чтобы устранить эту ошибку как можно скорее. Примером такого кода является код, который загружает ненадежные входные данные, которые могут повлиять на выполнение. Например, код, выполняющий удаленные вызовы процедур, анализирует ненадежные входные или файлы или использует другие локальные интерфейсы межпроцессного взаимодействия (IPC). Стандартных приемов организации песочницы может быть недостаточно. Тщательно изучите песочницу, прежде чем вы решите, что ваш код не пересекает границы доверия.

### <a name="availability"></a>Доступность

Параметр **/Qspectre** доступен в Visual Studio 2017 версии 15.5.5 и во всех обновлениях компиляторов Майкрософт C++ (компилятором MSVC), выполненных до 23 января 2018. Используйте Visual Studio Installer, чтобы обновить компилятор и установить библиотеки с устраненными уязвимостями Spectre как отдельные компоненты. Параметр **/Qspectre** также доступен в Visual Studio 2015 с обновлением 3 посредством исправления. Дополнительные сведения см. в [статье базы знаний 4338871](https://support.microsoft.com/help/4338871).

Все версии Visual Studio 2017 версии 15,5 и все предварительные версии Visual Studio 2017 версии 15,6. Включите недокументированный параметр **/d2guardspecload**. Это эквивалентно первоначальному поведению **/Qspectre**. С помощью параметра **/d2guardspecload** можно применять к коду те же средства защиты в этих версиях компилятора. Мы рекомендуем обновить сборку, чтобы использовать **/Qspectre** в компиляторах, поддерживающих этот параметр. Параметр **/Qspectre** также может поддерживать новые способы устранения рисков в более поздних версиях компилятора.

### <a name="effect"></a>Действие

Параметр **/Qspectre** создает код, в котором устраняется вариант 1 уязвимости Specter: "Обход проверки границ", [CVE-2017-5753](https://nvd.nist.gov/vuln/detail/CVE-2017-5753). Для этого вставляются инструкции, которые препятствуют спекулятивному выполнению кода. Конкретные инструкции, препятствующие спекулятивному выполнению, зависят от процессора и его микроархитектуры. В будущих версиях компилятора они могут меняться.

Когда вы включаете параметр **/Qspectre** , компилятор пытается найти экземпляры, в которых выполнение упреждающего выполнения может пропускать проверки границ. Именно здесь он вставляет инструкции барьера. Важно помнить об ограничениях анализа, которые компилятор может выполнить для определения экземпляров варианта 1. Поэтому нет никакой гарантии, что все возможные экземпляры варианта 1 инструментированы в **/Qspectre**.

### <a name="performance-impact"></a>Влияние на производительность

Влияние **/Qspectre** на производительность в нескольких базовых базах кода было бы незначительным. Однако нет никаких гарантий, что производительность кода в **/Qspectre** остается неизменной. Чтобы определить последствия, следует провести тесты производительности. Если известно, что устранение рисков не требуется в блоке или цикле, критическом для производительности, можно выборочно отключить устранение рисков с помощью директивы [__declspec (устранением рисков Spectre (смягчение рисков))](../../cpp/spectre.md) . Эта директива недоступна в компиляторах, поддерживающих только параметр **/d2guardspecload** .

### <a name="required-libraries"></a>Требуемые библиотеки

Параметр компилятора **/Qspectre** создает код, который неявно связывает версии библиотек среды выполнения, созданных для обеспечения устранением рисков Spectre. Эти библиотеки представляют собой необязательные компоненты, которые необходимо установить с помощью Visual Studio Installer:

- Библиотеки MSVC версии *номера_версий* для Spectre \[(32- и 64-разрядные) | (ARM) | (ARM64)]
- Visual C++ ATL для \[(x86/x64) | ARM | ARM64] с устранением уязвимостей Spectre
- Visual C++ MFC для \[x86/x64 | ARM | ARM64] с устранением уязвимостей Spectre

Если код строится с помощью **/Qspectre** и эти библиотеки не установлены, система сборки сообщает **о предупреждении MSB8038: устранение рисков Spectre включено, однако библиотеки Spectre с устраненными рисками не найдены**. Если код MFC или ATL не удается построить, а компоновщик сообщает об ошибке, например Неустранимая **ошибка LNK1104: не удается открыть файл "OLDNAMES. lib"** , причиной может быть отсутствие библиотек.

### <a name="additional-information"></a>Дополнительные сведения

Дополнительные сведения см. в официальном [руководстве по безопасности корпорации Майкрософт ADV180002, рекомендации по устранению уязвимостей на основе уязвимых мест выполнения](https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/ADV180002). Доступны также руководства от Intel: [Speculative Execution Side Channel Mitigations](https://software.intel.com/sites/default/files/managed/c5/63/336996-Speculative-Execution-Side-Channel-Mitigations.pdf) (Устранение уязвимостей спекулятивного выполнения по сторонним каналам) и ARM: [Cache Speculation Side-channels](https://developer.arm.com/-/media/Files/pdf/Cache_Speculation_Side-channels.pdf) (Сторонние каналы спекулятивного кэширования). Общие сведения об устранении устранением рисков Spectre и Meltdown, связанных с Windows, см. [в разделе понимание влияния на производительность в устранением рисков Spectre и Meltdown в системах Windows](https://www.microsoft.com/security/blog/2018/01/09/understanding-the-performance-impact-of-spectre-and-meltdown-mitigations-on-windows-systems/). Общие сведения об уязвимостях устранением рисков Spectre, устраняемых с помощью КОМПИЛЯТОРОМ MSVC, см. в разделе [устранением рисков Spectre для устранения рисков в компилятором MSVC](https://devblogs.microsoft.com/cppblog/spectre-mitigations-in-msvc./) в блоге C++ группы.

### <a name="to-set-this-compiler-option-in-the-visual-studio-development-environment"></a>Установка данного параметра компилятора в среде разработки Visual Studio

1. Откройте диалоговое окно **Страницы свойств** проекта. Подробнее см. в статье [Настройка компилятора C++ и свойства сборки в Visual Studio](../working-with-project-properties.md).

1. Перейдите на страницу свойств **Свойства конфигурации** > **C/C++**  > **Командная строка**.

1. Введите параметр компилятора **/Qspectre** в поле **Дополнительные параметры**. Чтобы применить изменение, нажмите кнопку **ОК**.

### <a name="to-set-this-compiler-option-programmatically"></a>Установка данного параметра компилятора программным способом

- См. раздел <xref:Microsoft.VisualStudio.VCProjectEngine.VCCLCompilerTool.AdditionalOptions%2A>.

## <a name="see-also"></a>См. также

[Параметры /Q (низкоуровневые операции)](q-options-low-level-operations.md)<br/>
[Параметры компилятора MSVC](compiler-options.md)<br/>
[Синтаксис командной строки компилятора MSVC](compiler-command-line-syntax.md)
