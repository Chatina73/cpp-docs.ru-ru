---
title: /Qspectre
ms.date: 10/12/2018
f1_keywords:
- /Qspectre
helpviewer_keywords:
- /Qspectre
ms.openlocfilehash: e0d3af50015b77af297cbee22f439cd17d803de9
ms.sourcegitcommit: 6cf0c67acce633b07ff31b56cebd5de3218fd733
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/24/2019
ms.locfileid: "67344153"
---
# <a name="qspectre"></a>/Qspectre

Настраивает создание компилятором инструкций для устранения некоторых уязвимостей Spectre варианта 1.

## <a name="syntax"></a>Синтаксис

> **/Qspectre**

## <a name="remarks"></a>Примечания

Параметр **/Qspectre** доступен в Visual Studio 2017 версии 15.5.5 и более поздних версий, а также в Visual Studio 2015 с обновлением 3 посредством исправления [KB 4338871](https://support.microsoft.com/help/4338871/visual-studio-2015-update-3-spectre-variant-1-toolset-qspectre). При его указании компилятор добавляет инструкции для устранения некоторых [уязвимостей Spectre](https://spectreattack.com/spectre.pdf). Эти уязвимости, называются *атаки упреждающего исполнения на стороне канала*. Они влияют на многими операционными системами и современных процессоров, включая процессоры от Intel, AMD и ARM.

Параметр **/Qspectre** по умолчанию отключен.

Изначально параметр **/Qspectre** работал только применительно к оптимизированному коду. В Visual Studio 2017 версии 15.7 и более поздних параметр **/Qspectre** поддерживается на всех уровнях оптимизации.

Для библиотек Microsoft Visual C++ также доступны версии с устранением уязвимостей Spectre. Библиотеки с устранением уязвимостей Spectre для Visual Studio 2017 и более поздних версий можно скачать в Visual Studio Installer. Они будут обнаружены в **отдельные компоненты** открыть, выбрав вкладку **компиляторы, средства сборки и среды выполнения**, и иметь «Библиотек для Spectre» в имени. Как библиотеки DLL, так и статические библиотеки с включенной защитой доступны для подмножества сред выполнения Visual C++: VC++ start-up code, vcruntime140, msvcp140, concrt140 и vcamp140. Библиотеки DLL поддерживается только развертывание локального приложения. Содержимое визуального C++ 2017 и более поздние версии библиотеки распространяемого пакета среды выполнения еще не были изменены.

Можно также установить устранен Spectre библиотеки для MFC и ATL. Они будут обнаружены в **отдельные компоненты** открыть, выбрав вкладку **пакеты SDK, библиотек и платформ**.

### <a name="applicability"></a>Применимость

Если код работает с данными, который пересекает границы доверия, то мы рекомендуем использовать **/qspectre** параметр, чтобы повторно создавать и развертывать код, чтобы устранить эту проблему как можно скорее. Примером такого кода является код, который загружает ненадежных входных данных, которые могут повлиять на выполнение. Например код, который делает удаленной процедуры вызывает, анализирует ненадежных входных данных или файлов либо использует другие интерфейсы локального межпроцессного взаимодействия (IPC). Стандартных приемов организации песочницы может быть недостаточно. Тщательно изучите ваш "песочницы", прежде чем вы решили, что ваш код не пересекает границы доверия.

### <a name="availability"></a>Доступность

**/Qspectre** доступен в Visual Studio 2017 версии 15.5.5 и все обновления в корпорацию Майкрософт C++ компиляторы (MSVC), внесенных после 23 января 2018 г. Используйте Visual Studio Installer, чтобы обновить компилятор и установить библиотеки с устраненными уязвимостями Spectre как отдельные компоненты. Параметр **/Qspectre** также доступен в Visual Studio 2015 с обновлением 3 посредством исправления. Дополнительные сведения см. в [статье базы знаний 4338871](https://support.microsoft.com/help/4338871).

Все версии Visual Studio 2017 версии 15.5 и все предварительные версии Visual Studio 2017 версии 15.6. имеет недокументированные возможности **/d2guardspecload**. Это эквивалентно начальной поведение **/qspectre**. С помощью параметра **/d2guardspecload** можно применять к коду те же средства защиты в этих версиях компилятора. Мы рекомендуем обновить сборки, чтобы использовать **/qspectre** в компиляторах, поддерживающие параметр. **/Qspectre** параметр также может поддерживать новые способы их устранения в более поздних версиях компилятора.

### <a name="effect"></a>Действие

Параметр **/Qspectre** создает код, в котором устраняется вариант 1 уязвимости Specter: "Обход проверки границ", [CVE-2017-5753](https://nvd.nist.gov/vuln/detail/CVE-2017-5753). Для этого вставляются инструкции, которые препятствуют спекулятивному выполнению кода. Конкретные инструкции, препятствующие спекулятивному выполнению, зависят от процессора и его микроархитектуры. В будущих версиях компилятора они могут меняться.

При включении **/qspectre** параметр, компилятор пытается определить экземпляры, где упреждающего исполнения могут обходить проверяются границы. Это, где он вставляет инструкции барьера. Это важно учитывать ограничения на количество для анализа, компилятор может сделать для идентификации экземпляров данного типа variant 1. Таким образом, нет никакой гарантии, что все возможные вхождения первого варианта инструментированы под **/qspectre**.

### <a name="performance-impact"></a>Влияние на производительность

Влияние на производительность **/qspectre** было незначительным в нескольких базах кода расширяемой. Тем не менее, нет никаких гарантий, производительность кода в разделе **/qspectre** , остается без изменений. Чтобы определить последствия, следует провести тесты производительности. Если вы знаете, что устранение рисков не обязательно в цикле или блок критически важным для производительности, можно выборочно отключить устранение рисков с помощью [__declspec(spectre(nomitigation))](../../cpp/spectre.md) директива. Эта директива недоступен в компиляторах, которые поддерживают только **/d2guardspecload** параметр.

### <a name="required-libraries"></a>Требуемые библиотеки

**/Qspectre** параметр компилятор создает код, который неявно связывает версиях библиотек среды выполнения, созданная для предоставления способы устранения рисков Spectre. Эти библиотеки представляют собой необязательные компоненты, которые необходимо установить с помощью Visual Studio Installer:

- Библиотеки MSVC версии *номера_версий* для Spectre \[(32- и 64-разрядные) | (ARM) | (ARM64)]
- Visual C++ ATL для \[(x86/x64) | ARM | ARM64] с устранением уязвимостей Spectre
- Visual C++ MFC для \[x86/x64 | ARM | ARM64] с устранением уязвимостей Spectre

Если сборка кода с помощью **/qspectre** и эти библиотеки не установлен, отчеты системы построения **предупреждение MSB8038: устранение рисков Spectre включено, однако библиотеки Spectre с устраненными рисками не найдены**. Если код MFC или ATL не сборки, а компоновщик сообщает об ошибке, такие как **Неустранимая ошибка, LNK1104: не удается открыть файл «oldnames.lib»** , эти отсутствующие библиотеки может быть причиной.

### <a name="additional-information"></a>Дополнительные сведения

Дополнительные сведения см. в официальной [ADV180002 советы по безопасности Microsoft, руководство, чтобы устранить уязвимостях упреждающего исполнения по сторонним каналам](https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/ADV180002). Доступны также руководства от Intel: [Speculative Execution Side Channel Mitigations](https://software.intel.com/sites/default/files/managed/c5/63/336996-Speculative-Execution-Side-Channel-Mitigations.pdf) (Устранение уязвимостей спекулятивного выполнения по сторонним каналам) и ARM: [Cache Speculation Side-channels](https://developer.arm.com/-/media/Files/pdf/Cache_Speculation_Side-channels.pdf) (Сторонние каналы спекулятивного кэширования). Обзор Windows конкретных способы устранения рисков Spectre и Meltdown, см. в разделе [понять влияние на производительность Устранение рисков Spectre и Meltdown в системах Windows](https://www.microsoft.com/security/blog/2018/01/09/understanding-the-performance-impact-of-spectre-and-meltdown-mitigations-on-windows-systems/). Обзор устранения рисков MSVC устраняющего данные уязвимости Spectre, см. в разделе [способы устранения рисков Spectre в MSVC](https://devblogs.microsoft.com/cppblog/spectre-mitigations-in-msvc./) на C++ блог группы разработчиков.

### <a name="to-set-this-compiler-option-in-the-visual-studio-development-environment"></a>Установка данного параметра компилятора в среде разработки Visual Studio

1. Откройте диалоговое окно **Страницы свойств** проекта. Подробнее см. в статье [Настройка компилятора C++ и свойства сборки в Visual Studio](../working-with-project-properties.md).

1. Перейдите на страницу свойств **Свойства конфигурации** > **C/C++**  > **Командная строка**.

1. Введите параметр компилятора **/Qspectre** в поле **Дополнительные параметры**. Чтобы применить изменение, нажмите кнопку **ОК**.

### <a name="to-set-this-compiler-option-programmatically"></a>Установка данного параметра компилятора программным способом

- См. раздел <xref:Microsoft.VisualStudio.VCProjectEngine.VCCLCompilerTool.AdditionalOptions%2A>.

## <a name="see-also"></a>См. также

[Параметры /Q (низкоуровневые операции)](q-options-low-level-operations.md)<br/>
[Параметры компилятора MSVC](compiler-options.md)<br/>
[Синтаксис командной строки компилятора MSVC](compiler-command-line-syntax.md)
