---
title: / Qspectre
ms.date: 10/12/2018
f1_keywords:
- /Qspectre
helpviewer_keywords:
- /Qspectre
ms.openlocfilehash: af04a905fdb3b509a90249c6d55a28ccdaa39318
ms.sourcegitcommit: 6052185696adca270bc9bdbec45a626dd89cdcdd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/31/2018
ms.locfileid: "50507319"
---
# <a name="qspectre"></a>/ Qspectre

Задает создание компилятора инструкции для устранения определенных уязвимостей безопасности первого варианта Spectre.

## <a name="syntax"></a>Синтаксис

> **/Qspectre**

## <a name="remarks"></a>Примечания

**/Qspectre** параметр недоступен в Visual Studio 2017 версии 15.5.5 и более поздней версии и в Visual Studio 2015 с обновлением 3 через [4338871 КБ](https://support.microsoft.com/help/4338871/visual-studio-2015-update-3-spectre-variant-1-toolset-qspectre). Она предписывает компилятору вставить инструкции для устранения определенных [уязвимости Spectre](https://spectreattack.com/spectre.pdf). Эти уязвимости, вызывается *атаки упреждающего исполнения на стороне канала*, влияют на многие операционные системы и современных процессоров, включая процессоры от Intel, AMD и ARM.

**/Qspectre** параметр отключен по умолчанию.

В исходном выпуске **/qspectre** работали только параметр оптимизированного кода. В Visual Studio 2017 версии 15.7 и более поздние версии **/qspectre** параметр поддерживается на всех уровнях оптимизации.

Библиотеки Microsoft Visual C++ также доступны в версиях с устранение рисков Spectre. В установщике Visual Studio можно загрузить библиотеки Spectre устранения для Visual Studio 2017. Они находятся в **отдельные компоненты** открыть, выбрав вкладку **компиляторы, средства сборки и среды выполнения**, и иметь «Библиотек для Spectre» в имени. Для подмножества среды выполнения Visual C++ доступны как библиотеки DLL, так и статические среды выполнения библиотек с поддержкой устранение рисков: код запуска VC ++, vcruntime140, msvcp140, concrt140 и vcamp140. Библиотеки DLL, поддерживаются для развертывания локального приложения. содержимое распространяемого компонента Visual C++ 2017 среды выполнения библиотек не были изменены. Вы также можете установить устранен Spectre библиотеки для MFC и ATL, найден в **отдельные компоненты** открыть, выбрав вкладку **пакеты SDK, библиотек и платформ**.

### <a name="applicability"></a>Применимости

Если код работает с данными, который пересекает границы доверия, то мы рекомендуем использовать **/qspectre** параметр, чтобы повторно создавать и развертывать код, чтобы устранить эту проблему как можно скорее. Примеры кода, который работает с данными, которые пересекает границы доверия, загружающий ненадежных входных данных, которые могут повлиять на выполнение кода, к примеру, код, который делает удаленной процедуры вызывает, анализирует ненадежных входных данных или файлов либо использует другие локального процесса между интерфейсы взаимодействия (IPC). Методы стандартных "песочницы" не может быть достаточно. Следует обратить внимание на "песочницы" тщательно прежде чем решить, что ваш код не выходит за границы доверия.

### <a name="availability"></a>Доступность

**/Qspectre** доступен в Visual Studio 2017 версии 15.5.5 и все обновления в компиляторы Microsoft Visual C++ (MSVC), внесенных после 23 января 2018 г. Используйте установщик Visual Studio для обновления компилятор, а также для установки библиотек устранен Spectre как отдельные компоненты. **/Qspectre** также доступна в Visual Studio 2015 с обновлением 3 посредством исправления. Дополнительные сведения см. в разделе [4338871 КБ](https://support.microsoft.com/help/4338871).

Все версии Visual Studio 2017 версии 15.5 и все предварительные версии Visual Studio 2017 версии 15.6 входит недокументированный параметр, **/d2guardspecload**, который эквивалентен начальной поведение   **/qspectre**. Можно использовать **/d2guardspecload** для применения к коду в этих версиях компилятора же способы их устранения. Выполните обновление сборки, чтобы использовать **/qspectre** в компиляторы, которые поддерживают параметр; **/qspectre** параметр также может поддерживать новые способы их устранения в более поздних версиях компилятора.

### <a name="effect"></a>Действие

**/Qspectre** параметр выводит код во избежание давлением variant 1, обход проверки границ [CVE-2017-5753](https://nvd.nist.gov/vuln/detail/CVE-2017-5753). Он работает путем вставки инструкций, которые действуют как барьер выполнения наблюдающей кода. Инструкции, во избежание предположение процессора зависит от процессора и его микроархитектуры и могут измениться в будущих версиях компилятора.

Когда **/qspectre** включен, компилятор пытается определить экземпляры, где могут обходить проверяются границы упреждающего исполнения и вставляет инструкции барьера. Важно отметить, что существуют ограничения на анализ, который компилятор может выполнить для идентификации экземпляров данного типа variant 1. Таким образом, нет никакой гарантии, что все возможные вхождения первого варианта инструментированы под **/qspectre**.

### <a name="performance-impact"></a>Влияние на производительность

Влияние на производительность **/qspectre** наблюдалась можно пренебречь в несколько очень больших базах кода, но нет никаких гарантий, производительность кода в разделе **/qspectre** , остается без изменений. Необходимо протестировать код, чтобы определить действие параметра на производительность. Если вы знаете, что устранение рисков не требуется в цикле или блок критически важным для производительности, устранение рисков можно выборочно отключить с помощью [__declspec(spectre(nomitigation))](../../cpp/spectre.md) директива. Эта директива недоступен в компиляторах, которые поддерживают только **/d2guardspecload** параметр.

### <a name="required-libraries"></a>Необходимые библиотеки

**/Qspectre** параметр компилятор создает код, который неявно связывает версиях библиотек среды выполнения, разработанных специально для предоставления способы устранения рисков Spectre. Эти библиотеки являются дополнительными компонентами, которые должны быть установлены с помощью установщика Visual Studio:

- VC ++ 2017 версии *version_numbers* библиотек для Spectre \[(x86 и x64) | (ARM) | (ARM64)]
- Visual C++ ATL для \[(x86/x64) | ARM | ARM64] с способы устранения рисков Spectre
- Visual C++ MFC для \[x86/x64 | ARM | ARM64] с способы устранения рисков Spectre

Если сборка кода с помощью **/qspectre** и эти библиотеки не установлен, отчеты системы построения **предупреждение MSB8038: устранение рисков Spectre включено, но не найдены библиотеки Spectre**. Если код MFC или ATL не сможет создавать и компоновщик сообщает об ошибке, такие как **Неустранимая ошибка, LNK1104: не удается открыть файл «oldnames.lib»**, эти отсутствующие библиотеки может быть причиной.

### <a name="additional-information"></a>Дополнительные сведения

Для получения дополнительных сведений см. официальный [ADV180002 советы по безопасности Microsoft, руководство, чтобы устранить уязвимостях упреждающего исполнения по сторонним каналам](https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/ADV180002). Руководство также доступно корпорации Intel, [способы устранения рисков канала на стороне Спекулятивное выполнение](https://software.intel.com/sites/default/files/managed/c5/63/336996-Speculative-Execution-Side-Channel-Mitigations.pdf)и ARM, [предположение кэш на стороне каналы](https://developer.arm.com/-/media/Files/pdf/Cache_Speculation_Side-channels.pdf). Обзор Windows конкретных способы устранения рисков Spectre и Meltdown, см. в разделе [понять влияние на производительность Устранение рисков Spectre и Meltdown в системах Windows](https://cloudblogs.microsoft.com/microsoftsecure/2018/01/09/understanding-the-performance-impact-of-spectre-and-meltdown-mitigations-on-windows-systems/) в блоге Microsoft Secure. Общие сведения о бюллетене по MSVC устранения рисков Spectre, см. в разделе [способы устранения рисков Spectre в MSVC](https://blogs.msdn.microsoft.com/vcblog/2018/01/15/spectre-mitigations-in-msvc./) блоге группы разработчиков Visual C++.

### <a name="to-set-this-compiler-option-in-the-visual-studio-development-environment"></a>Установка данного параметра компилятора в среде разработки Visual Studio

1. Откройте диалоговое окно **Страницы свойств** проекта. Дополнительные сведения см. в разделе [Работа со свойствами проекта](../../ide/working-with-project-properties.md).

1. Выберите **свойства конфигурации** > **C/C++** > **командной строки** страницу свойств.

1. Введите **/qspectre** параметр компилятора в **Дополнительные параметры** поле. Выберите **ОК** для применения изменений.

### <a name="to-set-this-compiler-option-programmatically"></a>Установка данного параметра компилятора программным способом

- См. раздел <xref:Microsoft.VisualStudio.VCProjectEngine.VCCLCompilerTool.AdditionalOptions%2A>.

## <a name="see-also"></a>См. также

[Параметры /Q (низкоуровневые операции)](../../build/reference/q-options-low-level-operations.md)<br/>
[Параметры компилятора](../../build/reference/compiler-options.md)<br/>
[Настройка параметров компилятора](../../build/reference/setting-compiler-options.md)
