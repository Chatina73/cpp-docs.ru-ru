---
description: 'Дополнительные сведения: обработчики уведомлений о задержке загрузки'
title: Обработчики уведомлений
ms.date: 01/19/2021
helpviewer_keywords:
- delayed loading of DLLs, notification hooks
ms.openlocfilehash: 401ae9099afcf00dc280bb4f9e5f7016a4cbc640
ms.sourcegitcommit: 3d9cfde85df33002e3b3d7f3509ff6a8dc4c0a21
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/21/2021
ms.locfileid: "98667535"
---
# <a name="notification-hooks"></a>Обработчики уведомлений

Обработчики уведомлений о задержках загрузки вызываются непосредственно перед выполнением следующих действий в вспомогательной подпрограммы:

- Сохраненный обработчик для библиотеки проверяется на наличие уже загруженного.

- `LoadLibrary` вызывается для попыток загрузки библиотеки DLL.

- `GetProcAddress` метод вызывается, чтобы попытаться получить адрес процедуры.

- Вернитесь к преобразовательу отложенных импортов нагрузки.

Обработчик уведомлений включен:

- Путем предоставления нового определения указателя `__pfnDliNotifyHook2` , который инициализируется для указания собственной функции, получающей уведомления.

   \-или-

- Установив указатель `__pfnDliNotifyHook2` на функцию-ловушку перед вызовами DLL, которые программа загружает с задержкой.

Если уведомление имеет значение `dliStartProcessing` , функция-обработчик может вернуть:

- `NULL`

   Вспомогательный модуль по умолчанию обрабатывает загрузку библиотеки DLL. Этот метод полезен только в информационных целях.

- Указатель на функцию

   Обойти обработку отложенной загрузки по умолчанию. Он позволяет указать собственный обработчик нагрузки.

Если уведомление имеет значение `dliNotePreLoadLibrary` , функция-обработчик может вернуть:

- 0, если требуется только информационное уведомление.

- `HMODULE`Для загруженной библиотеки DLL, если она загрузила саму библиотеку DLL.

Если уведомление имеет значение `dliNotePreGetProcAddress` , функция-обработчик может вернуть:

- 0, если требуется только информационное уведомление.

- Адрес импортированной функции, если функция-обработчик получает сам адрес.

Если уведомление равно `dliNoteEndProcessing` , возвращаемое значение функции-обработчика игнорируется.

Если этот указатель инициализирован (не равен нулю), вспомогательная функция отложенной загрузки вызывает функцию в определенных точках уведомления во время выполнения. Указатель функции имеет следующее определение:

```C
// The "notify hook" gets called for every call to the
// delay load helper.  This allows a user to hook every call and
// skip the delay load helper entirely.
//
// dliNotify == {
//  dliStartProcessing |
//  dliNotePreLoadLibrary  |
//  dliNotePreGetProc |
//  dliNoteEndProcessing}
//  on this call.
//
ExternC
PfnDliHook   __pfnDliNotifyHook2;

// This is the failure hook, dliNotify = {dliFailLoadLib|dliFailGetProc}
ExternC
PfnDliHook   __pfnDliFailureHook2;
```

Уведомления передают `DelayLoadInfo` структуру функции-обработчику вместе со значением уведомления. Эти данные идентичны данным, используемым вспомогательной подсистемой с отложенной загрузкой. Значением уведомления будет одно из значений, определенных в [определениях структуры и констант](structure-and-constant-definitions.md).

## <a name="see-also"></a>См. также раздел

[Обработка ошибок и предупреждений](error-handling-and-notification.md)
