---
title: XML-файлы правил для страниц свойств
description: Описание файлов и содержимого правил XML для страницы свойств Visual Studio IDE C++.
ms.date: 10/14/2020
helpviewer_keywords:
- property page XML files
ms.openlocfilehash: 96cbf6a32cada2b594874493868ec884823016cb
ms.sourcegitcommit: 6e5429e076e552b32e8bdc49480c51498d7924c1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/15/2020
ms.locfileid: "92099723"
---
# <a name="property-page-xml-rule-files"></a>XML-файлы правил для страниц свойств

Страницы свойств проекта в интегрированной среде разработки настраиваются XML-файлами в папке rules по умолчанию. XML-файлы описывают имена правил, категории и отдельные свойства, их тип данных, значения по умолчанию и способ их отображения. При задании свойства в интегрированной среде разработки новое значение сохраняется в файле проекта.

::: moniker range="vs-2015"

Путь к папке rules по умолчанию зависит от языкового стандарта и используемой версии Visual Studio. В командной строке разработчика Visual Studio 2015 или более ранней версии папка Rules имеет значение *`%ProgramFiles(x86)%\MSBuild\Microsoft.Cpp\v4.0\<version>\<locale>`* . `<version>`Значение находится *`v140`* в Visual Studio 2015. `<locale>`— Это код языка, например `1033` для английского языка. Вы будете использовать разные пути для каждого установленного выпуска Visual Studio и для каждого языка. Например, путь к папке правил по умолчанию для Visual Studio 2015 Community Edition на английском языке может иметь значение *`C:\Program Files (x86)\MSBuild\Microsoft.Cpp\v4.0\v140\1033\`* .

::: moniker-end

::: moniker range="vs-2017"

Путь к папке rules по умолчанию зависит от языкового стандарта и используемой версии Visual Studio. В командной строке разработчика Visual Studio 2017 папка Rules имеет значение *`%VSINSTALLDIR%Common7\IDE\VC\VCTargets\<locale>\`* . `<locale>`— Это код языка, например `1033` для английского языка. В командной строке разработчика Visual Studio 2015 или более ранней версии в папке Rules находится *`%ProgramFiles(x86)%\MSBuild\Microsoft.Cpp\v4.0\<version>\<locale>\`* , где `<version>` значение находится *`v140`* в Visual Studio 2015. Вы будете использовать разные пути для каждого установленного выпуска Visual Studio и для каждого языка. Например, путь к папке правил по умолчанию для Visual Studio 2017 Community Edition на английском языке может иметь значение *`C:\Program Files (x86)\Microsoft Visual Studio\2017\Enterprise\Common7\IDE\VC\VCTargets\1033\`* .

::: moniker-end

::: moniker range=">=vs-2019"

Путь к папке rules по умолчанию зависит от языкового стандарта и используемой версии Visual Studio. В командной строке разработчика Visual Studio 2019 или более поздней версии в папке Rules находится *`%VSINSTALLDIR%MSBuild\Microsoft\VC\<version>\<locale>\`* , где `<version>` значение находится *`v160`* в Visual Studio 2019. `<locale>`— Это код языка, например `1033` для английского языка. В Visual Studio 2017 папка Rules имеет значение *`%VSINSTALLDIR%Common7\IDE\VC\VCTargets\<locale>\`* . В командной строке разработчика Visual Studio 2015 или более ранней версии папка Rules имеет значение *`%ProgramFiles(x86)%\MSBuild\Microsoft.Cpp\v4.0\<version>\<locale>\`* . Вы будете использовать разные пути для каждого установленного выпуска Visual Studio и для каждого языка. Например, путь к папке правил по умолчанию для Visual Studio 2019 Community Edition на английском языке может иметь значение *`C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\MSBuild\Microsoft\VC\v160\1033\`* .

::: moniker-end

Вам нужно только понять внутреннюю работу этих файлов и интегрированную среду разработки Visual Studio в нескольких сценариях:

- Необходимо создать пользовательскую страницу свойств или
- Вы хотите настроить свойства проекта без использования интегрированной среды разработки Visual Studio.

## <a name="contents-of-rule-files"></a>Содержимое файлов правил

Сначала откроем страницы свойств для проекта. Щелкните правой кнопкой мыши узел проекта в **Обозреватель решений** и выберите пункт **свойства**.

![Отображение диалогового окна свойств проекта C++ Visual Studio](../media/cpp-property-page-2017.png)

Каждый узел в разделе **Свойства конфигурации** называется *правилом*. Правило иногда представляет собой один инструмент, например компилятор. Как правило, термин указывает на то, что имеет свойства, которые выполняются и могут давать некоторые выходные данные. Каждое правило заполняется из XML-файла в папке Rules Default. Например, представленное здесь правило C/C++ заполняется *"cl.xml"*.

Каждое правило имеет набор свойств, упорядоченных по *категориям*. Каждый подчиненный узел в правиле представляет категорию. Например, узел **Оптимизация** в **C/C++** содержит все свойства, связанные с оптимизацией средства компилятора. Свойства и их значения отображаются в формате сетки на правой панели.

Можно открыть *`cl.xml`* в блокноте или любом РЕДАКТОРЕ XML. Вы увидите корневой узел с именем `Rule` . Он определяет тот же список свойств, которые отображаются в пользовательском интерфейсе вместе с дополнительными метаданными.

```xml
<?xml version="1.0" encoding="utf-8"?>
<!--Copyright, Microsoft Corporation, All rights reserved.-->
<Rule Name="CL" PageTemplate="tool" DisplayName="C/C++" SwitchPrefix="/" Order="10" xmlns="http://schemas.microsoft.com/build/2009/properties" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:sys="clr-namespace:System;assembly=mscorlib">
  <Rule.Categories>
    <Category Name="General" DisplayName="General" />
    <Category Name="Optimization" DisplayName="Optimization" />
    <Category Name="Preprocessor" DisplayName="Preprocessor" />
    <Category Name="Code Generation" DisplayName="Code Generation" />
    <Category Name="Language" DisplayName="Language" />
    <Category Name="Precompiled Headers" DisplayName="Precompiled Headers" />
    <Category Name="Output Files" DisplayName="Output Files" />
    <Category Name="Browse Information" DisplayName="Browse Information" />
    <Category Name="Advanced" DisplayName="Advanced" />
    <Category Name="All Options" DisplayName="All Options" Subtype="Search" />
    <Category Name="Command Line" DisplayName="Command Line" Subtype="CommandLine" />
  </Rule.Categories>
  <!-- . . . -->
</Rule>
```

Существует один XML-файл для каждого узла в разделе **Свойства конфигурации** в пользовательском интерфейсе страниц свойств. В пользовательском интерфейсе можно добавлять или удалять правила. это делается путем включения или удаления расположений в соответствующих XML-файлах в проекте. Например, как *`Microsoft.CppBuild.targets`* (найден один уровень выше, чем папка 1033), включает *`cl.xml`* :

```xml
<PropertyPageSchema Condition="'$(ConfigurationType)' != 'Utility'" Include="$(VCTargetsPath)$(LangID)\cl.xml"/>
```

При чередующихся *`cl.xml`* данных у вас есть такая базовая платформа:

```xml
<?xml version="1.0" encoding="utf-8"?>
<Rule>
  <Rule.DataSource />
  <Rule.Categories>
    <Category />
    <!-- . . . -->
  </Rule.Categories>
  <BoolProperty />
  <EnumProperty />
  <IntProperty />
  <StringProperty />
  <StringListProperty />
</Rule>
```

В следующем разделе описаны все основные элементы и некоторые метаданные, которые можно присоединить.

### <a name="rule-attributes"></a>Атрибуты правила

**`<Rule>`** Элемент — это корневой узел в XML-файле. Он может иметь множество атрибутов:

```xml
<Rule Name="CL" PageTemplate="tool" SwitchPrefix="/" Order="10"
          xmlns="http://schemas.microsoft.com/build/2009/properties"
          xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
          xmlns:sys="clr-namespace:System;assembly=mscorlib">
  <Rule.DisplayName>
    <sys:String>C/C++</sys:String>
  </Rule.DisplayName>
```

- **`Name`**: Атрибут name является ИДЕНТИФИКАТОРом для `Rule` . Оно должно быть уникальным по отношению ко всем XML-файлам страницы свойств для проекта.

- **`PageTemplate`**: Значение этого атрибута используется в пользовательском интерфейсе для выбора из коллекции шаблонов пользовательского интерфейса. Шаблон tool отображает свойства в виде стандартной таблицы. Другими встроенными значениями для этого атрибута являются debugger и generic. См. описание узлов Debugging и General соответственно, чтобы узнать о формате, который дает указание этих значений. В пользовательском интерфейсе шаблона страницы "отладчик" для переключения между свойствами различных отладчиков используется раскрывающийся список. Шаблон "generic" отображает разные категории свойств на одной странице, в отличие от наличия нескольких вложенных узлов категории в `Rule` узле. Этот атрибут является просто предложением пользовательского интерфейса. XML-файл разработан как независимый от пользовательского интерфейса. Другой пользовательский интерфейс может использовать этот атрибут в иных целях.

- **`SwitchPrefix`**: Префикс, используемый в командной строке для переключателей. Значение параметра приведет к тому, `"/"` что параметры будут выглядеть так, как **`/ZI`** , **`/nologo`** , **`/W3`** и т. д.

- **`Order`**: Предложение для клиента потенциального пользовательского интерфейса в относительном расположении по `Rule` сравнению со всеми остальными правилами в системе.

- **`xmlns`**: Стандартный XML-элемент. Видно, что указано три пространства имен. Эти атрибуты соответствуют пространствам имен для классов десериализации XML, схемы XML и пространства имен System соответственно.

- **`DisplayName`**: Имя, отображаемое в пользовательском интерфейсе страницы свойств `Rule` узла. Это значение не локализуется. Мы создали `DisplayName` как дочерний элемент, `Rule` а не как атрибут (например `Name` , или `SwitchPrefix` ) из-за внутренних требований к средству локализации. С точки зрения XML обе они эквивалентны. Таким образом, вы можете сделать его атрибутом, чтобы убрать все лишнее, или оставить все как есть.

- **`DataSource`**: Это важное свойство указывает системе проекта на необходимость чтения и записи значения свойства, а также его группирование (объяснено далее). Для *`cl.xml`* используются следующие значения:

    ```xml
    <DataSource Persistence="ProjectFile" ItemType="ClCompile" Label="" HasConfigurationCondition="true" />
    ```

  - `Persistence="ProjectFile"` сообщает системе проектов, что все свойства для `Rule` должны быть записаны в файл проекта или в файл страницы свойств (в зависимости от того, какой узел использовался для создания страниц свойств). Другое возможное значение — `"UserFile"` , которое будет записывать значение в *`.user`* файл.

  - `ItemType="ClCompile"` сообщает, что свойства будут храниться в виде метаданных ItemDefinition или метаданных элемента (только в том случае, если страницы свойств были порождены от узла файла в обозревателе решений) этого типа элемента. Если это поле не задано, свойство записывается как общее свойство в PropertyGroup.

  - `Label=""` указывает, что при записи свойств в виде метаданных `ItemDefinition` метка родительского объекта ItemDefinitionGroup будет пустой (каждый элемент MSBuild может иметь метку). Visual Studio 2017 и более поздних версий использует группы с меткой для перехода по файлу проекта VCXPROJ. Группы, которые содержат большинство `Rule` свойств, имеют пустую строку в качестве метки.

  - `HasConfigurationCondition="true"` предписывает системе проектов прикрепить условие конфигурации к значению, чтобы оно вступало в силу только для текущей конфигурации проекта (условие можно прикрепить к родительской группе или самому значению). Например, откройте страницы свойств в узле проекта и установите значение "Да" для свойства **Обрабатывать предупреждения как ошибки** в разделе **Свойства конфигурации > C/C++ Общие**. Следующее значение записывается в файл проекта. Обратите внимание, что к родительскому объекту ItemDefinitionGroup прикреплено условие конфигурации.

    ```xml
    <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'">
      <ClCompile>
        <TreatWarningAsError>true</TreatWarningAsError>
      </ClCompile>
    </ItemDefinitionGroup>
    ```

     Если это значение задано на странице свойств для конкретного файла, например *`stdafx.cpp`* , значение свойства должно быть записано под `stdafx.cpp` элементом в файле проекта, как показано ниже. Обратите внимание, что условие конфигурации напрямую прикрепляется к самим метаданным:

    ```xml
    <ItemGroup>
      <ClCompile Include="stdafx.cpp">
        <TreatWarningAsError Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'">true</TreatWarningAsError>
      </ClCompile>
    </ItemGroup>
    ```

  Другим атрибутом, `DataSource` не указанным здесь, является `PersistedName` . Его можно использовать для представления свойства в файле проекта под другим именем. По умолчанию для этого атрибута задано значение свойства `Name` .

  Отдельное свойство может переопределить свойство `DataSource` родительского элемента `Rule` . В этом случае расположение для значения этого свойства будет отличаться от других свойств в `Rule` .

- Существуют и другие атрибуты `Rule` , включая `Description` и `SupportsFileBatching` , которые здесь не показаны. Полный набор атрибутов, применимых к `Rule` или для любого другого элемента, можно получить, просмотрев документацию по этим типам. Кроме того, можно проверить открытые свойства для типов в пространстве имен `Microsoft.Build.Framework.XamlTypes` в сборке `Microsoft.Build.Framework.dll`.

- **`DisplayName`**, **`PageTemplate`** и **`Order`** — это свойства, связанные с пользовательским интерфейсом, которые имеются в этой независимой от пользовательского интерфейса модели данных. Эти свойства почти наверняка будут использоваться любым пользовательским интерфейсом, служащим для отображения страниц свойств. `DisplayName` и `Description` — это два свойства, которые находятся почти во всех элементах в XML-файле. И эти два свойства являются только локализованными.

### <a name="category-elements"></a>Элементы категории

`Rule`Может иметь несколько `Category` элементов. Порядок, в котором категории перечислены в XML-файле, является предложением пользовательского интерфейса для вывода категорий в том же порядке. Например, порядок категорий в узле **C/C++** , который отображается в пользовательском интерфейсе, совпадает с порядком в *`cl.xml`* . Пример категории выглядит следующим образом:

```xml
<Category Name="Optimization">
  <Category.DisplayName>
    <sys:String>Optimization</sys:String>
  </Category.DisplayName>
</Category>
```

В этом фрагменте `Name` показаны `DisplayName` атрибуты и, которые были описаны ранее. Опять же, существуют и другие атрибуты, `Category` которые могут не отображаться в примере. Узнать о них можно, прочитав документацию или изучив сборки с помощью *`ildasm.exe`* .

### <a name="property-elements"></a>Элементы свойств

Большая часть файла правил состоит из `Property` элементов. Они содержат список всех свойств в `Rule` . Каждое свойство может иметь один из пяти возможных типов, показанных в базовой платформе: `BoolProperty` , `EnumProperty` , `IntProperty` , `StringProperty` и `StringListProperty` . В файле могут быть только некоторые из этих типов. Свойство имеет ряд атрибутов, которые позволяют подробно описать его. `StringProperty`Описание описано здесь. Остальные похожи.

```xml
<StringProperty Subtype="file" Name="ObjectFileName" Category="Output Files" Switch="Fo">
  <StringProperty.DisplayName>
    <sys:String>Object File Name</sys:String>
  </StringProperty.DisplayName>
  <StringProperty.Description>
    <sys:String>Specifies a name to override the default object file name; can be file or directory name.(/Fo[name])</sys:String>
  </StringProperty.Description>
</StringProperty>
```

Большинство атрибутов в этом фрагменте коды было описано выше. Новые объекты — `Subtype` , `Category` и `Switch` .

- **`Subtype`** атрибут доступен только для `StringProperty` `StringListProperty` элементов и. Он предоставляет контекстные сведения. Например, значение `file` указывает, что свойство представляет путь к файлу. Visual Studio использует такие контекстные сведения для улучшения возможностей редактирования. Например, он может предоставить окно проводника Windows, позволяющее пользователю выбрать файл в качестве редактора свойства.

- **`Category`**: Категория, к которой относится это свойство. Попробуйте найти это свойство в категории **Выходные файлы** в пользовательском интерфейсе.

- **`Switch`**: Если правило представляет средство, такое как средство компилятора, большинство `Rule` свойств передаются как параметры во время сборки в исполняемый файл средства. Значение этого атрибута указывает, какой литерал переключения следует использовать. В `<StringProperty>` примере указывается, что параметр должен иметь значение **`Fo`** . В сочетании с `SwitchPrefix` атрибутом родительского элемента `Rule` это свойство передается исполняемому файлу как  **`/Fo"Debug\"`** . Он отображается в командной строке для C/C++ в пользовательском интерфейсе страницы свойств.

   Другие атрибуты свойства:

- **`Visible`**: Если вы не хотите, чтобы свойство отображалось на страницах свойств, но оно должно быть доступно во время сборки, присвойте этому атрибуту значение `false` .

- **`ReadOnly`**: Если вы хотите предоставить доступ к представлению значения этого свойства только для чтения на страницах свойств, установите для этого атрибута значение `true` .

- **`IncludeInCommandLine`**. Во время сборки средство может не требовать некоторых свойств. Задайте для этого атрибута значение `false` , чтобы предотвратить передачу определенного свойства.
