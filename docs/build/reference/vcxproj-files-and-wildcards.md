---
title: VCXPROJ-файлы и подстановочные знаки
description: Как файлы System. vcxproj собственного проекта MSBuild в C++ обрабатывали подстановочные знаки.
ms.date: 09/30/2020
helpviewer_keywords:
- .vcxproj file structure
ms.assetid: 14d0c552-29db-480e-80c1-7ea89d6d8e9c
ms.openlocfilehash: 23d36a63f328e14cca59d1d57838173b4dcb0954
ms.sourcegitcommit: f7fbdc39d73e1fb3793c396fccf7a1602af7248b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/02/2020
ms.locfileid: "91663100"
---
# <a name="vcxproj-files-and-wildcards"></a>`.vcxproj` файлы и подстановочные знаки

Интегрированная среда разработки Visual Studio не поддерживает определенные конструкции в элементах проекта в *`.vcxproj`* файлах. К неподдерживаемым конструкциям относятся подстановочные знаки, списки с разделителями-двоеточиями или макросы MSBuild, развернутые в нескольких файлах. `.vcxproj`Система проектов для сборок C++ имеет более широкие требования, чем MSBuild. Каждый элемент проекта должен иметь собственный элемент MSBuild. Дополнительные сведения о `.vcxproj` формате файла см. в разделе [ `.vcxproj` и `.props` Структура файлов](vcxproj-file-structure.md).

Следующие примеры конструкций не поддерживаются интегрированной средой разработки:

```xml
<ItemGroup>
  <None Include="*.txt">
  <ClCompile Include="a.cpp;b.cpp"/>
  <ClCompile Include="@(SomeItems)" />
</ItemGroup>
```

Если `.vcxproj` файл проекта, содержащий эти конструкции, загружается в интегрированную среду разработки, то может показаться, что проект работает сначала. Однако, скорее всего, проблемы будут внесены, как только проект будет изменен Visual Studio, а затем сохранен на диске. Могут возникать случайные сбои и неопределенное поведение.

В Visual Studio 2019 версии 16,7, когда Visual Studio загружает `.vcxproj` файл проекта, он автоматически обнаруживает неподдерживаемые записи в элементах проекта. Во время загрузки решения вы увидите предупреждения в окне вывода.

Visual Studio 2019 версии 16,7 также добавляет поддержку проектов только для чтения. Поддержка только для чтения позволяет интегрированной среде разработки использовать проекты, созданные вручную, которые не имеют дополнительных ограничений для проектов с возможностью редактирования в среде IDE.

Если у вас есть `.vcxproj` файл, использующий одну или несколько неподдерживаемых конструкций, можно выполнить загрузку без предупреждений в интегрированной среде разработки с помощью одного из следующих параметров:

- Явное отображение списка всех элементов
- Пометка проекта как доступного только для чтения
- Перемещение элементов с подстановочными знаками в целевой текст

## <a name="list-all-items-explicitly"></a>Явное отображение списка всех элементов

В настоящее время невозможно сделать элементы расширения шаблона видимыми в окне обозреватель решений в проекте, не допускающем только чтение. Обозреватель решений предполагалось, что проекты будут перечислять все элементы явным образом.

Чтобы сделать `.vcxproj` проекты автоматически расширяемыми символами-шаблонами в Visual Studio 2019 версии 16,7 или более поздней, задайте `ReplaceWildcardsInProjectItems` для свойства значение `true` . Рекомендуется создать *`Directory.Build.props`* файл в корневом каталоге и использовать следующее содержимое:

```xml
<Project>
  <PropertyGroup>
    <ReplaceWildcardsInProjectItems>true</ReplaceWildcardsInProjectItems>
  </PropertyGroup>
</Project>
```

## <a name="mark-your-project-as-read-only"></a>Пометка проекта как доступного только для чтения

В Visual Studio 2019 версии 16,7 и более поздних можно пометить проекты как *доступные только для чтения*. Чтобы пометить проект как доступный только для чтения, добавьте в *`.vcxproj`* файл или в любой из импортируемых файлов следующее свойство:

```xml
<PropertyGroup>
    <ReadOnlyProject>true</ReadOnlyProject>
</PropertyGroup>
```

`<ReadOnlyProject>`Параметр запрещает Visual Studio изменять и сохранять проект, поэтому вы можете использовать в нем любые конструкции MSBuild, включая подстановочные знаки.

Важно помнить, что кэш проекта недоступен, если Visual Studio обнаруживает подстановочные знаки в элементах проекта в *`.vcxproj`* файле или в любом из его импортов. Время загрузки решения в интегрированной среде разработки значительно больше, если у вас много проектов, использующих подстановочные знаки.

## <a name="move-wildcard-items-to-a-target-body"></a>Перемещение элементов с подстановочными знаками в целевой текст

Для сбора ресурсов, добавления созданных источников и т. д. может потребоваться использовать подстановочные знаки. Если они не нужны в списке в окне обозреватель решений, можно использовать эту процедуру.

1. Измените имя группы элементов, чтобы добавить подстановочные знаки. Например, вместо:

   ```xml
   <Image Include="*.bmp" />
   <ClCompile Include="*.cpp" />
   ```

   Измените его на:

   ```xml
   <_WildCardImage Include="*.bmp" />
   <_WildCardClCompile Include="*.cpp" />
   ```

1. Добавьте это содержимое в  *`.vcxproj`* файл.Или добавьте его в *`Directory.Build.targets`* файл в корневом каталоге, чтобы повлиять на все проекты в этом корне:

   ```xml
   <Target Name="AddWildCardItems"
       AfterTargets="BuildGenerateSources">
     <ItemGroup>
       <Image Include="@(_WildCardImage)" />
       <ClCompile Include="@(_WildCardClCompile)" />
     </ItemGroup>
   </Target>
   ```

   Это изменение делает сборку видимой для элементов, определенных в  *`.vcxproj`* файле. Однако теперь они не отображаются в окне обозреватель решений и не вызывают проблем в интегрированной среде разработки.

1. Чтобы отобразить правильные IntelliSense для  `_WildCardClCompile`   элементов при открытии этих файлов в редакторе, добавьте следующее содержимое:

   ```xml
   <PropertyGroup>
     <ComputeCompileInputsTargets>
       AddWildCardItems
       $(ComputeCompileInputsTargets)
     </ComputeCompileInputsTargets>
   </PropertyGroup>
   ```

Фактически можно использовать подстановочные знаки для любых элементов внутри целевого текста. Можно также использовать подстановочные знаки в  `ItemGroup`   , которые не определены как элементы проекта с помощью [`ProjectSchemaDefinition`](https://devblogs.microsoft.com/cppblog/vc-MSBuild-extensibility-example/) .

> [!NOTE]
> При перемещении подстановочных знаков из *`.vcxproj`* файла в импортированный файл они не будут отображаться в окне Обозреватель решений. Это изменение также позволяет проекту загружаться в интегрированной среде разработки без изменения. Однако этот подход не рекомендуется, так как он отключает кэш проекта.

## <a name="see-also"></a>См. также раздел

[Настройка компилятора C++ и свойства сборки в Visual Studio](../working-with-project-properties.md)<br/>
[XML-файлы страницы свойств](property-page-xml-files.md)
