---
title: Параметр /LTCG (создание кода во время компоновки)
ms.date: 03/14/2018
f1_keywords:
- VC.Project.VCLinkerTool.LinkTimeCodeGeneration
- VC.Project.VCConfiguration.WholeProgramOptimization
- VC.Project.VCCLWCECompilerTool.WholeProgramOptimization
- /ltcg
- VC.Project.VCCLCompilerTool.WholeProgramOptimization
helpviewer_keywords:
- link-time code generation in C++ linker
- /LTCG linker option
- -LTCG linker option
- LTCG linker option
ms.assetid: 788c6f52-fdb8-40c2-90af-4026ea2cf2e2
ms.openlocfilehash: 68c12cc7666da489870da1cacacc5053aeca5b51
ms.sourcegitcommit: 6052185696adca270bc9bdbec45a626dd89cdcdd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/31/2018
ms.locfileid: "50523218"
---
# <a name="ltcg-link-time-code-generation"></a>Параметр /LTCG (создание кода во время компоновки)

Используйте **/LTCG** выполнение оптимизации всей программы, или для инструментирования профильной оптимизации (PGO), обучение следует проводить и создать профильной оптимизации сборок.

## <a name="syntax"></a>Синтаксис

> **/ ПАРАМЕТР LTCG**[**:**{**INCREMENTAL**|**NOSTATUS**|**СОСТОЯНИЕ** | **OFF**}]<br/>

Эти параметры являются устаревшими, начиная с Visual Studio 2015:

> **/ ПАРАМЕТР LTCG:**{**PGINSTRUMENT**|**PGOPTIMIZE**|**PGUPDATE**}<br/>

### <a name="arguments"></a>Аргументы

**ДОБАВОЧНОЕ**<br/>
(Необязательно) Указывает, что компоновщик применяет только всей программы оптимизации или во время создания кода (LTCG) в набор файлов, затронутых изменения, а не всего проекта. По умолчанию этот флаг не устанавливается при **/LTCG** указано, и весь проект компонуется с помощью оптимизации всей программы.

**NOSTATUS** &AMP;#124; **СОСТОЯНИЯ**<br/>
(Необязательно) Указывает, отображает ли компоновщик индикатор хода выполнения, показывающий, какой процент ссылку завершена. По умолчанию эти данные о состоянии не отображается.

**OFF**<br/>
(Необязательно) Отключает создание кода во время компоновки. Это происходит так же, как и при **/LTCG** не указан в командной строке.

**PGINSTRUMENT**<br/>
(Необязательно) Этот параметр является устаревшим, начиная с Visual Studio 2015. Вместо этого используйте **/LTCG** и [/genprofile или/fastgenprofile](genprofile-fastgenprofile-generate-profiling-instrumented-build.md) Чтобы создать инструментированную сборку для профильной оптимизации. Данные, собранные из инструментированных запусков используется для создания оптимизированного образа. Дополнительные сведения см. в разделе [профильной оптимизации](profile-guided-optimizations.md). Краткая форма этого параметра — **/LTCG: PGI**.

**PGOPTIMIZE**<br/>
(Необязательно) Этот параметр является устаревшим, начиная с Visual Studio 2015. Вместо этого используйте **/LTCG** и [/useprofile](useprofile.md) для сборки оптимизированного образа. Дополнительные сведения см. в разделе [профильной оптимизации](../../build/reference/profile-guided-optimizations.md). Краткая форма этого параметра — **LTCG: PGO**.

**PGUPDATE**<br/>
(Необязательно) Этот параметр является устаревшим, начиная с Visual Studio 2015. Вместо этого используйте **/LTCG** и **/useprofile** для перестроения оптимизированного образа. Дополнительные сведения см. в разделе [профильной оптимизации](../../build/reference/profile-guided-optimizations.md). Краткая форма этого параметра — **/LTCG:PGU**.

## <a name="remarks"></a>Примечания

**/LTCG** параметр предписывает компоновщику вызов компилятора и выполнение оптимизации всей программы. Вы можете также выполнить профильную оптимизацию. Дополнительные сведения см. в разделе [профильной оптимизации](../../build/reference/profile-guided-optimizations.md).

За исключением следующих случаев нельзя добавлять параметры компилятора в комбинацию PGO **/LTCG** и **/useprofile** , не были указаны в предыдущей комбинации инициализации PGO  **/ Параметр LTCG** и **/genprofile** параметры:

- [/BASE](../../build/reference/base-base-address.md)

- [/FIXED](../../build/reference/fixed-fixed-base-address.md)

- **/LTCG**

- [/MAP](../../build/reference/map-generate-mapfile.md)

- [/MAPINFO](../../build/reference/mapinfo-include-information-in-mapfile.md)

- [/NOLOGO](../../build/reference/nologo-suppress-startup-banner-linker.md)

- [/OUT](../../build/reference/out-output-file-name.md)

- [/PGD](../../build/reference/pgd-specify-database-for-profile-guided-optimizations.md)

- [/PDB](../../build/reference/pdb-use-program-database.md)

- [/PDBSTRIPPED](../../build/reference/pdbstripped-strip-private-symbols.md)

- [/STUB](../../build/reference/stub-ms-dos-stub-file-name.md)

- [/VERBOSE](../../build/reference/verbose-print-progress-messages.md)

Параметры компоновщика, которые указаны вместе с **/LTCG** и **/genprofile** могут не быть указаны при сборке с помощью параметров для инициализации PGO **/LTCG** и **/Useprofile**; они подразумеваются.

В остальной части этой статьи описывается **/LTCG** с точки зрения создания кода во время компоновки.

**/ Параметр LTCG** подразумевает выполнение действий с [/GL](../../build/reference/gl-whole-program-optimization.md).

Компоновщик вызывает создание кода во время компоновки, если он передается в модуль, который был скомпилирован с помощью **/GL** или модуля MSIL (см. в разделе [.netmodule качестве входных файлов компоновщика](../../build/reference/netmodule-files-as-linker-input.md)). Если вы явно не укажете **/LTCG** при передаче **/GL** или модулей MSIL в компоновщик, со временем компоновщик обнаруживает это и перезапустит ссылку с помощью **/LTCG**. Явно укажите **/LTCG** при передаче **/GL** и модули MSIL в компоновщик для наивысшей производительность сборки.

Для еще большей производительности используйте **/LTCG: ДОБАВОЧНОЕ**. Этот параметр указывает компоновщику повторно оптимизировать только набор файлов, затронутый изменениями в исходном файле, а не весь проект. Это может значительно сократить требуемое для компоновки время. Это не тот же параметр как инкрементную компоновку.

**/LTCG** невозможно использовать с [/INCREMENTAL](../../build/reference/incremental-link-incrementally.md).

Когда **/LTCG** используется для связывания модули, скомпилированные с помощью [/Og](../../build/reference/og-global-optimizations.md), [/O1](../../build/reference/o1-o2-minimize-size-maximize-speed.md), [/O2](../../build/reference/o1-o2-minimize-size-maximize-speed.md), или [/Ox](../../build/reference/ox-full-optimization.md), выполняются следующие оптимизации:

- кроссмодульное встраивание;

- межпроцедурное распределение регистров (только 64-разрядные операционные системы);

- пользовательское соглашение об именовании (только x86)

- небольшое смещение TLS (только x86);

- двойное выравнивание стека (только x86);

- улучшенное устранение неоднозначности памяти (более подробные данные о конфликтах для глобальных переменных и входных параметров).

> [!NOTE]
> Компоновщик определяет, какие оптимизации использовались для компиляции каждой функции, и применяет те же оптимизации во время компоновки.

С помощью **/LTCG** и **/Ogt** вызывает оптимизацию двойного выравнивания.

Если **/LTCG** и **/Ogs** указаны, двойное выравнивание не выполняется. Если основные функции в приложении компилируются по скорости, с некоторые функции, скомпилированные для размера (например, с помощью [оптимизировать](../../preprocessor/optimize.md) pragma), компилятор двойной выравнивает функции, которые оптимизированы для размера, если они вызывают функции, которые требуют двойное выравнивание.

Если компилятор может определить все вызываемые функцией объекты, компилятор игнорирует модификаторы явного соглашения об именовании в функции и пытается оптимизировать соглашение о вызове функции:

- передает параметры в регистраторах;

- переупорядочивает параметры для выравнивания;

- удаляет неиспользуемые параметры.

Если функция вызывается через указатель функции, или при вызове функции вне модуля, скомпилированного с помощью **/GL**, компилятор не пытается оптимизировать соглашение о вызовах функции.

> [!NOTE]
> Если вы используете **/LTCG** и переопределить `mainCRTStartup`, приложение может иметь непредсказуемое поведение, к которому относится пользовательский код, который выполняет до глобальные объекты инициализируются. Существует три способа для решения этой проблемы: не переопределяете `mainCRTStartup`, не компилируйте файл, содержащий `mainCRTStartup` с помощью **/LTCG**, или инициализируйте глобальные переменные и объекты статически.

### <a name="ltcg-and-msil-modules"></a>Модули /LTCG и MSIL

Модули, скомпилированные с помощью [/GL](../../build/reference/gl-whole-program-optimization.md) и [/clr](../../build/reference/clr-common-language-runtime-compilation.md) , могут использоваться в качестве входных данных компоновщика, если указан параметр **/LTCG** .

- **/ Параметр LTCG** смешанной машинные и управляемые объекта файлы и может принять машинные файлы объектов (скомпилированные с помощью **/CLR**). **/CLR: pure** и **/CLR: safe** параметры компилятора признаны устаревшими в Visual Studio 2015 и не поддерживается в Visual Studio 2017.

- **/ LTCG: PGI** не принимает машинные модули, скомпилированные с помощью **/GL** и   **/CLR**

### <a name="to-set-this-compiler-option-in-the-visual-studio-development-environment"></a>Установка данного параметра компилятора в среде разработки Visual Studio

1. Откройте диалоговое окно **Окна свойств** проекта. См. в разделе [работа со свойствами проекта](../../ide/working-with-project-properties.md).

1. Выберите **свойства конфигурации** > **Общие** страницу свойств.

1. Измените свойство **Оптимизация всей программы** .

Можно также применить **/LTCG** к конкретным сборкам, выбрав **построения** > **профильной оптимизации** в строке меню или щелкнув один из профиля Интерактивная параметры оптимизации в контекстном меню для проекта.

### <a name="to-set-this-compiler-option-programmatically"></a>Установка данного параметра компилятора программным способом

- См. раздел <xref:Microsoft.VisualStudio.VCProjectEngine.VCLinkerTool.LinkTimeCodeGeneration%2A>.

## <a name="see-also"></a>См. также

- [Настройка параметров компоновщика](../../build/reference/setting-linker-options.md)
- [Параметры компоновщика](../../build/reference/linker-options.md)
