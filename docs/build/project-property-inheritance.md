---
title: Наследование свойств в проектах Visual Studio — C++
description: Принцип работы наследования свойств в собственных проектах (MSBuild) C++ Visual Studio.
ms.date: 02/21/2020
helpviewer_keywords:
- C++ projects, property inheritance
ms.openlocfilehash: 2032ab63c7d278a080742dba8d8d0c6c3ed7a094
ms.sourcegitcommit: 9a63e9b36d5e7fb13eab15c2c35bedad4fb03ade
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/25/2020
ms.locfileid: "77600023"
---
# <a name="property-inheritance-in-visual-studio-projects"></a>Наследование свойств в проектах Visual Studio

Собственная система проектов Visual Studio основана на MSBuild. MSBuild определяет форматы файлов и правила для создания проектов любого типа. Он управляет большей частью сложности построения для нескольких конфигураций и платформ. Вам будет удобно понять, как это работает. Это особенно важно, если нужно определить пользовательские конфигурации. Или, чтобы создать многократно используемые наборы свойств, которые можно совместно использовать и импортировать в несколько проектов.

## <a name="the-vcxproj-file-props-files-and-targets-files"></a>Файл VCXPROJ, файлы PROPS и TARGETS

Свойства проекта хранятся либо непосредственно в файле проекта ( *`.vcxproj`* ), либо в других *`.targets`* или *`.props`* файлах, импортируемых в файл проекта, и которые предоставляют значения по умолчанию. Для Visual Studio 2015 эти файлы находятся в *`\Program Files (x86)\MSBuild\Microsoft.Cpp\v4.0\V140`* . Для Visual Studio 2017 эти файлы находятся в *`\Program Files (x86)\Microsoft Visual Studio\2017\<edition>\Common7\IDE\VC\VCTargets`* , где *`<edition>`* установлен выпуск Visual Studio. В Visual Studio 2019 эти файлы находятся в *`\Program Files (x86)\Microsoft Visual Studio\2019\<edition>\MSBuild\Microsoft\VC\v160`* . Свойства также хранятся во всех пользовательских *`.props`* файлах, которые можно добавить в проект. Настоятельно рекомендуется не изменять эти файлы вручную. Вместо этого используйте страницы свойств в интегрированной среде разработки, чтобы изменить все свойства, особенно те, которые участвуют в наследовании, если у вас нет глубокого понимания MSBuild.

Как указано выше, одному свойству для некоторой конфигурации можно назначить разные значения в разных файлах. При сборке проекта модуль MSBuild оценивает файл проекта и все импортированные файлы в строго определенном порядке (как описано ниже). По мере оценки каждого файла все значения свойств, определенные в этом файле, переопределяют существующие значения. Все значения, которые не указаны, наследуются от файлов, которые были оценены ранее. При задании свойства со страницами свойств также важно обратить внимание на то, где оно задано. Если для свойства задано значение "X" в *`.props`* файле, но для свойства задано значение "y" в файле проекта, то проект будет строиться со свойством, для которого задано значение "y". Если для одного и того же свойства в элементе проекта задано значение "Z", например файл *`.cpp`* , то подсистема MSBuild будет использовать значение "z".

Ниже представлено базовое дерево наследования.

1. Параметры по умолчанию из набора инструментов MSBuild CPP (.. \Program Files\MSBuild\Microsoft.Cpp\v4.0\Microsoft.Cpp.Default.props, который импортируется *`.vcxproj`ным* файлом.)

1. Страницы свойств.

1. файл *`.vcxproj`* . (может переопределять параметры по умолчанию и параметры страницы свойств).

1. Метаданные элементов.

> [!TIP]
> На странице свойств в текущем контексте определено свойство, **выделенное жирным шрифтом** . Свойство в обычном шрифте наследуется.

## <a name="view-an-expanded-project-file-with-all-imported-values"></a>Просмотр развернутого файла проекта со всеми импортированными значениями

Иногда полезно просмотреть развернутый файл, чтобы определить, как наследуется значение данного свойства. Для просмотра развернутой версии введите следующую команду в командной строке Visual Studio (замените заполнители на конкретные имена файлов).

> **MSBuild/ПП:** _TEMP_ **. txt** _MyApp_ **. vcxproj**

Развернутые файлы проектов могут быть достаточно большими и понятны, если вы не знакомы с MSBuild. Ниже представлена основная структура файла проекта.

1. Фундаментальные свойства проекта, которые не отображаются в интегрированной среде разработки.

1. Импорт *`Microsoft.cpp.default.props`* , который определяет некоторые основные свойства, независимые от набора инструментов.

1. Глобальные свойства конфигурации (предоставляемые как свойства по умолчанию **PlatformToolset** и **Project** на странице **Конфигурация &gt; Общие**). Эти свойства определяют, какие набор инструментов и встроенные страницы свойств импортируются в *`Microsoft.cpp.props`* на следующем шаге.

1. Импорт *`Microsoft.cpp.props`* , который задает большинство значений по умолчанию для проекта.

1. Импорт всех страниц свойств, включая *`.user`* файлы. Эти страницы свойств могут переопределить все значения, кроме свойств по умолчанию **PlatformToolset** и **Project**.

1. Остальные свойства конфигурации проекта. Эти значения могут переопределять значения, заданные на страницах свойств.

1. Элементы (файлы) вместе с связанными с ними метаданными. Эти элементы всегда являются последними словами в правилах оценки MSBuild, даже если они происходят перед другими свойствами и импортом.

Дополнительные сведения см. в разделе [Свойства MSBuild](/visualstudio/msbuild/msbuild-properties).

## <a name="build-configurations"></a>Конфигурации сборки

Конфигурация — это просто произвольная группа свойств, которым назначено имя. Visual Studio предоставляет конфигурации отладки и выпуска. Каждый из них устанавливает различные свойства соответствующим образом для отладочной сборки или сборки выпуска. Для определения пользовательских конфигураций можно использовать **Configuration Manager** . Они представляют собой удобный способ группировки свойств для определенной разновидности сборки.

Чтобы лучше понять конфигурации сборки, откройте **Диспетчер свойств**. Его можно открыть, выбрав **вид > Диспетчер свойств** или **просмотреть > другие > Диспетчер свойств**в зависимости от параметров. **Диспетчер свойств** содержит узлы для каждой пары конфигурация и платформа в проекте. В каждом из этих узлов находятся узлы для страниц свойств ( *`.props`* файлы), которые задают определенные свойства для этой конфигурации.

![Диспетчер свойств](media/property-manager.png "Диспетчер свойств")

Например, можно открыть панель «Общие» на страницах свойств. Измените значение свойства кодировки на "не задано" вместо "использовать Юникод", а затем нажмите кнопку " **ОК**". В диспетчер свойств теперь не отображается страница свойств **поддержки Юникода** . Он удаляется для текущей конфигурации, но по-прежнему существует и для других конфигураций.

Дополнительные сведения о диспетчере и страницах свойств см. в статье [Совместное или повторное использование параметров проекта Visual Studio C++](create-reusable-property-configurations.md).

> [!TIP]
> Файл *`.user`* является устаревшей функцией. Рекомендуется удалить его, чтобы правильно сгруппировать свойства в соответствии с конфигурацией и платформой.
