---
title: Наследование свойств в проектах Visual Studio — C++
ms.date: 05/16/2019
helpviewer_keywords:
- C++ projects, property inheritance
ms.openlocfilehash: 472700226ffc1f265f6fab84dbd44fca651b3c87
ms.sourcegitcommit: a10c9390413978d36b8096b684d5ed4cf1553bc8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/17/2019
ms.locfileid: "65837408"
---
# <a name="property-inheritance-in-visual-studio-projects"></a>Наследование свойств в проектах Visual Studio

Система проектов Visual Studio основана на платформе MSBuild, которая определяет форматы файлов и правила сборки проектов любого типа. Платформа MSBuild в значительной степени упрощает сборку для нескольких платформ и конфигураций, но вам нужно немного разобраться в ее работе. Это особенно важно в том случае, если вы хотите определить настраиваемые конфигурации или создать многоразовые наборы свойств, которые можно совместно использовать и импортировать в несколько проектов.

## <a name="the-vcxproj-file-props-files-and-targets-files"></a>Файл VCXPROJ, файлы PROPS и TARGETS

Свойства проекта хранятся непосредственно в файле проекта (VCXPROJ) либо в других файлах TARGETS или PROPS, импортируемых файлом проекта и предоставляющих значения по умолчанию. Для Visual Studio 2015 эти файлы расположены в **\Program Files (x86)\MSBuild\Microsoft.Cpp\v4.0\V140**. Для Visual Studio 2017 или Visual Studio 2019 эти файлы расположены в папке **\\Program Files (x86)\\Microsoft Visual Studio\\&lt;2017 или 2019\\_выпуск_\\Common7\\IDE\\VC\\VCTargets**, где _выпуск_ — это установленный выпуск Visual Studio. Свойства также хранятся в любых пользовательских файлах PROPS, которые вы можете добавить в свой проект. Если у вас нет четкого представления о работе MSBuild, настоятельно рекомендуется не изменять эти файлы вручную и использовать для изменения свойств, особенно участвующих в наследовании, страницы свойств в интегрированной среде разработки.

Как указано выше, одному свойству для некоторой конфигурации можно назначить разные значения в разных файлах. При сборке проекта модуль MSBuild оценивает файл проекта и все импортированные файлы в строго определенном порядке (как описано ниже). По мере оценки каждого файла все значения свойств, определенные в этом файле, переопределяют существующие значения. Все неуказанные значения наследуются от файлов, оцененных ранее. Таким образом, при установке свойства с помощью страниц свойств важно следить за тем, где именно вы это делаете. Если задать свойство X в файле PROPS, при том что для того же свойства задано значение Y в файле проекта, проект будет создан со свойством, имеющим значение Y. Если то же свойство имеет значение Z для элемента проекта, например CPP-файла, то модуль MSBuild использует значение Z. 

Ниже представлено базовое дерево наследования.

1. Параметры по умолчанию из набора инструментов CPP системы MSBuild (..\Program Files\MSBuild\Microsoft.Cpp\v4.0\Microsoft.Cpp.Default.props, импортируемый VCXPROJ-файлом).

2. Страницы свойств.

3. VCXPROJ-файл (может переопределять параметры по умолчанию и параметры страницы свойств).

4. Метаданные элементов.

> [!TIP]
> Свойство, выделенное полужирным шрифтом (`bold`) на странице свойств, определяется в текущем контексте. Свойство в обычном шрифте наследуется.

## <a name="view-an-expanded-project-file-with-all-imported-values"></a>Просмотр развернутого файла проекта со всеми импортированными значениями

Иногда полезно просмотреть развернутый файл, чтобы определить, как наследуется значение данного свойства. Для просмотра развернутой версии введите следующую команду в командной строке Visual Studio (замените заполнители на конкретные имена файлов).

**msbuild /pp:** *temp* **.txt** *myapp* **.vcxproj**

Развернутые файлы проекта могут быть большими и трудными для понимания, если пользователь не знаком с MSBuild. Ниже представлена основная структура файла проекта.

1. Основные свойства проекта, которые не представлены в интегрированной среде разработки.

2. Импорт файла Microsoft.cpp.default.props, который определяет некоторые базовые, независимые от набора инструментов свойства.

3. Глобальные свойства конфигурации (предоставляемые как свойства по умолчанию **PlatformToolset** и **Project** на странице **Конфигурация &gt; Общие**). Эти свойства определяют, какие страницы свойств наборов инструментов и встроенные страницы свойств будут импортироваться из файла Microsoft.cpp.props на следующем шаге.

4. Импорт файла Microsoft.cpp.props, который задает большинство значений проекта по умолчанию.

5. Импорт всех страниц свойств, включая USER-файлы. Эти страницы свойств могут переопределить все значения, кроме свойств по умолчанию **PlatformToolset** и **Project**.

6. Остальная часть свойств конфигурации проекта. Эти значения могут переопределять значения, заданные на страницах свойств.

7. Элементы (файлы) вместе с связанными с ними метаданными. Эти элементы всегда используются последними в правилах вычисления MSBuild, даже если появляются до других свойств и импортов.

Дополнительные сведения см. в разделе [Свойства MSBuild](/visualstudio/msbuild/msbuild-properties).

## <a name="build-configurations"></a>Конфигурации сборки

Конфигурация — это просто произвольная группа свойств, которым назначено имя. Visual Studio предоставляет конфигурации отладки и выпуска, каждая из которых задает различные свойства соответственно для сборки отладки или выпуска. Вы можете использовать **Configuration Manager** для определения настраиваемых конфигураций — так удобно группировать свойства для определенной конфигурации сборки. 

Чтобы получить более полное представление о конфигурациях сборки, откройте **диспетчер свойств**, выбрав **Вид &#124; Диспетчер свойств** или **Вид &#124; Другие окна &#124; Диспетчер свойств** в зависимости от настроек. В **диспетчере свойств** есть узлы для каждой пары конфигурации и платформы в проекте. В каждом из этих узлов находятся узлы для страниц свойств (файлы PROPS), позволяющие задать некоторые свойства для этой конфигурации.

![Диспетчер свойств](media/property-manager.png "Диспетчер свойств")

Если перейти в область "Общие" на страницах свойств и задать для свойства "Кодировка" значение "Не задано" вместо "Использовать Юникод" и нажать кнопку **ОК**, диспетчер свойств не будет показывать страницу свойств **Поддержка Юникода** для текущей конфигурации, однако она сохранится для других конфигураций.

Дополнительные сведения о диспетчере и страницах свойств см. в статье [Совместное или повторное использование параметров проекта Visual Studio C++](create-reusable-property-configurations.md).

> [!TIP]
> Файл USER — это устаревший компонент, и мы рекомендуем удалить его, чтобы обеспечить правильную группировку свойств по конфигурации и платформе.



