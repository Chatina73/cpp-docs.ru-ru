---
title: Процедура очистки
ms.date: 11/04/2016
ms.assetid: 82c5d0ca-70be-4d1a-a306-bfe01c29159f
ms.openlocfilehash: 2d68a5c3fb1cc2d18b587d1419b0103d02b35a7f
ms.sourcegitcommit: 6052185696adca270bc9bdbec45a626dd89cdcdd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/31/2018
ms.locfileid: "50523118"
---
# <a name="unwind-procedure"></a>Процедура очистки

В массиве кодов очистки сортируется в порядке убывания. При возникновении исключения, полный контекст сохраняется операционной системой в записи контекста. Затем вызывается логика обработки исключений, которая постоянно выполняет следующие действия, чтобы найти обработчик исключений.

1. Используйте текущий RIP, хранящиеся в записи контекста для поиска таблице RUNTIME_FUNCTION, описывающий текущую функцию (или часть функции, в случае связанных записей UNWIND_INFO).

1. При обнаружении записи в таблице функций, то это в конечной и RSP будет напрямую к указателю возврата. Возвращают указатель на [RSP] сохраняется в обновленном контексте, смоделированный RSP увеличивается на 8 и повторить шаг 1.

1. При обнаружении записи в таблице функции RIP может лежать в трех регионах) в заключительной части, b) в прологе или c) в коде, которые могут быть включены в обработчик исключений.

   - Case) если RIP лежит в заключительной части, то элемент управления выходит из функции, может существовать обработчик исключения для этой функции и последствия эпилога необходимо продолжить для вычисления контекста вызывающей функции. Чтобы определить, если RIP в заключительной части, поток кода из зарезервированного IP-адреса, в проверке. Если поток кода могут быть сопоставлены с конечной части допустимого эпилога, то он находится в заключительной части и моделировании оставшуюся часть эпилога, с помощью записи контекста, обновляются при каждой инструкцией по обработке. После этого продолжается, шаг 1.

   - Случай b), если RIP находится в прологе, то элемент управления не вошел в функцию, может существовать обработчик исключения для этой функции и влияние пролога должны быть отменены для вычисления контекста вызывающей функции. RIP лежит в прологе, если расстояние от начала функции до RIP меньше или равен размеру пролога, закодированные в раскрутки. Результаты в прологе очищаются при просмотре вперед по массиве кодов очистки для первой записи со смещением, меньшим или равным смещению RIP от начала функции, а затем Отмена результата для всех остальных элементов в массиве кодов очистки. Шаг 1, затем повторяется.

   - Случай c), если RIP находится за пределами пролога или эпилога и функция имеет обработчик исключений (UNW_FLAG_EHANDLER имеет значение), то вызывается обработчик конкретного языка. Обработчик просматривает данные и вызывает соответствующие функции фильтра. Обработчик конкретного языка может возвращать, что исключение было обработано или что поиск будет продолжен. Его также можно инициировать очистку напрямую.

1. Если обработчик конкретного языка возвращается в состояние обработано, то выполнение продолжается с использованием исходной записи контекста.

1. Если отсутствует обработчик конкретного языка или обработчик возвращается в состояние «продолжить», записи контекста должен быть развернут в состояние вызывающего объекта. Это достигается путем обработки всех элементов массива кода очистки, Отмена результата каждого из них. Шаг 1, затем повторяется.

При объединении в цепочку очистки данные, по-прежнему соблюдаются следующие основные шаги. Единственное отличие том, что во время прохода в массиве кодов очистки для очистки для пролога, по достижении конца массива, она затем привязывается к раскрутки родительского и выполняется обход всей очистки массиву. Эта привязка продолжается до раскрутки без флага UNW_CHAINED_INFO и завершения прохождения по массиву кода очистки.

Данные раскрутки наименьший набор имеет размер 8 байт. Этот объект представляет функцию, которая 128 байтов стека или меньше и сэкономить один защищенный регистр. Это также размер связанной структуры данных очистки для пролога нулевой длины без кодов очистки.

## <a name="see-also"></a>См. также

[Обработка исключений (x64)](../build/exception-handling-x64.md)