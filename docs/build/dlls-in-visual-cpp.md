---
title: Создание библиотек DLL на C и C++ в Visual Studio
description: Общие сведения о том, зачем и как библиотеки DLL на C++ создаются и используются в Visual Studio.
ms.date: 01/27/2020
helpviewer_keywords:
- executable files [C++]
- dynamic linking [C++]
- linking [C++], dynamic vs. static
- DLLs [C++]
- DLLs [C++], about DLLs
ms.assetid: 5216bca4-51e2-466b-b221-0e3e776056f0
ms.openlocfilehash: 7083924f137fa9283da40404c7d15183e59c0b1c
ms.sourcegitcommit: 7ecd91d8ce18088a956917cdaf3a3565bd128510
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/16/2020
ms.locfileid: "79422832"
---
# <a name="create-cc-dlls-in-visual-studio"></a>Создание библиотек DLL на C и C++ в Visual Studio

В Windows библиотека динамической компоновки (DLL) является исполняемым файлом, который выступает в качестве общей библиотеки функций и ресурсов. Динамическая компоновка — это возможность операционной системы. Она позволяет исполняемому файлу вызывать функции или использовать ресурсы, хранящиеся в отдельном файле. Эти функции и ресурсы можно компилировать и развертывать отдельно от использующих их исполняемых файлов.

Библиотека DLL не является отдельным исполняемым файлом. Библиотеки DLL выполняются в контексте приложений, которые их вызывают. Операционная система загружает библиотеку DLL в область памяти приложения. Это делается либо при загрузке приложения (*неявная компоновка*), либо по запросу во время выполнения (*явная компоновка*). Библиотеки DLL также упрощают совместное использование функций и ресурсов различными исполняемыми файлами. Несколько приложений могут осуществлять одновременный доступ к содержимому одной копии библиотеки DLL в памяти.

## <a name="differences-between-dynamic-linking-and-static-linking"></a>Различия между динамической и статической компоновкой

При статической компоновке весь код объектов копируется из статической библиотеки в использующие их исполняемые файлы во время сборки. При динамической компоновке включаются только те сведения, которые позволяют Windows найти и загрузить библиотеку DLL, содержащую элемент данных или функцию, во время выполнения. При создании библиотеки DLL также создается библиотека импорта, содержащая эту информацию. При сборке исполняемого файла, который вызывает библиотеку DLL, компоновщик использует экспортированные символы в библиотеке импорта, чтобы сохранить эти сведения для загрузчика Windows. Когда загрузчик загружает библиотеку DLL, она сопоставляется с областью памяти приложения. Для выполнения операций инициализации, необходимых библиотеке DLL, вызывается специальная функция `DllMain` из библиотеки DLL (если она имеется).

<a name="differences-between-applications-and-dlls"></a>

## <a name="differences-between-applications-and-dlls"></a>Различия между приложениями и библиотеками DLL

Хотя и библиотеки DLL, и приложения являются исполняемыми модулями, они отличаются некоторыми особенностями. Наиболее очевидное различие заключается в том, что библиотеку DLL нельзя запустить. С точки зрения системы, между приложениями и библиотеками DLL имеется два существенных различия.

- В системе может одновременно выполняться несколько экземпляров приложения. Экземпляр библиотеки DLL может быть только один.

- Приложение может загружаться как процесс. Ему могут принадлежать такие компоненты, как стек, потоки выполнения, глобальная память, дескрипторы файлов и очередь сообщений. У библиотеки DLL таких компонентов быть не может.

<a name="advantages-of-using-dlls"></a>

## <a name="advantages-of-using-dlls"></a>Преимущества использования библиотек DLL

Динамическая компоновка кода и ресурсов имеет некоторые преимущества над статической.

- Динамическая компоновка экономит память и сокращает подкачку. Многие процессы могут использовать библиотеку DLL совместно, одновременно обращаясь к одной доступной только для чтения копии ее частей в памяти. В отличие от этого, каждое приложение, созданное с помощью библиотеки статической компоновки, имеет полную копию кода библиотеки, которую система Windows должна загрузить в память.

- Динамическая компоновка экономит место на диске и пропускную способность. Несколько приложений могут совместно использовать одну копию библиотеки DLL на диске. В отличие от этого, каждое приложение, созданное с помощью библиотеки статической компоновки, имеет код библиотеки, связанный с исполняемым образом. Это увеличивает занимаемое на диске место и используемую для передачи данных пропускную способность.

- Обслуживание, применение исправлений для системы безопасности и обновление могут быть проще. Если приложения используют общие функции в библиотеке DLL, можно реализовать исправления ошибок и развернуть обновления для нее. При обновлении библиотек DLL использующие их приложения не нужно перекомпилировать или повторно компоновать. Они могут использовать новые библиотеки DLL сразу после их развертывания. В отличие от этого, при внесении исправлений в код статически скомпонованного объекта необходимо повторно скомпоновать и развернуть каждое использующее его приложение.

- С помощью библиотек DLL можно оказывать послепродажную поддержку. Например, библиотеку DLL драйвера дисплея можно изменить так, чтобы она поддерживала дисплей, который не был доступен на момент предоставления приложения.

- С помощью явной компоновки можно обнаруживать и загружать библиотеки DLL во время выполнения. Например, это могут быть расширения приложения, которые добавляют новые функциональные возможности без повторной сборки и развертывания приложения.

- Динамическая компоновка упрощает поддержку приложений, написанных на разных языках программирования. Программы, написанные на разных языках программирования, могут вызывать одну и ту же функцию в библиотеке DLL при условии соблюдения соглашения о ее вызове. Программы и функция в библиотеке DLL должны отвечать следующим требованиям к совместимости: ожидаемый функцией порядок передачи аргументов в стек; выполнение очистки стека функцией или приложением; передача аргументов в регистрах.

- Динамическая компоновка обеспечивает механизм для расширения классов библиотеки Microsoft Foundation Classes (MFC). На основе существующих классов MFC можно создавать производные классы и помещать их в библиотеку расширения DLL, используемую приложениями MFC.

- Динамическая компоновка упрощает создание международных версий приложения. Библиотеки DLL — это удобный способ предоставления ресурсов для конкретных языковых стандартов, благодаря чему значительно упрощается создание международных версий приложения. Вместо предоставления множества локализованных версий приложения можно поместить строки и изображения для каждого языка в отдельную библиотеку DLL ресурсов. Затем приложение может загружать ресурсы для нужного языкового стандарта во время выполнения.

Возможным недостатком использования библиотек DLL является то, что приложения не являются автономными. Они требуют наличия отдельного модуля DLL, которое должно проверяться в процессе установки.

## <a name="more-information-on-how-to-create-and-use-dlls"></a>Дополнительные сведения о создании и использовании библиотек DLL

В приведенных ниже статьях приводятся подробные сведения о создании библиотек DLL на C и C++ в Visual Studio.

[Пошаговое руководство: Создание и использование библиотеки DLL (C++)](walkthrough-creating-and-using-a-dynamic-link-library-cpp.md)\
Описывает создание и использование библиотек DLL при помощи Visual Studio.

[Виды библиотек DLL](kinds-of-dlls.md)\
Предоставляет сведения о различных типах библиотек DLL, которые доступны для сборки.

[Вопросы и ответы по библиотекам DLL](dll-frequently-asked-questions.md)\
Ответы на часто задаваемые вопросы о библиотеках DLL.

[Связывание исполняемого файла с библиотекой DLL](linking-an-executable-to-a-dll.md)\
Описание явного и неявного соединения с библиотекой DLL.

[Инициализация библиотеки DLL](run-time-library-behavior.md#initializing-a-dll)\
Описывается код инициализации библиотеки DLL, который должен выполняться при загрузке библиотеки DLL.

[Библиотеки DLL и поведение библиотеки времени выполнения Visual C++](run-time-library-behavior.md)\
Описывается последовательность запуска библиотеки DLL средой выполнения.

[Функции LoadLibrary и AfxLoadLibrary](loadlibrary-and-afxloadlibrary.md)\
Описывается использование функций `LoadLibrary` и `AfxLoadLibrary` для явной связи с библиотекой DLL во время выполнения.

[Функция GetProcAddress](getprocaddress.md)\
Описывается использование `GetProcAddress` для получения адреса экспортированной функции в DLL.

[Функции FreeLibrary и AfxFreeLibrary](freelibrary-and-afxfreelibrary.md)\
Описывается использование функций `FreeLibrary` и `AfxFreeLibrary`, когда модуль DLL больше не нужен.

[Порядок поиска библиотеки динамической компоновки (DLL)](/windows/win32/Dlls/dynamic-link-library-search-order)\
Описание пути поиска, который операционная система Windows использует для поиска библиотеки DLL в системе.

[Состояния модулей обычной библиотеки DLL MFC, динамически связанной с MFC](module-states-of-a-regular-dll-dynamically-linked-to-mfc.md)\
Описываются состояния модулей обычной библиотеки DLL, динамически связываемой с MFC.

[Библиотеки DLL для расширения MFC](extension-dlls-overview.md)\
Описываются библиотеки DLL, которые обычно реализуют классы многократного использования, производные от существующих классов MFC.

[Создание библиотек DLL, содержащих только ресурсы](creating-a-resource-only-dll.md)\
Библиотека DLL, содержащая только ресурсы, например значки, растровые изображения, строки и диалоговые окна.

[Локализованные ресурсы в приложениях MFC: вспомогательные библиотеки DLL](localized-resources-in-mfc-applications-satellite-dlls.md)\
Расширенная поддержка библиотек спутниковой связи DLL и содержит возможность, которая позволяет создавать приложения, локализированные на различные языки.

[Импорт и экспорт](importing-and-exporting.md)\
Импортирование открытых символов в приложение или экспортирование функций из библиотеки DLL

[Технология Active и библиотеки DLL](active-technology-and-dlls.md)\
Размещение серверов объектов внутри библиотеки DLL.

[Автоматизация в библиотеке DLL](automation-in-a-dll.md)\
Параметр автоматизации в решениях мастера библиотек DLL MFC.

[Соглашения об именовании библиотек DLL MFC](../mfc/mfc-library-versions.md#mfc-static-library-naming-conventions)\
Способ встраивания библиотек DLL в MFC, опираясь на четко структурированное соглашение об именовании.

[Вызов функций библиотек DLL из приложений Visual Basic](calling-dll-functions-from-visual-basic-applications.md)\
Способ вызова функций DLL из приложений Visual Basic.

## <a name="related-sections"></a>Связанные разделы

[Использование MFC как части библиотеки DLL](../mfc/tn011-using-mfc-as-part-of-a-dll.md)\
Описываются постоянные библиотеки DLL MFC, которые позволяют использовать библиотеку MFC как часть библиотеки динамической компоновки Windows.

[Версия библиотеки DLL MFC](../mfc/tn033-dll-version-of-mfc.md)\
Описывается механизм использования общих библиотек динамической компоновки MFCxx.dll и MFCxxD.dll (где x является номером версии MFC) с приложениями MFC и расширениями библиотек DLL MFC.
