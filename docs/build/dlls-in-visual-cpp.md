---
title: Создание C/C++ DLL в Visual Studio
description: Общие сведения о том, почему и как создавать и использовать библиотеки C++ DLL в Visual Studio.
ms.date: 01/27/2020
helpviewer_keywords:
- executable files [C++]
- dynamic linking [C++]
- linking [C++], dynamic vs. static
- DLLs [C++]
- DLLs [C++], about DLLs
ms.assetid: 5216bca4-51e2-466b-b221-0e3e776056f0
ms.openlocfilehash: 7083924f137fa9283da40404c7d15183e59c0b1c
ms.sourcegitcommit: b8c22e6d555cf833510753cba7a368d57e5886db
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/29/2020
ms.locfileid: "76821425"
---
# <a name="create-cc-dlls-in-visual-studio"></a>Создание C/C++ DLL в Visual Studio

В Windows библиотека динамической компоновки (DLL) — это разновидность исполняемого файла, который выступает в качестве общей библиотеки функций и ресурсов. Динамическая компоновка — это возможность операционной системы. Он позволяет исполняемому файлу вызывать функции или использовать ресурсы, хранящиеся в отдельном файле. Эти функции и ресурсы можно компилировать и развертывать отдельно от использующих их исполняемых файлов.

Библиотека DLL не является изолированным исполняемым файлом. Библиотеки DLL выполняются в контексте приложений, которые их вызывают. Операционная система загружает библиотеку DLL в область памяти приложения. Это делается при загрузке приложения (*неявное связывание*) или по запросу во время выполнения (*явная компоновка*). Библиотеки DLL также упрощают совместное использование функций и ресурсов различными исполняемыми файлами. Несколько приложений могут осуществлять одновременный доступ к содержимому одной копии библиотеки DLL в памяти.

## <a name="differences-between-dynamic-linking-and-static-linking"></a>Различия между динамической компоновкой и статической компоновкой

Статическая компоновка копирует весь объектный код в статическую библиотеку в исполняемые объекты, использующие его при построении. Динамическая компоновка включает только сведения, необходимые Windows во время выполнения для нахождение и загрузки библиотеки DLL, содержащей элемент данных или функцию. При создании библиотеки DLL также создается библиотека импорта, содержащая эти сведения. При создании исполняемого файла, вызывающего библиотеку DLL, компоновщик использует экспортированные символы в библиотеке импорта для хранения этих сведений для загрузчика Windows. Когда загрузчик загружает библиотеку DLL, Библиотека DLL сопоставляется с областью памяти приложения. При наличии специальной функции в библиотеке DLL, `DllMain`, вызывается для инициализации библиотеки DLL.

<a name="differences-between-applications-and-dlls"></a>

## <a name="differences-between-applications-and-dlls"></a>Различия между приложениями и библиотеками DLL

Несмотря на то что библиотеки DLL и приложения являются исполняемыми модулями, они отличаются несколькими способами. Наиболее очевидная разница заключается в том, что невозможно запустить библиотеку DLL. С точки зрения системы существует два фундаментальных различия между приложениями и библиотеками DLL:

- Приложение может одновременно работать в системе нескольких экземпляров. Библиотека DLL может иметь только один экземпляр.

- Приложение может быть загружено как процесс. Она может выполнять такие задачи, как стек, потоки выполнения, глобальная память, дескрипторы файлов и очередь сообщений. Библиотека DLL не может владеть этими объектами.

<a name="advantages-of-using-dlls"></a>

## <a name="advantages-of-using-dlls"></a>Преимущества использования библиотек DLL

Динамическая компоновка с кодом и ресурсами обеспечивает ряд преимуществ по сравнению со статической компоновкой.

- Динамическая компоновка экономит память и сокращает подкачку. Многие процессы могут использовать библиотеку DLL одновременно, совместно используя одну копию частей библиотеки DLL, предназначенных только для чтения, в памяти. В отличие от этого, каждое приложение, созданное с помощью статической библиотеки, имеет полную копию кода библиотеки, которую Windows должна загрузить в память.

- Динамическая компоновка экономит место на диске и пропускную способность. Многие приложения могут совместно использовать одну копию библиотеки DLL на диске. Напротив, каждое приложение, созданное с помощью статической библиотеки ссылок, имеет код библиотеки, связанный с исполняемым образом. При этом используется больше места на диске, а для передачи — дополнительная пропускная способность.

- Обслуживание, исправления безопасности и обновления могут быть проще. Если приложения используют общие функции в библиотеке DLL, можно реализовать исправления ошибок и развернуть обновления в библиотеке DLL. При обновлении библиотек DLL приложения, использующие их, не нуждаются в повторной компиляции или повторной компоновке. Они могут использовать новую библиотеку DLL сразу после развертывания. В отличие от этого, при внесении исправлений в статически связываемый объектный код необходимо повторно связать и повторно развернуть каждое приложение, которое его использует.

- Вы можете использовать библиотеки DLL для предоставления поддержки по окончании рынка. Например, библиотеку DLL видеодрайверов можно изменить для поддержки экрана, который не был доступен при отгрузке приложения.

- Вы можете использовать явную связь для обнаружения и загрузки библиотек DLL во время выполнения. Например, расширения приложений, которые добавляют в приложение новые функциональные возможности без перестроения или повторного развертывания.

- Динамическая компоновка упрощает поддержку приложений, написанных на разных языках программирования. Программы, написанные на разных языках программирования, могут вызывать одну и ту же функцию DLL, если программы следуют соглашению о вызовах функции. Программы и функции DLL должны быть совместимы следующими способами: порядок, в котором функция требует, чтобы ее аргументы были помещены в стек. Несет ли функция или приложение ответственность за очистку стека. И указывает, передаются ли аргументы в регистры.

- Динамическая компоновка предоставляет механизм для расширения классов библиотеки Microsoft Foundation Class (MFC). Можно наследовать классы из существующих классов MFC и поместить их в библиотеку DLL расширения MFC для использования приложениями MFC.

- Динамическая компоновка упрощает создание международных версий приложения. Библиотеки DLL — это удобный способ предоставления ресурсов, зависящих от языкового стандарта, что значительно упрощает создание международных версий приложения. Вместо того чтобы доставлять несколько локализованных версий приложения, можно разместить строки и изображения для каждого языка в отдельной библиотеке DLL ресурсов. Затем приложение может загрузить соответствующие ресурсы для этого языкового стандарта во время выполнения.

Потенциальные недостатки использования библиотек DLL в том, что приложение не является автономным. Это зависит от существования отдельного модуля DLL: один из них необходимо развернуть или проверить в рамках установки.

## <a name="more-information-on-how-to-create-and-use-dlls"></a>Дополнительные сведения о создании и использовании библиотек DLL

В следующих статьях содержатся подробные сведения о создании C/C++ DLL в Visual Studio.

[Пошаговое руководство. Создание и использование библиотеки динамическойC++компоновки ()](walkthrough-creating-and-using-a-dynamic-link-library-cpp.md)\
Описывает создание и использование библиотек DLL при помощи Visual Studio.

[Типы библиотек dll](kinds-of-dlls.md)\
Предоставляет сведения о различных типах библиотек DLL, которые доступны для сборки.

[Часто задаваемые вопросы о библиотеке DLL](dll-frequently-asked-questions.md)\
Ответы на часто задаваемые вопросы о библиотеках DLL.

[Связывание исполняемого файла с библиотекой DLL](linking-an-executable-to-a-dll.md)\
Описание явного и неявного соединения с библиотекой DLL.

[Инициализация библиотеки DLL](run-time-library-behavior.md#initializing-a-dll)\
Описывает код инициализации DLL, который должен выполняться при загрузке библиотеки DLL.

[Библиотеки DLL и C++ визуальное поведение библиотеки времени выполнения](run-time-library-behavior.md)\
Описывает последовательность запуска DLL библиотеки времени выполнения.

[LoadLibrary и афкслоадлибрари](loadlibrary-and-afxloadlibrary.md)\
Обсуждается использование `LoadLibrary` и `AfxLoadLibrary` для явной компоновки библиотеки DLL во время выполнения.

\ [GetProcAddress](getprocaddress.md)
Обсуждается использование `GetProcAddress` для получения адреса экспортированной функции в библиотеке DLL.

\ [FreeLibrary и AfxFreeLibrary](freelibrary-and-afxfreelibrary.md)
Обсуждается использование `FreeLibrary` и `AfxFreeLibrary`, когда модуль DLL больше не нужен.

\ [Порядок поиска библиотеки динамической компоновки](/windows/win32/Dlls/dynamic-link-library-search-order)
Описание пути поиска, который операционная система Windows использует для поиска библиотеки DLL в системе.

[Состояния модулей обычной библиотеки DLL MFC, динамически связываемые с MFC](module-states-of-a-regular-dll-dynamically-linked-to-mfc.md)\
Описывает состояния модулей обычной библиотеки DLL MFC, динамически связываемые с MFC.

[Библиотеки DLL расширения MFC](extension-dlls-overview.md)\
Описывает библиотеки DLL, которые обычно реализуют многократно используемые классы, производные от существующих классов MFC.

[Создание библиотеки DLL только для ресурсов](creating-a-resource-only-dll.md)\
Библиотека DLL, содержащая только ресурсы, например значки, растровые изображения, строки и диалоговые окна.

[Локализованные ресурсы в приложениях MFC: вспомогательные библиотеки dll](localized-resources-in-mfc-applications-satellite-dlls.md)\
Расширенная поддержка библиотек спутниковой связи DLL и содержит возможность, которая позволяет создавать приложения, локализированные на различные языки.

[Импорт и экспорт](importing-and-exporting.md)\
Импортирование открытых символов в приложение или экспортирование функций из библиотеки DLL

[Активные технологии и библиотеки dll](active-technology-and-dlls.md)\
Размещение серверов объектов внутри библиотеки DLL.

[Автоматизация в библиотеке DLL](automation-in-a-dll.md)\
Параметр автоматизации в решениях мастера библиотек DLL MFC.

[Соглашения об именовании для библиотек DLL MFC](../mfc/mfc-library-versions.md#mfc-static-library-naming-conventions)\
Способ встраивания библиотек DLL в MFC, опираясь на четко структурированное соглашение об именовании.

[Вызов функций DLL из Visual Basic приложений](calling-dll-functions-from-visual-basic-applications.md)\
Способ вызова функций DLL из приложений Visual Basic.

## <a name="related-sections"></a>Связанные разделы

[Использование MFC в составе библиотеки DLL](../mfc/tn011-using-mfc-as-part-of-a-dll.md)\
Описывает регулярные библиотеки DLL MFC, которые позволяют использовать библиотеку MFC в составе библиотеки динамической компоновки Windows.

[Версия библиотеки DLL\ MFC](../mfc/tn033-dll-version-of-mfc.md)
Описывает, как можно использовать Мфккскс. dll и Мфкксксд. dll (где x — номер версии MFC) общих библиотек динамической компоновки с приложениями MFC и библиотеками DLL расширения MFC.
