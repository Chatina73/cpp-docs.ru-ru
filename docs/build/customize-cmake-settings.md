---
title: Настройка параметров сборки CMake в Visual Studio
ms.date: 04/25/2019
helpviewer_keywords:
- CMake build settings
ms.openlocfilehash: 20ed066f71a5c8c3acb00ef5923fa5c9f16ac229
ms.sourcegitcommit: 18d3b1e9cdb4fc3a76f7a650c31994bdbd2bde64
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/29/2019
ms.locfileid: "64877160"
---
# <a name="customize-cmake-build-settings"></a>Настройка параметров сборки CMake

::: moniker range="vs-2019"

В Visual Studio 2019 г. и более поздних версиях можно добавить конфигурации и настроить их параметры с помощью **редактор параметров CMake**. Редактор предназначено для более простой альтернативой редактирования файла CMakeSettings.json, но если вы предпочитаете, чтобы напрямую изменить файл, вы можете щелкнуть **изменить JSON** ссылку в правом верхнем углу редактора. 

Чтобы открыть редактор, щелкните **конфигурации** раскрывающееся меню в главной панели инструментов и выберите **управление конфигурациями**.

![Конфигураций CMake раскрывающегося списка](media/vs2019-cmake-manage-configurations.png)

Теперь вы видите **редактор параметров** с конфигурациями, установленных в левой части. 

![Редактор параметров CMake](media/cmake-settings-editor.png)

Visual Studio предоставляет две конфигурации по умолчанию: `x64-Debug` и `x86-Debug`. Вы можете добавлять дополнительные конфигурации, нажав кнопку "плюс". Параметры, отображаемые в редакторе могут различаться в зависимости от того, что конфигурация выбрана.

Параметры, которые выбираются в редакторе записываются в файл с именем CMakeSettings.json. Этот файл предоставляет аргументы командной строки и переменные среды, передаваемые CMake при сборке проектов. Visual Studio никогда не изменяет CMakeLists.txt автоматически. с помощью CMakeSettings.json сборки в Visual Studio можно настроить при этом файлы проектов CMake без изменений, чтобы другие члены команды можно использовать их с помощью любого средства, они используют.

## <a name="cmake-general-settings"></a>Общие параметры CMake

Следующие параметры доступны в разделе **Общие** заголовка:

### <a name="configuration-name"></a>Имя конфигурации

Соответствует **имя** параметр. Это имя, которое отображается в C++ раскрывающийся список конфигурации. Можно использовать `${name}` макрос для создания других значений свойств, например пути.


### <a name="configuration-type"></a>Тип конфигурации

Соответствует **при выборе configurationType** параметр. Определяет тип конфигурации сборки для выбранного генератора. Сейчас поддерживаются значения Debug, MinSizeRel, Release и RelWithDebInfo.

### <a name="toolset"></a>Набор инструментов

Соответствует **inheritedEnvironments** параметр. Определяет среду компилятора, который будет использоваться для создания выбранной конфигурации. Поддерживаемые значения зависят от типа конфигурации. Чтобы создать пользовательскую среду, нажмите кнопку **изменить JSON** ссылку в правом верхнем углу редактора параметров и измените файл CMakeSettings.json напрямую.

### <a name="cmake-toolchain-file"></a>Файл цепочки инструментов CMake

Путь к файлу цепочки инструментов CMake. Передаются cmake в виде «-DCMAKE_TOOLCHAIN_FILE = \<filepath >».

### <a name="build-root"></a>Создание корневой

Соответствует **buildRoot**. Сопоставляется **-DCMAKE_BINARY_DIR** переключения и указывает, где будут создаваться кэш CMake. Если папка не существует, она будет создана.

## <a name="command-arguments"></a>аргументы команды.

Следующие параметры доступны в разделе **аргументы команды** заголовка:

### <a name="cmake-command-arguments"></a>Аргументы команды CMake

Соответствует **cmakeCommandArgs**. Указывает дополнительные параметры для передачи CMake.exe.

### <a name="build-command-arguments"></a>Аргументы командной сборки

Соответствует **buildCommandArgs**: Указывает дополнительные параметры для передачи базовой системы сборки. Например, передача -v при использовании генератора Ninja приводит к тому, что Ninja выдает командные строки.


### <a name="ctest-command-arguments"></a>Аргументы команды CTest

Соответствует**ctestCommandArgs**: Указывает дополнительные параметры, передаваемые CTest при выполнении тестов.

## <a name="general-settings-for-remote-builds"></a>Общие параметры для удаленной сборки

Для конфигурации например Linux, которые используют удаленные сборки также доступны следующие параметры:

### <a name="rsync-command-arguments"></a>Аргументы команды rsync

Предоставляет аргументы команды должны быть переданы в rsync. 

## <a name="cmake-variables-and-cache"></a>Переменные CMake и кэша

Эти параметры позволяют задать переменные CMake и сохранять их в CMakeSettings.json. Они передаются CMake во время сборки и переопределяет любые значения возможно, с файлом CMakeLists.txt. Этот раздел можно использовать таким же образом, можно использовать для просмотра списка всех доступных для изменения переменных CMake CMakeGUI. Нажмите кнопку **сохранить и создать кэш** кнопку, чтобы просмотреть список всех переменных CMake, доступных для редактирования, включая дополнительные переменные (за CMakeGUI). Можно отфильтровать список по имени переменные. 

Соответствует **переменных**: содержит пары имя значение переменных CMake, будет передаваемых как **-D** *_имя_ =  _значение_* для CMake. Если инструкции сборки проекта CMake указывают добавление каких-либо переменных непосредственно в файл кэша CMake, рекомендуется вместо этого добавить их сюда.

## <a name="advanced-settings"></a>Дополнительные параметры

### <a name="cmake-generator"></a>Генератора CMake

Соответствует **генератор**: сопоставляется CMake **- G** переключения и задает генератор для использования. Это свойство можно также использовать как макрос `${generator}`, чтобы задать другие значения свойств. Сейчас Visual Studio поддерживает следующие генераторы CMake:

  - Ninja
  - «Файлы makefile Unix»
  - «Visual Studio 2019 г. 16»
  - «Visual Studio 2019 г. 16 Win64»
  - - «2019 г. 16 ARM для visual Studio»
  - Visual Studio 15 2017
  - Visual Studio 15 2017 Win64
  - Visual Studio 15 2017 ARM
  - Visual Studio 14 2015
  - Visual Studio 14 2015 Win64
  - Visual Studio 14 2015 ARM
  
  Так как генератор Ninja предназначен для ускорения сборки в ущерб гибкости и функциональности, он используется по умолчанию. Однако некоторые проекты CMake могут быть неспособны использовать Ninja правильно. В этом случае можно велеть CMake создать проект Visual Studio.

### <a name="intellisense-mode"></a>Режим IntelliSense

Для точных IntelliSense установите соответствующее значение для вашего проекта.

### <a name="install-directory"></a>Каталог установки

Каталог, в котором CMake устанавливает целевые объекты, которые он создает.

### <a name="cmake-executable"></a>Исполняемый файл CMake

Полный путь к исполняемому файлу CMake, включая имя файла и расширение. Удаленные сборки укажите расположение CMake на удаленном компьютере.

Для конфигурации например Linux, которые используют удаленные сборки также доступны следующие параметры:

### <a name="remote-cmakeliststxt-root"></a>Удаленный корневой CMakeLists.txt

Каталог на удаленном компьютере, содержащую корневой файл CMakeLists.txt.

### <a name="remote-install-root"></a>Корневой удаленной установки

Каталог на удаленном компьютере, в котором CMake устанавливает целевых объектов.

### <a name="remote-copy-sources"></a>Копирование удаленной источников

Указывает, следует ли копировать исходные файлы на удаленный компьютер и позволяет указать, следует ли использовать вариант rsync или sftp. 

## <a name="directly-edit-cmakesettingsjson"></a>Напрямую изменить CMakeSettings.json

Можно также напрямую изменить `CMakeSettings.json` для создания настраиваемых конфигураций. **Редактор параметров** имеет **изменить JSON** кнопки в правом верхнем углу, который открывает файл для редактирования. 

В следующем примере показано пример конфигурации, который можно использовать в качестве отправной точки:

```json
    {
      "name": "x86-Debug",
      "generator": "Ninja",
      "configurationType": "Debug",
      "inheritEnvironments": [ "msvc_x86" ],
      "buildRoot": "${env.USERPROFILE}\\CMakeBuilds\\${workspaceHash}\\build\\${name}",
      "installRoot": "${env.USERPROFILE}\\CMakeBuilds\\${workspaceHash}\\install\\${name}",
      "cmakeCommandArgs": "",
      "buildCommandArgs": "-v",
      "ctestCommandArgs": ""
    },

```

JSON IntelliSense позволяет редактировать `CMakeSettings.json` файла:

   ![JSON IntelliSense CMake](media/cmake-json-intellisense.png "JSON IntelliSense CMake")

Редактор JSON также сообщит вам при выборе несовместимые параметры.

Дополнительные сведения о всех свойств в файле, см. в разделе [Справочник по схеме CMakeSettings.json](cmakesettings-reference.md).

::: moniker-end

::: moniker range="<=vs-2017"

Visual Studio 2017 предоставляет несколько конфигураций CMake, которые определяют, каким образом CMake.exe вызывается для создания кэша CMake для данного проекта. Чтобы добавить новую конфигурацию, щелкните раскрывающийся список конфигурации на панели инструментов и выберите **Управление конфигурациями**.

   ![Управление конфигурациями CMake](media/cmake-manage-configurations.png)

Можно выбрать из списка стандартных конфигураций:

   ![Предопределенные конфигурации CMake](media/cmake-configurations.png)

При первом выборе конфигурации Visual Studio создает файл `CMakeSettings.json` в корневой папке проекта. Этот файл используется для повторного создания файла кэша CMake, например после операции **Очистить**. 

Чтобы добавить дополнительную конфигурацию, щелкните правой кнопкой мыши `CMakeSettings.json` и выберите **Добавить конфигурацию**. 

   ![Добавление конфигурации CMake](media/cmake-add-configuration.png "Добавление конфигурации CMake")

Можно также изменить файл с помощью **редактора параметров CMake**. Щелкните правой кнопкой мыши `CMakeSettings.json` в **обозревателе решений** и выберите **Изменить параметры CMake**. Или выберите **Управление конфигурациями** из раскрывающегося списка конфигурации в верхней части окна редактора. 

Можно также напрямую изменить `CMakeSettings.json` для создания настраиваемых конфигураций в следующем примере показан пример конфигурации, который можно использовать в качестве отправной точки:

```json
    {
      "name": "x86-Debug",
      "generator": "Ninja",
      "configurationType": "Debug",
      "inheritEnvironments": [ "msvc_x86" ],
      "buildRoot": "${env.USERPROFILE}\\CMakeBuilds\\${workspaceHash}\\build\\${name}",
      "installRoot": "${env.USERPROFILE}\\CMakeBuilds\\${workspaceHash}\\install\\${name}",
      "cmakeCommandArgs": "",
      "buildCommandArgs": "-v",
      "ctestCommandArgs": ""
    },

```

JSON IntelliSense помогает изменить файл `CMakeSettings.json`:

   ![JSON IntelliSense CMake](media/cmake-json-intellisense.png "JSON IntelliSense CMake")

Дополнительные сведения о всех свойств в файле, см. в разделе [Справочник по схеме CMakeSettings.json](cmakesettings-reference.md).

::: moniker-end

## <a name="see-also"></a>См. также

[Проекты CMake в Visual Studio](cmake-projects-in-visual-studio.md)<br/>
[Настройка проекта Linux CMake](../linux/cmake-linux-project.md)<br/>
[Подключение к удаленному компьютеру Linux](../linux/connect-to-your-remote-linux-computer.md)<br/>
[Настройка сеансов отладки CMake](configure-cmake-debugging-sessions.md)<br/>
[Развертывание, запуск и отладка проекта Linux](../linux/deploy-run-and-debug-your-linux-project.md)<br/>
[Справочник по предопределенной конфигурации CMake](cmake-predefined-configuration-reference.md)<br/>
