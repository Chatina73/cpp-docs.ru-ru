---
title: Проекты CMake в Visual Studio
ms.date: 03/27/2019
helpviewer_keywords:
- CMake in Visual C++
ms.assetid: 444d50df-215e-4d31-933a-b41841f186f8
ms.openlocfilehash: 22a8ecc34e6413c32628381241d45d3d76b39ecc
ms.sourcegitcommit: 72583d30170d6ef29ea5c6848dc00169f2c909aa
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/18/2019
ms.locfileid: "59030437"
---
# <a name="cmake-projects-in-visual-studio"></a>Проекты CMake в Visual Studio

CMake — это кроссплатформенное средство с открытым исходным кодом для определения процессов сборки, выполняемых на нескольких платформах. В этой статье предполагается, что вы уже знакомы с CMake. Дополнительные сведения см. в разделе [Сборка, тестирование и упаковывание вашего программного обеспечения с помощью CMake](https://cmake.org/).

В Visual Studio 2015 пользователи Visual Studio могут использовать [генератор CMake](https://cmake.org/cmake/help/latest/manual/cmake-generators.7.html) для создания файлов проекта MSBuild, которые интегрированная среда разработки использует для IntelliSense, просмотра и компиляции.

В Visual Studio 2017 появилась широкая поддержка CMake, включая [кроссплатформенные проекты CMake](../linux/cmake-linux-project.md). Компонент **Инструменты Visual C++ для CMake** использует функцию **Открыть папку**, чтобы позволить интегрированной среде разработки использовать файлы проекта CMake (например, CMakeLists.txt) для IntelliSense и просмотра. Поддерживаются генераторы Visual Studio и Ninja. Если вы используете генератор Visual Studio, создается временный файл проекта, который передается в msbuild.exe, но никогда не загружается для IntelliSense или просмотра. Вы можете импортировать существующего кэша CMake; Visual Studio автоматически извлекает настраиваемые переменные и создает предварительно заполненный **CMakeSettings.json** файла. 

## <a name="installation"></a>Установка

Компонент **Инструменты Visual C++ для CMake** устанавливается по умолчанию в составе рабочей нагрузки **Разработка классических приложений на C++** и **Разработка приложений Linux на C++**.

![Компонент CMake в рабочей нагрузке классических приложений на C++](media/cmake-install.png)

Дополнительные сведения см. в разделе [Установка рабочей нагрузки Linux для проектов C++ в Visual Studio](../linux/download-install-and-setup-the-linux-development-workload.md).

## <a name="ide-integration"></a>Интеграция с IDE

Если выбрать **Файл | Открыть | Папка**, чтобы открыть папку, содержащую файл CMakeLists.txt, происходит следующее.

- Visual Studio добавляет пункт **CMake** в главное меню с командами для просмотра и редактирования сценариев CMake.

- **Обозреватель решений** отображает структуру папок и файлы.

- Visual Studio запускает CMake.exe и при необходимости создает кэш CMake для *конфигурации* по умолчанию, которой является отладка x86. В **окне вывода** отображается командная строка CMake, а также дополнительные выходные данные CMake.

- В фоновом режиме Visual Studio индексирует исходные файлы для поддержки функций IntelliSense, просмотра информации, рефакторинга и т. д. По мере работы Visual Studio отслеживает изменения в редакторе, а также на диске, чтобы синхронизировать индекс с источниками.

Вы можете открыть папки, содержащие любое количество проектов CMake. Visual Studio обнаруживает и настраивает все "корневые" файлы CMakeLists.txt в рабочей области. Операции CMake (настройка, сборка, отладка), а также C++ IntelliSense и просмотр доступны для всех проектов CMake в вашей рабочей области.

![Проект CMake с несколькими корнями](media/cmake-multiple-roots.png)

Вы также можете просмотреть проекты, логически упорядоченные по целевым объектам. Выберите **Представление целевых объектов** из раскрывающегося списка на панели инструментов в **обозревателе решений**:

![Кнопка "Представление целевых объектов CMake"](media/cmake-targets-view.png)

Visual Studio использует файл с именем **CMakeSettings.json** для хранения переменных среды или параметры командной строки для Cmake.exe. **CMakeSettings.json** также позволяет вам определить и сохранить несколько CMake конфигурации построения и легко переключаться между ними в интегрированной среде разработки. 

В противном случае используйте **CMakeLists.txt** так же, как вы бы в любой проект CMake, чтобы указать файлы с исходным, найдет библиотеки, параметры компилятора и компоновщика и укажите другие системы сборки сведений, связанных с.

Если вам нужно передавать аргументы для исполняемого файла во время отладки, можно использовать другой файл с именем **launch.vs.json**. В некоторых случаях Visual Studio автоматически создает эти файлы; их можно изменять вручную. Также можно создать файл самостоятельно.

> [!NOTE]
> Открыть папку проекты других типов используются два дополнительных файла JSON: **CppProperties.json** и **tasks.vs.json**. Ни один из них не связан с проектами CMake.

## <a name="import-an-existing-cache"></a>Импорт существующего кэша

Когда вы импортируете существующий файл CMakeCache.txt, Visual Studio автоматически извлекает настраиваемые переменные и создает на их основе предварительно заполненный файл **CMakeSettings.json**. Исходный кэш никак не изменяется и по-прежнему может использоваться из командной строки либо с помощью любого средства или любой интегрированной среды разработки, использованных для его создания. Новый **CMakeSettings.json** файл помещается вместе с корневой проекта CMakeLists.txt. Visual Studio создает кэш на основе файла параметров. Вы можете переопределить автоматическое создание кэша в диалоговом окне **Сервис | Параметры | CMake | Общие**.

Импортируется не все содержимое кэша.  Такие свойства, как генератор и расположение компиляторов, заменяются значениями по умолчанию, хорошо совместимыми с данной интегрированной средой разработки.

### <a name="to-import-an-existing-cache"></a>Импорт существующего кэша

1. В главном меню выберите **Файл | Открыть | CMake**:

   ![Открытие CMake](media/cmake-file-open.png "Файл, Открыть, CMake")

   Отображается мастер **импорта CMake из кэша**.

2. Перейдите к файлу CMakeCache.txt, который хотите импортировать, и нажмите кнопку **ОК**. Отображается мастер **импорта CMake из кэша**:

   ![Импорт кэша CMake](media/cmake-import-wizard.png "Открытие мастера импорта кэша CMake")

   По завершении работы мастера вы увидите новый файл CMakeCache.txt в **обозревателе решений** рядом с корневым файлом CMakeLists.txt в проекте.

## <a name="building-cmake-projects"></a>Создание проектов CMake

Для создания проекта CMake доступны следующие варианты:

1. В панели «Общие» найдите **конфигураций** раскрывающийся список; он, вероятно, отображается «Linux-Debug» или «x64-отладка» по умолчанию. Выберите требуемую конфигурацию и нажмите клавишу **F5**, или нажмите кнопку **запуска** (зеленый треугольник) кнопку на панели инструментов. Сначала автоматически выполняется сборка проекта как решения Visual Studio.

1. Щелкните CMakeLists.txt правой кнопкой мыши и выберите пункт **Сборка**. Если в структуре папок имеется несколько целевых объектов, можно выбрать сборку их всех или только одного из них.

1. В главном меню выберите **Сборка | Собрать решение** (нажмите клавишу **F7** или клавиши **CTRL+SHIFT+B**). Убедитесь, что целевой объект CMake уже выбран в раскрывающемся списке **Автозапускаемый элемент** на панели инструментов **Общие**.

![Команда меню сборки CMake](media/cmake-build-menu.png "Команда меню сборки CMake")

Конфигурации построения, переменные среды, аргументы командной строки и другие параметры можно настроить без изменения с файлом CMakeLists.txt с помощью **CMakeSettings.json** файла. Дополнительные сведения см. в статье [Настраиваемые параметры CMake](customize-cmake-settings.md).

Как и следовало ожидать, результаты сборки отображаются в **окне вывода** и **списке ошибок**.

![Ошибки сборки CMake](media/cmake-build-errors.png "Ошибки сборки CMake")

В папке с несколькими целевыми объектами сборки можно выбрать элемент **Сборка** в меню **CMake** или контекстном меню **CMakeLists.txt**, чтобы указать целевой объект CMake для сборки. Нажав клавиши **CTRL+SHIFT+B** в проекте CMake, можно выполнить сборку текущего активного документа.

## <a name="debugging-cmake-projects"></a>Отладка проектов CMake

Для отладки проекта CMake выберите требуемую конфигурацию и нажмите клавишу **F5** или кнопку **Выполнить** на панели инструментов. Если для кнопки **Выполнить** отображается сообщение "Выбрать элемент запуска", выберите стрелку раскрывающегося списка и выберите целевой объект, который требуется запустить. (В проекте CMake параметр "Текущий документ" допустим только для файлов CPP.)

![Кнопка запуска CMake](media/cmake-run-button.png "Кнопка запуска CMake")

Команды **Выполнить** или **F5** сначала выполняют сборку проекта, если с момента предыдущей сборки были внесены изменения.

Вы можете настроить CMake, сеанс отладки, задав свойства в **launch.vs.json** файла. Дополнительные сведения см. в разделе [Настройка сеансов отладки CMake](configure-cmake-debugging-sessions.md).


## <a name="editing-cmakeliststxt-files"></a>Изменение файлов CMakeLists.txt

Чтобы изменить файл CMakeLists.txt, щелкните его правой кнопкой мыши в **обозревателе решений** и выберите пункт **Открыть**. Если вы вносите изменения в файл, отображается желтая строка состояния, которая сообщает о предстоящем обновлении IntelliSense, а также позволяет отменить эту операцию обновления. Сведения о CMakeLists.txt см. в [документации по CMake](https://cmake.org/documentation/).

   ![Изменение файла CMakeLists.txt](media/cmake-cmakelists.png "Изменение файла CMakeLists.txt")

Сразу после сохранения файла автоматически перезапускается этап настройки, отображающий информацию в окне **вывода**. Ошибки и предупреждения отображаются в **списке ошибок** или окне **вывода**. Дважды щелкните ошибку в окне **Список ошибок**, чтобы перейти к строке с ошибкой в CMakeLists.txt.

   ![Ошибки в файле CMakeLists.txt](media/cmake-cmakelists-error.png "Ошибки в файле CMakeLists.txt")


## <a name="cmake-configure-step"></a>Шаг настройки CMake

При значительных изменений в **CMakeSettings.json** или к файлам CMakeLists.txt в Visual Studio автоматически перезапустит CMake шаг настройки. Если шаг настройки завершается без ошибок, собранные данные становятся доступны в C++ IntelliSense и языковых службах, а также в операциях сборки и отладки.

Если несколько проектов CMake используют одно имя конфигурации CMake (например, x86-Debug), все они настраиваются и собираются (в собственной корневой папке сборки) при выборе этой конфигурации. Вы можете отлаживать целевые объекты изо всех проектов CMake, участвующих в этой конфигурации CMake.

   ![Элемент меню "Только сборка" CMake](media/cmake-build-only.png "Элемент меню \"Только сборка\" CMake")

Чтобы ограничить сборки и отладки сеансы для некоторых проектов в рабочей области, создать новую конфигурацию с уникальным именем в **CMakeSettings.json** файл и применить его только для этих проектов. При выборе этой конфигурации IntelliSense, а также команды сборки и отладки активируются только для этих указанных проектов.

## <a name="troubleshooting-cmake-cache-errors"></a>Устранение ошибок кэша CMake

Если вам нужны дополнительные сведения о состоянии кэша CMake для диагностики проблемы, откройте главное меню **CMake** или контекстное меню **CMakeLists.txt** в **обозревателе решений**, чтобы выполнить одну из следующих команд:

- **Просмотреть кэш** открывает файл CMakeCache.txt из корневой папки сборки в редакторе. (Любые внесенные здесь изменения в CMakeCache.txt удаляются при очистке кэша. Чтобы внести изменения, которые сохраняются после очистки кэша, см. в разделе [параметры настройки CMake](customize-cmake-settings.md).)

- **Открыть папку кэша** открывает окно проводника с корневой папкой сборки.

- **Очистить кэш** удаляет корневую папку сборки, чтобы следующий шаг настройки CMake начинался с очистки кэша.

- **Создать кэш** принудительно создает шаг для выполнения, даже если Visual Studio считает среду актуальной.

Вы можете отключить автоматическое создание кэша в диалоговом окне **Сервис | Параметры | CMake | Общие**.

## <a name="single-file-compilation"></a>Компиляция одного файла

Для сборки отдельного файла в проекте CMake щелкните правой кнопкой мыши файл в **обозревателе решений** и нажмите **Компилировать**. Вы также можете скомпилировать открытый в редакторе файл через главное меню CMake:

![Компиляция одного файла в CMake](media/cmake-single-file-compile.png)

## <a name="run-cmake-from-the-command-line"></a>Запуск CMake из командной строки

Если вы установили CMake из Visual Studio Installer, можете запустить это средство из командной строки, сделав следующее:

1. Запустите соответствующий файл vsdevcmd.bat (x86 или x64). Дополнительные сведения см. в статье [Build C/C++ code on the command line](building-on-the-command-line.md) (Создание кода C или C++ в командной строке).

1. Перейдите в папку выходных данных.

1. Запустите CMake для создания или настройки приложения.
  
## <a name="see-also"></a>См. также

[Учебник. Создание кроссплатформенных проектов C++ в Visual Studio](get-started-linux-cmake.md)<br/>
[Настройка проекта Linux CMake](../linux/cmake-linux-project.md)<br/>
[Подключение к удаленному компьютеру Linux](../linux/connect-to-your-remote-linux-computer.md)<br/>
[Настройка параметров сборки CMake](customize-cmake-settings.md)<br/>
[Справочник по CMakeSettings.json](cmakesettings-reference.md)<br/>
[Настройка сеансов отладки CMake](configure-cmake-debugging-sessions.md)<br/>
[Развертывание, запуск и отладка проекта Linux](../linux/deploy-run-and-debug-your-linux-project.md)<br/>
[Справочник по предопределенной конфигурации CMake](cmake-predefined-configuration-reference.md)<br/>
