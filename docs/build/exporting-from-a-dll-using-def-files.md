---
title: Экспорт из библиотеки DLL с использованием DEF-файлов
ms.date: 05/06/2019
helpviewer_keywords:
- def files [C++], exporting from DLLs
- .def files [C++], exporting from DLLs
- exporting DLLs [C++], DEF files
ms.assetid: 9d31eda2-184e-47de-a2ee-a93ebd603f8e
ms.openlocfilehash: 8fdbb060502f339eb748306eef582d2f296b1f60
ms.sourcegitcommit: 1f009ab0f2cc4a177f2d1353d5a38f164612bdb1
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/27/2020
ms.locfileid: "87229835"
---
# <a name="exporting-from-a-dll-using-def-files"></a>Экспорт из библиотеки DLL с использованием DEF-файлов

DEF-файл определения модуля (*.def) — это текстовый файл, содержащий один или несколько операторов модуля, описывающих различные атрибуты библиотеки DLL. Если вы не используете ключевое слово **`__declspec(dllexport)`** для экспорта функций библиотеки DLL, то для библиотеки DLL требуется DEF-файл.

Как минимум, DEF-файл должен содержать следующие операторы определения модуля:

- Первым оператором в файле должен быть LIBRARY. Этот оператор определяет DEF-файл как принадлежащий библиотеке DLL. За оператором LIBRARY следует имя библиотеки DLL. Компоновщик помещает это имя в библиотеку импорта DLL.

- Оператор EXPORTS перечисляет имена и, при необходимости, порядковые значения функций, экспортируемых библиотекой DLL. Вы назначаете функцию с порядковым номером, после которого следует имя функции со знаком @ и числом. При указании порядковых значений они должны находиться в диапазоне от 1 до N, где N — число функций, экспортируемых библиотекой DLL. Если требуется экспортировать функции по порядковому номеру, см. раздел [Экспорт функций из библиотеки DLL по порядковому номеру, а не по имени](exporting-functions-from-a-dll-by-ordinal-rather-than-by-name.md) в этом разделе.

Например, библиотека DLL, содержащая код для реализации дерева двоичного поиска, может выглядеть следующим образом:

```
LIBRARY   BTREE
EXPORTS
   Insert   @1
   Delete   @2
   Member   @3
   Min   @4
```

При использовании [мастера MFC DLL](../mfc/reference/mfc-dll-wizard.md) для создания библиотеки DLL MFC мастер создает скелет DEF-файла и автоматически добавляет его в проект. Добавьте в этот файл имена функций, подлежащих экспорту. Для библиотек DLL, отличных от MFC, создайте DEF-файл и добавьте его в проект. Затем выберите **Проект** > **Свойства** > **Компоновщик** > **Ввод** > **Файл определения модуля** и введите имя DEF файла. Повторите этот шаг для каждой конфигурации и платформы или сделайте это одновременно, выбрав **Конфигурация = Все конфигурации** и **Платформа = Все платформы**.

При экспорте функций в файл C++ необходимо либо поместить внутренние имена в DEF-файл, либо определить экспортированные функции с помощью стандартной компоновки C, используя модификатор extern "C". Если необходимо поместить внутренние имена в DEF-файл, их можно получить с помощью средства [DUMPBIN](../build/reference/dumpbin-reference.md) или с помощью параметра [/MAP](../build/reference/map-generate-mapfile.md) компоновщика. Обратите внимание, что внутренние имена, создаваемые компилятором, зависят от компилятора. Если в DEF-файл помещаются внутренние имена, созданные компилятором Microsoft C++ (MSVC), то приложения, которые связаны с библиотекой DLL, также должны быть построены с использованием той же версии компилятора MSVC, чтобы внутренние имена в вызывающем приложении совпадали с экспортированными именами в DEF-файле библиотеки DLL.

> [!NOTE]
> Библиотека DLL, созданная с помощью Visual Studio 2015, может быть использована приложениями, созданными с помощью Visual Studio 2017 или Visual Studio 2019.

Если вы создаете [расширение библиотеки DLL](../build/extension-dlls-overview.md) и экспортируете с помощью DEF-файла, поместите следующий код в начало и в конец файлов заголовков, содержащих экспортированные классы:

```
#undef AFX_DATA
#define AFX_DATA AFX_EXT_DATA
// <body of your header file>
#undef AFX_DATA
#define AFX_DATA
```

Эти строки гарантируют, что переменные MFC, которые используются внутри классов или добавляются в классы, экспортируются (или импортируются) из библиотеки DLL расширения MFC. Например, при создании производного класса с помощью `DECLARE_DYNAMIC` макрос расширяется, добавляя в класс переменную элемента `CRuntimeClass`. Если не указывать эти четыре строки, то библиотека DLL может скомпилироваться или скомпоноваться неправильно или вызывать ошибку, когда клиентское приложение связывается с библиотекой DLL.

При сборке библиотеки DLL компоновщик использует DEF-файл для создания файла экспорта (EXP) и файла библиотеки импорта (LIB). Затем компоновщик использует файл экспорта для создания файла DLL. Исполняемые файлы, которые неявно связываются с библиотекой DLL, компонуются с библиотекой импорта при их построении.

Обратите внимание, что MFC использует DEF-файлы для экспорта функций и классов из MFCx0.dll.

## <a name="what-do-you-want-to-do"></a>Выберите действие

- [Экспорт из библиотеки DLL с использованием __declspec(dllexport)](exporting-from-a-dll-using-declspec-dllexport.md)

- [Экспорт и импорт с использованием AFX_EXT_CLASS](exporting-and-importing-using-afx-ext-class.md)

- [Экспорт функций на языке C++ для использования в исполняемых модулях, исходный код которых написан на языке C](exporting-cpp-functions-for-use-in-c-language-executables.md)

- [Экспорт функций на языке C для использования в исполняемых файлах, исходный код которых написан на языке C или C++](exporting-c-functions-for-use-in-c-or-cpp-language-executables.md)

- [Определение подходящего способа экспорта](determining-which-exporting-method-to-use.md)

- [Импорт в приложение с помощью __declspec(dllimport)](importing-into-an-application-using-declspec-dllimport.md)

- [Инициализация библиотеки DLL](run-time-library-behavior.md#initializing-a-dll)

## <a name="what-do-you-want-to-know-more-about"></a>Дополнительные сведения

- [DEF-файлы](reference/module-definition-dot-def-files.md)

- [Правила для операторов определения модуля](reference/rules-for-module-definition-statements.md)

- [Внутренние имена](reference/decorated-names.md)

- [Импорт и экспорт встраиваемых функций](importing-and-exporting-inline-functions.md)

- [Взаимный импорт](mutual-imports.md)

## <a name="see-also"></a>См. также

[Экспорт из библиотеки DLL](exporting-from-a-dll.md)
