---
title: Редактирование и рефакторинг кода C++ в Visual Studio
description: Используйте редактор кода C++ в Visual Studio для форматирования, навигации, понимания и рефакторинга кода.
ms.date: 05/31/2019
ms.assetid: 56ffb9e9-514f-41f4-a3cf-fd9ce2daf3b6
ms.topic: overview
ms.openlocfilehash: df59509f37567a6fe1d1e0cc6d5b9f38b953009c
ms.sourcegitcommit: 9c2b3df9b837879cd17932ae9f61cdd142078260
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/29/2020
ms.locfileid: "92924405"
---
# <a name="edit-and-refactor-c-code-in-visual-studio"></a>Редактирование и рефакторинг кода C++ в Visual Studio

Visual Studio предоставляет разные средства для написания, редактирования и рефакторинга кода.

## <a name="intellisense"></a>IntelliSense

IntelliSense — это мощное средство завершения кода, которое предлагает символы и фрагменты по мере ввода кода. IntelliSense C++ в Visual Studio выполняется в реальном времени, анализируя вашу базу кода по мере ее обновления и предоставляя рекомендации. Чем больше символов вы вводите, тем меньше предлагается рекомендуемых результатов.

![Раскрывающийся список членов C++](../ide/media/cpp-statement-completion.png)

Некоторые символы пропускаются автоматически, чтобы еще больше сократить список результатов. Например, обращаясь извне класса к элементам его объекта, вы не сможете просмотреть частные элементы (по умолчанию) или защищенные элементы (если вы не в контексте дочернего класса). Вы можете настроить фильтрацию с помощью кнопок в нижней части.

Выбрав нужный символ из раскрывающегося списка, вы можете вызвать для него автозавершение клавишами **TAB** или **ВВОД** либо использовать один из других символов фиксации (по умолчанию: `{ } [ ] ( ) . , : ; + - * / % & | ^ ! = ? @ # \`). Чтобы добавить или удалить символы из этого списка, выполните поиск по слову IntelliSense в поле **быстрого запуска** (CTRL+Q) и последовательно выберите **Текстовый редактор > C/C++ > Дополнительно**. Параметр **Символы фиксации списка членов** позволяет настроить список, внеся необходимые изменения.

Параметр **Режим фильтрации списка членов** определяет, какие виды автозавершения IntelliSense вы видите. По умолчанию для этого параметра установлено значение **Нечеткий**. Если при нечетком поиске соответствий у вас есть символ, который называется *MyAwesomeClass* , вы можете ввести MAC и найти класс в предложениях автозаполнения. Алгоритм нечеткого поиска задает минимальный порог, которому должны соответствовать символы, отображаемые в списке. При **интеллектуальной** фильтрации будут отображаться все символы, которые содержат подстроки, соответствующие тому, что вы ввели. При фильтрации по **префиксу** выполняется поиск строк, которые начинаются с введенных вами символов.

См. подробнее в руководствах по [Visual C++ IntelliSense](/visualstudio/ide/visual-cpp-intellisense) и [настройке проекта C++ для IntelliSense](/visualstudio/ide/visual-cpp-intellisense-configuration).

## <a name="intellicode"></a>IntelliCode

IntelliCode — это средство IntelliSense на основе ИИ, которое помещает предположительно наиболее подходящий результат в верхнюю часть списка завершения. Для создания рекомендаций IntelliCode анализирует тысячи проектов с открытым кодом на GitHub, каждый из которых имеет более 100 звезд. В сочетании с контекстом кода список завершения используется для популяризации распространенных приемов работы.

Когда вы пишете код на C++, IntelliCode помогает вам с использованием таких популярных библиотек, как стандартная библиотека C++. Контекст кода используется для ранжирования наиболее полезных рекомендаций. В следующем примере функция-член `size` часто используется с функцией `sort`, поэтому она будет отображена в верхней части списка результатов.

![IntelliCode в C&#43;&#43;](../ide/media/intellicode-cpp.png "IntelliCode в C++")

::: moniker range="msvc-160"

В Visual Studio 2019 IntelliCode предоставляется как дополнительный компонент в рабочей нагрузке **Разработка классических приложений на C++** . Чтобы включить IntelliCode для C++, последовательно выберите **Средства** > **Параметры** > **IntelliCode** > **Общие** и задайте для параметра **Базовая модель C++** значение **Включено**.

::: moniker-end

::: moniker range="msvc-150"

В Visual Studio 2017 IntelliCode предоставляется как расширение в Visual Studio Marketplace.

::: moniker-end

## <a name="predictive-intellisense-experimental"></a>Прогнозная технология IntelliSense (экспериментальная функция)

**Прогнозная технология IntelliSense**  — это экспериментальная функция, которая ограничивает число результатов, отображаемых в раскрывающемся списке IntelliSense, на основе контекста. Алгоритм применяет сопоставление типов, чтобы отобразить только те результаты, которые соответствует ожидаемому типу. Самый просто пример: если ввести `int x =` и вызвать раскрывающийся список IntelliSense, вы увидите только целые числа или функции, которые их возвращают. Эта функция отключена по умолчанию, так как она еще разрабатывается. Лучше всего она работает с глобальными символами; функции-члены еще не поддерживаются. Можно включить эту функцию, введя "прогнозный" в поле **быстрого запуска** или последовательно выбрав **Средства** > **Параметры** > **Текстовый редактор** > **C/C++**  > **Экспериментальные функции** > **Включить прогнозный IntelliSense**.

Чтобы переопределить **прогнозный IntelliSense** и отобразить длинный список, нажмите клавиши **CTRL+J**. Если **прогнозный IntelliSense** включен, вызов **CTRL+J** удалит прогнозный фильтр. Повторное нажатие **CTRL+J** снова удалит фильтр специальных возможностей из результатов списка членов, где это применимо. Использование кнопки ([+]) в раскрывающемся списке IntelliSense аналогично нажатию клавиш **CTRL+J**. Наведите указатель на кнопку, чтобы увидеть подсказку о том, что сейчас отображается.

![Прогнозирование IntelliSense в C&#43;&#43;](../ide/media/predictive-intellisense-cpp.png "Прогнозирование IntelliSense")

На предыдущем снимке экрана показаны несколько кнопок в раскрывающемся списке. Они позволяют включить фильтры IntelliSense для получения разных типов результатов:

- Переменные и константы
- Функции
- Типы
- Макросы
- Перечисления
- Пространства имен

Кнопка отображается, только если это применимо в текущем сеансе IntelliSense. Как правило, все кнопки одновременно не отображаются.

## <a name="template-intellisense"></a>Шаблон IntelliSense

Когда курсор находится в определении шаблона, отображается **строка шаблона**. Она позволяет предоставлять аргументы примера шаблона для IntelliSense.

![Отображение существующих экземпляров IntelliSense для шаблона C&#43;&#43;](../ide/media/template-intellisense-cpp-1.png "Отображение существующих экземпляров для шаблона в IntelliSense")

Щелкните значок **\<T>** , чтобы развернуть или свернуть **строку шаблона**. Щелкните значок карандаша или дважды щелкните **строку шаблона** , чтобы открыть окно **Редактирование**.

![IntelliSense для шаблона C&#43;&#43;](../ide/media/template-intellisense-cpp-3.png "Шаблон IntelliSense")

Изменения, вносимые в окне, применяются непосредственно к исходному коду, поэтому результаты отображаются в реальном времени.

Строка шаблона может автоматически предлагать вероятные варианты на основе экземпляров в коде. Щелкните **Добавить все существующие экземпляры** , чтобы просмотреть список всех аргументов, которые использовались для создания экземпляра шаблона, во всей базе кода.

![Список результатов IntelliSense для шаблона C&#43;&#43;](../ide/media/template-intellisense-cpp-2.png "Список результатов для шаблона в IntelliSense")

В окне в нижней части редактора отображаются расположение и аргументы каждого экземпляра.

![Сопоставление экземпляров IntelliSense для шаблона C&#43;&#43;](../ide/media/template-intellisense-cpp-4.png "Сопоставление экземпляров для шаблона в IntelliSense")

Сведения в **строке шаблона** обрабатываются как связанные с конкретным пользователем. Они хранятся в папке .vs и не фиксируются в системе управления версиями.

## <a name="error-squiggles-and-quick-fixes"></a>Подчеркивание ошибок и быстрые исправления

Если редактор определяет ошибку в коде, он подчеркнет ее цветной волнистой линией. Красные волнистые линии указывают на код, который не будет скомпилирован. Зеленые волнистые линии указывают на другие проблемы, которые также могут быть серьезными. Вы можете открыть окно **Список ошибок** , чтобы просмотреть дополнительные сведения о проблемах.

Для некоторых типов ошибок (а также общих шаблонов создания кода) редактор будет предлагать **быстрое исправление** в виде лампочки, которая отображается, если навести указатель мыши на волнистую линию. Щелкните стрелку вниз, чтобы просмотреть предложения.

В следующем примере мы объявили `vector`, но определение не найдено, поэтому редактор предлагает включить требуемый файл заголовка:

![Снимок экрана: волнистая линия, указывающая на ошибку, и быстрое исправление, предлагаемое редактором](../ide/media/quick-fix-for-header-cpp.png "Быстрое исправление для С++")

Редактор также предлагает быстрые исправления для определенных функций рефакторинга. Например, если объявить класс в файле заголовка, Visual Studio предложит создать для него определение в отдельном файле .cpp.

![Снимок экрана: быстрое исправление с помощью выделенного пункта "Создать определение 'ChannelRouteIterator' в channels.cpp"](../ide/media/quick-fix.png "Быстрое исправление для С++")

## <a name="change-tracking"></a>Change tracking

При каждом изменении файла слева отображается желтая полоска, указывающая на то, что внесены несохраненные изменения. При сохранении файла полоска становится зеленой. Зеленая и желтая полоски отображаются, пока документ открыт в редакторе. Они представляют изменения, внесенные с момента последнего открытия документа.

![Отслеживание изменений C&#43;&#43;](../ide/media/change-tracking-cpp.png "Change tracking")

## <a name="move-code"></a>Перенос кода

Строки кода можно перемещать вверх и вниз. Для этого выберите их, удерживая нажатой клавишу ALT и одну из клавиш со стрелками ( **вверх или вниз** ).

## <a name="insert-snippets"></a>Вставка фрагментов кода

Фрагмент — это предварительно определенная часть исходного кода. Щелкните правой кнопкой мыши одну точку или выбранный текст для вставки фрагмента или размещения выбранного текста внутри фрагмента. На следующем рисунке показана процедура размещения выбранного оператора в цикле for. На последнем изображении желтым цветом выделены редактируемые поля, доступ к которым осуществляется с помощью клавиши TAB. Дополнительные сведения см. в статье [Фрагменты кода](/visualstudio/ide/code-snippets).

![Раскрывающийся список для вставки фрагментов кода C&#43;&#43;](../ide/media/vs2015_cpp_surround_with.png "vs2015_cpp_surround_with")

## <a name="add-class"></a>Добавить класс

Добавьте новый класс из меню **Проект** или контекстного меню в **обозревателе решений** :

![Добавление нового класса в C&#43;&#43;](../ide/media/vs2017-add-class.png "vs2015_cpp_add_class")

Можно также использовать мастер классов для изменения или просмотра существующего класса.

![Мастер классов C++](../ide/media/vs2017-class-wizard.png)

Дополнительные сведения см. в разделе [Добавление функциональных возможностей с помощью мастеров кода (C++)](../ide/adding-functionality-with-code-wizards-cpp.md).

## <a name="refactoring"></a>Рефакторинг

Рефакторинг доступен в контекстном меню быстрых действий. Или можно щелкнуть [лампочку](/visualstudio/ide/perform-quick-actions-with-light-bulbs) в редакторе.  Некоторые также находятся в меню **Правка > Рефакторинг**.  Эти функции включают перечисленные ниже.

- [Переименование](refactoring/rename.md)
- [Извлечение функции](refactoring/extract-function.md)
- [Реализация чистых виртуальных функций](refactoring/implement-pure-virtuals.md)
- [Создание объявления или определения](refactoring/create-declaration-definition.md)
- [Перемещение определения функции](refactoring/move-definition-location.md)
- [Преобразование в необработанный строковый литерал](refactoring/convert-to-raw-string-literal.md)
- [Изменение сигнатуры](refactoring/change-signature.md)

## <a name="code-style-enforcement-with-clangformat-and-editorconfig"></a>Применение стиля кода с помощью ClangFormat и EditorConfig

В Visual Studio, начиная с версии 2017, реализована поддержка [ClangFormat](https://clang.llvm.org/docs/ClangFormat.html) — популярной служебной программы для форматирования кода C++ на основе Clang/LLVM. Введите ClangFormat в поле [быстрого запуска](/visualstudio/ide/reference/quick-launch-environment-options-dialog-box), чтобы настроить использование одного из следующих распространенных форматов:

- LLVM
- Google
- Chromium
- Mozilla
- WebKit
- Visual Studio

Вы также можете предоставить свой собственный файл .clang-format или _clang-format, чтобы применять пользовательские правила ко всем файлам кода на том же уровне или ниже.

Эти файлы легко использовать совместно с помощью системы управления версиями, следовательно, вы можете применять соглашения о написании кода во всей группе разработчиков.

![Формат Clang для C&#43;&#43;](../ide/media/clang-format-cpp.png "Формат Clang")

Visual Studio, начиная с версии 2017, также поддерживает [EditorConfig](https://editorconfig.org/) — программу, которая работает аналогичным образом. Однако ClangFormat имеет больше параметров стиля, чем EditorConfig, включая правила, относящиеся к C++. С помощью **EditorConfig** вы можете создавать и размещать файлы **.editorconfig** в разных папках вашей базы кода, чтобы определять стили кода для этих папок и подпапок. Файл **.editorconfig** заменяет все другие файлы **.editorconfig** в родительских папках, перезаписывая все параметры форматирования, которые можно настроить, выбрав **Средства** > **Параметры**. Вы можете задать правила, определяющие использование табуляции и пробелов, настраивающие размер отступов и многое другое. См. подробнее о [создании переносимых настраиваемых параметров редактора с помощью EditorConfig](/visualstudio/ide/create-portable-custom-editor-options).

## <a name="other-formatting-options"></a>Другие параметры форматирования

Поле **быстрого запуска**  — это самый быстрый способ найти нужный параметр или средство. Поле расположено в главном меню. Просто начните ввод и список автоматического завершения отфильтрует результаты.

![Быстрый запуск Visual Studio](../ide/media/vs2015_cpp_quick_launch.png "Быстрый запуск")

Чтобы задать параметры форматирования, например отступы, завершение скобок и раскраску, введите C++ Formatting (Форматирование C++) в поле **быстрого запуска**.

![Параметры форматирования C++](media/cpp-formatting-options.png)

Другие параметры форматирования можно настроить в главном меню, выбрав **Изменить** > **Дополнительно**.

![Дополнительные параметры редактирования С++](media/edit-advanced-cpp.png)

Параметры для включения и настройки функций редактирования C++ можно настроить в разделе **Сервис** > **Параметры** > **Текстовый редактор** > **C/C++** . Чтобы получить дополнительную справку после выбора параметра, который вы хотите задать, выделите диалоговое окно и нажмите клавишу **F1**. Чтобы просмотреть общие параметры форматирования кода, введите `Editor C++` в поле **быстрого запуска**.

![Меню "Сервис" > "Параметры" в Visual Studio](../ide/media/tools-options.png "Параметры редактора")

Экспериментальные функции, которые могут присутствовать или отсутствовать в будущих версиях Visual Studio, можно найти в диалоговом окне [экспериментальных функций C++ для текстового редактора](/visualstudio/ide/reference/options-text-editor-c-cpp-experimental). В Visual Studio, начиная с версии 2017, в этом диалоговом окне можно включить **прогнозную технологию IntelliSense**.

## <a name="see-also"></a>См. также

[Чтение и понимание кода C++](read-and-understand-code-cpp.md)</br>
[Перемещение по базе кода С++ в Visual Studio](navigate-code-cpp.md)</br>
[Совместная работа с использованием Live Share для C++](live-share-cpp.md)
