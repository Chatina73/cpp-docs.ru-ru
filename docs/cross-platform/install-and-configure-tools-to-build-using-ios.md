---
title: Установка и настройка средств для разработки с помощью iOS
ms.date: 10/17/2019
ms.assetid: d0c311c9-9eb9-42c5-ba07-25604362cd28
ms.openlocfilehash: 26dea080f3d3f05885f348dcaf1c66a0db2a36b5
ms.sourcegitcommit: 6280a4c629de0f638ebc2edd446de2a9b11f0406
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/12/2020
ms.locfileid: "90041995"
---
# <a name="install-and-configure-tools-to-build-using-ios"></a>Установка и настройка средств для разработки с помощью iOS

Вы можете использовать Visual Studio с кросс-платформенными средствами для **разработки мобильных приложений на языке C++** для редактирования, отладки и развертывания кода iOS на симуляторе или устройстве iOS. Но, из-за лицензионных ограничений, код нужно создавать и выполнять на компьютере Mac удаленно. Для сборки и запуска приложений iOS с помощью Visual Studio необходимо установить и настроить удаленный агент [vcremote](https://www.npmjs.com/package/vcremote)на компьютере Mac. Удаленный агент обрабатывает запросы на сборку, поступающие из Visual Studio, и запускает приложение на устройстве iOS, подключенном к компьютеру Mac, или в эмуляторе iOS на компьютере Mac.

> [!NOTE]
> Сведения об использовании размещенных в облаке служб Mac вместо компьютера Mac см. в разделе [Настройка подключения Visual Studio к размещенному в облаке компьютеру Mac](/visualstudio/cross-platform/tools-for-cordova/tips-workarounds/host-a-mac-in-the-cloud?view=toolsforcordova-2017&preserve-view=true#configure-visual-studio-to-connect-to-your-cloud-hosted-mac). Приведенные инструкции предназначены для разработки с помощью инструментов Visual Studio для Apache Cordova. Чтобы использовать инструкции для сборки с помощью С++, замените `vcremote` на `remotebuild`.

После установки инструментов для сборки с помощью iOS, обратитесь к этой статье, чтобы получить дополнительные сведения о способах быстрой настройки и обновления удаленного агента для разработки iOS в Visual Studio и на вашем Mac.

## <a name="prerequisites"></a>Предварительные требования

Для установки и использования удаленного агента с целью разработки кода для iOS необходимы следующие компоненты:

- Компьютер Mac с операционной системой macOS Mojave (версии 10.14) или более поздней версии.

- [Идентификатор Apple ID](https://appleid.apple.com/)

- Действующая учетная запись [разработчика Apple](https://developer.apple.com/programs/).

   Вы можете получить бесплатную учетную запись, которая позволяет загружать неопубликованные приложения на устройстве с iOS для тестирования, но не для распространения.

- [Xcode](https://developer.apple.com/xcode/downloads/) версии 10.2.1 или более поздней.

   Xcode можно скачать в магазине App Store.

- Средства командной строки Xcode

   Чтобы установить средства командной строки Xcode, откройте приложение "Терминал" на компьютере Mac и введите следующую команду:

   `xcode-select --install`

- Учетная запись Apple ID, настроенная в Xcode, как удостоверение для подписи приложений.

   Чтобы просмотреть или задать удостоверение подписывания в Xcode, откройте меню **Xcode** и выберите пункт **Preferences**(Настройки). Щелкните **Accounts** (Учетные записи), выберите свой идентификатор Apple ID, а затем нажмите кнопку **View Details** (Просмотреть подробности). См. подробные инструкции в разделе [Добавление вашей учетной записи Apple ID](https://help.apple.com/xcode/mac/current/#/devaf282080a).

   Подробные сведения о требованиях для подписывания см. в разделе [Что такое подписывание приложений](https://help.apple.com/xcode/mac/current/#/dev3a05256b8).

- Профиль подготовки, настроенный в Xcode для вашего устройства, если для разработки вы используете устройство с iOS.

   Xcode обеспечивает автоматическое подписывание, создавая сертификаты для подписи при необходимости. Подробные сведения об автоматическом подписывании Xcode см. в разделе [Автоматическое подписывание](https://help.apple.com/xcode/mac/current/#/dev80cc24546).

   Если вы предпочитаете ручное подписывание, необходимо создать профиль подготовки для вашего приложения. Подробные сведения о создании профилей подготовки см. в статье [Создание профилей подготовки для разработки](https://help.apple.com/developer-account/#/devf2eb157f8).

- [Node.js](https://nodejs.org/) 12.14.1 и npm версии 6.13.4

   Установите версию Node.js 12.14.1 на своем компьютере Mac. Если вы установите пакет Node.js, он должен сопровождаться npm версии 6.13.4. Другие версии Node.js и npm могут не поддерживать некоторые модули, используемые в удаленном агенте `vcremote`, что может привести к сбою установки `vcremote`. Рекомендуется установить Node.js с помощью диспетчера пакетов, например [Node Version Manager](https://nodejs.org/en/download/package-manager/#nvm). Старайтесь не использовать команду `sudo` для установки Node.js, так как некоторые модули могут не устанавливаться при использовании `sudo`.

## <a name="install-the-remote-agent-for-ios"></a><a name="Install"></a> Установка удаленного агента для iOS

При установке мобильной разработки с рабочей нагрузкой C++, Visual Studio может взаимодействовать с удаленным агентом [vcremote](https://www.npmjs.com/package/vcremote), запущенным на вашем Mac для передачи файлов, сборки и запуска вашего iOS приложения, а также отправки команд отладки.

Перед установкой удаленного агента убедитесь, что вы выполнили [Предпосылки](#prerequisites) и шаги установки в разделе [Установка Visual C++ для разработки кроссплатформенных мобильных приложений на языке C++](../cross-platform/install-visual-cpp-for-cross-platform-mobile-development.md#install-the-tools).

### <a name="to-download-and-install-the-remote-agent"></a><a name="DownloadInstall"></a> Скачивание и установка удаленного агента

- В приложении терминала на компьютере Mac убедитесь, что используемая версия Node.js является обязательной версией 12.14.1. Чтобы проверить версию, выполните команду:

  `node -v`
  
  Если это неправильная версия, возможно, потребуется выполнить инструкции по установке Node.js, приведенные в предварительных требованиях. Затем перезапустите Node.js.

- Убедившись, что используется необходимая версия Node.js, выполните следующую команду, чтобы установить vcremote в этой версии Node.js:

   `npm install -g --unsafe-perm vcremote`

   Рекомендуется применять глобальный параметр установки (**-g**), но он не является обязательным. Если вы не используете параметр глобальной установки, vcremote устанавливается по текущему активному пути в приложении терминала.

   В ходе установки будет установлен `vcremote`, а на компьютере Mac будет активирован режим разработчика. Также будут установлены [Homebrew](https://brew.sh/) и два пакета npm, `vcremote-lib` и `vcremote-utils`. После завершения установки можно игнорировать любые предупреждения о пропущенных необязательных зависимостях.

   > [!NOTE]
   > Для установки Homebrew требуется доступ sudo (права администратора). Если вам нужно установить `vcremote` без доступа "sudo", вы можете установить Homebrew вручную в папку "usr/local" и добавить папку "bin" в ваш путь. Дополнительную информацию см. в [документации по Homebrew](https://github.com/Homebrew/homebrew/wiki/Installation). Чтобы включить режим разработчика вручную, введите в приложении "Терминал" следующую команду: `DevToolsSecurity -enable`

Если Visual Studio обновляется до новой версии, то также необходимо обновить удаленный агент до текущей версии. Чтобы обновить удаленный агент, еще раз выполните инструкции по его скачиванию и установке.

## <a name="start-the-remote-agent"></a><a name="Start"></a> Запуск удаленного агента

Чтобы среда Visual Studio могла выполнять сборку и запуск кода iOS, удаленный агент должен быть запущен. Для обмена данными с удаленным агентом среда Visual Studio должна быть сопряжена с ним. По умолчанию удаленный агент выполняется в режиме защищенного соединения, что требует ввода ПИН-кода для его сопряжения с Visual Studio.

### <a name="to-start-the-remote-agent"></a><a name="RemoteAgentStartServer"></a> Запуск удаленного агента

- В приложении "Терминал" на компьютере Mac введите следующую команду:

   `vcremote`

   Эта команда запускает удаленный агент со стандартным каталогом сборки `~/vcremote`. Дополнительные параметры конфигурации см. в разделе [Configure the remote agent on the Mac](#ConfigureMac).

При первом запуске агента, и каждый раз, когда вы создаете новый сертификат клиента, вам предоставляется необходимая информация для настройки агента в Visual Studio, включая имя узла, порт и PIN-код.

![Использование "vcremote" для создания безопасного ПИН-кода](../cross-platform/media/cppmdd-vcremote-generateclientcert.png "Использование vcremote для создания безопасного ПИН-кода")

Если вы намерены настроить удаленный агент в Visual Studio, используя имя узла, выполните проверку связи с компьютером Mac из Windows, используя это имя узла, чтобы убедиться в том, что он доступен. В противном случае может потребоваться использовать вместо имени узла IP-адрес.

Созданный ПИН-код является одноразовым и действителен в течение ограниченного срока. Если не выполнить сопряжение Visual Studio с удаленным агентом до истечения его срока действия, потребуется создать новый ПИН-код. Для получения дополнительной информации см. [Generate a new security PIN](#GeneratePIN).

Удаленный агент можно использовать в небезопасном режиме. В небезопасном режиме сопряжение удаленного агента с Visual Studio можно выполнить без ПИН-кода.

#### <a name="to-disable-secured-connection-mode"></a>Отключение режима защищенного соединения

- Чтобы отключить режим защищенного соединения в `vcremote`, введите эту команду в приложение "Терминал" на компьютере Mac:

   `vcremote --secure false`

#### <a name="to-enable-secured-connection-mode"></a>Включение режима защищенного соединения

- Чтобы включить режим защищенного соединения, введите следующую команду:

   `vcremote --secure true`

После запуска удаленного агента его можно использовать из Visual Studio, пока он не будет остановлен.

#### <a name="to-stop-the-remote-agent"></a>Остановка удаленного агента

- В окне терминала `vcremote` под управлением введите **элемент управления** + **C**.

## <a name="configure-the-remote-agent-in-visual-studio"></a><a name="ConfigureVS"></a> Настройка удаленного агента в Visual Studio

Чтобы подключиться к удаленному агенту из Visual Studio, нужно задать удаленную конфигурацию в параметрах Visual Studio.

### <a name="to-configure-the-remote-agent-from-visual-studio"></a>Настройка удаленного агента из Visual Studio

1. Если агент еще не запущен на компьютере Mac, выполните инструкции в разделе [Запуск удаленного агента](#Start). Чтобы среда Visual Studio могла успешно выполнить сопряжение, подключение и сборку проекта, на компьютере Mac должен быть запущен `vcremote`.

1. На компьютере Mac получите имя узла или IP-адрес компьютера Mac.

   IP-адрес можно получить с помощью команды **ifconfig** в окне "Терминал". Используйте адрес inet, указанный под активным сетевым интерфейсом.

1. В строке меню Visual Studio выберите **Сервис**, **Параметры**.

1. В диалоговом окне **Параметры** разверните узлы **Кроссплатформенный**, **C++** и **iOS**.

1. В полях **Имя узла** и **Порт** введите значения, полученные при запуске удаленного агента. Именем узла может быть DNS-имя или IP-адрес компьютера Mac. Порт по умолчанию — 3030.

   > [!NOTE]
   > Если не удается проверить связь с компьютером Mac, используя имя узла, возможно, потребуется использовать IP-адрес.

1. Если вы используете удаленный агент в режиме защищенного соединения по умолчанию, установите флажок **Безопасный** , а затем введите ПИН-код, предоставленный удаленным агентом, в поле **ПИН-код** . Если вы используете удаленный агент в небезопасном режиме, снимите флажок **Безопасный** и оставьте поле **ПИН-код** пустым.

1. Выберите **Связать**, чтобы активировать сопряжение.

   ![Настройка подключения "vcremote" для сборок iOS](../cross-platform/media/cppmdd-options-ios.png "Настройка подключения vcremote для сборок iOS")

   Сопряжение сохраняется до тех пор, пока не изменится имя узла или порт. Если вы изменили имя узла или порт в диалоговом окне **Параметры** , для отмены изменения нажмите кнопку **Восстановить** , чтобы восстановить прежнее сопряжение.

   Если выполнить сопряжение не удается, проверьте, запущен ли удаленный агент, выполнив инструкции в разделе [Start the remote agent](#Start). Если с момента создания ПИН-кода удаленным агентом прошло слишком много времени, выполните инструкции, приведенные в разделе [Generate a new security PIN](#GeneratePIN) , на компьютере Mac и повторите попытку. Если вы используете имя узла компьютера Mac, попробуйте вместо этого указать IP-адрес в поле **Имя узла** .

1. Обновите имя папки в поле **Удаленный корневой элемент**, указав папку, используемую удаленным агентом, в домашнем каталоге (*~*) на компьютере Mac. По умолчанию удаленный агент использует `/Users/<username>/vcremote` в качестве удаленного корневого элемента.

1. Чтобы сохранить параметры удаленного сопряжения, нажмите кнопку **ОК** .

При каждом использовании Visual Studio применяется одна и та же информация для подключения к удаленному агенту на компьютере Mac. Повторно сопрягать Visual Studio с удаленным агентом требуется только в том случае, если вы создали новый сертификат безопасности на компьютере Mac либо если изменилось его имя узла или IP-адрес.

## <a name="generate-a-new-security-pin"></a><a name="GeneratePIN"></a> Generate a new security PIN

При первоначальном запуске удаленного агента созданный ПИН-код действует в течение ограниченного времени (по умолчанию 10 минут). Если не выполнить сопряжение Visual Studio с удаленным агентом до истечения этого срока, потребуется создать новый ПИН-код.

### <a name="to-generate-a-new-pin"></a>Создание ПИН-кода

1. Остановите агент (или откройте второе окно приложения "Терминал" на компьютере Mac и используйте его для ввода команды).

1. В приложении "Терминал" введите следующую команду:

   `vcremote generateClientCert`

   Удаленный агент создаст новый временный ПИН-код. Для сопряжения Visual Studio с помощью нового ПИН-кода повторно выполните инструкции, приведенные в разделе [Настройка удаленного агента в Visual Studio](#ConfigureVS).

## <a name="generate-a-new-server-certificate"></a><a name="GenerateCert"></a> Создание нового сертификата сервера

В целях безопасности сертификаты серверов, которые сопрягают Visual Studio с удаленным агентом, привязаны к имени узла или IP-адресу компьютера Mac. Если эти значения меняются, вам потребуется создать новый сертификат сервера, а затем изменить конфигурацию Visual Studio, используя новые значения.

### <a name="to-generate-a-new-server-certificate"></a>Создание сертификата сервера

1. Остановите агент `vcremote`.

1. В приложении "Терминал" введите следующую команду:

   `vcremote resetServerCert`

1. При появлении запроса на подтверждение введите `Y`.

1. В приложении "Терминал" введите следующую команду:

   `vcremote generateClientCert`

   Эта команда создает новый временный ПИН-код.

1. Для сопряжения Visual Studio с помощью нового ПИН-кода повторно выполните инструкции, приведенные в разделе [Настройка удаленного агента в Visual Studio](#ConfigureVS).

## <a name="configure-the-remote-agent-on-the-mac"></a><a name="ConfigureMac"></a> Configure the remote agent on the Mac

Удаленный агент можно настроить, используя различные параметры командной строки. Например, можно задать порт для прослушивания запросов на построение и указать максимальное количество сборок, которые нужно поддерживать в файловой системе. По умолчанию это значение равно 10. Удаленный агент будет удалять сборки, которые выходят за максимальное число, при завершении работы.

### <a name="to-configure-the-remote-agent"></a>Настройка удаленного агента

- Чтобы просмотреть полный список команд удаленного агента, в приложении "Терминал" введите следующую команду:

   `vcremote --help`

- Чтобы отключить безопасный режим и включить обычные подключения на основе HTTP, введите следующую команду:

   `vcremote --secure false`

   В этом случае снимите флажок **Безопасный** и оставьте поле **ПИН-код** пустым при настройке агента в Visual Studio.

- Чтобы указать расположение для файлов удаленного агента, введите следующую команду:

   `vcremote --serverDir directory_path`

   Здесь *путь_к_каталогу* — это расположение на компьютере Mac, где будут храниться файлы журналов, сборки и сертификаты серверов. По умолчанию, это расположение `/Users/<username>/vcremote`. В этой папке сборки упорядочиваются по номеру сборки.

- Для использования фонового процесса с целью записи `stdout` и `stderr` в файл server.log введите следующую команду:

   `vcremote > server.log 2>&1 &`

   Файл server.log может помочь при устранении проблем со сборками.

- Для запуска агента с помощью файла конфигурации, а не параметров командной строки, введите следующую команду:

   `vcremote --config config_file_path`

   Здесь *путь_к_файлу_конфигурации* — это путь к файлу конфигурации в формате JSON. Параметры запуска и их значения не должны содержать дефисы.

## <a name="troubleshoot-the-remote-agent"></a>Устранение неполадок удаленного агента

### <a name="debugging-on-an-ios-device"></a>Отладка на устройстве с iOS

Если отладка на устройстве с iOS не работает, то могут возникнуть проблемы при использовании средства [ideviceinstaller](https://github.com/libimobiledevice/ideviceinstaller), которое используется для взаимодействия с устройством с iOS. Этот инструмент обычно устанавливается с Homebrew во время установки `vcremote`. Выполните следующие шаги в качестве обходного решения.

Откройте приложение "Терминал" и обновите `ideviceinstaller` и его зависимости, выполнив следующие команды по порядку:

1. Убедитесь, что Homebrew обновлен

   `brew update`

1. Удалите `libimobiledevice` и `usbmuxd`

   `brew uninstall --ignore-dependencies libimobiledevice`

   `brew uninstall --ignore-dependencies usbmuxd`

1. Установите последнюю версию `libimobiledevice` и `usbmuxd`

   `brew install --HEAD usbmuxd`

   `brew unlink usbmuxd`

   `brew link usbmuxd`

   `brew install --HEAD libimobiledevice`

1. Удалите и переустановите `ideviceinstaller`

   `brew uninstall ideviceinstaller`

   `brew install ideviceinstaller`

Убедитесь, что `ideviceinstaller` может взаимодействовать с устройством, перечислив приложения, установленные на устройстве:

`ideviceinstaller -l`

Если `ideviceinstaller` сообщает, что доступа к папке `/var/db/lockdown` нет, измените права папки:

`sudo chmod 777 /var/db/lockdown`

Затем еще раз проверьте, может ли `ideviceinstaller` взаимодействовать с устройством.

## <a name="see-also"></a>См. также раздел

- [Установка Visual C++ для разработки кроссплатформенных мобильных приложений на языке C++](../cross-platform/install-visual-cpp-for-cross-platform-mobile-development.md)
