---
title: Создание приложения OpenGL ES в Android и iOS
ms.date: 10/09/2019
ms.assetid: 76a67886-df57-4a81-accb-2e3c2eaf607b
ms.openlocfilehash: 278fd66202332417f7663542f0d66a3ec545b715
ms.sourcegitcommit: 9c2b3df9b837879cd17932ae9f61cdd142078260
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/29/2020
ms.locfileid: "92924302"
---
# <a name="build-an-opengl-es-application-on-android-and-ios"></a>Создание приложения OpenGL ES в Android и iOS

Вы можете создавать решения Visual Studio и проекты для приложений iOS и Android с общим кодом. В этой статье описывается комбинированный шаблон решения. Он создает приложение iOS и приложение Android Native Activity. Приложения имеют общий код C++, который использует технологию OpenGL ES для отображения одинакового анимированного вращающегося куба на обеих платформах. OpenGL ES (OpenGL для встраиваемых систем или ГЛЕС) — это API двухмерной и трехмерной графики. Он поддерживается на многих мобильных устройствах.

## <a name="requirements"></a>Требования

Соблюдайте все требования к системе для создания приложения OpenGL ES для iOS и Android. Установите рабочую нагрузку разработки мобильных приложений на языке C++ в Visual Studio Installer, если еще не сделали этого. Для получения шаблонов OpenGL ES, а также для создания приложения для iOS, включите дополнительные инструменты разработки C++ для iOS. Чтобы выполнить сборку для Android, установите средства разработки C++ для Android и необходимые сторонние инструменты: Android NDK, Apache Ant и Google Android Emulator.

Для повышения производительности эмулятора на платформах Intel один из вариантов — установить Intel Hardware Accelerated Execution Manager (HAXM). Подробные инструкции см. [в статье Установка кросс-платформенной разработки мобильных приложений на C++](../cross-platform/install-visual-cpp-for-cross-platform-mobile-development.md).

Для сборки и тестирования приложения iOS потребуется компьютер Mac. Настройте его в соответствии с инструкциями по установке. Дополнительные сведения о настройке компьютера для разработки приложений iOS см. в разделе [Установка и настройка средств для разработки с помощью iOS](../cross-platform/install-and-configure-tools-to-build-using-ios.md).

## <a name="create-a-new-opengles-application-project"></a>Создание проекта приложения OpenGLES

В этом учебнике вы сначала создадите проект приложения OpenGL ES, а затем соберете и запустите приложение по умолчанию в эмуляторе Android. Затем выполните сборку приложения для iOS и запустите его на устройстве iOS.

::: moniker range="msvc-150"

1. В Visual Studio выберите **Файл** > **Создать** > **Проект** .

1. В диалоговом окне **Новый проект** в разделе **Шаблоны** выберите **Visual C++,** > **Кроссплатформенный** , а затем выберите шаблон **Приложение OpenGLES (Android, iOS)** .

1. Присвойте приложению имя, например *MyOpenGLESApp* , а затем нажмите кнопку **ОК** .

   ![Новый проект "Приложение OpenGLES"](../cross-platform/media/cppmdd-opengles-newproj.png "Проект нового приложения OpenGLES")

   Visual Studio создаст новое решение и откроет обозреватель решений.

   ![MyOpenGLESApp в обозревателе решений](../cross-platform/media/cppmdd-opengles-solexpl.png "MyOpenGLESApp в обозревателе решений")

::: moniker-end

::: moniker range=">=msvc-160"

1. В Visual Studio выберите **Файл** > **Создать** > **Проект** .

1. В диалоговом окне **Создание нового проекта** выберите шаблон **Приложение OpenGLES (Android, iOS)** и нажмите кнопку **Далее** .

1. В диалоговом окне **Настройка нового проекта** введите имя в поле **Имя проекта** , например *MyOpenGLESApp* , и нажмите **Создать** .

   Visual Studio создаст новое решение и откроет обозреватель решений.

   ![MyOpenGLESApp в обозревателе решений](../cross-platform/media/cppmdd-opengles-solexpl.png "MyOpenGLESApp в обозревателе решений")

::: moniker-end

Новое решение приложения OpenGL ES включает в себя три проекта библиотек и два проекта приложений. Папка библиотеки содержит проект общего кода. И два проекта для конкретной платформы, которые ссылаются на общий код:

- `MyOpenGLESApp.Android.NativeActivity` содержит ссылки и связующий код, который реализует приложение в качестве Native Activity для Android. Точки входа из связующего кода реализованы в файле *main.cpp* , который включает общий код из `MyOpenGLESApp.Shared`. Предкомпилированные заголовки находятся в *PCH. h* . Этот проект приложения Native Activity компилируется в файл общей библиотеки (с расширением *.so* ), который передается в проект `MyOpenGLESApp.Android.Packaging`.

- `MyOpenGLESApp.iOS.StaticLibrary` создает файл статической библиотеки iOS (с расширением *.a* ), который содержит общий код из `MyOpenGLESApp.Shared`. Файл связан с приложением, созданным проектом `MyOpenGLESApp.iOS.Application`.

- `MyOpenGLESApp.Shared` содержит общий код, работающий на разных платформах. В нем используются макросы препроцессора для условной компиляции кода под конкретную платформу. Общий код передается по ссылке на проект в `MyOpenGLESApp.Android.NativeActivity` и `MyOpenGLESApp.iOS.StaticLibrary`.

Решение включает два проекта для создания приложений для платформ Android и iOS.

- `MyOpenGLESApp.Android.Packaging` создает файл с расширением *.apk* для развертывания на устройстве или в эмуляторе Android. Этот файл содержит ресурсы и файл AndroidManifest.xml, в котором задаются свойства манифеста. Он также содержит файл *build.xml* , который управляет процессом сборки Ant. По умолчанию он задан как начальный проект, который можно развернуть и запустить непосредственно из Visual Studio.

- `MyOpenGLESApp.iOS.Application` содержит ресурсы и код прилипания Objective-C для создания приложения iOS, которое ссылается на код статической библиотеки C++ в `MyOpenGLESApp.iOS.StaticLibrary`. Этот проект создает пакет сборки, который передается на компьютер Mac средой Visual Studio и удаленным агентом. При сборке этого проекта среда Visual Studio отправляет файлы и команды для сборки и развертывания приложения на компьютере Mac.

## <a name="build-and-run-the-android-app"></a>Сборка и запуск приложения Android

Решение, созданное с помощью шаблона, задает приложение Android в качестве проекта по умолчанию.  Вы можете выполнить сборку и запуск этого приложения, чтобы проверить его установку и настройку. Для первоначального теста запустите приложение в одном из профилей устройств, установленных эмулятором для Android. Если вы предпочитаете протестировать приложение на другом целевом объекте, можно загрузить целевой эмулятор. Или подключите устройство к компьютеру.

### <a name="to-build-and-run-the-android-native-activity-app"></a>Сборка и запуск приложения Android Native Activity

1. Выберите пункт **x86** в раскрывающемся списке **Платформы решения** , если он еще не выбран.

   ![Установка Платформы решения на x86](../cross-platform/media/cppmdd-opengles-solutionplat.png "Задать x86 в качестве платформы решения")

   Используйте 32-разрядную платформу (x86) в качестве целевой для эмулятора. Чтобы выполнить сборку для устройства, выберите платформу решения, соответствующую процессору устройства. Если список **Платформы решения** не отображается, щелкните пункт **Платформы решения** в списке **Добавить или удалить кнопки** и выберите свою платформу.

1. В **обозревателе решений** откройте контекстное меню для проекта `MyOpenGLESApp.Android.Packaging` и выберите пункт **Собрать** .

   ![Проект сборки упаковки Android](../cross-platform/media/cppmdd-opengles-andbuild.png "Проект сборки упаковки Android")

   В окне "Выходные данные" отображаются выходные данные процесса сборки для общей библиотеки Android и приложения Android.

   ![Выходные данные сборки для проектов Android](../cross-platform/media/cppmdd-opengles-andoutput.png "Выходные данные сборки для проектов Android")

1. Выберите один из профилей эмулируемого устройства Android в качестве цели развертывания.

   ![Выбор целевого объекта развертывания](../cross-platform/media/cppmdd-opengles-pickemulator.png "Выбор цели развертывания")

   Возможно, вы установили другие эмуляторы или подключили устройство Android. Их можно выбрать в раскрывающемся списке цель развертывания. Для запуска приложения платформа решения сборки должна совпадать с платформой целевого устройства.

1. Нажмите клавишу **F5** , чтобы начать отладку, или **клавишу** + **F5** , чтобы начать без отладки.

   Visual Studio запускает эмулятор, который за несколько секунд загружает и развертывает код. Так выглядит экран приложения в эмуляторе Android:

   ![Приложение, выполняющееся в эмуляторе Android](../cross-platform/media/cppmdd-opengles-andemulator.png "Приложение, работающее в эмуляторе Android")

   После запуска приложения можно задать точки останова и использовать отладчик для проверки кода, языковых стандартов и контрольных значений.

1. Нажмите клавиши **SHIFT** + **F5** , чтобы отключить отладку.

   Эмулятор является отдельным процессом, который продолжает выполняться. Вы можете изменять, компилировать и развертывать код несколько раз в одном эмуляторе. Ваше приложение находится в коллекции приложений эмулятора, откуда его можно запускать напрямую.

   Созданные проекты приложения и библиотеки для собственных действий Android помещают общий код C++ в динамическую библиотеку. Он включает в себя "связующий" код для взаимодействия с платформой Android. Большая часть кода приложения находится в библиотеке. Манифест, ресурсы и инструкции по сборке находятся в проекте упаковки. Общий код вызывается из main.cpp в проекте NativeActivity. Более подробную информацию о программировании Android Native Activity см. на странице [Concepts](https://developer.android.com/ndk/guides/concepts.html) (Основные понятия) в Android Developer NDK.

   Visual Studio создает проекты собственных действий Android с помощью пакета NDK для Android. В нем используется Clang в качестве набора инструментов платформы. Visual Studio сопоставляет свойства проекта с командами Compile, Link и Debug на целевой платформе. Чтобы получить подробные сведения, откройте диалоговое окно **Страницы свойств** для проекта MyOpenGLESApp.Android.NativeActivity. Более подробную информацию о параметрах командной строки см. в [руководстве пользователя компилятора Clang](https://clang.llvm.org/docs/UsersManual.html).

## <a name="build-and-run-the-ios-app-on-an-ios-device"></a>Сборка и запуск приложения для iOS на устройстве iOS

Вы создаете и редактируете проект приложения iOS в Visual Studio. Из-за ограничений лицензирования она должна быть построена и развернута с компьютера Mac. Visual Studio взаимодействует с удаленным агентом, запущенным на компьютере Mac, для передачи файлов проекта и выполнения команд сборки, развертывания и отладки. Перед сборкой приложения iOS настройте компьютер Mac и среду Visual Studio для обмена данными. Подробные инструкции см. в разделе [Установка и настройка средств для разработки с помощью iOS](../cross-platform/install-and-configure-tools-to-build-using-ios.md). Запустите удаленный агент на компьютере Mac и свяжите его с Visual Studio. Затем можно создать и запустить приложение iOS для проверки установки и установки.

Чтобы развернуть приложение на устройстве iOS, сначала настройте автоматическое подписывание в Xcode. При автоматическом подписывании создается профиль подготовки для подписания сборки приложения.

### <a name="to-set-up-automatic-signing-on-xcode"></a>Настройка автоматического подписывания в Xcode

1. Установите [Xcode](https://developer.apple.com/xcode/) на компьютер Mac, если его у вас еще нет.

1. Откройте приложение Xcode на компьютере Mac.

1. Создайте проект Xcode для **приложения с одним представлением** . При создании проекта заполните обязательные поля. Значения могут быть произвольными, так как проект используется только для создания профиля подготовки, с помощью которого в дальнейшем будет подписываться сборка приложения.

1. Добавьте свой идентификатор Apple ID, зарегистрированной в учетной записи [программы для разработчиков Apple](https://developer.apple.com/programs/), в Xcode. Ваш идентификатор Apple ID используется как удостоверение подписывания приложений. Чтобы добавить удостоверение подписывания в Xcode, откройте меню **Xcode** и выберите пункт **Preferences** (Настройки). Выберите **Accounts** (Учетные записи) и нажмите кнопку добавления (+), чтобы добавить свой идентификатор Apple ID. См. подробные инструкции в статье о [добавлении учетной записи Apple ID](https://help.apple.com/xcode/mac/current/#/devaf282080a).

1. В разделе общих параметров в проекте Xcode измените значение **идентификатора пакета** на `com.<NameOfVSProject>`, где `<NameOfVSProject>` — это имя созданного вами проекта решения Visual Studio. Например, если в Visual Studio вы создали проект с именем `MyOpenGLESApp`, установите для **идентификатора пакета** значение `com.MyOpenGLESApp`.

   ![Идентификатор пакета Xcode](../cross-platform/media/cppmdd-opengles-iosxcodeid.png "Идентификатор пакета Xcode")

1. Чтобы включить автоматическое подписывание, установите флажок Automatically manage signing (Автоматическое управление подписыванием)**.

   ![Автоматическое подписывание Xcode](../cross-platform/media/cppmdd-opengles-iosxcodesign.png "Автоматическое подписывание Xcode")

1. Выберите имя команды для идентификатора Apple ID, которое вы задали для **команды** разработки.

   ![Команда Xcode](../cross-platform/media/cppmdd-opengles-iosxcodeteam.png "Команда Xcode")

### <a name="to-build-and-run-the-ios-app-on-an-ios-device"></a>Сборка и запуск приложения для iOS на устройстве iOS

1. Запустите удаленный агент на компьютере Mac и проверьте, сопряжена ли среда Visual Studio с удаленным агентом. Чтобы запустить удаленный агент, откройте окно приложения "Терминал" и введите `vcremote`. Дополнительные сведения см. в разделе [Настройка удаленного агента в Visual Studio](../cross-platform/install-and-configure-tools-to-build-using-ios.md#ConfigureVS).

   ![Окно терминала Mac, в котором выполняется команда vcremote](../cross-platform/media/cppmdd-common-vcremote.png "Окно терминала Mac, в котором выполняется команда vcremote")

1. Подключите устройство iOS к компьютеру Mac. При первом подключении устройства к компьютеру поступает оповещение с вопросом, является ли компьютер доверенным для получения доступа к устройству. Укажите, что компьютер Mac является доверенным для устройства.

1. В Visual Studio в раскрывающемся списке **Платформы решения** выберите платформу решения, соответствующую процессору вашего устройства, если такая платформа еще не выбрана. В этом примере используется процессор **ARM64** .

   ![Установка ARM64 в качестве платформы решения](../cross-platform/media/cppmdd-opengles-pickplatformarm64.png "Установка ARM64 в качестве платформы решения")

1. В обозревателе решений откройте контекстное меню проекта MyOpenGLESApp.iOS.Application и выберите **Выгрузить проект** , чтобы выгрузить проект.

1. Снова откройте контекстное меню выгруженного проекта MyOpenGLESApp.iOS.Application и выберите **Edit project.pbxproj** (Изменить project.pbxproj), чтобы изменить файл проекта. В файле `project.pbxproj` найдите атрибут `buildSettings` и добавьте `DEVELOPMENT_TEAM`, используя свой идентификатор Apple Team ID. На следующем снимке экрана показан пример значения `123456ABC` для идентификатора Apple Team ID. Можно найти значение идентификатора Apple Team ID в Xcode. Перейдите к разделу **параметров сборки** и наведите указатель на имя группы разработки, чтобы отобразилась подсказка. В подсказке будет указан идентификатор команды.

   ![Установка команды развертывания](../cross-platform/media/cppmdd-opengles-iosdevelopmentteam.png "Установка команды развертывания")

1. Закройте файл `project.pbxproj`, откройте контекстное меню выгруженного проекта MyOpenGLESApp.iOS.Application и выберите **Перезагрузить проект** , чтобы перезагрузить проект.

1. Теперь выполните сборку проекта MyOpenGLESApp.iOS.Application. Для этого откройте его контекстное меню и выберите **Сборка** .

   ![Создание проекта приложения для iOS](../cross-platform/media/cppmdd-opengles-iosbuild.png "Проект сборки приложения iOS")

   В окне Вывод отображаются выходные данные процесса сборки. В нем отображаются результаты для статической библиотеки iOS и приложения iOS. На компьютере Mac в окне "Терминал", в котором выполняется удаленный агент, отображается команда и действие передачи файлов.

   Возможно, на компьютере Mac вам будет предложено разрешить средству подписывания кода доступ к цепочке ключей. Чтобы продолжить, нажмите **Разрешить** .

1. Выберите свое устройство iOS на панели инструментов, чтобы запустить приложение на устройстве, подключенном к компьютеру Mac. Если приложение не запускается, проверьте, предоставляет ли устройство развернутому приложению разрешение на запуск. Это разрешение можно задать, перейдя к **параметрам**  >  **Общее**  >  **Управление устройствами** на устройстве. Выберите учетную запись для разработки приложений, сделайте ее доверенной и проверьте приложение. Попытайтесь еще раз запустить приложение из Visual Studio.

   ![iOS-приложение на устройстве iOS](../cross-platform/media/cppmdd-opengles-iosdevice.png "iOS-приложение на устройстве iOS")

   После запуска приложения можно задать точки останова и использовать отладчик Visual Studio для проверки локальных значений, стека вызовов и контрольных значений.

   ![Отладчик в точке останова в приложении iOS](../cross-platform/media/cppmdd-opengles-iosdebug.png "Отладчик в точке останова в приложении iOS")

1. Нажмите клавиши **SHIFT** + **F5** , чтобы отключить отладку.

   Созданные проекты приложения и библиотеки iOS помещают код C++ в статическую библиотеку, которая реализует только общий код. Большая часть кода приложения находится в проекте `Application`. Вызовы кода общей библиотеки в этом проекте шаблона осуществляются в файле *GameViewController.m* . Для сборки приложения iOS среда Visual Studio использует набор средств платформы Xcode, которому требуется взаимодействовать с удаленным клиентом, запущенным на компьютере Mac.

   Visual Studio переносит файлы проекта на удаленный клиент. Затем он отправляет команды для сборки приложения с помощью Xcode. Удаленный клиент отправляет сведения о состоянии сборки обратно среде Visual Studio. После успешного построения приложения Visual Studio может отправить команды для выполнения и отладки приложения. Отладчик Visual Studio управляет работой приложения на устройстве iOS, подключенном к компьютеру Mac. Visual Studio сопоставляет свойства проекта с параметрами, используемыми для компиляции, компоновки и отладки на целевой платформе iOS. Чтобы получить подробную информацию о параметрах командной строки компилятора, откройте диалоговое окно **Страницы свойств** для проекта MyOpenGLESApp.iOS.StaticLibrary.

## <a name="customize-your-apps"></a>Настройка приложений

Вы можете изменить общий код C++, чтобы добавить или изменить общие функциональные возможности. Измените вызовы к общему коду в `MyOpenGLESApp.Android.NativeActivity` проектах и так, `MyOpenGLESApp.iOS.Application` чтобы они совпадали. Для указания разделов общего кода, предназначенных для конкретной платформы, можно использовать макросы препроцессора. При выполнении сборки для Android предварительно определен макрос препроцессора `__ANDROID__` . При выполнении сборки для iOS предварительно определен макрос препроцессора `__APPLE__` .

Чтобы просмотреть IntelliSense для определенной платформы проекта, выберите проект в раскрывающемся списке контекстного переключения. Он находится на панели навигации в верхней части окна редактора.

![Раскрывающийся список переключателя контекстов проекта в редакторе](../cross-platform/media/cppmdd-opengles-contextswitcher.png)

Проблемы, найденные IntelliSense в коде текущего проекта, подчеркиваются красной волнистой линией. В других проектах возникает ошибка фиолетовой волнистой линии. Visual Studio не поддерживает выделение кода цветом и технологию IntelliSense для файлов с кодом Java и Objective-C. Однако вы по-прежнему можете изменять исходные файлы и ресурсы. Используйте их для задания имени приложения, значка и других сведений о реализации.
