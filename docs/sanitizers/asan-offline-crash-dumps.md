---
title: Аддресссанитизер облачное или распределенное тестирование
description: Функция Аддресссанитизер, расширенная для Visual Studio и Azure
ms.date: 03/02/2021
helpviewer_keywords:
- AddressSanitizer cloud or distributed testing
ms.openlocfilehash: 53bbb1ca04a5c4636914591cf10bfcc6bf275d42
ms.sourcegitcommit: 6ed44d9c3fb32e965e363b9c69686739a90a2117
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/08/2021
ms.locfileid: "102471327"
---
# <a name="addresssanitizer-cloud-or-distributed-testing"></a>Аддресссанитизер облачное или распределенное тестирование

Вам не нужно отлаживать ошибки Аддресссанитизер, когда и где они происходят. Настройте среду выполнения для создания аварийного дампа, в котором хранится весь контекст Аддресссанитизер при возникновении ошибки. Затем отправьте этот аварийный дамп на другой компьютер для отладки. Автономная отладка может быть критической времени при запуске Аддресссанитизер в облаке или в распределенном тестировании. Вы можете создать дамп в тестовой или рабочей инфраструктуре, где происходит сбой, и позже отладить его на компьютере разработчика.

Отладчик Visual Studio обеспечивает точную диагностику ошибок Аддресссанитизер. Эти ошибки можно просмотреть без необходимости повторного запуска тестов, копирования огромных наборов данных, обнаружения потерянных или поиска тестовых компьютеров, переведенных в режим «вне сети». Достаточно загрузить аварийный дамп.

Аварийные дампы создаются при сбоях Аддресссанитизер, настроив следующую переменную среды:

`set ASAN_SAVE_DUMPS=MyFileName.dmp`

> [!NOTE]
> Имя файла должно иметь суффикс *`.dmp`* для соблюдения соглашений об именовании Visual Studio.

Этот [файл дампа](/previous-versions/windows/desktop/proc_snap/export-a-process-snapshot-to-a-file) можно отобразить с помощью Visual Studio позднее на другом компьютере.

Visual Studio может отображать сведения об ошибке в контексте исходного исходного кода. Для этого в Visual Studio требуются [отладочные символы](/windows/win32/dxtecharts/debugging-with-symbols) и [индексированный исходный код](/windows-hardware/drivers/debugger/source-indexing). Для оптимального процесса отладки EXE-и PDB-файлы и исходный код, используемые для создания этих двоичных файлов, должны совпадать.

Дополнительные сведения о хранении источников и символов см. в разделе [источники и символы](#source) . Дополнительные сведения о реализации и детализированном управлении см. в разделе [Интеграция отладчика](asan-debugger-integration.md).

## <a name="example---build-test-and-analyze"></a>Пример: сборка, тестирование и анализ

Рассмотрим три машины: A, B и C. сборки выполняются на компьютере б, тесты выполняются на компьютере C, и вы анализируете сбои на компьютере а. Ошибки передаются по исходным строкам и номерам столбцов в исходном коде. Стек вызовов можно увидеть вместе с набором символов в PDB-файле, созданном с помощью этой [точной версии исходного кода](#source).

Следующие шаги предназначены для локальных или распределенных сценариев, которые приводят к созданию DMP-файла, а также для просмотра этого файла дампа Аддресссанитизер в автономном режиме.

### <a name="produce-a-dmp-locally"></a>Создание. dmp на локальном компьютере

- Сборка
- Тестирование исполняемого файла
- Копирование созданного DMP-файла в каталог сборки
- Откройте DMP-файл с парным PDB-файлом в том же каталоге.

### <a name="produce-a-dmp-on-a-distributed-system"></a>Создание DMP в распределенной системе

- Сборка и [пост-обработка PDB](#source) для [исходных блоков данных индексации](/windows/win32/debug/source-server-and-source-indexing)
- Скопируйте атомарную пару (exe, PDB) на тестовую машину и запустите тесты.
- Запись атомарных пар (PDB, DMP) в базу данных отчетов об ошибках
- Visual Studio открывает DMP-файл с парным PDB-файлом в том же каталоге.

> [!NOTE]
> Компьютер Visual Studio 2019, используемый для анализа, должен иметь доступ к GitHub или внутренней папке, *`\\Machine\share`* где хранится индексированный источник.

## <a name="view-addresssanitizer-dmp-files"></a>Просмотр файлов Аддресссанитизер. dmp

1. Убедитесь, что интегрированная среда разработки отладчика может найти файлы PDB и sources.

1. Откройте Visual Studio и выберите **Продолжить без кода**. Затем выберите **файл**  >  **Открыть**  >  **файл** , чтобы открыть диалоговое окно открытия файла. Убедитесь, что используется суффикс имени файла **. dmp**.

   :::image type="content" source="./media/asan-open-crash-dump-file.png" alt-text="Снимок экрана: меню &quot;открыть файл&quot; в Visual Studio.":::

   На экране, показанном здесь, требуется еще один шаг для включения доступа к символам и источнику в интегрированной среде разработки.

1. Задайте пути к символам, а затем выберите **Отладка только машинный код**.

   :::image type="content" source="./media/asan-dump-file-open.png" alt-text="Снимок экрана с сводным представлением дампа в Visual Studio.":::

На этом снимке экрана показан последний загруженный файл дампа с загруженными источниками и метаданными Аддресссанитизер.

:::image type="content" source="./media/asan-view-crash-metadata.png" alt-text="Снимок экрана отладчика, отображающего исходные файлы и метаданные Аддресссанитизер.":::

## <a name="source-and-symbols"></a><a name="source"></a> Исходный код и символы

Сервер-источник позволяет клиенту получить **точную версию** исходных файлов, используемых для сборки приложения. Исходный код исполняемого файла или библиотеки DLL может меняться со временем и между версиями. Его можно использовать для просмотра того же исходного кода, в котором построена определенная версия приложения.

При отладке EXE-файла с его PDB-файлом отладчик может использовать внедренный блок данных исходного сервера для получения соответствующих файлов из системы управления версиями. Он загружает файлы, которые сопоставляются с полными именами, автоматически помещаются в PDB-файле **`/Zi`** параметром компилятора.

Чтобы использовать исходный сервер, приложение должно иметь значение "исходный индекс", используя *`pdbstr.exe`* для записи `srcsrv` блока данных в PDB-файл. Дополнительные сведения см. в разделе блок данных [исходного сервера и индексирования исходного кода](/windows/win32/debug/source-server-and-source-indexing). Вы найдете [инструкции по индексированию источников и публикации символов](/azure/devops/pipelines/tasks/build/index-sources-publish-symbols) , а [также о том, как указать символы и исходный код для отладчика](/visualstudio/debugger/specify-symbol-dot-pdb-and-source-files-in-the-visual-studio-debugger) .

Сведения о внешней документации см. в следующих статьях:

- [Индексирование исходного кода с помощью Git](https://gist.github.com/baldurk/c6feb31b0305125c6d1a)
- [Рекомендации по упрощению отладки](https://www.codeproject.com/articles/115125/source-indexing-and-symbol-servers-a-guide-to-easi)
- [Исходная индексация является неиспользуемой](https://randomascii.wordpress.com/2011/11/11/source-indexing-is-underused-awesomeness/)

## <a name="see-also"></a>См. также раздел

[Обзор Аддресссанитизер](./asan.md)\
[Известные проблемы Аддресссанитизер](./asan-known-issues.md)\
[Справочник по сборке и языку Аддресссанитизер](./asan-building.md)\
[Справочник по среде выполнения Аддресссанитизер](./asan-runtime.md)\
[Аддресссанитизер теневых байт](./asan-shadow-bytes.md)\
[Интеграция отладчика Аддресссанитизер](./asan-debugger-integration.md)\
[Примеры ошибок Аддресссанитизер](./asan-error-examples.md)
