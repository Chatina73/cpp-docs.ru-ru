---
title: Средства интегрированной среды разработки Visual Studio для обновления кода C++
description: Редактор кода C++ и средства анализа кода в Visual Studio позволяют модернизировать базу кода C++.
ms.date: 11/13/2019
ms.topic: conceptual
ms.openlocfilehash: d6368445d16232ff968b7116b0f0313e97aa144c
ms.sourcegitcommit: a1676bf6caae05ecd698f26ed80c08828722b237
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/29/2020
ms.locfileid: "91503759"
---
# <a name="visual-studio-ide-tools-for-upgrading-c-code"></a>Средства интегрированной среды разработки Visual Studio для обновления кода C++

Visual Studio помогает обновить устаревший код C++ с помощью параметров компилятора, предупреждений анализа кода и функций редактора, таких как быстрые исправления, краткие сведения и расширенная полоса прокрутки. Термин "устаревший код" относится к любой из следующих категорий:

- Код, который ранее был разрешен компилятором Microsoft C++ (КОМПИЛЯТОРОМ MSVC), но не соответствует стандарту C++.

   Чтобы обновить старый несогласованный код КОМПИЛЯТОРОМ MSVC, включите параметр компилятора [/permissive-](../build/reference/permissive-standards-conformance.md) . Все экземпляры несоответствующих использований подчеркиваются красной волнистой линией в редакторе кода. Сообщения об ошибках в окне **Список ошибок** содержат рекомендации по устранению ошибки. Щелкните код ошибки, чтобы открыть страницу справки в документации. Если устранить все ошибки одновременно нецелесообразно, можно обновить несогласованный код поэтапно, включив параметр " **разрешительное** ", исправив некоторые ошибки, а затем снова отключив параметр. Код будет скомпилирован с новыми улучшениями, и вы сможете вернуться и исправить оставшиеся проблемы позже. Примеры несоответствия кода КОМПИЛЯТОРОМ MSVC см. на странице [/permissive-](../build/reference/permissive-standards-conformance.md) .

- Код, который был разрешен в более ранней версии стандарта C++, но является устаревшим или удален в более поздней версии.

   Чтобы выполнить обновление до нового языкового стандарта, установите для параметра [Standard языка C++](../build/reference/std-specify-language-standard-version.md) нужный стандарт и исправьте все возникающие ошибки компиляции. Как правило, рекомендуется установить языковой стандарт [/std: c++ 17](../build/reference/std-specify-language-standard-version.md). Ошибки, возникающие при обновлении до более нового стандарта, не связаны с ошибками, возникшими при использовании **разрешающего** параметра.

- Код, который соответствует всем версиям Standard, но больше не считается рекомендуемым решением в современных C++.

   Чтобы найти код, в котором рекомендуются изменения, запустите [анализ кода](../code-quality/code-analysis-for-c-cpp-overview.md).

## <a name="open-and-convert-a-legacy-project"></a>Открытие и преобразование устаревшего проекта

Если устаревший проект основан на более старой версии Visual Studio, его можно открыть в Visual Studio 2017 или Visual Studio 2019. Visual Studio автоматически преобразует его в схему текущего проекта с поддержкой всех последних функций компилятора и интегрированной среды разработки.

![Обновление проекта](media/upgrade-dialog-v142.png "Обновление проекта")

Дополнительные сведения см. [в статье обновление проектов C++ из более ранних версий Visual Studio](upgrading-projects-from-earlier-versions-of-visual-cpp.md).

## <a name="search-the-code-base"></a>Поиск в базе кода

Обновление базы кода часто включает поиск в нескольких файлах. Чтобы выполнить поиск чего-либо в базе кода, нажмите клавиши **CTRL + T** , чтобы открыть поле "найти **все** ".

![Последовательно выберите все](media/go-to-all.png "Последовательно выберите все")

Чтобы ограничить область поиска, введите один из фильтров с 1 письмом, а затем пробелом и искомым объектом.

## <a name="error-list"></a>Список ошибок

После настройки требуемого стандарта языка C++ и других параметров компилятора (**Project**  >  **Properties**  >  **Общие**свойства проекта) нажмите клавиши **CTRL + SHIFT + B** , чтобы скомпилировать проект. Некоторые ошибки и предупреждения можно увидеть в виде красной волнистой линии в различных местах кода. Ошибки также появляются в **Список ошибок**. Чтобы получить дополнительные сведения о конкретной ошибке, щелкните код ошибки, чтобы открыть страницу справки в документации. Коды ошибок, начинающиеся с "C", являются ошибками компилятора. Коды, начинающиеся с «старшего», являются ошибками MSBuild, указывающими на проблему в конфигурации проекта.

![Ошибки компилятора и MSBuild в Список ошибок](media/compiler-error-list.png "Ошибки компилятора и MSBuild в Список ошибок")

## <a name="document-health-indicator"></a>Индикатор работоспособности документа

Индикатор работоспособности документа в нижней части редактора показывает количество ошибок и предупреждений в текущем документе, а также позволяет переходить непосредственно к следующему предупреждению или ошибке.

![Индикатор работоспособности документа](media/document-health-indicator.png "Индикатор работоспособности документа")

Во многих случаях можно найти дополнительные сведения об определенной ошибке в документации по журналу изменений Visual Studio и улучшения соответствия.

- [Улучшение соответствия C++](../overview/cpp-conformance-improvements.md)
- [Журнал изменений Visual C++ 2003-2015](visual-cpp-change-history-2003-2015.md)
- [Общие сведения о возможных проблемах, возникающих при обновлении](overview-of-potential-upgrade-issues-visual-cpp.md)

## <a name="use-code-analysis-to-modernize-your-code"></a>Использование анализа кода для модернизировать кода

При обновлении рекомендуется выполнить анализ кода проекта, чтобы код, который соответствует минимальным правилам, рекомендуемым для Microsoft Native. Эти правила представляют собой сочетание правил, определенных корпорацией Майкрософт, и подмножество [C++ Core Guidelines](https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines). В результате этого вы сможете значительно сократить или исключить распространенные источники ошибок. в то же время ваш код станет более удобочитаемым и, следовательно, проще в обслуживании. Анализ кода с использованием встроенных в Microsoft Native правил включен по умолчанию. Дополнительные правила можно включить в разделе **Project**  >  **Properties**  >  **анализ кода**свойств проекта. Код, который нарушает одно из правил, отмечается как предупреждение и подчеркивается зеленой волнистой линией в редакторе кода. Наведите указатель мыши на волнистую линию, чтобы увидеть подсказку **краткие сведения** , описывающую эту ошибку.

![Подсказка анализа кода](media/code-analysis-tooltip.png "Предупреждение анализа кода")

Щелкните значок фильтра в столбце **код** , чтобы выбрать отображаемые предупреждения.

![Фильтры анализа кода в Список ошибок](media/code-analysis-filter.png "Фильтры анализа кода в Список ошибок")

Ошибки и предупреждения анализа кода также появляются в **Список ошибок** подобно ошибкам компилятора.

![Предупреждения анализа кода в Список ошибок](media/code-analysis-error-list.png "Предупреждения анализа кода в Список ошибок")

Вы можете изменить правила, которые являются активными, и создать пользовательские наборы правил. Дополнительные сведения об анализе кода см. в разделе [анализ кода для C/C++ обзор](../code-quality/code-analysis-for-c-cpp-overview.md).

## <a name="use-quick-actions-to-modernize-code"></a>Использование быстрых действий для модернизировать кода

Редактор кода предоставляет быстрые действия для некоторых распространенных рекомендаций. Когда отображается значок лампочки, можно щелкнуть его, чтобы просмотреть доступные быстрые действия.

### <a name="convert-macros-to-constexpr-functions"></a>Преобразование макросов в функции constexpr

На следующем рисунке показано использование макроса с именем `AVERAGE` семантики по умолчанию. На изображении также показана подсказка краткие сведения, отображаемая при наведении на нее курсора мыши:

![Расширение макроса краткие сведения](media/macro-expansion-quick-info.png "Расширение макроса краткие сведения ToolTip")

Поскольку использование макросов не рекомендуется в современных C++, Visual Studio упрощает преобразование макросов в **`constexpr`** функции:

1. Щелкните правой кнопкой мыши `AVERAGE` и выберите команду **"переход к определению"**.
2. Щелкните значок отвертки и выберите команду **преобразовать макрос в constexpr** .

   ![Макрос быстрого действия к constexpr](media/quick-action-macro-to-constexpr.png "Макрос быстрого действия к constexpr")

Макрос преобразуется, как показано ниже:

![constexpr, функция](media/constexpr-function.png "constexpr, функция")

И вызов `AVERAGE` теперь выводится цветом как вызов функции, а подсказка показывает выведенный тип функции:

![вызов функции constexpr](media/constexpr-function-call.png "вызов функции constexpr")

### <a name="initialize-variables"></a>Инициализация переменных

Неинициализированные переменные могут содержать случайные значения, приводящие к серьезным ошибкам. Анализ кода помечает эти экземпляры, и редактор предоставляет быстрое действие:

![Инициализация переменной](media/init-variable.png "Быстрое действие инициализации переменной")

### <a name="convert-to-raw-string-literal"></a>Преобразование в необработанный строковый литерал

Необработанные строковые литералы менее подвержены ошибкам и удобны для ввода, чем строки с внедренными escape-символами. Щелкните строку правой кнопкой мыши и выберите **быстрые действия** , чтобы преобразовать ее в литерал необработанной строки.

![Литерал необработанной строки](media/raw-string-literal.png "Литерал необработанной строки")

Строка преобразуется в: `R"(C:\Users\bjarnes\demo\output.txt)"` .
