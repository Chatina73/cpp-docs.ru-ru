---
description: Дополнительные сведения о переносе в универсальная платформа Windows (C++)
title: Перенос в универсальную платформу Windows (C++)
ms.date: 10/23/2019
ms.assetid: f662d2e4-8940-418d-8109-cb76cb8f8569
ms.openlocfilehash: e5bc8dfdfb44fa59e860a571b119914309e5a660
ms.sourcegitcommit: d6af41e42699628c3e2e6063ec7b03931a49a098
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2020
ms.locfileid: "97331222"
---
# <a name="porting-to-the-universal-windows-platform-c"></a>Перенос в универсальную платформу Windows (C++)

В этом разделе приводятся сведения о переносе существующего кода C++ на платформу приложений Windows 10, которая называется универсальной платформой Windows. Термин *универсальность* означает, что код может работать на любом устройстве под управлением Windows 10. Вы создаете один проект и один пользовательский интерфейс на XAML, который нормально работает на любом устройстве с ОС Windows 10. Чтобы пользовательский интерфейс приложения мог адаптироваться к дисплеям разного размера, можно использовать средства динамического макета в XAML.

В состав документации центра разработчиков Windows входит руководство по переносу приложений Windows 8.1 в универсальную платформу Windows. См. раздел [Перенос приложения из среды выполнения Windows 8 в UWP](/windows/uwp/porting/w8x-to-uwp-root). Хотя в этом руководстве основное внимание уделено коду на C#, большинство рекомендаций и инструкций применимо и к C++. Следующие процедуры содержат более подробные сведения. См. также [Перемещение от классического приложения к UWP](/windows/uwp/porting/desktop-to-uwp-migrate).

В этом разделе рассматриваются следующие процедуры переноса кода в UWP.

- [Перенос приложения из Магазина Windows 8.1 в UWP](#BK_81StoreApp)

- [Перенос компонента среды выполнения Windows 8.1 на UWP](#BK_81Component)

То же самое можно сделать при наличии классической DLL-библиотеки Win32, которую требуется вызывать из приложения UWP. С помощью таких процедур можно создать уровень пользовательского интерфейса UWP для существующего классического приложения Windows на языке C++ или кроссплатформенного стандартного кода C++. См. [Практическое руководство. Использование существующего кода C++ в приложении универсальной платформы Windows](../porting/how-to-use-existing-cpp-code-in-a-universal-windows-platform-app.md).

## <a name="porting-a-windows-81-store-app-to-the-uwp"></a><a name="BK_81StoreApp"></a> Перенос приложения для Магазина Windows 8.1 на UWP

Если у вас есть приложение для магазина Windows 8.1, эту процедуру можно использовать для того, чтобы оно могло работать на UWP и любом устройстве с ОС Windows 10.  Рекомендуется сначала построить проект с помощью Visual Studio 2019 в качестве Windows 8.1 проекта, чтобы сначала устранить все проблемы, возникающие в результате изменений в компиляторе и библиотеках. После этого можно воспользоваться одним из двух способов преобразования проекта в проект UWP для Windows 10. Самый простой способ (как поясняется в следующей процедуре) — создание универсального проекта Windows и копирование в него существующего кода. Если вы использовали универсальный проект для классического приложения Windows 8.1 и Windows Phone 8.1, то проект будет запускаться с двумя разными макетами в XAML. Однако на выходе вы получите один динамический макет, адаптирующийся под размер экрана.

### <a name="to-port-a-windows-81-store-app-to-the-uwp"></a>Перенос приложения для магазина Windows 8.1 на UWP

1. Если вы еще не осуществили перенос, откройте свой проект приложения Windows 8.1 в Visual Studio 2017 и выполните процедуру обновления файла проекта.

   Необходимо установить **средства Windows 8.1 в Visual Studio**. Если эти средства не установлены, запустите программу установки **Visual Studio** в окне " **программы и компоненты** ", выберите **Visual Studio 2017**, а затем в окне программы установки выберите **изменить**. Выберите **средства Windows 8.1**, убедитесь, что оно выбрано, и нажмите кнопку **ОК**.

1. Откройте окно **Свойства проекта** и в области **C++** > **Общие** установите для **набора инструментов платформы** значение **v141,** указывающее набор инструментов для Visual Studio 2017.

1. Постройте проект как проект Windows 8.1, а затем исправьте все ошибки сборки. Как правило, на этом этапе ошибки связаны с критическими изменениями в средствах сборки и библиотеках. Подробное описание изменений, которые могут повлиять на код, см. в статье [Журнал изменений Visual C++ 2003–2015](../porting/visual-cpp-change-history-2003-2015.md).

   После того, как проект будет построен без ошибок, можно приступить к переносу на универсальную платформу Windows (Windows 10).

1. Создайте новый проект универсального приложения Windows с помощью пустого шаблона. Ему можно присвоить имя, совпадающее с именем существующего проекта. Но в этом случае проекты должны находиться в разных каталогах.

1. Закройте решение, а затем с помощью **проводника Windows** или командной строки скопируйте файлы кода (с расширениями. cpp,. h и. XAML) из проекта Windows 8.1 в ту же папку, что и файл проекта (VCXPROJ) для проекта, созданного на шаге 1. Не копируйте файл Package.appxmanifest. Если у вас есть отдельный код для Windows 8.1 Desktop и Windows 8.1 Phone, выберите один из них для переноса в первую очередь (позже вам придется выполнить ряд действий, чтобы подготовить перенос другого кода). Не забудьте скопировать все вложенные папки и их содержимое. При появлении соответствующего запроса выберите вариант замены всех файлов с одинаковыми именами.

1. Повторно откройте решение и выберите пункт **Добавить**  >  **существующий элемент** в контекстном меню узла проекта. Выберите все файлы, которые были скопированы, за исключением файлов, которые уже являются частью проекта.

   Проверьте все вложенные папки и убедитесь, что в них также добавлены файлы.

1. Если вы используете имя проекта, которое отличается от имени старого проекта, откройте файл Package.appxmanifest и обновите **точку входа** в соответствии с именем пространства имен для класса `App`.

   Поле **Точка входа** в файле Package.appxmanifest содержит имя области для класса `App`, содержащего пространство имен, которое содержит класс `App`. При создании универсального проекта Windows для пространства имен указывается имя проекта. Если оно отличается от имени, указанного в файлах, скопированных из старого проекта, обновите одно из них, чтобы они соответствовали друг другу.

1. Постройте проект и устраните все ошибки сборки из-за критических изменений между различными версиями пакета Windows SDK.

1. Запустите проект на локальном компьютере. Убедитесь, что отсутствуют ошибки развертывания, что макет приложения имеет приемлемый формат и что он корректно работает на настольном компьютере.

1. Если у вас есть отдельные файлы кода .xaml для другого устройства, например, для Windows Phone 8.1, проанализируйте этот код и найдите в нем отличия от кода для стандартного устройства. Если разница размещается только в макете, вы можете использовать **Диспетчер визуальных состояний** в XAML для настройки отображения в зависимости от размера экрана. Если имеются другие различия, можно использовать разделы условий в коде с помощью следующих операторов #if.

    ```cpp
    #if WINAPI_FAMILY_PARTITION(WINAPI_PARTITION_PC_APP)
    #if WINAPI_FAMILY_PARTITION(WINAPI_PARTITION_PHONE_APP)
    #if WINAPI_FAMILY_PARTITION(WINAPI_PARTITION_APP)
    #if WINAPI_FAMILY_PARTITION(WINAPI_PARTITION_DESKTOP)
    ```

   Эти операторы могут применяться соответственно к приложениям UWP, приложениям Магазина Windows Phone, к обоим видам приложений или ни к одному из них (то есть, только к классическим приложениям Win32). Эти макросы доступны только в пакете SDK Windows 8.1 и более поздних версиях. Поэтому если код должен компилироваться в более ранних версиях пакета SDK Windows или для других платформ, помимо Windows, необходимо учитывать ситуацию, в которой не определена ни одна их этих возможностей.

1. Запустите приложение и выполните его отладку в эмуляторе или физическом устройстве для каждого типа устройств, поддерживаемого приложением. Чтобы запустить эмулятор, Visual Studio необходимо запустить на физическом компьютере, а не на виртуальной машине.

## <a name="porting-a-windows-81-runtime-component-to-the-uwp"></a><a name="BK_81Component"></a> Перенос компонента среды выполнения Windows 8.1 в UWP

Если у вас есть библиотека DLL или компонент среды выполнения Windows, которые уже работают с приложениями для магазина Windows 8.1, эту процедуру можно использовать для обеспечения работы компонента или библиотеки DLL с платформой UWP и Windows 10. Процедура в целом заключается в создании нового проекта и копировании в него кода.

### <a name="to-port-a-windows-81-runtime-component-to-the-uwp"></a>Перенос компонента среды выполнения Windows 8.1 в UWP

1. В диалоговом окне **Новый проект** в Visual Studio 2017 найдите узел **Универсальное приложение для Windows** . Если вы не видите этот узел, сначала установите [пакет SDK для Windows 10](https://developer.microsoft.com/windows/downloads/windows-10-sdk). Выберите шаблон **компонента среды выполнения Windows** , присвойте компоненту имя и нажмите кнопку **ОК** . Имя компонента будет использоваться в качестве имени пространства имен, поэтому вы можете использовать имя пространства имен старого проекта. Для этого потребуется создать проект в папке, которая отличается от папки старого проекта. Если выбрать другое имя, можно обновить имя пространства имен в созданных файлах кода.

1. Закройте проект.

1. Скопируйте все файлы кода (CPP, H, XAML и т. д.) из компонента Windows 8.1 в только что созданный проект. Не копируйте файл Package.appxmanifest.

1. Выполните сборку и устраните все ошибки, возникающие из-за критических изменений между разными версиями пакета SDK Windows.

## <a name="troubleshooting"></a>Устранение неполадок

В процессе портирования кода на платформу UWP могут возникать различные ошибки. Могут возникать следующие проблемы.

### <a name="project-configuration-issues"></a>Проблемы с конфигурацией проекта

Может появиться такое сообщение об ошибке.

```Output
could not find assembly 'platform.winmd': please specify the assembly search path using /AI or by setting the LIBPATH environment variable
```

Это означает, что проект не построен как универсальный проект Windows. Проверьте файл проекта и убедитесь, что он содержит правильные элементы XML, которые определяют проект как универсальный проект Windows. Должны присутствовать следующие элементы (номер версии целевой платформы может отличаться).

```xml
<AppContainerApplication>true</AppContainerApplication>
<ApplicationType>Windows Store</ApplicationType>
<WindowsTargetPlatformVersion>10.0.10156.0</WindowsTargetPlatformVersion>
<WindowsTargetPlatformMinVersion>10.0.10156.0</WindowsTargetPlatformMinVersion>
<ApplicationTypeRevision>10.0</ApplicationTypeRevision>
```

Если вы создали новый проект UWP в Visual Studio, эта ошибка не появится.

## <a name="see-also"></a>См. также раздел

[Visual C++: руководство по переносу](../porting/porting-to-the-universal-windows-platform-cpp.md)<br/>
[Разработка приложений для универсальной платформы Windows (UWP)](/visualstudio/cross-platform/develop-apps-for-the-universal-windows-platform-uwp)
