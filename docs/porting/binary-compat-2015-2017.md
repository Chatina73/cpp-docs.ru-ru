---
title: Совместимость на уровне двоичного кода C++ 2015–2019
description: Описывает, как работает двоичная совместимость между скомпилированными файлами C++ в Visual Studio 2015, 2017 и 2019. Один Microsoft Visual C++ распространяемый пакет работает для всех трех версий.
ms.date: 02/17/2021
helpviewer_keywords:
- binary compatibility, Visual C++
ms.openlocfilehash: a91e339e70843087adc12238edac91332c1a4453
ms.sourcegitcommit: c0c9cdae79f19655e809a4979227c51bb19cff63
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/05/2021
ms.locfileid: "102236580"
---
# <a name="c-binary-compatibility-between-visual-studio-2015-2017-and-2019"></a>Двоичная совместимость C++ между Visual Studio 2015, 2017 и 2019

Наборы инструментов компилятора Microsoft C++ (КОМПИЛЯТОРОМ MSVC) в Visual Studio 2013 и более ранних версиях не гарантируют двоичную совместимость по основным версиям. Нельзя связывать объектные файлы, статические библиотеки, динамические библиотеки и исполняемые объекты, созданные разными версиями этих наборов инструментов. ABI, форматы объектов и библиотеки времени выполнения несовместимы.

Мы изменили это поведение в Visual Studio 2015, 2017 и 2019. Библиотеки среды выполнения и приложения, компилируемые любой из этих версий компилятора, совместимы с двоичными. Он отражается в основном номере набора инструментов C++, который начинается с 14 для всех трех версий. (Версия набора инструментов — V140 для Visual Studio 2015, v141 для 2017 и v142 для 2019). Предположим, у вас есть сторонние библиотеки, созданные Visual Studio 2015. Их все еще можно использовать в приложении, созданном с помощью Visual Studio 2017 или 2019. Нет необходимости выполнять повторную компиляцию с соответствующим набором инструментов. Последняя версия распространяемого пакета Microsoft Visual C++ (распространяемый пакет) работает для всех из них.

## <a name="restrictions-on-binary-compatibility"></a><a name="restrictions"></a> Ограничения на двоичную совместимость

Существуют три важных ограничения на двоичную совместимость между наборами инструментов V140, v141 и v142 и дополнительными номерами версий.

- Вы можете смешивать двоичные файлы, созданные различными версиями наборов инструментов V140, v141 и v142. Тем не менее, необходимо создать связь с помощью набора инструментов по крайней мере с последним двоичным файлом в приложении. Вот пример: можно связать приложение, скомпилированное с помощью любого набора инструментов 2017 (v141, версии от 15,0 до 15,9), в статическую библиотеку, скомпилированную с помощью, скажем, Visual Studio 2019 версии 16,2 (v142), если они связаны с помощью набора инструментов версии 16,2 или более поздней. Библиотеку версии 16,2 можно связать с приложением версии 16,4, если вы используете набор инструментов 16,4 или более поздней версии.

- Распространяемое приложение использует аналогичное ограничение двоичной совместимости. При смешении двоичных файлов, созданных различными поддерживаемыми версиями набора инструментов, распространяемая версия должна быть по крайней мере новым набором инструментов, используемых любым компонентом приложения.

- Статические библиотеки или объектные файлы, скомпилированные с помощью переключателя компилятора [ `/GL` (оптимизация всей программы)](../build/reference/gl-whole-program-optimization.md) или связанного с использованием [ `/LTCG` (создание кода во время компоновки)](../build/reference/ltcg-link-time-code-generation.md) , *не* поддерживают двоичную совместимость в разных версиях, включая обновления дополнительных версий. Все объектные файлы и библиотеки, скомпилированные с помощью **`/GL`** и, **`/LTCG`** должны использовать точно такой же набор инструментов для компиляции и последней ссылки. Например, код, созданный с помощью **`/GL`** в наборе инструментов Visual studio 2019 версии 16,7, не может быть связан с кодом, созданным с помощью **`/GL`** набора инструментов visual Studio 2019 версии 16,8. Компилятор выдает [неустранимую ошибку C1047](../error-messages/compiler-errors-1/fatal-error-c1047.md).

## <a name="upgrade-the-microsoft-visual-c-redistributable-from-visual-studio-2015-or-2017-to-visual-studio-2019"></a>Обновление Microsoft Visual C++ распространяемого пакета с Visual Studio 2015 или 2017 до Visual Studio 2019

Для Visual Studio 2015, 2017 и 2019 мы сохранили основной номер версии распространяемого Microsoft Visual C++. Это означает, что одновременно можно установить только один экземпляр распространяемого компонента. Более новая версия перезаписывает любую старую версию, которая уже установлена. Например, одно приложение может установить распространяемый пакет из Visual Studio 2015. Затем другое приложение устанавливает распространяемый пакет из Visual Studio 2019. Версия 2019 перезаписывает старую версию, но, поскольку они совместимы с двоичными, приложение по-прежнему работает нормально. Убедитесь, что последняя версия распространяемого пакета содержит все новейшие функции, обновления для системы безопасности и исправления ошибок. Поэтому мы всегда рекомендуем выполнить обновление до последней доступной версии.

Аналогичным образом, нельзя установить более старый распространяемый компонент, если уже установлена более новая версия. Установщик сообщает об ошибке при попытке. Если установить распространяемый пакет 2015 или 2017 на компьютере, на котором уже установлена версия 2019, вы увидите следующее сообщение об ошибке:

```Output
0x80070666 - Another version of this product is already installed. Installation of this version cannot continue. To configure or remove the existing version of this product, use Add/Remove Programs on the Control Panel.
```

Эта ошибка возникает при проектировании. Рекомендуется установить последнюю версию. Убедитесь, что установщик может автоматически восстановиться после этой ошибки.

## <a name="see-also"></a>См. также раздел

[Журнал изменений Visual C++](../porting/visual-cpp-change-history-2003-2015.md)\
[Последние поддерживаемые Visual C++ распространяемых загружаемых файлов](https://support.microsoft.com/help/2977003/the-latest-supported-visual-c-downloads)
