---
title: Обновление кода для универсальной среды выполнения | Документы Майкрософт
ms.custom: ''
ms.date: 03/31/2017
ms.topic: conceptual
ms.assetid: eaf34c1b-da98-4058-a059-a10db693a5ce
author: corob-msft
ms.author: corob
ms.workload:
- cplusplus
ms.openlocfilehash: 8f384810ba689953274c3b585bbee7a345b948de
ms.sourcegitcommit: a9dcbcc85b4c28eed280d8e451c494a00d8c4c25
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/25/2018
ms.locfileid: "50058977"
---
# <a name="upgrade-your-code-to-the-universal-crt"></a>Обновление кода для универсальной среды выполнения

В Visual Studio 2015 был выполнен рефакторинг библиотеки времени выполнения Майкрософт C (CRT). Расширения стандартной библиотеки C, POSIX и характерные для Майкрософт функции были перемещены в новую библиотеку — библиотеку универсальной среды C (универсальной CRT или UCRT). Компоненты компилятора были перемещены в новую библиотеку vcruntime.

UCRT теперь является компонентом Windows и поставляется в составе Windows 10. UCRT поддерживает стабильные соглашения о вызовах ABI на основе C и более точно соответствует стандарту ISO C99 с несколькими исключениями. UCRT больше не привязана к конкретной версии компилятора. UCRT можно использовать в любой версии Windows, поддерживаемой Visual Studio 2015 или Visual Studio 2017. Преимущество в том, что больше не требуется обновлять сборки для соответствия новой версии CRT при каждом обновлении Visual Studio.

После такого рефакторинга изменились имена или расположения многих файлов заголовков CRT, файлов библиотек и распространяемых компонентов, а также методы развертывания, необходимые для кода. Кроме того, в UCRT были добавлены или изменены многие функции и макросы в целях улучшения соответствия стандартам. Чтобы эффективно использовать эти изменения, необходимо обновить существующий код и системы сборки проекта.

## <a name="where-to-find-the-universal-crt-files"></a>Где найти файлы универсальной среды выполнения

Так как UCRT является компонентом Windows, файлы и заголовки библиотеки UCRT теперь входят в состав пакета SDK Windows. При установке Visual Studio также устанавливаются компоненты пакета SDK Windows, необходимые для использования UCRT. Установщик Visual Studio добавляет расположения файлов заголовков и библиотек и DLL-файлов в пути по умолчанию, используемые в системе сборки проектов Visual Studio. При обновлении проекты Visual C++ используют параметры по умолчанию, интегрированная среда разработки автоматически обнаружит новые расположения для файлов заголовков, а компоновщик автоматически будет использовать новые заданные по умолчанию библиотеки UCRT и vcruntime. Аналогичным образом при использовании командной строки разработчика для построений из командной строки переменные среды, содержащие пути для заголовков и библиотек, будут автоматически обновлены и готовы к работе.

Теперь файлы заголовков стандартной библиотеки C находятся в пакете SDK Windows SDK в папке include в каталоге версии пакета SDK. Обычно файлы заголовков находятся в каталоге Program Files или Program Files (x86) в кWindows Kits\\10\\Include\\_sdk-version_\\ucrt, где _sdk-version_ — это версия Windows или обновления, например, 10.0.14393.0 для обновления Windows 10 Anniversary Update.

Статические библиотеки UCRT и библиотеки заглушки динамической компоновки находятся в каталоге Program Files или Program Files (x86) в папке Windows Kits\\10\\Lib\\_sdk-version_\\ucrt\\_architecture_, где _architecture_ — это ARM, x86 или x64. Статические библиотеки отладочных и розничных версий — это libucrt.lib и libucrtd.lib, а библиотеки для DLL UCRT — ucrt.lib и ucrtd.lib.

Отладочные и розничные версии библиотек DLL среды UCRT находятся в разных местах. Розничные версии библиотек DLL являются распространяемыми и находятся в каталоге Program Files или Program Files (x86) в папке Windows Kits\\10\\Redist\\ucrt\\DLLs\\_architecture_\.. Отладочные версии библиотек UCRT не являются распространяемыми и находятся в каталоге Program Files или Program Files (x86) в папке Windows Kits\\10\\bin\\_architecture_\\ucrt.

Библиотека поддержки времени выполнения для компилятора C и C++, **vcruntime**, содержит код, необходимый для поддержки запуска программы и функций, таких как обработка исключений и встроенные функции. Библиотеки и ее файлы заголовков по-прежнему находятся в папке конкретной версии Microsoft Visual Studio в каталоге Program Files или Program Files (x86). В Visual Studio 2017 заголовки находятся в папке Microsoft Visual Studio\\2017\\_edition_\\VC\\Tools\\MSVC\\_lib-version_\\include, а библиотеки компоновки находятся в папке Microsoft Visual Studio\\2017\\_edition_\\VC\\Tools\\MSVC\\_lib-version_\\lib\\_architecture_, где _edition_ — это выпуск установленной среды Visual Studio, _lib-version_ — версии библиотек и _architecture_ — архитектура процессора. Библиотеки компоновки для OneCore и Магазина также находятся в папке библиотек. Версия выпуска и отладочная версия статической библиотеки — это libvcruntime.lib и libvcruntimed.lib. Версия выпуска библиотеки динамической компоновки и отладочная версия библиотеки заглушки — это vcruntime.lib и vcruntimed.lib, соответственно.

Если при обновлении проектов Visual C++ вы установили для свойства **Игнорировать все стандартные библиотеки** **компоновщика** в проекте значение **Да** или используете параметр компоновщика `/NODEFAULTLIB` в командной строке, необходимо обновить список библиотек, чтобы включить в него новые подвергнутые рефакторингу библиотеки. Замените старую библиотеку CRT, например libcmt.lib, libcmtd.lib, msvcrt.lib, msvcrtd.lib, эквивалентными подвергнутыми рефакторингу библиотеками. Сведения о конкретных библиотеках см. в разделе [Особенности библиотеки CRT](../c-runtime-library/crt-library-features.md).

## <a name="deployment-and-redistribution-of-the-universal-crt"></a>Развертывание и распространение универсальной среды выполнения

Поскольку UCRT теперь является компонентом операционной системы Microsoft Windows, она входит в состав операционной системы Windows 10 и доступна через Центр обновления Windows для старых операционных систем от Windows Vista до Windows 8.1. Распространяемая версия доступна для Windows XP. Как компонент операционной системы управление обновлениями и обслуживанием UCRT осуществляется с помощью Центра обновления Windows независимо от версий Visual Studio и компилятора Microsoft C++. Поскольку UCRT является компонентом Windows, в связи с небольшим размером образа и в целях обеспечения безопасности и простоты применения обновлений настоятельно рекомендуется выполнять централизованное развертывание UCRT для приложений.

UCRT можно использовать в любой версии Windows, поддерживаемой Visual Studio 2015 или Visual Studio 2017. Ее можно распространять с помощью пакета vcredist для поддерживаемых версий Windows (кроме Windows 10). Пакеты vcredist включают в себя компоненты UCRT и автоматически устанавливают их в операционных системах Windows, где они не установлены по умолчанию. Дополнительные сведения см. в разделе [Распространение файлов Visual C++](../ide/redistributing-visual-cpp-files.md).

Поддерживается развертывание локальных приложений UCRT, хотя этот вариант является нерекомендуемым по соображениям безопасности и производительности. Библиотеки DLL для развертывания локальных приложений входят в состав пакета SDK Windows и находятся в подкаталоге **redist**. Требуемые библиотеки DLL содержат ucrtbase.dll и набор библиотек DLL **переадресации APISet** с именем api-ms-win-_subset_.dll. Для каждой операционной системы требуется разный набор библиотек DLL, поэтому при развертывании локальных приложений рекомендуется включать все библиотеки DLL. Дополнительные сведения и советы об использовании развертываний локальных приложений см. в разделе [Развертывание в Visual C++](../ide/deployment-in-visual-cpp.md).

## <a name="changes-to-the-universal-crt-functions-and-macros"></a>Изменения функций и макросов универсальной среды выполнения

Многие функции были добавлены или обновлены в UCRT для повышения соответствия стандарту ISO C99, а также для устранения проблем, связанных с качеством и безопасностью кода. В некоторых случаях требовалось внести критические изменения в библиотеку. Если код компилируется правильно при использовании более ранней версии CRT, но прерывается при компиляции с использованием UCRT, необходимо изменить код, чтобы воспользоваться преимуществами этих обновлений и функций. Подробный список критических изменений и обновлений для универсальной среды выполнения в разделе [Библиотека времени выполнения C (CRT)](visual-cpp-change-history-2003-2015.md#BK_CRT) в журнале изменений Visual C++. В него входит перечень затронутых заголовков и функции, который можно использовать для определения изменений, необходимых для кода.

## <a name="see-also"></a>См. также

[Руководство по переносу и обновлению Visual C++](visual-cpp-porting-and-upgrading-guide.md)<br/>
[Общие сведения о возможных проблемах, возникающих при обновлении (Visual C++)](overview-of-potential-upgrade-issues-visual-cpp.md)<br/>
[Обновление проектов, созданных в предыдущих версиях Visual C++](upgrading-projects-from-earlier-versions-of-visual-cpp.md)<br/>
[Журнал изменений Visual C++ 2003–2015](visual-cpp-change-history-2003-2015.md)<br/>
[Улучшения соответствия C++ в Visual Studio 2017](../cpp-conformance-improvements-2017.md)