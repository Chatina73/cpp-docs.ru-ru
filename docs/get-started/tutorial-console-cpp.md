---
title: Создание консольного приложения "Калькулятор" на C++
description: Создание консольного приложения Hello World и калькулятора в Visual C++
ms.custom: mvc
ms.date: 08/19/2019
ms.topic: tutorial
ms.devlang: cpp
ms.assetid: 45138d70-719d-42dc-90d7-1d0ca31a2f54
ms.openlocfilehash: 14e1e18da5cdabae5366d4ba97a2260d5e99f076
ms.sourcegitcommit: c1fd917a8c06c6504f66f66315ff352d0c046700
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2020
ms.locfileid: "90685325"
---
# <a name="create-a-console-calculator-in-c"></a>Создание консольного приложения "Калькулятор" на C++

::: moniker range=">=vs-2019"

Обычной отправной точкой для программиста на C++ является приложение "Hello World", выполняемое в командной строке. Вот что вы создадите в Visual Studio в этой статье, и затем мы перейдем к более сложной задаче: приложению калькулятора.

## <a name="prerequisites"></a>Предварительные требования

- Установите и запустите на своем компьютере Visual Studio с рабочей нагрузкой **Разработка классических приложений на C++** . Если установка еще не выполнена, см. статью [Установка поддержки C++ в Visual Studio](../build/vscpp-step-0-installation.md).

## <a name="create-your-app-project"></a>Создание проекта приложения

Visual Studio использует *проекты*, чтобы упорядочить код для приложения, и *решения*, чтобы упорядочить проекты. Проект содержит все параметры, конфигурации и правила, используемые для сборки приложения. Кроме того, он управляет связью между всеми файлами проекта и любыми внешними файлами. Чтобы создать приложение, сначала создайте проект и решение.

1. Если вы только запустили Visual Studio, вы увидите диалоговое окно Visual Studio 2019. Выберите **Создать проект**, чтобы приступить к работе.

   ![Исходное диалоговое окно Visual Studio 2019](./media/calc-vs2019-initial-dialog.png "Исходное диалоговое окно Visual Studio 2019")

   Или в строке меню Visual Studio последовательно выберите **Файл** > **Создать** > **Проект**. Откроется окно **Создание проекта**.

1. В списке шаблонов проектов выберите **Консольное приложение** и нажмите **Далее**.

   ![Выбор шаблона консольного приложения](./media/calc-vs2019-choose-console-app.png "Выбор шаблона консольного приложения")

   > [!Important]
   > Убедитесь, что вы выбрали версию C++ для шаблона **Консольное приложение**. Этот шаблон содержит теги **C++** , **Windows** и **Консоль**, а в углу значка есть "++".

1. В диалоговом окне **Настроить новый проект** выберите поле ввода **Имя проекта**, назовите новый проект *CalculatorTutorial* и нажмите **Создать**.

   ![Присвоение имени проекта в диалоговом окне "Настроить новый проект"](./media/calc-vs2019-name-your-project.png "Присвоение имени проекта в диалоговом окне "Настроить новый проект"")

   Будет создано пустое консольное приложение Windows на C++. Консольные приложения используют окно консоли Windows для отображения выходных данных и приема данных, вводимых пользователем. В Visual Studio откроется окно редактора с созданным кодом.

    ```cpp
    // CalculatorTutorial.cpp : This file contains the 'main' function. Program execution begins and ends there.
    //

    #include <iostream>

    int main()
    {
        std::cout << "Hello World!\n";
    }

    // Run program: Ctrl + F5 or Debug > Start Without Debugging menu
    // Debug program: F5 or Debug > Start Debugging menu

    // Tips for Getting Started:
    //   1. Use the Solution Explorer window to add/manage files
    //   2. Use the Team Explorer window to connect to source control
    //   3. Use the Output window to see build output and other messages
    //   4. Use the Error List window to view errors
    //   5. Go to Project > Add New Item to create new code files, or Project > Add Existing Item to add existing code files to the project
    //   6. In the future, to open this project again, go to File > Open > Project and select the .sln file
    ```

## <a name="verify-that-your-new-app-builds-and-runs"></a>Проверка сборки и выполнения нового приложения

Шаблон для нового консольного приложения Windows создает простое приложение Hello World на C++. На этом этапе вы можете видеть, как Visual Studio создает и запускает созданные вами приложения прямо из интегрированной среды разработки.

1. Для сборки проекта выберите в меню **Сборка** пункт **Собрать решение**. Окно **Вывод** отображает результаты процесса сборки.

   ![Снимок экрана: Visual Studio 2019 с окном выходных данных, в котором отображается результат процесса сборки.](./media/calc-vs2019-build-your-project.png "Построение проекта")

1. Чтобы запустить этот код, в строке меню выберите **Отладка** и **Запуск без отладки**.

   ![Снимок экрана: консоль отладки Microsoft Visual Studio в Visual Studio 2019 с отображением успешного выполнения кода.](./media/calc-vs2019-hello-world-console.png "Запуск проекта")

   Открывается окно консоли, и запускается ваше приложение. При запуске консольного приложения в Visual Studio система выполняет код, а затем выводит сообщение "Нажмите любую клавишу, чтобы закрыть это окно. . .", чтобы вы могли просмотреть выходные данные. Поздравляем! Вы создали свое первое консольное приложение "Hello World" в Visual Studio!

1. Нажмите любую клавишу, чтобы закрыть окно консоли и вернуться в редактор Visual Studio.

Теперь у вас есть средства для сборки и запуска приложения после каждого изменения, чтобы убедиться, что код по-прежнему работает должным образом. Позже мы покажем, как выполнить его отладку при неправильной работе.

## <a name="edit-the-code"></a>Изменение кода

Теперь давайте превратим код в этом шаблоне в приложение калькулятора.

1. В файле *CalculatorTutorial.cpp* измените код таким образом, чтобы он соответствовал этому примеру:

    ```cpp
    // CalculatorTutorial.cpp : This file contains the 'main' function. Program execution begins and ends there.
    //

    #include <iostream>

    using namespace std;

    int main()
    {
        cout << "Calculator Console Application" << endl << endl;
        cout << "Please enter the operation to perform. Format: a+b | a-b | a*b | a/b"
            << endl;
        return 0;
    }

    // Run program: Ctrl + F5 or Debug > Start Without Debugging menu
    // Debug program: F5 or Debug > Start Debugging menu
    // Tips for Getting Started:
    //   1. Use the Solution Explorer window to add/manage files
    //   2. Use the Team Explorer window to connect to source control
    //   3. Use the Output window to see build output and other messages
    //   4. Use the Error List window to view errors
    //   5. Go to Project > Add New Item to create new code files, or Project > Add Existing Item to add existing code files to the project
    //   6. In the future, to open this project again, go to File > Open > Project and select the .sln file
    ```

   > Пояснения к коду:
   >
   > - Операторы `#include` позволяют ссылаться на код, расположенный в других файлах. Иногда вы можете увидеть имя файла, заключенное в угловые скобки ( **\<\>** ), а в других случаях — в кавычки ( **" "** ). В общем случае угловые скобки используются при ссылке на стандартную библиотеку C++, а кавычки — для других файлов.
   > - Строка `using namespace std;` сообщает компилятору ожидать данные от стандартной библиотеки C++ для использования в этом файле. Без нее каждое ключевое слово из этой библиотеки пришлось бы предварять элементом `std::`, чтобы обозначить его область. Например, без этой строки каждую ссылку на `cout` потребовалось бы записывать в виде `std::cout`. Оператор **`using`** добавляется, чтобы сделать код более понятным.
   > - Ключевое слово `cout` используется для вывода сведений в стандартный поток вывода в C++. Оператор **\<\<** указывает компилятору отправить все содержимое справа от него в стандартный поток вывода.
   > - Ключевое слово **endl** аналогично клавише ВВОД — оно завершает строку и переводит курсор на следующую строку. Для выполнения той же задачи рекомендуется помещать `\n` внутрь строки (заключенной в ""), так как `endl` всегда освобождает буфер и может негативно повлиять на производительность программы, но из-за того, что это очень небольшое приложение, в нем используется `endl` для улучшения удобочитаемости.
   > - Все операторы C++ должны заканчиваться точкой с запятой, а все приложения C++ — содержать функцию `main()`. Именно ее программа выполняет при запуске. Для использования весь код должен быть доступен из `main()`.

1. Чтобы сохранить файл, нажмите клавиши **CTRL+S** или выберите элемент **Сохранить** в верхней части интегрированной среды разработки, выглядящий как значок гибкого диска на панели инструментов в строке меню.

1. Чтобы запустить приложение, нажмите клавиши **CTRL+F5** или перейдите в меню **Отладка** и выберите **Запуск без отладки**. Должно отобразится окно консоли с текстом, указанным в коде.

1. По завершении закройте окно консоли.

## <a name="add-code-to-do-some-math"></a>Добавление кода для выполнения математических операций

Пора добавить математическую логику.

### <a name="to-add-a-calculator-class"></a>Добавление класса Calculator

1. В меню **Проект** выберите команду **Добавить класс**. В поле ввода **Имя класса** введите *Calculator*. Нажмите кнопку **ОК**. В проект будут добавлены два новых файла. Чтобы сохранить сразу все измененные файлы, нажмите клавиши **CTRL+SHIFT+S**. Это сочетание клавиш для команды **Файл** > **Сохранить все**. Кроме того, есть кнопка **Сохранить все** на панели инструментов. Она имеет вид значка с двумя дискетами рядом с кнопкой **Сохранить**. В общем случае рекомендуется регулярно нажимать кнопку **Сохранить все**, чтобы не пропустить никакие файлы при сохранении.

   ![Снимок экрана: диалоговое окно "Добавление класса" с введенной надписью "Calculator" в текстовом поле "Имя класса".](./media/calc-vs2019-create-calculator-class.png "Создание класса Calculator")

   Класс подобен схеме для объекта, который выполняет какие-либо действия. В этом случае мы определяем калькулятор и особенности его работы. Использованный ранее мастер **Добавить класс** создал файлы H и CPP, имя которых совпадает с именем класса. Вы можете просмотреть полный список файлов проекта в окне **обозревателя решений**, отображаемом в боковой части окна IDE. Если окно не отображается, его можно открыть из строки меню, выбрав **Вид** > **Обозреватель решений**.

   ![Снимок экрана: окно обозревателя решений в Visual Studio 2019, в котором отображается проект Calculator Tutorial.](./media/calc-vs2019-solution-explorer.png "обозреватель решений")

   Теперь у вас в редакторе должно быть открыто три вкладки: *CalculatorTutorial.cpp*, *Calculator.h* и *Calculator.cpp*. Если вы случайно закроете одну из них, то можете повторно открыть эту вкладку, дважды щелкнув ее в окне **обозревателя решений**.

1. На вкладке **Calculator.h** удалите созданные строки `Calculator();` и `~Calculator();`, так как здесь они вам не понадобятся. Затем добавьте следующую строку кода, чтобы файл выглядел следующим образом:

    ```cpp
    #pragma once
    class Calculator
    {
    public:
        double Calculate(double x, char oper, double y);
    };
    ```

   > Пояснения к коду
   >
   > - Добавленная строка объявляет новую функцию `Calculate`, которую мы используем для выполнения математических операций, таких как сложение, вычитание, умножение и деление.
   > - Код C++ упорядочен по файлам *заголовка* (H) и *исходным* файлам (CPP). Различные компиляторы поддерживают несколько других расширений имени файла, но это основные, о которых вам нужно знать. Функции и переменные обычно *объявляются*, то есть получают имя и тип, в файлах заголовка, и *реализуются*, то есть получают определение, в исходных файлах. Чтобы обратиться к коду, определенному в другом файле, вы можете использовать `#include "filename.h"`, где "filename.h" — это имя файла, объявляющего переменные или функции, которые требуется использовать.
   > - Две удаленные строки объявляли *конструктор* и *деструктор* для класса. Для такого простого класса компилятор создает их автоматически, а их использование выходит за рамки данного руководства.
   > - Рекомендуется упорядочивать код по различным файлам в зависимости от его назначения, чтобы позднее было проще найти нужный код. В данном случае мы определяем класс `Calculator` отдельно от файла, содержащего функцию `main()`, но планируем ссылаться на класс `Calculator` в `main()`.

1. Под `Calculate` появится зеленая волнистая линия. Это вызвано тем, что мы еще не определили функцию `Calculate` в CPP-файле. Наведите указатель на это слово, щелкните по появившейся лампочке (в данном случае отвертке) и выберите **Создать определение "Calculate" в Calculator.cpp**.

   ![Снимок экрана: Visual Studio 2019 с выделенным параметром "Создать определение Calculate в Calculator.cpp".](./media/calc-vs2019-create-definition.png "Создание определения для Calculate")

   Отображается всплывающее окно, сообщающее об изменении кода, внесенном в другом файле. Код был добавлен в *Calculator.cpp*.

   ![Всплывающее окно с определением Calculate](./media/calc-vs2019-pop-up-definition.png "Всплывающее окно с определением Calculate")

   Сейчас он возвращает просто 0.0. Давайте изменим это. Нажмите клавишу **ESC**, чтобы закрыть всплывающее окно.

1. Переключитесь на файл *Calculator.cpp* в окне редактора. Удалите разделы `Calculator()` и `~Calculator()` (как сделали в H-файле) и добавьте в `Calculate()` следующий код:

    ```cpp
    #include "Calculator.h"

    double Calculator::Calculate(double x, char oper, double y)
    {
        switch(oper)
        {
            case '+':
                return x + y;
            case '-':
                return x - y;
            case '*':
                return x * y;
            case '/':
                return x / y;
            default:
                return 0.0;
        }
    }
    ```

   > Пояснения к коду
   >
   > - Функция `Calculate` использует число, оператор и второе число, а затем выполняет запрошенную операцию над этими числами.
   > - Оператор switch проверяет, какой оператор был предоставлен, и выполняет только вариант (case), соответствующий этой операции. Вариант default: является резервным на тот случай, если пользователь вводит неприемлемый оператор, чтобы программа не прервала работу. В общем случае лучше обрабатывать некорректный ввод данных пользователем более элегантным способом, но это выходит за рамки данного руководства.
   > - Ключевое слово **`double`** обозначает тип числа, который поддерживает десятичные числа. Таким образом, калькулятор может выполнять математические операции с десятичными и целыми числами. Функция `Calculate` должна всегда возвращать такое число из-за типа **`double`** в самом начале кода (обозначает возвращаемый тип функции), поэтому даже в случае по умолчанию возвращается значение 0,0.
   > - H-файл объявляет функцию *prototype*, которая заранее сообщает компилятору, какой параметр требуется и какой тип возвращаемого значения следует ожидать. CPP-файл содержит все сведения о реализации этой функции.

Если построить и запустить код еще раз на этом этапе, он по-прежнему завершит работу после запроса операции для выполнения. Далее вам нужно изменить функцию `main` для выполнения вычислений.

### <a name="to-call-the-calculator-class-member-functions"></a>Вызов функций-членов класса Calculator

1. Теперь давайте изменим функцию `main` в *CalculatorTutorial.cpp*:

    ```cpp
    // CalculatorTutorial.cpp : This file contains the 'main' function. Program execution begins and ends there.
    //

    #include <iostream>
    #include "Calculator.h"

    using namespace std;

    int main()
    {
        double x = 0.0;
        double y = 0.0;
        double result = 0.0;
        char oper = '+';

        cout << "Calculator Console Application" << endl << endl;
        cout << "Please enter the operation to perform. Format: a+b | a-b | a*b | a/b"
             << endl;

        Calculator c;
        while (true)
        {
            cin >> x >> oper >> y;
            result = c.Calculate(x, oper, y);
            cout << "Result is: " << result << endl;
        }

        return 0;
    }
    ```

   > Пояснения к коду
   >
   > - Так как программы C++ всегда запускаются с функции `main()`, нам нужно вызвать из нее другой, для чего нужен оператор `#include`.
   > - Объявлены начальные переменные `x`, `y`, `oper` и `result` для хранения, соответственно, первого числа, второго числа, оператора и окончательного результата. Рекомендуется всегда присваивать им некоторые начальные значения, чтобы избежать неопределенного поведения. Это мы здесь и делаем.
   > - Строка `Calculator c;` объявляет объект "c" в качестве экземпляра класса `Calculator`. Сам класс является лишь схемой для описания работы калькуляторов, а объект — это конкретный калькулятор, который выполняет вычисления.
   > - Оператор `while (true)` является циклом. Код внутри этого цикла продолжает выполняться снова и снова, пока выполняется условие в `()`. Так как условие просто указано как **`true`** , оно всегда выполняется, поэтому цикл выполняется бесконечно. Чтобы закрыть программу, пользователю нужно вручную закрыть окно консоли. В противном случае программа будет постоянно ожидать новые входные данные.
   > - Ключевое слово `cin` используется для получения входных данных от пользователя. Этот входной поток способен обработать строку текста, введенного в окне консоли, и поместить ее внутрь каждой из перечисленных переменных в указанном порядке, при условии, что введенные пользователем данные соответствуют требуемой спецификации. Вы можете изменить эту строку, чтобы принять другие типы входных данных, например, больше двух чисел, однако для этого также потребуется изменить функцию `Calculate()`.
   > - Выражение `c.Calculate(x, oper, y);` вызывает определенную ранее функцию `Calculate` и предоставляет введенные входные значения. Затем она возвращает число, сохраняемое в `result`.
   > - Наконец, в консоль выводится `result`, благодаря чему пользователь видит результат вычисления.

### <a name="build-and-test-the-code-again"></a>Повторная сборка и проверка кода

Пришло время снова протестировать программу еще раз, чтобы убедиться в ее правильной работе.

1. Нажмите клавиши **CTRL+F5**, чтобы перестроить и запустить приложение.

1. Введите `5 + 5` и нажмите клавишу **ВВОД**. Убедитесь, что выводится результат 10.

   ![Снимок экрана: консоль отладки Microsoft Visual Studio в Visual Studio 2019 с отображением правильного результата вычисления "5+5".](./media/calc-vs2019-five-plus-five.png "Результат сложения 5 + 5")

## <a name="debug-the-app"></a>Отладка приложения

Так как пользователь может ввести в окне консоли что угодно, нужно убедиться, что калькулятор обрабатывает некоторые входные данные правильно. Вместо запуска программы давайте выполним ее отладку, чтобы можно было проверить ее выполнение шаг за шагом.

### <a name="to-run-the-app-in-the-debugger"></a>Запуск приложения в отладчике

1. Установите точку останова на строке `result = c.Calculate(x, oper, y);`, сразу после запроса входных данных у пользователя. Чтобы задать точку останова, щелкните рядом со строкой серую вертикальную панель, идущую вдоль левой части окна редактора. Появится красная точка.

   ![Снимок экрана: Visual Studio 2019 с отображением красной точки, представляющей точку останова.](./media/calc-vs2019-set-breakpoint.png "Установка точки останова")

   Теперь при отладке программа всегда приостанавливает выполнение на этой строке. Мы уже имеем примерное представление о том, что в простых случаях программа работает. Так как нам не нужно приостанавливать выполнение при каждом запуске, создадим условную точку останова.

1. Щелкните правой кнопкой мыши красную точку, обозначающую точку останова, и выберите команду **Условия**. В поле ввода для условия введите `(y == 0) && (oper == '/')`. По завершении операции нажмите кнопку **Закрыть**. Условия сохранятся автоматически.

   ![Снимок экрана: Visual Studio 2019 с отображением раздела "Параметры точки останова" и условия, добавленного к значению Is true.](./media/calc-vs2019-conditional-breakpoint.png "Установка условной точки останова")

   Теперь выполнение приостанавливается в точке останова, в частности при попытке деления на 0.

1. Чтобы отладить программу, нажмите клавишу **F5** или выберите **Локальный отладчик Windows** — кнопку панели инструментов со значком зеленой стрелки. Если ввести в консольном приложении нечто вроде "5 - 0", программа работает как обычно и продолжает выполнение. Но если ввести "10 / 0", она приостанавливает выполнение в точке останова. Вы можете ввести любое число пробелов между оператором и числами; функция `cin` достаточно интеллектуальна для того, чтобы правильно проанализировать входные данные.

   ![Снимок экрана: Visual Studios 2019 с отображением приостановки программы в условной точке останова.](./media/calc-vs2019-debug-breakpoint.png "Приостановка на условной точке останова")

### <a name="useful-windows-in-the-debugger"></a>Полезные окна в отладчике

Каждый раз при отладке кода вы можете заметить, что появляется несколько новых окон. Они могут оказаться полезными в процессе отладки. Давайте рассмотрим окно **Видимые**. Окно **Видимые** содержит текущие значения переменных, используемых по меньшей мере за три строки перед текущей строкой. Чтобы просмотреть все переменные из этой функции, переключитесь в окно **Локальные**. Вы можете изменять значения этих переменных во время отладки, чтобы оценить их влияние на программу. В данном случае мы оставим их без изменений.

   ![Снимок экрана: окно "Локальные" в Visual Studio 2019.](./media/calc-vs2019-debug-locals.png "Окно Локальные")

Кроме того, вы можете просто навести указатель на переменные в самом коде, чтобы просмотреть их текущие значения на участке, где приостановлено выполнение. Сначала щелкните окно редактора, чтобы сделать его активным.

   ![Снимок экрана: Visual Studio 2019 с отображением подсказки, включающей значение переменной.](./media/calc-vs2019-hover-tooltip.png "Наведите указатель мыши, чтобы просмотреть текущие значения переменных")

### <a name="to-continue-debugging"></a>Продолжение отладки

1. Желтая линия слева показывает текущую точку выполнения. Текущая строка вызывает `Calculate`, поэтому нажмите клавишу **F11**, чтобы выполнить **Шаг с заходом** для этой функции. Вы переходите в тело функции `Calculate`. Обдуманно применяйте функцию **Шаг с заходом**, чтобы не терять время из-за чрезмерного ее использования. С помощью функции анализируется любой код, используемый в текущей строке, включая стандартные функции библиотеки.

1. Теперь, когда точка выполнения находится в начале функции `Calculate`, нажмите клавишу **F10** для перехода на следующую строку в рамках выполнения программы. При нажатии клавиши **F10** активируется функция **Шаг с обходом**. **Шаг с обходом** можно использовать для перемещения по строкам, не вдаваясь в подробности того, что происходит в каждой части строки. В общем случае следует использовать **Шаг с обходом**, а не **Шаг с заходом**, если только вы не хотите подробно изучить код, вызываемый из другого расположения (как в случае с переходом к телу функции `Calculate`).

1. Продолжайте использовать клавишу **F10**, чтобы выполнять **Шаг с обходом** для каждой строки, пока не вернетесь к функции `main()` в другом файле, и остановитесь на строке `cout`.

   Похоже, программа работает правильно — принимает первое число и делит его на второе. В строке `cout` наведите указатель мыши на переменную `result` или взгляните на `result` в окне **Видимые**. Соответствующее значение отображается как inf. Это неправильное поведение, и нужно его скорректировать. В строке `cout` просто выводится любое значение, хранящееся в `result`. Поэтому при продвижении еще на один шаг с помощью клавиши **F10** в окне консоли отображается следующее:

   ![Снимок экрана: консоль отладки Microsoft Visual Studio в Visual Studio 2019 с отображением результата деления на ноль.](./media/calc-vs2019-divide-by-zero-fail.png "Результат деления на ноль")

   Причина такого результата в том, что деление на ноль является неопределенным, поэтому у программы нет числового ответа на запрошенную операцию.

### <a name="to-fix-the-divide-by-zero-error"></a>Исправление ошибки деления на ноль

Давайте обеспечим корректную обработку деления на ноль, чтобы пользователь мог осознать проблему.

1. Внесите следующие изменения в *CalculatorTutorial.cpp*. (Прерывать выполнение программы при редактировании не требуется благодаря функции отладчика **Изменить и продолжить**):

    ```cpp
    // CalculatorTutorial.cpp : This file contains the 'main' function. Program execution begins and ends there.
    //

    #include <iostream>
    #include "Calculator.h"

    using namespace std;

    int main()
    {
        double x = 0.0;
        double y = 0.0;
        double result = 0.0;
        char oper = '+';

        cout << "Calculator Console Application" << endl << endl;
        cout << "Please enter the operation to perform. Format: a+b | a-b | a*b | a/b" << endl;

        Calculator c;
        while (true)
        {
            cin  >> x  >> oper  >> y;
            if (oper == '/' && y == 0)
            {
                cout << "Division by 0 exception" << endl;
                continue;
            }
            else
            {
                result = c.Calculate(x, oper, y);
            }
            cout << "Result is: " << result << endl;
        }

        return 0;
    }
    ```

1. Теперь нажмите клавишу **F5** один раз. При этом выполнение программы продолжается вплоть до приостановки для запроса данных, вводимых пользователем. Снова введите `10 / 0`. Теперь выводится более информативное сообщение. У пользователя запрашиваются дополнительные входные данные, и программа продолжает выполнение в обычном режиме.

   ![Снимок экрана: консоль отладки Microsoft Visual Studio в Visual Studio 2019 с отображением окончательного результата после изменений.](./media/calc-vs2019-final-verification.png "Окончательный результат после внесения изменений")

   > [!Note]
   > При редактировании кода в режиме отладки существует риск того, что код устареет. Это происходит, когда отладчик продолжает выполнять старый код, не учитывающий внесенные вами изменения. В подобной ситуации отладчик выводит диалоговое окно с соответствующим сообщением. В некоторых случаях может потребоваться нажать клавишу **F5**, чтобы обновить выполняемый код. В частности, если вы вносите изменения внутри функции, когда точка выполнения находится внутри этой же функции, вам потребуется выполнить шаг с выходом из функции, а затем вернуться в нее, чтобы получить обновленный код. Если по какой-либо причине это не работает и вы видите сообщение об ошибке, можно остановить отладку, щелкнув красный квадрат на панели инструментов под меню в верхней части интегрированной среды разработки, а затем перезапустить отладку, нажав клавишу **F5** или выбрав зеленую стрелку "воспроизведения" рядом с кнопкой остановки на панели инструментов.

   > Пояснения по сочетаниям клавиш для выполнения и отладки
   >
   > - Клавиша **F5** (или команда **Отладка** > **Запустить отладку**) запускает сеанс отладки, если он еще не активен, и выполняет программу до тех пор, пока не будет встречена точка останова либо программе не потребуются вводимые пользователем данные. Если вводимые пользователем данные не требуются и точка останова отсутствует, программа завершает работу, а окно консоли автоматически закрывается после завершения выполнения программы. Если вы выполняете программу уровня "Hello World", используйте сочетание клавиш **CTRL+F5** или задайте точку останова перед нажатием клавиши **F5**, чтобы окно оставалось открытым.
   > - Сочетание клавиш **CTRL+F5** (или команда **Отладка** > **Запуск без отладки**) запускает приложение без перехода в режим отладки. Это немного быстрее отладки, а окно консоли остается открытым после завершения выполнения программы.
   > - Клавиша **F10** (соответствующая возможности **Шаг с обходом**) позволяет выполнять построчную итерацию по коду, а также визуализировать выполнение кода и значения переменных на каждом шаге выполнения.
   > - Клавиша **F11** (соответствующая возможности **Шаг с заходом**) работает аналогично возможности **Шаг с обходом**, за исключением того, что заходит в любые функции, вызываемые в строке выполнения. Например, если в выполняемой строке вызывается функция, при нажатии клавиши **F11** указатель перемещается в тело функции, чтобы вы могли проследить выполнение кода функции, прежде чем вернуться на исходную строку. При нажатии клавиши **F10** выполняется шаг с обходом по вызову функции и простой переход на следующую строку. Вызов функции все равно выполняется, но программа не приостанавливается, чтобы показать вам, что именно она делает.

### <a name="close-the-app"></a>Закрытие приложения

- Если оно все еще выполняется, закройте окно консоли для приложения калькулятора.

## <a name="the-finished-app"></a>Готовое приложение

Поздравляем! Вы завершили написание кода для приложения калькулятора, а также выполнили его сборку и отладку в Visual Studio.

## <a name="next-steps"></a>Следующие шаги

[Дополнительные сведения о Visual Studio для C++](https://devblogs.microsoft.com/cppblog/getting-started-with-visual-studio-for-c-and-cpp-development/)

::: moniker-end

::: moniker range="<vs-2019"

Обычной отправной точкой для программиста на C++ является приложение "Hello World", выполняемое в командной строке. Вот что вы создадите в Visual Studio в этой статье, и затем мы перейдем к более сложной задаче: приложению калькулятора.

## <a name="prerequisites"></a>Предварительные требования

- Установите и запустите на своем компьютере Visual Studio с рабочей нагрузкой **Разработка классических приложений на C++** . Если установка еще не выполнена, см. статью [Установка поддержки C++ в Visual Studio](../build/vscpp-step-0-installation.md).

## <a name="create-your-app-project"></a>Создание проекта приложения

Visual Studio использует *проекты*, чтобы упорядочить код для приложения, и *решения*, чтобы упорядочить проекты. Проект содержит все параметры, конфигурации и правила, используемые для сборки приложения. Кроме того, он управляет связью между всеми файлами проекта и любыми внешними файлами. Чтобы создать приложение, сначала создайте проект и решение.

1. В строке меню Visual Studio последовательно выберите **Файл** > **Создать** > **Проект**. Открывается окно **Новый проект**.

2. На боковой панели слева выберите **Visual C++** . В центральной области выберите **Консольное приложение Windows**.

3. В поле ввода **Имя** внизу введите имя нового проекта *CalculatorTutorial*, а затем нажмите кнопку **ОК**.

   ![Диалоговое окно Новый проект](./media/calculator-new-project-dialog.png "Диалоговое окно Новый проект")

   Будет создано пустое консольное приложение Windows на C++. Консольные приложения используют окно консоли Windows для отображения выходных данных и приема данных, вводимых пользователем. В Visual Studio откроется окно редактора с созданным кодом.

    ```cpp
    // CalculatorTutorial.cpp : This file contains the 'main' function. Program execution begins and ends there.
    //

    #include "pch.h"
    #include <iostream>

    int main()
    {
        std::cout << "Hello World!\n";
    }

    // Run program: Ctrl + F5 or Debug > Start Without Debugging menu
    // Debug program: F5 or Debug > Start Debugging menu

    // Tips for Getting Started:
    //   1. Use the Solution Explorer window to add/manage files
    //   2. Use the Team Explorer window to connect to source control
    //   3. Use the Output window to see build output and other messages
    //   4. Use the Error List window to view errors
    //   5. Go to Project > Add New Item to create new code files, or Project > Add Existing Item to add existing code files to the project
    //   6. In the future, to open this project again, go to File > Open > Project and select the .sln file
    ```

## <a name="verify-that-your-new-app-builds-and-runs"></a>Проверка сборки и выполнения нового приложения

Шаблон для нового консольного приложения Windows создает простое приложение "Hello World" на C++. На этом этапе вы можете видеть, как Visual Studio создает и запускает созданные вами приложения прямо из интегрированной среды разработки.

1. Для сборки проекта выберите в меню **Сборка** пункт **Собрать решение**. Окно **Вывод** отображает результаты процесса сборки.

   ![Снимок экрана: Visual Studio с окном выходных данных, в котором отображается результат процесса сборки.](./media/calculator-initial-build-output.png "Построение проекта")

1. Чтобы запустить этот код, в строке меню выберите **Отладка** и **Запуск без отладки**.

   ![Снимок экрана: консоль отладки Microsoft Visual Studio с отображением успешного выполнения кода.](./media/calculator-hello-world-console.png "Запуск проекта")

   Открывается окно консоли, и запускается ваше приложение. При запуске консольного приложения в Visual Studio система выполняет код, а затем выводит сообщение "Нажмите любую клавишу, чтобы продолжить. . .", чтобы вы могли просмотреть выходные данные. Поздравляем! Вы создали свое первое консольное приложение "Hello World" в Visual Studio!

1. Нажмите любую клавишу, чтобы закрыть окно консоли и вернуться в редактор Visual Studio.

Теперь у вас есть средства для сборки и запуска приложения после каждого изменения, чтобы убедиться, что код по-прежнему работает должным образом. Позже мы покажем, как выполнить его отладку при неправильной работе.

## <a name="edit-the-code"></a>Изменение кода

Теперь давайте превратим код в этом шаблоне в приложение калькулятора.

1. В файле *CalculatorTutorial.cpp* измените код таким образом, чтобы он соответствовал этому примеру:

    ```cpp
    // CalculatorTutorial.cpp : This file contains the 'main' function. Program execution begins and ends there.
    //

    #include "pch.h"
    #include <iostream>

    using namespace std;

    int main()
    {
        cout << "Calculator Console Application" << endl << endl;
        cout << "Please enter the operation to perform. Format: a+b | a-b | a*b | a/b"
            << endl;
        return 0;
    }

    // Run program: Ctrl + F5 or Debug > Start Without Debugging menu
    // Debug program: F5 or Debug > Start Debugging menu
    // Tips for Getting Started:
    //   1. Use the Solution Explorer window to add/manage files
    //   2. Use the Team Explorer window to connect to source control
    //   3. Use the Output window to see build output and other messages
    //   4. Use the Error List window to view errors
    //   5. Go to Project > Add New Item to create new code files, or Project > Add Existing Item to add existing code files to the project
    //   6. In the future, to open this project again, go to File > Open > Project and select the .sln file
    ```

   > Пояснения к коду:
   >
   > - Операторы `#include` позволяют ссылаться на код, расположенный в других файлах. Иногда вы можете увидеть имя файла, заключенное в угловые скобки ( **\<\>** ), а в других случаях — в кавычки ( **" "** ). В общем случае угловые скобки используются при ссылке на стандартную библиотеку C++, а кавычки — для других файлов.
   > - Строка `#include "pch.h"` (или файл `#include "stdafx.h"` в версиях, предшествующих Visual Studio 2017) ссылается на некий объект, известный как предкомпилированный заголовок. Они части используются профессиональными программистами для улучшения времени компиляции, однако выходят за рамки материала, обсуждаемого в этом руководстве.
   > - Строка `using namespace std;` сообщает компилятору ожидать данные от стандартной библиотеки C++ для использования в этом файле. Без нее каждое ключевое слово из этой библиотеки пришлось бы предварять элементом `std::`, чтобы обозначить его область. Например, без этой строки каждую ссылку на `cout` потребовалось бы записывать в виде `std::cout`. Оператор **`using`** добавляется, чтобы сделать код более понятным.
   > - Ключевое слово `cout` используется для вывода сведений в стандартный поток вывода в C++. Оператор **\<\<** указывает компилятору отправить все содержимое справа от него в стандартный поток вывода.
   > - Ключевое слово **endl** аналогично клавише ВВОД — оно завершает строку и переводит курсор на следующую строку. Для выполнения той же задачи рекомендуется помещать `\n` внутрь строки (заключенной в ""), так как `endl` всегда освобождает буфер и может негативно повлиять на производительность программы, но из-за того, что это очень небольшое приложение, в нем используется `endl` для улучшения удобочитаемости.
   > - Все операторы C++ должны заканчиваться точкой с запятой, а все приложения C++ — содержать функцию `main()`. Именно ее программа выполняет при запуске. Для использования весь код должен быть доступен из `main()`.

1. Чтобы сохранить файл, нажмите клавиши **CTRL+S** или выберите элемент **Сохранить** в верхней части интегрированной среды разработки, выглядящий как значок гибкого диска на панели инструментов в строке меню.

1. Чтобы запустить приложение, нажмите клавиши **CTRL+F5** или перейдите в меню **Отладка** и выберите **Запуск без отладки**. Если отображается всплывающее окно **This project is out of date** (Этот проект устарел), можно выбрать **Больше не показывать это диалоговое окно**, а затем — **Да**, чтобы создать приложение. Должно отобразится окно консоли с текстом, указанным в коде.

   ![Сборка и запуск приложения](./media/calculator-first-launch.gif "Сборка и запуск приложения")

1. По завершении закройте окно консоли.

## <a name="add-code-to-do-some-math"></a>Добавление кода для выполнения математических операций

Пора добавить математическую логику.

### <a name="to-add-a-calculator-class"></a>Добавление класса Calculator

1. В меню **Проект** выберите команду **Добавить класс**. В поле ввода **Имя класса** введите *Calculator*. Нажмите кнопку **ОК**. В проект будут добавлены два новых файла. Чтобы сохранить сразу все измененные файлы, нажмите клавиши **CTRL+SHIFT+S**. Это сочетание клавиш для команды **Файл** > **Сохранить все**. Кроме того, есть кнопка **Сохранить все** на панели инструментов. Она имеет вид значка с двумя дискетами рядом с кнопкой **Сохранить**. В общем случае рекомендуется регулярно нажимать кнопку **Сохранить все**, чтобы не пропустить никакие файлы при сохранении.

   ![Краткое видео, в котором пользователь открывает диалоговое окно "Добавить класс", вводит Calculator в поле "Имя класса" и нажимает кнопку "ОК".](./media/calculator-create-class.gif "Создание класса Calculator")

   Класс подобен схеме для объекта, который выполняет какие-либо действия. В этом случае мы определяем калькулятор и особенности его работы. Использованный ранее мастер **Добавить класс** создал файлы H и CPP, имя которых совпадает с именем класса. Вы можете просмотреть полный список файлов проекта в окне **обозревателя решений**, отображаемом в боковой части окна IDE. Если окно не отображается, его можно открыть из строки меню, выбрав **Вид** > **Обозреватель решений**.

   ![Снимок экрана: окно обозревателя решений, в котором отображается проект Calculator Tutorial.](./media/calculator-solution-explorer.png "обозреватель решений")

   Теперь у вас в редакторе должно быть открыто три вкладки: *CalculatorTutorial.cpp*, *Calculator.h* и *Calculator.cpp*. Если вы случайно закроете одну из них, то можете повторно открыть эту вкладку, дважды щелкнув ее в окне **обозревателя решений**.

1. На вкладке **Calculator.h** удалите созданные строки `Calculator();` и `~Calculator();`, так как здесь они вам не понадобятся. Затем добавьте следующую строку кода, чтобы файл выглядел следующим образом:

    ```cpp
    #pragma once
    class Calculator
    {
    public:
        double Calculate(double x, char oper, double y);
    };
    ```

   > Пояснения к коду
   >
   > - Добавленная строка объявляет новую функцию `Calculate`, которую мы используем для выполнения математических операций, таких как сложение, вычитание, умножение и деление.
   > - Код C++ упорядочен по файлам *заголовка* (H) и *исходным* файлам (CPP). Различные компиляторы поддерживают несколько других расширений имени файла, но это основные, о которых вам нужно знать. Функции и переменные обычно *объявляются*, то есть получают имя и тип, в файлах заголовка, и *реализуются*, то есть получают определение, в исходных файлах. Чтобы обратиться к коду, определенному в другом файле, вы можете использовать `#include "filename.h"`, где "filename.h" — это имя файла, объявляющего переменные или функции, которые требуется использовать.
   > - Две удаленные строки объявляли *конструктор* и *деструктор* для класса. Для такого простого класса компилятор создает их автоматически, а их использование выходит за рамки данного руководства.
   > - Рекомендуется упорядочивать код по различным файлам в зависимости от его назначения, чтобы позднее было проще найти нужный код. В данном случае мы определяем класс `Calculator` отдельно от файла, содержащего функцию `main()`, но планируем ссылаться на класс `Calculator` в `main()`.

1. Под `Calculate` появится зеленая волнистая линия. Это вызвано тем, что мы еще не определили функцию `Calculate` в CPP-файле. Наведите указатель на это слово, щелкните появившуюся лампочку и выберите **Создать определение "Calculate" в Calculator.cpp**. Отображается всплывающее окно, сообщающее об изменении кода, внесенном в другом файле. Код был добавлен в *Calculator.cpp*.

   ![Краткое видео, в котором пользователь выбирает параметр "Создать определение Calculate в Calculator.cpp".](./media/calculator-create-definition.gif "Создание определения для Calculate")

   Сейчас он возвращает просто 0.0. Давайте изменим это. Нажмите клавишу **ESC**, чтобы закрыть всплывающее окно.

1. Переключитесь на файл *Calculator.cpp* в окне редактора. Удалите разделы `Calculator()` и `~Calculator()` (как сделали в H-файле) и добавьте в `Calculate()` следующий код:

    ```cpp
    #include "pch.h"
    #include "Calculator.h"

    double Calculator::Calculate(double x, char oper, double y)
    {
        switch(oper)
        {
            case '+':
                return x + y;
            case '-':
                return x - y;
            case '*':
                return x * y;
            case '/':
                return x / y;
            default:
                return 0.0;
        }
    }
    ```

   > Пояснения к коду
   >
   > - Функция `Calculate` использует число, оператор и второе число, а затем выполняет запрошенную операцию над этими числами.
   > - Оператор switch проверяет, какой оператор был предоставлен, и выполняет только вариант (case), соответствующий этой операции. Вариант default: является резервным на тот случай, если пользователь вводит неприемлемый оператор, чтобы программа не прервала работу. В общем случае лучше обрабатывать некорректный ввод данных пользователем более элегантным способом, но это выходит за рамки данного руководства.
   > - Ключевое слово **`double`** обозначает тип числа, который поддерживает десятичные числа. Таким образом, калькулятор может выполнять математические операции с десятичными и целыми числами. Функция `Calculate` должна всегда возвращать такое число из-за типа **`double`** в самом начале кода (обозначает возвращаемый тип функции), поэтому даже в случае по умолчанию возвращается значение 0,0.
   > - H-файл объявляет функцию *prototype*, которая заранее сообщает компилятору, какой параметр требуется и какой тип возвращаемого значения следует ожидать. CPP-файл содержит все сведения о реализации этой функции.

Если построить и запустить код еще раз на этом этапе, он по-прежнему завершит работу после запроса операции для выполнения. Далее вам нужно изменить функцию `main` для выполнения вычислений.

### <a name="to-call-the-calculator-class-member-functions"></a>Вызов функций-членов класса Calculator

1. Теперь давайте изменим функцию `main` в *CalculatorTutorial.cpp*:

    ```cpp
    // CalculatorTutorial.cpp : This file contains the 'main' function. Program execution begins and ends there.
    //

    #include "pch.h"
    #include <iostream>
    #include "Calculator.h"

    using namespace std;

    int main()
    {
        double x = 0.0;
        double y = 0.0;
        double result = 0.0;
        char oper = '+';

        cout << "Calculator Console Application" << endl << endl;
        cout << "Please enter the operation to perform. Format: a+b | a-b | a*b | a/b"
             << endl;

        Calculator c;
        while (true)
        {
            cin >> x >> oper >> y;
            result = c.Calculate(x, oper, y);
            cout << "Result is: " << result << endl;
        }

        return 0;
    }
    ```

   > Пояснения к коду
   >
   > - Так как программы C++ всегда запускаются с функции `main()`, нам нужно вызвать из нее другой, для чего нужен оператор `#include`.
   > - Объявлены начальные переменные `x`, `y`, `oper` и `result` для хранения, соответственно, первого числа, второго числа, оператора и окончательного результата. Рекомендуется всегда присваивать им некоторые начальные значения, чтобы избежать неопределенного поведения. Это мы здесь и делаем.
   > - Строка `Calculator c;` объявляет объект "c" в качестве экземпляра класса `Calculator`. Сам класс является лишь схемой для описания работы калькуляторов, а объект — это конкретный калькулятор, который выполняет вычисления.
   > - Оператор `while (true)` является циклом. Код внутри этого цикла продолжает выполняться снова и снова, пока выполняется условие в `()`. Так как условие просто указано как **`true`** , оно всегда выполняется, поэтому цикл выполняется бесконечно. Чтобы закрыть программу, пользователю нужно вручную закрыть окно консоли. В противном случае программа будет постоянно ожидать новые входные данные.
   > - Ключевое слово `cin` используется для получения входных данных от пользователя. Этот входной поток способен обработать строку текста, введенного в окне консоли, и поместить ее внутрь каждой из перечисленных переменных в указанном порядке, при условии, что введенные пользователем данные соответствуют требуемой спецификации. Вы можете изменить эту строку, чтобы принять другие типы входных данных, например, больше двух чисел, однако для этого также потребуется изменить функцию `Calculate()`.
   > - Выражение `c.Calculate(x, oper, y);` вызывает определенную ранее функцию `Calculate` и предоставляет введенные входные значения. Затем она возвращает число, сохраняемое в `result`.
   > - Наконец, в консоль выводится `result`, благодаря чему пользователь видит результат вычисления.

### <a name="build-and-test-the-code-again"></a>Повторная сборка и проверка кода

Пришло время снова протестировать программу еще раз, чтобы убедиться в ее правильной работе.

1. Нажмите клавиши **CTRL+F5**, чтобы перестроить и запустить приложение.

1. Введите `5 + 5` и нажмите клавишу **ВВОД**. Убедитесь, что выводится результат 10.

   ![Снимок экрана: консоль отладки Microsoft Visual Studio с отображением правильного результата вычисления "5+5".](./media/calculator-five-plus-five.png "Результат сложения 5 + 5")

## <a name="debug-the-app"></a>Отладка приложения

Так как пользователь может ввести в окне консоли что угодно, нужно убедиться, что калькулятор обрабатывает некоторые входные данные правильно. Вместо запуска программы давайте выполним ее отладку, чтобы можно было проверить ее выполнение шаг за шагом.

### <a name="to-run-the-app-in-the-debugger"></a>Запуск приложения в отладчике

1. Установите точку останова на строке `result = c.Calculate(x, oper, y);`, сразу после запроса входных данных у пользователя. Чтобы задать точку останова, щелкните рядом со строкой серую вертикальную панель, идущую вдоль левой части окна редактора. Появится красная точка.

   ![Краткое видео, в котором пользователь создает в Visual Studio красную точку, представляющую точку останова.](./media/calculator-set-breakpoint.gif "Установка точки останова")

   Теперь при отладке программа всегда приостанавливает выполнение на этой строке. Мы уже имеем примерное представление о том, что в простых случаях программа работает. Так как нам не нужно приостанавливать выполнение при каждом запуске, создадим условную точку останова.

1. Щелкните правой кнопкой мыши красную точку, обозначающую точку останова, и выберите команду **Условия**. В поле ввода для условия введите `(y == 0) && (oper == '/')`. По завершении операции нажмите кнопку **Закрыть**. Условия сохранятся автоматически.

   ![Краткое видео, в котором пользователь открывает в Visual Studio 2019 раздел "Параметры точки останова" и задает условную точку останова.](./media/calculator-conditional-breakpoint.gif "Установка условной точки останова")

   Теперь выполнение приостанавливается в точке останова, в частности при попытке деления на 0.

1. Чтобы отладить программу, нажмите клавишу **F5** или выберите **Локальный отладчик Windows** — кнопку панели инструментов со значком зеленой стрелки. Если ввести в консольном приложении нечто вроде "5 - 0", программа работает как обычно и продолжает выполнение. Но если ввести "10 / 0", она приостанавливает выполнение в точке останова. Вы можете ввести любое число пробелов между оператором и числами; функция `cin` достаточно интеллектуальна для того, чтобы правильно проанализировать входные данные.

   ![Краткое видео, в котором программа в Visual Studio приостанавливает работу в условной точке останова.](./media/calculator-debug-conditional.gif "Приостановка на условной точке останова")

### <a name="useful-windows-in-the-debugger"></a>Полезные окна в отладчике

Каждый раз при отладке кода вы можете заметить, что появляется несколько новых окон. Они могут оказаться полезными в процессе отладки. Давайте рассмотрим окно **Видимые**. Окно **Видимые** содержит текущие значения переменных, используемых по меньшей мере за три строки перед текущей строкой.

   ![Окно Видимые](./media/calculator-autos.png "Окно Видимые")

Чтобы просмотреть все переменные из этой функции, переключитесь в окно **Локальные**. Вы можете изменять значения этих переменных во время отладки, чтобы оценить их влияние на программу. В данном случае мы оставим их без изменений.

   ![Снимок экрана: окно "Локальные".](./media/calculator-locals.png "Окно Локальные")

Кроме того, вы можете просто навести указатель на переменные в самом коде, чтобы просмотреть их текущие значения на участке, где приостановлено выполнение. Сначала щелкните окно редактора, чтобы сделать его активным.

   ![Краткое видео с отображением подсказки со значением переменной.](./media/calculator-hover-tooltip.gif "Наведите указатель мыши, чтобы просмотреть текущие значения переменных")

### <a name="to-continue-debugging"></a>Продолжение отладки

1. Желтая линия слева показывает текущую точку выполнения. Текущая строка вызывает `Calculate`, поэтому нажмите клавишу **F11**, чтобы выполнить **Шаг с заходом** для этой функции. Вы переходите в тело функции `Calculate`. Обдуманно применяйте функцию **Шаг с заходом**, чтобы не терять время из-за чрезмерного ее использования. С помощью функции анализируется любой код, используемый в текущей строке, включая стандартные функции библиотеки.

1. Теперь, когда точка выполнения находится в начале функции `Calculate`, нажмите клавишу **F10** для перехода на следующую строку в рамках выполнения программы. При нажатии клавиши **F10** активируется функция **Шаг с обходом**. **Шаг с обходом** можно использовать для перемещения по строкам, не вдаваясь в подробности того, что происходит в каждой части строки. В общем случае следует использовать **Шаг с обходом**, а не **Шаг с заходом**, если только вы не хотите подробно изучить код, вызываемый из другого расположения (как в случае с переходом к телу функции `Calculate`).

1. Продолжайте использовать клавишу **F10**, чтобы выполнять **Шаг с обходом** для каждой строки, пока не вернетесь к функции `main()` в другом файле, и остановитесь на строке `cout`.

   ![Шаг с выходом из Calculate и проверка результата](./media/calculator-undefined-zero.gif "Шаг с выходом из Calculate и проверка результата")

   Похоже, программа работает правильно — принимает первое число и делит его на второе. В строке `cout` наведите указатель мыши на переменную `result` или взгляните на `result` в окне **Видимые**. Соответствующее значение отображается как inf. Это неправильное поведение, и нужно его скорректировать. В строке `cout` просто выводится любое значение, хранящееся в `result`. Поэтому при продвижении еще на один шаг с помощью клавиши **F10** в окне консоли отображается следующее:

   ![Снимок экрана: консоль отладки Microsoft Visual Studio с отображением результата деления на ноль.](./media/calculator-divide-by-zero-fail.png "Результат деления на ноль")

   Причина такого результата в том, что деление на ноль является неопределенным, поэтому у программы нет числового ответа на запрошенную операцию.

### <a name="to-fix-the-divide-by-zero-error"></a>Исправление ошибки деления на ноль

Давайте обеспечим корректную обработку деления на ноль, чтобы пользователь мог осознать проблему.

1. Внесите следующие изменения в *CalculatorTutorial.cpp*. (Прерывать выполнение программы при редактировании не требуется благодаря функции отладчика **Изменить и продолжить**):

    ```cpp
    // CalculatorTutorial.cpp : This file contains the 'main' function. Program execution begins and ends there.
    //

    #include "pch.h"
    #include <iostream>
    #include "Calculator.h"

    using namespace std;

    int main()
    {
        double x = 0.0;
        double y = 0.0;
        double result = 0.0;
        char oper = '+';

        cout << "Calculator Console Application" << endl << endl;
        cout << "Please enter the operation to perform. Format: a+b | a-b | a*b | a/b" << endl;

        Calculator c;
        while (true)
        {
            cin  >> x  >> oper  >> y;
            if (oper == '/' && y == 0)
            {
                cout << "Division by 0 exception" << endl;
                continue;
            }
            else
            {
                result = c.Calculate(x, oper, y);
            }
            cout << "Result is: " << result << endl;
        }

        return 0;
    }
    ```

1. Теперь нажмите клавишу **F5** один раз. При этом выполнение программы продолжается вплоть до приостановки для запроса данных, вводимых пользователем. Снова введите `10 / 0`. Теперь выводится более информативное сообщение. У пользователя запрашиваются дополнительные входные данные, и программа продолжает выполнение в обычном режиме.

   ![Краткое видео с консолью отладки Microsoft Visual Studio, в которой отображается окончательный результат после изменений.](./media/calculator-final-verification.gif "Окончательный результат после внесения изменений")

   > [!Note]
   > При редактировании кода в режиме отладки существует риск того, что код устареет. Это происходит, когда отладчик продолжает выполнять старый код, не учитывающий внесенные вами изменения. В подобной ситуации отладчик выводит диалоговое окно с соответствующим сообщением. В некоторых случаях может потребоваться нажать клавишу **F5**, чтобы обновить выполняемый код. В частности, если вы вносите изменения внутри функции, когда точка выполнения находится внутри этой же функции, вам потребуется выполнить шаг с выходом из функции, а затем вернуться в нее, чтобы получить обновленный код. Если по какой-либо причине это не работает и вы видите сообщение об ошибке, можно остановить отладку, щелкнув красный квадрат на панели инструментов под меню в верхней части интегрированной среды разработки, а затем перезапустить отладку, нажав клавишу **F5** или выбрав зеленую стрелку "воспроизведения" рядом с кнопкой остановки на панели инструментов.

   > Пояснения по сочетаниям клавиш для выполнения и отладки
   >
   > - Клавиша **F5** (или команда **Отладка** > **Запустить отладку**) запускает сеанс отладки, если он еще не активен, и выполняет программу до тех пор, пока не будет встречена точка останова либо программе не потребуются вводимые пользователем данные. Если вводимые пользователем данные не требуются и точка останова отсутствует, программа завершает работу, а окно консоли автоматически закрывается после завершения выполнения программы. Если вы выполняете программу уровня "Hello World", используйте сочетание клавиш **CTRL+F5** или задайте точку останова перед нажатием клавиши **F5**, чтобы окно оставалось открытым.
   > - Сочетание клавиш **CTRL+F5** (или команда **Отладка** > **Запуск без отладки**) запускает приложение без перехода в режим отладки. Это немного быстрее отладки, а окно консоли остается открытым после завершения выполнения программы.
   > - Клавиша **F10** (соответствующая возможности **Шаг с обходом**) позволяет выполнять построчную итерацию по коду, а также визуализировать выполнение кода и значения переменных на каждом шаге выполнения.
   > - Клавиша **F11** (соответствующая возможности **Шаг с заходом**) работает аналогично возможности **Шаг с обходом**, за исключением того, что заходит в любые функции, вызываемые в строке выполнения. Например, если в выполняемой строке вызывается функция, при нажатии клавиши **F11** указатель перемещается в тело функции, чтобы вы могли проследить выполнение кода функции, прежде чем вернуться на исходную строку. При нажатии клавиши **F10** выполняется шаг с обходом по вызову функции и простой переход на следующую строку. Вызов функции все равно выполняется, но программа не приостанавливается, чтобы показать вам, что именно она делает.

### <a name="close-the-app"></a>Закрытие приложения

- Если оно все еще выполняется, закройте окно консоли для приложения калькулятора.

## <a name="the-finished-app"></a>Готовое приложение

Поздравляем! Вы завершили написание кода для приложения калькулятора, а также выполнили его сборку и отладку в Visual Studio.

## <a name="next-steps"></a>Следующие шаги

[Дополнительные сведения о Visual Studio для C++](https://devblogs.microsoft.com/cppblog/getting-started-with-visual-studio-for-c-and-cpp-development/)

::: moniker-end
