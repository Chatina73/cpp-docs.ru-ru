---
description: 'Дополнительные сведения о: MASM для x64 (ml64.exe)'
title: MASM для x64 (ml64.exe)
ms.date: 12/17/2019
helpviewer_keywords:
- ml64
- ml64.exe
- masm for x64
ms.assetid: 89059103-f372-4968-80ea-0c7f90bb9c91
ms.openlocfilehash: 58970f65fbd98b4cbebae0a36c615cb380ec5b75
ms.sourcegitcommit: d6af41e42699628c3e2e6063ec7b03931a49a098
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2020
ms.locfileid: "97129731"
---
# <a name="masm-for-x64-ml64exe"></a>MASM для x64 (ml64.exe)

Visual Studio включает в себя как 32-разрядную, так и 64-разрядную версию Microsoft Assembler (MASM) для целевого кода x64. Именованный ml64.exe — это ассемблер, который принимает язык ассемблера x64. Программы командной строки MASM устанавливаются при выборе рабочей нагрузки C++ во время установки Visual Studio. Средства MASM недоступны для загрузки отдельно. Инструкции по скачиванию и установке копии Visual Studio см. в статье [Установка Visual Studio](/visualstudio/install/install-visual-studio). Если вы не хотите устанавливать полную интегрированную среду разработки Visual Studio, но вам нужны только программы командной строки, скачайте [средства сборки для Visual Studio](https://visualstudio.microsoft.com/downloads/#build-tools-for-visual-studio-2019).

Чтобы использовать MASM для построения кода для платформ x64 в командной строке, необходимо использовать командную строку разработчика для целевых платформ x64, которые задают требуемый путь и другие переменные среды. Сведения о запуске командной строки разработчика см. в разделе [Сборка кода C/C++ в командной строке](../../build/building-on-the-command-line.md).

Дополнительные сведения о ml64.exe параметрах командной строки см. в разделе [Справочник по языку ML и ML64 Command-Line](ml-and-ml64-command-line-reference.md).

Встроенный ассемблер или использование ключевого слова ASM не поддерживается для целевых объектов x64 и ARM. Чтобы перенести код x86, использующий встроенный ассемблер для x64 или ARM, можно преобразовать код в C++, использовать встроенные функции компилятора или создать файлы исходного кода на языке ассемблера. Компилятор Microsoft C++ поддерживает встроенные функции, позволяющие использовать специальные инструкции, например привилегированные, битовые сканирования и тестирования, взаимоблокировки и т. д., в качестве максимально близкого к кросс-платформенному способу. Сведения о доступных встроенных функциях см. в разделе [встроенные функции компилятора](../../intrinsics/compiler-intrinsics.md).

## <a name="add-an-assembler-language-file-to-a-visual-studio-c-project"></a>Добавление файла ассемблерного языка в проект Visual Studio C++

Система проектов Visual Studio поддерживает файлы на языке ассемблера, созданные с помощью MASM в проектах C++. Вы можете создавать файлы исходного кода на языке ассемблера x64 и создавать их в объектных файлах с помощью MASM, который поддерживает 64-разрядную версию. Затем эти файлы объектов можно связать с кодом C++, созданным для целевых платформ x64. Это один из способов преодоления отсутствия встроенного ассемблера x64.

### <a name="to-add-an-assembler-language-file-to-an-existing-visual-studio-c-project"></a>Добавление файла ассемблерного языка в существующий проект Visual Studio C++

1. Выберите проект в **обозревателе решений**. В строке меню выберите **проект**, **настройки сборки**.

1. В диалоговом окне **Visual C++ файлы настройки сборки** установите флажок для **MASM (. targets,. props)**. Нажмите кнопку **ОК** , чтобы сохранить выбранные элементы и закрыть диалоговое окно.

1. В строке меню выберите **проект**, **Добавить новый элемент**.

1. В центральной области диалогового окна **Добавление нового элемента** выберите **файл C++ (. cpp)** . В поле **имя** элемента управления изменить введите новое имя файла с расширением **ASM** вместо. cpp. Нажмите кнопку **Добавить** , чтобы добавить файл в проект и закрыть диалоговое окно.

Создайте код на языке ассемблера в добавленном ASM-файле. При сборке решения вызывается ассемблер MASM Assembler для сборки ASM-файла в объектный файл, который затем связывается с проектом. Чтобы упростить доступ к символам, объявите функции ассемблера как `extern "C"` в исходном коде C++ вместо использования соглашений об оформлении имен c++ в исходных файлах на языке ассемблера.

## <a name="ml64-specific-directives"></a>Директивы, относящиеся к ml64

В исходном коде на языке ассемблера, предназначенном для x64, можно использовать следующие директивы ml64:

- [.ALLOCSTACK](dot-allocstack.md)

- [.ENDPROLOG](dot-endprolog.md)

- [.PUSHFRAME](dot-pushframe.md)

- [.PUSHREG](dot-pushreg.md)

- [.SAVEREG](dot-savereg.md)

- [.SAVEXMM128](dot-savexmm128.md)

- [.SETFRAME](dot-setframe.md)

Кроме того, Директива [proc](proc.md) была обновлена для использования с ml64.exe.

## <a name="32-bit-address-mode-address-size-override"></a>32-разрядный режим адреса (переопределение размера адреса)

Компилятор MASM выдает переопределение размера адреса 0x67, если операнд памяти включает 32-разрядные регистры. Например, в следующих примерах вызывается переопределение размера адреса.

```asm
mov rax, QWORD PTR [ecx]
mov eax, DWORD PTR [ecx*2+r10d]
mov eax, DWORD PTR [ecx*2+r10d+0100h]
prefetch [eax]
movnti rax, QWORD PTR [r8d]
```

В компиляторе MASM предполагается, что если 32-разрядное смещение отображается как операнд в памяти, то используется 64-разрядная адресация. В настоящее время не поддерживается 32-разрядная адресация с такими операндами.

Наконец, смешивание размеров регистров в пределах операнда памяти, как показано в следующем коде, приводит к ошибке.

```asm
mov eax, DWORD PTR [rcx*2+r10d]
mov eax, DWORD PTR [ecx*2+r10+0100h]
```

## <a name="see-also"></a>См. также раздел

[Справочные материалы по ассемблеру Microsoft Macro Assembler](microsoft-macro-assembler-reference.md)
