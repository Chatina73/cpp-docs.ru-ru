---
title: Контейнеры. Составные файлы
ms.date: 11/04/2016
helpviewer_keywords:
- compound files [MFC]
- compound documents
- containers [MFC], compound files
- OLE documents [MFC], compound files
- performance [MFC], compound files
- files [MFC], compound
- standardized file structure compound files
- documents [MFC], compound
- documents [MFC], OLE
- OLE containers [MFC], compound files
- access modes for files [MFC]
ms.assetid: 8b83cb3e-76c8-4bbe-ba16-737092b36f49
ms.openlocfilehash: 344c444602555e2b5c145e58d237586199b9e1ed
ms.sourcegitcommit: c21b05042debc97d14875e019ee9d698691ffc0b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/09/2020
ms.locfileid: "84624820"
---
# <a name="containers-compound-files"></a>Контейнеры. Составные файлы

В этой статье объясняются компоненты и реализация составных файлов, а также преимущества и недостатки использования составных файлов в приложениях OLE.

Составные файлы являются неотъемлемой частью OLE. Они используются для упрощения обмена данными и хранения документов OLE. Составные файлы являются реализацией активной модели структурированного хранилища. Существуют последовательные интерфейсы, поддерживающие сериализацию в хранилище, поток или объект файла. Составные файлы поддерживаются в библиотека Microsoft Foundation Class классами `COleStreamFile` и `COleDocument` .

> [!NOTE]
> Использование составного файла не подразумевает, что информация поступает из документа OLE или составного документа. Составные файлы — это лишь один из способов хранения составных документов, документов OLE и других данных.

## <a name="components-of-a-compound-file"></a><a name="_core_components_of_a_compound_file"></a>Компоненты составного файла

Реализация OLE составных файлов использует три типа объектов: объекты потока, объекты хранилища и `ILockBytes` объекты. Эти объекты похожи на компоненты стандартной файловой системы следующим образом.

- Объекты потока, например файлы, хранят данные любого типа.

- Объекты хранилища, например каталоги, могут содержать другие объекты хранилища и потоков.

- `LockBytes`объекты представляют интерфейс между объектами хранилища и физическим оборудованием. Они определяют, как фактические байты записываются на любое запоминающее устройство `LockBytes` , к которому обращается объект, например на жесткий диск или в область глобальной памяти. Дополнительные сведения об `LockBytes` объектах и `ILockBytes` интерфейсе см. в *справочнике по OLE для программиста*.

## <a name="advantages-and-disadvantages-of-compound-files"></a><a name="_core_advantages_and_disadvantages_of_compound_files"></a>Преимущества и недостатки составных файлов

Составные файлы предоставляют преимущества, недоступные в более ранних методах хранилища файлов. К ним относятся следующие:

- Добавочный доступ к файлам.

- Режимы доступа к файлам.

- Стандартизация структуры файлов.

Потенциальные недостатки составных файлов — проблемы с большим размером и производительностью, связанные с хранением на гибких дисках — следует учитывать при принятии решения о том, следует ли использовать их в своем приложении.

### <a name="incremental-access-to-files"></a><a name="_core_incremental_access_to_files"></a>Добавочный доступ к файлам

Добавочный доступ к файлам является автоматическим преимуществом использования составных файлов. Поскольку составной файл можно просмотреть в виде файловой системы в файле, можно получить доступ к отдельным типам объектов, таким как Stream или Storage, без необходимости загрузки всего файла. Это может значительно снизить время, необходимое приложению для доступа к новым объектам для редактирования пользователем. Добавочное обновление, основанное на той же концепции, предлагает аналогичные преимущества. Вместо сохранения всего файла только для сохранения изменений, внесенных в один объект, OLE сохраняет только поток или объект хранилища, измененные пользователем.

### <a name="file-access-modes"></a><a name="_core_file_access_modes"></a>Режимы доступа к файлам

Возможность определить, когда изменения объектов в составном файле зафиксирована на диске, является еще одним преимуществом использования составных файлов. Режим, в котором осуществляется доступ к файлам (транзакционным или прямым), определяет время фиксации изменений.

- Режим транзакций с двухфазной фиксацией используется для внесения изменений в объекты в составном файле, тем самым сохраняя доступ к старым и новым копиям документа до тех пор, пока пользователь не решит сохранить или отменить изменения.

- В режиме прямого режима вносятся изменения в документ по мере их внесения, без возможности их отмены в дальнейшем.

Дополнительные сведения о режимах доступа см. в *справочнике по программированию для OLE*.

### <a name="standardization"></a><a name="_core_standardization"></a>Стандартизации

Стандартизированная структура составных файлов позволяет различным приложениям OLE просматривать составные файлы, созданные приложением OLE, без знания о приложении, которое фактически создало файл.

### <a name="size-and-performance-considerations"></a><a name="_core_size_and_performance_considerations"></a>Рекомендации по размеру и производительности

Из-за сложности структуры хранилища составных файлов и возможности постепенного сохранения данных файлы, использующие этот формат, имеют больший размер, чем другие файлы, использующие неструктурированный или неструктурированный файл. Если приложение часто загружает и сохраняет файлы, использование составных файлов может привести к увеличению размера файла гораздо быстрее, чем Несоставные файлы. Поскольку составные файлы могут быть большими, также могут быть затронуты время доступа для файлов, хранящихся на гибких дисках и загруженных с них, что приводит к более медленному доступу к файлам.

Другой проблемой, влияющей на производительность, является фрагментация составных файлов. Размер составного файла определяется разницей между первым и последним секторами диска, используемыми файлом. Фрагментированный файл может содержать множество областей свободного пространства, которые не содержат данных, но учитываются при вычислении размера. В течение времени существования составного файла эти области создаются путем вставки или удаления объектов хранилища.

## <a name="using-compound-files-format-for-your-data"></a><a name="_core_using_compound_files_format_for_your_data"></a>Использование формата составных файлов для данных

После успешного создания приложения, имеющего класс документа, производный от `COleDocument` , убедитесь, что главный конструктор документа вызывает `EnableCompoundFile` . Когда мастер приложений создает приложения-контейнеры OLE, этот вызов вставляется для вас.

В *справочнике по программированию для OLE*см. в разделе [IStream](/windows/win32/api/objidl/nn-objidl-istream), [IStorage](/windows/win32/api/objidl/nn-objidl-istorage)и [ILockBytes](/windows/win32/api/objidl/nn-objidl-ilockbytes).

## <a name="see-also"></a>См. также раздел

[Контейнеры](containers.md)<br/>
[Контейнеры. Проблемы пользовательского интерфейса](containers-user-interface-issues.md)<br/>
[Класс Колестреамфиле](reference/colestreamfile-class.md)<br/>
[Класс Коледокумент](reference/coledocument-class.md)
