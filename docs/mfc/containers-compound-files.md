---
title: Контейнеры. Составные файлы
ms.date: 11/04/2016
helpviewer_keywords:
- compound files [MFC]
- compound documents
- containers [MFC], compound files
- OLE documents [MFC], compound files
- performance [MFC], compound files
- files [MFC], compound
- standardized file structure compound files
- documents [MFC], compound
- documents [MFC], OLE
- OLE containers [MFC], compound files
- access modes for files [MFC]
ms.assetid: 8b83cb3e-76c8-4bbe-ba16-737092b36f49
ms.openlocfilehash: 98166a355fd267ecbec0a7f0cc1d18fd0b2e7cd0
ms.sourcegitcommit: c123cc76bb2b6c5cde6f4c425ece420ac733bf70
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81353585"
---
# <a name="containers-compound-files"></a>Контейнеры. Составные файлы

В этой статье разъясняются компоненты и реализация сложных файлов, а также преимущества и недостатки использования сложных файлов в приложениях OLE.

Составные файлы являются неотъемлемой частью OLE. Они используются для облегчения передачи данных и хранения документов OLE. Составные файлы являются реализацией модели active структурированной памяти. Существуют согласованные интерфейсы, поддерживающие сериализацию к объекту хранения, потоку или файлу. Составные файлы поддерживаются в библиотеке `COleStreamFile` `COleDocument`класса Микрософт Foundation и .

> [!NOTE]
> Использование сложного файла не означает, что информация поступает из документа OLE или сложного документа. Составные файлы являются лишь одним из способов хранения сложных документов, документов OLE и других данных.

## <a name="components-of-a-compound-file"></a><a name="_core_components_of_a_compound_file"></a>Компоненты файла соединения

В реализации составных файлов OLE используются три типа `ILockBytes` объектов: объекты потока, объекты хранения и объекты. Эти объекты аналогичны компонентам стандартной файловой системы следующим образом:

- Потокобъектов, таких как файлы, хранит данные любого типа.

- Объекты хранения, такие как каталоги, могут содержать другие объекты хранения и потоковой передачи.

- `LockBytes`объекты представляют интерфейс между объектами хранения и физическим оборудованием. Они определяют, как фактические байты записываются на любое устройство хранения, к которым находится `LockBytes` объект, например на жестком диске или в области глобальной памяти. Для получения `LockBytes` дополнительной информации об *OLE Programmer's Reference*объектах и интерфейсе `ILockBytes` см.

## <a name="advantages-and-disadvantages-of-compound-files"></a><a name="_core_advantages_and_disadvantages_of_compound_files"></a>Преимущества и недостатки файлов соединения

Составные файлы предоставляют преимущества, недоступные с более ранними методами хранения файлов. в том числе:

- Дополнительный доступ к файлам.

- Режимы доступа к файлам.

- Стандартизация структуры файлов.

Потенциальные недостатки сложных файлов - большие размеры и проблемы с производительностью, связанные с хранением на дискетах - следует учитывать при принятии решения об их использовании в приложении.

### <a name="incremental-access-to-files"></a><a name="_core_incremental_access_to_files"></a>Инкрементный доступ к файлам

Инкрементный доступ к файлам является автоматическим преимуществом использования сложных файлов. Поскольку составной файл можно рассматривать как "файловую систему в файле", отдельные типы объектов, такие как поток или хранилище, могут быть доступны без необходимости загрузки всего файла. Это может значительно сократить время, необходимое приложению для доступа к новым объектам для редактирования пользователем. Инкрементное обновление, основанное на той же концепции, предлагает аналогичные преимущества. Вместо того, чтобы сохранять весь файл только для того, чтобы сохранить изменения, внесенные в один объект, OLE сохраняет только объект потока или хранилища, отредактированный пользователем.

### <a name="file-access-modes"></a><a name="_core_file_access_modes"></a>Режимы доступа к файлам

Возможность определить, когда изменения объектов в составе файла совершаются на диске является еще одним преимуществом использования сложных файлов. Режим, в котором файлы доступны, либо переводимые, либо прямые, определяет, когда изменяются изменения.

- Режим Transacted использует двухфазную операцию коммита для внесения изменений в объекты в составном файле, тем самым сохраняя как старые, так и новые копии документа доступными до тех пор, пока пользователь не решит сохранить или отменить изменения.

- Прямой режим включает изменения в документ, как они сделаны, без возможности позже отменить их.

Для получения дополнительной информации о *OLE Programmer's Reference*режимах доступа, см.

### <a name="standardization"></a><a name="_core_standardization"></a>Стандартизации

Стандартизированная структура сложных файлов позволяет различным приложениям OLE просматривать сложные файлы, созданные вашим приложением OLE, не зная приложения, которое фактически создало файл.

### <a name="size-and-performance-considerations"></a><a name="_core_size_and_performance_considerations"></a>Соображения размера и производительности

Из-за сложности структуры хранения сложных файлов и возможности постепенного сохранения данных файлы, использующие этот формат, как правило, больше, чем другие файлы, использующие неструктурированное или "плоское хранилище" для хранения. Если приложение часто загружает и сохраняет файлы, использование сложных файлов может привести к увеличению размера файла гораздо быстрее, чем несоставные файлы. Поскольку составные файлы могут быть большими, время доступа к файлам, хранящимся и загруженным с дискет, также может быть затронуто, что приведет к замедлению доступа к файлам.

Еще одна проблема, которая влияет на производительность, это фрагментация файлов соединения. Размер сложного файла определяется разницей между первым и последним секторами диска, используемыми файлом. Фрагментированный файл может содержать много областей свободного пространства, которые не содержат данных, но учитываются при расчете размера. В течение всего срока службы сложного файла эти области создаются путем вставки или удаления объектов хранения.

## <a name="using-compound-files-format-for-your-data"></a><a name="_core_using_compound_files_format_for_your_data"></a>Использование формата составных файлов для ваших данных

После успешного создания приложения, которое `COleDocument`имеет класс документов, полученных из, убедитесь, что ваш основной конструктор документа вызывает. `EnableCompoundFile` Когда мастер приложения создает приложения контейнера OLE, этот вызов вставляется для вас.

В *справке программиста OLE*, [IStorage](/windows/win32/api/objidl/nn-objidl-istorage) [см.](/windows/win32/api/objidl/nn-objidl-istream) [ILockBytes](/windows/win32/api/objidl/nn-objidl-ilockbytes)

## <a name="see-also"></a>См. также раздел

[Контейнеры](../mfc/containers.md)<br/>
[Контейнеры. Проблемы пользовательского интерфейса](../mfc/containers-user-interface-issues.md)<br/>
[Класс ColeStreamFile](../mfc/reference/colestreamfile-class.md)<br/>
[Класс COleDocument](../mfc/reference/coledocument-class.md)
