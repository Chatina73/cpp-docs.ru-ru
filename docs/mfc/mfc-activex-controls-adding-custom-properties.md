---
title: Элементы управления ActiveX в MFC. Добавление пользовательских свойств
ms.date: 11/04/2016
helpviewer_keywords:
- MFC ActiveX controls [MFC], properties
- properties [MFC], custom
ms.assetid: 85af5167-74c7-427b-b8f3-e0d7b73942e5
ms.openlocfilehash: af1ca2d63abcb112bfe1e7d7538dbf70fb817ae5
ms.sourcegitcommit: a1676bf6caae05ecd698f26ed80c08828722b237
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/29/2020
ms.locfileid: "91503880"
---
# <a name="mfc-activex-controls-adding-custom-properties"></a>Элементы управления ActiveX в MFC. Добавление пользовательских свойств

Пользовательские свойства отличаются от стандартных свойств в том, что пользовательские свойства еще не реализованы `COleControl` классом. Пользовательское свойство используется для представления определенного состояния или внешнего вида элемента управления ActiveX программисту, использующему этот элемент управления.

В этой статье описывается, как добавить пользовательское свойство в элемент управления ActiveX с помощью мастера добавления свойств и объясняются итоговые изменения кода. Будут рассмотрены следующие задачи:

- [Добавление пользовательского свойства с помощью мастера добавления свойств](#_core_using_classwizard_to_add_a_custom_property)

- [Изменение мастера добавления свойств для пользовательских свойств](#_core_classwizard_changes_for_custom_properties)

Пользовательские свойства бывают четырех видов реализации: переменную-член, переменную-член с уведомлением, методы Get/Set и параметризованные.

- Реализация переменной члена

   Эта реализация представляет состояние свойства как переменную-член в классе элемента управления. Используйте реализацию переменной-члена, если не важно иметь представление об изменении значения свойства. Из трех типов Эта реализация создает минимальный объем кода поддержки для свойства. Макрос записи диспетчеризации для реализации переменной-члена [DISP_PROPERTY](reference/dispatch-maps.md#disp_property).

- Переменная члена с реализацией уведомления

   Эта реализация состоит из переменной-члена и функции уведомления, созданной мастером добавления свойства. Функция уведомления автоматически вызывается платформой после изменения значения свойства. Используйте переменную-член с реализацией уведомления, когда необходимо получать уведомления после изменения значения свойства. Эта реализация требует больше времени, так как требует вызова функции. Для этой реализации указан [DISP_PROPERTY_NOTIFYный](reference/dispatch-maps.md#disp_property_notify)макрос записи диспетчеризации.

- Реализация методов Get и Set

   Эта реализация состоит из пары функций-членов в классе Control. Реализация методов Get/Set автоматически вызывает функцию-член get, когда пользователь элемента управления запрашивает текущее значение свойства и функцию-член Set, когда пользователь элемента управления запрашивает изменение свойства. Эта реализация используется, если необходимо вычислить значение свойства во время выполнения, проверить значение, передаваемое пользователем элемента управления перед изменением фактического свойства, или реализовать тип свойства только для чтения или только для записи. Для этой реализации указан [DISP_PROPERTY_EXный](reference/dispatch-maps.md#disp_property_ex)макрос записи диспетчеризации. В следующем разделе [Использование мастера добавления свойств для добавления пользовательского свойства](#_core_using_classwizard_to_add_a_custom_property)использует пользовательское свойство Цирклеоффсет для демонстрации этой реализации.

- Параметризованная реализация

   Параметризованная реализация поддерживается мастером добавления свойств. Параметризованное свойство (иногда называемое массивом свойств) можно использовать для доступа к набору значений через одно свойство элемента управления. Для этой реализации указан DISP_PROPERTY_PARAMный макрос записи диспетчеризации. Дополнительные сведения о реализации этого типа см. в разделе [Реализация параметризованного свойства](mfc-activex-controls-advanced-topics.md) статьи элементы управления ActiveX: дополнительные разделы.

## <a name="using-the-add-property-wizard-to-add-a-custom-property"></a><a name="_core_using_classwizard_to_add_a_custom_property"></a> Добавление пользовательского свойства с помощью мастера добавления свойств

В следующей процедуре показано добавление пользовательского свойства Цирклеоффсет, использующего реализацию методов Get/Set. Пользовательское свойство Цирклеоффсет позволяет пользователю элемента управления сдвигать окружность от центра ограничивающего прямоугольника элемента управления. Процедура добавления пользовательских свойств с реализацией, отличной от методов Get/Set, очень похожа.

Эту же процедуру также можно использовать для добавления других настраиваемых свойств. Замените имя настраиваемого свойства на имя и параметры свойства Цирклеоффсет.

#### <a name="to-add-the-circleoffset-custom-property-using-the-add-property-wizard"></a>Добавление пользовательского свойства Цирклеоффсет с помощью мастера добавления свойства

1. Загрузите проект элемента управления.

1. В представлении класса разверните узел библиотеки элемента управления.

1. Щелкните правой кнопкой мыши узел интерфейса для элемента управления (второй узел узла библиотеки), чтобы открыть контекстное меню.

1. В контекстном меню выберите **Добавить** , а затем — **Добавить свойство**.

   Откроется [Мастер добавления свойств](../ide/adding-a-property-visual-cpp.md#names-add-property-wizard).

1. В поле **имя свойства** введите *Цирклеоффсет*.

1. В поле **Тип реализации**выберите **Методы Get/Set**.

1. В поле **тип свойства** выберите **`short`** .

1. Введите уникальные имена для функций get и Set или примите имена по умолчанию.

1. Нажмите кнопку **Готово**.

## <a name="add-property-wizard-changes-for-custom-properties"></a><a name="_core_classwizard_changes_for_custom_properties"></a> Изменение мастера добавления свойств для пользовательских свойств

При добавлении пользовательского свойства Цирклеоффсет мастер добавления свойств вносит изменения в заголовок (. H) и реализацию (. CPP) файлов класса Control.

Следующие строки добавляются в. H файл для объявления двух функций `GetCircleOffset` с именем и `SetCircleOffset` :

[!code-cpp[NVC_MFC_AxUI#25](codesnippet/cpp/mfc-activex-controls-adding-custom-properties_1.h)]

Следующая строка добавляется в элемент управления. IDL-файл:

[!code-cpp[NVC_MFC_AxUI#26](codesnippet/cpp/mfc-activex-controls-adding-custom-properties_2.idl)]

Эта строка присваивает свойству Цирклеоффсет конкретный ИДЕНТИФИКАЦИОНный номер, взятый из расположения метода в списке методы и свойства мастера добавления свойства.

Кроме того, следующая строка добавляется в карту диспетчеризации (в. CPP-файл класса Control) для отображения свойства Цирклеоффсет в двух функциях обработчика элемента управления:

[!code-cpp[NVC_MFC_AxUI#27](codesnippet/cpp/mfc-activex-controls-adding-custom-properties_3.cpp)]

Наконец, реализации `GetCircleOffset` `SetCircleOffset` функций и добавляются в конец элемента управления. Файл CPP. В большинстве случаев вы измените функцию Get, чтобы она возвращала значение свойства. Функция Set обычно содержит код, который должен выполняться либо до, либо после изменения свойства.

[!code-cpp[NVC_MFC_AxUI#28](codesnippet/cpp/mfc-activex-controls-adding-custom-properties_4.cpp)]

Обратите внимание, что мастер добавления свойства автоматически добавляет вызов [SetModifiedFlag](reference/colecontrol-class.md#setmodifiedflag)в тело функции Set. Вызов этой функции помечает элемент управления как измененный. Если элемент управления был изменен, его новое состояние будет сохранено при сохранении контейнера. Эта функция должна вызываться всякий раз, когда свойство, сохраненное как часть постоянного состояния элемента управления, изменяет значение.

## <a name="see-also"></a>См. также раздел

[Элементы управления ActiveX в MFC](mfc-activex-controls.md)<br/>
[Элементы управления ActiveX в MFC: свойства](mfc-activex-controls-properties.md)<br/>
[Элементы управления ActiveX в MFC: методы](mfc-activex-controls-methods.md)<br/>
[Класс COleControl](reference/colecontrol-class.md)
