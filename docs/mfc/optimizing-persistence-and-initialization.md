---
title: Оптимизация постоянства и инициализации
ms.date: 11/04/2016
helpviewer_keywords:
- MFC ActiveX controls [MFC], optimizing
- performance, ActiveX controls
- optimization, ActiveX controls
- optimizing performance, ActiveX controls
ms.assetid: e821e19e-b9eb-49ab-b719-0743420ba80b
ms.openlocfilehash: 294d9c43f5f767329c04932c574485d7dca704e9
ms.sourcegitcommit: c6f8e6c2daec40ff4effd8ca99a7014a3b41ef33
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/24/2019
ms.locfileid: "64342132"
---
# <a name="optimizing-persistence-and-initialization"></a>Оптимизация постоянства и инициализации

По умолчанию постоянства и инициализации в элементе управления обрабатываются `DoPropExchange` функция-член. В элементе управления типичный, эта функция содержит несколько вызовов **PX_** функции (`PX_Color`, `PX_Font`, и так далее), одной для каждого свойства.

Такой подход имеет преимущество, один `DoPropExchange` реализация может быть использована для инициализации, для сохранения в двоичном формате и для сохранения в формате так называемые «контейнера свойств», который используется в некоторые контейнеры. Это одна функция предоставляет всю информацию о свойствах и их значения по умолчанию в одном удобном месте.

Тем не менее это универсальности приходится снижать эффективность. **PX_** функции, получить их гибкость посредством многоуровневой реализации, которые являются по своей природе менее эффективно, чем более прямой, но менее гибкими, подходы. Кроме того Если элемент управления передает значение по умолчанию **PX_** функции, что по умолчанию должно быть указано значение каждый раз, даже в случаях, когда значение по умолчанию может не обязательно использовать. Если значение по умолчанию является непростой задачей (например, если значение получается из внешнее свойство), то лишние, ненужные работа выполняется в случаях, где не используется значение по умолчанию.

Можно повысить производительность двоичных сохраняемости элемента управления путем переопределения элемента управления `Serialize` функции. Реализация по умолчанию эта функция-член вызывает ваш `DoPropExchange` функции. Переопределив его, можно предоставить более прямой реализацию для двоичных сохраняемости. Например, рассмотрим это `DoPropExchange` функции:

[!code-cpp[NVC_MFC_AxOpt#1](../mfc/codesnippet/cpp/optimizing-persistence-and-initialization_1.cpp)]

Чтобы повысить производительность двоичных сохраняемости данного элемента управления, можно переопределить `Serialize` функцию следующим образом:

[!code-cpp[NVC_MFC_AxOpt#2](../mfc/codesnippet/cpp/optimizing-persistence-and-initialization_2.cpp)]

`dwVersion` Локальная переменная может использоваться для обнаружения версии устойчивое состояние элемента управления загрузки или сохранения. Эту переменную можно использовать вместо вызова метода [CPropExchange::GetVersion](../mfc/reference/cpropexchange-class.md#getversion).

Чтобы сохранить небольшом пространстве в постоянном формате для **BOOL** свойство (и обеспечить ее совместим с форматом, полученных при `PX_Bool`), можно хранить свойство как **БАЙТОВ**, как показано ниже:

[!code-cpp[NVC_MFC_AxOpt#3](../mfc/codesnippet/cpp/optimizing-persistence-and-initialization_3.cpp)]

Обратите внимание, что в случае загрузки временной переменной и затем его значение назначается, а не приведение *m_boolProp* для **БАЙТОВ** ссылки. Метод приведения приведет только один байт *m_boolProp* изменяется, оставляя оставшиеся байты не инициализирована.

Для одного элемента управления, вы можете оптимизировать инициализации элемента управления путем переопределения [COleControl::OnResetState](../mfc/reference/colecontrol-class.md#onresetstate) следующим образом:

[!code-cpp[NVC_MFC_AxOpt#4](../mfc/codesnippet/cpp/optimizing-persistence-and-initialization_4.cpp)]

Несмотря на то что `Serialize` и `OnResetState` были переопределены, `DoPropExchange` функции должны быть остаются без изменений, так как он по-прежнему используется для сохранения в формате контейнера свойств. Важно поддерживать все три из этих функций, чтобы обеспечить согласованное управляет его свойства элемента управления, независимо от того, какие сохраняемости использует механизм контейнера.

## <a name="see-also"></a>См. также

[Элементы управления ActiveX MFC. Оптимизация](../mfc/mfc-activex-controls-optimization.md)
