---
description: 'Дополнительные сведения о: серверы: элементы сервера'
title: Серверы. Элементы сервера
ms.date: 11/04/2016
helpviewer_keywords:
- server items, implementing
- servers [MFC], server items
- architecture [MFC], server-item
- server items
- OLE server applications [MFC], server items
ms.assetid: 28ba81a1-726a-4728-a52d-68bc7efd5a3c
ms.openlocfilehash: e3fceb3abe89ca6cda432d60441a47fc0d452cfc
ms.sourcegitcommit: d6af41e42699628c3e2e6063ec7b03931a49a098
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2020
ms.locfileid: "97217319"
---
# <a name="servers-server-items"></a>Серверы. Элементы сервера

Когда контейнер запускает сервер, чтобы пользователь мог изменять внедренный или связанный объект OLE, серверное приложение создает «элемент сервера». Серверный элемент, являющийся объектом класса, производного от `COleServerItem` , предоставляет интерфейс между документом сервера и приложением-контейнером.

`COleServerItem`Класс определяет несколько переопределяемых функций члена, которые вызываются OLE, обычно в ответ на запросы из контейнера. Элементы сервера могут представлять часть документа сервера или весь документ. Когда элемент OLE внедряется в документ-контейнер, элемент сервера представляет весь серверный документ. Когда элемент OLE связан, элемент сервера может представлять часть документа сервера или весь документ в зависимости от того, является ли ссылка частью или целой.

В образце [HIERSVR](../overview/visual-cpp-samples.md) , например, класс серверного элемента, `CServerItem` имеет элемент, который является указателем на объект класса `CServerNode` . `CServerNode`Объект является узлом в документе приложения HIERSVR, который является деревом. Если `CServerNode` объект является корневым узлом, `CServerItem` объект представляет весь документ. Если `CServerNode` объект является дочерним узлом, `CServerItem` объект представляет часть документа. Пример этого взаимодействия см. в образце MFC OLE [HIERSVR](../overview/visual-cpp-samples.md) .

## <a name="implementing-server-items"></a><a name="_core_implementing_server_items"></a> Реализация элементов сервера

При использовании мастера приложений для создания начального кода для приложения все, что необходимо сделать для включения серверных элементов в начальный код, — выбрать один из параметров сервера на странице параметров OLE. При добавлении элементов сервера в существующее приложение выполните следующие действия.

#### <a name="to-implement-a-server-item"></a>Реализация элемента сервера

1. Создайте производный класс от класса `COleServerItem`.

1. В производном классе Переопределите `OnDraw` функцию члена.

   Платформа вызывает `OnDraw` для отрисовки элемента OLE в метафайл. Приложение контейнера использует этот метафайл для отрисовки элемента. Класс представления приложения также имеет `OnDraw` функцию-член, которая используется для отрисовки элемента, когда серверное приложение активно.

1. Реализуйте переопределение `OnGetEmbeddedItem` для класса серверного документа. Дополнительные сведения см. в статьях [серверы: реализация серверных документов](../mfc/servers-implementing-server-documents.md) и пример MFC OLE для примера [HIERSVR](../overview/visual-cpp-samples.md).

1. Реализуйте функцию-член класса серверного элемента `OnGetExtent` . Платформа вызывает эту функцию для получения размера элемента. Реализация по умолчанию не выполняет никаких действий.

## <a name="a-tip-for-server-item-architecture"></a><a name="_core_a_tip_for_server.2d.item_architecture"></a> Совет по архитектуре Server-Item

Как отмечалось при [реализации серверных элементов](#_core_implementing_server_items), серверные приложения должны иметь возможность отображать элементы как в представлении сервера, так и в метафайле, используемом приложением-контейнером. В архитектуре приложения библиотека Microsoft Foundation Class функция-член класса представления `OnDraw` отображает элемент при редактировании (см. класс [CView:: OnDraw](../mfc/reference/cview-class.md#ondraw) в *справочнике по библиотеке классов*). Элемент сервера `OnDraw` преобразует элемент в метафайл во всех остальных случаях (см. [COleServerItem:: OnDraw](../mfc/reference/coleserveritem-class.md#ondraw)).

Можно избежать дублирования кода путем написания вспомогательных функций в классе серверного документа и вызова их из `OnDraw` функций в представлениях и в классах серверных элементов. В примере MFC OLE для примера [HIERSVR](../overview/visual-cpp-samples.md) используется эта стратегия: функции `CServerView::OnDraw` и `CServerItem::OnDraw` оба вызова `CServerDoc::DrawTree` для отрисовки элемента.

Представление и элемент имеют `OnDraw` функции-члены, так как они рисуются в различных условиях. Представление должно учитывать такие факторы, как изменение масштаба, размер выделения и экстент, обрезка и элементы пользовательского интерфейса, такие как полосы прокрутки. Серверный элемент, с другой стороны, всегда рисует весь объект OLE.

Дополнительные сведения см. в разделе [CView:: OnDraw](../mfc/reference/cview-class.md#ondraw), [COleServerItem](../mfc/reference/coleserveritem-class.md), [COleServerItem:: OnDraw](../mfc/reference/coleserveritem-class.md#ondraw)и [колесервердок:: OnGetEmbeddedItem](../mfc/reference/coleserverdoc-class.md#ongetembeddeditem) в *справочнике по библиотеке классов*.

## <a name="see-also"></a>См. также раздел

[Серверы](../mfc/servers.md)
