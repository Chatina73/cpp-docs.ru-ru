---
title: Операции перетаскивания древовидного элемента управления
ms.date: 11/04/2016
helpviewer_keywords:
- CTreeCtrl class [MFC], drag and drop operations
- drag and drop [MFC], CTreeCtrl
- tree controls [MFC], drag and drop operations
ms.assetid: 3cf78b4c-4579-4fe1-9bc9-c5ab876e4af1
ms.openlocfilehash: 5d2c5aa511844a3d7cbe64d9a15f8ffb46046b29
ms.sourcegitcommit: fcb48824f9ca24b1f8bd37d647a4d592de1cc925
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/15/2019
ms.locfileid: "69510904"
---
# <a name="tree-control-drag-and-drop-operations"></a>Операции перетаскивания древовидного элемента управления

Элемент управления "дерево" ([CTreeCtrl](../mfc/reference/ctreectrl-class.md)) отправляет уведомление, когда пользователь начинает перетаскивать элемент. Элемент управления отправляет сообщение уведомления [TVN_BEGINDRAG](/windows/win32/Controls/tvn-begindrag) , когда пользователь начинает перетаскивать элемент, используя левую кнопку мыши, и сообщение уведомления [TVN_BEGINRDRAG](/windows/win32/Controls/tvn-beginrdrag) , когда пользователь начинает перетаскивать с правой кнопки мыши. Можно предотвратить отправку таких уведомлений элементом управления "дерево", предоставив этому элементу управления стиль TVS_DISABLEDRAGDROP.

Вы получаете изображение для показа во время операции перетаскивания путем вызова функции-члена [креатедрагимаже](../mfc/reference/ctreectrl-class.md#createdragimage) . Элемент управления "дерево" создает перетаскивание растрового изображения на основе метки перетаскиваемого элемента. Затем элемент управления "дерево" создает список изображений, добавляет к нему растровое изображение и возвращает указатель на объект [CImageList](../mfc/reference/cimagelist-class.md) .

Необходимо указать код, который будет перетаскивать элемент. Обычно это подразумевает использование возможностей перетаскивания функций списка изображений и обработки сообщений [WM_MOUSEMOVE](/windows/win32/inputdev/wm-mousemove) и [WM_LBUTTONUP](/windows/win32/inputdev/wm-lbuttonup) (или [WM_RBUTTONUP](/windows/win32/inputdev/wm-rbuttonup)), отправленных после начала операции перетаскивания. Дополнительные сведения о функциях списка изображений см. в разделе [CImageList](../mfc/reference/cimagelist-class.md) справочника по *MFC* и в [списках изображений](/windows/win32/controls/image-lists) в Windows SDK. Дополнительные сведения о перетаскивании элемента управления "дерево" см. в разделе [перетаскивание элемента древовидного представления](/windows/win32/Controls/tree-view-controls)также в Windows SDK.

Если элементы в элементе управления "дерево" являются целевыми объектами операции перетаскивания, необходимо знать, когда курсор мыши находится на целевом элементе. Вы можете узнать, вызвав функцию члена [HitTest](../mfc/reference/ctreectrl-class.md#hittest) . Вы указываете точку и целое число или адрес структуры [твхиттестинфо](/windows/win32/api/commctrl/ns-commctrl-tvhittestinfo) , которая содержит текущие координаты курсора мыши. При возврате функции целое число или структура содержит флаг, указывающий расположение курсора мыши относительно элемента управления "дерево". Если курсор находится над элементом в элементе управления "дерево", структура также содержит маркер элемента.

Можно указать, что элемент является целевым объектом операции перетаскивания, вызвав функцию-член [сетитем](../mfc/reference/ctreectrl-class.md#setitem) , чтобы установить в качестве состояния `TVIS_DROPHILITED` значение. Элемент с этим состоянием рисуется в стиле, который указывает на цель перетаскивания.

## <a name="see-also"></a>См. также

[Использование CTreeCtrl](../mfc/using-ctreectrl.md)<br/>
[Элементы управления](../mfc/controls-mfc.md)
