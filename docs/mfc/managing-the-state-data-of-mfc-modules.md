---
title: Управление данными состояния модулей MFC
ms.date: 11/19/2018
helpviewer_keywords:
- global state [MFC]
- data management [MFC], MFC modules
- window procedure entry points [MFC]
- exported interfaces and global state [MFC]
- module states [MFC], saving and restoring
- data management [MFC]
- MFC, managing state data
- multiple modules [MFC]
- module state restored [MFC]
ms.assetid: 81889c11-0101-4a66-ab3c-f81cf199e1bb
ms.openlocfilehash: 64888b8ab53ebd80f328e1efe79df6256f30f9b6
ms.sourcegitcommit: c21b05042debc97d14875e019ee9d698691ffc0b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/09/2020
ms.locfileid: "84622575"
---
# <a name="managing-the-state-data-of-mfc-modules"></a>Управление данными состояния модулей MFC

В этой статье обсуждаются данные о состоянии модулей MFC и объясняется, как это состояние обновляется, когда поток выполнения (код пути проходит через приложение при выполнении) вводит и оставляет модуль. Также обсуждается переключение состояний модулей с помощью макросов AFX_MANAGE_STATE и METHOD_PROLOGUE.

> [!NOTE]
> Термин "модуль" здесь ссылается на исполняемую программу или на библиотеку DLL (или набор библиотек DLL), которая работает независимо от остальной части приложения, но использует общую копию библиотеки DLL MFC. Элемент управления ActiveX — типичный пример модуля.

Как показано на следующем рисунке, в MFC есть данные о состоянии для каждого модуля, используемого в приложении. Примеры этих данных включают в себя дескрипторы экземпляров Windows (используемые для загрузки ресурсов), указатели на текущие `CWinApp` `CWinThread` объекты приложения, счетчики ссылок на модули OLE и различные карты, которые поддерживают соединения между дескрипторами объектов Windows и соответствующими экземплярами объектов MFC. Однако если приложение использует несколько модулей, данные о состоянии каждого модуля не имеют уровня приложения. Вместо этого каждый модуль имеет собственную закрытую копию данных о состоянии MFC.

![Данные о состоянии одного модуля &#40;приложение&#41;](../mfc/media/vc387n1.gif "Данные о состоянии одного модуля &#40;приложение&#41;") <br/>
Данные о состоянии одного модуля (приложение)

Данные о состоянии модуля содержатся в структуре и всегда доступны через указатель на эту структуру. Когда поток выполнения входит в определенный модуль, как показано на следующем рисунке, состояние этого модуля должно быть "Current" или "эффективное" состояние. Таким образом, каждый объект потока имеет указатель на структуру действующего состояния этого приложения. Постоянно обновлять этот указатель очень важно для управления глобальным состоянием приложения и поддержания целостности состояния каждого модуля. Неправильное управление глобальным состоянием может привести к непредсказуемому поведению приложения.

![Данные состояния для нескольких модулей](../mfc/media/vc387n2.gif "Данные состояния для нескольких модулей") <br/>
Данные о состоянии нескольких модулей

Иными словами, каждый модуль отвечает за правильное переключение состояния модуля на все точки входа. Точка входа — это любое место, где поток выполнения может ввести код модуля. Точки входа включают:

- [Экспортированные функции в библиотеке DLL](exported-dll-function-entry-points.md)

- [Функции-члены интерфейсов COM](com-interface-entry-points.md)

- [Процедуры окна](window-procedure-entry-points.md)

## <a name="see-also"></a>См. также раздел

[Общие разделы по MFC](general-mfc-topics.md)
