---
title: Управление данными состояния модулей MFC
ms.date: 11/19/2018
helpviewer_keywords:
- global state [MFC]
- data management [MFC], MFC modules
- window procedure entry points [MFC]
- exported interfaces and global state [MFC]
- module states [MFC], saving and restoring
- data management [MFC]
- MFC, managing state data
- multiple modules [MFC]
- module state restored [MFC]
ms.assetid: 81889c11-0101-4a66-ab3c-f81cf199e1bb
ms.openlocfilehash: c8e79f54ed586201a7d82327662643a9a241b8f4
ms.sourcegitcommit: c123cc76bb2b6c5cde6f4c425ece420ac733bf70
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81357267"
---
# <a name="managing-the-state-data-of-mfc-modules"></a>Управление данными состояния модулей MFC

В этой статье рассматриваются данные о состоянии модулей MFC и то, как обновляется это состояние при входе в него и покидает сяп. Обсуждается также коммутационные состояния модуля с AFX_MANAGE_STATE и METHOD_PROLOGUE макросов.

> [!NOTE]
> Термин "модуль" здесь относится к исполняемой программе, или к DLL (или набор DLLs), которые работают независимо от остальной части приложения, но использует общую копию MFC DLL. Контроль ActiveX является типичным примером модуля.

Как показано на следующем рисунке, MFC имеет данные состояния для каждого модуля, используемого в приложении. Примеры этих данных включают ручки экземпляров Windows (используется `CWinApp` `CWinThread` для загрузки ресурсов), указатели на ток и объекты приложения, подсчет ы ссылки на модуль OLE и различные карты, которые поддерживают соединения между ручками объектов Windows и соответствующими экземплярами объектов MFC. Однако, когда приложение использует несколько модулей, данные состояния каждого модуля не являются широкими приложениями. Скорее, каждый модуль имеет свою собственную частную копию государственных данных МФЦ.

![Государственные данные единого модуля &#40;приложения&#41;](../mfc/media/vc387n1.gif "Государственные данные единого модуля &#40;&#41;") <br/>
Данные о состоянии единого модуля (приложение)

Данные состояния модуля содержатся в структуре и всегда доступны через указатель на эту структуру. Когда поток выполнения входит в определенный модуль, как показано на следующем рисунке, состояние этого модуля должно быть "текущим" или "эффективным" состоянием. Таким образом, каждый объект потока имеет указатель на эффективную структуру состояния этого приложения. Поддержание обновления этого указателя в любое время имеет жизненно важное значение для управления глобальным состоянием приложения и поддержания целостности состояния каждого модуля. Неправильное управление глобальным состоянием может привести к непредсказуемому поведению приложений.

![Данные состояния для нескольких модулей](../mfc/media/vc387n2.gif "Данные состояния для нескольких модулей") <br/>
Государственные данные нескольких модулей

Другими словами, каждый модуль отвечает за правильное переключение между состояниями модуля во всех точках входа. "Точка входа" - это любое место, где поток выполнения может ввести код модуля. Точки входа включают в себя:

- [Экспортированные функции в DLL](../mfc/exported-dll-function-entry-points.md)

- [Функции членов интерфейсов COM](../mfc/com-interface-entry-points.md)

- [Процедуры окна](../mfc/window-procedure-entry-points.md)

## <a name="see-also"></a>См. также раздел

[Общие темы МФЦ](../mfc/general-mfc-topics.md)
