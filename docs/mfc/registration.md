---
description: 'Дополнительные сведения: регистрация'
title: Регистрация
ms.date: 11/04/2016
helpviewer_keywords:
- servers [MFC], initializing
- initializing servers [MFC]
- OLE, registration
- installing servers [MFC]
- registry [MFC], OLE item database
- registration databases [MFC]
- servers [MFC], installing
- OLE server applications [MFC], registering servers
ms.assetid: 991d5684-72c1-4f9e-a09a-9184ed12bbb9
ms.openlocfilehash: 8254f4b1ab8a005623650794adc8be0bd06cfdff
ms.sourcegitcommit: d6af41e42699628c3e2e6063ec7b03931a49a098
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2020
ms.locfileid: "97218125"
---
# <a name="registration"></a>Регистрация

Когда пользователь хочет вставить OLE-элемент в приложение, OLE представляет список типов объектов для выбора. OLE получает этот список из системной базы данных регистрации, который содержит сведения, предоставленные всеми серверными приложениями. Когда сервер регистрирует себя, записи, которые он помещает в базу данных регистрации системы (реестр), описывают каждый предоставляемый им тип объекта, расширения файлов и путь к нему, помимо других сведений.

Платформа и библиотеки динамической компоновки (DLL) системы OLE используют этот реестр для определения типов объектов OLE, доступных в системе. Системные библиотеки OLE также используют этот реестр для определения способа запуска серверного приложения при активации связанного или внедренного объекта.

В этой статье описывается, что необходимо сделать каждому серверному приложению при его установке и при каждом запуске.

Подробные сведения о системной базе данных регистрации и формате REG, используемых для ее обновления, см. в *справочнике по OLE для программиста*.

## <a name="server-installation"></a><a name="_core_server_installation"></a> Установка сервера

При первой установке серверного приложения необходимо зарегистрировать все типы объектов OLE, которые он поддерживает. Кроме того, сервер может обновлять системную базу данных регистрации каждый раз, когда она выполняется в качестве автономного приложения. Это позволит сохранить базу данных регистрации в актуальном состоянии при перемещении исполняемого файла сервера.

> [!NOTE]
> Приложения MFC, созданные мастером приложений, автоматически регистрируются при запуске как автономные приложения.

Если вы хотите зарегистрировать приложение во время установки, используйте программу RegEdit.exe. Если вы включили программу установки в приложение, запустите программу установки "regedit/S *имя_приложения*. reg". (Флаг/S указывает на автоматическую операцию, то есть не отображает диалоговое окно, сообщающее об успешном завершении команды.) В противном случае попросите пользователя запустить программу Regedit вручную.

> [!NOTE]
> REG файл, созданный мастером приложений, не содержит полный путь к исполняемому файлу. Программа установки должна либо изменить REG файл, включив в нее полный путь к исполняемому файлу, либо изменить переменную среды PATH, включив в нее каталог установки.

Программа regedit выполняет слияние содержимого текстового файла с расширением REG в базу данных регистрации. Чтобы проверить базу данных или восстановить ее, используйте редактор реестра. Следите за тем, чтобы не удалять важные записи OLE.

## <a name="server-initialization"></a><a name="_core_server_initialization"></a> Инициализация сервера

При создании серверного приложения с помощью мастера приложений мастер автоматически выполняет все задачи инициализации. В этом разделе описываются действия, которые необходимо выполнить при написании серверного приложения вручную.

Если серверное приложение запускается приложением-контейнером, системные библиотеки OLE (DLL) добавляют параметр "параметром/Embedding" в командную строку сервера. Поведение серверного приложения зависит от того, было ли оно запущено контейнером, поэтому первое, что должно делать приложение при запуске, — проверить параметр "параметром/Embedding" или "-внедрить" в командной строке. Если этот параметр существует, загрузите другой набор ресурсов, показывающих, что сервер либо находится в активном состоянии, либо полностью открыт. Дополнительные сведения см. в разделе [меню и ресурсы: дополнения сервера](../mfc/menus-and-resources-server-additions.md).

Серверное приложение также должно вызывать его `CWinApp::RunEmbedded` функцию для анализа командной строки. Если он возвращает ненулевое значение, приложение не должно отображать его окно, так как оно было запущено из приложения-контейнера, а не как автономное приложение. Эта функция обновляет запись сервера в системной базе данных регистрации и вызывает `RegisterAll` функцию члена, выполняя регистрацию экземпляра.

При запуске серверного приложения необходимо убедиться, что оно может выполнять регистрацию экземпляра. При регистрации экземпляра сообщает о системных DLL-библиотеках OLE о том, что сервер активен и готов к получению запросов из контейнеров. Она не добавляет запись в базу данных регистрации. Выполните регистрацию экземпляра сервера, вызвав `ConnectTemplate` функцию члена, определенную `COleTemplateServer` . При этом объект подключается `CDocTemplate` к `COleTemplateServer` объекту.

`ConnectTemplate`Функция принимает три параметра: *CLSID* сервера, указатель на `CDocTemplate` объект и флаг, указывающий, поддерживает ли сервер несколько экземпляров. Минисервер должен поддерживать несколько экземпляров, то есть может быть возможным одновременное выполнение нескольких экземпляров сервера, по одному для каждого контейнера. Следовательно, перед запуском минисервер необходимо передать **значение true** для этого флага.

Если вы пишете минисервер, по определению он всегда будет запускаться контейнером. Для проверки параметра "параметром/Embedding" следует по-прежнему анализировать командную строку. Отсутствие этого параметра в командной строке означает, что пользователь попытался запустить минисервер как автономное приложение. В этом случае Зарегистрируйте сервер в системной базе данных регистрации, а затем отобразите окно сообщения, информирующее пользователя о запуске минисервер из приложения-контейнера.

## <a name="see-also"></a>См. также раздел

[OLE](../mfc/ole-in-mfc.md)<br/>
[Серверы](../mfc/servers.md)<br/>
[CWinApp:: Рунаутоматед](../mfc/reference/cwinapp-class.md#runautomated)<br/>
[CWinApp:: Рунембеддед](../mfc/reference/cwinapp-class.md#runembedded)<br/>
[Класс COleTemplateServer](../mfc/reference/coletemplateserver-class.md)
