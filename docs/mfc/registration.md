---
title: Регистрация
ms.date: 11/04/2016
helpviewer_keywords:
- servers [MFC], initializing
- initializing servers [MFC]
- OLE, registration
- installing servers [MFC]
- registry [MFC], OLE item database
- registration databases [MFC]
- servers [MFC], installing
- OLE server applications [MFC], registering servers
ms.assetid: 991d5684-72c1-4f9e-a09a-9184ed12bbb9
ms.openlocfilehash: 82411e53620e92eff3484f7d3f7955030fd439ac
ms.sourcegitcommit: c123cc76bb2b6c5cde6f4c425ece420ac733bf70
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81372840"
---
# <a name="registration"></a>Регистрация

Когда пользователь хочет вставить элемент OLE в приложение, OLE представляет список типов объектов на выбор. OLE получает этот список из базы данных регистрации системы, которая содержит информацию, предоставляемую всеми серверными приложениями. Когда сервер регистрируется, записи, которые он помещает в базу данных регистрации системы (реестр), описывают каждый тип объекта, который он поставляет, расширение файлов и путь к себе, среди другой информации.

Рамки и библиотеки динамической связи системы OLE (DLL) используют этот реестр для определения того, какие типы элементов OLE доступны в системе. DLL системы OLE также используют этот реестр, чтобы определить, как запустить серверное приложение при активации связанного или встроенного объекта.

В этой статье описывается, что каждое приложение сервера должно делать при его установке и каждый раз, когда оно выполняется.

Подробную информацию о базе данных регистрации системы и формате *OLE Programmer's Reference*файлов .reg, используемых для ее обновления, см.

## <a name="server-installation"></a><a name="_core_server_installation"></a>Установка сервера

При первой установке серверного приложения следует зарегистрировать все типы элементов OLE, которые оно поддерживает. Вы также можете иметь сервер обновить базу данных регистрации системы каждый раз, когда он выполняет сяпок в качестве автономного приложения. Это позволяет обновлять базу данных регистрации, если выполняется файл сервера.

> [!NOTE]
> Приложения MFC, генерируемые мастером приложения, автоматически регистрируются при запуске в качестве автономных приложений.

Если вы хотите зарегистрировать заявку во время установки, воспользуйтесь программой RegEdit.exe. Если вы включили программу настройки с вашим приложением, запустите программу настройки "RegEdit /S *appname*.reg". (Флаг /S указывает на бесшумную операцию, то есть не отображает диалоговую коробку, сообщая об успешном завершении команды.) В противном случае поручить пользователю запускать RegEdit вручную.

> [!NOTE]
> Файл .reg, созданный мастером приложения, не включает полный путь для исполняемого. Программа установки должна либо изменить файл .reg, чтобы включить полный путь к исполняемой, либо изменить переменную среды PATH, включив каталог установки.

RegEdit объединяет содержимое текстового файла .reg в базу данных регистрации. Чтобы проверить базу данных или отремонтировать ее, используйте редактор реестра. Позаботьтесь о том, чтобы избежать удаляния основных записей OLE.

## <a name="server-initialization"></a><a name="_core_server_initialization"></a>Инициализация сервера

При создании серверного приложения с помощью мастера приложения мастер автоматически выполняет все задачи инициализации. В этом разделе описывается, что вы должны делать, если вы пишете серверное приложение вручную.

Когда серверное приложение запускается контейнерным приложением, DLL системы OLE добавляет опцию «/встраивание» в командную строку сервера. Поведение серверного приложения отличается в зависимости от того, был ли он запущен контейнером, поэтому первое, что приложение должно сделать, когда оно начинает выполнение, это проверка параметра "/встраивание" или "-встраивание" в командную строку. Если этот коммутатор существует, загрузите другой набор ресурсов, которые показывают, что сервер либо на месте активен, либо полностью открыт. Для получения дополнительной [информации см.](../mfc/menus-and-resources-server-additions.md)

Приложение сервера также `CWinApp::RunEmbedded` должно вызывать свою функцию для разбора командной строки. Если приложение возвращает ненулевое значение, оно не должно отображать свое окно, поскольку оно было запущено из контейнерного приложения, а не как отдельное приложение. Эта функция обновляет вход сервера в базу данных регистрации системы и вызывает функцию `RegisterAll` участника для вас, выполняя регистрацию экземпляра.

При запуске серверного приложения необходимо убедиться, что оно может выполнять регистрацию экземпляров. Регистрация экземпляров информирует DLL системы OLE о том, что сервер активен и готов к приему запросов из контейнеров. Он не добавляет запись в базу данных регистрации. Выполните регистрацию экземпляра `ConnectTemplate` сервера, `COleTemplateServer`позвонив в функцию участника, определяемую . Это соединяет `CDocTemplate` объект с `COleTemplateServer` объектом.

Функция `ConnectTemplate` занимает три параметра: *CLSID*сервера, указатель `CDocTemplate` на объект и флаг, указывающий, поддерживает ли сервер несколько экземпляров. Минисервер должен быть в состоянии поддерживать несколько экземпляров, то есть, он должен быть возможным для нескольких экземпляров сервера для запуска одновременно, по одному для каждого контейнера. Следовательно, пройти **TRUE** для этого флага при запуске miniserver.

Если вы пишете мини-сервер, по определению он всегда будет запущен контейнером. Вы должны все еще разобрать командную строку, чтобы проверить опцию "/Встраивание". Отсутствие этой опции на командной строке означает, что пользователь пытался запустить мини-сервер в качестве автономного приложения. В этом случае зарегистрируйте сервер в базе данных регистрации системы, а затем отобразите окно сообщений, информирующее пользователя о запуске минисервера из контейнерного приложения.

## <a name="see-also"></a>См. также раздел

[OLE](../mfc/ole-in-mfc.md)<br/>
[Серверы](../mfc/servers.md)<br/>
[CWinApp::RunAutomated](../mfc/reference/cwinapp-class.md#runautomated)<br/>
[CWinApp::RunEmbedded](../mfc/reference/cwinapp-class.md#runembedded)<br/>
[Класс COleTemplateServer](../mfc/reference/coletemplateserver-class.md)
