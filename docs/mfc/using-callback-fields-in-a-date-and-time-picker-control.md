---
title: Использование полей обратного вызова элемента выбора даты и времени
ms.date: 11/04/2016
f1_keywords:
- DTN_FORMATQUERY
- DTN_FORMAT
helpviewer_keywords:
- DateTimePicker control [MFC], callback fields
- callback fields in CDateTimeCtrl class [MFC]
- CDateTimeCtrl class [MFC], callback fields
- CDateTimeCtrl class [MFC], handling DTN_FORMAT and DTN_FORMATQ
- DTN_FORMATQUERY notification [MFC]
- DTN_FORMAT notification [MFC]
- DateTimePicker control [MFC]
ms.assetid: 404f4ba9-cba7-4718-9faa-bc6b274a723f
ms.openlocfilehash: 50350e51b6747d8c010db9d0dcaa9dff2e56e1f3
ms.sourcegitcommit: c123cc76bb2b6c5cde6f4c425ece420ac733bf70
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81366556"
---
# <a name="using-callback-fields-in-a-date-and-time-picker-control"></a>Использование полей обратного вызова элемента выбора даты и времени

В дополнение к символам стандартного формата, определяющим поля выбора даты и времени, можно настроить выход, указав определенные части строки пользовательского формата в виде полей обратного вызова. Чтобы объявить поле обратного вызова, включите один или несколько символов "X" (ASCII Code 88) в любом месте в теле строки формата. Например, следующая строка "Сегодня: 'yy'/'MM'/'dd' (День 'X')'причиняет контроль насборщика даты и времени для отображения текущего значения в течение года, за которым следует месяц, дата и, наконец, день года.

> [!NOTE]
> Количество X в поле обратного вызова не соответствует количеству отображаемых символов.

Можно различать несколько полей обратного вызова в пользовательской строке, повторяя символ "X". Таким образом, строка формата "XXdddMDd", 'yyyXXX" содержит два уникальных поля обратного откиды: "XX" и "XXX".

> [!NOTE]
> Поля обратного вызова рассматриваются как допустимые поля, поэтому ваше приложение должно быть готово к обработке сообщений DTN_WMKEYDOWN уведомлений.

Реализация полей обратного вызова в управлении сборщиком дат и времени состоит из трех частей:

- Инициализация строки пользовательского формата

- Обработка уведомления DTN_FORMATQUERY

- Обработка уведомления DTN_FORMAT

## <a name="initializing-the-custom-format-string"></a>Инициализация строки пользовательского формата

Инициализовать пользовательскую `CDateTimeCtrl::SetFormat`строку с вызовом. Для получения дополнительной [информации см.](../mfc/using-custom-format-strings-in-a-date-and-time-picker-control.md) Общее место для установки строки `OnInitDialog` пользовательского формата находится `OnInitialUpdate` в функции вашего содержащего класса диалога или функции вашего содержащего класса представления.

## <a name="handling-the-dtn_formatquery-notification"></a>Обработка уведомления о DTN_FORMATQUERY

Когда элемент управления разбирает строку формата и сталкивается с полем обратного вызова, приложение отправляет DTN_FORMAT и DTN_FORMATQUERY сообщений уведомлений. Строка поля обратного вызова включена в уведомления, чтобы вы могли определить, какое поле обратного вызова запрашивается.

Уведомление DTN_FORMATQUERY отправляется для получения максимально допустимого размера в пикселях строки, которая будет отображаться в текущем поле обратного вызова.

Чтобы правильно рассчитать это значение, необходимо рассчитать высоту и ширину строки, чтобы заменить поле, используя шрифт дисплея элемента управления. Фактический расчет строки легко достигается с помощью вызова функции [GetTextExtentPoint32](/windows/win32/api/wingdi/nf-wingdi-gettextextentpoint32w) Win32. Как только размер будет определен, передайте значение обратно в приложение и выйдите из функции обработчика.

Следующим примером является один из методов предоставления размера строки обратного вызова:

[!code-cpp[NVC_MFCControlLadenDialog#8](../mfc/codesnippet/cpp/using-callback-fields-in-a-date-and-time-picker-control_1.cpp)]

После расчета размера текущего поля обратного вызова необходимо предоставить значение для поля. Это делается в обработчике для уведомления DTN_FORMAT.

## <a name="handling-the-dtn_format-notification"></a>Обработка уведомления DTN_FORMAT

Уведомление DTN_FORMAT используется приложением для запроса строки символов, которая будет заменена. Следующий пример демонстрирует один возможный метод:

[!code-cpp[NVC_MFCControlLadenDialog#9](../mfc/codesnippet/cpp/using-callback-fields-in-a-date-and-time-picker-control_2.cpp)]

> [!NOTE]
> Указатель на структуру **NMDATETIMEFORMAT** находится путем отбрасывая первый параметр обработчика уведомлений в соответствующий тип.

## <a name="see-also"></a>См. также раздел

[Использование CDateTimeCtrl](../mfc/using-cdatetimectrl.md)<br/>
[Элементы управления](../mfc/controls-mfc.md)
