---
description: Дополнительные сведения об использовании полей обратного вызова в элементе управления "Выбор даты и времени"
title: Использование полей обратного вызова элемента выбора даты и времени
ms.date: 11/04/2016
f1_keywords:
- DTN_FORMATQUERY
- DTN_FORMAT
helpviewer_keywords:
- DateTimePicker control [MFC], callback fields
- callback fields in CDateTimeCtrl class [MFC]
- CDateTimeCtrl class [MFC], callback fields
- CDateTimeCtrl class [MFC], handling DTN_FORMAT and DTN_FORMATQ
- DTN_FORMATQUERY notification [MFC]
- DTN_FORMAT notification [MFC]
- DateTimePicker control [MFC]
ms.assetid: 404f4ba9-cba7-4718-9faa-bc6b274a723f
ms.openlocfilehash: 3ff0ae2af8e71a53cceff4d5d8df652f701b1ef1
ms.sourcegitcommit: d6af41e42699628c3e2e6063ec7b03931a49a098
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2020
ms.locfileid: "97202630"
---
# <a name="using-callback-fields-in-a-date-and-time-picker-control"></a>Использование полей обратного вызова элемента выбора даты и времени

В дополнение к стандартным символам формата, определяющим поля выбора даты и времени, можно настроить выходные данные, указав определенные части строки настраиваемого формата в качестве полей обратного вызова. Чтобы объявить поле обратного вызова, включите один или несколько символов "X" (код ASCII 88) в тексте строки формата. Например, следующая строка "" уже сегодня: "yy"/"MM"/"DD" (день "X") "" заставляет элемент управления выбора даты и времени отображать текущее значение в виде года, за которым следует месяц, Дата и, наконец, день года.

> [!NOTE]
> Число X в поле обратного вызова не соответствует числу отображаемых символов.

Можно различать несколько полей обратного вызова в пользовательской строке, повторив символ "X". Таким словами, строка формата "Ксксддддмммдд", "Ииикскскс" содержит два уникальных поля обратного вызова: "XX" и "XXX".

> [!NOTE]
> Поля обратного вызова рассматриваются как допустимые поля, поэтому приложение должно быть подготовлено к обработке DTN_WMKEYDOWN уведомлений.

Реализация полей обратного вызова в элементе управления выбора даты и времени состоит из трех частей:

- Инициализация строки настраиваемого формата

- Обработка уведомления DTN_FORMATQUERY

- Обработка уведомления DTN_FORMAT

## <a name="initializing-the-custom-format-string"></a>Инициализация строки настраиваемого формата

Инициализируйте пользовательскую строку с помощью вызова `CDateTimeCtrl::SetFormat` . Дополнительные сведения см. [в разделе Использование строк настраиваемого формата в элементе управления средства выбора даты и времени](../mfc/using-custom-format-strings-in-a-date-and-time-picker-control.md). Обычно для задания строки настраиваемого формата используется `OnInitDialog` функция содержащего его класса диалогового окна или `OnInitialUpdate` функции содержащего класса представления.

## <a name="handling-the-dtn_formatquery-notification"></a>Обработка уведомления DTN_FORMATQUERY

Когда элемент управления анализирует строку формата и встречает поле обратного вызова, приложение отправляет DTN_FORMAT и DTN_FORMATQUERY уведомления. Строка поля обратного вызова включается вместе с уведомлениями, что позволяет определить, какое поле обратного вызова запрашивается.

Для получения максимально допустимого размера в пикселях строки, которая будет отображаться в текущем поле обратного вызова, отправляется уведомление DTN_FORMATQUERY.

Чтобы правильно вычислить это значение, необходимо вычислить высоту и ширину строки, которую нужно заменить на поле, используя отображаемый шрифт элемента управления. Фактическое вычисление строки легко достигается с помощью вызова функции [GetTextExtentPoint32](/windows/win32/api/wingdi/nf-wingdi-gettextextentpoint32w) Win32. После определения размера передайте значение обратно в приложение и завершите работу функции обработчика.

Следующий пример является одним из способов предоставления размера строки обратного вызова:

[!code-cpp[NVC_MFCControlLadenDialog#8](../mfc/codesnippet/cpp/using-callback-fields-in-a-date-and-time-picker-control_1.cpp)]

После вычисления размера текущего поля обратного вызова необходимо указать значение для поля. Это делается в обработчике для уведомления DTN_FORMAT.

## <a name="handling-the-dtn_format-notification"></a>Обработка уведомления DTN_FORMAT

DTN_FORMAT уведомление используется приложением для запроса строки символов, которая будет заменена. В следующем примере показан один из возможных методов.

[!code-cpp[NVC_MFCControlLadenDialog#9](../mfc/codesnippet/cpp/using-callback-fields-in-a-date-and-time-picker-control_2.cpp)]

> [!NOTE]
> Указатель на структуру **нмдатетимеформат** можно найти, приведя первый параметр обработчика уведомлений к правильному типу.

## <a name="see-also"></a>См. также раздел

[Использование CDateTimeCtrl](../mfc/using-cdatetimectrl.md)<br/>
[Элементы управления](../mfc/controls-mfc.md)
