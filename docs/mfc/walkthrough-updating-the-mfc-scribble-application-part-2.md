---
description: Дополнительные сведения см. в разделе Пошаговое руководство. Обновление приложения MFC Scribble (часть 2)
title: Пошаговое руководство. Обновление приложения MFC Scribble (часть 2)
ms.date: 04/25/2019
helpviewer_keywords:
- walkthroughs [MFC]
ms.assetid: 602df5c2-17d4-4cd9-8cf6-dff652c4cae5
ms.openlocfilehash: 2520ac8fc1c66a2fc388738d22f4851547b6d03b
ms.sourcegitcommit: d6af41e42699628c3e2e6063ec7b03931a49a098
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2020
ms.locfileid: "97142965"
---
# <a name="walkthrough-updating-the-mfc-scribble-application-part-2"></a>Пошаговое руководство. Обновление приложения MFC Scribble (часть 2)

В [части 1](../mfc/walkthrough-updating-the-mfc-scribble-application-part-1.md) этого пошагового руководства показано, как добавить ленту Office Fluent в классическое приложение Scribble. В этой части показано, как добавить панели ленты и элементы управления, которые пользователи могут использовать вместо меню и команд.

## <a name="prerequisites"></a>Предварительные требования

[Примеры кода на Visual C++](../overview/visual-cpp-samples.md)

## <a name="sections"></a><a name="top"></a> Священ

Эта часть пошагового руководства содержит следующие разделы.

- [Добавление новых панелей на ленту](#addnewpanel)

- [Добавление панели справки на ленту](#addhelppanel)

- [Добавление панели пера на ленту](#addpenpanel)

- [Добавление кнопки цвета на ленту](#addcolorbutton)

- [Добавление элемента Color в класс Document](#addcolormember)

- [Инициализация перьев и сохранение настроек](#initpensave)

## <a name="adding-new-panels-to-the-ribbon"></a><a name="addnewpanel"></a> Добавление новых панелей на ленту

В этих шагах показано, как добавить панель **представлений** , содержащую два флажка, которые управляют видимостью панели инструментов и строки состояния, а также панель **окна** , которая содержит вертикальную разворачивающуюся кнопку, управляющую созданием и размещением окон многодокументного интерфейса (MDI).

### <a name="to-add-a-view-panel-and-window-panel-to-the-ribbon-bar"></a>Добавление панели «представление» и панели окна в панель ленты

1. Создайте панель с именем `View` , которая содержит два флажка, которые переключают строку состояния и панель инструментов.

   1. Перетащите **панель** из **области элементов** в категорию **Главная** . Затем перетащите на панель два **флажка** .

   1. Щелкните панель, чтобы изменить ее свойства. Измените **заголовок** на `View` .

   1. Установите первый флажок, чтобы изменить его свойства. Измените **идентификатор** на `ID_VIEW_TOOLBAR` и задайте для **заголовка** значение `Toolbar` .

   1. Щелкните второй флажок, чтобы изменить его свойства. Измените **идентификатор** на `ID_VIEW_STATUS_BAR` и задайте для **заголовка** значение `Status Bar` .

1. Создайте панель с именем с `Window` разворачивающейся кнопкой. Когда пользователь нажимает кнопку разделения, в контекстном меню отображаются три команды, уже определенные в приложении Scribble.

   1. Перетащите **панель** из **области элементов** в категорию **Главная** . Затем перетащите **кнопку** на панель.

   1. Щелкните панель, чтобы изменить ее свойства. Измените **заголовок** на `Window` .

   1. Нажмите кнопку. Измените **заголовок** на `Windows` , **ключи** в `w` , **индекс крупного изображения** в `1` и **режим разделения** на `False` . Затем нажмите кнопку с многоточием (**...**) рядом с **элементами меню** , чтобы открыть диалоговое окно **Редактор элементов** .

   1. Нажмите кнопку **Добавить** три раза, чтобы добавить три кнопки.

   1. Нажмите первую кнопку, а затем измените **заголовок** на `New Window` , а **идентификатор** — на `ID_WINDOW_NEW` .

   1. Нажмите вторую кнопку, а затем измените **заголовок** на `Cascade` , а **идентификатор** — на `ID_WINDOW_CASCADE` .

   1. Нажмите третью кнопку, а затем измените **заголовок** на `Tile` , а **идентификатор** — на `ID_WINDOW_TILE_HORZ` .

1. Сохраните изменения, а затем выполните сборку и запуск приложения. Должны отобразиться панели **представления** и **окна** . Нажмите кнопки, чтобы убедиться, что они работают правильно.

## <a name="adding-a-help-panel-to-the-ribbon"></a><a name="addhelppanel"></a> Добавление панели справки на ленту

Теперь можно назначить два элемента меню, которые определены в приложении Scribble, на кнопки ленты, которые называются **разделами справки** и **Scribble**. Кнопки добавляются на новую панель с именем **Help**.

### <a name="to-add-a-help-panel"></a>Добавление панели справки

1. Перетащите **панель** из **области элементов** в категорию **Главная** . Затем перетащите на панель две **кнопки** .

1. Щелкните панель, чтобы изменить ее свойства. Измените **заголовок** на `Help` .

1. Нажмите первую кнопку. Измените **заголовок** на `Help Topics` , а **ID** на `ID_HELP_FINDER` .

1. Нажмите вторую кнопку. Измените **заголовок** на `About Scribble...` , а **ID** на `ID_APP_ABOUT` .

1. Сохраните изменения, а затем выполните сборку и запуск приложения. Должна отобразиться панель **справки** , содержащая две кнопки на ленте.

   > [!IMPORTANT]
   > При нажатии кнопки « **разделы справки** » Приложение Scribble открывает сжатый файл справки HTML (CHM) с именем *your_project_name*. chm. Следовательно, если проект не называется Scribble, необходимо переименовать файл справки в имя проекта.

## <a name="adding-a-pen-panel-to-the-ribbon"></a><a name="addpenpanel"></a> Добавление панели пера на ленту

Теперь добавьте панель, которая будет отображать кнопки, управляющие толщиной и цветом пера. Эта панель содержит флажки, которые переключаются между толстыми и тонкими перьями. Его функциональность похожа на **жирный** пункт меню в приложении Scribble.

Исходное приложение Scribble позволяет пользователю выбрать ширину пера в диалоговом окне, которое появляется, когда пользователь щелкает **ширину пера** в меню. Поскольку панель ленты имеет достаточно места для новых элементов управления, можно заменить это диалоговое окно, используя два поля со списком на ленте. Одно поле со списком корректирует ширину тонкого пера, а другое поле со списком регулирует ширину толстого пера.

#### <a name="to-add-a-pen-panel-and-combo-boxes-to-the-ribbon"></a>Добавление на ленту панели пера и полей со списком

1. Перетащите **панель** из **области элементов** в категорию **Главная** . Затем перетащите **флажок** и два **поля со списком** на панель.

1. Щелкните панель, чтобы изменить ее свойства. Измените **заголовок** на `Pen` .

1. Установите флажок. Измените **заголовок** на `Use Thick` , а **ID** на `ID_PEN_THICK_OR_THIN` .

1. Щелкните первое поле со списком. Измените **заголовок** на `Thin Pen` , **ID** на `ID_PEN_THIN_WIDTH` , **введите** , `Drop List` **данные** в `1;2;3;4;5;6;7;8;9;` и **текст** на `2` .

1. Щелкните второе поле со списком. Измените **заголовок** на `Thick Pen` , **ID** на `ID_PEN_THICK_WIDTH` , **введите** , `Drop List` **данные** в `5;6;7;8;9;10;11;12;13;14;15;16;17;18;19;20;` и **текст** на `5` .

1. Новые поля со списками не соответствуют ни одному из существующих элементов меню, поэтому для каждого параметра пера необходимо создать пункт меню.

   1. В окне **представление ресурсов** Откройте ресурс меню **IDR_SCRIBBTYPE** .

   1. Щелкните **перо** , чтобы открыть меню "перо". Затем щелкните **Введите здесь тип** и введите `Thi&n Pen` .

   1. Щелкните правой кнопкой мыши введенный текст, чтобы открыть окно « **Свойства** », а затем измените значение свойства ID на `ID_PEN_THIN_WIDTH` .

   1. Создайте обработчик событий для каждого пункта меню пера. Щелкните правой кнопкой мыши элемент меню **эт&n** , который был создан, и выберите пункт **Добавить обработчик событий**. Откроется **Мастер обработчика событий** .

   1. В окне мастера в **списке класс** выберите **кскриббледок** и нажмите кнопку **Добавить и изменить**. Команда создает обработчик событий с именем `CScribbleDoc::OnPenThinWidth` .

   1. Добавьте в раздел `CScribbleDoc::OnPenThinWidth` следующий код.

        ```cpp
        // Get a pointer to the ribbon bar
        CMFCRibbonBar* pRibbon = ((CMDIFrameWndEx*) AfxGetMainWnd())->GetRibbonBar();
        ASSERT_VALID(pRibbon);

        // Get a pointer to the Thin Width combo box
        CMFCRibbonComboBox* pThinComboBox = DYNAMIC_DOWNCAST(
        CMFCRibbonComboBox, pRibbon->FindByID(ID_PEN_THIN_WIDTH));

        //Get the selected value
        int nCurSel = pThinComboBox->GetCurSel();
        if (nCurSel>= 0)
        {
            m_nThinWidth = atoi(CStringA(pThinComboBox->GetItem(nCurSel)));
        }

        // Create a new pen using the selected width
        ReplacePen();
        ```

1. Затем создайте элемент меню и обработчики событий для толстого пера.

   1. В окне **представление ресурсов** Откройте ресурс меню **IDR_SCRIBBTYPE** .

   1. Щелкните **перо** , чтобы открыть меню "перо". Затем щелкните **Введите здесь тип** и введите `Thic&k Pen` .

   1. Щелкните правой кнопкой мыши текст, введенный для вывода окна **Свойства** . Измените значение свойства ID на `ID_PEN_THICK_WIDTH` .

   1. Щелкните правой кнопкой мыши значок **толстого меню пера** , который был создан, и выберите команду **Добавить обработчик событий**. Откроется **Мастер обработчика событий** .

   1. В окне мастера **список классов** выберите **кскриббледок** и нажмите кнопку **Добавить и изменить**. Команда создает обработчик событий с именем `CScribbleDoc::OnPenThickWidth` .

   1. Добавьте в раздел `CScribbleDoc::OnPenThickWidth` следующий код.

        ```cpp
        // Get a pointer to the ribbon bar
        CMFCRibbonBar* pRibbon = ((CMDIFrameWndEx *) AfxGetMainWnd())->GetRibbonBar();
        ASSERT_VALID(pRibbon);

        CMFCRibbonComboBox* pThickComboBox = DYNAMIC_DOWNCAST(
            CMFCRibbonComboBox, pRibbon->FindByID(ID_PEN_THICK_WIDTH));
        // Get the selected value
        int nCurSel = pThickComboBox->GetCurSel();
        if (nCurSel>= 0)
        {
            m_nThickWidth = atoi(CStringA(pThickComboBox->GetItem(nCurSel)));
        }

        // Create a new pen using the selected width
        ReplacePen();
        ```

1. Сохраните изменения, а затем выполните сборку и запуск приложения. Должны отобразиться новые кнопки и поля со списком. Попробуйте использовать разные толщины пера для рисования.

## <a name="adding-a-color-button-to-the-pen-panel"></a><a name="addcolorbutton"></a> Добавление кнопки цвета на панель «перо»

Затем добавьте объект [кмфкриббонколорбуттон](../mfc/reference/cmfcribboncolorbutton-class.md) , позволяющий пользователю закрасить цвет.

### <a name="to-add-a-color-button-to-the-pen-panel"></a>Добавление кнопки цвета на панель «перо»

1. Перед добавлением кнопки цвета создайте для нее пункт меню. В окне **представление ресурсов** Откройте ресурс меню **IDR_SCRIBBTYPE** . Щелкните пункт меню **перо** , чтобы открыть меню пера. Затем щелкните **Введите здесь тип** и введите `&Color` . Щелкните правой кнопкой мыши текст, введенный для вывода окна **Свойства** . Измените идентификатор на `ID_PEN_COLOR`.

1. Теперь добавьте кнопку Color (цвет). Из **панели элементов** перетащите **кнопку цвета** на панель **пера** .

1. Нажмите кнопку цвет. Измените **заголовок** на `Color` , **ID** на `ID_PEN_COLOR` , **простой поиск** `True` , **индекс большого изображения** в `1` и **режим разделения** на `False` .

1. Сохраните изменения, а затем выполните сборку и запуск приложения. На панели **пера** отобразится кнопка Создать цвет. Однако его нельзя использовать, так как у него еще нет обработчика событий. На следующих шагах показано, как добавить обработчик событий для кнопки цвет.

## <a name="adding-a-color-member-to-the-document-class"></a><a name="addcolormember"></a> Добавление элемента Color в класс Document

Поскольку исходное приложение Scribble не имеет цветовых перьев, для них необходимо написать реализацию. Чтобы сохранить цвет пера документа, добавьте новый элемент в класс Document `CscribbleDoc` .

### <a name="to-add-a-color-member-to-the-document-class"></a>Добавление элемента Color в класс Document

1. В скрибдок. h в `CScribbleDoc` классе найдите `// Attributes` раздел. Добавьте следующие строки кода после определения `m_nThickWidth` элемента данных.

   ```cpp
   // Current pen color
   COLORREF m_penColor;
   ```

1. Каждый документ содержит список Стокс, которые уже были выведены пользователем. Каждый штрих определяется `CStroke` объектом. `CStroke`Класс не содержит сведений о цвете пера, поэтому необходимо изменить класс. В скрибдок. h в `CStroke` классе добавьте следующие строки кода после определения `m_nPenWidth` элемента данных.

   ```cpp
   // Pen color for the stroke
   COLORREF m_penColor;
   ```

1. В скрибдок. h добавьте новый конструктор, `CStroke` параметры которого задают ширину и цвет. Добавьте следующую строку кода после `CStroke(UINT nPenWidth);` оператора.

   ```cpp
   CStroke(UINT nPenWidth, COLORREF penColor);
   ```

1. В скрибдок. cpp Добавьте реализацию нового `CStroke` конструктора. Добавьте следующий код после реализации `CStroke::CStroke(UINT nPenWidth)` конструктора.

   ```cpp
   // Constructor that uses the document's current width and color
   CStroke::CStroke(UINT nPenWidth, COLORREF penColor)
   {
       m_nPenWidth = nPenWidth;
       m_penColor = penColor;
       m_rectBounding.SetRectEmpty();
   }
   ```

1. Измените вторую строку `CStroke::DrawStroke` метода следующим образом.

   ```cpp
   if (!penStroke.CreatePen(PS_SOLID, m_nPenWidth, m_penColor))
   ```

1. Задайте цвет пера по умолчанию для класса документа. В скрибдок. cpp добавьте следующие строки в `CScribbleDoc::InitDocument` , после `m_nThickWidth = 5;` инструкции.

   ```cpp
   // default pen color is black
   m_penColor = RGB(0, 0, 0);
   ```

1. В скрибдок. cpp измените первую строку `CScribbleDoc::NewStroke` метода на следующую.

   ```cpp
   CStroke* pStrokeItem = new CStroke(m_nPenWidth, m_penColor);
   ```

1. Измените последнюю строку `CScribbleDoc::ReplacePen` метода следующим способом.

   ```cpp
   m_penCur.CreatePen(PS_SOLID, m_nPenWidth, m_penColor);
   ```

1. Вы добавили `m_penColor` элемент на предыдущем шаге. Теперь создайте обработчик событий для кнопки цвета, которая задает элемент.

   1. В окне **представление ресурсов** Откройте ресурс меню IDR_SCRIBBTYPE.

   1. Щелкните правой кнопкой мыши пункт меню **Цвет** и выберите команду **Добавить обработчик событий**. Откроется **Мастер обработчика событий** .

   1. В окне мастера в **списке класс** выберите **кскриббледок** и нажмите кнопку **Добавить и изменить** . Команда создает `CScribbleDoc::OnPenColor` заглушку обработчика событий.

1. Замените заглушку `CScribbleDoc::OnPenColor` обработчика событий следующим кодом.

   ```cpp
   void CScribbleDoc::OnPenColor()
   {
       // Change pen color to reflect color button's current selection
       CMFCRibbonBar* pRibbon = ((CMDIFrameWndEx*) AfxGetMainWnd())->GetRibbonBar();
       ASSERT_VALID(pRibbon);

       CMFCRibbonColorButton* pColorBtn = DYNAMIC_DOWNCAST(
           CMFCRibbonColorButton, pRibbon->FindByID(ID_PEN_COLOR));

       m_penColor = pColorBtn->GetColor();
       // Create new pen using the selected color
       ReplacePen();
   }
   ```

1. Сохраните изменения, а затем выполните сборку и запуск приложения. Теперь можно нажать кнопку цвета и изменить цвет пера.

## <a name="initializing-pens-and-saving-preferences"></a><a name="initpensave"></a> Инициализация перьев и сохранение настроек

Затем инициализируйте цвет и ширину перьев. Наконец, сохраните и загрузите цветовую прорисовку из файла.

### <a name="to-initialize-controls-on-the-ribbon-bar"></a>Инициализация элементов управления на панели ленты

1. Инициализация перьев на панели ленты.

   Добавьте следующий код в скрибдок. cpp в `CScribbleDoc::InitDocument` метод после `m_sizeDoc = CSize(200,200)` инструкции.

   ```cpp
   // Reset the ribbon UI to its initial values
   CMFCRibbonBar* pRibbon =
       ((CMDIFrameWndEx*) AfxGetMainWnd())->GetRibbonBar();
   ASSERT_VALID(pRibbon);

   CMFCRibbonColorButton* pColorBtn = DYNAMIC_DOWNCAST(
       CMFCRibbonColorButton,
       pRibbon->FindByID(ID_PEN_COLOR));

   // Set ColorButton to black
   pColorBtn->SetColor(RGB(0, 0, 0));

   CMFCRibbonComboBox* pThinComboBox = DYNAMIC_DOWNCAST(
       CMFCRibbonComboBox,
       pRibbon->FindByID(ID_PEN_THIN_WIDTH));

   // Set Thin pen combobox to 2
   pThinComboBox->SelectItem(1);

   CMFCRibbonComboBox* pThickComboBox = DYNAMIC_DOWNCAST(
       CMFCRibbonComboBox,
       pRibbon->FindByID(ID_PEN_THICK_WIDTH));

   // Set Thick pen combobox to 5
   pThickComboBox->SelectItem(0);
   ```

1. Сохранение цветового изображения в файл. Добавьте следующую инструкцию в скрибдок. cpp в `CStroke::Serialize` метод после `ar << (WORD)m_nPenWidth;` инструкции.

   ```cpp
   ar << (COLORREF)m_penColor;
   ```

1. Наконец, загрузите цветовую прорисовку из файла. Добавьте следующую строку кода в `CStroke::Serialize` метод после `m_nPenWidth = w;` инструкции.

   ```cpp
   ar >> m_penColor;
   ```

1. Теперь Scribble в цвете и сохраните документ в файл.

## <a name="conclusion"></a>Заключение

Вы обновили приложение MFC Scribble. Используйте это пошаговое руководство в качестве руководства при изменении существующих приложений.

## <a name="see-also"></a>См. также раздел

[Пошаговые руководства](../mfc/walkthroughs-mfc.md)<br/>
[Пошаговое руководство. Обновление приложения MFC Scribble (часть 1)](../mfc/walkthrough-updating-the-mfc-scribble-application-part-1.md)
