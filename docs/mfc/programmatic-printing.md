---
description: 'Дополнительные сведения: Программная печать'
title: Программная печать
ms.date: 11/04/2016
helpviewer_keywords:
- printing [MFC], active documents
- active documents [MFC], printing
- printing [MFC], programmatic
- IPrint interface
- printing [MFC]
ms.assetid: 3db0945b-5e13-4be4-86a0-6aecdae565bd
ms.openlocfilehash: c97a3938a97970e1479add4f62b68250845ba7e1
ms.sourcegitcommit: d6af41e42699628c3e2e6063ec7b03931a49a098
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2020
ms.locfileid: "97154699"
---
# <a name="programmatic-printing"></a>Программная печать

OLE предоставляет средства для уникальной идентификации постоянных документов ( `GetClassFile` ) и их загрузки в связанный с ними код ( `CoCreateInstance` ,,, `QueryInterface(IID_IPersistFile)` `QueryInterface(IID_IPersistStorage)` `IPersistFile::Load` и `IPersistStorage::Load` ). Чтобы дополнительно включить печать документов, включение активного документа (с использованием существующей OLE-конструкции, не поставляемой с OLE 2,0) предоставляет стандартный интерфейс печати, `IPrint` обычно доступный через любой объект, который может загрузить постоянное состояние типа документа. Каждое представление активного документа может дополнительно поддерживать `IPrint` интерфейс для предоставления этих возможностей.

Интерфейс `IPrint` определяется следующим образом.

```
interface IPrint : IUnknown
    {
    HRESULT SetInitialPageNum([in] LONG nFirstPage);
    HRESULT GetPageInfo(
        [out] LONG *pnFirstPage,
        [out] LONG *pcPages);
    HRESULT Print(
        [in] DWORD grfFlags,
        [in,out] DVTARGETDEVICE **pptd,
        [in,out] PAGESET ** ppPageSet,
        [in,out] STGMEDIUM **ppstgmOptions,
        [in] IContinueCallback* pCallback,
        [in] LONG nFirstPage,
        [out] LONG *pcPagesPrinted,
        [out] LONG *pnPageLast);
    };
```

Клиенты и контейнеры просто используют, `IPrint::Print` чтобы сообщить документу о необходимости распечатать себя после загрузки документа, указав флаги управления печатью, целевое устройство, страницы для печати и дополнительные параметры. Клиент также может управлять продолжением печати через интерфейс `IContinueCallback` (см. ниже).

Кроме того, `IPrint::SetInitialPageNum` поддерживает возможность параллельной печати последовательности документов с помощью страниц нумерации, очевидно, что это преимущество для активных контейнеров документов, таких как Office BINDER. `IPrint::GetPageInfo` делает отображение сведений о разбиении на страницы простым, позволяя вызывающей стороне получить номер начальной страницы, ранее переданный `SetInitialPageNum` (или номер начальной страницы по умолчанию документа), и число страниц в документе.

Объекты, которые поддерживаются, `IPrint` помечаются в реестре с помощью "печатного" ключа, хранящегося в CLSID объекта:

HKEY_CLASSES_ROOT\CLSID\\ {...} \принтабле

`IPrint` обычно реализуется на том же объекте, который поддерживает `IPersistFile` либо `IPersistStorage` . Вызывающие объекты Обратите внимание на возможность программной печати постоянного состояния некоторого класса путем просмотра в реестре раздела "печатный". В настоящее время "печатный" означает поддержку по меньшей мере `IPrint` ; другие интерфейсы могут быть определены в будущем, которая затем будет доступна через, `QueryInterface` где `IPrint` просто представляет базовый уровень поддержки.

Во время процедуры печати может потребоваться, чтобы клиент или контейнер, который инициировал печать, мог управлять тем, будет ли продолжаться печать. Например, контейнер может поддерживать команду "остановить печать", которая должна как можно быстрее завершить задание печати. Для поддержки этой возможности клиент объекта, поддерживающего печать, может реализовать небольшой объект приемника уведомлений с интерфейсом `IContinueCallback` :

```
interface IContinueCallback : IUnknown
    {
    HRESULT FContinue(void);
    HRESULT FContinuePrinting(
        [in] LONG cPagesPrinted,
        [in] LONG nCurrentPage,
        [in] LPOLESTR pszPrintStatus);
    };
```

Этот интерфейс предназначен для использования в качестве универсальной функции обратного вызова продолжения, которая принимает место различных процедур продолжения в API Win32 (например, `AbortProc` для печати и `EnumMetafileProc` перечисления метафайлов). Поэтому эта схема интерфейса полезна в самых разнообразных длительных процессах.

В самых общих случаях `IContinueCallback::FContinue` функция вызывается периодически с помощью любого длительного процесса. Объект приемника возвращает S_OK, чтобы продолжить операцию, и S_FALSE, чтобы процедура была как можно быстрее приостановлена.

`FContinue`, однако, не используется в контексте `IPrint::Print` ; вместо этого использует печать `IContinueCallback::FContinuePrint` . Любой объект печати должен периодически вызывать `FContinuePrinting` передачу количества напечатанных страниц, число печатаемых страниц и дополнительную строку, описывающую состояние печати, которое клиент может выбрать для отображения пользователю (например, «стр. 5 из 19»).

## <a name="see-also"></a>См. также раздел

[Активные контейнеры документов](../mfc/active-document-containers.md)
