---
title: Программная печать
ms.date: 11/04/2016
helpviewer_keywords:
- printing [MFC], active documents
- active documents [MFC], printing
- printing [MFC], programmatic
- IPrint interface
- printing [MFC]
ms.assetid: 3db0945b-5e13-4be4-86a0-6aecdae565bd
ms.openlocfilehash: eb8804610832f91f4b24487fddfe9c24a3799117
ms.sourcegitcommit: c3093251193944840e3d0a068ecc30e6449624ba
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/04/2019
ms.locfileid: "57264005"
---
# <a name="programmatic-printing"></a>Программная печать

OLE предоставляют средства для уникальной идентификации постоянных документов (`GetClassFile`) и загрузить их в соответствующий код (`CoCreateInstance`, `QueryInterface(IID_IPersistFile)`, `QueryInterface(IID_IPersistStorage)`, `IPersistFile::Load`, и `IPersistStorage::Load`). Чтобы дополнительно включить печать документов, вложение активного документа (с использованием существующей схемой OLE не поставляются с OLE 2.0 первоначально) представлен интерфейс печати стандарту base, `IPrint`, теперь доступны в любой объект, который можно загрузить постоянное состояние типа документа. Каждое представление активного документа можно поддерживать Дополнительно `IPrint` интерфейс для предоставления этих возможностей.

`IPrint` Интерфейс определяется следующим образом:

```
interface IPrint : IUnknown
    {
    HRESULT SetInitialPageNum([in] LONG nFirstPage);
    HRESULT GetPageInfo(
        [out] LONG *pnFirstPage,
        [out] LONG *pcPages);
    HRESULT Print(
        [in] DWORD grfFlags,
        [in,out] DVTARGETDEVICE **pptd,
        [in,out] PAGESET ** ppPageSet,
        [in,out] STGMEDIUM **ppstgmOptions,
        [in] IContinueCallback* pCallback,
        [in] LONG nFirstPage,
        [out] LONG *pcPagesPrinted,
        [out] LONG *pnPageLast);
    };
```

Клиенты и контейнеры просто использовать `IPrint::Print` для указания документа должны быть напечатаны сам после загрузки этого документа, указав печати управляющих флагов, целевое устройство, страницы для печати и дополнительных параметров. Клиент также может управлять продолжение печати через интерфейс `IContinueCallback` (см. ниже).

Кроме того `IPrint::SetInitialPageNum` поддерживает возможность печати серии документов, а один для нумерации страниц без проблем, очевидно, что как одно из преимуществ контейнеры активных документов, таких как Office Binder. `IPrint::GetPageInfo` делает информацией о разбиении на страницы простой, позволяя вызывающему объекту получить начальный номер, ранее, передаваемый страницы `SetInitialPageNum` (или документа внутреннее значение по умолчанию начальный номер страницы) и число страниц в документе.

Объекты, поддерживающие `IPrint` отмечены в реестре «Возможностью печати для состояния» ключ, хранящийся в разделе CLSID объекта:

HKEY_CLASSES_ROOT\CLSID\\{...}\Printable

`IPrint` обычно реализуется на тот же объект, который поддерживает `IPersistFile` или `IPersistStorage`. Вызывающие объекты Обратите внимание, возможность программным образом распечатать сохраняемого состояния какие-либо классы путем поиска в реестре для ключа «Возможностью печати для состояния». В настоящее время «Печатным» указывает на поддержку по крайней мере `IPrint`; другие интерфейсы может быть задано в будущем которого будут доступны через `QueryInterface` где `IPrint` просто представляет базовый уровень поддержки.

В процессе печати может потребоваться, клиента или контейнер, который инициировал печати для управления, определить, следует ли продолжить печать. Например контейнер может поддерживать команду «Остановить печать», которая должна как можно скорее прервать задания печати. Для поддержки этой возможности, клиент печати объекта можно реализовать объект приемника маленькое оповещение с интерфейсом `IContinueCallback`:

```
interface IContinueCallback : IUnknown
    {
    HRESULT FContinue(void);
    HRESULT FContinuePrinting(
        [in] LONG cPagesPrinted,
        [in] LONG nCurrentPage,
        [in] LPOLESTR pszPrintStatus);
    };
```

Этот интерфейс должен быть полезны в качестве универсального продолжения, функция ответного вызова занимает место различные процедуры продолжения в Win32 API (такие как `AbortProc` для печати и `EnumMetafileProc` для перечисления метафайл). Таким образом этот интерфейс является полезным в самых разнообразных длительных процессов.

В случаях, более универсальными `IContinueCallback::FContinue` функция вызывается периодически из любой длительный процесс. Объект приемника возвращает S_OK, чтобы продолжить операцию и S_FALSE, чтобы остановить процесс как можно скорее.

`FContinue`, но не используется в контексте `IPrint::Print`; вместо этого печати использует `IContinueCallback::FContinuePrint`. Любой объект печати должно периодически вызывать `FContinuePrinting` передачи число страниц, которые предупреждали, номер страницы, печать и дополнительной строки, описывающее состояние, печати, которое клиент может отобразить для пользователя (например, страницы « 5 из 19-дюймовый).

## <a name="see-also"></a>См. также

[Контейнеры активных документов](../mfc/active-document-containers.md)
