---
title: Сокеты Windows. Порядок байтов
ms.date: 11/04/2016
helpviewer_keywords:
- byte order issues in sockets programming
- sockets [MFC], byte order issues
- Windows Sockets [MFC], byte order issues
ms.assetid: 8a787a65-f9f4-4002-a02f-ac25a5dace5d
ms.openlocfilehash: ca572ad32a9a46756cacf0221d80b2953b710723
ms.sourcegitcommit: c3093251193944840e3d0a068ecc30e6449624ba
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/04/2019
ms.locfileid: "57278097"
---
# <a name="windows-sockets-byte-ordering"></a>Сокеты Windows. Порядок байтов

В этой статье и в двух других статьях приведены некоторые проблемы в программировании сокетов Windows. В этой статье рассматривается порядок байтов. Другие проблемы описанные в статьях: [Сокеты Windows. Блокировка](../mfc/windows-sockets-blocking.md) и [сокеты Windows: Преобразование строк](../mfc/windows-sockets-converting-strings.md).

Если вы используете или являются производными от класса [CAsyncSocket](../mfc/reference/casyncsocket-class.md), вам потребуется самостоятельно управлять эти проблемы. Если вы используете или являются производными от класса [CSocket](../mfc/reference/csocket-class.md), MFC автоматически управляет ими.

## <a name="byte-ordering"></a>Порядок байтов

Разной архитектурой иногда хранение данных с помощью порядком байтов. Например машин на основе Intel хранить данные в порядке, обратном порядку компьютеры Macintosh (Motorola). Порядок байтов Intel, называется «прямым» также является обратной по отношению сети стандартный порядок — «обратным». В следующей таблице описаны эти условия.

### <a name="big--and-little-endian-byte-ordering"></a>И мало обратный порядок байтов

|Порядок байтов|Значение|
|-------------------|-------------|
|С прямым порядком байтов|Старший байт находится на левый конец слова.|
|С прямым порядком байтов|Старший байт находится на правом конце слова.|

Как правило вам не нужно беспокоиться о преобразовании порядка следования байтов для данных, отправки и получения по сети, но существуют ситуации, в которых необходимо преобразовать порядка байтов.

## <a name="when-you-must-convert-byte-orders"></a>Если необходимо преобразовать порядок байтов

Вам необходимо конвертировать порядка байтов в следующих ситуациях:

- При передаче сведений, которые необходимо интерпретировать в сети, в отличие от данных, отправляемых на другой компьютер. Например, можно передать порты и адреса, которые необходимо изучить сети.

- Серверное приложение, с которым вы сейчас находитесь не в приложении MFC (и у вас нет исходного кода для него). Это вызывает для преобразования порядок байтов, если оба компьютера используют разные же порядок байтов.

## <a name="when-you-do-not-have-to-convert-byte-orders"></a>Если у вас нет для преобразования байтов

Вы можете избежать задач по преобразованию порядка байтов в следующих ситуациях:

- Компьютеры на обоих концах можно примите не Смена байтов и обе машины используют одинаковый порядок следования байтов.

- Сервер, к которому вы обмениваетесь данными является приложение MFC.

- У вас есть исходный код для сервера, который вы взаимодействовать, что позволяет увидеть, явно ли порядка байтов необходимо преобразовать или нет.

- Можно перенести сервер с MFC. Это очень простая операция, и результат обычно код меньшего размера, быстрее.

Работа с [CAsyncSocket](../mfc/reference/casyncsocket-class.md), необходимо управлять любые необходимые порядка байтов преобразования самостоятельно. Сокеты Windows стандартизирует порядка следования байтов — «обратным» модели и предоставляет функции для преобразования между этот порядок и другими. [CArchive](../mfc/reference/carchive-class.md), тем не менее, используемый вместе с [CSocket](../mfc/reference/csocket-class.md), использует в обратном порядке («прямым»), но `CArchive` берет на себя различными аспектами преобразования порядка следования байтов. Используя этот стандартный порядок в приложениях, или с помощью функций преобразования Windows Sockets порядка следования байтов, может сделать код более пригодным для переноса.

Является идеальным случаем использования сокетов MFC, при написании обе взаимодействующие стороны: с помощью MFC на обоих концах. Если вы создаете приложение, которое будет взаимодействовать с приложениями, не являющихся MFC, например FTP-сервера, может потребоваться управлять Смена байтов самостоятельно прежде чем передать данные в объект архив, с помощью процедуры преобразования Windows Sockets **ntohs**, **ntohl**, **htons**, и **htonl**. Пример этих функций, использовать для связи с приложением не MFC появляется далее в этой статье.

> [!NOTE]
>  При другом конце связи не приложения MFC, следует избегать потоковой передачи объектов C++, производных от `CObject` в архива, так как получатель, не смогут их обработать. См. в примечании [сокеты Windows: Использование сокетов с архивами](../mfc/windows-sockets-using-sockets-with-archives.md).

Дополнительные сведения о заказах байтов см. в спецификации Windows Sockets, доступны в пакете SDK для Windows.

## <a name="a-byte-order-conversion-example"></a>Пример преобразования порядка следования байтов

В следующем примере показано функция сериализации для `CSocket` объект, который использует архив. Здесь также показано использование функции преобразования порядка следования байтов в Windows Sockets API.

В этом примере представлен сценарий, в котором вы создаете клиент, который взаимодействует с не использующих MFC серверное приложение, для которого у вас есть нет доступа к исходному коду. В этом случае следует предположить, что сервер не MFC использует стандартный сетевой порядок байтов. Напротив, клиентское приложение MFC использует `CArchive` со `CSocket` объекта, и `CArchive` использует порядок байтов «прямым», в противоположность сети standard.

Предположим, что сервер не являющихся MFC, с которым вы планируете взаимодействовать имеет установленный протокол пакета сообщения следующего вида:

[!code-cpp[NVC_MFCSimpleSocket#5](../mfc/codesnippet/cpp/windows-sockets-byte-ordering_1.cpp)]

В терминах MFC это будет записано следующим образом:

[!code-cpp[NVC_MFCSimpleSocket#6](../mfc/codesnippet/cpp/windows-sockets-byte-ordering_2.cpp)]

В C++ **структуры** — это то же самое класса. `Message` Структура может содержать функции-члены, такие как `Serialize` функция-член объявлены выше. `Serialize` Функция-член может выглядеть следующим образом:

[!code-cpp[NVC_MFCSimpleSocket#7](../mfc/codesnippet/cpp/windows-sockets-byte-ordering_3.cpp)]

В этом примере вызывается для преобразования порядка следования байтов данных, имеет очистить несоответствие между порядок байтов, не являющихся MFC серверного приложения на одном конце и `CArchive` используется в клиентском приложении MFC на другом конце канала. В примере показано несколько функций преобразования порядка следования байтов, которые предоставляет Windows Sockets. В следующей таблице описаны эти функции.

### <a name="windows-sockets-byte-order-conversion-functions"></a>Функции преобразования порядка следования байтов сокеты Windows

|Функция|Назначение|
|--------------|-------------|
|**ntohs**|Преобразуйте 16-разрядное число из сетевого байтового формата узла порядка байтов (big-Endian для прямой порядок байтов).|
|**ntohl**|Преобразуйте 32-разрядное число из сетевого байтового формата узла порядка байтов (big-Endian для прямой порядок байтов).|
|**Htons**|Преобразуйте 16-разрядное число из байтового формата узла в сетевой байтовый (прямой порядок байтов на обратный).|
|**Htonl**|Преобразуйте 32-разрядное число из байтового формата узла в сетевой байтовый (прямой порядок байтов на обратный).|

Другой точка в этом примере считается, что при сокета приложение на другом конце связи — это приложение не являющихся MFC, вы должны избегать примерно следующим образом.

`ar << pMsg;`

где `pMsg` — это указатель на объект с ++, производный от класса `CObject`. Это будет отправлять дополнительную информацию MFC, связанные с объектами и сервера, не может понять, как если бы он был в приложении MFC.

Дополнительные сведения см. в следующих разделах.

- [Сокеты Windows. Использование класса CAsyncSocket](../mfc/windows-sockets-using-class-casyncsocket.md)

- [Сокеты Windows. Фон](../mfc/windows-sockets-background.md)

- [Сокеты Windows. Сокеты Stream](../mfc/windows-sockets-stream-sockets.md)

- [Сокеты Windows. Сокеты датаграмм](../mfc/windows-sockets-datagram-sockets.md)

## <a name="see-also"></a>См. также

[Сокеты Windows в MFC](../mfc/windows-sockets-in-mfc.md)
