---
description: 'Дополнительные сведения: экспортированные точки входа функции DLL'
title: Точки входа экспортированных функций DLL
ms.date: 11/04/2016
helpviewer_keywords:
- exporting DLLs [MFC], functions
- MFC, managing state data
- state management [MFC], exported DLLs
ms.assetid: 3268666e-d24b-44f2-80e8-7c80f73b93ca
ms.openlocfilehash: ea30a36507e22beed1f36727b8e7b582d51929b0
ms.sourcegitcommit: d6af41e42699628c3e2e6063ec7b03931a49a098
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2020
ms.locfileid: "97314598"
---
# <a name="exported-dll-function-entry-points"></a>Точки входа экспортированных функций DLL

Для экспортированных функций библиотеки DLL используйте макрос [AFX_MANAGE_STATE](reference/extension-dll-macros.md#afx_manage_state) для поддержания правильного глобального состояния при переключении из модуля DLL в библиотеку DLL вызывающего приложения.

При вызове этот макрос устанавливает `pModuleState` указатель на `AFX_MODULE_STATE` структуру, содержащую глобальные данные для модуля, в качестве действующего состояния модуля для оставшейся части области, содержащей функцию. При выходе из области, содержащей макрос, предыдущее действующее состояние модуля автоматически восстанавливается.

Это переключение достигается путем создания экземпляра `AFX_MODULE_STATE` класса в стеке. В конструкторе этот класс получает указатель на текущее состояние модуля и сохраняет его в переменной-члене, а затем устанавливает в `pModuleState` качестве нового действующего состояния модуля. В его деструкторе этот класс восстанавливает указатель, хранящийся в переменной члена, в качестве действующего состояния модуля.

Если у вас есть экспортированная функция, например, которая запускает в библиотеке DLL диалоговое окно, необходимо добавить в начало функции следующий код:

[!code-cpp[NVC_MFCConnectionPoints#6](codesnippet/cpp/exported-dll-function-entry-points_1.cpp)]

Это меняет местами текущее состояние модуля на состояние, возвращенное из [афксжетстатикмодулестате](reference/extension-dll-macros.md#afxgetstaticmodulestate) , до конца текущей области.

Если макрос не используется, возникнут проблемы с ресурсами в библиотеках DLL `AFX_MANAGE_STATE` . По умолчанию MFC использует для загрузки шаблона ресурса обработчик ресурсов основного приложения. Фактически этот шаблон хранится в библиотеке DLL. Основная причина заключается в том, что сведения о состоянии модуля MFC не были переключены с помощью `AFX_MANAGE_STATE` макроса. Маркер ресурса восстанавливается из состояния модуля MFC. Отсутствие переключения состояния модуля приводит к тому, что используется неправильный маркер ресурса.

`AFX_MANAGE_STATE` не обязательно помещается в каждую функцию в библиотеке DLL. Например, `InitInstance` может вызываться кодом MFC в приложении без, `AFX_MANAGE_STATE` так как MFC автоматически сдвигает состояние модуля, `InitInstance` а затем снова переключается после `InitInstance` возврата. Это справедливо и для всех обработчиков карт сообщений. Фактические библиотеки DLL MFC имеют специальную процедуру главного окна, которая автоматически переключает состояние модуля перед маршрутизацией любого сообщения.

## <a name="see-also"></a>См. также раздел

[Управление данными состояния модулей MFC](managing-the-state-data-of-mfc-modules.md)
