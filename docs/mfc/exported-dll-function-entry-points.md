---
title: Точки входа экспортированных функций DLL
ms.date: 11/04/2016
helpviewer_keywords:
- exporting DLLs [MFC], functions
- MFC, managing state data
- state management [MFC], exported DLLs
ms.assetid: 3268666e-d24b-44f2-80e8-7c80f73b93ca
ms.openlocfilehash: 129defe39a79fd38211a539a4a85d79d9a3c0998
ms.sourcegitcommit: 0ab61bc3d2b6cfbd52a16c6ab2b97a8ea1864f12
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "62405915"
---
# <a name="exported-dll-function-entry-points"></a>Точки входа экспортированных функций DLL

Для экспортированных функций DLL-библиотеки, используйте [AFX_MANAGE_STATE](reference/extension-dll-macros.md#afx_manage_state) макрос для поддержания соответствующего глобального состояния, при переключении из модуля DLL на библиотеку DLL для вызывающего приложения.

При вызове этот макрос задает `pModuleState`, указатель на `AFX_MODULE_STATE` структуру, содержащую глобальные данные этого модуля, состоянию действующие модуля для оставшейся области, содержащей функции. При уходе из области, содержащий макрос, предыдущее состояние действующие модуль автоматически восстановится.

Это переключение достигается путем создания экземпляра класса `AFX_MODULE_STATE` класс в стеке. В конструкторе, этот класс получает указатель на текущее состояние модуля и сохраняет его в переменной-члена и затем задает `pModuleState` как новое состояние действующие модуля. В его деструктор этот класс восстанавливает указателем, сохраненным в своей переменной-членом состоянию действующие модуля.

При наличии экспортированную функцию, например, запускает диалоговое окно в вашей библиотеке DLL, необходимо добавить следующий код в начало функции:

[!code-cpp[NVC_MFCConnectionPoints#6](../mfc/codesnippet/cpp/exported-dll-function-entry-points_1.cpp)]

Это меняет местами текущее состояние модуля с состоянием, возвращенные [AfxGetStaticModuleState](reference/extension-dll-macros.md#afxgetstaticmodulestate) до конца текущей области.

Проблемы с ресурсами в библиотеках DLL возникает в том случае, если `AFX_MANAGE_STATE` макрос не используется. По умолчанию MFC использует дескриптор ресурсов основного приложения для загрузки шаблона ресурсов. Этот шаблон хранится в библиотеке DLL. Основной причиной является то, что сведения о состоянии модуля MFC не была переключена с `AFX_MANAGE_STATE` макрос. Дескриптор ресурса будет восстановлена из состояния модуля MFC. Не меняет состояние модуля вызывает дескриптор неправильный ресурс для использования.

`AFX_MANAGE_STATE` не нужно переводить в каждой функции в DLL. Например `InitInstance` может вызываться кодом MFC в приложения без `AFX_MANAGE_STATE` так, как MFC автоматически переключается в состояние модуля перед `InitInstance` и затем коммутаторов, его обратно после `InitInstance` возвращает. То же самое верно для всех обработчиков схемы сообщений. Обычные библиотеки DLL MFC фактически имеют специальное окно главную процедуру, которая автоматически переключается в состояние модуля перед отправкой сообщения.

## <a name="see-also"></a>См. также

[Управление данными состояния модулей MFC](../mfc/managing-the-state-data-of-mfc-modules.md)
