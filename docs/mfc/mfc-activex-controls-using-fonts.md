---
title: 'Элементы управления MFC ActiveX: использование шрифтов'
ms.date: 11/19/2018
f1_keywords:
- OnFontChanged
- HeadingFont
- InternalFont
helpviewer_keywords:
- notifications [MFC], MFC ActiveX controls fonts
- OnDraw method, MFC ActiveX controls
- InternalFont method [MFC]
- SetFont method [MFC]
- OnFontChanged method [MFC]
- IPropertyNotifySink class [MFC]
- MFC ActiveX controls [MFC], fonts
- Stock Font property [MFC]
- HeadingFont property [MFC]
- GetFont method [MFC]
- SelectStockFont method [MFC]
- fonts [MFC], ActiveX controls
ms.assetid: 7c51d602-3f5a-481d-84d1-a5d8a3a71761
ms.openlocfilehash: c336ec6c29b5478655ca8f19f71378a2b446ac64
ms.sourcegitcommit: c123cc76bb2b6c5cde6f4c425ece420ac733bf70
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81358261"
---
# <a name="mfc-activex-controls-using-fonts"></a>Элементы управления MFC ActiveX: использование шрифтов

Если ваш элемент управления ActiveX отображает текст, вы можете позволить пользователю управления изменить внешний вид текста, изменив свойство шрифта. Свойства шрифта реализуются как объекты шрифта и могут быть одним из двух типов: запасили или на заказ. Свойства шрифта stock — это предварительно реализованные свойства шрифта, которые можно добавить с помощью Мастера Свойств Добавления. Свойства пользовательских шрифтов не выполняются предварительно, и разработчик управления определяет поведение и использование свойства.

В этой статье рассматриваются следующие темы:

- [Использование свойства шрифта Stock](#_core_using_the_stock_font_property)

- [Использование пользовательских свойств шрифта в вашем управлении](#_core_implementing_a_custom_font_property)

## <a name="using-the-stock-font-property"></a><a name="_core_using_the_stock_font_property"></a>Использование свойства шрифта фондового шрифта

Свойства шрифта стока предварительно реализованы классом [COleControl.](../mfc/reference/colecontrol-class.md) Кроме того, доступна стандартная страница свойств шрифта, позволяющая пользователю изменять различные атрибуты объекта шрифта, такие как его имя, размер и стиль.

Доступ к объекту шрифта `COleControl`через функции [GetFont,](../mfc/reference/colecontrol-class.md#getfont) [SetFont](../mfc/reference/colecontrol-class.md#setfont)и [InternalGetFont.](../mfc/reference/colecontrol-class.md#internalgetfont) Пользователь управления будет получать доступ `GetFont` к `SetFont` объекту шрифта через и функционирует таким же образом, как и любое другое свойство Get/Set. Когда требуется доступ к объекту шрифта `InternalGetFont` из элемента управления, используйте функцию.

Как обсуждается в [MFC ActiveX Controls: Свойства](../mfc/mfc-activex-controls-properties.md), добавление фондовых свойств легко с [Add Property Wizard](../ide/names-add-property-wizard.md). Вы выбираете свойство шрифта, и Add Property Wizard автоматически вставляет вход шрифта в карту диспетчерской карты управления.

#### <a name="to-add-the-stock-font-property-using-the-add-property-wizard"></a>Добавление свойства шрифта с помощью мастера свойств Добавления

1. Загрузите проект элемента управления.

1. В представлении класса разверните узел библиотеки элемента управления.

1. Щелкните правой кнопкой мыши узел интерфейса для элемента управления (второй узел узла библиотеки), чтобы открыть контекстное меню.

1. Из меню ярлыка, нажмите **Добавить,** а затем нажмите **Добавить свойство**.

   Это открывает Мастер свойств добавления.

1. В поле **имени свойства** щелкните **шрифт**.

1. Нажмите кнопку **Готово**.

Мастер свойств добавления добавляет следующую строку к карте диспетчеризации элемента управления, расположенной в файле реализации класса управления:

[!code-cpp[NVC_MFC_AxFont#1](../mfc/codesnippet/cpp/mfc-activex-controls-using-fonts_1.cpp)]

Кроме того, Мастер свойств добавления добавляет в элемент управления следующую строку. IDL файл:

[!code-cpp[NVC_MFC_AxFont#2](../mfc/codesnippet/cpp/mfc-activex-controls-using-fonts_2.idl)]

Свойство биржевых подписей является примером свойства текста, которое может быть нарисовано с использованием информации о собственности шрифта. Добавление свойства подписи к бирже в элемент управления использует шаги, аналогичные тем, которые используются для свойства шрифта.

#### <a name="to-add-the-stock-caption-property-using-the-add-property-wizard"></a>Добавление свойства субцентной подписи с помощью мастера свойств добавления

1. Загрузите проект элемента управления.

1. В представлении класса разверните узел библиотеки элемента управления.

1. Щелкните правой кнопкой мыши узел интерфейса для элемента управления (второй узел узла библиотеки), чтобы открыть контекстное меню.

1. Из меню ярлыка, нажмите **Добавить,** а затем нажмите **Добавить свойство**.

   Это открывает Мастер свойств добавления.

1. В поле **имени свойства** нажмите **Подпись**.

1. Нажмите кнопку **Готово**.

Мастер свойств добавления добавляет следующую строку к карте диспетчеризации элемента управления, расположенной в файле реализации класса управления:

[!code-cpp[NVC_MFC_AxFont#3](../mfc/codesnippet/cpp/mfc-activex-controls-using-fonts_3.cpp)]

## <a name="modifying-the-ondraw-function"></a><a name="_core_modifying_the_ondraw_function"></a>Изменение функции OnDraw

Реализация по `OnDraw` умолчанию использует шрифт системы Windows для всего текста, отображаемого в элементе управления. Это означает, что `OnDraw` необходимо изменить код, выбрав объект шрифта в контекстустройства. Для этого позвоните [в COleControl::SelectStockFont](../mfc/reference/colecontrol-class.md#selectstockfont) и передайте контекст устройства управления, как показано в следующем примере:

[!code-cpp[NVC_MFC_AxFont#4](../mfc/codesnippet/cpp/mfc-activex-controls-using-fonts_4.cpp)]

После `OnDraw` того, как функция была изменена для использования объекта шрифта, любой текст в элементе управления отображается с характеристиками из свойства шрифта элемента элемента управления.

## <a name="using-custom-font-properties-in-your-control"></a><a name="_core_using_custom_font_properties_in_your_control"></a>Использование пользовательских свойств шрифта в вашем управлении

В дополнение к свойству шрифта, элемент управления ActiveX может иметь пользовательские свойства шрифта. Чтобы добавить пользовательское свойство шрифта, необходимо:

- Используйте «Мастер свойств добавления» для реализации пользовательского свойства шрифта.

- [Обработка уведомлений шрифта](#_core_processing_font_notifications).

- [Реализация нового интерфейса уведомления шрифта.](#_core_implementing_a_new_font_notification_interface)

### <a name="implementing-a-custom-font-property"></a><a name="_core_implementing_a_custom_font_property"></a>Реализация пользовательского свойства шрифта

Для реализации пользовательского свойства шрифта используется «Мастер свойств добавления» для добавления свойства, а затем внесения некоторых изменений в код. В следующих разделах описывается, как добавить пользовательское `HeadingFont` свойство в элемент управления образца.

##### <a name="to-add-the-custom-font-property-using-the-add-property-wizard"></a>Добавление пользовательского свойства шрифта с помощью мастера свойств добавления

1. Загрузите проект элемента управления.

1. В представлении класса разверните узел библиотеки элемента управления.

1. Щелкните правой кнопкой мыши узел интерфейса для элемента управления (второй узел узла библиотеки), чтобы открыть контекстное меню.

1. Из меню ярлыка, нажмите **Добавить,** а затем нажмите **Добавить свойство**.

   Это открывает Мастер свойств добавления.

1. В поле **имени свойства** введите имя для свойства. Для этого примера используйте **HeadingFont**.

1. В поле **Тип реализации**выберите **Методы Get/Set**.

1. В поле **Типа свойства** выберите **IDispatch** <strong>\*</strong> для типа свойства.

1. Нажмите кнопку **Готово**.

Мастер свойств добавления создает `HeadingFont` код для `CSampleCtrl` добавления пользовательского свойства в класс и SAMPLE. IdL файл. Поскольку `HeadingFont` это тип свойства Get/Set, мастер `CSampleCtrl` свойств Добавления изменяет карту отправки класса, чтобы включить DISP_PROPERTY_EX_ID[DISP_PROPERTY_EX](../mfc/reference/dispatch-maps.md#disp_property_ex) макрозапись:

[!code-cpp[NVC_MFC_AxFont#5](../mfc/codesnippet/cpp/mfc-activex-controls-using-fonts_5.cpp)]

В DISP_PROPERTY_EX макрос `HeadingFont` ассоциирует сяочку свойства с соответствующими `CSampleCtrl` методами типа Get and Set, `GetHeadingFont` и `SetHeadingFont`. Также указан тип стоимости свойства; в этом случае, VT_FONT.

Мастер свойств добавления также добавляет декларацию в файл заголовка управления (. H) для `GetHeadingFont` `SetHeadingFont` и функций и добавляет их шаблоны функций в файл реализации управления (. CPP):

[!code-cpp[NVC_MFC_AxFont#6](../mfc/codesnippet/cpp/mfc-activex-controls-using-fonts_6.cpp)]

Наконец, мастер свойств добавления изменяет элемент управления. IDL файл, добавив запись `HeadingFont` для свойства:

[!code-cpp[NVC_MFC_AxFont#7](../mfc/codesnippet/cpp/mfc-activex-controls-using-fonts_7.idl)]

### <a name="modifications-to-the-control-code"></a>Изменения в Контрольном кодексе

Теперь, когда `HeadingFont` вы добавили свойство в элемент управления, необходимо внести некоторые изменения в заголовок управления и файлы реализации, чтобы полностью поддержать новое свойство.

В файле заголовка управления (. H), добавьте следующее объявление защищенной переменной члена:

[!code-cpp[NVC_MFC_AxFont#8](../mfc/codesnippet/cpp/mfc-activex-controls-using-fonts_8.h)]

В файле реализации элемента управления (. CPP), сделать следующее:

- Инициализируйте *m_fontHeading* в конструкции управления.

   [!code-cpp[NVC_MFC_AxFont#9](../mfc/codesnippet/cpp/mfc-activex-controls-using-fonts_9.cpp)]

- Объявить статичную структуру FONTDESC, содержащую атрибуты шрифта по умолчанию.

   [!code-cpp[NVC_MFC_AxFont#10](../mfc/codesnippet/cpp/mfc-activex-controls-using-fonts_10.cpp)]

- В функции элемента управления `DoPropExchange` добавьте вызов в функцию. `PX_Font` Это обеспечивает инициализацию и настойчивость для пользовательского свойства шрифта.

   [!code-cpp[NVC_MFC_AxFont#11](../mfc/codesnippet/cpp/mfc-activex-controls-using-fonts_11.cpp)]

- Завершите реализацию `GetHeadingFont` функции элемента управления.

   [!code-cpp[NVC_MFC_AxFont#12](../mfc/codesnippet/cpp/mfc-activex-controls-using-fonts_12.cpp)]

- Завершите реализацию `SetHeadingFont` функции элемента управления.

   [!code-cpp[NVC_MFC_AxFont#13](../mfc/codesnippet/cpp/mfc-activex-controls-using-fonts_13.cpp)]

- Измените `OnDraw` функцию элемента управления, чтобы определить переменную для удержания ранее выбранного шрифта.

   [!code-cpp[NVC_MFC_AxFont#14](../mfc/codesnippet/cpp/mfc-activex-controls-using-fonts_14.cpp)]

- Измените `OnDraw` функцию элемента управления, чтобы выбрать пользовательский шрифт в контексте устройства, добавив следующую строку, где бы шрифт ни использовался.

   [!code-cpp[NVC_MFC_AxFont#15](../mfc/codesnippet/cpp/mfc-activex-controls-using-fonts_15.cpp)]

- Измените `OnDraw` функцию элемента управления, чтобы выбрать предыдущий шрифт обратно в контекст устройства, добавив следующую строку после использования шрифта.

   [!code-cpp[NVC_MFC_AxFont#16](../mfc/codesnippet/cpp/mfc-activex-controls-using-fonts_16.cpp)]

После реализации пользовательского свойства шрифта должна быть реализована стандартная страница свойств шрифта, позволяющая пользователям управления изменять текущий шрифт элемента управления. Чтобы добавить идентификатор страницы свойств для стандартной страницы свойств шрифта, вставьте следующую строку после BEGIN_PROPPAGEIDS макроса:

[!code-cpp[NVC_MFC_AxFont#17](../mfc/codesnippet/cpp/mfc-activex-controls-using-fonts_17.cpp)]

Вы также должны приравнить параметр подсчета вашего BEGIN_PROPPAGEIDS макроса по одному. Это показано в следующей строке:

[!code-cpp[NVC_MFC_AxFont#18](../mfc/codesnippet/cpp/mfc-activex-controls-using-fonts_18.cpp)]

После внесения этих изменений перестроить весь проект, чтобы включить дополнительную функциональность.

### <a name="processing-font-notifications"></a><a name="_core_processing_font_notifications"></a>Обработка уведомлений о шрифте

В большинстве случаев элемент управления должен знать, когда характеристики объекта шрифта были изменены. Каждый объект шрифта способен предоставлять уведомления при изменении, вызывая функцию элемента `IFontNotification` интерфейса, реализованную `COleControl`.

Если элемент управления использует свойство шрифта, его `OnFontChanged` уведомления обрабатываются функцией `COleControl`участника . При добавлении пользовательских свойств шрифта можно использовать одну и ту же реализацию. В примере в предыдущем разделе это было достигнуто путем передачи &*m_xFontNotification* при инициализации переменной *m_fontHeading* члена.

![Реализация интерфейсов нескольких объектов шрифта](../mfc/media/vc373q1.gif "Реализация интерфейсов нескольких объектов шрифта") <br/>
Реализация интерфейсов нескольких объектов шрифта

Твердые линии на рисунке выше показывают, что `IFontNotification`оба объекта шрифта используют одну и ту же реализацию. Это может вызвать проблемы, если вы хотите различать, какой шрифт изменился.

Одним из способов различения уведомлений объекта шрифта управления `IFontNotification` является создание отдельной реализации интерфейса для каждого объекта шрифта в элементе управления. Этот метод позволяет оптимизировать код рисования, обновляя только строки, или строки, которые используют недавно измененный шрифт. В следующих разделах показаны шаги, необходимые для реализации отдельных интерфейсов уведомлений для второго свойства шрифта. Предполагается, что второе `HeadingFont` свойство шрифта является свойством, добавленным в предыдущем разделе.

### <a name="implementing-a-new-font-notification-interface"></a><a name="_core_implementing_a_new_font_notification_interface"></a>Реализация нового интерфейса уведомления шрифта

Чтобы различать уведомления двух или более шрифтов, для каждого шрифта, используемого в элементе управления, должен быть реализован новый интерфейс уведомлений. В следующих разделах описывается, как реализовать новый интерфейс уведомления шрифта, изменив заголовок управления и файлы реализации.

### <a name="additions-to-the-header-file"></a>Дополнения к файлу заголовка

В файле заголовка управления (. H), добавьте следующие строки в декларацию класса:

[!code-cpp[NVC_MFC_AxFont#19](../mfc/codesnippet/cpp/mfc-activex-controls-using-fonts_19.h)]

Это создает реализацию `IPropertyNotifySink` интерфейса `HeadingFontNotify`под названием . Этот новый интерфейс `OnChanged`содержит метод под названием .

### <a name="additions-to-the-implementation-file"></a>Дополнения к файлу реализации

В коде, который инициализирует заголовок шрифта (в элементе управления конструктора), изменить *m_xFontNotification* &&*m_xHeadingFontNotify.* Затем добавьте приведенный ниже код.

[!code-cpp[NVC_MFC_AxFont#20](../mfc/codesnippet/cpp/mfc-activex-controls-using-fonts_20.cpp)]

Методы `AddRef` интерфейса `IPropertyNotifySink` отслеживают подсчет ссылок на объект управления ActiveX. `Release` Когда элемент управления получает доступ к указателю `AddRef` интерфейса, элемент управления требует приравлить подсчет ссылок. Когда управление закончено с указателем, `Release`оно вызывает, в `GlobalFree` много таким же путе которое могло быть вызвано для того чтобы освободить глобальный блок памяти. Когда подсчет ссылок на этот интерфейс сходит на ноль, реализация интерфейса может быть освобождена. В этом примере `QueryInterface` функция возвращает указатель в `IPropertyNotifySink` интерфейс на определенном объекте. Эта функция позволяет управлению ActiveX задать запрос объекту, чтобы определить, какие интерфейсы он поддерживает.

После внесения этих изменений в проект перестроить проект и использовать тестовый контейнер для тестирования интерфейса. Сведения о том, как получить доступ к Контейнеру для тестирования, см. в разделе [Тестирование свойств и событий в Контейнере для тестирования](../mfc/testing-properties-and-events-with-test-container.md) .

## <a name="see-also"></a>См. также раздел

[Элементы ActiveX библиотеки MFC](../mfc/mfc-activex-controls.md)<br/>
[Элементы ActiveX в MFC. Использование изображений в элементе ActiveX](../mfc/mfc-activex-controls-using-pictures-in-an-activex-control.md)<br/>
[Элементы ActiveX в MFC. Использование стандартных страниц свойств](../mfc/mfc-activex-controls-using-stock-property-pages.md)
