---
title: Серверы автоматизации. Проблемы времени существования объекта
ms.date: 11/04/2016
helpviewer_keywords:
- objects [MFC], lifetime
- lifetime, automation server
- Automation servers, object lifetime
- servers, lifetime of Automation
ms.assetid: 342baacf-4015-4a0e-be2f-321424f1cb43
ms.openlocfilehash: f9dbc6e4f321ba10fdffa013c158d53b84331e30
ms.sourcegitcommit: c3093251193944840e3d0a068ecc30e6449624ba
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/04/2019
ms.locfileid: "57293584"
---
# <a name="automation-servers-object-lifetime-issues"></a>Серверы автоматизации. Проблемы времени существования объекта

Когда клиент автоматизации создает или активирует объект OLE, сервер передает клиент указатель на этот объект. Клиент устанавливает ссылку на объект посредством вызова функции OLE [IUnknown::AddRef](/windows/desktop/api/unknwn/nf-unknwn-iunknown-addref). Эта ссылка действует до клиент вызывает [IUnknown::Release](/windows/desktop/api/unknwn/nf-unknwn-iunknown-release). (Клиентские приложения, написанные с помощью библиотеки Microsoft Foundation Class классы OLE не потребуется выполнять эти вызовы framework делает это.) Система OLE и сам сервер, могут устанавливать ссылки на объект. Сервер не должен уничтожить объект, до тех пор, пока внешние ссылки на объект остаются в силе.

Платформа поддерживает внутренний счетчик числа ссылок для любого серверного объекта, производного от [CCmdTarget](../mfc/reference/ccmdtarget-class.md). Этот счетчик обновляется в том случае, когда клиент автоматизации или другая сущность, добавляет или удаляет ссылку на объект.

Когда счетчик ссылок становится равным 0, платформа вызывает виртуальную функцию [CCmdTarget::OnFinalRelease](../mfc/reference/ccmdtarget-class.md#onfinalrelease). Реализация по умолчанию эта функция вызывает **удалить** оператор удаление данного объекта.

Библиотеки Microsoft Foundation Class предоставляет дополнительные средства для управления поведением приложения в том случае, когда внешние клиенты имеют ссылки на объекты приложения. Помимо подсчитывается количество ссылок для каждого объекта, серверы поддерживают общего счетчика активных объектов. Глобальные функции [AfxOleLockApp](../mfc/reference/application-control.md#afxolelockapp) и [AfxOleUnlockApp](../mfc/reference/application-control.md#afxoleunlockapp) обновить приложения число активных объектов. Если это число не равно нулю, приложение не прекращен, когда пользователь выбирает закрыть из меню системы или выхода из меню "файл". Вместо этого главное окно приложения является скрытым (но не уничтожается) пока все ожидающие клиентские запросы будут завершены. Как правило `AfxOleLockApp` и `AfxOleUnlockApp` , называются в конструкторы и деструкторы, соответственно, классами, которые поддерживают службы автоматизации.

Иногда обстоятельствах принудительно завершить, а клиент по-прежнему имеет ссылку на объект. Например ресурс, от которого зависит сервера могут стать недоступными, приведшая к сообщение об ошибке. Пользователь также может закрыть документ сервера, который содержит объекты, к которым другие приложения имеют ссылки.

В пакете SDK для Windows, см. в разделе `IUnknown::AddRef` и `IUnknown::Release`.

## <a name="see-also"></a>См. также

[Серверы автоматизации](../mfc/automation-servers.md)<br/>
[AfxOleCanExitApp](../mfc/reference/application-control.md#afxolecanexitapp)
