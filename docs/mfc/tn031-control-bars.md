---
title: TN031. Панели элементов управления
ms.date: 11/04/2016
f1_keywords:
- vc.controls.bars
helpviewer_keywords:
- control bars [MFC], styles
- CStatusBar class [MFC], Tech Note 31 usage
- CControlBar class [MFC], Tech Note 31 usage
- CControlBar class [MFC], deriving from
- control bars [MFC], classes [MFC]
- CDialogBar class [MFC], Tech Note 31 usage
- CToolBar class [MFC], Tech Note 31 usage
- TN031
- styles [MFC], control bars
ms.assetid: 8cb895c0-40ea-40ef-90ee-1dd29f34cfd1
ms.openlocfilehash: 37c3a15c281018260e65508dee3799ab0011dbfe
ms.sourcegitcommit: c123cc76bb2b6c5cde6f4c425ece420ac733bf70
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81370308"
---
# <a name="tn031-control-bars"></a>TN031. Панели элементов управления

> [!NOTE]
> Следующее техническое примечание не было обновлено, поскольку сначала оно было включено в электронную документацию. В результате некоторые процедуры и разделы могут быть устаревшими или неверными. Для получения последних сведений рекомендуется выполнить поиск интересующей темы в алфавитном указателе документации в Интернете.

В этой записке описаны классы диспетчерской панели в MFC: общий [CControlBar](#_mfcnotes_ccontrolbar) `CDockBar`, [CStatusBar](#_mfcnotes_cstatusbar), [CToolBar](#_mfcnotes_ctoolbar), [CDialogBar](#_mfcnotes_cdialogbar), и .

## <a name="ccontrolbar"></a><a name="_mfcnotes_ccontrolbar"></a> CControlBar

A `ControlBar` - `CWnd`это -производный класс, который:

- выравнивается по верхней или нижней части окна фрейма;

- может содержать дочерние элементы, которые являются элементами управления на основе HWND (например, `CDialogBar`) или элементами, не основанными на`HWND` (например, `CToolBar`, `CStatusBar`).

Панели элементов управления поддерживают дополнительные стили:

- CBRS_TOP (по умолчанию) прикрепите панель управления к вершине.

- CBRS_BOTTOM прикрепите панель управления внизу.

- CBRS_NOALIGN Не меняйте планку управления при повторном размере родителя.

Классы, производные от `CControlBar` , предоставляют более интересные реализации:

- `CStatusBar` строка состояния, элементы являются панелями строки состояния, содержащими текст;

- `CToolBar` панель инструментов, элементы являются выровненными в строку кнопками с точечными рисунками;

- `CDialogBar` фрейм в виде панели инструментов, содержащий стандартные элементы управления Windows (созданные из ресурса шаблона диалоговых окон);

- `CDockBar`Обобщенные области стыковки для других `CControlBar` производных объектов. Определенные функции-члены и переменные, доступные в этом классе, могут измениться в будущих версиях.

Все объекты и окна панели элементов управления будут дочерними по отношению к некоторым родительским окнам фреймов. Обычно они добавляются в клиентскую область фрейма (например, клиент MDI или представление) как элементы одного уровня. Важное значение имеет идентификатор дочернего окна панели элементов управления. Макет панели элементов управления по умолчанию применяется только для панелей элементов управления с идентификаторами в диапазоне от AFX_IDW_CONTROLBAR_FIRST до AFX_IDW_CONTROLBAR_LAST. Обратите внимание, что, несмотря на существование 256 идентификаторов, особыми являются только первые 32 из них, поскольку они напрямую поддерживаются архитектурой предварительного просмотра.

Класс `CControlBar` предоставляет стандартную реализацию для выполнения следующих задач:

- выравнивание панели элементов управления по верхней, нижней или любой стороне фрейма;

- выделение массивов элементов управления;

- поддержка реализации производных классов.

Обычно объекты панели элементов управления C++ встраиваются как члены производного класса `CFrameWnd` и удаляются при уничтожении родительского элемента `HWND` и объекта. Если требуется выделить объект панели управления в куче, можно задать для члена *m_bAutoDestruct* значение **TRUE** , чтобы панель элементов управления выполняла действие**delete this**при удалении `HWND` .

> [!NOTE]
> Если вы `CControlBar`создаете свой собственный класс, полученный, а не используете `CStatusBar` `CToolBar`один `CDialogBar`из классов MFC, таких как , или, вам нужно будет установить *m_dwStyle* членов данных. Это может быть сделано в `Create`переопределение:

```
// CMyControlBar is derived from CControlBar
BOOL CMyControlBar::Create(CWnd* pParentWnd,
    DWORD dwStyle,
    UINT nID)
{
    m_dwStyle = dwStyle;

.
.
.
}
```

**Алгоритм макета панели элементов управления**

Алгоритм макета панели управления очень прост. Окно фрейма отправляет сообщение WM_SIZEPARENT всем дочерним элементам в диапазоне панели элементов управления. Вместе с этим сообщением передается указатель на клиентскую область родительского окна. Это сообщение отправляется дочерним элементам в Z-порядке. Дочерние элементы панели элементов управления используют эту информацию для определения своих положений и уменьшения размера клиентской области родительского окна. Конечная область, которая остается для обычной клиентской области (меньше панелей элементов управления), используется для размещения основного окна клиента (обычно это окно клиента MDI, представления или разделителя).

Дополнительные сведения см. в разделах `CWnd::RepositionBars` и `CFrameWnd::RecalcLayout` .

Личные сообщения MFC windows, включая WM_SIZEPARENT, задокументированы в [Техническом примечании 24](../mfc/tn024-mfc-defined-messages-and-resources.md).

## <a name="cstatusbar"></a><a name="_mfcnotes_cstatusbar"></a>Cstatusbar

Строка состояния представляет собой панель элементов управления со строкой панелей вывода текста. Существует два основных способа использования панелей вывода текста.

- В качестве строки сообщения

     (Например, строка сообщения стандартного меню "Справка".) Как правило, для доступа используется отсчитываемый от нуля индекс.

- В качестве индикаторов состояния

     (Например, индикаторы CAP, NUM и SCRL.) Как правило, для доступа используется идентификатор строки или команды.

В качестве шрифта строки состояния используется 10-точечный MS Sans Serif (согласно руководству по созданию приложений с интерфейсом Windows или программе отображения шрифта лучше всего соответствует 10-точечный пропорциональный шрифт Swiss). В некоторых версиях Windows, например для японского языка, применяются другие шрифты.

Цвета, используемые в строке состояния, также соответствуют рекомендациям в руководстве по созданию приложений с интерфейсом Windows. Эти цвета не являются фиксированными и динамически изменяются согласно пользовательским настройкам на панели управления.

|Item|Значение COLOR Windows|RGB по умолчанию|
|----------|-------------------------|-----------------|
|Фон строки состояния|COLOR_BTNFACE|RGB(192, 192, 192)|
|Текст строки состояния|COLOR_BTNTEXT|RGB(000, 000, 000)|
|Верхняя или левая границы строки состояния|COLOR_BTNHIGHLIGHT|RGB(255, 255, 255)|
|Нижняя или правая границы строки состояния|COLOR_BTNSHADOW|RGB(128, 128, 128)|

**Поддержка CCmdUI для CStatusBar**

Способ обновления индикаторов происходит через механизм ON_UPDATE_COMMAND_UI. Во время простоя строка состояния вызовет обработчик ON_UPDATE_COMMAND_UI с идентификатором строки панели индикатора.

Обработчик ON_UPDATE_COMMAND_UI может позвонить:

- `Enable`: Включить или отключить панель. Отключенная панель выглядит так же, как включенная, но текст невидим (то есть отключен индикатор текста).

- `SetText`: Изменить текст. Будьте внимательны при использовании этой функции, так как размер панели не меняется автоматически.

Подробные сведения об API создания и настройки [см. в описании класса](../mfc/reference/cstatusbar-class.md) CStatusBar *в* справочнике по библиотеке классов `CStatusBar` . Большая часть настроек строк состояния должна быть выполнена до их первоначального отображения.

Строка состояния поддерживает только одну панель растягивания, обычно первую. Размер этой панели фактически является минимальным размером. Если размер строки состояния превышает минимальный размер всех панелей, панели растягивания будет задано дополнительное значение ширины. В приложении по умолчанию со строкой состояния индикаторы для CAP, NUM и SCRL выровнены по правому краю, так как первая панель может растягиваться.

## <a name="ctoolbar"></a><a name="_mfcnotes_ctoolbar"></a>Ctoolbar

Панель инструментов представляет собой панель элементов управления со строкой кнопок с точечными рисунками, которые могут содержать разделители. Поддерживаются два стиля кнопок: нажимаемые кнопки и кнопки с флажками. Функциональность радиогруппы может быть построена с кнопками флажка и ON_UPDATE_COMMAND_UI.

Все кнопки с точечными рисунками на панели инструментов создаются из одного точечного рисунка. Этот рисунок должен содержать одно изображение или глиф для каждой кнопки. Как правило, порядок изображений или глифов в точечном рисунке совпадает с порядком их отображения на экране. (Его можно изменить с помощью API-интерфейсов настройки.)

Все кнопки должны быть одинакового размера. Размером по умолчанию является стандарт в 24x22 пикселя. Все изображения или глифы должны иметь одинаковый размер и располагаться на точечном рисунке рядом друг с другом. Размер образа и глифов по умолчанию — 16x15 пикселей. Таким образом, для панели инструментов с 10 кнопками (имеющими стандартные размеры) потребуется точеный рисунок 160 пикселей в ширину и 15 пикселей в высоту.

Каждая кнопка имеет только одно изображение или глиф. Разные состояния и стили кнопок (например, нажата, отключена, включена, нажата и недоступна, не определена) создаются алгоритмически из этого одного изображения или глифа. Теоретически можно использовать любой цветной точечный рисунок или DIB. Алгоритм создания разных состояний кнопки работает лучше всего, если исходное изображение состоит из оттенков серого. Примеры стандартных кнопок панели инструментов и картинки кнопки панели инструментов см. в примере [CLIPART](../overview/visual-cpp-samples.md) MFC.

Цвета, используемые на панели инструментов, также соответствуют рекомендациям в руководстве по созданию приложений с интерфейсом Windows. Эти цвета не являются фиксированными и динамически изменяются согласно пользовательским настройкам на панели управления.

|Item|Значение COLOR Windows|RGB по умолчанию|
|----------|-------------------------|-----------------|
|Фон панели инструментов|COLOR_BTNFACE|RGB(192,192,192)|
|Верхняя и левая границы кнопок панели инструментов|COLOR_BTNHIGHLIGHT|RGB(255,255,255)|
|Нижняя и правая границы кнопок панели инструментов|COLOR_BTNSHADOW|RGB(128,128,128)|

Кроме того, цвет кнопок с точечными рисунками панели инструментов изменен так, как если бы они были стандартными элементами управления кнопок Windows. Изменение цвета происходит при загрузке точечного рисунка из ресурса и в ответ на изменение системных цветов согласно пользовательским настройкам на панели управления. Следующие цвета на точечном рисунке панели инструментов будут изменены автоматически, поэтому их следует использовать с осторожностью. Если вы не хотите изменять цвет части точечного рисунка, используйте цвет, наиболее точно соответствующий сопоставленным значениям RGB. Сопоставление выполняется на основе точных значений RGB.

|Значение RGB|Динамически сопоставленное значение COLOR|
|---------------|------------------------------------|
|RGB(000, 000, 000)|COLOR_BTNTEXT|
|RGB(128, 128, 128)|COLOR_BTNSHADOW|
|RGB(192, 192, 192)|COLOR_BTNFACE|
|RGB(255, 255, 255)|COLOR_BTNHIGHLIGHT|

Подробные сведения об API создания и настройки [см. в описании класса](../mfc/reference/ctoolbar-class.md) CToolBar *в* справочнике по библиотеке классов `CToolBar` . Большая часть настроек панелей инструментов должна быть выполнена до их первоначального отображения.

API настройки можно использовать для корректировки идентификаторов, стилей, ширины кнопок и выбора изображений или глифов для конкретных кнопок. По умолчанию эти API не требуются.

## <a name="ccmdui-support-for-ctoolbar"></a>Поддержка CCmdUI для CToolBar

Кнопки панели инструментов постоянно обновляются через механизм ON_UPDATE_COMMAND_UI. Во время простоя панель инструментов вызовет обработчик ON_UPDATE_COMMAND_UI с идентификатором команды этой кнопки. ON_UPDATE_COMMAND_UI не называется для сепараторов, но он называется для пугнетов и кнопки флажок.

Обработчик ON_UPDATE_COMMAND_UI может позвонить:

- `Enable`: Включить или отключить кнопку. Она действует одинаково для кнопок и флажков.

- `SetCheck`: для задания проверки состояния кнопки. При вызове этой функции для кнопки панели инструментов кнопка будет преобразована во флажок. `SetCheck` принимает параметр, который может быть равен 0 (не установлен), 1 (установлен) или 2 (не определен).

- `SetRadio`: сокращение для `SetCheck`.

Флажки являются автоматическими, то есть при их установке они сразу же изменяют состояние. Установка — это отпущенное или отключенное состояние. Встроенный в пользовательский интерфейс способ перевода кнопки в неопределенное состояние отсутствует. Для этого нужно написать код.

AIs настройки позволят вам изменить состояние заданной кнопки панели инструментов, предпочтительно, вы должны изменить эти состояния в ON_UPDATE_COMMAND_UI обработчик для команды кнопки панели инструментов представляет. Помните, что простаивающая обработка изменит состояние кнопок панели инструментов с ON_UPDATE_COMMAND_UI обработчиком, поэтому любые изменения в этих состояниях, внесенные через SetButtonStyle, могут потеряться после очередного простоя.

Кнопки панели инструментов отправляют WM_COMMAND сообщения, такие как обычные кнопки или элементы меню, и обычно обрабатываются обработчиком ON_COMMAND в том же классе, который обеспечивает обработчик ON_UPDATE_COMMAND_UI.

Существует четыре стиля кнопок панели инструментов (TBBS_ <значения>), используемых для отображения состояний.

- TBBS_CHECKED: флажок установлен (нажат).

- TBBS_INDETERMINATE: флажок не определен.

- TBBS_DISABLED: кнопка отключена.

- TBBS_PRESSED: кнопка нажата.

Следующие значения TBBS представляют шесть официальных стилей кнопок согласно руководству по созданию приложений с интерфейсом Windows.

- Кнопка доступна — 0

- Мышь вниз - TBBS_PRESSED (&#124; любой другой стиль)

- Кнопка недоступна — TBBS_DISABLED

- Кнопка нажата — TBBS_CHECKED

- Вниз инвалидов - TBBS_CHECKED &#124; TBBS_DISABLED

- Неопределенное состояние кнопки — TBBS_INDETERMINATE

## <a name="cdialogbar"></a><a name="_mfcnotes_cdialogbar"></a>Cdialogbar

Диалоговая панель — это панель элементов управления со стандартными элементами управления Windows. Она функционирует аналогично диалоговому окну в том, что она содержит элементы управления и поддерживает переходы между ними. Она также действует как диалоговое окно в том, что для представления панели она использует шаблон диалогового окна.

`CDialogBar` используется для панели инструментов предварительного просмотра, содержащей стандартные элементы управления кнопок.

Использование `CDialogBar` аналогично `CFormView`. Необходимо определить шаблон диалогового окна для диалоговой панели и удалить все стили, кроме WS_CHILD. Обратите внимание, что диалоговое окно не должно отображаться.

Уведомления элементов управления для `CDialogBar` отправляются родительскому элементу панели элементов (как кнопки панели инструментов).

## <a name="ccmdui-support-for-cdialogbar"></a>Поддержка CCmdUI для CDialogBar

Кнопки панели Dialog должны обновляться через механизм обработчика ON_UPDATE_COMMAND_UI. В простое время диалоговая панель вызовет обработчик ON_UPDATE_COMMAND_UI с идентификатором команды всех кнопок, которые имеют идентификатор >0x8000 (т.е. в диапазоне идентификаторов команд).

Обработчик ON_UPDATE_COMMAND_UI может позвонить:

- Enable: для включения и отключения кнопки.

- SetText: для изменения текста кнопки.

Для настройки можно использовать стандартные API-интерфейсы диспетчера окон.

## <a name="see-also"></a>См. также раздел

[Технические примечания по номеру](../mfc/technical-notes-by-number.md)<br/>
[Технические заметки по категориям](../mfc/technical-notes-by-category.md)
