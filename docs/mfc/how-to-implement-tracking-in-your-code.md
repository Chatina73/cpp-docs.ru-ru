---
title: Практическое руководство. Реализация отслеживания в коде
ms.date: 11/04/2016
helpviewer_keywords:
- CRectTracker class [MFC], implementing trackers
ms.assetid: baaeca2c-5114-485f-bf58-8807db1bc973
ms.openlocfilehash: 3d71543261021c7e20041d317401b7b7b8d0616e
ms.sourcegitcommit: c21b05042debc97d14875e019ee9d698691ffc0b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/09/2020
ms.locfileid: "84621671"
---
# <a name="how-to-implement-tracking-in-your-code"></a>Практическое руководство. Реализация отслеживания в коде

Для трассировки элемента OLE необходимо обработка определенных событий, связанных с элементом, например щелчка элемента или обновления представления документа. Во всех случаях достаточно объявить временный объект [кректтраккер](reference/crecttracker-class.md) и манипулировать элементом с помощью этого объекта.

Когда пользователь выбирает элемент или вставляет объект с помощью команды меню, необходимо инициализировать инспектор с соответствующими стилями для представления состояния элемента OLE. В следующей таблице приведены соглашения, используемые образцом OCLIENT. Дополнительные сведения об этих стилях см. в разделе `CRectTracker` .

### <a name="container-styles-and-states-of-the-ole-item"></a>Стили и состояния контейнера элемента OLE

|Отображаемый стиль|Состояние элемента OLE|
|---------------------|-----------------------|
|Пунктирная граница|Элемент связан|
|Сплошная граница|Элемент внедрен в документ|
|Маркеры изменения размера|Элемент выбран|
|Заштрихованная граница|Элемент в настоящее время активен|
|Элемент наложения шаблона штриховки|Сервер элемента открыт|

Эту инициализацию можно легко реализовать с помощью процедуры, которая проверяет состояние элемента OLE и задает соответствующие стили. `SetupTracker`Функция, найденная в образце OCLIENT, демонстрирует инициализацию Tracker. Параметры этой функции являются адресом Tracker, *птраккер*; Указатель на клиентский элемент, связанный с объектом Tracker, *питем*; и указатель на прямоугольник, *птруерект*. Более полный пример этой функции см. в образце [OCLIENT](../overview/visual-cpp-samples.md)библиотеки MFC OLE.

Пример кода **сетуптраккер** представляет собой одну функцию. строки функции разделены на обсуждение функций функции:

[!code-cpp[NVC_MFCOClient#1](codesnippet/cpp/how-to-implement-tracking-in-your-code_1.cpp)]

Средство записи инициализируется путем установки минимального размера и очистки стиля средства записи.

[!code-cpp[NVC_MFCOClient#2](codesnippet/cpp/how-to-implement-tracking-in-your-code_2.cpp)]

Следующие строки проверяют, выбран ли элемент и связан ли он с документом или внедрен в него. Маркеры изменения размера, расположенные внутри границы, добавляются к стилю, указывая, что элемент выбран в данный момент. Если элемент связан с документом, используется стиль пунктирной границы. Если элемент внедрен, используется сплошная граница.

[!code-cpp[NVC_MFCOClient#3](codesnippet/cpp/how-to-implement-tracking-in-your-code_3.cpp)]

Следующий код накладывает элемент на заштрихованный шаблон, если элемент открыт в данный момент.

[!code-cpp[NVC_MFCOClient#4](codesnippet/cpp/how-to-implement-tracking-in-your-code_4.cpp)]

Затем эту функцию можно вызывать при каждом отображении средства записи. Например, вызовите эту функцию из `OnDraw` функции класса представления. Это обновляет внешний вид средства записи при перерисовки представления. Полный пример см. в описании `CMainView::OnDraw` функции примера [OCLIENT](../overview/visual-cpp-samples.md)библиотеки MFC OLE.

В приложении будут выполняться события, требующие кода отслеживания, например изменение размера, перемещение или обнаружение попадания. Эти действия обычно указывают на попытку захвата или перемещения элемента. В таких случаях необходимо решить, что было извлечено: маркер изменения размера или часть границы между маркерами изменения размера. `OnLButtonDown`Обработчик сообщений является хорошим местом для проверки позиции мыши относительно элемента. Выполните вызов `CRectTracker::HitTest` . Если тест возвращает что-то `CRectTracker::hitOutside` , кроме, размер элемента изменяется. Поэтому следует выполнить вызов `Track` функции-члена. `CMainView::OnLButtonDown`Полный пример см. в функции, расположенной в образце [OCLIENT](../overview/visual-cpp-samples.md) библиотеки MFC OLE.

`CRectTracker`Класс предоставляет несколько различных фигур курсоров, используемых для указания того, выполняется ли операция перемещения, изменения размера или перетаскивания. Чтобы обрабатывалось это событие, проверьте, выбран ли элемент, находящегося под указателем мыши. Если это так, сделайте вызов `CRectTracker::SetCursor` или вызовите обработчик по умолчанию. Ниже приведен пример из примера [OCLIENT](../overview/visual-cpp-samples.md)библиотеки MFC OLE:

[!code-cpp[NVC_MFCOClient#5](codesnippet/cpp/how-to-implement-tracking-in-your-code_5.cpp)]

## <a name="see-also"></a>См. также раздел

[Средства отслеживания. Реализация средств отслеживания в приложении OLE](trackers-implementing-trackers-in-your-ole-application.md)
