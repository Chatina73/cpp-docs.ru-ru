---
title: Практическое руководство. Реализация отслеживания в коде
ms.date: 11/04/2016
helpviewer_keywords:
- CRectTracker class [MFC], implementing trackers
ms.assetid: baaeca2c-5114-485f-bf58-8807db1bc973
ms.openlocfilehash: 0f037480e83b8ca1ba12af56904afe25a33e4d6c
ms.sourcegitcommit: c7f90df497e6261764893f9cc04b5d1f1bf0b64b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/05/2019
ms.locfileid: "58774468"
---
# <a name="how-to-implement-tracking-in-your-code"></a>Практическое руководство. Реализация отслеживания в коде

Чтобы отслеживать объект OLE, необходимо обрабатывать определенные события, связанные с этим элементом, например при выборе пункта или обновляющему представление документа. Во всех случаях достаточно объявить временную [CRectTracker](../mfc/reference/crecttracker-class.md) объекта и манипуляции элементом, с помощью этого объекта.

Когда пользователь выбирает элемент, или вставляет объект с помощью команды меню, необходимо инициализировать средство отслеживания с использованием правильного стилей для представления состояния объекта OLE. В следующей таблице описываются соглашения, используемые в образце OCLIENT. Дополнительные сведения об этих стилей, см. в разделе `CRectTracker`.

### <a name="container-styles-and-states-of-the-ole-item"></a>Стили контейнера и состояния объекта OLE

|Стиль отображения|Состояние элемента управления OLE|
|---------------------|-----------------------|
|Пунктирная граница|Элемент связан|
|Сплошная граница|Элемент внедряется в документ|
|Маркеры изменения размера|Выбранного элемента|
|Штриховой границей|Элемент является активным в данный момент на месте|
|Элемент наложений шаблон штриховки|Сервер для элемента открыт|

Можно обработать эту инициализацию с помощью процедуры, которая проверяет состояние объекта OLE и устанавливает подходящие стили. `SetupTracker` Функция найдена в образце OCLIENT показана инициализация tracker. Параметры для этой функции являются адрес средства отслеживания, *pTracker*; указатель на элемент клиента, который связан с отслеживанием, *pItem*; и указатель на прямоугольник, *pTrueRect* . Более полный пример этой функции, см. в разделе примера MFC OLE [OCLIENT](../overview/visual-cpp-samples.md).

**SetupTracker** пример кода представляет одну функцию; строки функции смешиваются с обсуждения возможностей функции:

[!code-cpp[NVC_MFCOClient#1](../mfc/codesnippet/cpp/how-to-implement-tracking-in-your-code_1.cpp)]

Средство отслеживания инициализируется путем установки минимальный размер и стиль объекта отслеживания очистки.

[!code-cpp[NVC_MFCOClient#2](../mfc/codesnippet/cpp/how-to-implement-tracking-in-your-code_2.cpp)]

Следующие строки проверьте, выбран ли элемент в данный момент, и связанный с этим документом или внедренный в него элемента. Маркеры изменения размера, расположенных внутри границы добавляются к стилю, указывающее, что элемент выбран в данный момент. Если элемент связан документ, используется стиль пунктирная граница. Сплошная граница используется в том случае, если элемент является внедренным.

[!code-cpp[NVC_MFCOClient#3](../mfc/codesnippet/cpp/how-to-implement-tracking-in-your-code_3.cpp)]

Следующий код наложений откройте элемент с заштрихованный шаблон, если элемент в данный момент.

[!code-cpp[NVC_MFCOClient#4](../mfc/codesnippet/cpp/how-to-implement-tracking-in-your-code_4.cpp)]

Затем можно вызвать эту функцию, каждый раз, когда средство отслеживания должен быть отображен. Например, вызов этой функции из `OnDraw` функция класса представления. Это обновляет внешний вид окна инспектора всякий раз, когда метод Invalidate используется представление. Полный пример см. в разделе `CMainView::OnDraw` функция примера MFC OLE [OCLIENT](../overview/visual-cpp-samples.md).

В приложении события, которые требуют кода регистрации, например обнаружение изменения размера, перемещение или нажатия, произойдет. Эти действия обычно указывают на то что выполняется попытка взять или переместить элемент. В этих случаях необходимо решить, что был извлечен: маркер изменения размера или его части границы между маркерами изменения размера. `OnLButtonDown` Обработчик сообщений отлично подходит для тестирования положение указателя мыши относительно элемента. Вызвать `CRectTracker::HitTest`. Если тест возвращает отличное `CRectTracker::hitOutside`, элемент является изменить размер или перемещен. Таким образом, вы должны Позвонить `Track` функция-член. См. в разделе `CMainView::OnLButtonDown` функция обнаружена в образце MFC OLE [OCLIENT](../overview/visual-cpp-samples.md) полный пример.

`CRectTracker` Класс предоставляет несколько фигур другой курсор, используемый для указания, перемещения, изменение размера или перетащите выполняется операция. Чтобы обработать это событие, проверьте, выбран ли элемент в данный момент под указателем мыши. Если это так, отправьте вызов в `CRectTracker::SetCursor`, или вызывать обработчик по умолчанию. Следующий пример взят из примера MFC OLE [OCLIENT](../overview/visual-cpp-samples.md):

[!code-cpp[NVC_MFCOClient#5](../mfc/codesnippet/cpp/how-to-implement-tracking-in-your-code_5.cpp)]

## <a name="see-also"></a>См. также

[Средства отслеживания. Реализация средств отслеживания в приложении OLE](../mfc/trackers-implementing-trackers-in-your-ole-application.md)
