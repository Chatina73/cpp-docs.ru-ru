---
title: Многостраничные документы
ms.date: 11/19/2018
helpviewer_keywords:
- pagination [MFC]
- overriding [MFC], View class functions for printing
- OnPrepareDC method [MFC]
- CPrintInfo structure [MFC], multipage documents
- OnEndPrinting method [MFC]
- protocols [MFC], printing protocol
- document pages vs. printer pages [MFC]
- printer mode [MFC]
- printing [MFC], multipage documents
- printers [MFC], printer mode
- documents [MFC], printing
- OnPreparePrinting method [MFC]
- OnPrint method [MFC]
- DoPreparePrinting method and pagination [MFC]
- OnDraw method [MFC], printing
- pagination [MFC], printing multipage documents
- printing [MFC], protocol
- pages [MFC], printing
- OnBeginPrinting method [MFC]
- multipage documents [MFC]
- printing [MFC], pagination
- documents [MFC], paginating
ms.assetid: 69626b86-73ac-4b74-b126-9955034835ef
ms.openlocfilehash: b4ec9f456443b9cd180f1558946829281bc10a36
ms.sourcegitcommit: 9e891eb17b73d98f9086d9d4bfe9ca50415d9a37
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/20/2018
ms.locfileid: "52176384"
---
# <a name="multipage-documents"></a>Многостраничные документы

В этой статье описывается протокол печати Windows и описание печати документов, содержащих более одной страницы. В статье рассматриваются следующие темы:

- [Протокол печати](#_core_the_printing_protocol)

- [Переопределение функции класса представлений](#_core_overriding_view_class_functions)

- [Разбиение на страницы](#_core_pagination)

- [Страницы принтера и страницы документа](#_core_printer_pages_vs.._document_pages)

- [Разбиение на страницы во время печати](#_core_print.2d.time_pagination)

##  <a name="_core_the_printing_protocol"></a> Протокол печати

Для печати многостраничные документа framework и представление взаимодействовать следующим образом. Во-первых, платформа отображает **печати** диалоговом окне создает контекст устройства принтера и вызовы [StartDoc](../mfc/reference/cdc-class.md#startdoc) функцию-член [CDC](../mfc/reference/cdc-class.md) объекта. Затем для каждой страницы документа, платформа вызывает [StartPage](../mfc/reference/cdc-class.md#startpage) функцию-член `CDC` объекта, указывает, что объект представления для печати страницы, а вызовы [EndPage](../mfc/reference/cdc-class.md#endpage) функция-член. Если необходимо изменить режим печати до запуска определенной страницы, представление вызывает [ResetDC](../mfc/reference/cdc-class.md#resetdc), какие обновления [DEVMODE](/windows/desktop/api/wingdi/ns-wingdi-_devicemodea) структура, содержащая сведения о новом режиме принтера. Весь документ после печати, платформа вызывает [EndDoc](../mfc/reference/cdc-class.md#enddoc) функция-член.

##  <a name="_core_overriding_view_class_functions"></a> Переопределение функции класса представлений

[CView](../mfc/reference/cview-class.md) класс определяет несколько функций-членов, которые вызываются средой во время печати. Переопределение этих функций в классе представления, предоставляет соединения между логики печати платформы и класс представления логики печати. В следующей таблице перечислены эти функции-члены.

### <a name="cviews-overridable-functions-for-printing"></a>Переопределяемые функции в CView для печати

|name|Причина переопределения|
|----------|---------------------------|
|[OnPreparePrinting](../mfc/reference/cview-class.md#onprepareprinting)|Чтобы вставить значения в диалоговом окне печати особенно длину документа|
|[OnBeginPrinting](../mfc/reference/cview-class.md#onbeginprinting)|Для выделения шрифтов или других ресурсов GDI|
|[OnPrepareDC](../mfc/reference/cview-class.md#onpreparedc)|Для настройки атрибутов контекста устройства для данной страницы, или провести разбиение на страницы во время печати|
|[OnPrint](../mfc/reference/cview-class.md#onprint)|Для печати на данной странице|
|[OnEndPrinting](../mfc/reference/cview-class.md#onendprinting)|Отменить выделение ресурсов GDI|

Можно сделать обработки, связанные с печатью, в другие функции, но эти функции являются те, которые управляют процесс печати.

На следующем рисунке показана последовательность действий, участвующие в процессе печати и показано, где каждый из `CView`для печати члена при вызове функций для работы. В оставшейся части этой статьи приводится объяснение для большинства из этих действий более подробно. В этой статье описаны дополнительные части процесса печати [выделение ресурсов GDI](../mfc/allocating-gdi-resources.md).

![Процесс цикла печати](../mfc/media/vc37c71.gif "процесс цикла печати") <br/>
Цикла печати

##  <a name="_core_pagination"></a> Разбиение на страницы

Framework хранит большое количество информации о задание на печать в [CPrintInfo](../mfc/reference/cprintinfo-structure.md) структуры. Несколько значений в `CPrintInfo` относятся к разбиению на страницы; эти значения доступны, как показано в следующей таблице.

### <a name="page-number-information-stored-in-cprintinfo"></a>Номер страницы сведений, хранящихся в CPrintInfo

|Переменная-член или<br /><br /> имя функции|Ссылка на номер страницы|
|-----------------------------------------------|----------------------------|
|`GetMinPage`/`SetMinPage`|Первой страницы документа|
|`GetMaxPage`/`SetMaxPage`|Последней страницы документа|
|`GetFromPage`|Первой страницы для печати|
|`GetToPage`|Последней страницы для печати|
|`m_nCurPage`|В настоящее время печатаемой страницы|

Страница номера начинаются с 1, то есть первая страница нумеруется 1, не равен 0. Дополнительные сведения об этих и других членов [CPrintInfo](../mfc/reference/cprintinfo-structure.md), см. в разделе *Справочник по библиотеке MFC*.

В начале процесса печати, платформа вызывает представления [OnPreparePrinting](../mfc/reference/cview-class.md#onprepareprinting) функция-член, передав указатель на `CPrintInfo` структуры. Мастер приложений предоставляет реализацию `OnPreparePrinting` , который вызывает [метод DoPreparePrinting](../mfc/reference/cview-class.md#doprepareprinting), другую функцию-член `CView`. `DoPreparePrinting` — Это функция, которая отображает диалоговое окно «Печать» и создает контекст устройства принтера.

На этом этапе приложение не знает, сколько страниц в документе. Он использует значения по умолчанию 1 и 0xFFFF для номеров первой и последней страницы документа. Если вы знаете, сколько страниц у документа, переопределить `OnPreparePrinting` и вызвать [SetMaxPage]--brokenlink--(reference/cprintinfo-class.md#setmaxpage) для `CPrintInfo` структуры перед его отправкой `DoPreparePrinting`. Это позволит вам указать длину документа.

`DoPreparePrinting` затем отображается диалоговое окно «Печать». При возвращении `CPrintInfo` структура содержит значения, указанные пользователем. Если пользователь хочет печатать только выбранный диапазон страниц, он или она можно указать начальный и конечный номера страниц в диалоговом окне печати. Платформа извлекает эти значения, используя `GetFromPage` и `GetToPage` функции [CPrintInfo](../mfc/reference/cprintinfo-structure.md). Если пользователь не укажет диапазон страниц, платформа вызывает `GetMinPage` и `GetMaxPage` и использует значения, возвращенные Печать всего документа.

Для каждой страницы документа на печать, платформа вызывает две функции-члена в классе представления, [OnPrepareDC](../mfc/reference/cview-class.md#onpreparedc) и [OnPrint](../mfc/reference/cview-class.md#onprint)и передает каждой функции два параметра: указатель на [ CDC](../mfc/reference/cdc-class.md) объекта и указатель на `CPrintInfo` структуры. Каждый раз, когда платформа вызывает `OnPrepareDC` и `OnPrint`, он передает значение в *m_nCurPage* членом `CPrintInfo` структуры. Таким образом платформа указывает представлению какие страницы следует печатать.

[OnPrepareDC](../mfc/reference/cview-class.md#onpreparedc) функция-член также используется для отображения на экране. Прежде чем рисование выполняется в результате корректировки контекста устройства. `OnPrepareDC` выполняет ту же роль в печати, но существует несколько различий: во-первых, `CDC` представляет контекст устройства принтера, вместо экрана контекста устройства и второй, `CPrintInfo` объект передается в качестве второго параметра. (Этот параметр является **NULL** при `OnPrepareDC` вызывается для отображения на экране.) Переопределить `OnPrepareDC` для корректировки контекст устройства, в зависимости от того, какую страницу, печатается. Например можно переместить начало координат окна просмотра и области обрезки, чтобы убедиться, что возвращает напечатать соответствующую часть документа.

[OnPrint](../mfc/reference/cview-class.md#onprint) функция-член выполняет фактическую печать страницы. Статья [как по умолчанию печати делается](../mfc/how-default-printing-is-done.md) показано, как платформа вызывает [OnDraw](../mfc/reference/cview-class.md#ondraw) с контекст устройства принтера для выполнения печати. Точнее, платформа вызывает `OnPrint` с `CPrintInfo` структуры и контекста устройства и `OnPrint` передает контекст устройства для `OnDraw`. Переопределить `OnPrint` для выполнения любой отрисовки, которая должна быть выполнена только во время печати, а не для отображения на экране. Например, чтобы распечатать верхний и нижний колонтитулы (см. в статье [верхние и нижние колонтитулы](../mfc/headers-and-footers.md) Дополнительные сведения). Затем вызовите `OnDraw` из переопределение метода `OnPrint` для подготовки отчетов, общие для и дисплеем и печати.

Тот факт, `OnDraw` осуществляет отрисовку и отображение на экране и печати означает, что приложение WYSIWYG: «вы видите — мы получаем.» Однако предположим, что не перезаписывают записи WYSIWYG приложения. Например рассмотрим текстовый редактор, который использует полужирного шрифта для печати, но отображает коды элементов управления, чтобы указать полужирный текст на экране. В таком случае используйте `OnDraw` исключительно для отображения на экране. При переопределении `OnPrint`, замените вызов `OnDraw` с помощью вызова отдельной функции рисования. Эта функция рисует документа способ отображения на бумаге, с помощью атрибутов, которые не отображать на экране.

##  <a name="_core_printer_pages_vs.._document_pages"></a> Vs страниц принтера. Страницы документа

При ссылке на номера страниц, иногда бывает необходимо различать принтера понятие страницы и документа понятие страницы. С точки зрения принтер страницы — одного листа бумаги. Тем не менее одного листа бумаги не обязательно равно одну страницу документа. Например при печати информационный бюллетень, где листы, который необходимо свернуть одного листа бумаги может содержать первой и последней страницах документа, рядом друг с другом. Аналогично при печати электронную таблицу, документ не состоят из страниц вообще. Вместо этого одного листа бумаги может содержать от 1 до 20, столбцы с 6 по 10 строк.

Все страницы числа в [CPrintInfo](../mfc/reference/cprintinfo-structure.md) структуры см. страницы принтера. Платформа вызывает `OnPrepareDC` и `OnPrint` один раз для каждого листа бумаги, которая будет проходить через принтера. При переопределении [OnPreparePrinting](../mfc/reference/cview-class.md#onprepareprinting) функции, чтобы указать длину документа, необходимо использовать страницы принтера. Если имеется однозначное соответствие (то есть один страницы принтера равен одной странице документа), то это просто. Если, с другой стороны, страницы документа и принтера не соответствуют напрямую, необходимо преобразовать между ними. Например рассмотрим печать в электронную таблицу. При переопределении метода `OnPreparePrinting`, необходимо вычислить, сколько листов бумаги потребуется для печати всей таблицы и затем использовать это значение при вызове `SetMaxPage` функцию-член `CPrintInfo`. Аналогичным образом Переопределяя `OnPrepareDC`, необходимо преобразовать *m_nCurPage* в диапазоне строк и столбцов, которые будут отображаться на данной конкретной страницы и затем соответствующим образом изменить начало координат окна просмотра.

##  <a name="_core_print.2d.time_pagination"></a> Разбиение на страницы во время печати

В некоторых ситуациях классе представления, может не знать заранее как долго действует документ, пока он фактически печати. Например предположим, что ваше приложение не WYSIWYG, поэтому длина документа на экране не соответствует его длина при печати.

Это вызывает проблему, при переопределении [OnPreparePrinting](../mfc/reference/cview-class.md#onprepareprinting) для представления класса: невозможно передать значение `SetMaxPage` функции [CPrintInfo](../mfc/reference/cprintinfo-structure.md) структуры, так как вы не знаете, длина документ. Если пользователь не укажет номер страницы для остановки в диалоговом окне «Печать», платформа не знает, когда нужно прекратить печати цикла. Единственный способ определить, когда для остановки цикла печати — печати документа и см. в разделе по ее завершении. Время, печатается и затем информировать платформой, когда будет достигнут конец классе представления, необходимо проверить в конец документа.

Платформа использует класс представления [OnPrepareDC](../mfc/reference/cview-class.md#onpreparedc) функция о том, когда нужно прекратить. После каждого вызова `OnPrepareDC`, платформа проверяет, является членом `CPrintInfo` структуру, называемую *m_bContinuePrinting*. Значение по умолчанию — **значение TRUE.** До тех пор, пока он остается, поэтому платформа продолжения цикла печати. Если он становится равным **FALSE**, framework останавливается. Чтобы выполнить разбиение на страницы во время печати, переопределите `OnPrepareDC` проверяемый ли конец документа был достигнут и задать *m_bContinuePrinting* для **FALSE** когда на него установлен.

Реализация по умолчанию `OnPrepareDC` задает *m_bContinuePrinting* для **FALSE** Если текущая страница больше 1. Это означает, что если длина документа не был указан, framework предполагает, что документ состоит из одной страницы, долго. Следствием этого является, необходимо соблюдать осторожность при вызове метода базового класса версию `OnPrepareDC`. Не предполагается, что *m_bContinuePrinting* будет **TRUE** после вызова версии базового класса.

### <a name="what-do-you-want-to-know-more-about"></a>Выберите для получения дополнительных сведений

- [Верхние и нижние колонтитулы](../mfc/headers-and-footers.md)

- [Выделение ресурсов GDI](../mfc/allocating-gdi-resources.md)

## <a name="see-also"></a>См. также

[Печать](../mfc/printing.md)<br/>
[Класс CView](../mfc/reference/cview-class.md)<br/>
[Класс CDC](../mfc/reference/cdc-class.md)