---
title: Элементы управления ActiveX в Интернете
ms.date: 09/12/2018
helpviewer_keywords:
- ActiveX controls [MFC], creating
- ActiveX controls [MFC], Internet
- downloading data with ActiveX controls
- OLE controls [MFC], upgrading to ActiveX
- Internet applications [MFC], ActiveX controls
- networks [MFC], downloading with ActiveX controls
ms.assetid: 7ab943c8-2022-41df-9065-d629b616eeec
ms.openlocfilehash: c019c922a5690d4ead861c40bed3c0c1c76cea28
ms.sourcegitcommit: c3093251193944840e3d0a068ecc30e6449624ba
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/04/2019
ms.locfileid: "57283011"
---
# <a name="activex-controls-on-the-internet"></a>Элементы управления ActiveX в Интернете

Элементы управления ActiveX являются обновленную версию спецификации элемента управления OLE.

>[!IMPORTANT]
> ActiveX — это устаревшая технология, которая не следует использовать для разработки новых приложений. Дополнительные сведения см. в разделе [элементы управления ActiveX](activex-controls.md).

Элементы управления являются основной архитектуры для разработки программных компонентов, которые могут использоваться в различных контейнерах, включая COM с поддержкой веб-браузеров в Интернете. Любой элемент управления ActiveX может быть элемент управления Internet и можно добавить его функциональность в активном документе или быть частью веб-страницы. Элементы управления веб-страницы могут взаимодействовать друг с другом с помощью скриптов.

Элементы управления ActiveX не ограничиваются Интернет. Элемент управления ActiveX может также использоваться в любом контейнере, до тех пор, пока элемент управления поддерживает интерфейсы, необходимые в этом контейнере.

**Элементы управления ActiveX имеет несколько преимуществ, включая:**

- Меньше необходимые интерфейсы, чем предыдущие элементы управления OLE.

- Возможность иметь окон и всегда локально активными.

**Чтобы иметь элемент управления ActiveX, элемент управления должен:**

- Поддержка `IUnknown` интерфейс.

- Быть COM-объекта.

- Экспорт **DLLRegisterServer** и **DLLUnRegisterServer**.

- Поддерживает дополнительные интерфейсы, необходимые для функции.

## <a name="making-your-existing-controls-internet-friendly"></a>Что делает ваши существующие элементы управления Интернета с поддержкой

Разработка элемента управления, который будет хорошо работать в среде Интернета требует рассмотрения ставки относительно медленной линии в Интернете. Можно использовать существующие элементы управления; Тем не менее существуют действия, которые следует предпринять уменьшить размер вашего кода, чтобы загрузить асинхронно свойства элемента управления.

Чтобы повысить производительность для элементов управления, следуйте приведенным ниже советам по эффективности:

- Реализуйте методы, описанные в статье [элементы управления ActiveX: Оптимизация](../mfc/mfc-activex-controls-optimization.md).

- Рассмотрим, как создается экземпляр элемента управления.

- Быть асинхронным; не выдерживает другие программы.

- Загрузите данные в небольших блоков.

   При загрузке больших потоков, таких как растровые изображения или видео данные, доступ к данным элемента управления асинхронно в сотрудничестве с контейнером. Получить данные в режиме добавочное или последовательной, совместная работа с другими элементами управления, которые также могут извлекаться данные. Также можно асинхронную загрузку кода.

- Загрузите код и свойства в фоновом режиме.

- Стать пользовательского интерфейса active как можно быстрее.

- Рассмотрим способ хранения постоянных данных, свойства и больших объемов данных BLOB-объекты (например, данные изображения или видео для растрового изображения).

   Элементы управления, с помощью значимое количество постоянных данных, например больших растровых изображений или файлов AVI, требуют внимательного отношения к загрузке метод. Документ или страницу можно становятся видимыми как можно скорее и разрешить пользователю взаимодействовать со страницей, а элементы управления получения данных в фоновом режиме.

- Писать эффективные процедуры, чтобы сохранить размер кода и время выполнения.

   Небольших элементов управления кнопку и метку, с помощью всего нескольких байтов постоянных данных, которые подходят для использования в среде Интернета и работу также в браузерах.

- Рассмотрите возможность ход выполнения передается в контейнер.

   Уведомление о контейнере хода выполнения асинхронной загрузки, включая время пользователь может запустить взаимодействовать со страницей, и после завершения загрузки. Контейнер можно отобразить ход выполнения (таких как процент завершения) для пользователя.

- Рассмотрим, как элементы управления регистрируются на клиентском компьютере.

## <a name="creating-a-new-activex-control"></a>Создание нового элемента управления ActiveX

При создании нового элемента управления с помощью мастера приложений, вы можете включить поддержку асинхронных моникеров, а также другие оптимизации. Чтобы добавить поддержку для асинхронной загрузки свойств элемента управления, выполните следующие действия.

#### <a name="to-create-your-project-using-the-mfc-activex-control-wizard"></a>Для создания проекта с помощью мастера элементов управления ActiveX MFC

1. Нажмите кнопку **New** на **файл** меню.

1. Выберите **мастер элементов управления ActiveX MFC** из Visual C++ проектов и имя проекта.

1. На **параметры управления** выберите **асинхронно загружает свойства**. При выборе этого параметра устанавливает свойство состоянии "Готово" и событие изменения состояния готовности для вас.

   Можно также выбрать другие виды оптимизации, такие как **активации без окна**, который описан в [элементы управления ActiveX: Оптимизация](../mfc/mfc-activex-controls-optimization.md).

1. Выберите **Готово** для создания проекта.

#### <a name="to-create-a-class-derived-from-cdatapathproperty"></a>Чтобы создать класс, производный от CDataPathProperty

1. Создайте класс, производный от `CDataPathProperty`.

1. В каждом из исходных файлов, которая включает файл заголовка для элемента управления добавьте файл заголовка для данного класса перед ним.

1. В этом классе переопределите `OnDataAvailable`. Эта функция вызывается, когда данные будут доступны для отображения. Как данные становятся доступными, его можно обработать любым способом, выбираемый, например, постепенно его отображением.

   Фрагмент кода ниже приведен простой пример постепенно отображения данных в элемент управления редактированием. Обратите внимание на использование флага **BSCF_FIRSTDATANOTIFICATION** очистить поле ввода.

   [!code-cpp[NVC_MFCActiveXControl#1](../mfc/codesnippet/cpp/activex-controls-on-the-internet_1.cpp)]

   Обратите внимание на то, что необходимо включить AFXCMN. H, чтобы использовать `CListCtrl` класса.

1. При общий элемент управления состояние меняется (например, с загрузки на инициализированный или интерактивного пользователя), вызов `COleControl::InternalSetReadyState`. Если элемент управления имеет свойство данных только один путь, можно добавить код в **BSCF_LASTDATANOTIFICATION** для уведомления в контейнер, что загрузка завершена. Пример:

   [!code-cpp[NVC_MFCActiveXControl#2](../mfc/codesnippet/cpp/activex-controls-on-the-internet_2.cpp)]

1. Переопределите метод `OnProgress`. В `OnProgress`, передается номер, показывающий максимальный диапазон, и число отображается насколько оно Продвинулось текущей загрузки именно. Эти числа можно использовать для отображения состояния, таких как процент завершения для пользователя.

Следующая процедура добавляет свойство к элементу управления использовать только производный класс.

#### <a name="to-add-a-property"></a>Чтобы добавить свойство

1. В **представление классов**, щелкните правой кнопкой мыши интерфейс в узле библиотеки и выберите **добавить**, затем **добавить свойство**. После этого будет запущена **мастер добавления свойств**.

1. В **мастер добавления свойств**выберите **методы Set или Get** "переключатель", тип **имя свойства**, например, EditControlText и выберите BSTR как **Тип свойства**.

1. Нажмите кнопку **Готово**.

1. Объявите переменную-член вашей `CDataPathProperty`-производный класс в классе элемента управления ActiveX.

   [!code-cpp[NVC_MFCActiveXControl#3](../mfc/codesnippet/cpp/activex-controls-on-the-internet_3.h)]

1. Реализуйте методы `Get/Set`. Для `Get`, возвращается строка. Для `Set`, загрузить свойство и вызвать `SetModifiedFlag`.

   [!code-cpp[NVC_MFCActiveXControl#4](../mfc/codesnippet/cpp/activex-controls-on-the-internet_4.cpp)]

1. В [DoPropExchange](../mfc/reference/colecontrol-class.md#dopropexchange), добавьте следующую строку:

   [!code-cpp[NVC_MFCActiveXControl#5](../mfc/codesnippet/cpp/activex-controls-on-the-internet_5.cpp)]

1. Переопределить [ResetData](../mfc/reference/cdatapathproperty-class.md#resetdata) для уведомления, свойство которого требуется сбросить его элемента управления, добавив следующую строку:

   [!code-cpp[NVC_MFCActiveXControl#6](../mfc/codesnippet/cpp/activex-controls-on-the-internet_6.cpp)]

## <a name="deciding-whether-to-derive-from-cdatapathproperty-or-ccacheddatapathproperty"></a>Решите, следует ли получать из CDataPathProperty или CCachedDataPathProperty

Предыдущий пример описывает шаги для создания производного элемента управления свойства из `CDataPathProperty`. Это хороший подход, если требуется загрузить данные в реальном времени, часто изменяются, и для которого не нужно хранить все данные, но только текущее значение. Например, элемент управления биржевые сводки.

Можно также являются производными от `CCachedDataPathProperty`. В этом случае загруженные данные кэшируются в памяти файла. Это хороший подход, если необходимо сохранить все загруженные данные — например, элемент управления, который постепенно отображает точечный рисунок. В этом случае класс имеет переменную-член с вашими данными:

`CMemFile m_Cache;`

В классе элемента управления ActiveX, можно использовать этот отображенный в памяти файл в `OnDraw` для отображения данных. В элементе управления ActiveX `CCachedDataPathProperty`-производного класса Переопределите функцию-член `OnDataAvailable` и сделать недействительным элемент управления, после вызова реализации базового класса.

[!code-cpp[NVC_MFCActiveXControl#7](../mfc/codesnippet/cpp/activex-controls-on-the-internet_7.cpp)]

## <a name="downloading-data-asynchronously-using-activex-controls"></a>Загрузка данных в асинхронном режиме с помощью элементов управления ActiveX

Загрузка данных в сети должны выполняться асинхронно. Это так удобен, если передается большой объем данных, или если подключение работает медленно, процесс загрузки не будет блокировать другие процессы на клиентском компьютере.

Асинхронные моникеры предоставляют способ загрузки данных асинхронно по сети. Операция чтения на асинхронным моникером возвращает немедленно, даже если операция не завершена.

Например если только 10 байт, доступны и чтения вызывается асинхронно с файлом 1 КБ, чтения не блокирует, но возвращает с сейчас доступно 10 байт.

Вы реализуете [асинхронных моникеров](../mfc/asynchronous-monikers-on-the-internet.md) с помощью `CAsyncMonikerFile` класса. Тем не менее, можно использовать элементы управления ActiveX `CDataPathProperty` класс, который является производным от `CAsyncMonikerFile`, чтобы реализовать асинхронный элемент управления свойства.

## <a name="displaying-a-control-on-a-web-page"></a>Отображение элемента управления на веб-странице

Ниже приведен пример тег object и атрибуты для добавления элемента управления на веб-странице.

```xml
<OBJECT
  CLASSID="clsid:FC25B780-75BE-11CF-8B01-444553540000"
  CODEBASE="/ie/download/activex/iechart.ocx"
  ID=chart1
  WIDTH=400
  HEIGHT=200
  ALIGN=center
  HSPACE=0
  VSPACE=0>
  <PARAM NAME="BackColor" value="#ffffff"/>
  <PARAM NAME="ForeColor" value="#0000ff"/>
  <PARAM NAME="url" VALUE="/ie/controls/chart/mychart.txt"/>
</OBJECT>
```

## <a name="updating-an-existing-ole-control-to-use-new-activex-control-features"></a>Обновление существующего элемента управления OLE для использования новых возможностей элемента управления ActiveX

Если элемент управления OLE была создана с помощью версии Visual C++ до 4.2, существуют действия, которые можно предпринять для повышения его производительности и расширить его функциональные возможности. Подробное описание этих изменений, см. в разделе [элементы управления ActiveX: Оптимизация](../mfc/mfc-activex-controls-optimization.md).

При добавлении поддержки асинхронного свойства для существующего элемента управления, необходимо добавить свойство состоянии "Готово" и `ReadyStateChange` событий самостоятельно. В конструкторе для элемента управления добавьте следующую команду:

[!code-cpp[NVC_MFCActiveXControl#8](../mfc/codesnippet/cpp/activex-controls-on-the-internet_8.cpp)]

Как код загружается путем вызова обновит состояние готовности [COleControl::InternalSetReadyState](../mfc/reference/colecontrol-class.md#internalsetreadystate). Централизованно, можно вызвать `InternalSetReadyState` из `OnProgress` переопределения `CDataPathProperty`-производного класса.

## <a name="see-also"></a>См. также

[Задачи программирования для интернет-решений MFC](../mfc/mfc-internet-programming-tasks.md)<br/>
[Основы программирования для интернет-решений MFC](../mfc/mfc-internet-programming-basics.md)
