---
title: 'Элементы ActiveX в MFC: Локализация элемента управления ActiveX | Документация Майкрософт'
ms.custom: ''
ms.date: 09/12/2018
ms.technology:
- cpp-mfc
ms.topic: conceptual
f1_keywords:
- LocaleID
- AfxOleRegisterTypeLib
dev_langs:
- C++
helpviewer_keywords:
- localization, ActiveX controls
- MFC ActiveX controls [MFC], localizing
- LocaleID ambient property [MFC]
- LOCALIZE sample [MFC]
ms.assetid: a44b839a-c652-4ec5-b824-04392708a5f9
author: mikeblome
ms.author: mblome
ms.workload:
- cplusplus
ms.openlocfilehash: fb31eb15a61f1d4cbee7ba7402de508a84124461
ms.sourcegitcommit: a3c9e7888b8f437a170327c4c175733ad9eb0454
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/29/2018
ms.locfileid: "50204708"
---
# <a name="mfc-activex-controls-localizing-an-activex-control"></a>Элементы управления ActiveX в MFC. Локализация элемента управления ActiveX

В этой статье рассматриваются процедуры для локализации интерфейсов элемента управления ActiveX.

>[!IMPORTANT]
> ActiveX — это устаревшая технология, которая не следует использовать для разработки новых приложений. Дополнительные сведения о современных технологий, заменяющие ActiveX, см. в разделе [элементы управления ActiveX](activex-controls.md).

Если вы хотите адаптировать элемент управления ActiveX для международного рынка, может потребоваться локализации элемента управления. Windows поддерживает множество языков, а также по умолчанию английский, немецкий, французский и шведский. Это может вызвать проблемы для элемента управления, если его интерфейс на английском языке только.

Как правило элементы управления ActiveX всегда следует строить языковый стандарт на внешнее свойство LocaleID. Это можно сделать тремя способами:

- Загрузка ресурсов, всегда по запросу, на основе текущего значения свойства окружения LocaleID. Элементы ActiveX в MFC образец [LOCALIZE](../visual-cpp-samples.md) применяет эту стратегию.

- Загрузка ресурсов, при этом случае первый элемент управления, основываясь на свойстве LocaleID окружающей среды и использовать эти ресурсы для всех других экземпляров. В этой статье демонстрируется эта стратегия.

    > [!NOTE]
    >  Это не будет работать в некоторых случаях, если будущих экземпляры имеют разные языковые стандарты.

- Используйте `OnAmbientChanged` функции уведомления для динамической загрузки соответствующих ресурсов для контейнера языкового стандарта.

    > [!NOTE]
    >  Это будет работать для элемента управления, но библиотеки DLL времени выполнения не обновит динамически собственные ресурсы при изменении свойства окружения LocaleID. Кроме того библиотеки DLL времени выполнения для элементов управления ActiveX использовать национальную настройку потока для определения языкового стандарта для его ресурсов.

В оставшейся части в этой статье описываются две стратегии локализацию. Первая стратегия [есть перевод элемента управления интерфейс](#_core_localizing_your_control.92.s_programmability_interface) (имена свойств, методов и событий). Вторая стратегия [есть перевод элемента управления пользовательского интерфейса](#_core_localizing_the_control.92.s_user_interface), с помощью контейнера внешнее свойство LocaleID. Пример локализации элемента управления, см. Пример элементов управления ActiveX в MFC [LOCALIZE](../visual-cpp-samples.md).

##  <a name="_core_localizing_your_control.92.s_programmability_interface"></a> Локализация интерфейса программирования элемента управления

При локализации элемента управления интерфейс (интерфейс используется программистами, написание приложений, использующих элемент управления), необходимо создать измененную версию элемента управления. IDL файла (сценарий для создания библиотеки типов элемента управления) для каждого языка, который вы собираетесь поддерживать. Это является единственным местом, необходимо локализовать имена свойств элемента управления.

При разработке локализованных элемента управления, включают идентификатор языка, как атрибут на уровне библиотеки типов. Например если вы хотите предоставить библиотеку типов с именами французский локализованные свойства, создайте копию вашего ПРИМЕРА. IDL файл и назовите его SAMPLEFR. IDL. Добавьте атрибут идентификатор языкового стандарта (код языка для французского языка — 0x040c) в файл, аналогичную следующей:

[!code-cpp[NVC_MFC_AxLoc#1](../mfc/codesnippet/cpp/mfc-activex-controls-localizing-an-activex-control_1.idl)]

Измените имена свойств в SAMPLEFR. IDL для их эквиваленты на французском языке, а затем использовать MKTYPLIB. Библиотека, SAMPLEFR типов exe-файла для создания французского. TLB.

Для создания нескольких библиотек локализованного типа можно добавить любой локализации. IDL файлы в проект, и они будут созданы автоматически.

#### <a name="to-add-an-idl-file-to-your-activex-control-project"></a>Для добавления. IDL-файл в проект элемента управления ActiveX

1. С помощью проекта элемента управления, выберите на **проекта** меню, щелкните **добавить существующий элемент**.

   **Добавить существующий элемент** откроется диалоговое окно.

1. При необходимости выберите диск и каталог для просмотра.

1. В **тип файлов** выберите **все файлы (\*.\*)** .

1. Дважды щелкните в списке файлов. IDL-файл, который нужно вставить в проект.

1. Нажмите кнопку **откройте** после добавления всех требуемых. IDL-файлов.

Так как файлы были добавлены в проект, они будут собраны при построении оставшуюся часть проекта. Локализованного типа библиотек, находятся в текущем каталоге проекта элемента управления ActiveX.

Коду, а имена внутренних свойств (обычно на английском языке) всегда используются и никогда не локализованы. Сюда входят диспетчеризации карту элементов управления, функции обмена данными свойство и код свойства страницы данных exchange.

Только один тип библиотеки (. Файл TLB) могут быть привязаны в ресурсы для реализации элемента управления (. Файл OCX). Обычно это версия с стандартизированный (как правило, на английском языке) имена. Для отправки вашего элемента управления, необходимо поставить локализованной версии. OCX (который уже был привязан к значение по умолчанию. Версия TLB) и. TLB для соответствующего языка. Это означает, что только. Для версии на английском языке, с момента правильный требуется OCX. TLB уже привязан к нему. Для других языковых стандартов библиотеки локализованного типа также должны прилагаться к. OCX.

Чтобы убедиться, что клиентов вашего элемента управления можно найти библиотеку локализованного типа, зарегистрируйте зависящих от языкового стандарта. TLB-файлы в разделе библиотеки типов в системный реестр Windows. Третий параметр (обычно необязательно) [AfxOleRegisterTypeLib](../mfc/reference/registering-ole-controls.md#afxoleregistertypelib) функция предназначена для этой цели. В следующем примере регистрируется библиотеку французский типов для элемента управления ActiveX:

[!code-cpp[NVC_MFC_AxLoc#2](../mfc/codesnippet/cpp/mfc-activex-controls-localizing-an-activex-control_2.cpp)]

Если элемент управления зарегистрирован, `AfxOleRegisterTypeLib` функция автоматически ищет указанный. TLB-файл в том же каталоге, что элемент управления и регистрирует его в базе данных регистрации Windows. Если. TLB-файл не найден, функция не оказывает влияния.

##  <a name="_core_localizing_the_control.92.s_user_interface"></a> Локализация элемента управления пользовательского интерфейса

Чтобы локализовать пользовательский интерфейс элемента управления, поместите все видимыми ресурсов элемента управления (например, страницы свойств и сообщений об ошибках) в DLL-библиотек ресурсов для конкретного языка. Затем можно использовать внешнее свойство LocaleID контейнера выберите соответствующую библиотеку DLL для языка пользователя.

В следующем примере кода демонстрируется один из способов найти и загрузить библиотека DLL ресурсов для конкретного языкового стандарта. Эта функция-член, вызывается `GetLocalizedResourceHandle` в этом примере может быть функцией-членом класса элемента управления ActiveX:

[!code-cpp[NVC_MFC_AxLoc#3](../mfc/codesnippet/cpp/mfc-activex-controls-localizing-an-activex-control_3.cpp)]

Обратите внимание на то, что идентификатор варианта языка может проверяться в каждом случае оператора switch, чтобы предоставить более специализированный локализацию. Демонстрацию этой функции см. в разделе `GetResourceHandle` функции в MFC ActiveX управляет образец [LOCALIZE](../visual-cpp-samples.md).

Когда элемент управления сначала загружается в контейнер, оно может вызвать [COleControl::AmbientLocaleID](../mfc/reference/colecontrol-class.md#ambientlocaleid) для получения идентификатора языкового стандарта. Элемент управления затем можно передать значение возвращенного локали для `GetLocalizedResourceHandle` функцию, которая загружает библиотеку ресурсов. Элемент управления следует передавать полученный дескриптор, если таковое имеется, чтобы [AfxSetResourceHandle](../mfc/reference/application-information-and-management.md#afxsetresourcehandle):

[!code-cpp[NVC_MFC_AxLoc#4](../mfc/codesnippet/cpp/mfc-activex-controls-localizing-an-activex-control_4.cpp)]

Поместить в примере кода выше в функции-члена элемента управления, такие как переопределение [COleControl::OnSetClientSite](../mfc/reference/colecontrol-class.md#onsetclientsite). Кроме того *m_hResDLL* должно быть переменную-член класса элемента управления.

Аналогичная логика используется для локализации страницы свойств элемента управления. Для локализации на страницу свойств, добавьте код, аналогичный приведенному ниже на странице свойств файла реализации (в переопределении [COlePropertyPage::OnSetPageSite](../mfc/reference/colepropertypage-class.md#onsetpagesite)):

[!code-cpp[NVC_MFC_AxLoc#5](../mfc/codesnippet/cpp/mfc-activex-controls-localizing-an-activex-control_5.cpp)]

## <a name="see-also"></a>См. также

[Элементы ActiveX библиотеки MFC](../mfc/mfc-activex-controls.md)

