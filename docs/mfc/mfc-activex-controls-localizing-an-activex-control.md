---
title: Элементы управления ActiveX в MFC. Локализация элемента управления ActiveX
ms.date: 09/12/2018
f1_keywords:
- LocaleID
- AfxOleRegisterTypeLib
helpviewer_keywords:
- localization, ActiveX controls
- MFC ActiveX controls [MFC], localizing
- LocaleID ambient property [MFC]
- LOCALIZE sample [MFC]
ms.assetid: a44b839a-c652-4ec5-b824-04392708a5f9
ms.openlocfilehash: 987cde2117307cdb5940a31e6f01efb15c527b84
ms.sourcegitcommit: c123cc76bb2b6c5cde6f4c425ece420ac733bf70
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81364599"
---
# <a name="mfc-activex-controls-localizing-an-activex-control"></a>Элементы управления ActiveX в MFC. Локализация элемента управления ActiveX

В этой статье рассматриваются процедуры локализации интерфейсов управления ActiveX.

>[!IMPORTANT]
> ActiveX является устаревшей технологией, которая не должна использоваться для новых разработок. Для получения дополнительной информации о современных технологиях, которые заменяли ActiveX, [см.](activex-controls.md)

Если вы хотите адаптировать элемент управления ActiveX к международному рынку, вы можете локализовать элемент управления. Windows поддерживает многие языки в дополнение к английскому языку по умолчанию, включая немецкий, французский и шведский. Это может представлять проблемы для управления, если его интерфейс только на английском языке.

Как правило, элементы управления ActiveX всегда должны основывать свое локализунное на свойстве ambient LocaleID. Это можно сделать тремя способами:

- Загрузка ресурсов, всегда по требованию, на основе текущей стоимости свойства окружающего LocaleID. Эта стратегия используется в образе управления MFC ActiveX [LOCALI.](../overview/visual-cpp-samples.md)

- Загружайте ресурсы при экземпляре первого элемента управления на основе свойства окружающего LocaleID и используйте эти ресурсы для всех других экземпляров. Эта статья демонстрирует эту стратегию.

    > [!NOTE]
    >  В некоторых случаях это не сработает правильно, если в будущих экземплярах есть разные локальы.

- Используйте `OnAmbientChanged` функцию уведомлений для динамической загрузки соответствующих ресурсов для локализации контейнера.

    > [!NOTE]
    >  Это будет работать для управления, но время выполнения DLL не будет динамически обновлять свои собственные ресурсы при изменении свойства окружающего LocaleID. Кроме того, dLL-времени выполнения для элементов управления ActiveX используют локаль потока для определения локализации своих ресурсов.

В остальной части этой статьи описаны две стратегии локализации. Первая стратегия [локализует интерфейс программируемости элемента](#_core_localizing_your_control.92.s_programmability_interface) управления (имена свойств, методов и событий). Вторая стратегия [локализует пользовательский интерфейс элемента управления,](#_core_localizing_the_control.92.s_user_interface)используя свойство окружающего LocaleID контейнера. Для демонстрации локализации управления см. [LOCALIZE](../overview/visual-cpp-samples.md)

## <a name="localizing-the-controls-programmability-interface"></a><a name="_core_localizing_your_control.92.s_programmability_interface"></a>Локализация интерфейса программируемости управления

При локализации интерфейса программируемости элемента управления (интерфейс, используемый программистами, пишущими приложения, которые используют ваш элемент управления), необходимо создать модифицированную версию элемента управления. Файл IDL (скрипт для создания библиотеки типа управления) для каждого языка, который вы собираетесь поддерживать. Это единственное место, где вам нужно локализовать имена свойств управления.

При разработке локализованного элемента управления включите идентификатор локализации в качестве атрибута на уровне библиотеки типа. Например, если вы хотите предоставить библиотеку типов с французскими локализованными именами свойств, сделайте копию SAMPLE. IDL файл, и называть его SAMPLEFR. Idl. Добавьте атрибут locale ID в файл (идентификатор языка для французского языка 0x040c), похожий на следующее:

[!code-cpp[NVC_MFC_AxLoc#1](../mfc/codesnippet/cpp/mfc-activex-controls-localizing-an-activex-control_1.idl)]

Измените имена свойств в SAMPLEFR. IDL к их французским эквивалентам, а затем использовать MKTYPLIB. EXE для производства французской библиотеки типа, SAMPLEFR. Tlb.

Для создания нескольких локализованных библиотек типа можно добавить любые локализованные. IDL файлы для проекта, и они будут построены автоматически.

#### <a name="to-add-an-idl-file-to-your-activex-control-project"></a>Чтобы добавить . IDL-файл для вашего проекта управления ActiveX

1. При открытии проекта управления в меню **проекта** нажмите **«Добавить существующий элемент».**

   Отображается диалоговая коробка **«Добавить существующий элемент».**

1. При необходимости выберите диск и каталог для просмотра.

1. В поле **Файлов типа** выберите **все файлы (.\*\*)**.

1. В поле списка файлов, дважды нажмите кнопку . IDL файл, который вы хотите вставить в проект.

1. Нажмите **Открыть,** когда вы добавили все необходимое. IDL файлы.

Поскольку файлы были добавлены в проект, они будут построены, когда будет построена остальная часть проекта. Локализованные библиотеки типа расположены в текущем каталоге проектов управления ActiveX.

В коде всегда используются внутренние имена свойств (обычно на английском языке) и никогда не локализуются. Это включает карту диспетчерской управления, функции обмена свойствами и код обмена данными страницы свойств.

Только одна библиотека типа (. Файл TLB может быть связан с ресурсами реализации управления (. OCX) файл. Обычно это версия со стандартизированными (обычно, английскими) именами. Для отправки локализованной версии вашего управления вам нужно отправить . OCX (который уже привязан к умолчанию. Версия TLB) и . TLB для соответствующего места. Это означает, что только . OCX необходим для английских версий, так как правильный . TLB уже был связан с ним. Для других локализов, локализованная библиотека типа также должна быть отправлена с . Ocx.

Чтобы убедиться, что клиенты вашего контроля могут найти локализованную библиотеку типа, зарегистрируйте свой локаль. Файл TLB (ы) в разделе TypeLib в реестре систем Windows. Для этого предусмотрен третий параметр (обычно необязательный) функции [AfxOleRegisterTypeLib.](../mfc/reference/registering-ole-controls.md#afxoleregistertypelib) Следующий пример регистрирует библиотеку французского типа для управления ActiveX:

[!code-cpp[NVC_MFC_AxLoc#2](../mfc/codesnippet/cpp/mfc-activex-controls-localizing-an-activex-control_2.cpp)]

Когда элемент управления зарегистрирован, `AfxOleRegisterTypeLib` функция автоматически ищет указанный . Файл TLB в том же каталоге, что и элемент управления, и регистрирует его в базе данных регистрации Windows. Если . Файл TLB не найден, функция не имеет эффекта.

## <a name="localizing-the-controls-user-interface"></a><a name="_core_localizing_the_control.92.s_user_interface"></a>Локализация пользовательского интерфейса управления

Чтобы локализовать пользовательский интерфейс элемента управления, поместите все видимые пользователями ресурсы управления (например, страницы свойств и сообщения об ошибках) в dLL-ресурсы, связанные с языком. Затем можно использовать свойство localeID контейнера для выбора соответствующего DLL для локализации пользователя.

Следующий пример кода демонстрирует один подход к поиску и загрузке ресурса DLL для определенного локализации. Эта функция члена, называемая `GetLocalizedResourceHandle` для этого примера, может быть функцией элемента вашего класса управления ActiveX:

[!code-cpp[NVC_MFC_AxLoc#3](../mfc/codesnippet/cpp/mfc-activex-controls-localizing-an-activex-control_3.cpp)]

Обратите внимание, что идентификатор субязыка может быть проверен в каждом случае оператора коммутатора, чтобы обеспечить более специализированную локализацию. Для демонстрации этой функции, см функции `GetResourceHandle` в MFC ActiveX управления образца [LOCALI](../overview/visual-cpp-samples.md).

Когда элемент управления сначала загружается в контейнер, он может вызвать [COleControl::AmbientLocaleID](../mfc/reference/colecontrol-class.md#ambientlocaleid) для получения идентификатора локализации. Затем элемент управления может передавать идентификатор «возвращенный идентификатор» функции, `GetLocalizedResourceHandle` которая загружает соответствующую библиотеку ресурсов. Элемент управления должен передавать полученную ручку, если таковой имеется, на [AfxSetResourceHandle:](../mfc/reference/application-information-and-management.md#afxsetresourcehandle)

[!code-cpp[NVC_MFC_AxLoc#4](../mfc/codesnippet/cpp/mfc-activex-controls-localizing-an-activex-control_4.cpp)]

Поместите образец кода выше в функцию элемента управления, например, переопределение [COleControl::OnSetClientSite](../mfc/reference/colecontrol-class.md#onsetclientsite). Кроме того, *m_hResDLL* должна быть переменной элемента класса управления.

Аналогичную логику можно использовать для локализации страницы свойств элемента управления. Чтобы локализовать страницу свойств, добавьте код, похожий на следующий образец, в файл реализации страницы свойств (в переопределение [COlePropertyPage::OnSetPageSite):](../mfc/reference/colepropertypage-class.md#onsetpagesite)

[!code-cpp[NVC_MFC_AxLoc#5](../mfc/codesnippet/cpp/mfc-activex-controls-localizing-an-activex-control_5.cpp)]

## <a name="see-also"></a>См. также раздел

[Элементы ActiveX библиотеки MFC](../mfc/mfc-activex-controls.md)
