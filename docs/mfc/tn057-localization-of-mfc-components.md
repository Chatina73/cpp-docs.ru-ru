---
description: 'Дополнительные сведения о: TN057: локализация компонентов MFC'
title: TN057. Локализация компонентов MFC
ms.date: 06/28/2018
helpviewer_keywords:
- components [MFC], localizing
- TN057
- resources [MFC], localization
- localization [MFC], MFC resources
- localization [MFC], MFC components
- MFC DLLs [MFC], localizing
- DLLs [MFC], localizing MFC
- localization [MFC], resources
ms.assetid: 5376d329-bd45-41bd-97f5-3d895a9a0af5
ms.openlocfilehash: d4a331e74acd2b5b38ae059ea180a0a2148e3a0f
ms.sourcegitcommit: d6af41e42699628c3e2e6063ec7b03931a49a098
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2020
ms.locfileid: "97214810"
---
# <a name="tn057-localization-of-mfc-components"></a>TN057. Локализация компонентов MFC

> [!NOTE]
> Следующее техническое примечание не было обновлено, поскольку сначала оно было включено в электронную документацию. В результате некоторые процедуры и разделы могут быть устаревшими или неверными. Для получения последних сведений рекомендуется выполнить поиск интересующей темы в алфавитном указателе документации в Интернете.

В этом заметке описываются некоторые конструкции и процедуры, которые можно использовать для локализации компонента, если это приложение или элемент управления OLE или библиотека DLL, использующая MFC.

## <a name="overview"></a>Общие сведения

Существует две проблемы, которые необходимо решить при локализации компонента, использующего MFC. Во-первых, необходимо локализовать собственные ресурсы — строки, диалоговые окна и другие ресурсы, которые относятся к конкретному компоненту. Большинство компонентов, созданных с помощью MFC, также включают и используют ряд ресурсов, определенных MFC. Также необходимо предоставить локализованные ресурсы MFC. К счастью, некоторые языки уже предоставляются самой библиотекой MFC.

Кроме того, компонент должен быть готов к запуску в целевой среде (в среде с поддержкой европейских или DBCS). В большинстве случаев это зависит от того, что приложение обрабатывает символы с правильным набором символов, а строки имеют двухбайтовые символы. В обеих этих средах по умолчанию включена поддержка MFC, что позволяет использовать один общедоступный двоичный файл, который используется на всех платформах с использованием только тех ресурсов, которые подключены во время установки.

## <a name="localizing-your-components-resources"></a>Локализация ресурсов компонента

Локализация приложения или библиотеки DLL должна привести к простому замене ресурсов ресурсами, которые соответствуют целевому языку. Для собственных ресурсов это относительно просто: измените ресурсы в редакторе ресурсов и создайте приложение. Если код написан правильно, не будет строк или текста, которые необходимо локализовать в исходном коде C++. все локализацию можно выполнить, просто изменив ресурсы. На самом деле, можно реализовать компонент таким, что все, что предоставляет локализованную версию, даже не затрагивает сборку исходного кода. Это более сложная вещь, но она хорошо и является механизмом, выбранным для самого MFC. Кроме того, можно локализовать приложение, загрузив файл EXE или DLL в редактор ресурсов и изменив ресурсы напрямую. Хотя это и возможно, оно требует переприменения этих изменений каждый раз при сборке новой версии приложения.

Одним из способов избежать этого является обнаружение всех ресурсов в отдельной библиотеке DLL, которая иногда называется вспомогательной библиотекой DLL. Эта библиотека DLL затем загружается динамически во время выполнения, а ресурсы загружаются из библиотеки DLL, а не из основного модуля со всем кодом. MFC напрямую поддерживает этот подход. Рассмотрим приложение с именем MYAPP.EXE; все его ресурсы могут находиться в библиотеке DLL с именем MYRES.DLL. В приложении Приложение `InitInstance` выполнит следующие действия, чтобы загрузить эту библиотеку DLL и заставить MFC загружать ресурсы из этого расположения:

```cpp
CMyApp::InitInstance()
{
    // one of the first things in the init code
    HINSTANCE hInst = LoadLibrary("myres.dll");

    if (hInst != NULL)
        AfxSetResourceHandle(hInst);

    // other initialization code would follow
    // ...
}
```

После этого MFC будет загружать ресурсы из этой библиотеки DLL, а не myapp.exe. Однако все ресурсы должны присутствовать в этой библиотеке DLL. MFC не будет искать в экземпляре приложения поиск заданного ресурса. Этот метод также применяется к обычным библиотекам DLL MFC, а также к элементам управления OLE. Программа установки скопирует соответствующую версию MYRES.DLL в зависимости от того, какой язык ресурсов требуется пользователю.

Создавать библиотеку DLL только для ресурсов довольно просто. Создайте проект DLL, добавьте. RC-файл и добавьте необходимые ресурсы. При наличии существующего проекта, который не использует этот метод, можно скопировать ресурсы из этого проекта. После добавления файла ресурсов в проект практически все готово для сборки проекта. Единственное, что необходимо сделать, — задать параметры компоновщика для включения **/NOENTRY**. Это говорит компоновщику, что у библиотеки DLL нет точки входа, так как она не имеет кода и не имеет точки входа.

> [!NOTE]
> Редактор ресурсов в Visual C++ 4,0 и более поздних версий поддерживает несколько языков для каждого языка. RC-файл. Это может упростить управление локализацией в одном проекте. Ресурсы для каждого языка контролируются директивами препроцессора, созданными редактором ресурсов.

## <a name="using-the-provided-mfc-localized-resources"></a>Использование предоставленных локализованных ресурсов MFC

Любое приложение MFC, которое вы создаете, повторно использует две вещи из MFC: Code и reusess. Это значит, что в MFC есть различные сообщения об ошибках, встроенные диалоговые окна и другие ресурсы, используемые классами MFC. Чтобы полностью локализовать приложение, необходимо локализовать не только ресурсы приложения, но и ресурсы, поступающие непосредственно из MFC. MFC предоставляет несколько различных файлов языковых ресурсов автоматически, поэтому, если язык, на котором нацелена нацеливание, является одним из языков, которые уже поддерживаются библиотекой MFC, необходимо только убедиться, что вы используете эти локализованные ресурсы.

На момент написания этой статьи MFC поддерживает китайский, немецкий, испанский, французский, итальянский, японский и корейский языки. Файлы, содержащие эти локализованные версии, находятся в МФК\ИНКЛУДЕ\Л. * ("L" означает локализованные каталоги). Например, файлы немецкого языка находятся в МФК\ИНКЛУДЕ\Л.Деу. Чтобы приложение использовало эти RC-файлы вместо файлов, расположенных в МФК\ИНКЛУДЕ, добавьте в `/IC:\PROGRAM FILES\MICROSOFT VISUAL STUDIO .NET 2003\VC7\MFC\INCLUDE\L.DEU` командную строку RC (это лишь пример; необходимо заменить выбранный языковой стандарт, а также каталог, в который установлен Visual C++).

Приведенные выше инструкции будут работать, если приложение связывается статически с MFC. Большинство приложений связываются динамически (так как это помощью мастера по умолчанию). В этом сценарии динамически связывается не только код, так и ресурсы. В результате вы можете локализовать ресурсы в приложении, но ресурсы реализации MFC будут по-прежнему загружаться из MFC7x.DLL (или более поздней версии) или из MFC7xLOC.DLL, если они существуют. Это можно сделать с двух разных углов.

Более сложный подход заключается в поставке одного из локализованных MFC7xLOC.DLLs (например, MFC7xDEU, для немецкого, MFC7xESP.DLL для испанского и т. д.) или более поздней версии и установки соответствующей MFC7xLOC.DLL в системный каталог при установке приложения пользователем. Это может быть очень сложно как для разработчика, так и для конечного пользователя, и поэтому не рекомендуется. Дополнительные сведения об этом методе и его предостережениях см. в [техническом примечании 56](../mfc/tn056-installation-of-localized-mfc-components.md) .

Самый простой и надежный подход заключается в том, чтобы включить локализованные ресурсы MFC в приложение или саму библиотеку DLL (или вспомогательную библиотеку DLL, если используется один). Это позволяет избежать проблем, связанных с установкой MFC7xLOC.DLL должным образом. Для этого следуйте тем же инструкциям в статическом варианте, приведенном выше (правильно устанавливая командную строку RC для указания на локализованные ресурсы), за исключением того, что необходимо также удалить `/D_AFXDLL` Определение, добавленное функцией помощью мастера. Если `/D_AFXDLL` определено, AFXRES. H (и другие RC-файлы MFC) не определяют ресурсы (так как они будут извлечены из библиотек DLL MFC).

## <a name="see-also"></a>См. также раздел

[Технические примечания по номеру](../mfc/technical-notes-by-number.md)<br/>
[Технические примечания по категориям](../mfc/technical-notes-by-category.md)
