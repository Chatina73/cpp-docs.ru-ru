---
title: Пошаговое руководство. Обновление приложения MFC Scribble (часть 1)
ms.date: 09/09/2019
helpviewer_keywords:
- examples [MFC], update existing application
- ribbon UI, porting to
- Office Fluent UI, porting to
- samples [MFC], update existing application
- MFC Feature Pack, update existing application
- walkthroughs [MFC], update existing application
ms.assetid: aa6330d3-6cfc-4c79-8fcb-0282263025f7
ms.openlocfilehash: 18803d2222c80b80ac2b1fde75b442ea1e9a89bb
ms.sourcegitcommit: c123cc76bb2b6c5cde6f4c425ece420ac733bf70
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81360257"
---
# <a name="walkthrough-updating-the-mfc-scribble-application-part-1"></a>Пошаговое руководство. Обновление приложения MFC Scribble (часть 1)

Это пошаговое решение демонстрирует, как изменить существующее приложение MFC для использования пользовательского интерфейса Ribbon. Visual Studio поддерживает как Office 2007 Лента и Windows 7 сценической ленты. Для получения дополнительной информации о пользовательском интерфейсе Ribbon, [см.](/windows/win32/uxguide/cmd-ribbons)

Это пошаговое решение изменяет классический образец Scribble 1.0 MFC, который позволяет использовать мышь для создания линейных рисунков. В этой части пошагового представления показано, как изменять образец Scribble так, чтобы он отображал ленточный батончик. [Часть 2](../mfc/walkthrough-updating-the-mfc-scribble-application-part-2.md) добавляет больше кнопок к ленте бар.

## <a name="prerequisites"></a>Предварительные требования

[Образец Scribble 1.0 MFC](https://download.microsoft.com/download/4/0/9/40946FEC-EE5C-48C2-8750-B0F8DA1C99A8/MFC/general/Scribble.zip.exe). Для получения помощи при преобразовании в Visual Studio 2017 или позже, см [Портинг Руководство: MFC Scribble](../porting/porting-guide-mfc-scribble.md).

## <a name="sections"></a><a name="top"></a>Разделы

Эта часть пошаговых отправления имеет следующие разделы:

- [Замена базовых классов](#replaceclass)

- [Добавление Битmaps в проект](#addbitmap)

- [Добавление ресурса ленты в проект](#addribbon)

- [Создание экземпляра Лента Бар](#createinstance)

- [Добавление категории ленты](#addcategory)

- [Настройка облика приложения](#setlook)

## <a name="replacing-the-base-classes"></a><a name="replaceclass"></a>Замена базовых классов

Чтобы преобразовать приложение, поддерживающее меню, в приложение, поддерживающее ленту, необходимо получить из обновленных базовых классов классы приложения, окна кадра и панели инструментов. (Мы предлагаем не изменять исходный образец Scribble. Вместо этого очистите проект Scribble, скопируйте его в другой каталог, а затем измените копию.)

### <a name="to-replace-the-base-classes-in-the-scribble-application"></a>Замена базовых классов в приложении Scribble

1. В scribble.cpp, `CScribbleApp::InitInstance` проверить, что включает в себя вызов [AfxOleInit](../mfc/reference/ole-initialization.md#afxoleinit).

1. Добавьте следующий код в файл *pch.h* *(stdafx.h* в Visual Studio 2017 и более раньше):

    ```cpp
    #include <afxcontrolbars.h>
    ```

1. В scribble.h измените определение `CScribbleApp` для класса так, чтобы оно было получено из [класса CWinAppEx.](../mfc/reference/cwinappex-class.md)

    ```cpp
    class CScribbleApp: public CWinAppEx
    ```

1. Scribble 1.0 был написан, когда приложения Windows использовали инициализацию (.ini) файл для сохранения данных предпочтений пользователя. Вместо файла инициализации измените Scribble для хранения пользовательских предпочтений в реестре. Чтобы установить ключ и базу реестра, `CScribbleApp::InitInstance` введите следующий код после `LoadStdProfileSettings()` оператора.

    ```cpp
    SetRegistryKey(_T("MFCNext\\Samples\\Scribble2"));
    SetRegistryBase(_T("Settings"));
    ```

1. Основная рамка для приложения интерфейса с несколькими документами `CMDIFrameWnd` (MDI) больше не является производным от класса. Вместо этого, он происходит от класса [CMDIFrameWndEx.](../mfc/reference/cmdiframewndex-class.md)

    В файлах mainfrm.h и mainfrm.cpp замените все ссылки `CMDIFrameWnd` на `CMDIFrameWndEx`.

1. В childfrm.h и childfrm.cpp `CMDIChildWnd` файлы, заменить `CMDIChildWndEx`на .

    В детском фромме. h файл, `CSplitterWnd` `CSplitterWndEx`заменить на .

1. Измените панели инструментов и полосы статуса, чтобы использовать новые классы MFC.

    В файле mainfrm.h:

    1. Замените `CToolBar` на `CMFCToolBar`.

    1. Замените `CStatusBar` на `CMFCStatusBar`.

1. В файле mainfrm.cpp:

    1. Замените `m_wndToolBar.SetBarStyle` на `m_wndToolBar.SetPaneStyle`:

    1. Замените `m_wndToolBar.GetBarStyle` на `m_wndToolBar.GetPaneStyle`:

    1. Замените `DockControlBar(&m_wndToolBar)` на `DockPane(&m_wndToolBar)`:

1. В файле ipframe.cpp прокомментируйте следующие три строки кода.

    ```cpp
    m_wndToolBar.EnableDocking(CBRS_ALIGN_ANY);
    pWndFrame->EnableDocking(CBRS_ALIGN_ANY);
    pWndFrame->DockPane(&m_wndToolBar);
    ```

1. Сохранить изменения, а затем построить и запустить приложение.

## <a name="adding-bitmaps-to-the-project"></a><a name="addbitmap"></a>Добавление Битmaps в проект

Следующие четыре шага этого пошагового действия требуют ресурсов bitmap. Вы можете получить соответствующие bitmaps различными способами:

- Используйте [редакторы ресурсов,](../windows/resource-editors.md) чтобы изобрести свои собственные бит-карты. Или используйте редакторы ресурсов для сборки бит-карт из портативных сетевых графических изображений (.png), которые включены в Visual Studio и могут быть загружены из [библиотеки изображений Visual Studio.](https://docs.microsoft.com/visualstudio/designers/the-visual-studio-image-library)

    Тем не менее, пользовательский интерфейс **Ribbon** требует, чтобы некоторые bitmaps поддерживали прозрачные изображения. Прозрачные биткарты используют 32-битные пиксели, где 24 бита указывают красный, зеленый и синий компоненты цвета, а 8 бит определяют *альфа-канал,* определяющий прозрачность цвета. Текущие редакторы ресурсов могут просматривать, но не изменять бит-карты с 32-битными пикселями. Следовательно, используйте внешний редактор изображений вместо редакторов ресурсов для управления прозрачными бит-картами.

- Копируйте соответствующий файл ресурса из другого приложения в проект, а затем импортируйте бит-карты из этого файла.

Это пошаговое копирование файлов ресурсов из примера, созданного в [Walkthrough: Создание приложения ленты с помощью MFC.](../mfc/walkthrough-creating-a-ribbon-application-by-using-mfc.md)

### <a name="to-add-bitmaps-to-the-project"></a>Добавление бит-карт в проект

1. Используйте File Explorer для копирования следующих файлов`res`.bmp из каталога ресурсов`res`( ) примера ленты в каталог ресурсов ( ) проекта Scribble:

   1. Скопируйте main.bmp для вашего проекта Scribble.

   1. Копировать filesmall.bmp и filelarge.bmp для вашего проекта Scribble.

   1. Сделайте новые копии файлов filelarge.bmp и filesmall.bmp, но сохраните копии в примере Ribbon. Переименуйте копии homesmall.bmp и homelarge.bmp, а затем переместите копии в ваш проект Scribble.

   1. Сделайте копию файла toolbar.bmp, но сохраните копию в примере Ленты. Переименуйте копию panelicons.bmp, а затем переместите копию в свой проект Scribble.

1. Импортируйте бит-карту для приложения MFC. В **виде ресурсов**, дважды щелкните узла **scribble.rc,** дважды щелкните узло **Bitmap,** а затем нажмите **Добавить ресурс.** На поле диалога, которое появляется, нажмите **Импорт**. Просмотрите `res` каталог, выберите файл main.bmp, а затем нажмите **Open**.

   Биткарта main.bmp содержит изображение 26x26. Измените идентификатор `IDB_RIBBON_MAIN`битной карты на .

1. Импортируйте бит-карты для меню файлов, прикрепленных к кнопке **приложения.**

   1. Импортируйте файл filesmall.bmp, который содержит одиннадцать изображений 16x16 (16x176). Измените идентификатор `IDB_RIBBON_FILESMALL`битной карты на .

   > [!NOTE]
   > Поскольку нам нужны только первые восемь изображений 16x16 (16x128), вы можете дополнительно обрезать правую ширину этой бит-карты от 176 до 128.

   1. Импортируйте filelarge.bmp, который содержит девять изображений 32x32 (32x288). Измените идентификатор `IDB_RIBBON_FILELARGE`битной карты на .

1. Импорт bitmaps для ленты категорий и панелей. Каждая вкладка на ленте бар категории, и состоит из текстовой этикетки и дополнительное изображение.

   1. Импорт homesmall.bmp bitmap, который содержит одиннадцать 16x16 изображений для небольших bitmaps кнопки. Измените идентификатор `IDB_RIBBON_HOMESMALL`битной карты на .

   1. Импорт homelarge.bmp bitmap, который содержит девять 32x32 изображений для больших битовых кнопок. Измените идентификатор `IDB_RIBBON_HOMELARGE`битной карты на .

1. Импорт bitmaps для переразмерных ленты панелей. Эти бит-карты, или значки панели, используются после операции по восстановлению размера, если лента слишком мала, чтобы отображать всю панель.

   1. Импортируйте bitmap panelicons.bmp, который содержит восемь изображений 16x16. В окне **свойств** **редактора Bitmap**отрегулируйте ширину бит-карты до 64 (16x64). Измените идентификатор `IDB_PANEL_ICONS`битной карты на .

   > [!NOTE]
   > Поскольку нам нужны только первые четыре изображения 16x16 (16x64), вы можете дополнительно обрезать правую ширину этой бит-карты от 128 до 64.

## <a name="adding-a-ribbon-resource-to-the-project"></a><a name="addribbon"></a>Добавление ресурса ленты в проект

При преобразовании приложения, используюго меню, в приложение, используюваемое лентой, не нужно удалять или отстранять существующие меню. Просто создайте ленточный ресурс, добавьте ленточные кнопки, а затем свяжете новые кнопки с существующими пунктами меню. Несмотря на то, что меню больше не видны, сообщения из ленточного бара направляются через меню, а ярлыки меню продолжают работать.

Лента состоит из кнопки **приложения,** которая представляет собой большую кнопку на верхней левой стороне ленты, и одну или несколько вкладок категории. Каждая вкладка категории содержит одну или несколько панелей, которые служат контейнерами для лентовых кнопок и элементов управления. Следующая процедура показывает, как создать ленточный ресурс, а затем настроить кнопку **приложения.**

### <a name="to-add-a-ribbon-resource-to-the-project"></a>Добавление ленточного ресурса в проект

1. С проектом Scribble, выбранным в **Solution Explorer,** в меню **проекта** нажмите **Добавить ресурс.**

1. В диалоговом окне **Добавить ресурс,** выберите **Лента,** а затем нажмите **Новый**.

   Visual Studio создает ленточный ресурс и открывает его в представлении дизайна. Идентификатор `IDR_RIBBON1`ресурса ленты отображается в **виде ресурсов.** Лента содержит одну категорию и одну панель.

1. Кнопку **приложения** можно настроить, изменив ее свойства. Ит-диски сообщений, используемые в этом коде, уже определены в меню для Scribble 1.0.

1. В представлении дизайна нажмите кнопку **приложения,** чтобы отобразить его свойства. Изменение значений свойств следующим `IDB_RIBBON_MAIN`образом: `File` **Изображение,** `f` **Подспотойте,** **Ключи** `IDB_RIBBON_FILESMALL`к `IDB_RIBBON_FILELARGE`, **Большие изображения,** и **малые изображения** к .

1. Следующие изменения создают меню, которое появляется при нажатии кнопки **приложения.** Нажмите на эллипсис **(...**) рядом с **основными пунктами,** чтобы открыть **редактор элементов**.

   1. С выбранной **кнопкой** типа **Элемента** нажмите **«Добавить,** чтобы добавить кнопку». Изменение **Caption** Подпись `&New`к, `ID_FILE_NEW` **ID** `0`к , **Изображение** , **Изображение Большой** . `0`

   1. Нажмите **Добавить,** чтобы добавить кнопку. Изменение **Caption** подпись `&Save`к, `ID_FILE_SAVE` **ID** `2`к , **Изображение,** и **изображение Большое** . `2`

   1. Нажмите **Добавить,** чтобы добавить кнопку. Изменение **Caption** подпись `Save &As`к, `ID_FILE_SAVE_AS` **ID** `3`к , **Изображение,** и **изображение Большое** . `3`

   1. Нажмите **Добавить,** чтобы добавить кнопку. Изменение **Caption** подпись `&Print`к, `ID_FILE_PRINT` **ID** `4`к , **Изображение,** и **изображение Большое** . `4`

   1. Измените тип **элемента** в **сепаратор,** а затем нажмите **Добавить**.

   1. Измените тип **элемента** в **кнопку.** Нажмите **Добавить,** чтобы добавить пятую кнопку. Изменение **Caption** подпись `&Close`к, `ID_FILE_CLOSE` **ID** `5`к , **Изображение,** и **изображение Большое** . `5`

1. Следующие изменения создают подменю под кнопкой **Print,** созданной на предыдущем этапе.

   1. Нажмите кнопку **Print,** измените тип **элемента** на **этикетку,** а затем нажмите **Вставить**. Изменение **Caption** подпись `Preview and print the document`к .

   1. Нажмите кнопку **Print,** измените тип **элемента** на **кнопку**и нажмите **Вставьте**. Изменение **Caption** подпись `&Print`к, `ID_FILE_PRINT` **ID** `4`к , **Изображение,** и **изображение Большое** . `4`

   1. Нажмите кнопку **"Печать",** а затем нажмите **Insert,** чтобы добавить кнопку. Изменение **Caption** подпись `&Quick Print`к, `ID_FILE_PRINT_DIRECT` **ID** `7`к , **Изображение,** и **изображение Большое** . `7`

   1. Нажмите кнопку **"Печать",** а затем нажмите **Insert,** чтобы добавить еще одну кнопку. Изменение **Caption** подпись `Print Pre&view`к, `ID_FILE_PRINT_PREVIEW` **ID** `6`к , **Изображение,** и **изображение Большое** . `6`

   1. Теперь вы изменили **основные элементы.** Нажмите **Близко,** чтобы выйти из **редактора элементов**.

1. Следующая модификация создает кнопку выхода, которая появляется в нижней части меню кнопки **приложения.**

   1. Выберите вкладку **«Вид ресурсов»** в **Solution Explorer.**
   1. В окне **Свойства,** нажмите эллипсис **(...**) рядом с **кнопкой,** чтобы открыть **элементы редактора**.

   1. С выбранной **кнопкой** типа **Элемента** нажмите **«Добавить,** чтобы добавить кнопку». Изменение **Caption** подпись `E&xit`к, `ID_APP_EXIT` **ID** `8`к , **Изображение** .

   1. Вы изменили **кнопки**. Нажмите **Близко,** чтобы выйти из **редактора элементов**.

## <a name="creating-an-instance-of-the-ribbon-bar"></a><a name="createinstance"></a>Создание экземпляра Лента Бар

Следующие шаги показывают, как создать экземпляр ленты бар, когда приложение начинается. Чтобы добавить ленту бар для приложения, объявить ленту бар в файле mainfrm.h. Затем, в файле mainfrm.cpp, напишите код для загрузки ресурса ленты.

### <a name="to-create-an-instance-of-the-ribbon-bar"></a>Создать экземпляр ленты-бар

1. В файле mainfrm.h добавьте член данных `CMainFrame`в защищенный раздел , определение класса для основного кадра. Этот член для ленты бар.

    ```cpp
    // Ribbon bar for the application
    CMFCRibbonBar m_wndRibbonBar;
    ```

2. В файле mainfrm.cpp добавьте следующий `return` код перед окончательным заявлением в конце функции. `CMainFrame::OnCreate` Это создает экземпляр ленты бар.

    ```cpp
    // Create the ribbon bar
    if (!m_wndRibbonBar.Create(this))
    {
        return -1;   //Failed to create ribbon bar
    }
    m_wndRibbonBar.LoadFromResource(IDR_RIBBON1);
    ```

## <a name="customizing-the-ribbon-resource"></a><a name="addcategory"></a>Настройка ресурса ленты

Теперь, когда вы создали кнопку **приложения,** можно добавить элементы к ленте.

> [!NOTE]
> Это пошаговое походе использует один и тот же значок панели для всех панелей. Тем не менее, вы можете использовать другие индексы списка изображений для отображения других иконок.

### <a name="to-add-a-home-category-and-edit-panel"></a>Добавление категории «Домой» и панели edit

1. Программа Scribble требует только одной категории. В представлении дизайна, в **Toolbox**, дважды щелкните **категория,** чтобы добавить один и отобразить его свойства. Изменение значений свойств **Caption** следующим `&Home`образом: Подпись `IDB_RIBBON_HOMELARGE`к , `IDB_RIBBON_HOMESMALL` **Большие изображения,** **малые изображения** .

1. Каждая категория ленты организована в названные панели. Каждая панель содержит набор элементов управления, которые завершают связанные операции. Эта категория имеет одну панель. Нажмите **панель**, а `Edit`затем изменить **подпись** на .

1. В панель **edit** добавьте кнопку, ответственную за очистку содержимого документа. Идентификатор сообщения для этой `IDR_SCRIBBTYPE` кнопки уже определен в ресурсе меню. Укажите `Clear All` как текст кнопки и индекс битной карты, которая украшает кнопку. Откройте **Toolbox,** а затем перетащите **кнопку** на панель **edit.** Нажмите кнопку, а `Clear All`затем изменить **подпись** `0`к, **ID** `ID_EDIT_CLEAR_ALL`к , **Индекс изображения,** **Большой индекс изображения** к `0`.

1. Сохранить изменения, а затем построить и запустить приложение. Приложение Scribble должно отображаться, и оно должно иметь ленточный бар в верхней части окна вместо панели меню. Лента бар должен иметь одну категорию, **Главная**, и **главная** должна иметь одну панель, **Edit**. Кнопки ленты, которые вы добавили, должны быть связаны с существующими обработчиками событий, а **открытые,** **замыкающие,** **сохранить,** **распечатать**и **очистить все** кнопки должны работать как ожидалось.

## <a name="setting-the-look-of-the-application"></a><a name="setlook"></a>Настройка облика приложения

*Визуальный менеджер* — это глобальный объект, который управляет всем рисунком для приложения. Поскольку в оригинальном приложении Scribble используется пользовательский интерфейс Office 2000 (UI), приложение может выглядеть старомодным. Вы можете сбросить приложение, чтобы использовать визуальный менеджер Office 2007, чтобы оно напоминало приложение Office 2007.

### <a name="to-set-the-look-of-the-application"></a>Установить внешний вид приложения

1. В `CMainFrame::OnCreate` функции введите следующий код перед заявлением, `return 0;` чтобы изменить визуальный менеджер и стиль по умолчанию.

    ```cpp
    // Set the default manager to Office 2007
    CMFCVisualManager::SetDefaultManager(RUNTIME_CLASS(CMFCVisualManagerOffice2007));
    CMFCVisualManagerOffice2007::SetStyle(CMFCVisualManagerOffice2007::Office2007_LunaBlue);
    ```

1. Сохранить изменения, а затем построить и запустить приложение. UI приложения должен напоминать uI Office 2007.

## <a name="next-steps"></a>Next Steps

Вы изменили классический образец Scribble 1.0 MFC, чтобы использовать **дизайнера лент.** Теперь перейдите к [части 2](../mfc/walkthrough-updating-the-mfc-scribble-application-part-2.md).

## <a name="see-also"></a>См. также раздел

[Пошаговые руководства](../mfc/walkthroughs-mfc.md)<br/>
[Пошаговое руководство. Обновление приложения MFC Scribble (часть 2)](../mfc/walkthrough-updating-the-mfc-scribble-application-part-2.md)
