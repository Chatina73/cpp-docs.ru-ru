---
description: 'Дополнительные сведения: элементы управления ActiveX в MFC. Добавление пользовательских событий'
title: Элементы управления ActiveX в MFC. Добавление пользовательских событий
ms.date: 11/04/2016
helpviewer_keywords:
- MFC ActiveX controls [MFC], events [MFC]
- EVENT_CUSTOM prefix [MFC]
- custom events [MFC], adding to ActiveX controls
- EVENT_CUSTOM macro [MFC]
- InCircle method [MFC]
- ClickIn event
- FireClickIn event
- COleControl class [MFC], custom events [MFC]
- Click event, custom events [MFC]
- events [MFC], ActiveX controls
- custom events [MFC]
- FireEvent method, adding custom events
ms.assetid: c584d053-1e34-47aa-958e-37d3e9b85892
ms.openlocfilehash: 1c41db073e5cfd74861a1ca836916c2b4bfdc9b4
ms.sourcegitcommit: d6af41e42699628c3e2e6063ec7b03931a49a098
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2020
ms.locfileid: "97203046"
---
# <a name="mfc-activex-controls-adding-custom-events"></a>Элементы управления ActiveX в MFC. Добавление пользовательских событий

Пользовательские события отличаются от стандартных событий тем, что они не запускаются автоматически классом `COleControl` . Пользовательское событие распознает определенное действие, определенное разработчиком элемента управления как событие. Записи о сопоставлении событий для пользовательских событий представлены с помощью макроса EVENT_CUSTOM. В следующем разделе реализуется пользовательское событие для проекта элемента управления ActiveX, созданного с помощью мастера элементов управления ActiveX.

## <a name="adding-a-custom-event-with-the-add-event-wizard"></a><a name="_core_adding_a_custom_event_with_classwizard"></a> Добавление пользовательского события с помощью мастера добавления событий

Следующая процедура добавляет конкретное пользовательское событие Click. Эту процедуру можно использовать для добавления других пользовательских событий. Замените имя настраиваемого события и его параметры на имя события щелчка и параметры.

#### <a name="to-add-the-clickin-custom-event-using-the-add-event-wizard"></a>Добавление пользовательского события Click с помощью мастера добавления событий

1. Загрузите проект элемента управления.

1. В **представление классов** щелкните правой кнопкой мыши класс элемента управления ActiveX, чтобы открыть контекстное меню.

1. В контекстном меню выберите **Добавить** , а затем — **Добавить событие**.

   Откроется мастер добавления событий.

1. В поле **имя события** сначала выберите любое существующее событие, а затем щелкните переключатель **Настраиваемый** и введите *Click*.

1. В поле **внутреннее имя** введите имя функции, которая срабатывает для события. В этом примере используйте значение по умолчанию, предоставляемое мастером добавления событий ( `FireClickIn` ).

1. Добавьте параметр с именем *кскурд* (Type *OLE_XPOS_PIXELS*), используя **имя параметра** и элементы управления **типа параметра** .

1. Добавьте второй параметр с именем *икурд* (Type *OLE_YPOS_PIXELS*).

1. Нажмите кнопку **Готово** , чтобы создать событие.

## <a name="add-event-wizard-changes-for-custom-events"></a><a name="_core_classwizard_changes_for_custom_events"></a> Изменения мастера добавления событий для пользовательских событий

При добавлении пользовательского события мастер добавления событий вносит изменения в класс элемента управления. H,. CPP, и. IDL-файлы. Приведенные ниже примеры кода относятся к событию Click.

Следующие строки добавляются в заголовок (. H) файл класса элементов управления:

[!code-cpp[NVC_MFC_AxUI#7](codesnippet/cpp/mfc-activex-controls-adding-custom-events_1.h)]

Этот код объявляет встроенную функцию с именем `FireClickIn` , которая вызывает [COleControl:: FireEvent](reference/colecontrol-class.md#fireevent) с событием Click и параметрами, определенными с помощью мастера добавления событий.

Кроме того, следующая строка добавляется в карту событий для элемента управления, расположенного в реализации (. CPP) класса элемента управления:

[!code-cpp[NVC_MFC_AxUI#8](codesnippet/cpp/mfc-activex-controls-adding-custom-events_2.cpp)]

Этот код сопоставляет событие Click с встроенной функцией `FireClickIn` , передавая параметры, определенные с помощью мастера добавления событий.

Наконец, в элемент управления добавляется следующая строка. IDL-файл:

[!code-cpp[NVC_MFC_AxUI#9](codesnippet/cpp/mfc-activex-controls-adding-custom-events_3.idl)]

Эта строка назначает событие Click в определенном ИДЕНТИФИКАТОРе, взятом из расположения события в списке событий мастера добавления событий. Запись в списке событий позволяет контейнеру ожидать событие. Например, он может предоставить код обработчика, который будет выполняться при срабатывании события.

## <a name="calling-fireclickin"></a><a name="_core_calling_fireclickin"></a> Вызов Фирекликкин

Теперь, когда вы добавили пользовательское событие Click с помощью мастера добавления событий, необходимо решить, когда это событие будет запущено. Это делается путем вызова `FireClickIn` при выполнении соответствующего действия. В этом обсуждении элемент управления использует `InCircle` функцию внутри `WM_LBUTTONDOWN` обработчика сообщений для запуска события Click, когда пользователь щелкает внутри круглой или эллиптической области. Следующая процедура добавляет `WM_LBUTTONDOWN` обработчик.

#### <a name="to-add-a-message-handler-with-the-add-event-wizard"></a>Добавление обработчика сообщений с помощью мастера добавления событий

1. Загрузите проект элемента управления.

1. В **представление классов** выберите класс элемента управления ActiveX.

1. В окне " **Свойства** " отображается список сообщений, которые могут быть обработаны элементом управления ActiveX. Все сообщения, показанные жирным шрифтом, уже имеют назначенную ей функцию обработчика.

1. Выберите сообщение, которое требуется обработать. В этом примере выберите `WM_LBUTTONDOWN` .

1. В раскрывающемся списке справа выберите **\<Add> онлбуттондовн**.

1. Дважды щелкните новую функцию обработчика в **представление классов** , чтобы перейти к коду обработчика сообщений в реализации (. CPP) файла элемента управления ActiveX.

В следующем примере кода функция вызывается `InCircle` при каждом нажатии левой кнопки мыши в окне управления. Этот пример можно найти в `WM_LBUTTONDOWN` функции обработчика, `OnLButtonDown` в примере абстрактного [примера Circ](../overview/visual-cpp-samples.md) .

[!code-cpp[NVC_MFC_AxUI#10](codesnippet/cpp/mfc-activex-controls-adding-custom-events_4.cpp)]

> [!NOTE]
> Когда мастер добавления событий создает обработчики сообщений для действий кнопок мыши, автоматически добавляется вызов того же обработчика сообщений базового класса. Не удаляйте этот вызов. Если элемент управления использует любое из сообщений, надаваемых от мыши, необходимо вызвать обработчики сообщений в базовом классе, чтобы обеспечить правильную обработку захвата мыши.

В следующем примере событие срабатывает, только если щелчок мыши находится внутри круглой или эллиптической области внутри элемента управления. Чтобы достичь этого поведения, можно поместить `InCircle` функцию в реализацию элемента управления (. Файл CPP):

[!code-cpp[NVC_MFC_AxUI#11](codesnippet/cpp/mfc-activex-controls-adding-custom-events_5.cpp)]

Кроме того, необходимо добавить следующее объявление `InCircle` функции в заголовок элемента управления (. H) файл:

[!code-cpp[NVC_MFC_AxUI#12](codesnippet/cpp/mfc-activex-controls-adding-custom-events_6.h)]

## <a name="custom-events-with-stock-names"></a><a name="_core_custom_events_with_stock_names"></a> Пользовательские события с названиями запасов

Можно создавать пользовательские события с теми же именами, что и в случае с финансовыми событиями, однако их нельзя реализовать в одном элементе управления. Например, может потребоваться создать пользовательское событие с именем Click, которое не срабатывает при нажатии на событие акции обычно. Затем можно запустить событие Click в любое время, вызвав функцию, вызывающую срабатывание.

Следующая процедура добавляет пользовательское событие щелчка.

#### <a name="to-add-a-custom-event-that-uses-a-stock-event-name"></a>Добавление пользовательского события, использующего имя события акции

1. Загрузите проект элемента управления.

1. В **представление классов** щелкните правой кнопкой мыши класс элемента управления ActiveX, чтобы открыть контекстное меню.

1. В контекстном меню выберите **Добавить** , а затем — **Добавить событие**.

   Откроется мастер добавления событий.

1. В раскрывающемся списке **имя события** выберите имя события на бирже. В этом примере выберите **Click**(выбрать).

1. В качестве **типа события** выберите **Custom**.

1. Нажмите кнопку **Готово** , чтобы создать событие.

1. Вызовите `FireClick` в соответствующих местах кода.

## <a name="see-also"></a>См. также раздел

[Элементы управления ActiveX в MFC](mfc-activex-controls.md)<br/>
[Элементы управления ActiveX в MFC: методы](mfc-activex-controls-methods.md)<br/>
[Класс COleControl](reference/colecontrol-class.md)
