---
title: Элементы управления ActiveX в MFC. Добавление пользовательских событий
ms.date: 11/04/2016
helpviewer_keywords:
- MFC ActiveX controls [MFC], events [MFC]
- EVENT_CUSTOM prefix [MFC]
- custom events [MFC], adding to ActiveX controls
- EVENT_CUSTOM macro [MFC]
- InCircle method [MFC]
- ClickIn event
- FireClickIn event
- COleControl class [MFC], custom events [MFC]
- Click event, custom events [MFC]
- events [MFC], ActiveX controls
- custom events [MFC]
- FireEvent method, adding custom events
ms.assetid: c584d053-1e34-47aa-958e-37d3e9b85892
ms.openlocfilehash: 8d464e5d7c9731e158e44d66d569fd1555401e17
ms.sourcegitcommit: c123cc76bb2b6c5cde6f4c425ece420ac733bf70
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81364728"
---
# <a name="mfc-activex-controls-adding-custom-events"></a>Элементы управления ActiveX в MFC. Добавление пользовательских событий

Пользовательские события отличаются от фондовых событий `COleControl`тем, что они не увольняются автоматически по классу. Пользовательское событие распознает определенное действие, определяемые разработчиком управления, как событие. Записи карты событий для пользовательских событий представлены макросом EVENT_CUSTOM. В следующем разделе реализовано пользовательское событие для проекта управления ActiveX, созданного с помощью мастера управления ActiveX.

## <a name="adding-a-custom-event-with-the-add-event-wizard"></a><a name="_core_adding_a_custom_event_with_classwizard"></a>Добавление пользовательского события с мастером события Добавления

Следующая процедура добавляет определенное пользовательское событие, ClickIn. Эту процедуру можно использовать для добавления других пользовательских событий. Замените пользовательское имя события и его параметры для названия и параметров события ClickIn.

#### <a name="to-add-the-clickin-custom-event-using-the-add-event-wizard"></a>Добавление пользовательского события ClickIn с помощью «Мастера событий добавления»

1. Загрузите проект элемента управления.

1. В **классе View**, правой кнопкой мыши вашего класса управления ActiveX, чтобы открыть меню ярлыка.

1. Из меню ярлыка нажмите **Добавить,** а затем нажмите **Добавить событие**.

   Это открывает Мастер события добавления.

1. В поле **имени события** сначала выберите любое существующее событие, затем нажмите на кнопку **пользовательского** радио, а затем введите *ClickIn.*

1. В поле **внутреннего имени** введите название функции стрельбы события. В этом примере используйте значение по умолчанию, предоставляемое мастером событий Add Event ().`FireClickIn`

1. Добавьте параметр, называемый *xCoord* (тип *OLE_XPOS_PIXELS),* используя элементы **управления именем параметра** и **тип параметра.**

1. Добавьте второй параметр, называемый *yCoord* (тип *OLE_YPOS_PIXELS).*

1. Нажмите **Закончить,** чтобы создать событие.

## <a name="add-event-wizard-changes-for-custom-events"></a><a name="_core_classwizard_changes_for_custom_events"></a>Добавление изменений мастера событий для пользовательских событий

При добавлении пользовательского события мастер событий Add Event вносит изменения в класс управления. H. CPP, и . IDL файлы. Следующие образцы кода специфичны для события ClickIn.

Следующие строки добавляются в заголовок (. H) файл вашего класса управления:

[!code-cpp[NVC_MFC_AxUI#7](../mfc/codesnippet/cpp/mfc-activex-controls-adding-custom-events_1.h)]

Этот код объявляет вневленную функцию, называемую, `FireClickIn` которая вызывает [COleControl::FireEvent](../mfc/reference/colecontrol-class.md#fireevent) с событием ClickIn и параметрами, которые вы определили с помощью мастера событий Добавления.

Кроме того, на карту событий добавляется следующая строка для управления, расположенного в реализации (. CPP) файл вашего класса управления:

[!code-cpp[NVC_MFC_AxUI#8](../mfc/codesnippet/cpp/mfc-activex-controls-adding-custom-events_2.cpp)]

Этот код отображает событие ClickIn в `FireClickIn`функции входящего, передавая параметры, которые вы определили с помощью Мастера событий Добавления.

Наконец, следующая строка добавляется к элементу управления. IDL файл:

[!code-cpp[NVC_MFC_AxUI#9](../mfc/codesnippet/cpp/mfc-activex-controls-adding-custom-events_3.idl)]

Эта строка присваивает событию ClickIn определенный идентификационный номер, взятый из позиции события в списке событий Add Event Wizard. Запись в списке событий позволяет контейнеру предвидеть событие. Например, при выполнении события может быть приведен код обработчика.

## <a name="calling-fireclickin"></a><a name="_core_calling_fireclickin"></a>Вызов FireClickIn

Теперь, когда вы добавили пользовательское событие ClickIn с помощью Мастера Событий Добавления, вы должны решить, когда это событие должно быть уволено. Вы делаете это, вызывая, `FireClickIn` когда происходит соответствующее действие. Для этого обсуждения элемент `InCircle` управления использует `WM_LBUTTONDOWN` функцию внутри обработчика сообщений для зажигания события ClickIn, когда пользователь щелкает внутри круговой или эллиптической области. Следующая процедура `WM_LBUTTONDOWN` добавляет обработчик.

#### <a name="to-add-a-message-handler-with-the-add-event-wizard"></a>Добавление обработчика сообщений с помощью «Мастера событий добавления»

1. Загрузите проект элемента управления.

1. В **классе View**выберите класс управления ActiveX.

1. В окне **свойств** вы видите список сообщений, которые могут быть обработаны с помощью управления ActiveX. Любое сообщение, отображаемые жирным шрифтом, уже имеет функцию обработчика, назначенную ему.

1. Выберите сообщение, которым вы хотите справиться. Для этого примера выберите `WM_LBUTTONDOWN`.

1. Из выпадающих вниз поле списка справа, ** \<выберите Добавить> OnLButtonDown**.

1. Дважды щелкните новую функцию обработчика в **классе View,** чтобы перейти к коду обработчика сообщений в реализации (. CPP) файл вашего управления ActiveX.

Следующий образец `InCircle` кода вызывает функцию каждый раз, когда левая кнопка мыши нажимается в окне управления. Этот образец можно `WM_LBUTTONDOWN` найти в `OnLButtonDown`функции обработчика, , в аннотации [образца Circ.](../overview/visual-cpp-samples.md)

[!code-cpp[NVC_MFC_AxUI#10](../mfc/codesnippet/cpp/mfc-activex-controls-adding-custom-events_4.cpp)]

> [!NOTE]
> Когда add Event Wizard создает обработчики сообщений для действий кнопки мыши, автоматически добавляется вызов тому же обработчику сообщений базового класса. Не удаляйте этот вызов. Если ваш элемент управления использует любое сообщение мыши, обработчики сообщений в базовом классе должны быть вызваны, чтобы убедиться, что захват мыши обрабатывается должным образом.

В следующем примере событие сражает только тогда, когда щелчка происходит внутри круговой или эллиптической области в пределах элемента управления. Для достижения этого поведения можно `InCircle` поместить функцию в реализацию элемента управления (. CPP) файл:

[!code-cpp[NVC_MFC_AxUI#11](../mfc/codesnippet/cpp/mfc-activex-controls-adding-custom-events_5.cpp)]

Вам также нужно будет добавить `InCircle` следующую декларацию функции в заголовок элемента управления (. H) файл:

[!code-cpp[NVC_MFC_AxUI#12](../mfc/codesnippet/cpp/mfc-activex-controls-adding-custom-events_6.h)]

## <a name="custom-events-with-stock-names"></a><a name="_core_custom_events_with_stock_names"></a>Пользовательские события с именами акций

Вы можете создавать пользовательские события с тем же именем, что и фондовые события, однако вы не можете реализовать оба в том же элементе управления. Например, можно создать пользовательское событие под названием Click, которое не сравняется, когда событие акции Click обычно сравня. Затем вы можете запустить событие Click в любое время, позвонив в его функцию стрельбы.

Следующая процедура добавляет пользовательское событие Нажмите.

#### <a name="to-add-a-custom-event-that-uses-a-stock-event-name"></a>Добавление пользовательского события, используюго имя события акции

1. Загрузите проект элемента управления.

1. В **классе View**, правой кнопкой мыши вашего класса управления ActiveX, чтобы открыть меню ярлыка.

1. Из меню ярлыка нажмите **Добавить,** а затем нажмите **Добавить событие**.

   Это открывает Мастер события добавления.

1. В списке выпадающих **имен событий** выберите имя события. Для этого примера выберите **Нажмите кнопку**.

1. Для **типа событий**, выберите **пользовательские**.

1. Нажмите **Закончить,** чтобы создать событие.

1. Звоните `FireClick` в соответствующие места в коде.

## <a name="see-also"></a>См. также раздел

[Элементы ActiveX библиотеки MFC](../mfc/mfc-activex-controls.md)<br/>
[Элементы ActiveX в MFC. Методы](../mfc/mfc-activex-controls-methods.md)<br/>
[Класс COleControl](../mfc/reference/colecontrol-class.md)
