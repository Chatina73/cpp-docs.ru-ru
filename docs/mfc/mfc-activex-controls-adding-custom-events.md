---
title: Элементы ActiveX в MFC. Добавление пользовательских событий
ms.date: 11/04/2016
helpviewer_keywords:
- MFC ActiveX controls [MFC], events [MFC]
- EVENT_CUSTOM prefix [MFC]
- custom events [MFC], adding to ActiveX controls
- EVENT_CUSTOM macro [MFC]
- InCircle method [MFC]
- ClickIn event
- FireClickIn event
- COleControl class [MFC], custom events [MFC]
- Click event, custom events [MFC]
- events [MFC], ActiveX controls
- custom events [MFC]
- FireEvent method, adding custom events
ms.assetid: c584d053-1e34-47aa-958e-37d3e9b85892
ms.openlocfilehash: 48c5ddbc8a3bcf6f74c251820e83cdebcef05bc9
ms.sourcegitcommit: 72583d30170d6ef29ea5c6848dc00169f2c909aa
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/18/2019
ms.locfileid: "58781007"
---
# <a name="mfc-activex-controls-adding-custom-events"></a>Элементы ActiveX в MFC. Добавление пользовательских событий

Пользовательские события отличаются от событий биржевых тем, что они не запускаются автоматически классом `COleControl`. Пользовательское событие распознает определенное действие, определяется разработчиком элемента управления, как событие. Event_custom-макрос представлены записи сопоставления событий для пользовательских событий. Следующий раздел реализует пользовательское событие для проекта элемента управления ActiveX, который был создан с помощью мастера элементов управления ActiveX.

##  <a name="_core_adding_a_custom_event_with_classwizard"></a> Добавление пользовательских событий с мастер добавления события

В следующей процедуре добавляется определенного пользовательского события, ClickIn. Эту процедуру можно использовать для добавления других пользовательских событий. Подставьте имя пользовательского события и его параметры для ClickIn событий имя и параметры.

#### <a name="to-add-the-clickin-custom-event-using-the-add-event-wizard"></a>Чтобы добавить пользовательские clickin-событие, используя мастер добавления события

1. Загрузите проект элемента управления.

1. В представлении классов щелкните правой кнопкой мыши по классу элемента управления ActiveX, чтобы открыть контекстное меню.

1. В контекстном меню, щелкните **добавить** и нажмите кнопку **добавить событие**.

   Откроется мастер добавления события.

1. В **имя события** , сначала выберите любого существующего события, а затем щелкните **Custom** radio кнопку, а затем введите *ClickIn*.

1. В **внутреннее имя** введите имя функции обработки события. Например, используйте значение по умолчанию, предоставляемые мастер добавления события (`FireClickIn`).

1. Добавьте параметр с именем *xCoord* (тип *OLE_XPOS_PIXELS*), с использованием **имя параметра** и **тип параметра** элементов управления.

1. Добавьте второй параметр с именем *yCoord* (тип *OLE_YPOS_PIXELS*).

1. Нажмите кнопку **Готово** для создания события.

##  <a name="_core_classwizard_changes_for_custom_events"></a> Добавить мастер изменения событий для пользовательских событий

При добавлении пользовательское событие, мастер добавления события вносит изменения в класс элемента управления. H. CPP, и. IDL-файлов. В следующих примерах кода относятся только к clickin-событие.

Следующие строки добавляются в заголовок (. H) файла класса элемента управления.

[!code-cpp[NVC_MFC_AxUI#7](../mfc/codesnippet/cpp/mfc-activex-controls-adding-custom-events_1.h)]

Этот код объявляет встроенная функция вызывается `FireClickIn` , который вызывает [COleControl::FireEvent](../mfc/reference/colecontrol-class.md#fireevent) clickin-событие и параметрами вы определили с помощью мастера добавления события.

Кроме того, следующая строка добавляется к схеме событий для элемента управления, расположенный в реализации (. Файл CPP) класса элемента управления:

[!code-cpp[NVC_MFC_AxUI#8](../mfc/codesnippet/cpp/mfc-activex-controls-adding-custom-events_2.cpp)]

Этот код сопоставляет события ClickIn встроенная функция `FireClickIn`, передавая параметры, определенные с помощью мастера добавления события.

Наконец следующая строка добавляется в элемент управления. IDL-файла:

[!code-cpp[NVC_MFC_AxUI#9](../mfc/codesnippet/cpp/mfc-activex-controls-adding-custom-events_3.idl)]

Эта строка назначает clickin-событие с определенным номером идентификатора, взятое из положение события в списке событий мастер добавления события. Запись в списке событий позволяет контейнера реагировать на события. Например он может обеспечивать код обработчика, который выполняется при возникновении этого события.

##  <a name="_core_calling_fireclickin"></a> Вызов FireClickIn

Теперь, когда вы добавили пользовательский clickin-событие, используя мастер добавления событий, необходимо решить, когда это событие является активируемый. Это делается путем вызова `FireClickIn` при возникновении соответствующее действие. В этой статье элемент управления использует `InCircle` функции внутри обработчика сообщений WM_LBUTTONDOWN срабатывание clickin-событие, когда пользователь щелкает внутри области круга или эллипса. В следующей процедуре добавляется обработчик WM_LBUTTONDOWN.

#### <a name="to-add-a-message-handler-with-the-add-event-wizard"></a>Добавление обработчика сообщений с помощью мастера добавления событий

1. Загрузите проект элемента управления.

1. В представлении классов выберите класс элемента управления ActiveX.

1. В окне «Свойства» щелкните **сообщений** кнопки.

   В окне свойств отображаются список сообщений, которые могут обрабатываться элементом управления ActiveX. Любое сообщение, отображаются полужирным шрифтом, уже имеет функцию обработчика событий, назначенные ему.

1. В окне «Свойства» выберите сообщение, которое необходимо обработать. В этом примере выберите WM_LBUTTONDOWN.

1. В раскрывающемся списке справа выберите  **\<Добавить > OnLButtonDown**.

1. Дважды щелкните новую функцию обработчика в представлении классов для перехода к код обработчика сообщений в реализации (. Указать файл .cpp) элемента управления ActiveX.

Следующий код вызывает образец `InCircle` функции каждый раз при нажатии левой кнопки мыши в окне элемента управления. Этот пример можно найти в функции обработчика WM_LBUTTONDOWN `OnLButtonDown`в [пример Кр](../overview/visual-cpp-samples.md) абстрактным.

[!code-cpp[NVC_MFC_AxUI#10](../mfc/codesnippet/cpp/mfc-activex-controls-adding-custom-events_4.cpp)]

> [!NOTE]
>  Когда мастер добавления события создает обработчики сообщений для действия мыши кнопок, автоматически добавляется вызов, чтобы один и тот же обработчик сообщений, базового класса. Не удаляйте этот вызов. Если элемент управления использует сообщения мыши акций, обработчики сообщений в базовом классе должен вызываться для обеспечения правильной обработки захват мыши.

В следующем примере событие срабатывает, только когда делается щелчок внутри области круга или эллипса в элементе управления. Чтобы обеспечить такое поведение, можно поместить `InCircle` функцию в реализации элемента управления (. Файл CPP):

[!code-cpp[NVC_MFC_AxUI#11](../mfc/codesnippet/cpp/mfc-activex-controls-adding-custom-events_5.cpp)]

Также необходимо будет добавить следующее объявление `InCircle` функцию для заголовка элемента управления (. H) файла.

[!code-cpp[NVC_MFC_AxUI#12](../mfc/codesnippet/cpp/mfc-activex-controls-adding-custom-events_6.h)]

##  <a name="_core_custom_events_with_stock_names"></a> Пользовательские события с именами акций

Можно создать пользовательские события с тем же именем, как биржевые события, но нельзя реализовать в одном элементе управления. Например можно создать пользовательское событие Click, не запускается, когда стандартное событие Click бы обычно срабатывание вызывается. Затем может обработать события щелчка в любое время путем вызова функции обработки.

Приведенная ниже процедура добавляет щелчок пользовательских событий.

#### <a name="to-add-a-custom-event-that-uses-a-stock-event-name"></a>Чтобы добавить пользовательское событие, которое использует имя стандартное событие

1. Загрузите проект элемента управления.

1. В представлении классов щелкните правой кнопкой мыши по классу элемента управления ActiveX, чтобы открыть контекстное меню.

1. В контекстном меню, щелкните **добавить** и нажмите кнопку **добавить событие**.

   Откроется мастер добавления события.

1. В **имя события** раскрывающегося списка выберите имя стандартное событие. В этом примере выберите **щелкните**.

1. Для **тип события**выберите **Custom**.

1. Нажмите кнопку **Готово** для создания события.

1. Вызовите `FireClick` в нужных местах в коде.

## <a name="see-also"></a>См. также

[Элементы ActiveX библиотеки MFC](../mfc/mfc-activex-controls.md)<br/>
[Элементы ActiveX в MFC. Методы](../mfc/mfc-activex-controls-methods.md)<br/>
[Класс COleControl](../mfc/reference/colecontrol-class.md)
