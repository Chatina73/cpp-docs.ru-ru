---
title: Класс Кметафиледк
ms.date: 11/04/2016
f1_keywords:
- CMetaFileDC
- AFXEXT/CMetaFileDC
- AFXEXT/CMetaFileDC::CMetaFileDC
- AFXEXT/CMetaFileDC::Close
- AFXEXT/CMetaFileDC::CloseEnhanced
- AFXEXT/CMetaFileDC::Create
- AFXEXT/CMetaFileDC::CreateEnhanced
helpviewer_keywords:
- CMetaFileDC [MFC], CMetaFileDC
- CMetaFileDC [MFC], Close
- CMetaFileDC [MFC], CloseEnhanced
- CMetaFileDC [MFC], Create
- CMetaFileDC [MFC], CreateEnhanced
ms.assetid: ffce60fa-4181-4d46-9832-25e46fad4db4
ms.openlocfilehash: 61e8442c085a5be0a7266409daf973bf63f52a7f
ms.sourcegitcommit: fcb48824f9ca24b1f8bd37d647a4d592de1cc925
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/15/2019
ms.locfileid: "69505502"
---
# <a name="cmetafiledc-class"></a>Класс Кметафиледк

Реализует метафайл Windows, который содержит последовательность команд интерфейса графических устройств (GDI), которые можно воспроизвести для создания нужного изображения или текста.

## <a name="syntax"></a>Синтаксис

```
class CMetaFileDC : public CDC
```

## <a name="members"></a>Участники

### <a name="public-constructors"></a>Открытые конструкторы

|name|Описание|
|----------|-----------------|
|[Кметафиледк:: Кметафиледк](#cmetafiledc)|Создает объект `CMetaFileDC`.|

### <a name="public-methods"></a>Открытые методы

|name|Описание|
|----------|-----------------|
|[Кметафиледк:: Close](#close)|Закрывает контекст устройства и создает маркер метафайла.|
|[Кметафиледк:: Клосинханцед](#closeenhanced)|Закрывает контекст устройства расширенного метафайла и создает маркер расширенного метафайла.|
|[Кметафиледк:: Create](#create)|Создает контекст устройства метафайла Windows и прикрепляет его к `CMetaFileDC` объекту.|
|[Кметафиледк:: Креатинханцед](#createenhanced)|Создает контекст устройства метафайла для метафайла расширенного формата.|

## <a name="remarks"></a>Примечания

Для реализации метафайла Windows сначала создайте `CMetaFileDC` объект. Вызвать конструктор, а затем вызвать функцию [создания](#create) члена, которая создает контекст устройства метафайла Windows и прикрепляет его к `CMetaFileDC` объекту. `CMetaFileDC`

Затем отправьте `CMetaFileDC` объект последовательности команд GDI CDC, которые требуется воспроизвести. Можно использовать только те команды GDI, которые создают выходные `MoveTo` данные `LineTo`, такие как и.

После отправки нужных команд в метафайл вызовите `Close` функцию-член, которая закрывает контексты устройств метафайлов и возвращает маркер метафайла. Затем удалите `CMetaFileDC` объект.

[CDC::P лайметафиле](../../mfc/reference/cdc-class.md#playmetafile) может использовать маркер метафайла для многократного воспроизведения метафайла. Метафайл также может управляться функциями Windows, такими как [копиметафиле](/windows/win32/api/wingdi/nf-wingdi-copymetafilew), которая копирует метафайл на диск.

Если метафайл больше не нужен, удалите его из памяти с помощью функции Windows [делетеметафиле](/windows/win32/api/wingdi/nf-wingdi-deletemetafile) .

Кроме того, можно реализовать `CMetaFileDC` объект, чтобы он мог выполнять как выходные вызовы, так и такие вызовы атрибутов `GetTextExtent`GDI, как. Такой метафайл является более гибким и может упростить повторное использование общего кода GDI, который часто состоит из сочетания выходных данных и вызовов атрибутов. Класс наследует два контекста `m_hDC` устройств и `m_hAttribDC`от CDC. `CMetaFileDC` Контекст устройства `m_hDC` обрабатывает все [CDC](../../mfc/reference/cdc-class.md)GDI выходные вызовы `m_hAttribDC`, и контекст устройства обрабатывает все вызовы атрибутов GDI CDC. Как правило, эти два контекста устройств ссылаются на одно и то же устройство. В случае `CMetaFileDC`атрибуту DC присваивается значение NULL по умолчанию.

Создайте второй контекст устройства, указывающий на экран, принтер или устройство, отличное от метафайла, а затем вызовите `SetAttribDC` функцию-член, чтобы связать новый контекст устройства с. `m_hAttribDC` Вызовы GDI для информации теперь будут направлены на новый `m_hAttribDC`. Выходные вызовы GDI будут обращаться `m_hDC`к, который представляет метафайл.

Дополнительные сведения о см `CMetaFileDC`. в разделе [контексты устройств](../../mfc/device-contexts.md).

## <a name="inheritance-hierarchy"></a>Иерархия наследования

[CObject](../../mfc/reference/cobject-class.md)

[CDC](../../mfc/reference/cdc-class.md)

`CMetaFileDC`

## <a name="requirements"></a>Требования

**Заголовок:** афксекст. h

##  <a name="close"></a>Кметафиледк:: Close

Закрывает контекст устройства метафайла и создает маркер метафайла Windows, который можно использовать для воспроизведения метафайла с помощью функции-члена [CDC::P лайметафиле](../../mfc/reference/cdc-class.md#playmetafile) .

```
HMETAFILE Close();
```

### <a name="return-value"></a>Возвращаемое значение

Допустимый ХМЕТАФИЛЕ, если функция выполнена успешно; в противном случае — NULL.

### <a name="remarks"></a>Примечания

Для обработки метафайла с помощью таких функций Windows, как [копиметафиле](/windows/win32/api/wingdi/nf-wingdi-copymetafilew), можно также использовать маркер метафайла Windows.

Удалите метафайл после использования, вызвав функцию Windows [делетеметафиле](/windows/win32/api/wingdi/nf-wingdi-deletemetafile) .

##  <a name="closeenhanced"></a>Кметафиледк:: Клосинханцед

Закрывает контекст устройства расширенного метафайла и возвращает маркер, который определяет метафайл расширенного формата.

```
HENHMETAFILE CloseEnhanced();
```

### <a name="return-value"></a>Возвращаемое значение

Маркер расширенного метафайла, если он успешно выполнен; в противном случае — NULL.

### <a name="remarks"></a>Примечания

Приложение может использовать расширенный метафайл, возвращаемый этой функцией, для выполнения следующих задач:

- Отображение изображения, хранящегося в расширенном метафайле

- Создание копий расширенного метафайла

- Перечисление, изменение или копирование отдельных записей в расширенном метафайле

- Получение необязательного описания содержимого метафайла из заголовка расширенного метафайла

- Получение копии заголовка расширенного метафайла

- Получение двоичной копии расширенного метафайла

- Перечислить цвета в дополнительной палитре

- Преобразование метафайла расширенного формата в метафайл Windows

Если приложению больше не требуется расширенный метафайл, он должен освободить этот обработчик, вызвав функцию Win32 `DeleteEnhMetaFile` .

##  <a name="cmetafiledc"></a>Кметафиледк:: Кметафиледк

`CMetaFileDC` Создайте объект в два этапа.

```
CMetaFileDC();
```

### <a name="remarks"></a>Примечания

Сначала вызовите `CMetaFileDC`, затем вызовите `Create`, который создает контекст устройства метафайла Windows и `CMetaFileDC` присоединяет его к объекту.

##  <a name="create"></a>Кметафиледк:: Create

`CMetaFileDC` Создайте объект в два этапа.

```
BOOL Create(LPCTSTR lpszFilename = NULL);
```

### <a name="parameters"></a>Параметры

*лпсзфиленаме*<br/>
Указывает на строку символов, завершающуюся нулем. Указывает имя создаваемого метафайла. Если *лпсзфиленаме* имеет значение null, создается новый метафайл в памяти.

### <a name="return-value"></a>Возвращаемое значение

Ненулевое значение, если функция выполнена успешно; в противном случае — 0.

### <a name="remarks"></a>Примечания

Сначала вызовите конструктор `CMetaFileDC`, затем вызовите `Create`, который создает контекст устройства метафайла Windows и `CMetaFileDC` присоединяет его к объекту.

##  <a name="createenhanced"></a>Кметафиледк:: Креатинханцед

Создает контекст устройства для расширенного формата метафайла.

```
BOOL CreateEnhanced(
    CDC* pDCRef,
    LPCTSTR lpszFileName,
    LPCRECT lpBounds,
    LPCTSTR lpszDescription);
```

### <a name="parameters"></a>Параметры

*пдкреф*<br/>
Определяет эталонное устройство для расширенного метафайла.

*лпсзфиленаме*<br/>
Указывает на строку символов, завершающуюся нулем. Указывает имя файла для создаваемого расширенного метафайла. Если этот параметр имеет значение null, расширенный метафайл зависит от памяти, и его содержимое теряется при уничтожении объекта или при вызове функции Win32 `DeleteEnhMetaFile` .

*лпбаундс*<br/>
Указывает на структуру данных [Rect](/windows/win32/api/windef/ns-windef-rect) или объект [крект](../../atl-mfc-shared/reference/crect-class.md) , указывающий измерения в единицах HIMETRIC (в приращениях .01-миллиметр) изображения, которое будет храниться в расширенном метафайле.

*лпсздескриптион*<br/>
Указывает на строку, завершающуюся нулем, которая указывает имя приложения, создавшего изображение, а также название изображения.

### <a name="return-value"></a>Возвращаемое значение

Маркер контекста устройства для расширенного метафайла, если он успешно выполнен; в противном случае — NULL.

### <a name="remarks"></a>Примечания

Этот контроллер домена можно использовать для хранения аппаратно-независимого изображения.

Windows использует устройство-образец, определяемое параметром *пдкреф* , для записи разрешения и единиц устройства, на котором первоначально отображался рисунок. Если параметр *пдкреф* имеет значение null, для ссылки используется текущее устройство дисплея.

Левый и верхний элементы `RECT` структуры данных, на которые указывает параметр *лпбаундс* , должны быть меньше, чем правый и нижний элементы соответственно. В изображение включаются точки на краях прямоугольника. Если *лпбаундс* имеет значение null, интерфейс графических устройств (GDI) рассчитывает размеры наименьшего прямоугольника, который может заключать изображение, нарисованное приложением. По возможности следует указать параметр *лпбаундс* .

Строка, на которую указывает параметр *лпсздескриптион* , должна содержать символ NULL между именем приложения и именем изображения и должен завершаться двумя символами NULL (например, "XYZ Graphics Editor\0Bald Eagle\0\0", где \ 0 представляет символ null. Если *лпсздескриптион* имеет значение null, в заголовке расширенного метафайла нет соответствующей записи.

Приложения используют контроллер домена, созданный этой функцией, для хранения графического изображения в расширенном метафайле. Маркер, идентифицирующий этот контроллер, может быть передан любой функции GDI.

После того как приложение сохранит изображение в расширенном метафайле, оно может отобразить изображение на любом устройстве вывода, вызвав `CDC::PlayMetaFile` функцию. При отображении изображения Windows использует прямоугольник, на который указывает параметр *лпбаундс* , и данные разрешения с эталонного устройства для позиционирования и масштабирования изображения. Контекст устройства, возвращаемый этой функцией, содержит те же атрибуты по умолчанию, которые связаны с любым новым контроллером домена.

Приложения должны использовать функцию Win32 `GetWinMetaFileBits` для преобразования расширенного метафайла в старый формат метафайла Windows.

Имя файла для расширенного метафайла должно использовать. Расширение EMF.

## <a name="see-also"></a>См. также

[Класс CDC](../../mfc/reference/cdc-class.md)<br/>
[Диаграмма иерархии](../../mfc/hierarchy-chart.md)
