---
title: Класс Колесервердок
ms.date: 11/04/2016
f1_keywords:
- COleServerDoc
- AFXOLE/COleServerDoc
- AFXOLE/COleServerDoc::COleServerDoc
- AFXOLE/COleServerDoc::ActivateDocObject
- AFXOLE/COleServerDoc::ActivateInPlace
- AFXOLE/COleServerDoc::DeactivateAndUndo
- AFXOLE/COleServerDoc::DiscardUndoState
- AFXOLE/COleServerDoc::GetClientSite
- AFXOLE/COleServerDoc::GetEmbeddedItem
- AFXOLE/COleServerDoc::GetItemClipRect
- AFXOLE/COleServerDoc::GetItemPosition
- AFXOLE/COleServerDoc::GetZoomFactor
- AFXOLE/COleServerDoc::IsDocObject
- AFXOLE/COleServerDoc::IsEmbedded
- AFXOLE/COleServerDoc::IsInPlaceActive
- AFXOLE/COleServerDoc::NotifyChanged
- AFXOLE/COleServerDoc::NotifyClosed
- AFXOLE/COleServerDoc::NotifyRename
- AFXOLE/COleServerDoc::NotifySaved
- AFXOLE/COleServerDoc::OnDeactivate
- AFXOLE/COleServerDoc::OnDeactivateUI
- AFXOLE/COleServerDoc::OnDocWindowActivate
- AFXOLE/COleServerDoc::OnResizeBorder
- AFXOLE/COleServerDoc::OnShowControlBars
- AFXOLE/COleServerDoc::OnUpdateDocument
- AFXOLE/COleServerDoc::RequestPositionChange
- AFXOLE/COleServerDoc::SaveEmbedding
- AFXOLE/COleServerDoc::ScrollContainerBy
- AFXOLE/COleServerDoc::UpdateAllItems
- AFXOLE/COleServerDoc::CreateInPlaceFrame
- AFXOLE/COleServerDoc::DestroyInPlaceFrame
- AFXOLE/COleServerDoc::GetDocObjectServer
- AFXOLE/COleServerDoc::OnClose
- AFXOLE/COleServerDoc::OnExecOleCmd
- AFXOLE/COleServerDoc::OnFrameWindowActivate
- AFXOLE/COleServerDoc::OnGetEmbeddedItem
- AFXOLE/COleServerDoc::OnReactivateAndUndo
- AFXOLE/COleServerDoc::OnSetHostNames
- AFXOLE/COleServerDoc::OnSetItemRects
- AFXOLE/COleServerDoc::OnShowDocument
helpviewer_keywords:
- COleServerDoc [MFC], COleServerDoc
- COleServerDoc [MFC], ActivateDocObject
- COleServerDoc [MFC], ActivateInPlace
- COleServerDoc [MFC], DeactivateAndUndo
- COleServerDoc [MFC], DiscardUndoState
- COleServerDoc [MFC], GetClientSite
- COleServerDoc [MFC], GetEmbeddedItem
- COleServerDoc [MFC], GetItemClipRect
- COleServerDoc [MFC], GetItemPosition
- COleServerDoc [MFC], GetZoomFactor
- COleServerDoc [MFC], IsDocObject
- COleServerDoc [MFC], IsEmbedded
- COleServerDoc [MFC], IsInPlaceActive
- COleServerDoc [MFC], NotifyChanged
- COleServerDoc [MFC], NotifyClosed
- COleServerDoc [MFC], NotifyRename
- COleServerDoc [MFC], NotifySaved
- COleServerDoc [MFC], OnDeactivate
- COleServerDoc [MFC], OnDeactivateUI
- COleServerDoc [MFC], OnDocWindowActivate
- COleServerDoc [MFC], OnResizeBorder
- COleServerDoc [MFC], OnShowControlBars
- COleServerDoc [MFC], OnUpdateDocument
- COleServerDoc [MFC], RequestPositionChange
- COleServerDoc [MFC], SaveEmbedding
- COleServerDoc [MFC], ScrollContainerBy
- COleServerDoc [MFC], UpdateAllItems
- COleServerDoc [MFC], CreateInPlaceFrame
- COleServerDoc [MFC], DestroyInPlaceFrame
- COleServerDoc [MFC], GetDocObjectServer
- COleServerDoc [MFC], OnClose
- COleServerDoc [MFC], OnExecOleCmd
- COleServerDoc [MFC], OnFrameWindowActivate
- COleServerDoc [MFC], OnGetEmbeddedItem
- COleServerDoc [MFC], OnReactivateAndUndo
- COleServerDoc [MFC], OnSetHostNames
- COleServerDoc [MFC], OnSetItemRects
- COleServerDoc [MFC], OnShowDocument
ms.assetid: a9cdd96a-e0ac-43bb-9203-2c29237e965c
ms.openlocfilehash: eec94a32fa0963d4cf2eccae0fb9e2423e75ffdc
ms.sourcegitcommit: fcb48824f9ca24b1f8bd37d647a4d592de1cc925
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/15/2019
ms.locfileid: "69503812"
---
# <a name="coleserverdoc-class"></a>Класс Колесервердок

Базовый класс для серверной документации OLE.

## <a name="syntax"></a>Синтаксис

```
class AFX_NOVTABLE COleServerDoc : public COleLinkingDoc
```

## <a name="members"></a>Участники

### <a name="public-constructors"></a>Открытые конструкторы

|name|Описание|
|----------|-----------------|
|[Колесервердок:: Колесервердок](#coleserverdoc)|Создает объект `COleServerDoc`.|

### <a name="public-methods"></a>Открытые методы

|name|Описание|
|----------|-----------------|
|[Колесервердок:: Активатедокобжект](#activatedocobject)|Активирует связанный документ DocObject.|
|[Колесервердок:: Активатеинплаце](#activateinplace)|Активирует документ для редактирования на месте.|
|[Колесервердок::D Еактиватеандундо](#deactivateandundo)|Деактивирует пользовательский интерфейс сервера.|
|[Колесервердок::D Искардундостате](#discardundostate)|Отклоняет сведения о состоянии отмены.|
|[Колесервердок:: Жетклиентсите](#getclientsite)|Извлекает указатель на базовый `IOleClientSite` интерфейс.|
|[Колесервердок:: Жетембеддедитем](#getembeddeditem)|Возвращает указатель на элемент, представляющий весь документ.|
|[Колесервердок:: Жетитемклипрект](#getitemcliprect)|Возвращает текущий прямоугольник обрезки для редактирования на месте.|
|[Колесервердок:: Жетитемпоситион](#getitemposition)|Возвращает текущий прямоугольник позиции относительно клиентской области приложения контейнера для редактирования на месте.|
|[Колесервердок:: Жетзумфактор](#getzoomfactor)|Возвращает коэффициент масштабирования в пикселях.|
|[Колесервердок:: Исдокобжект](#isdocobject)|Определяет, является ли документ DocObject.|
|[Колесервердок:: встраиваются](#isembedded)|Указывает, внедряется ли документ в документ контейнера или выполняется автономно.|
|[Колесервердок:: Исинплацеактиве](#isinplaceactive)|Возвращает значение TRUE, если элемент в данный момент активирован на месте.|
|[Колесервердок:: Нотифичанжед](#notifychanged)|Уведомляет контейнеры, что пользователь изменил документ.|
|[Колесервердок:: Нотификлосед](#notifyclosed)|Уведомляет контейнеры, что пользователь закрыл документ.|
|[Колесервердок:: Нотифиренаме](#notifyrename)|Уведомляет контейнеры, что пользователь переименовал документ.|
|[Колесервердок:: Нотифисавед](#notifysaved)|Уведомляет контейнеры, что пользователь сохранил документ.|
|[Колесервердок:: OnDeactivate](#ondeactivate)|Вызывается платформой, когда пользователь деактивирует элемент, активированный на месте.|
|[Колесервердок:: Ондеактиватеуи](#ondeactivateui)|Вызывается платформой для уничтожения элементов управления и других элементов пользовательского интерфейса, созданных для активации на месте.|
|[Колесервердок:: OnDocWindowActivate](#ondocwindowactivate)|Вызывается структурой при активации или отключении окна фрейма документа контейнера.|
|[Колесервердок:: Онресизебордер](#onresizeborder)|Вызывается платформой при изменении размеров окна фрейма или окна документа приложения-контейнера.|
|[Колесервердок:: Оншовконтролбарс](#onshowcontrolbars)|Вызывается платформой для отображения или скрытия панелей элементов управления для редактирования на месте.|
|[Колесервердок:: Онупдатедокумент](#onupdatedocument)|Вызывается платформой при сохранении документа сервера, который является внедренным элементом, с обновлением копии контейнера элемента.|
|[Колесервердок:: Рекуестпоситиончанже](#requestpositionchange)|Изменяет позицию фрейма редактирования на месте.|
|[Колесервердок:: Савимбеддинг](#saveembedding)|Указывает приложению контейнера сохранить документ.|
|[Колесервердок:: Скроллконтаинерби](#scrollcontainerby)|Прокручивает документ контейнера.|
|[Колесервердок:: Упдатеаллитемс](#updateallitems)|Уведомляет контейнеры, что пользователь изменил документ.|

### <a name="protected-methods"></a>Защищенные методы

|name|Описание|
|----------|-----------------|
|[Колесервердок:: Креатеинплацефраме](#createinplaceframe)|Вызывается платформой для создания окна фрейма для редактирования на месте.|
|[Колесервердок::D Естройинплацефраме](#destroyinplaceframe)|Вызывается платформой для уничтожения окна фрейма для редактирования на месте.|
|[Колесервердок:: Жетдокобжектсервер](#getdocobjectserver)|Переопределите эту функцию, чтобы создать `CDocObjectServer` новый объект и указать, что этот документ является контейнером DocObject.|
|[Колесервердок:: OnClose](#onclose)|Вызывается платформой, когда контейнер запрашивает закрытие документа.|
|[Колесервердок:: Онексеколекмд](#onexecolecmd)|Выполняет указанную команду или выводит справку для команды.|
|[Колесервердок:: OnFrameWindowActivate](#onframewindowactivate)|Вызывается структурой при активации или отключении окна фрейма контейнера.|
|[Колесервердок:: OnGetEmbeddedItem](#ongetembeddeditem)|Вызывается для получения `COleServerItem` объекта, который представляет весь документ; используется для получения внедренного элемента. Требуется реализация.|
|[Колесервердок:: Онреактиватеандундо](#onreactivateandundo)|Вызывается платформой для отмены изменений, внесенных во время редактирования на месте.|
|[Колесервердок:: Онсесостнамес](#onsethostnames)|Вызывается платформой, когда контейнер задает заголовок окна для внедренного объекта.|
|[Колесервердок:: Онсетитемректс](#onsetitemrects)|Вызывается платформой для размещения окна фрейма редактирования на месте в окне приложения-контейнера.|
|[Колесервердок:: Оншовдокумент](#onshowdocument)|Вызывается платформой для отображения или скрытия документа.|

## <a name="remarks"></a>Примечания

Серверный документ может содержать объекты [COleServerItem](../../mfc/reference/coleserveritem-class.md) , которые представляют интерфейс сервера для внедренных или связанных элементов. При запуске серверного приложения контейнером для изменения внедренного элемента этот элемент загружается как собственный серверный документ. объект содержит только один `COleServerItem` объект, состоящий из всего документа. `COleServerDoc` При запуске серверного приложения контейнером для изменения связанного элемента существующий документ загружается с диска; часть содержимого документа выделяется для обозначения связанного элемента.

`COleServerDoc`объекты также могут содержать элементы класса [COleClientItem](../../mfc/reference/coleclientitem-class.md) . Это позволяет создавать приложения-серверы контейнера. Платформа предоставляет функции для правильного хранения `COleClientItem` элементов при `COleServerItem` обслуживании объектов.

Если серверное приложение не поддерживает ссылки, серверный документ всегда будет содержать только один элемент сервера, представляющий весь внедренный объект в виде документа. Если серверное приложение поддерживает ссылки, оно должно создавать серверный элемент при каждом копировании выделения в буфер обмена.

Чтобы использовать `COleServerDoc`, производные от него класс и реализуйте функцию-член [OnGetEmbeddedItem](#ongetembeddeditem) , которая позволяет серверу поддерживать внедренные элементы. Производные от класса `COleServerItem` , чтобы реализовать элементы в документах и возвращать объекты этого класса из `OnGetEmbeddedItem`.

Для поддержки связанных элементов `COleServerDoc` предоставляет функцию члена [онжетлинкедитем](../../mfc/reference/colelinkingdoc-class.md#ongetlinkeditem) . Можно использовать реализацию по умолчанию или переопределить ее, если у вас есть собственный способ управления элементами документа.

Для каждого типа `COleServerDoc`серверного документа, поддерживаемого приложением, необходим один производный класс. Например, если серверное приложение поддерживает листы и диаграммы, необходимы два `COleServerDoc`производных класса.

Дополнительные сведения о серверах см. в статье [серверы: Реализация сервера](../../mfc/servers-implementing-a-server.md).

## <a name="inheritance-hierarchy"></a>Иерархия наследования

[CObject](../../mfc/reference/cobject-class.md)

[CCmdTarget](../../mfc/reference/ccmdtarget-class.md)

[CDocument](../../mfc/reference/cdocument-class.md)

[коледокумент](../../mfc/reference/coledocument-class.md)

[колелинкингдок](../../mfc/reference/colelinkingdoc-class.md)

`COleServerDoc`

## <a name="requirements"></a>Требования

**Заголовок:** афксоле. h

##  <a name="activatedocobject"></a>Колесервердок:: Активатедокобжект

Активирует связанный документ DocObject.

```
void ActivateDocObject();
```

### <a name="remarks"></a>Примечания

По умолчанию `COleServerDoc` не поддерживает активные документы (также называемые докобжектс). Чтобы включить эту поддержку, см. раздел [жетдокобжектсервер](#getdocobjectserver) and Class [кдокобжектсервер](../../mfc/reference/cdocobjectserver-class.md).

##  <a name="activateinplace"></a>Колесервердок:: Активатеинплаце

Активирует элемент для редактирования на месте.

```
BOOL ActivateInPlace();
```

### <a name="return-value"></a>Возвращаемое значение

Ненулевое значение в случае успешного выполнения; в противном случае — значение 0, указывающее, что элемент полностью открыт.

### <a name="remarks"></a>Примечания

Эта функция выполняет все операции, необходимые для активации на месте. Он создает окно фрейма, активирует его и изменяет размер элемента, настраивает общие меню и другие элементы управления, прокручивает элемент в представление и устанавливает фокус на окно фрейма на месте.

Эта функция вызывается реализацией [COleServerItem:: onShow](../../mfc/reference/coleserveritem-class.md#onshow)по умолчанию. Вызывайте эту функцию, если приложение поддерживает другую команду для активации на месте (например, Play).

##  <a name="coleserverdoc"></a>Колесервердок:: Колесервердок

`COleServerDoc` Конструирует объект, не подключаясь к системным DLL-библиотекам OLE.

```
COleServerDoc();
```

### <a name="remarks"></a>Примечания

Чтобы открыть связь с OLE, необходимо вызвать [колелинкингдок:: Register](../../mfc/reference/colelinkingdoc-class.md#register) . Если в приложении используется [COleTemplateServer](../../mfc/reference/coletemplateserver-class.md) , `COleLinkingDoc::Register` `COleLinkingDoc`метод вызывается для реализации `OnNewDocument`, `OnOpenDocument`и `OnSaveDocument`.

##  <a name="createinplaceframe"></a>Колесервердок:: Креатеинплацефраме

Платформа вызывает эту функцию, чтобы создать окно фрейма для редактирования на месте.

```
virtual COleIPFrameWnd* CreateInPlaceFrame(CWnd* pParentWnd);
```

### <a name="parameters"></a>Параметры

*ппарентвнд*<br/>
Указатель на родительское окно приложения контейнера.

### <a name="return-value"></a>Возвращаемое значение

Указатель на окно фрейма на месте или значение NULL в случае неудачи.

### <a name="remarks"></a>Примечания

Реализация по умолчанию использует сведения, указанные в шаблоне документа, для создания рамки. Используемое представление — это первое представление, созданное для документа. Это представление временно отсоединяется от исходного фрейма и прикрепляется к вновь созданному кадру.

Это расширенный переопределяемый объект.

##  <a name="deactivateandundo"></a>Колесервердок::D Еактиватеандундо

Вызывайте эту функцию, если приложение поддерживает операцию отмены, и пользователь выбирает отмену после активации элемента, но перед его редактированием.

```
BOOL DeactivateAndUndo();
```

### <a name="return-value"></a>Возвращаемое значение

Ненулевое значение, если операция выполнена успешно; в противном случае — значение 0.

### <a name="remarks"></a>Примечания

Если приложение-контейнер написано с помощью библиотека Microsoft Foundation Class, вызов этой функции приводит к вызову [COleClientItem:: ондеактиватеандундо](../../mfc/reference/coleclientitem-class.md#ondeactivateandundo) , который деактивирует пользовательский интерфейс сервера.

##  <a name="destroyinplaceframe"></a>Колесервердок::D Естройинплацефраме

Платформа вызывает эту функцию для уничтожения окна фрейма на месте и возврата окна документа серверного приложения в состояние до активации на месте.

```
virtual void DestroyInPlaceFrame(COleIPFrameWnd* pFrameWnd);
```

### <a name="parameters"></a>Параметры

*пфрамевнд*<br/>
Указатель на окно фрейма на месте, которое необходимо уничтожить.

### <a name="remarks"></a>Примечания

Это расширенный переопределяемый объект.

##  <a name="discardundostate"></a>Колесервердок::D Искардундостате

Если пользователь выполняет операцию редактирования, которая не может быть отменена, вызовите эту функцию, чтобы принудительно отменить сведения о состоянии отмены для приложения-контейнера.

```
BOOL DiscardUndoState();
```

### <a name="return-value"></a>Возвращаемое значение

Ненулевое значение, если операция выполнена успешно; в противном случае — значение 0.

### <a name="remarks"></a>Примечания

Эта функция предоставляется таким образом, чтобы серверы, поддерживающие отмену, могли освобождать ресурсы, которые в противном случае были бы использованы при помощи сведений о состоянии отмены, которые нельзя использовать.

##  <a name="getclientsite"></a>Колесервердок:: Жетклиентсите

Извлекает указатель на базовый `IOleClientSite` интерфейс.

```
LPOLECLIENTSITE GetClientSite() const;
```

### <a name="return-value"></a>Возвращаемое значение

Извлекает указатель на базовый интерфейс [иолеклиентсите](/windows/win32/api/oleidl/nn-oleidl-ioleclientsite) .

##  <a name="getdocobjectserver"></a>Колесервердок:: Жетдокобжектсервер

Переопределите эту функцию, чтобы создать `CDocObjectServer` новый элемент и вернуть указатель на него.

```
virtual CDocObjectServer* GetDocObjectServer(LPOLEDOCUMENTSITE pDocSite);
```

### <a name="parameters"></a>Параметры

*пдоксите*<br/>
Указатель на `IOleDocumentSite` интерфейс, который будет соединять этот документ с сервером.

### <a name="return-value"></a>Возвращаемое значение

Указатель на `CDocObjectServer`; Значение NULL, если операция завершилась ошибкой.

### <a name="remarks"></a>Примечания

При активации сервера DocObject возвращается указатель, отличный от NULL, и показывает, что клиент может поддерживать Докобжектс. Реализация по умолчанию возвращает значение NULL.

Стандартная реализация для документа, поддерживающего докобжектс, просто выделяет новый `CDocObjectServer` объект и возвращает его вызывающему объекту. Например:

[!code-cpp[NVC_MFCOleServer#3](../../mfc/codesnippet/cpp/coleserverdoc-class_1.cpp)]

##  <a name="getembeddeditem"></a>Колесервердок:: Жетембеддедитем

Вызовите эту функцию, чтобы получить указатель на элемент, представляющий весь документ.

```
COleServerItem* GetEmbeddedItem();
```

### <a name="return-value"></a>Возвращаемое значение

Указатель на элемент, представляющий весь документ; Значение NULL, если операция завершилась ошибкой.

### <a name="remarks"></a>Примечания

Он вызывает [колесервердок:: OnGetEmbeddedItem](#ongetembeddeditem), виртуальную функцию без реализации по умолчанию.

##  <a name="getitemcliprect"></a>Колесервердок:: Жетитемклипрект

Вызовите функцию-член, чтобы получить координаты обрезкиного прямоугольника элемента, который редактируется на месте. `GetItemClipRect`

```
void GetItemClipRect(LPRECT lpClipRect) const;
```

### <a name="parameters"></a>Параметры

*лпклипрект*<br/>
Указатель на `RECT` структуру `CRect` или объект, получающий координаты отсечения прямоугольника элемента.

### <a name="remarks"></a>Примечания

Координаты задаются в пикселях относительно клиентской области окна приложения контейнера.

Рисование не должно происходить за пределами прямоугольника обрезки. Как правило, рисование автоматически ограничено. Используйте эту функцию, чтобы определить, прокручивается ли пользователь за пределы видимой части документа. Если да, Прокрутите документ контейнера по мере необходимости с помощью вызова [скроллконтаинерби](#scrollcontainerby).

##  <a name="getitemposition"></a>Колесервердок:: Жетитемпоситион

Вызовите `GetItemPosition` функцию члена, чтобы получить координаты элемента, редактируемого на месте.

```
void GetItemPosition(LPRECT lpPosRect) const;
```

### <a name="parameters"></a>Параметры

*лппосрект*<br/>
Указатель на `RECT` структуру `CRect` или объект для получения координат элемента.

### <a name="remarks"></a>Примечания

Координаты задаются в пикселях относительно клиентской области окна приложения контейнера.

Позицию элемента можно сравнить с текущим прямоугольником обрезки, чтобы определить экстент, в котором элемент является видимым (или невидимым) на экране.

##  <a name="getzoomfactor"></a>Колесервердок:: Жетзумфактор

Функция `GetZoomFactor` -член определяет коэффициент масштабирования элемента, который был активирован для редактирования на месте.

```
BOOL GetZoomFactor(
    LPSIZE lpSizeNum = NULL,
    LPSIZE lpSizeDenom = NULL,
    LPCRECT lpPosRect = NULL) const;
```

### <a name="parameters"></a>Параметры

*лпсизенум*<br/>
Указатель на объект класса `CSize` , который будет содержать числитель коэффициента масштабирования. Может иметь значение NULL.

*лпсизеденом*<br/>
Указатель на объект класса `CSize` , который будет содержать знаменатель коэффициента масштабирования. Может иметь значение NULL.

*лппосрект*<br/>
Указатель на объект класса `CRect` , описывающий новую позицию элемента. Если этот аргумент имеет значение NULL, функция использует текущую позицию элемента.

### <a name="return-value"></a>Возвращаемое значение

Ненулевое значение, если элемент активирован для редактирования на месте, а его коэффициент масштабирования отличен от 100% (1:1); в противном случае — 0.

### <a name="remarks"></a>Примечания

Коэффициент масштабирования в пикселях — это доля размера элемента до его текущего экстента. Если в приложении-контейнере не задан экстент элемента, то используется его естественный экстент (как определено [COleServerItem:: OnGetExtent](../../mfc/reference/coleserveritem-class.md#ongetextent)).

Функция задает для своих первых двух аргументов числитель и знаменатель коэффициента масштабирования элемента. Если элемент не редактируется на месте, функция устанавливает для этих аргументов значение по умолчанию 100% (или 1:1) и возвращает ноль. Дополнительные сведения см. в техническом примечании 40, [изменении размера и масштабировании MFC/OLE на месте](../../mfc/tn040-mfc-ole-in-place-resizing-and-zooming.md).

##  <a name="isdocobject"></a>Колесервердок:: Исдокобжект

Определяет, является ли документ DocObject.

```
BOOL IsDocObject() const;
```

### <a name="return-value"></a>Возвращаемое значение

Значение TRUE, если документ является DocObject; в противном случае — FALSE.

##  <a name="isembedded"></a>Колесервердок:: встраиваются

Вызовите функцию-член, чтобы определить, представляет ли документ объект, внедренный в контейнер. `IsEmbedded`

```
BOOL IsEmbedded() const;
```

### <a name="return-value"></a>Возвращаемое значение

Ненулевое `COleServerDoc` значение, если объект является документом, представляющим объект, внедренный в контейнер; в противном случае — значение 0.

### <a name="remarks"></a>Примечания

Документ, загруженный из файла, не внедряется, хотя приложение-контейнер может управляться как ссылкой. Документ, внедренный в документ контейнера, считается внедренным.

##  <a name="isinplaceactive"></a>Колесервердок:: Исинплацеактиве

Вызовите функцию-член, чтобы определить, находится ли элемент в настоящий момент в активном состоянии. `IsInPlaceActive`

```
BOOL IsInPlaceActive() const;
```

### <a name="return-value"></a>Возвращаемое значение

Ненулевое `COleServerDoc` значение, если объект активен на месте; в противном случае — значение 0.

##  <a name="notifychanged"></a>Колесервердок:: Нотифичанжед

Вызовите эту функцию, чтобы уведомить все связанные элементы, подключенные к документу, который был изменен в документе.

```
void NotifyChanged();
```

### <a name="remarks"></a>Примечания

Как правило, эта функция вызывается после того, как пользователь изменяет некоторые глобальные атрибуты, такие как размеры серверного документа. Если элемент OLE связан с документом с автоматическим связыванием, элемент обновляется для отражения изменений. В приложениях контейнеров, написанных с помощью Библиотека Microsoft Foundation Class, вызывается функция `COleClientItem` -член [onChange](../../mfc/reference/coleclientitem-class.md#onchange) .

> [!NOTE]
>  Эта функция включена для обеспечения совместимости с OLE 1. Новые приложения должны использовать [упдатеаллитемс](#updateallitems).

##  <a name="notifyclosed"></a>Колесервердок:: Нотификлосед

Вызовите эту функцию, чтобы уведомить контейнеры, что документ был закрыт.

```
void NotifyClosed();
```

### <a name="remarks"></a>Примечания

Когда пользователь выбирает команду "Закрыть" из меню "файл" `NotifyClosed` , `COleServerDoc`вызывается реализацией функции-члена [онклоседокумент](../../mfc/reference/cdocument-class.md#onclosedocument) . В приложениях контейнеров, написанных с помощью Библиотека Microsoft Foundation Class, вызывается функция `COleClientItem` -член [onChange](../../mfc/reference/coleclientitem-class.md#onchange) .

##  <a name="notifyrename"></a>Колесервердок:: Нотифиренаме

Вызывайте эту функцию после того, как пользователь переименовывает серверный документ.

```
void NotifyRename(LPCTSTR lpszNewName);
```

### <a name="parameters"></a>Параметры

*лпсзневнаме*<br/>
Указатель на строку, указывающую новое имя серверного документа; Обычно это полный путь.

### <a name="remarks"></a>Примечания

Когда пользователь выбирает команду Сохранить как в меню файл, `NotifyRename` `COleServerDoc`вызывается реализацией функции-члена [онсаведокумент](../../mfc/reference/cdocument-class.md#onsavedocument) . Эта функция уведомляет системные библиотеки DLL OLE, которые, в свою очередь, уведомляют контейнеры. В приложениях контейнеров, написанных с помощью Библиотека Microsoft Foundation Class, вызывается функция `COleClientItem` -член [onChange](../../mfc/reference/coleclientitem-class.md#onchange) .

##  <a name="notifysaved"></a>Колесервердок:: Нотифисавед

Вызывайте эту функцию после того, как пользователь сохранит серверный документ.

```
void NotifySaved();
```

### <a name="remarks"></a>Примечания

Когда пользователь выбирает команду Сохранить в меню файл, `NotifySaved` вызывается для `COleServerDoc`реализации [онсаведокумент](../../mfc/reference/cdocument-class.md#onsavedocument). Эта функция уведомляет системные библиотеки DLL OLE, которые, в свою очередь, уведомляют контейнеры. В приложениях контейнеров, написанных с помощью Библиотека Microsoft Foundation Class, вызывается функция `COleClientItem` -член [onChange](../../mfc/reference/coleclientitem-class.md#onchange) .

##  <a name="onclose"></a>Колесервердок:: OnClose

Вызывается платформой, когда контейнер запрашивает закрытие серверного документа.

```
virtual void OnClose(OLECLOSE dwCloseOption);
```

### <a name="parameters"></a>Параметры

*двклосеоптион*<br/>
Значение из перечисления ОЛЕКЛОСЕ. Этот параметр может принимать одно из следующих значений:

- OLECLOSE_SAVEIFDIRTY. файл сохраняется, если он был изменен.

- OLECLOSE_NOSAVE. файл закрывается без сохранения.

- OLECLOSE_PROMPTSAVE если файл был изменен, пользователю будет предложено сохранить его.

### <a name="remarks"></a>Примечания

Реализация по умолчанию `CDocument::OnCloseDocument`вызывает.

Дополнительные сведения и дополнительные значения см. в разделе [олеклосе](/windows/win32/api/oleidl/ne-oleidl-oleclose) в Windows SDK.

##  <a name="ondeactivate"></a>Колесервердок:: OnDeactivate

Вызывается платформой, когда пользователь отключает внедренный или связанный элемент, который в настоящее время находится в активном месте.

```
virtual void OnDeactivate();
```

### <a name="remarks"></a>Примечания

Эта функция восстанавливает пользовательский интерфейс приложения-контейнера в исходное состояние и уничтожает все меню и другие элементы управления, созданные для активации на месте.

На этом этапе сведения о состоянии отмены должны быть выпущены безусловно.

Дополнительные сведения см. в статье [Активация](../../mfc/activation-cpp.md).

##  <a name="ondeactivateui"></a>Колесервердок:: Ондеактиватеуи

Вызывается, когда пользователь отключает элемент, который был активирован на месте.

```
virtual void OnDeactivateUI(BOOL bUndoable);
```

### <a name="parameters"></a>Параметры

*бундоабле*<br/>
Указывает, можно ли отменить изменения в редактировании.

### <a name="remarks"></a>Примечания

Эта функция восстанавливает пользовательский интерфейс приложения-контейнера в исходное состояние, скрывая все меню и другие элементы управления, созданные для активации на месте.

Платформа всегда задает для *бундоабле* значение false. Если сервер поддерживает операцию отмены и имеется операция, которая может быть отменена, вызовите реализацию базового класса с параметром *бундоабле* , ИМЕЮЩИМ значение true.

##  <a name="ondocwindowactivate"></a>Колесервердок:: OnDocWindowActivate

Платформа вызывает эту функцию для активации или деактивации окна документа для редактирования на месте.

```
virtual void OnDocWindowActivate(BOOL bActivate);
```

### <a name="parameters"></a>Параметры

*bActivate*<br/>
Указывает, должно ли окно документа быть активировано или отключено.

### <a name="remarks"></a>Примечания

Реализация по умолчанию удаляет или добавляет элементы пользовательского интерфейса на уровне фрейма соответствующим образом. Переопределите эту функцию, если требуется выполнить дополнительные действия при активации или деактивации документа, содержащего элемент.

Дополнительные сведения см. в статье [Активация](../../mfc/activation-cpp.md).

##  <a name="onexecolecmd"></a>Колесервердок:: Онексеколекмд

Платформа вызывает эту функцию, чтобы выполнить указанную команду или отобразить справку для команды.

```
virtual HRESULT OnExecOleCmd(
    const GUID* pguidCmdGroup,
    DWORD nCmdID,
    DWORD nCmdExecOpt,
    VARIANTARG* pvarargIn,
    VARIANTARG* pvarargOut);
```

### <a name="parameters"></a>Параметры

*пгуидкмдграуп*<br/>
Указатель на идентификатор GUID, определяющий набор команд. Может иметь значение NULL, чтобы указать группу команд по умолчанию.

*нкмдид*<br/>
Команда для выполнения. Должен входить в группу, обозначенную *пгуидкмдграуп*.

*нкмдексекаут*<br/>
Способ, которым объект должен выполнить команду, одно или несколько из следующих значений перечисления ОЛЕКМДЕКСЕКОПТ:

OLECMDEXECOPT_DODEFAULT

OLECMDEXECOPT_PROMPTUSER

OLECMDEXECOPT_DONTPROMPTUSER

OLECMDEXECOPT_SHOWHELP

*пвараргин*<br/>
Указатель на VARIANTARG, содержащий входные аргументы для команды. Может иметь значение NULL.

*пвараргаут*<br/>
Указатель на VARIANTARG для получения выходных возвращаемых значений команды. Может иметь значение NULL.

### <a name="return-value"></a>Возвращаемое значение

В случае успешного выполнения возвращает значение S_OK; в противном случае один из следующих кодов ошибки:

|Значение|Описание|
|-----------|-----------------|
|E_UNEXPECTED|Произошла непредвиденная ошибка|
|E_FAIL|Произошла ошибка|
|E_NOTIMPL|Указывает, что библиотека MFC должна попытаться преобразовать и отправить команду|
|OLECMDERR_E_UNKNOWNGROUP|*пгуидкмдграуп* не имеет значение null, но не указывает распознанную группу команд|
|OLECMDERR_E_NOTSUPPORTED|*нкмдид* не распознана как допустимая команда в группе *пгуидкмдграуп*|
|OLECMDERR_DISABLED|Команда, определенная параметром *нкмдид* , отключена и не может быть выполнена|
|OLECMDERR_NOHELP|Вызывающая сторона запросила справку по команде, указанной параметром *нкмдид* , но Справка недоступна|
|OLECMDERR_CANCELED|Выполнение прервано пользователем|

### <a name="remarks"></a>Примечания

`COleCmdUI`может использоваться для включения, обновления и настройки других свойств команд пользовательского интерфейса DocObject. После инициализации команд их можно выполнять с помощью `OnExecOleCmd`.

Платформа вызывает функцию перед попыткой преобразования и отправки команды OLE Document. Вам не нужно переопределять эту функцию для обработки стандартных команд документов OLE, но необходимо указать переопределение этой функции, если вы хотите обрабатывать собственные пользовательские команды или обрабатывать команды, принимающие параметры или возвращающие результаты.

Большинство команд не принимает аргументы или возвращаемые значения. Для большинства команд вызывающий объект может передавать значения NULL для *пвараргин* и *пвараргаут*. Для команд, которые предполагают входные значения, вызывающий объект может объявить и инициализировать переменную VARIANTARG и передать указатель на переменную в *пвараргин*. Для команд, для которых требуется одиночное значение, аргумент может храниться непосредственно в VARIANTARG и передаваться в функцию. Несколько аргументов должны быть упакованы в VARIANTARG с помощью одного из поддерживаемых типов (например `IDispatch` , и SAFEARRAY).

Аналогично, если команда возвращает аргументы, то вызывающий объект должен объявить VARIANTARG, инициализировать его в VT_EMPTY и передать его адрес в *пвараргаут*. Если команда возвращает одно значение, объект может сохранить это значение непосредственно в *пвараргаут*. Несколько выходных значений должны быть упакованы в соответствии с VARIANTARG.

Реализация этой функции в базовом классе будет проанализировать структуры OLE_COMMAND_MAP, связанные с целевым объектом команды, и попытаться передать команду соответствующему обработчику. Реализация базового класса работает только с командами, которые не допускают аргументы или возвращаемые значения. Если необходимо обрабатывать команды, принимающие аргументы или возвращаемые значения, необходимо переопределить эту функцию и самостоятельно работать с параметрами *пвараргин* и *пвараргаут* .

##  <a name="onframewindowactivate"></a>Колесервердок:: OnFrameWindowActivate

Платформа вызывает эту функцию, когда окно фрейма приложения контейнера активируется или деактивируется.

```
virtual void OnFrameWindowActivate(BOOL bActivate);
```

### <a name="parameters"></a>Параметры

*bActivate*<br/>
Указывает, следует ли активировать или деактивировать окно фрейма.

### <a name="remarks"></a>Примечания

Реализация по умолчанию отменяет все режимы справки, в которых может находиться окно фрейма. Переопределите эту функцию, если требуется выполнить специальную обработку при активации или отключении окна фрейма.

Дополнительные сведения см. в статье [Активация](../../mfc/activation-cpp.md).

##  <a name="ongetembeddeditem"></a>Колесервердок:: OnGetEmbeddedItem

Вызывается платформой, когда приложение-контейнер вызывает серверное приложение для создания или изменения внедренного элемента.

```
virtual COleServerItem* OnGetEmbeddedItem() = 0;
```

### <a name="return-value"></a>Возвращаемое значение

Указатель на элемент, представляющий весь документ; Значение NULL, если операция завершилась ошибкой.

### <a name="remarks"></a>Примечания

Реализация по умолчанию отсутствует. Необходимо переопределить эту функцию, чтобы она возвращала элемент, представляющий весь документ. Это возвращаемое значение должно быть объектом класса, `COleServerItem`производного от.

##  <a name="onreactivateandundo"></a>Колесервердок:: Онреактиватеандундо

Платформа вызывает эту функцию, когда пользователь отменяет изменения, внесенные в элемент, который был активирован на месте, был изменен и впоследствии деактивирован.

```
virtual BOOL OnReactivateAndUndo();
```

### <a name="return-value"></a>Возвращаемое значение

Имеет ненулевое значение в случае успешного выполнения, иначе — 0.

### <a name="remarks"></a>Примечания

Реализация по умолчанию не выполняет никаких действий, кроме возврата значения FALSE для обозначения сбоя.

Переопределите эту функцию, если приложение поддерживает операцию отмены. Обычно вы выполняете операцию отмены, а затем активируете элемент, вызывая `ActivateInPlace`. Если приложение-контейнер записывается с Библиотека Microsoft Foundation Class, вызов `COleClientItem::ReactivateAndUndo` приводит к вызову этой функции.

##  <a name="onresizeborder"></a>Колесервердок:: Онресизебордер

Платформа вызывает эту функцию при изменении размера окна фрейма приложения контейнера.

```
virtual void OnResizeBorder(
    LPCRECT lpRectBorder,
    LPOLEINPLACEUIWINDOW lpUIWindow,
    BOOL bFrame);
```

### <a name="parameters"></a>Параметры

*лпректбордер*<br/>
Указатель на `RECT` структуру `CRect` или объект, указывающий координаты границы.

*лпуивиндов*<br/>
Указатель на объект класса `IOleInPlaceUIWindow` , которому принадлежит текущий сеанс редактирования на месте.

*бфраме*<br/>
Значение TRUE, если *лпуивиндов* указывает на окно фрейма верхнего уровня приложения-контейнера, или значение false, если *лпуивиндов* указывает на окно фрейма уровня документа приложения-контейнера.

### <a name="remarks"></a>Примечания

Эта функция изменяет размер и настройку панелей инструментов и других элементов пользовательского интерфейса в соответствии с новым размером окна.

Дополнительные сведения см. в разделе [иолеинплацеуивиндов](/windows/win32/api/oleidl/nn-oleidl-ioleinplaceuiwindow) в Windows SDK.

Это расширенный переопределяемый объект.

##  <a name="onsethostnames"></a>  COleServerDoc::OnSetHostNames

Вызывается платформой, когда контейнер задает или изменяет имена узлов для этого документа.

```
virtual void OnSetHostNames(
    LPCTSTR lpszHost,
    LPCTSTR lpszHostObj);
```

### <a name="parameters"></a>Параметры

*лпсзост*<br/>
Указатель на строку, указывающую имя приложения-контейнера.

*лпсзостобж*<br/>
Указатель на строку, указывающую имя контейнера для документа.

### <a name="remarks"></a>Примечания

Реализация по умолчанию изменяет заголовок документа для всех представлений, ссылающихся на этот документ.

Переопределите эту функцию, если приложение задает заголовки с помощью другого механизма.

##  <a name="onsetitemrects"></a>Колесервердок:: Онсетитемректс

Платформа вызывает эту функцию для размещения окна фрейма редактирования на месте в окне фрейма приложения-контейнера.

```
virtual void OnSetItemRects(
    LPCRECT lpPosRect,
    LPCRECT lpClipRect);
```

### <a name="parameters"></a>Параметры

*лппосрект*<br/>
Указатель на `RECT` структуру `CRect` или объект, указывающий расположение окна фрейма на месте относительно клиентской области приложения-контейнера.

*лпклипрект*<br/>
Указатель на `RECT` структуру `CRect` или объект, указывающий прямоугольник обрезки окна фрейма на месте относительно клиентской области приложения-контейнера.

### <a name="remarks"></a>Примечания

Переопределите эту функцию, чтобы при необходимости обновить коэффициент масштабирования представления.

Эта функция обычно вызывается в ответ на `RequestPositionChange` вызов, хотя контейнер может вызывать изменение позиции для элемента на месте в любой момент времени.

##  <a name="onshowcontrolbars"></a>Колесервердок:: Оншовконтролбарс

Платформа вызывает эту функцию для отображения или скрытия панелей управления серверного приложения, связанных с фреймом окна, идентифицируемым *пфрамевнд*.

```
virtual void OnShowControlBars(
    CFrameWnd* pFrameWnd,
    BOOL bShow);
```

### <a name="parameters"></a>Параметры

*пфрамевнд*<br/>
Указатель на окно фрейма, панели управления которого должны быть скрыты или отображены.

*bShow*<br/>
Определяет, будут ли отображаться или скрыты панели управления.

### <a name="remarks"></a>Примечания

Реализация по умолчанию перечисляет все панели управления, принадлежащие этому окну фрейма, и скрывает или отображает их.

##  <a name="onshowdocument"></a>Колесервердок:: Оншовдокумент

Платформа вызывает функцию, `OnShowDocument` когда серверный документ должен быть скрыт или показан.

```
virtual void OnShowDocument(BOOL bShow);
```

### <a name="parameters"></a>Параметры

*bShow*<br/>
Указывает, следует ли отображать или скрывать пользовательский интерфейс для документа.

### <a name="remarks"></a>Примечания

Если *бшов* имеет значение true, реализация по умолчанию активирует серверное приложение, если это необходимо, и заставляет приложение-контейнер прокручивать окно, чтобы элемент был видимым. Если *бшов* имеет значение false, реализация по умолчанию деактивирует элемент с помощью вызова `OnDeactivate`, а затем уничтожает или скрывает все окна фрейма, созданные для документа, за исключением первого. Если видимые документы не сохраняются, реализация по умолчанию скрывает серверное приложение.

##  <a name="onupdatedocument"></a>Колесервердок:: Онупдатедокумент

Вызывается платформой при сохранении документа, который является внедренным элементом в составном документе.

```
virtual BOOL OnUpdateDocument();
```

### <a name="return-value"></a>Возвращаемое значение

Ненулевое значение, если документ успешно обновлен; в противном случае — 0.

### <a name="remarks"></a>Примечания

Реализация по умолчанию вызывает функции члена [колесервердок:: нотифисавед](#notifysaved) и [Колесервердок:: савимбеддинг](#saveembedding) , а затем помечает документ как чистый. Переопределите эту функцию, если требуется выполнить специальную обработку при обновлении внедренного элемента.

##  <a name="requestpositionchange"></a>Колесервердок:: Рекуестпоситиончанже

Вызовите эту функцию члена, чтобы приложение контейнера изменило позицию элемента.

```
void RequestPositionChange(LPCRECT lpPosRect);
```

### <a name="parameters"></a>Параметры

*лппосрект*<br/>
Указатель на `RECT` структуру `CRect` или объект, содержащий новую позицию элемента.

### <a name="remarks"></a>Примечания

Эта функция обычно вызывается (в сочетании с `UpdateAllItems`) при изменении данных в активном элементе на месте. После этого вызова контейнер может или не будет выполнять изменение путем вызова метода `OnSetItemRects`. Результирующая единица может отличаться от запрошенной.

##  <a name="saveembedding"></a>Колесервердок:: Савимбеддинг

Вызовите эту функцию, чтобы сообщить приложению контейнера о необходимости сохранить внедренный объект.

```
void SaveEmbedding();
```

### <a name="remarks"></a>Примечания

Эта функция вызывается автоматически из `OnUpdateDocument`. Обратите внимание, что эта функция приводит к обновлению элемента на диске, поэтому он обычно вызывается только в результате выполнения определенного действия пользователя.

##  <a name="scrollcontainerby"></a>Колесервердок:: Скроллконтаинерби

Вызовите функцию `sizeScroll` членадляпрокруткидокументаконтейнеранавеличину(впикселях)`ScrollContainerBy` , обозначенную.

```
BOOL ScrollContainerBy(CSize sizeScroll);
```

### <a name="parameters"></a>Параметры

*сизескролл*<br/>
Указывает, насколько далеко документ контейнера прокручивается.

### <a name="return-value"></a>Возвращаемое значение

Имеет ненулевое значение в случае успешного выполнения, иначе — 0.

### <a name="remarks"></a>Примечания

Положительные значения обозначают прокрутку вниз и вправо; отрицательные значения указывают на прокрутку вверх и влево.

##  <a name="updateallitems"></a>Колесервердок:: Упдатеаллитемс

Вызовите эту функцию, чтобы уведомить все связанные элементы, подключенные к документу, который был изменен в документе.

```
void UpdateAllItems(
    COleServerItem* pSender,
    LPARAM lHint = 0L,
    CObject* pHint = NULL,
    DVASPECT nDrawAspect = DVASPECT_CONTENT);
```

### <a name="parameters"></a>Параметры

*псендер*<br/>
Указатель на элемент, который изменил документ, или значение NULL, если все элементы должны быть обновлены.

*лхинт*<br/>
Содержит сведения об изменении.

*финт*<br/>
Указатель на объект, в котором хранятся сведения об изменении.

*ндраваспект*<br/>
Определяет способ рисования элемента. Это значение из перечисления ДВАСПЕКТ. Этот параметр может принимать одно из следующих значений:

- Элемент DVASPECT_CONTENT представлен таким образом, что его можно отобразить как внедренный объект внутри своего контейнера.

- Элемент DVASPECT_THUMBNAIL отображается в виде эскиза, чтобы его можно было отобразить в средстве просмотра.

- Элемент DVASPECT_ICON представляется значком.

- Элемент DVASPECT_DOCPRINT представлен так, как будто он был распечатан с помощью команды Печать в меню файл.

### <a name="remarks"></a>Примечания

Обычно эта функция вызывается после того, как пользователь изменяет серверный документ. Если элемент OLE связан с документом с автоматическим связыванием, элемент обновляется для отражения изменений. В приложениях контейнеров, написанных с помощью Библиотека Microsoft Foundation Class, вызывается функция `COleClientItem` -член [onChange](../../mfc/reference/coleclientitem-class.md#onchange) .

`OnUpdate` Эта функция вызывает функцию члена для каждого элемента документа, за исключением отправляющего элемента, передав *финт*, *лхинт*и *ндраваспект*. Используйте эти параметры для передачи сведений в элементы об изменениях, внесенных в документ. Вы можете кодировать информацию с помощью *лхинт* или определить `CObject`производный класс для хранения сведений об изменениях и передать объект этого класса с помощью *финт*. Переопределите функцию `COleServerItem`- членвклассе,производномот,чтобыоптимизироватьобновлениекаждогоэлементавзависимостиоттого,измениласьлиегопрезентация.`OnUpdate`

## <a name="see-also"></a>См. также

[Пример MFC для примера HIERSVR](../../overview/visual-cpp-samples.md)<br/>
[Класс COleLinkingDoc](../../mfc/reference/colelinkingdoc-class.md)<br/>
[Диаграмма иерархии](../../mfc/hierarchy-chart.md)<br/>
[Класс COleDocument](../../mfc/reference/coledocument-class.md)<br/>
[Класс COleLinkingDoc](../../mfc/reference/colelinkingdoc-class.md)<br/>
[Класс COleTemplateServer](../../mfc/reference/coletemplateserver-class.md)
