---
description: 'Дополнительные сведения о: Кмутекс Class'
title: Класс Кмутекс
ms.date: 11/04/2016
f1_keywords:
- CMutex
- AFXMT/CMutex
- AFXMT/CMutex::CMutex
helpviewer_keywords:
- CMutex [MFC], CMutex
ms.assetid: 6330c050-4f01-4195-a099-2029b92f8cf1
ms.openlocfilehash: 4890a99d52fb8142bac0cc25d6a23ef6dbcaed5b
ms.sourcegitcommit: d6af41e42699628c3e2e6063ec7b03931a49a098
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2020
ms.locfileid: "97331487"
---
# <a name="cmutex-class"></a>Класс Кмутекс

Представляет "мьютекс" — объект синхронизации, позволяющий одному потоку взаимно исключать доступ к ресурсу.

## <a name="syntax"></a>Синтаксис

```
class CMutex : public CSyncObject
```

## <a name="members"></a>Члены

### <a name="public-constructors"></a>Открытые конструкторы

|name|Описание|
|----------|-----------------|
|[Кмутекс:: Кмутекс](#cmutex)|Формирует объект `CMutex`.|

## <a name="remarks"></a>Комментарии

Мьютексы полезны, когда только одному потоку за раз можно разрешить изменять данные или другие контролируемые ресурсы. Например, Добавление узлов в связанный список — это процесс, который должен быть разрешен только одним потоком за раз. При использовании `CMutex` объекта для управления связанным списком только один поток за раз может получить доступ к списку.

Чтобы использовать `CMutex` объект, создайте `CMutex` объект при необходимости. Укажите имя мьютекса, который вы хотите подождать, и ваше приложение должно его изначально владеть. Затем можно получить доступ к мьютексу, когда конструктор возвращает. По завершении доступа к контролируемому ресурсу вызовите метод [ксинкобжект:: Unlock](../../mfc/reference/csyncobject-class.md#unlock) .

Альтернативный способ использования `CMutex` объектов — добавить переменную типа в `CMutex` качестве члена данных в класс, которым вы хотите управлять. Во время создания управляемого объекта вызовите конструктор `CMutex` элемента данных, указав, является ли мьютекс изначально владельцем, имя мьютекса (если оно будет использоваться в границах процесса) и требуемые атрибуты безопасности.

Для доступа к ресурсам, управляемым `CMutex` объектами таким способом, сначала создайте переменную типа [Ксинглелокк](../../mfc/reference/csinglelock-class.md) или [кмултилокк](../../mfc/reference/cmultilock-class.md) в функции-члене доступа ресурса. Затем вызовите `Lock` функцию-член объекта Lock (например, [ксинглелокк:: Lock](../../mfc/reference/csinglelock-class.md#lock)). На этом этапе ваш поток будет либо получать доступ к ресурсу, дожидаться освобождения ресурса и получения доступа, либо дожидаться освобождения и истечения времени ожидания ресурса и не сможет получить доступ к ресурсу. В любом случае доступ к ресурсу осуществляется потокобезопасным способом. Чтобы освободить ресурс, используйте `Unlock` функцию-член объекта Lock (например, [ксинглелокк:: Unlock](../../mfc/reference/csinglelock-class.md#unlock)) или разрешите, что объект блокировки выходит за пределы области.

Дополнительные сведения об использовании `CMutex` объектов см. в статье [многопоточность. Использование классов синхронизации](../../parallel/multithreading-how-to-use-the-synchronization-classes.md).

## <a name="inheritance-hierarchy"></a>Иерархия наследования

[CObject](../../mfc/reference/cobject-class.md)

[CSyncObject](../../mfc/reference/csyncobject-class.md)

`CMutex`

## <a name="requirements"></a>Требования

**Заголовок:** афксмт. h

## <a name="cmutexcmutex"></a><a name="cmutex"></a> Кмутекс:: Кмутекс

Конструирует именованный или безымянный `CMutex` объект.

```
CMutex(
    BOOL bInitiallyOwn = FALSE,
    LPCTSTR lpszName = NULL,
    LPSECURITY_ATTRIBUTES lpsaAttribute = NULL);
```

### <a name="parameters"></a>Параметры

*бинитиаллйовн*<br/>
Указывает, имеет ли поток, создающий `CMutex` объект, первоначальный доступ к ресурсу, управляемому мьютексом.

*лпсзнаме*<br/>
Имя объекта `CMutex`. Если существует другой мьютекс с тем же именем, *лпсзнаме* должен быть указан, если объект будет использоваться через границы процесса. Если **значение равно NULL**, мьютекс будет безымянным. Если имя совпадает с существующим мьютексом, конструктор создает новый объект, `CMutex` который ссылается на мьютекс этого имени. Если имя совпадает с существующим объектом синхронизации, который не является мьютексом, построение завершится ошибкой.

*лпсааттрибуте*<br/>
Атрибуты безопасности для объекта Mutex. Полное описание этой структуры см. в разделе [SECURITY_ATTRIBUTES](/previous-versions/windows/desktop/legacy/aa379560\(v=vs.85\)) в Windows SDK.

### <a name="remarks"></a>Комментарии

Чтобы получить доступ к объекту или освободить `CMutex` его, создайте объект [Кмултилокк](../../mfc/reference/cmultilock-class.md) или [ксинглелокк](../../mfc/reference/csinglelock-class.md) и вызовите его функции-члены [Lock](../../mfc/reference/csinglelock-class.md#lock) и [Unlock](../../mfc/reference/csinglelock-class.md#unlock) . Если `CMutex` объект используется в автономном режиме, вызовите его `Unlock` функцию-член, чтобы освободить его.

> [!IMPORTANT]
> После создания `CMutex` объекта используйте [GetLastError](/windows/win32/api/errhandlingapi/nf-errhandlingapi-getlasterror) , чтобы убедиться, что мьютекс еще не существовал. Если мьютекс был неожиданно существовал, это может указывать на то, что случайный процесс занят и может полагаться на использование мьютекса злонамеренно. В этом случае рекомендуемой процедурой безопасности является закрытие обработчика и продолжение работы так, как если бы при создании объекта произошел сбой.

## <a name="see-also"></a>См. также раздел

[Класс Ксинкобжект](../../mfc/reference/csyncobject-class.md)<br/>
[Иерархическая диаграмма](../../mfc/hierarchy-chart.md)
