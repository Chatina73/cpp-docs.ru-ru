---
title: Класс CMutex
ms.date: 11/04/2016
f1_keywords:
- CMutex
- AFXMT/CMutex
- AFXMT/CMutex::CMutex
helpviewer_keywords:
- CMutex [MFC], CMutex
ms.assetid: 6330c050-4f01-4195-a099-2029b92f8cf1
ms.openlocfilehash: f85e562af9d048503be20d1ab5d219fe8d2d039f
ms.sourcegitcommit: c3093251193944840e3d0a068ecc30e6449624ba
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/04/2019
ms.locfileid: "57273300"
---
# <a name="cmutex-class"></a>Класс CMutex

Представляет «семафор» — объект синхронизации, позволяющий один поток взаимно исключают друг друга доступ к ресурсу.

## <a name="syntax"></a>Синтаксис

```
class CMutex : public CSyncObject
```

## <a name="members"></a>Члены

### <a name="public-constructors"></a>Открытые конструкторы

|Имя|Описание:|
|----------|-----------------|
|[CMutex::CMutex](#cmutex)|Создает объект `CMutex`.|

## <a name="remarks"></a>Примечания

Мьютексы полезны в тех случаях, когда изменение данных или другой управляемый ресурс можно предоставить только один поток за раз. Например добавление узлов в связанный список — это процесс, который должен осуществляться только одним потоком за раз. С помощью `CMutex` объект для управления в связанном списке, только один поток за раз можно получить доступ к списку.

Чтобы использовать `CMutex` объекта, создания `CMutex` объекта при необходимости. Укажите имя для ожидания семафора и приложение должно изначально он принадлежит. При возврате в конструктор, можно затем получить мьютекс. Вызовите [CSyncObject::Unlock](../../mfc/reference/csyncobject-class.md#unlock) после получения доступа к управляемой ресурсу.

Альтернативный метод с помощью `CMutex` объектов заключается в добавлении переменной типа `CMutex` как элемент данных, к классу, для управления. Во время создания управляемого объекта, вызовите конструктор `CMutex` элемент данных, указывающая ли мьютекс изначально имеет владельца, имя мьютекса (если он будет использоваться через границы процесса) и необходимости атрибуты безопасности.

Для доступа к ресурсам, которые управляются `CMutex` объектов таким образом, сначала создайте переменную типа [CSingleLock](../../mfc/reference/csinglelock-class.md) или тип [CMultiLock](../../mfc/reference/cmultilock-class.md) в функции-члене доступ к ресурсу. Затем вызовите объект блокировки `Lock` функции-члена (например, [CSingleLock::Lock](../../mfc/reference/csinglelock-class.md#lock)). На этом этапе поток будет либо получить доступ к ресурсу, подождите, пока ресурс освобождается и получить доступ или ожидания ресурса, освобождения и время ожидания, не удалось получить доступ к ресурсу. В любом случае ресурс уже был осуществлен потокобезопасным способом. Для освобождения ресурса, используйте объект блокировки `Unlock` функции-члена (например, [CSingleLock::Unlock](../../mfc/reference/csinglelock-class.md#unlock)), или разрешить объект блокировки само выходит из области.

Дополнительные сведения об использовании `CMutex` объектов, см. в статье [Многопоточность: Практическое использование классов синхронизации](../../parallel/multithreading-how-to-use-the-synchronization-classes.md).

## <a name="inheritance-hierarchy"></a>Иерархия наследования

[CObject](../../mfc/reference/cobject-class.md)

[CSyncObject](../../mfc/reference/csyncobject-class.md)

`CMutex`

## <a name="requirements"></a>Требования

**Заголовок:** afxmt.h

##  <a name="cmutex"></a>  CMutex::CMutex

Создает именованную или неименованную `CMutex` объекта.

```
CMutex(
    BOOL bInitiallyOwn = FALSE,
    LPCTSTR lpszName = NULL,
    LPSECURITY_ATTRIBUTES lpsaAttribute = NULL);
```

### <a name="parameters"></a>Параметры

*bInitiallyOwn*<br/>
Указывает, если создание потока `CMutex` объект изначально имеет доступ к ресурсу, контролируются мьютекса.

*lpszName*<br/>
Имя объекта `CMutex`. Если существует другой мьютекс с тем же именем, *lpszName* должно указываться, если объект будет использоваться через границы процессов. Если **NULL**, мьютекс будет без имени. Если имя соответствует существующей mutex, конструктор создает новый `CMutex` объект, который ссылается на мьютекс этим именем. Если имя совпадает с существующий объект синхронизации, не мьютекс, построение завершится ошибкой.

*lpsaAttribute*<br/>
Атрибуты безопасности для объекта мьютекса. Полное описание этой структуры, см. в разделе [SECURITY_ATTRIBUTES](https://msdn.microsoft.com/library/windows/desktop/aa379560) в пакете Windows SDK.

### <a name="remarks"></a>Примечания

Для доступа к или выпуска `CMutex` следует создать [CMultiLock](../../mfc/reference/cmultilock-class.md) или [CSingleLock](../../mfc/reference/csinglelock-class.md) и вызовите его [блокировки](../../mfc/reference/csinglelock-class.md#lock) и [Unlock](../../mfc/reference/csinglelock-class.md#unlock) функции-члены. Если `CMutex` объекта используется автономный, вызвать его `Unlock` функция-член для его освобождения.

> [!IMPORTANT]
>  После создания `CMutex` , используйте [GetLastError](https://msdn.microsoft.com/library/windows/desktop/ms679360) чтобы убедиться, что мьютекс не существовал. Если мьютексом существовала неожиданно, это может указывать нелегальные процессы — занятие и может вы собираетесь использовать мьютекс злоумышленником. В этом случае соображениям безопасности рекомендуется закрыть дескриптор и продолжить как, если произошел сбой при создании объекта.

## <a name="see-also"></a>См. также

[Класс CSyncObject](../../mfc/reference/csyncobject-class.md)<br/>
[Диаграмма иерархии](../../mfc/hierarchy-chart.md)
