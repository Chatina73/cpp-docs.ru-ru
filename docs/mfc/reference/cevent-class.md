---
title: Класс Цевент
ms.date: 11/04/2016
f1_keywords:
- CEvent
- AFXMT/CEvent
- AFXMT/CEvent::CEvent
- AFXMT/CEvent::PulseEvent
- AFXMT/CEvent::ResetEvent
- AFXMT/CEvent::SetEvent
- AFXMT/CEvent::Unlock
helpviewer_keywords:
- CEvent [MFC], CEvent
- CEvent [MFC], PulseEvent
- CEvent [MFC], ResetEvent
- CEvent [MFC], SetEvent
- CEvent [MFC], Unlock
ms.assetid: df676042-ce27-4702-800a-e73ff4f44395
ms.openlocfilehash: fbf2d834163199107aae44bd5723ceff79e36f91
ms.sourcegitcommit: fcb48824f9ca24b1f8bd37d647a4d592de1cc925
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/15/2019
ms.locfileid: "69506680"
---
# <a name="cevent-class"></a>Класс Цевент

Представляет событие, которое представляет собой объект синхронизации, позволяющий одному потоку уведомлять другой, что произошло событие.

## <a name="syntax"></a>Синтаксис

```
class CEvent : public CSyncObject
```

## <a name="members"></a>Участники

### <a name="public-constructors"></a>Открытые конструкторы

|name|Описание|
|----------|-----------------|
|[Цевент:: Цевент](#cevent)|Создает объект `CEvent`.|

### <a name="public-methods"></a>Открытые методы

|name|Описание|
|----------|-----------------|
|[Цевент::P Улсивент](#pulseevent)|Устанавливает для события значение "доступно" (сигнальное), освобождает ожидающие потоки и устанавливает недоступное (несигнальное) событие.|
|[Цевент:: Ресетевент](#resetevent)|Задает событие как недоступное (несигнальное).|
|[Цевент:: выполнить SetEvent](#setevent)|Устанавливает для события значение доступно (сигнальное) и освобождает все ожидающие потоки.|
|[Цевент:: Unlock](#unlock)|Освобождает объект события.|

## <a name="remarks"></a>Примечания

События полезны, когда поток должен уметь выполнять свою задачу. Например, поток, который копирует данные в архив данных, должен получать уведомления о доступности новых данных. При использовании `CEvent` объекта для уведомления потока копирования о доступности новых данных поток может выполнить свою задачу как можно скорее.

`CEvent`объекты имеют два типа: ручной и автоматический.

Автоматический `CEvent` объект автоматически возвращается в несигнальное состояние (недоступно) после освобождения по крайней мере одного потока. По умолчанию `CEvent` объект автоматически выполняется, если не передать `TRUE` параметр *бмануалресет* во время создания.

Ручной `CEvent` объект остается в состоянии, заданном [выполнить SetEvent](#setevent) или [ресетевент](#resetevent) , пока не будет вызвана другая функция. Чтобы создать ручной `CEvent` объект, передайте `TRUE` `bManualReset` параметр во время создания.

Чтобы использовать `CEvent` объект, при необходимости `CEvent` создайте объект. Укажите имя события, которое требуется подождать, а также укажите, что приложение должно его владеть. Затем можно получить доступ к событию, когда конструктор возвращает. Вызовите [выполнить SetEvent](#setevent) , чтобы сообщить (сделать доступным) объект события, а затем вызовите [Unlock](#unlock) , когда вы завершите доступ к контролируемому ресурсу.

Альтернативным методом использования `CEvent` объектов является добавление переменной типа `CEvent` в качестве члена данных в класс, которым требуется управлять. Во время создания управляемого объекта вызовите конструктор `CEvent` элемента данных и укажите, является ли событие первоначально сигнальным, а также спеЦифисе тип объекта события, имя события (если оно будет использоваться в процессе). границы) и любые необходимые атрибуты безопасности.

Чтобы получить доступ к ресурсу, `CEvent` управляемому объектом таким образом, сначала создайте переменную типа [ксинглелокк](../../mfc/reference/csinglelock-class.md) или [кмултилокк](../../mfc/reference/cmultilock-class.md) в методе доступа ресурса. Затем вызовите `Lock` метод объекта Lock (например, [кмултилокк:: Lock](../../mfc/reference/cmultilock-class.md#lock)). На этом этапе ваш поток будет либо получать доступ к ресурсу, дожидаться освобождения ресурса и получения доступа, либо дожидаться освобождения ресурса, истечения времени ожидания и не сможет получить доступ к ресурсу. В любом случае доступ к ресурсу осуществляется потокобезопасным способом. Чтобы освободить ресурс, вызовите `SetEvent` , чтобы передать объект события, а затем `Unlock` используйте метод объекта блокировки (например, [кмултилокк:: Unlock](../../mfc/reference/cmultilock-class.md#unlock)) или разрешите, что объект блокировки выходит за пределы области.

Дополнительные сведения об использовании `CEvent` объектов см. в разделе [многопоточность. Использование классов](../../parallel/multithreading-how-to-use-the-synchronization-classes.md)синхронизации.

## <a name="example"></a>Пример

[!code-cpp[NVC_MFC_Utilities#45](../../mfc/codesnippet/cpp/cevent-class_1.cpp)]

[!code-cpp[NVC_MFC_Utilities#46](../../mfc/codesnippet/cpp/cevent-class_2.cpp)]

## <a name="inheritance-hierarchy"></a>Иерархия наследования

[CObject](../../mfc/reference/cobject-class.md)

[ксинкобжект](../../mfc/reference/csyncobject-class.md)

`CEvent`

## <a name="requirements"></a>Требования

**Заголовок:** афксмт. h

##  <a name="cevent"></a>Цевент:: Цевент

Конструирует именованный или безымянный `CEvent` объект.

```
CEvent(
    BOOL bInitiallyOwn = FALSE,
    BOOL bManualReset = FALSE,
    LPCTSTR lpszName = NULL,
    LPSECURITY_ATTRIBUTES lpsaAttribute = NULL);
```

### <a name="parameters"></a>Параметры

*бинитиаллйовн*<br/>
Значение true показывает, что поток для `CMultilock` объекта `CSingleLock` или включен. В противном случае все потоки, желающие получить доступ к ресурсу, должны подождать.

*бмануалресет*<br/>
Значение TRUE указывает, что объект события является ручным событием, в противном случае объект события является автоматическим событием.

*лпсзнаме*<br/>
Имя объекта `CEvent`. Должен быть указан, если объект будет использоваться через границы процесса. Если имя совпадает с существующим событием, конструктор создает новый `CEvent` объект, который ссылается на событие этого имени. Если имя совпадает с существующим объектом синхронизации, который не является событием, построение завершится ошибкой. Если значение равно NULL, то имя будет иметь значение null.

*лпсааттрибуте*<br/>
Атрибуты безопасности для объекта события. Полное описание этой структуры см. в разделе [SECURITY_ATTRIBUTES](/previous-versions/windows/desktop/legacy/aa379560\(v=vs.85\)) в Windows SDK.

### <a name="remarks"></a>Примечания

Чтобы получить `CEvent` доступ к объекту или освободить его, создайте объект [кмултилокк](../../mfc/reference/cmultilock-class.md) или [ксинглелокк](../../mfc/reference/csinglelock-class.md) и вызовите его функции-члены [Lock](../../mfc/reference/csinglelock-class.md#lock) и [Unlock](../../mfc/reference/csinglelock-class.md#unlock) .

Чтобы изменить состояние `CEvent` объекта на "сигнальное" (потоки не должны ждать), вызовите [выполнить SetEvent](#setevent) или [PulseEvent](#pulseevent). Чтобы задать несигнальное состояние `CEvent` объекта (потоки должны ожидать), вызовите [ресетевент](#resetevent).

> [!IMPORTANT]
>  После создания `CEvent` объекта используйте [GetLastError](/windows/win32/api/errhandlingapi/nf-errhandlingapi-getlasterror) , чтобы убедиться, что мьютекс еще не существовал. Если мьютекс был неожиданно существовал, это может указывать на то, что случайный процесс занят и может полагаться на использование мьютекса злонамеренно. В этом случае рекомендуемой процедурой безопасности является закрытие обработчика и продолжение работы так, как если бы при создании объекта произошел сбой.

##  <a name="pulseevent"></a>Цевент::P Улсивент

Устанавливает состояние события в сигнальное (доступное), освобождает все ожидающие потоки и сбрасывает его в несигнальное (недоступное) автоматически.

```
BOOL PulseEvent();
```

### <a name="return-value"></a>Возвращаемое значение

Ненулевое значение, если функция выполнена успешно; в противном случае — 0.

### <a name="remarks"></a>Примечания

Если событие выполняется вручную, освобождаются все ожидающие потоки, для события устанавливается значение несигнальное и `PulseEvent` возвращается. Если событие является автоматическим, освобождается один поток, для события устанавливается значение несигнальное и `PulseEvent` возвращается.

Если потоки не ожидают выполнения или потоки не могут быть освобождены немедленно, `PulseEvent` устанавливает для события состояние несигнальное и возвращает.

`PulseEvent`использует базовую функцию `PulseEvent` Win32, которая может быть мгновенно удалена из состояния ожидания при асинхронном вызове процедуры в режиме ядра. `PulseEvent` Поэтому является ненадежным и не может использоваться новыми приложениями. Дополнительные сведения см. в описании [функции PulseEvent](/windows/win32/api/winbase/nf-winbase-pulseevent).

##  <a name="resetevent"></a>Цевент:: Ресетевент

Задает несигнальное состояние события до тех пор, пока явно не будет задано сигнальное значение функцией члена [выполнить SetEvent](#setevent) .

```
BOOL ResetEvent();
```

### <a name="return-value"></a>Возвращаемое значение

Ненулевое значение, если функция выполнена успешно; в противном случае — 0.

### <a name="remarks"></a>Примечания

Это приводит к тому, что все потоки, желающие получить доступ к этому событию, ожидают.

Эта функция-член не используется автоматическими событиями.

##  <a name="setevent"></a>Цевент:: выполнить SetEvent

Задает сигнальное состояние события, освобождая все ожидающие потоки.

```
BOOL SetEvent();
```

### <a name="return-value"></a>Возвращаемое значение

Ненулевое значение, если функция выполнена успешно; в противном случае — 0.

### <a name="remarks"></a>Примечания

Если событие выполняется вручную, событие остается сигнальным до тех пор, пока не будет вызван [ресетевент](#resetevent) . В этом случае можно освободить более одного потока. Если событие выполняется автоматически, событие остается сигнальным до тех пор, пока не будет освобожден один поток. Затем система настроит состояние события на несигнальное. Если потоки не ожидают, состояние остается сигнальным до освобождения одного потока.

##  <a name="unlock"></a>Цевент:: Unlock

Освобождает объект события.

```
BOOL Unlock();
```

### <a name="return-value"></a>Возвращаемое значение

Ненулевое значение, если поток владеет объектом события, а событие является автоматическим событием; в противном случае — 0.

### <a name="remarks"></a>Примечания

Эта функция-член вызывается потоками, которые в настоящее время владеют автоматическим событием, чтобы освободить его после выполнения, если объект блокировки следует использовать повторно. Если объект блокировки не используется повторно, эта функция будет вызываться деструктором объекта блокировки.

## <a name="see-also"></a>См. также

[Класс CSyncObject](../../mfc/reference/csyncobject-class.md)<br/>
[Диаграмма иерархии](../../mfc/hierarchy-chart.md)
