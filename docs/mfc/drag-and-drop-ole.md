---
title: перетаскивание OLE
description: Общие сведения о перетаскивании OLE в Microsoft Foundation Classes (MFC), способах реализации источника перетаскивания, цели перетаскивания и настройке перетаскивания.
ms.date: 02/09/2020
helpviewer_keywords:
- OLE server applications [MFC], drag and drop
- drag and drop [MFC]
- OLE applications [MFC], drag and drop
- File Manager drag and drop support [MFC]
- drag and drop [MFC], about OLE drag and drop
- OLE drag and drop [MFC]
ms.assetid: a4595350-ca06-4400-88a1-f0175c76b77b
ms.openlocfilehash: c601e8f0324510346513dc8da48dd1a83c95bceb
ms.sourcegitcommit: 3e8fa01f323bc5043a48a0c18b855d38af3648d4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78855513"
---
# <a name="ole-drag-and-drop"></a>перетаскивание OLE

Функция перетаскивания OLE в основном является ярлыком для копирования и удаления данных. При использовании буфера обмена для копирования или вставки данных необходимо выполнить ряд действий. Выберите данные и в меню **Правка** выберите **Вырезать** или **Копировать** . Затем вы перейдете в целевое приложение или окно и поместите курсор в целевое расположение. Наконец, выберите в меню пункт **изменить** > **Вставить** .

Функция перетаскивания объектов OLE отличается от механизма перетаскивания с помощью диспетчера файлов. Диспетчер файлов может обрабатывать только имена файлов и предназначен специально для передачи имен файлов в приложения. Перетаскивание в OLE является гораздо более общим. Он позволяет перетаскивать любые данные, которые также могут быть помещены в буфер обмена.

При использовании перетаскивания OLE из процесса удаляются два шага. Выберите данные из окна исходного кода ("удалить источник"), а затем перетащите их в место назначения ("цель перетаскивания"). Его можно удалить, отпустив кнопку мыши. Операция исключает необходимость в меню и быстрее, чем последовательность копирования и вставки. Существует только одно требование: и источник удаления, и цель удаления должны быть открытыми, по крайней мере, частично видимыми на экране.

С помощью перетаскивания OLE можно легко перемещать данные из одного расположения в другое: в документе, между различными документами или между приложениями. Она может быть реализована либо в контейнере, либо в серверном приложении. Любое приложение может быть источником сброса, целью перетаскивания или обоими. Если приложение реализует поддержку Drop-источника и конечного объекта, можно перетаскивать между дочерними окнами или в одном окне. Эта функция значительно упрощает работу с приложением.

В статьях, посвященных [объектам данных и источникам данных (OLE)](../mfc/data-objects-and-data-sources-ole.md) , объясняется, как реализовать перенос данных в приложениях. Также полезно изучить примеры MFC OLE [OCLIENT](../overview/visual-cpp-samples.md) и [HIERSVR](../overview/visual-cpp-samples.md).

## <a name="implement-a-drop-source"></a>Реализация источника перетаскивания

Чтобы заставить приложение предоставлять данные для операции перетаскивания, необходимо реализовать источник перетаскивания. Базовая реализация источника перетаскивания относительно проста. Первым шагом является определение того, какие события начинают операцию перетаскивания. Рекомендуемые рекомендации по пользовательскому интерфейсу определяют начало операции перетаскивания, как при возникновении события **WM_LBUTTONDOWN** в точке внутри некоторых выбранных данных. В примерах MFC OLE [OCLIENT](../overview/visual-cpp-samples.md) и [HIERSVR](../overview/visual-cpp-samples.md) следуйте этим рекомендациям.

Если приложение является контейнером, а выбранные данные являются связанными или внедренным объектом типа `COleClientItem`, вызовите его `DoDragDrop` функцию-член. В противном случае создайте объект `COleDataSource`, инициализируйте его с помощью выбора и вызовите функцию-член `DoDragDrop` объекта источника данных. Если приложение является сервером, используйте `COleServerItem::DoDragDrop`. Сведения о настройке стандартного поведения при перетаскивании см. в разделе [Настройка перетаскивания](#customize-drag-and-drop).

Если `DoDragDrop` возвращает **DROPEFFECT_MOVE**, немедленно удалите исходные данные из исходного документа. Никакие другие возвращаемые значения от `DoDragDrop` не влияют на источник удаления.

Дополнительные сведения см. в разделе [OLE Data Objects and Data Sources: создание и уничтожение](../mfc/data-objects-and-data-sources-creation-and-destruction.md) и [объекты данных OLE и источники данных: манипуляции](../mfc/data-objects-and-data-sources-manipulation.md)\.

## <a name="implement-a-drop-target"></a>Реализация целевого объекта перетаскивания

Для реализации цели перетаскивания, отличной от источника перетаскивания, требуется немного больше работы, но она по-прежнему сравнительно проста.

### <a name="to-implement-an-ole-drop-target"></a>Реализация целевого объекта OLE Drop

1. Если это еще не сделано, добавьте вызов `AfxOleInit` в функцию-член `InitInstance` приложения. Этот вызов необходим для инициализации библиотек OLE.

1. Добавьте переменную-член в каждое представление в приложении, которое должно быть целью перетаскивания. Эта переменная-член должна иметь тип `COleDropTarget` или производный от него класс.

1. Из функции класса представления, обрабатывающей сообщение **WM_CREATE** (обычно `OnCreate`), вызовите новую функцию-член `Register` переменной-члена. `Revoke` будет автоматически вызываться при удалении представления.

1. Переопределите следующие функции. Если требуется такое же поведение в приложении, переопределите эти функции в классе представления. Если вы хотите изменить поведение в изолированных случаях или хотите включить удаление в не`CView`ных окнах, переопределите эти функции в классе, производном от `COleDropTarget`.

   | Переопределение | Чтобы разрешить |
   | -------- | -------- |
   | `OnDragEnter` | Операции удаления, выполняемые в окне. Вызывается, когда курсор впервые попадает в окно. |
   | `OnDragLeave` | Особое поведение, когда операция перетаскивания покидает указанное окно. |
   | `OnDragOver` | Операции удаления, выполняемые в окне. Вызывается при перетаскивании курсора по окну. |
   | `OnDrop` | Обработка данных, помещаемых в указанное окно. |
   | `OnScrollBy` | Особое поведение при необходимости прокрутки в целевом окне. |

См. МАИНВИЕВ. CPP-файл, который является частью примера [OCLIENT](../overview/visual-cpp-samples.md) MFC OLE, для примера того, как эти функции работают вместе.

Дополнительные сведения см. в разделе [OLE Data Objects and Data Sources: создание и уничтожение](../mfc/data-objects-and-data-sources-creation-and-destruction.md) и [объекты данных OLE и источники данных: манипуляции](../mfc/data-objects-and-data-sources-manipulation.md)\.

## <a name="customize-drag-and-drop"></a>Настройка перетаскивания

Реализация функции перетаскивания по умолчанию достаточна для большинства приложений. Однако некоторые приложения могут потребовать изменения этого стандартного поведения. В этом разделе объясняются шаги, необходимые для изменения этих значений по умолчанию. Эту методику можно использовать для создания приложений, которые не поддерживают составные документы, в источники перетаскивания.

Если вы настраиваете стандартное поведение OLE-перетаскивания или используете приложение, отличное от OLE, необходимо создать объект `COleDataSource` для хранения данных. Когда пользователь запускает операцию перетаскивания, код должен вызвать функцию `DoDragDrop` из этого объекта, а не из других классов, поддерживающих операции перетаскивания.

При необходимости можно создать объект `COleDropSource` для управления удалением и переопределения некоторых его функций в зависимости от типа поведения, которое необходимо изменить. Затем этот объект Drop-Source передается в `COleDataSource::DoDragDrop` для изменения поведения этих функций по умолчанию. Эти различные параметры обеспечивают большую гибкость в способе поддержки операций перетаскивания в приложении. Дополнительные сведения об источниках данных см. в статьях [объекты данных и источники данных (OLE)](../mfc/data-objects-and-data-sources-ole.md).

Для настройки операций перетаскивания можно переопределить следующие функции:

| Переопределение | Настройка |
| -------- | ------------ |
| `OnBeginDrag` | Как начинается операция перетаскивания после вызова `DoDragDrop`. |
| `GiveFeedback` | Визуальная обратная связь, например внешний вид курсора, для различных результатов перетаскивания. |
| `QueryContinueDrag` | Завершение операции перетаскивания. Эта функция позволяет проверять состояние ключей модификатора во время операции перетаскивания. |

## <a name="see-also"></a>См. также:

\ [OLE](../mfc/ole-in-mfc.md)
[Объекты данных OLE и источники данных](../mfc/data-objects-and-data-sources-ole.md)\
[Объекты данных OLE и источники данных:\ создания и уничтожения](../mfc/data-objects-and-data-sources-creation-and-destruction.md)
[Объекты данных OLE и источники данных:\ манипуляций](../mfc/data-objects-and-data-sources-manipulation.md)
[COleClientItem::D одрагдроп](../mfc/reference/coleclientitem-class.md#dodragdrop)\
\ [класса COleDataSource](../mfc/reference/coledatasource-class.md)
[COleDataSource::D одрагдроп](../mfc/reference/coledatasource-class.md#dodragdrop)\
\ [класса коледропсаурце](../mfc/reference/coledropsource-class.md)
\ [класса коледроптаржет](../mfc/reference/coledroptarget-class.md)
[CView:: OnDragLeave](../mfc/reference/cview-class.md#ondragleave)
