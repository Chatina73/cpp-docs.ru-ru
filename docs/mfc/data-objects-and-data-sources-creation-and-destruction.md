---
title: Объекты и источники данных. Создание и деструкция
ms.date: 11/04/2016
helpviewer_keywords:
- destroying data objects [MFC]
- object creation [MFC], data source objects
- data sources [MFC], and data objects
- data source objects [MFC], creating
- destruction [MFC], data sources
- data source objects [MFC], destroying
- data objects [MFC], creating
- data objects [MFC], destroying
- data sources [MFC], role
- data sources [MFC], destroying
- destruction [MFC], data objects
- data sources [MFC], creating
ms.assetid: ac216d54-3ca5-4ce7-850d-cd1f6a90d4f1
ms.openlocfilehash: c5bbc2b3e19278a397e13c9b936d2434570c581c
ms.sourcegitcommit: a8ef52ff4a4944a1a257bdaba1a3331607fb8d0f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/11/2020
ms.locfileid: "77127426"
---
# <a name="data-objects-and-data-sources-creation-and-destruction"></a>Объекты и источники данных. Создание и деструкция

Как описано в статьях [объекты данных и источники данных (OLE)](../mfc/data-objects-and-data-sources-ole.md), объекты данных и источники данных представляют обе стороны обмена данными. В этой статье объясняется, когда нужно создавать и удалять эти объекты и источники для правильной передачи данных. В том числе описываются следующие операции:

- [Создание объектов данных](#_core_creating_data_objects)

- [Уничтожение объектов данных](#_core_destroying_data_objects)

- [Создание источников данных](#_core_creating_data_sources)

- [Уничтожение источников данных](#_core_destroying_data_sources)

##  <a name="_core_creating_data_objects"></a>Создание объектов данных

Объекты данных используются конечным приложением: клиентом или сервером. Объект данных в конечном приложении — это один конец соединения между исходным и конечным приложениями. Объект данных в конечном приложении используется для доступа к данным источника данных и взаимодействия с ними.

Существует две стандартные ситуации, когда требуется объект данных. Первая ситуация: данные сбрасываются в приложение с помощью перетаскивания. Вторая ситуация: выбор команды "Вставка" или "Специальная вставка" в меню "Правка".

В первой ситуации необходимо создать объект данных. Указатель на существующий объект данных будет передан функции `OnDrop`. Этот объект данных создается платформой как часть операции перетаскивания и также будут уничтожен платформой. Это не всегда так при вставке другим способом. Дополнительные сведения см. в разделе [уничтожение объектов данных](#_core_destroying_data_objects).

Если приложение выполняет вставку или специальную вставку, вам необходимо создать объект `COleDataObject` и вызвать его функцию-член `AttachClipboard`. При этом объект данных связывается с данными в буфере обмена. Затем можно использовать этот объект данных в функции вставки.

##  <a name="_core_destroying_data_objects"></a>Уничтожение объектов данных

Если следовать схеме, описанной в разделе [Создание объектов данных](#_core_creating_data_objects), то уничтожение объектов данных является тривиальным аспектом передачи данных. Объект данных, который был создан в функции вставки, будет уничтожен MFC при возврате из функции вставки.

Если использовать другой способ обработки операций вставки, необходимо убедиться, что объект данных уничтожается после завершения вставки. До уничтожения объекта данных никакое приложение не сможет успешно скопировать данные в буфер обмена.

##  <a name="_core_creating_data_sources"></a>Создание источников данных

Источники данных используются источником передачи данных, которым может быть клиент или сервер. Источник данных в исходном приложении — это один конец соединения между исходным и конечным приложениями. Объект данных в конечном приложении используется для взаимодействия с данными источника данных.

Источники данных создаются, когда приложению требуется скопировать данные в буфер обмена. Типичный сценарий выполняется следующим образом.

1. Пользователь выбирает некоторые данные.

1. Пользователь выбирает команду **Копировать** (или **вырезание**) в меню **Правка** или начинает операцию перетаскивания.

1. В зависимости от структуры программы приложение создает объект `COleDataSource` или объект класса, производного от `COleDataSource`.

1. Выбранные данные вставляются в источник данных путем вызова одной из функций в группе `COleDataSource::CacheData` или `COleDataSource::DelayRenderData`.

1. Приложение вызывает функцию-член `SetClipboard` (или `DoDragDrop`, если это операция перетаскивания) объекта, созданного на шаге 3.

1. Если это операция **вырезания** или `DoDragDrop` возвращает **DROPEFFECT_MOVE**, данные, выбранные на шаге 1, удаляются из документа.

Этот сценарий реализуется с помощью примеров MFC OLE [OCLIENT](../overview/visual-cpp-samples.md) и [HIERSVR](../overview/visual-cpp-samples.md). Посмотрите на источник производного от `CView` класса каждого приложения для всех функций, за исключением `GetClipboardData` и `OnGetClipboardData`. Эти две функции находятся в реализации производных от `COleClientItem` или `COleServerItem` классов. Эти примеры служат хорошим примером реализации этих концепций.

Еще одна ситуация, в которой может потребоваться создать объект `COleDataSource`, возникает при изменении поведения операции перетаскивания по умолчанию. Дополнительные сведения см. в статье перетаскивание [OLE: Настройка](../mfc/drag-and-drop-ole.md#customize-drag-and-drop) перетаскивания.

##  <a name="_core_destroying_data_sources"></a>Уничтожение источников данных

Источники данных должно уничтожить приложение, которое в данный момент отвечает за них. В ситуациях, когда источник данных передаются в OLE, например вызов [COleDataSource::D одрагдроп](../mfc/reference/coledatasource-class.md#dodragdrop), необходимо вызвать `pDataSrc->InternalRelease`. Пример:

[!code-cpp[NVC_MFCListView#1](../atl/reference/codesnippet/cpp/data-objects-and-data-sources-creation-and-destruction_1.cpp)]

Если вы не передали источник данных OLE, то вы отвечаете за его уничтожение, как для любого типичного объекта C++.

Дополнительные сведения см. в разделе [перетаскивание](../mfc/drag-and-drop-ole.md), [буфер обмена](../mfc/clipboard.md)и [Управление объектами данных и источниками данных](../mfc/data-objects-and-data-sources-manipulation.md).

## <a name="see-also"></a>См. также раздел

[Объекты и источники данных (OLE)](../mfc/data-objects-and-data-sources-ole.md)<br/>
[Класс COleDataObject](../mfc/reference/coledataobject-class.md)<br/>
[Класс COleDataSource](../mfc/reference/coledatasource-class.md)
