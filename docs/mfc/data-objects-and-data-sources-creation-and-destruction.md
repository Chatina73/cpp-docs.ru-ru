---
title: Объекты и источники данных. Создание и деструкция
ms.date: 11/04/2016
helpviewer_keywords:
- destroying data objects [MFC]
- object creation [MFC], data source objects
- data sources [MFC], and data objects
- data source objects [MFC], creating
- destruction [MFC], data sources
- data source objects [MFC], destroying
- data objects [MFC], creating
- data objects [MFC], destroying
- data sources [MFC], role
- data sources [MFC], destroying
- destruction [MFC], data objects
- data sources [MFC], creating
ms.assetid: ac216d54-3ca5-4ce7-850d-cd1f6a90d4f1
ms.openlocfilehash: 58b68ca9597fd2a03cffb2bbab327dbc72d09599
ms.sourcegitcommit: c123cc76bb2b6c5cde6f4c425ece420ac733bf70
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81371217"
---
# <a name="data-objects-and-data-sources-creation-and-destruction"></a>Объекты и источники данных. Создание и деструкция

Как поясняется в статье [Data Objects and Data Sources (OLE),](../mfc/data-objects-and-data-sources-ole.md)объекты данных и источники данных представляют обе стороны передачи данных. В этой статье объясняется, когда нужно создавать и удалять эти объекты и источники для правильной передачи данных. В том числе описываются следующие операции:

- [Создание объектов данных](#_core_creating_data_objects)

- [уничтожение объектов данных;](#_core_destroying_data_objects)

- [Создание источников данных](#_core_creating_data_sources)

- [уничтожение источников данных.](#_core_destroying_data_sources)

## <a name="creating-data-objects"></a><a name="_core_creating_data_objects"></a>Создание объектов данных

Объекты данных используются конечным приложением: клиентом или сервером. Объект данных в конечном приложении — это один конец соединения между исходным и конечным приложениями. Объект данных в конечном приложении используется для доступа к данным источника данных и взаимодействия с ними.

Существует две стандартные ситуации, когда требуется объект данных. Первая ситуация: данные сбрасываются в приложение с помощью перетаскивания. Вторая ситуация: выбор команды "Вставка" или "Специальная вставка" в меню "Правка".

В первой ситуации необходимо создать объект данных. Указатель на существующий объект данных будет передан функции `OnDrop`. Этот объект данных создается платформой как часть операции перетаскивания и также будут уничтожен платформой. Это не всегда так при вставке другим способом. Для получения дополнительной информации [см.](#_core_destroying_data_objects)

Если приложение выполняет вставку или специальную вставку, вам необходимо создать объект `COleDataObject` и вызвать его функцию-член `AttachClipboard`. При этом объект данных связывается с данными в буфере обмена. Затем можно использовать этот объект данных в функции вставки.

## <a name="destroying-data-objects"></a><a name="_core_destroying_data_objects"></a>Уничтожение объектов данных

Если вы следуете схеме, описанной в [создании объектов данных,](#_core_creating_data_objects)уничтожение объектов данных является тривиальным аспектом передачи данных. Объект данных, который был создан в функции вставки, будет уничтожен MFC при возврате из функции вставки.

Если использовать другой способ обработки операций вставки, необходимо убедиться, что объект данных уничтожается после завершения вставки. До уничтожения объекта данных никакое приложение не сможет успешно скопировать данные в буфер обмена.

## <a name="creating-data-sources"></a><a name="_core_creating_data_sources"></a>Создание источников данных

Источники данных используются источником передачи данных, которым может быть клиент или сервер. Источник данных в исходном приложении — это один конец соединения между исходным и конечным приложениями. Объект данных в конечном приложении используется для взаимодействия с данными источника данных.

Источники данных создаются, когда приложению требуется скопировать данные в буфер обмена. Типичный сценарий выполняется следующим образом.

1. Пользователь выбирает некоторые данные.

1. Пользователь выбирает **Copy** (или **Cut)** из меню **Edit** или начинает операцию перетаскивания.

1. В зависимости от структуры программы приложение создает объект `COleDataSource` или объект класса, производного от `COleDataSource`.

1. Выбранные данные вставляются в источник данных путем вызова одной из функций в группе `COleDataSource::CacheData` или `COleDataSource::DelayRenderData`.

1. Приложение вызывает функцию-член `SetClipboard` (или `DoDragDrop`, если это операция перетаскивания) объекта, созданного на шаге 3.

1. Если это **Cut** операция Cut `DoDragDrop` или возвращает **DROPEFFECT_MOVE,** данные, выбранные в шаге 1, удаляются из документа.

Этот сценарий реализуется MFC OLE образцов [OCLIENT](../overview/visual-cpp-samples.md) и [HIERSVR](../overview/visual-cpp-samples.md). Посмотрите на источник производного от `CView` класса каждого приложения для всех функций, за исключением `GetClipboardData` и `OnGetClipboardData`. Эти две функции находятся в реализации производных от `COleClientItem` или `COleServerItem` классов. Эти примеры служат хорошим примером реализации этих концепций.

Еще одна ситуация, в которой может потребоваться создать объект `COleDataSource`, возникает при изменении поведения операции перетаскивания по умолчанию. Для получения дополнительной информации, см [OLE Перетащите и падение: Настроить перетащить и падение](../mfc/drag-and-drop-ole.md#customize-drag-and-drop) статьи.

## <a name="destroying-data-sources"></a><a name="_core_destroying_data_sources"></a>Уничтожение источников данных

Источники данных должно уничтожить приложение, которое в данный момент отвечает за них. В ситуациях, когда вы передаете источник данных OLE, например, звоните `pDataSrc->InternalRelease` [В. ColeDataSource::DoDragDrop,](../mfc/reference/coledatasource-class.md#dodragdrop)вам необходимо позвонить в систему. Пример:

[!code-cpp[NVC_MFCListView#1](../atl/reference/codesnippet/cpp/data-objects-and-data-sources-creation-and-destruction_1.cpp)]

Если вы не передали источник данных OLE, то вы отвечаете за его уничтожение, как для любого типичного объекта C++.

Для получения дополнительной информации [см. Перетащите и падение](../mfc/drag-and-drop-ole.md), [Клипборд](../mfc/clipboard.md), и [манипулирование объектами данных и источниками данных](../mfc/data-objects-and-data-sources-manipulation.md).

## <a name="see-also"></a>См. также раздел

[Объекты и источники данных (OLE)](../mfc/data-objects-and-data-sources-ole.md)<br/>
[Класс COleDataObject](../mfc/reference/coledataobject-class.md)<br/>
[Класс COleDataSource](../mfc/reference/coledatasource-class.md)
