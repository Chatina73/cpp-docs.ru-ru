---
title: Точки подключения
ms.date: 11/19/2018
f1_keywords:
- IConnectionPoint
helpviewer_keywords:
- IConnectionPoint interface
- connections, connection points
- OLE COM connection points
- MFC COM, connection points
- COM, connection points
- interfaces, IConnectionPoint
- MFC, COM support
- connection points [MFC]
- CCmdTarget class [MFC], and connection points
- sinks, connection points
ms.assetid: bc9fd7c7-8df6-4752-ac8c-0b177442c88d
ms.openlocfilehash: 1a8fc4742b8bf686edf75f3b98cc283b9bf9881b
ms.sourcegitcommit: c21b05042debc97d14875e019ee9d698691ffc0b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/09/2020
ms.locfileid: "84620732"
---
# <a name="connection-points"></a>Точки подключения

В этой статье объясняется, как реализовать точки соединения (ранее известные как точки подключения OLE) с помощью классов MFC `CCmdTarget` и `CConnectionPoint` .

В прошлом компонент модели COM определил общий механизм ( `IUnknown::QueryInterface` *), который позволял объектам реализовывать и предоставлять функциональные возможности в интерфейсах. Тем не менее, соответствующий механизм, который позволяли объектам предоставлять возможность вызова определенных интерфейсов, не определен. Это значит, что модель COM определила способ обработки входящих указателей на объекты (указатели на интерфейсы этого объекта), но не имеет явной модели для исходящих интерфейсов (указатели на объект, который содержится в интерфейсах других объектов). COM теперь имеет модель, называемую точками соединения, которая поддерживает эту функцию.

Соединение состоит из двух частей: объекта, вызывающего интерфейс, который называется источником, и объекта, реализующего интерфейс, который называется приемником. Точка соединения — это интерфейс, предоставляемый источником. Предоставляя точку подключения, источник позволяет приемникам устанавливать соединения с самим собой (источником). Через механизм точки подключения ( `IConnectionPoint` интерфейс) указатель на интерфейс приемника передается в исходный объект. Этот указатель предоставляет источнику доступ к реализации набора функций-членов приемника. Например, чтобы запустить событие, реализованное приемником, источник может вызвать соответствующий метод реализации приемника. На следующем рисунке показана только что описанная точка подключения.

![Реализованная точка подключения](../mfc/media/vc37lh1.gif "Реализованная точка подключения") <br/>
Реализованная точка подключения

MFC реализует эту модель в классах [кконнектионпоинт](reference/cconnectionpoint-class.md) и [от CCmdTarget](reference/ccmdtarget-class.md) . Классы, производные от `CConnectionPoint` , реализуют `IConnectionPoint` интерфейс, который используется для предоставления точек соединения другим объектам. Классы, производные от `CCmdTarget` , реализуют `IConnectionPointContainer` интерфейс, который позволяет перечислить все доступные точки соединения объекта или найти конкретную точку подключения.

Для каждой точки подключения, реализованной в классе, необходимо объявить часть соединения, которая реализует точку подключения. При реализации одной или нескольких точек подключения необходимо также объявить одну карту подключения в классе. Схема соединения — это таблица точек соединения, поддерживаемых элементом управления ActiveX.

В следующих примерах демонстрируется простая схема соединения и одна точка подключения. В первом примере объявляется схема соединения и точка; во втором примере реализуется Map и Point. Обратите внимание, что `CMyClass` должен быть `CCmdTarget` производным классом. В первом примере код вставляется в объявление класса в разделе **protected** :

[!code-cpp[NVC_MFCConnectionPoints#1](codesnippet/cpp/connection-points_1.h)]

Макросы **BEGIN_CONNECTION_PART** и **END_CONNECTION_PART** объявляют внедренный класс `XSampleConnPt` (производный от `CConnectionPoint` ), который реализует эту конкретную точку подключения. Если вы хотите переопределить любые `CConnectionPoint` функции члена или добавить собственные функции, объявите их между этими двумя макросами. Например, `CONNECTION_IID` макрос переопределяет `CConnectionPoint::GetIID` функцию члена при помещении между этими двумя макросами.

Во втором примере код вставляется в файл реализации элемента управления (CPP-файл). Этот код реализует карту соединения, которая включает точку подключения `SampleConnPt` :

[!code-cpp[NVC_MFCConnectionPoints#2](codesnippet/cpp/connection-points_2.cpp)]

Если в классе имеется несколько точек подключения, вставьте дополнительные **CONNECTION_PART** макросы между **BEGIN_CONNECTION_MAP** и **END_CONNECTION_MAP** макросами.

Наконец, добавьте вызов `EnableConnections` в конструктор класса. Пример.

[!code-cpp[NVC_MFCConnectionPoints#3](codesnippet/cpp/connection-points_3.cpp)]

После вставки этого кода `CCmdTarget` класс, производный от, предоставляет точку подключения для `ISampleSink` интерфейса. Этот пример показан на следующем рисунке.

![Точка подключения, реализованная с помощью MFC](../mfc/media/vc37lh2.gif "Точка подключения, реализованная с помощью MFC") <br/>
Точка соединения, реализованная с помощью MFC

Обычно точки подключения поддерживают "многоадресную рассылку" — возможность вещания в несколько приемников, подключенных к одному интерфейсу. В следующем примере фрагмент демонстрируется многоадресная рассылка путем прохода по каждому приемнику в точке подключения:

[!code-cpp[NVC_MFCConnectionPoints#4](codesnippet/cpp/connection-points_4.cpp)]

В этом примере извлекается текущий набор соединений в `SampleConnPt` точке соединения с вызовом `CConnectionPoint::GetConnections` . Затем он проходит через соединения и вызывает `ISampleSink::SinkFunc` для каждого активного соединения.

## <a name="see-also"></a>См. также раздел

[MFC COM](mfc-com.md)
