---
title: Точки подключения
ms.date: 11/19/2018
f1_keywords:
- IConnectionPoint
helpviewer_keywords:
- IConnectionPoint interface
- connections, connection points
- OLE COM connection points
- MFC COM, connection points
- COM, connection points
- interfaces, IConnectionPoint
- MFC, COM support
- connection points [MFC]
- CCmdTarget class [MFC], and connection points
- sinks, connection points
ms.assetid: bc9fd7c7-8df6-4752-ac8c-0b177442c88d
ms.openlocfilehash: 6f934c4a5a24c5d54805a60e81cb0afdcdc2c14a
ms.sourcegitcommit: 0ab61bc3d2b6cfbd52a16c6ab2b97a8ea1864f12
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "62153324"
---
# <a name="connection-points"></a>Точки подключения

В этой статье приведены сведения о реализации точек подключения (прежнее название OLE точки подключения) с использованием классов MFC `CCmdTarget` и `CConnectionPoint`.

В прошлом, компонент модели объектов (COM) определен общий механизм (`IUnknown::QueryInterface`*), допускающая объекты для реализации и предоставления функциональных возможностей в интерфейсах. Тем не менее соответствующий механизм, который разрешен объектов для предоставления их возможности для вызова специальных интерфейсов не был определен. То есть COM определенные входящих указатели на объекты обрабатывались (указатели на интерфейсы этого объекта), но он не имеет модель явного для исходящих интерфейсов (указатели, объект содержит к интерфейсам других объектов). COM теперь имеется модель, называется точки подключения, поддерживает данную функцию.

Подключение состоит из двух частей: объекте, вызывающем интерфейса, который называется источник и объект, реализующий интерфейс, вызывающий приемник. Точка подключения — интерфейса, предоставляемого данным источника. Предоставляя точку подключения, источник позволяет приемники для установления соединений на себя (источник). Через подключение точки механизм ( `IConnectionPoint` интерфейс), указатель на интерфейс приемника передается объекту источника. Этот указатель представляет собой источник с доступом к реализацию приемника набора функций-членов. Например срабатывание события, реализованного в приемник, источник можно вызвать соответствующий метод реализацию приемника. На следующем рисунке показано подключение точка описанных выше.

![Реализовать точку подключения](../mfc/media/vc37lh1.gif "реализации точки подключения") <br/>
Реализованная точка подключения

Реализация этой модели в MFC [CConnectionPoint](../mfc/reference/cconnectionpoint-class.md) и [CCmdTarget](../mfc/reference/ccmdtarget-class.md) классы. Классы, производные от `CConnectionPoint` реализовать `IConnectionPoint` интерфейс, используемый для предоставления точек подключения к другим объектам. Классы, производные от `CCmdTarget` реализовать `IConnectionPointContainer` интерфейс, который можно перечислить все точек подключения, доступных для объекта или найти конкретную точку подключения.

Для каждой точки подключения, реализован в вашем классе необходимо объявить часть подключения, которая реализует точку подключения. Если вы реализуете одну или несколько точек подключения, карту одного соединения также необходимо объявить в классе. Сопоставление подключения — это таблица точек подключения, поддерживаемое элементом управления ActiveX.

В следующих примерах показано сопоставление простого подключения и одной точке подключения. Первый пример объявляет сопоставление подключения и точку. Во втором примере реализует карты и точки. Обратите внимание, что `CMyClass` должно быть `CCmdTarget`-производного класса. В первом примере, код вставляется в объявлении класса, в разделе **защищенные** раздел:

[!code-cpp[NVC_MFCConnectionPoints#1](../mfc/codesnippet/cpp/connection-points_1.h)]

**BEGIN_CONNECTION_PART** и **END_CONNECTION_PART** макросы объявить класс embedded `XSampleConnPt` (производный от `CConnectionPoint`), что указывают реализует этого конкретного подключения. Если вы хотите переопределить любой `CConnectionPoint` функции-члены или добавить собственные функции-члены, можно объявить их между этими двумя макросами. Например `CONNECTION_IID` переопределяет макрос `CConnectionPoint::GetIID` функция-член при помещении, между этими двумя макросами.

Во втором примере код вставляется в файл реализации элемента управления (CPP-файл). Этот код реализует карты подключения, которая содержит точку подключения, `SampleConnPt`:

[!code-cpp[NVC_MFCConnectionPoints#2](../mfc/codesnippet/cpp/connection-points_2.cpp)]

Если у класса имеется более одного соединения, в момент, вставлять дополнительные **CONNECTION_PART** макросы между **BEGIN_CONNECTION_MAP** и **END_CONNECTION_MAP** макросы.

Наконец, добавьте вызов `EnableConnections` в конструктор класса. Пример:

[!code-cpp[NVC_MFCConnectionPoints#3](../mfc/codesnippet/cpp/connection-points_3.cpp)]

После вставки этого кода вашей `CCmdTarget`-производном классе предоставляет точку подключения для `ISampleSink` интерфейс. На следующем рисунке показано в этом примере.

![Точка подключения, реализованная с помощью MFC](../mfc/media/vc37lh2.gif "точка подключения, реализованная с помощью MFC") <br/>
Точки подключения, реализуется с помощью MFC

Как правило, точки подключения поддерживают «многоадресная рассылка» — возможность широковещательную рассылку несколько приемников, подключенных к тот же интерфейс. В следующем примере фрагменте показано, как многоадресная рассылка, перебирая каждый приемник в точке подключения:

[!code-cpp[NVC_MFCConnectionPoints#4](../mfc/codesnippet/cpp/connection-points_4.cpp)]

В этом примере извлекает текущий набор подключений на `SampleConnPt` точки подключения с помощью вызова `CConnectionPoint::GetConnections`. Затем запрос проходит через подключения и вызовы `ISampleSink::SinkFunc` для каждого активного подключения.

## <a name="see-also"></a>См. также

[MFC COM](../mfc/mfc-com.md)
