---
title: Исключения. Высвобождение объектов в исключениях
ms.date: 11/04/2016
helpviewer_keywords:
- throwing exceptions [MFC], freeing objects in exceptions
- local exception handling
- memory leaks, caused by exception
- try-catch exception handling [MFC], destroying objects
- destroying objects [MFC]
- freeing objects [MFC]
- throwing exceptions [MFC], after destroying
- exception handling [MFC], destroying objects
ms.assetid: 3b14b4ee-e789-4ed2-b8e3-984950441d97
ms.openlocfilehash: 6e03d46a2600458f3107efa6e0b6b0d643c9b160
ms.sourcegitcommit: 6052185696adca270bc9bdbec45a626dd89cdcdd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/31/2018
ms.locfileid: "50442475"
---
# <a name="exceptions-freeing-objects-in-exceptions"></a>Исключения. Высвобождение объектов в исключениях

Эта статья объясняет необходимость и способ освобождение объектов, при возникновении исключения. Ниже приведен список разделов.

- [Обработка исключения локально](#_core_handling_the_exception_locally)

- [Создание исключений после уничтожения объектов](#_core_throwing_exceptions_after_destroying_objects)

Исключения выброшены платформой или хода программы в обычном режиме прерывания работы приложения. Таким образом очень важно отслеживать закрыть объектов таким образом, вы можете правильно их удаления в случае, если создается исключение.

Существует два основных способа это сделать.

- Обработка исключений локально с помощью **попробуйте** и **catch** ключевые слова, затем удалите все объекты с помощью одного оператора.

- Уничтожить любого объекта в **catch** блок до создания исключения за пределами блока для дальнейшей обработки.

Эти два подхода проиллюстрированы ниже как решения проблемы следующим:

[!code-cpp[NVC_MFCExceptions#14](../mfc/codesnippet/cpp/exceptions-freeing-objects-in-exceptions_1.cpp)]

Как указано выше, `myPerson` не будут удалены, если исключение вызывается `SomeFunc`. Выполнение переходит непосредственно к Далее внешнему обработчику исключений, минуя exit обычной функции и код, который удаляет объект. Указатель на объект выходит за пределы области, когда исключение покидает функцию, и память, занимаемая объектом будет невозможно до тех пор, пока программа выполняется. Это происходит утечка памяти; она будет обнаружена с помощью диагностики памяти.

##  <a name="_core_handling_the_exception_locally"></a> Обработка исключения локально

**Try/catch** парадигма обеспечивает защитных метода программирования предотвращение утечек памяти и гарантирует, что ваши объекты уничтожаются при возникновении исключения. Например показанный ранее в этой статье можно переписать следующим образом:

[!code-cpp[NVC_MFCExceptions#15](../mfc/codesnippet/cpp/exceptions-freeing-objects-in-exceptions_2.cpp)]

В этом примере устанавливает обработчик исключений, чтобы перехватить исключение и обработать его локально. Затем нормальном завершении работы функции и уничтожает объект. Важным аспектом в этом примере заключается в том, что контекст для перехвата исключения оно устанавливается с **try/catch** блоков. Без рамки локального исключение функция никогда не будет знать, что исключение было исключение и не будет иметь возможность нормально закрыть и уничтожить объект.

##  <a name="_core_throwing_exceptions_after_destroying_objects"></a> Создание исключений после уничтожения объектов

Другой способ обработки исключений является передаст их далее внешнего контекста обработки исключений. В вашей **catch** блока, можно сделать некоторые очистки локально выделенных объектов и затем вызвать исключение для дальнейшей обработки.

Функция создает исключение может или не может потребоваться освободить объекты кучи. Если функция всегда освобождает объект кучи перед возвратом в обычных условиях, то функция также должен освободить объект кучи до создания исключения. С другой стороны Если функция не освобождает обычно объекта перед возвратом в обычных условиях, затем необходимо решить, на индивидуальном-ли объект кучи, должна быть освобождена.

В следующем примере показан как локально выделенные объекты могут быть очищены:

[!code-cpp[NVC_MFCExceptions#16](../mfc/codesnippet/cpp/exceptions-freeing-objects-in-exceptions_3.cpp)]

Механизм обработки исключений, автоматически освобождает объекты кадров; объект кадра также деструктора.

При вызове функции, которые могут создавать исключения, можно использовать **try/catch** блоки, чтобы убедиться в том, что перехватывать исключения и возможность удалить все объекты, созданные. В частности Имейте в виду, что многие функции MFC могут вызывать исключения.

Дополнительные сведения см. в разделе [исключений: исключения для перехвата и удаление](../mfc/exceptions-catching-and-deleting-exceptions.md).

## <a name="see-also"></a>См. также

[Обработка исключений](../mfc/exception-handling-in-mfc.md)

