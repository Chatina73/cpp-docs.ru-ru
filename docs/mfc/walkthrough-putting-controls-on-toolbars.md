---
title: Пошаговое руководство. Размещение элементов управления на панелях инструментов
ms.date: 04/25/2019
helpviewer_keywords:
- Customize dialog box, adding controls
- toolbars [MFC], adding controls
ms.assetid: 8fc94bdf-0da7-45d9-8bc4-52b7b1edf205
ms.openlocfilehash: 0c62a8b484cb666427f873244221afec5d4719da
ms.sourcegitcommit: fcb48824f9ca24b1f8bd37d647a4d592de1cc925
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/15/2019
ms.locfileid: "69510737"
---
# <a name="walkthrough-putting-controls-on-toolbars"></a>Пошаговое руководство. Размещение элементов управления на панелях инструментов

В этой статье описывается добавление кнопки панели инструментов, содержащей элемент управления Windows, на панель инструментов. В MFC кнопка панели инструментов должна быть классом, производным от [класса CMFCToolBarButton](../mfc/reference/cmfctoolbarbutton-class.md), например [класс кмфктулбаркомбобоксбуттон](../mfc/reference/cmfctoolbarcomboboxbutton-class.md), [класс кмфктулбаредитбоксбуттон](../mfc/reference/cmfctoolbareditboxbutton-class.md), [класс кмфкдропдовнтулбарбуттон](../mfc/reference/cmfcdropdowntoolbarbutton-class.md)или [ Класс Кмфктулбарменубуттон](../mfc/reference/cmfctoolbarmenubutton-class.md).

## <a name="adding-controls-to-toolbars"></a>Добавление элементов управления на панели инструментов

Чтобы добавить элемент управления на панель инструментов, выполните следующие действия.

1. Зарезервируйте идентификатор фиктивного ресурса для кнопки на родительском ресурсе панели инструментов. Дополнительные сведения о создании кнопок с помощью **редактора панелей инструментов** в Visual Studio см. в статье [Редактор панелей инструментов](../windows/toolbar-editor.md) .

1. Зарезервируйте изображение панели инструментов (значок кнопки) для кнопки во всех точечных рисунках родительской панели инструментов.

1. В обработчике сообщений, который обрабатывает `AFX_WM_RESETTOOLBAR` сообщение, выполните следующие действия.

   1. Создайте элемент управления "Кнопка" с `CMFCToolbarButton`помощью производного класса.

   1. Замените фиктивную кнопку новым элементом управления с помощью [CMFCToolBar:: реплацебуттон](../mfc/reference/cmfctoolbar-class.md#replacebutton). Вы можете создать объект Button в стеке, поскольку `ReplaceButton` скопирует объект кнопки и сохранит копию.

> [!NOTE]
>  Если вы включили настройку в приложении, то, возможно, потребуется сбросить панель инструментов, нажав кнопку **Сброс** на вкладке **панели инструментов** диалогового окна **Настройка** , чтобы увидеть обновленный элемент управления в приложении после повторной компиляции. Состояние панели инструментов сохраняется в реестре Windows, а данные реестра загружаются и применяются после `ReplaceButton` выполнения метода во время запуска приложения.

## <a name="toolbar-controls-and-customization"></a>Элементы управления и настройка панелей инструментов

Вкладка **команды** диалогового окна **Настройка** содержит список команд, доступных в приложении. По умолчанию диалоговое окно " **Настройка** " обрабатывает меню приложения и создает список стандартных кнопок панели инструментов в каждой категории меню. Чтобы оставить расширенные функциональные возможности, предоставляемые элементами управления ToolBar, необходимо заменить стандартную кнопку панели инструментов пользовательским элементом управления в диалоговом окне **Настройка** .

При включении настройки диалоговое окно **Настройка** создается в обработчике `OnViewCustomize` настройки с помощью класса [класса кмфктулбарскустомизедиалог](../mfc/reference/cmfctoolbarscustomizedialog-class.md) . Прежде чем открыть диалоговое окно **Настройка** , вызвав метод [Кмфктулбарскустомизедиалог:: Create](../mfc/reference/cmfctoolbarscustomizedialog-class.md#create), вызовите [кмфктулбарскустомизедиалог:: реплацебуттон](../mfc/reference/cmfctoolbarscustomizedialog-class.md#replacebutton) , чтобы заменить стандартную кнопку новым элементом управления.

## <a name="example-creating-a-find-combo-box"></a>Пример Создание поля со списком "найти"

В этом разделе описывается создание элемента управления "поле со списком", отображаемого на панели инструментов и содержащего последние используемые строки поиска. Пользователь может ввести строку в элемент управления, а затем нажать клавишу ВВОД для поиска в документе или нажать клавишу Escape, чтобы вернуть фокус на основной кадр. В этом примере предполагается, что документ отображается в представлении, производном от [класса CEditView](../mfc/reference/ceditview-class.md).

### <a name="creating-the-find-control"></a>Создание элемента управления Find

Сначала создайте элемент управления поля со списком **найти** :

1. Добавьте кнопку и ее команды в ресурсы приложения:

   1. В области ресурсы приложения добавьте новую кнопку с `ID_EDIT_FIND` идентификатором команды на панель инструментов в приложении и на все растровые изображения, связанные с этой панелью инструментов.

   1. Создайте новый элемент меню с `ID_EDIT_FIND` идентификатором команды.

   1. Добавьте новую строку "найти текст\нфинд" в таблицу строк и назначьте ей `ID_EDIT_FIND_COMBO` идентификатор команды. Этот идентификатор будет использоваться в качестве идентификатора команды кнопки поля со списком **поиска** .

        > [!NOTE]
        > Поскольку `ID_EDIT_FIND` — это стандартная команда, которая `CEditView`обрабатывается, для этой команды не требуется реализовывать Специальный обработчик.  Однако необходимо реализовать обработчик для новой команды `ID_EDIT_FIND_COMBO`.

1. Создайте новый класс `CFindComboBox`, производный от [класса CComboBox](../mfc/reference/ccombobox-class.md).

1. `CFindComboBox` В классе `PreTranslateMessage` Переопределите виртуальный метод. Этот метод позволяет полю со списком обрабатывать сообщение [WM_KEYDOWN](/windows/win32/inputdev/wm-keydown) . Если пользователь нажимает клавишу Escape (`VK_ESCAPE`), переключите фокус на главное окно фрейма. Если пользователь нажимает клавишу ВВОД (`VK_ENTER`), опубликуйте в главном `WM_COMMAND` окне фрейма сообщение, содержащее `ID_EDIT_FIND_COMBO` идентификатор команды.

1. Создайте класс для кнопки поля со списком **найти** , производным от [класса кмфктулбаркомбобоксбуттон](../mfc/reference/cmfctoolbarcomboboxbutton-class.md). В этом примере используется имя `CFindComboButton`.

1. Конструктор `CMFCToolbarComboBoxButton` принимает три параметра: идентификатор команды для кнопки, индекс изображения кнопки и стиль поля со списком. Задайте следующие параметры:

   1. Передайте `ID_EDIT_FIND_COMBO` в качестве идентификатора команды.

   1. Используйте [ккоммандманажер:: жеткмдимаже](reference/internal-classes.md) с `ID_EDIT_FIND` для получения индекса образа.

   1. Список доступных стилей полей со списками см. в разделе [стили полей со списком](../mfc/reference/styles-used-by-mfc.md#combo-box-styles).

1. В классе `CFindComboButton` переопределите метод`CMFCToolbarComboBoxButton::CreateCombo`. Здесь необходимо создать `CFindComboButton` объект и вернуть указатель на него.

1. Используйте макрос [IMPLEMENT_SERIAL](../mfc/reference/run-time-object-model-services.md#implement_serial) , чтобы сделать кнопку со списком постоянными. Диспетчер рабочей области автоматически загружает и сохраняет состояние кнопки в реестре Windows.

1. Реализуйте `ID_EDIT_FIND_COMBO` обработчик в представлении документа. Используйте [CMFCToolBar::](../mfc/reference/cmfctoolbar-class.md#getcommandbuttons) с `ID_EDIT_FIND_COMBO` , чтобы получить все кнопки в поле со списком " **найти** ". В связи с настройкой может существовать несколько копий кнопки с одинаковым ИДЕНТИФИКАТОРом команды.

1. В обработчике `OnFind`сообщенийиспользуйте [CMFCToolBar:: исласткоммандфромбуттон](../mfc/reference/cmfctoolbar-class.md#islastcommandfrombutton) , чтобы определить, была ли отправлена команда find из кнопки поля со списком **найти.** `ID_EDIT_FIND` Если да, найдите текст и добавьте строку поиска в поле со списком.

### <a name="adding-the-find-control-to-the-main-toolbar"></a>Добавление элемента управления Find на главную панель инструментов

Чтобы добавить кнопку поля со списком на панель инструментов, выполните следующие действия.

1. Реализуйте обработчик `OnToolbarReset` сообщенийвглавномокнефрейма.`AFX_WM_RESETTOOLBAR`

    > [!NOTE]
    > Платформа отправляет это сообщение в главное окно фрейма при инициализации панели инструментов во время запуска приложения или при сбросе панели инструментов во время настройки. В любом случае необходимо заменить стандартную кнопку панели инструментов на кнопку настраиваемое поле со списком **найти** .

1. В обработчике изучите идентификатор панели инструментов, то есть параметр wParam сообщения AFX_WM_RESETTOOLBAR. `AFX_WM_RESETTOOLBAR` Если идентификатор панели инструментов совпадает с панелью инструментов, содержащей кнопку поля со списком, вызовите [CMFCToolBar:: реплацебуттон](../mfc/reference/cmfctoolbar-class.md#replacebutton) , чтобы заменить кнопку **поиска** (то есть кнопку с идентификатором `ID_EDIT_FIND)` команды с `CFindComboButton` объектом.

    > [!NOTE]
    > Можно создать `CFindComboBox` объект в стеке, поскольку `ReplaceButton` скопирует объект кнопки и сохранит копию.

### <a name="adding-the-find-control-to-the-customize-dialog-box"></a>Добавление элемента управления Find в диалоговое окно «Настройка»

`OnViewCustomize`В обработчике настройки вызовите [кмфктулбарскустомизедиалог:: реплацебуттон](../mfc/reference/cmfctoolbarscustomizedialog-class.md#replacebutton) , чтобы заменить кнопку **поиска** (то есть кнопку с идентификатором `ID_EDIT_FIND`команды) `CFindComboButton` на объект.

## <a name="see-also"></a>См. также

[Диаграмма иерархии](../mfc/hierarchy-chart.md)<br/>
[Классы](../mfc/reference/mfc-classes.md)<br/>
[Класс CMFCToolBar](../mfc/reference/cmfctoolbar-class.md)<br/>
[Класс CMFCToolBarButton](../mfc/reference/cmfctoolbarbutton-class.md)<br/>
[Класс CMFCToolBarComboBoxButton](../mfc/reference/cmfctoolbarcomboboxbutton-class.md)<br/>
[Класс CMFCToolBarsCustomizeDialog](../mfc/reference/cmfctoolbarscustomizedialog-class.md)
