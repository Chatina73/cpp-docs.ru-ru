---
title: TN055. Перенос приложений, использующих классы базы данных MFC ODBC, на классы MFC DAO
ms.date: 09/17/2019
helpviewer_keywords:
- DAO [MFC], migration
- TN055
- migration [MFC], ODBC database applications
- ODBC classes [MFC], DAO classes
- migrating ODBC database applications [MFC]
- porting database applications to DAO
- ODBC [MFC], DAO
- porting ODBC database applications to DAO
- migrating database applications [MFC]
ms.assetid: 0f858bd1-e168-4e2e-bcd1-8debd82856e4
ms.openlocfilehash: 744e1c71476ccfbe6ea8f8359dcdb9a29efc995e
ms.sourcegitcommit: 069e3833bd821e7d64f5c98d0ea41fc0c5d22e53
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/21/2019
ms.locfileid: "74305373"
---
# <a name="tn055-migrating-mfc-odbc-database-class-applications-to-mfc-dao-classes"></a>TN055. Перенос приложений, использующих классы базы данных MFC ODBC, на классы MFC DAO

> [!NOTE]
> DAO используется с базами данных Access и поддерживается в Office 2013. Версия DAO 3,6 является окончательной и считается устаревшей. Визуальная C++ среда и мастера не поддерживают DAO (хотя классы DAO включены и их все еще можно использовать). Корпорация Майкрософт рекомендует использовать [шаблоны OLE DB](../data/oledb/ole-db-templates.md) или [ODBC и MFC](../data/odbc/odbc-and-mfc.md) для новых проектов. DAO следует использовать только для поддержки существующих приложений.

## <a name="overview"></a>Обзор

Во многих ситуациях может быть желательно перенести приложения, использующие классы базы данных ODBC MFC, в классы базы данных MFC DAO. В этом техническом примечании будет подробно описана большая часть различий между классами MFC ODBC и DAO. Учитывая различия, при необходимости не следует чрезмерно переносить приложения из классов ODBC в классы MFC.

## <a name="why-migrate-from-odbc-to-dao"></a>Зачем выполнять миграцию из ODBC в DAO

Существует ряд причин, по которым может потребоваться перенести приложения из классов базы данных ODBC в классы базы данных DAO, но решение не обязательно просто или очевидно. Следует помнить, что ядро СУБД Microsoft Jet, используемое DAO, может считывать любой источник данных ODBC, для которого имеется драйвер ODBC. Возможно, более эффективно использовать классы базы данных ODBC или напрямую вызывать ODBC, но ядро СУБД Microsoft Jet может считывать данные ODBC.

Некоторые простые ситуации делают решение ODBC/DAO простым. Например, если требуется доступ только к данным в формате, который ядро Microsoft Jet может читать напрямую (формат доступа, формат Excel и т. д.), очевидно, что используется класс базы данных DAO.

Более сложные случаи возникают, когда данные существуют на сервере или на различных серверах. В этом случае решение об использовании классов базы данных ODBC или классов базы данных DAO сложнее. Если вы хотите выполнить такие действия, как разнородные соединения (объединение данных с серверов в нескольких форматах, например SQL Server и Oracle), то ядро СУБД Microsoft Jet выполнит присоединение, а не предложит выполнить необходимые действия при использовании базы данных ODBC. Классы или ODBC напрямую. Если используется драйвер ODBC, поддерживающий курсоры драйвера, лучшим выбором могут быть классы базы данных ODBC.

Выбор может быть сложным, поэтому может потребоваться написать пример кода для проверки производительности различных методов, учитывая ваши особые потребности. В этом техническом примечании предполагается, что вы приняли решение перейти с классов базы данных ODBC на классы базы данных DAO.

## <a name="similarities-between-odbc-database-classes-and-mfc-dao-database-classes"></a>Сходство между классами базы данных ODBC и классами базы данных DAO MFC

Первоначальная структура классов ODBC MFC основана на модели объектов DAO, которая использовалась в Microsoft Access и Microsoft Visual Basic. Это означает, что существует множество общих возможностей классов MFC и DAO, которые не будут перечислены в этом разделе. Как правило, модели программирования одинаковы.

Чтобы выделить несколько сходных моментов, сделайте следующее:

- Классы ODBC и DAO имеют объекты базы данных, которые управляются с помощью базовой системы управления базами данных (СУБД).

- Оба имеют объекты Recordset, представляющие набор результатов, возвращаемых этой СУБД.

- База данных DAO и объекты набора записей имеют почти одинаковые элементы в классах ODBC.

- При использовании обоих наборов классов код для получения данных идентичен, за исключением некоторых изменений имен объектов и членов. Изменения будут обязательными, но обычно при переключении с классов ODBC на классы DAO, как правило, происходит простое изменение имени.

Например, в обеих моделях процедура получения данных заключается в создании и открытии объекта базы данных, создании и открытии объекта набора записей, а также при навигации (перемещении), когда данные выполняют некоторую операцию.

## <a name="differences-between-odbc-and-dao-mfc-classes"></a>Различия между классами MFC ODBC и DAO

Классы DAO содержат больше объектов и более широкий набор методов, но в этом разделе будут подробно описаны различия в схожих классах и функциональных возможностях.

Вероятно, наиболее очевидными различиями между классами являются изменения имен для схожих классов и глобальных функций. В следующем списке показаны изменения имен объектов, методов и глобальных функций, связанных с классами базы данных.

|Класс или функция|Эквивалент в классах MFC DAO|
|-----------------------|-----------------------------------|
|`CDatabase`|`CDaoDatabase`|
|`CDatabase::ExecuteSQL`|`CDaoDatabase::Execute`|
|`CRecordset`|`CDaoRecordset`|
|`CRecordset::GetDefaultConnect`|`CDaoRecordset::GetDefaultDBName`|
|`CFieldExchange`|`CDaoFieldExchange`|
|`RFX_Bool`|`DFX_Bool`|
|`RFX_Byte`|`DFX_Byte`|
|`RFX_Int`|`DFX_Short`|
|`RFX_Long`|`DFX_Long`|
||`DFX_Currency`|
|`RFX_Single`|`DFX_Single`|
|`RFX_Double`|`DFX_Double`|
|`RFX_Date`<sup>1</sup>|`DFX_Date` (на основе`COleDateTime`)|
|`RFX_Text`|`DFX_Text`|
|`RFX_Binary`|`DFX_Binary`|
|`RFX_LongBinary`|`DFX_LongBinary`|

<sup>1</sup> функция `RFX_Date` основана на `CTime` и `TIMESTAMP_STRUCT`.

Основные изменения в функциональных возможностях, которые могут повлиять на работу приложения и потребовать более чем простые изменения имен, перечислены ниже.

- Были изменены константы и макросы, используемые для указания таких элементов, как тип открытого набора записей и параметры открытия набора записей.

   Классы ODBC MFC, необходимые для определения этих параметров с помощью макросов или перечисляемых типов.

   С помощью классов DAO DAO предоставляет определение этих параметров в файле заголовка (ДБДАОИНТ. H). Таким же типом набора записей является перечислимый элемент `CRecordset`, но с помощью DAO вместо этого используется константа. Например, при указании типа `CRecordset` в ODBC используется **моментальный снимок** , но **DB_OPEN_SNAPSHOT** при указании типа `CDaoRecordset`.

- Тип набора записей по умолчанию для `CRecordset` — **snapshot** , тогда как тип набора записей по умолчанию для `CDaoRecordset` является **динамическим** набором (см. Примечание ниже, чтобы получить дополнительную информацию о моментальных снимках классов ODBC).

- Класс `CRecordset` ODBC имеет возможность создания типа набора записей только для последовательного доступа. В классе `CDaoRecordset` только однопроходный режим не является типом набора записей, а свойством (или параметром) определенных типов наборов записей.

- Набор записей только для добавления при открытии объекта `CRecordset` означал, что данные набора записей могут быть считаны и добавлены. При использовании объекта `CDaoRecordset` параметр «только добавление» означает буквально, что к данным набора записей можно добавлять только (и не считывать).

- Функции члена транзакции классов ODBC являются членами `CDatabase` и работают на уровне базы данных. В классах DAO функции-члены транзакций являются членами класса более высокого уровня (`CDaoWorkspace`) и поэтому могут влиять на несколько `CDaoDatabase` объектов, совместно использующих одну и ту же рабочую область (пространство транзакции).

- Класс исключения был изменен. `CDBExceptions` вызываются в классах ODBC и `CDaoExceptions` в классах DAO.

- `RFX_Date` использует объекты `CTime` и `TIMESTAMP_STRUCT`, а `DFX_Date` использует `COleDateTime`. `COleDateTime` практически идентично `CTime`, но основан на 8-байтовой **дате** OLE, а не на 4-байтовой **time_t** , поэтому она может содержать намного больший диапазон данных.

   > [!NOTE]
   > Моментальные снимки DAO (`CDaoRecordset`) доступны только для чтения, тогда как моментальные снимки ODBC (`CRecordset`) могут быть обновлены в зависимости от драйвера и использования библиотеки курсоров ODBC. Если используется библиотека курсоров, `CRecordset` моментальные снимки обновляются. Если вы используете любой из драйверов Майкрософт из пакета драйверов для настольных компьютеров 3,0 без библиотеки курсоров ODBC, `CRecordset` моментальные снимки доступны только для чтения. Если вы используете другой драйвер, просмотрите документацию по драйверу, чтобы узнать, доступны ли моментальные снимки (`STATIC_CURSORS`) только для чтения.

## <a name="see-also"></a>См. также:

[Технические примечания по номеру](../mfc/technical-notes-by-number.md)<br/>
[Технические примечания по категории](../mfc/technical-notes-by-category.md)
