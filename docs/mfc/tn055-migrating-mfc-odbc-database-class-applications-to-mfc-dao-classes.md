---
title: 'TN055: Перенос приложений классов базы данных MFC ODBC в классы MFC DAO'
ms.date: 09/17/2019
helpviewer_keywords:
- DAO [MFC], migration
- TN055
- migration [MFC], ODBC database applications
- ODBC classes [MFC], DAO classes
- migrating ODBC database applications [MFC]
- porting database applications to DAO
- ODBC [MFC], DAO
- porting ODBC database applications to DAO
- migrating database applications [MFC]
ms.assetid: 0f858bd1-e168-4e2e-bcd1-8debd82856e4
ms.openlocfilehash: 7107964cc894a0aa45be5de362c9edd166dc0af1
ms.sourcegitcommit: 2f96e2fda591d7b1b28842b2ea24e6297bcc3622
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/18/2019
ms.locfileid: "71095961"
---
# <a name="tn055-migrating-mfc-odbc-database-class-applications-to-mfc-dao-classes"></a>TN055: Перенос приложений классов базы данных MFC ODBC в классы MFC DAO

> [!NOTE]
> DAO используется с базами данных Access и поддерживается в Office 2013. 3,6 является окончательной версией и считается устаревшей. Визуальная C++ среда и мастера не поддерживают DAO (хотя классы DAO включены и их все еще можно использовать). Корпорация Майкрософт рекомендует использовать [шаблоны OLE DB](../data/oledb/ole-db-templates.md) или [ODBC и MFC](../data/odbc/odbc-and-mfc.md) для новых проектов. DAO следует использовать только для поддержки существующих приложений.

## <a name="overview"></a>Обзор

Во многих ситуациях может быть желательно перенести приложения, использующие классы базы данных ODBC MFC, в классы базы данных MFC DAO. В этом техническом примечании будет подробно описана большая часть различий между классами MFC ODBC и DAO. Учитывая различия, при необходимости не следует чрезмерно переносить приложения из классов ODBC в классы MFC.

## <a name="why-migrate-from-odbc-to-dao"></a>Зачем выполнять миграцию из ODBC в DAO

Существует ряд причин, по которым может потребоваться перенести приложения из классов базы данных ODBC в классы базы данных DAO, но решение не обязательно просто или очевидно. Следует помнить, что ядро СУБД Microsoft Jet, используемое DAO, может считывать любой источник данных ODBC, для которого имеется драйвер ODBC. Возможно, более эффективно использовать классы базы данных ODBC или напрямую вызывать ODBC, но ядро СУБД Microsoft Jet может считывать данные ODBC.

Некоторые простые ситуации делают решение ODBC/DAO простым. Например, если требуется доступ только к данным в формате, который ядро Microsoft Jet может читать напрямую (формат доступа, формат Excel и т. д.), очевидно, что используется класс базы данных DAO.

Более сложные случаи возникают, когда данные существуют на сервере или на различных серверах. В этом случае решение об использовании классов базы данных ODBC или классов базы данных DAO сложнее. Если вы хотите выполнить такие действия, как разнородные соединения (объединение данных с серверов в нескольких форматах, например SQL Server и Oracle), то ядро СУБД Microsoft Jet выполнит присоединение, а не предложит выполнить необходимые действия при использовании базы данных ODBC. Классы или ODBC напрямую. Если используется драйвер ODBC, поддерживающий курсоры драйвера, лучшим выбором могут быть классы базы данных ODBC.

Выбор может быть сложным, поэтому может потребоваться написать пример кода для проверки производительности различных методов, учитывая ваши особые потребности. В этом техническом примечании предполагается, что вы приняли решение перейти с классов базы данных ODBC на классы базы данных DAO.

## <a name="similarities-between-odbc-database-classes-and-mfc-dao-database-classes"></a>Сходство между классами базы данных ODBC и классами базы данных DAO MFC

Первоначальная структура классов ODBC MFC основана на модели объектов DAO, которая использовалась в Microsoft Access и Microsoft Visual Basic. Это означает, что существует множество общих возможностей классов MFC и DAO, которые не будут перечислены в этом разделе. Как правило, модели программирования одинаковы.

Чтобы выделить несколько сходных моментов, сделайте следующее:

- Классы ODBC и DAO имеют объекты базы данных, которые управляются с помощью базовой системы управления базами данных (СУБД).

- Оба имеют объекты Recordset, представляющие набор результатов, возвращаемых этой СУБД.

- База данных DAO и объекты набора записей имеют почти одинаковые элементы в классах ODBC.

- При использовании обоих наборов классов код для получения данных идентичен, за исключением некоторых изменений имен объектов и членов. Изменения будут обязательными, но обычно при переключении с классов ODBC на классы DAO, как правило, происходит простое изменение имени.

Например, в обеих моделях процедура получения данных заключается в создании и открытии объекта базы данных, создании и открытии объекта набора записей, а также при навигации (перемещении), когда данные выполняют некоторую операцию.

## <a name="differences-between-odbc-and-dao-mfc-classes"></a>Различия между классами MFC ODBC и DAO

Классы DAO содержат больше объектов и более широкий набор методов, но в этом разделе будут подробно описаны различия в схожих классах и функциональных возможностях.

Вероятно, наиболее очевидными различиями между классами являются изменения имен для схожих классов и глобальных функций. В следующем списке показаны изменения имен объектов, методов и глобальных функций, связанных с классами базы данных.

|Класс или функция|Эквивалент в классах MFC DAO|
|-----------------------|-----------------------------------|
|`CDatabase`|`CDaoDatabase`|
|`CDatabase::ExecuteSQL`|`CDaoDatabase::Execute`|
|`CRecordset`|`CDaoRecordset`|
|`CRecordset::GetDefaultConnect`|`CDaoRecordset::GetDefaultDBName`|
|`CFieldExchange`|`CDaoFieldExchange`|
|`RFX_Bool`|`DFX_Bool`|
|`RFX_Byte`|`DFX_Byte`|
|`RFX_Int`|`DFX_Short`|
|`RFX_Long`|`DFX_Long`|
||`DFX_Currency`|
|`RFX_Single`|`DFX_Single`|
|`RFX_Double`|`DFX_Double`|
|`RFX_Date`<sup>одного</sup>|`DFX_Date`(`COleDateTime`на основе)|
|`RFX_Text`|`DFX_Text`|
|`RFX_Binary`|`DFX_Binary`|
|`RFX_LongBinary`|`DFX_LongBinary`|

1 функция основана на `CTime` и. <sup></sup> `RFX_Date` `TIMESTAMP_STRUCT`

Основные изменения в функциональных возможностях, которые могут повлиять на работу приложения и потребовать более чем простые изменения имен, перечислены ниже.

- Были изменены константы и макросы, используемые для указания таких элементов, как тип открытого набора записей и параметры открытия набора записей.

   Классы ODBC MFC, необходимые для определения этих параметров с помощью макросов или перечисляемых типов.

   С помощью классов DAO DAO предоставляет определение этих параметров в файле заголовка (ДБДАОИНТ. H). Таким же типом набора записей является перечислимый элемент `CRecordset`, но с DAO он является константой. Например, **моментальный снимок** используется при указании типа `CRecordset` в ODBC, но при указании типа `CDaoRecordset`DB_OPEN_SNAPSHOT.

- Тип `CRecordset` набора записей по умолчанию для — **snapshot** , а тип набора `CDaoRecordset` записей по умолчанию — **Динамическое подмножество** (см. Примечание ниже, чтобы получить дополнительную информацию о моментальных снимках классов ODBC).

- Класс ODBC `CRecordset` имеет возможность создания типа набора записей только для последовательного доступа. `CDaoRecordset` В классе только однопроходный тип не является типом набора записей, а свойством (или параметром) определенных типов наборов записей.

- Набор записей, предназначенный только для добавления `CRecordset` , при открытии объекта означает, что данные набора записей могут быть считаны и добавлены. При `CDaoRecordset` использовании объекта параметр только присоединения означает буквально, что к данным набора записей можно добавлять только (и не читать).

- Функции члена транзакции классов ODBC являются членами `CDatabase` и работают на уровне базы данных. В классах DAO функции-члены транзакций являются членами класса более высокого уровня (`CDaoWorkspace`) и поэтому могут влиять на несколько `CDaoDatabase` объектов, совместно использующих одну и ту же рабочую область (пространство транзакций).

- Класс исключения был изменен. `CDBExceptions`вызываются в классах ODBC и `CDaoExceptions` в классах DAO.

- `RFX_Date`использует `CTime` объекты `TIMESTAMP_STRUCT` и при `DFX_Date` использовании .`COleDateTime` Объект `COleDateTime` почти идентичен, но основан на 8-байтовой дате OLE, а не на 4-байтовом time_t, поэтому он может содержать намного больший диапазон данных. `CTime`

   > [!NOTE]
   > Моментальные`CDaoRecordset`снимки DAO () доступны только для чтения, тогда`CRecordset`как моментальные снимки ODBC () могут быть обновлены в зависимости от драйвера и использования библиотеки курсоров ODBC. Если используется библиотека курсоров, `CRecordset` моментальные снимки могут обновляться. Если вы используете любой из драйверов Майкрософт из пакета драйверов для настольных компьютеров 3,0 без библиотеки курсоров ODBC `CRecordset` , то моментальные снимки будут доступны только для чтения. Если вы используете другой драйвер, ознакомьтесь с документацией по драйверу, чтобы узнать, доступны`STATIC_CURSORS`ли моментальные снимки () только для чтения.

## <a name="see-also"></a>См. также

[Технические примечания по номеру](../mfc/technical-notes-by-number.md)<br/>
[Технические примечания по категории](../mfc/technical-notes-by-category.md)
