---
title: Поддержка MAPI в MFC
ms.date: 11/04/2016
helpviewer_keywords:
- MFC, MAPI support
- MAPI support in MFC
- CDocument class [MFC], and MAPI
- OnUpdateFileSendMail method [MFC]
- MAPI, MFC
- OnFileSendMail method [MFC]
ms.assetid: cafbecb1-0427-4077-b4b8-159bae5b49b8
ms.openlocfilehash: 3024f744407cf33c8dfad8a6f7af736e0f8061ef
ms.sourcegitcommit: c123cc76bb2b6c5cde6f4c425ece420ac733bf70
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81357000"
---
# <a name="mapi-support-in-mfc"></a>Поддержка MAPI в MFC

MFC предоставляет поддержку подмноженому интерфейсу программы microsoft `CDocument`Messaging Application Program Interface (MAPI) в классе. В `CDocument` частности, есть функции членов, которые определяют, присутствует ли поддержка почты на компьютере конечнома пользователя, и если да, то включить команду Send Mail, стандартный идентификатор команды является ID_FILE_SEND_MAIL. Функция обработчика MFC для этой команды позволяет пользователю отправлять документ по электронной почте.

> [!TIP]
> Хотя MFC не инкапсулирует весь набор функций MAPI, вы все равно можете звонить функции MAPI напрямую, так же, как вы можете позвонить в функции Win32 API непосредственно из программ MFC.

Предоставление команды Отправки Почты в приложении очень просто. MFC предоставляет реализацию для упаковки документа `CDocument`(т.е. объекта, полученного) в качестве вложения и отправки его в виде почты. Это вложение эквивалентно команде Сохранения файлов, которая сохраняет (сериализирует) содержимое документа для почтового сообщения. Эта реализация призывает почтового клиента на машине пользователя предоставить пользователю возможность обратиться к почте и добавить текст сообщения темы и сообщения к сообщению. Пользователи видят пользовательский интерфейс своего знакомого почтового приложения. Эта функциональность поставляется `CDocument` двумя функциями-членами: `OnFileSendMail` и `OnUpdateFileSendMail`.

MAPI необходимо прочитать файл для отправки вложения. Если приложение сохраняет свой файл `OnFileSendMail` данных открытым во время вызова функции, файл должен быть открыт с режимом общего доступа, который позволяет нескольким процессам получить доступ к файлу.

> [!NOTE]
> Главная версия `OnFileSendMail` для класса `COleDocument` правильно обрабатывает сложные документы.

#### <a name="to-implement-a-send-mail-command-with-mfc"></a>Реализация команды Отправки Почты с MFC

1. Используйте редактор меню Visual C' для добавления элемента меню, идентификатор команды которого является ID_FILE_SEND_MAIL.

   Этот идентификатор команды обеспечивается инфраструктурой в AFXRES. H. Команда может быть добавлена в любое меню, но обычно добавляется в меню **файла.**

1. Вручную добавьте следующее в карту сообщений документа:

   [!code-cpp[NVC_MFCDocView#9](../mfc/codesnippet/cpp/mapi-support-in-mfc_1.cpp)]

    > [!NOTE]
    >  Эта карта сообщений работает для `CDocument` документа, полученного из любого или `COleDocument` - он берет правильный базовый класс в любом случае, даже если карта сообщений находится в вашем классе производных документов.

1. Создайте свое приложение.

Если доступна почтовая поддержка, MFC позволяет пункту меню и `OnUpdateFileSendMail` впоследствии обрабатывает команду с `OnFileSendMail`помощью. Если поддержка почты недоступна, MFC автоматически удаляет элемент меню, чтобы пользователь не видел его.

> [!TIP]
> Вместо того, чтобы вручную добавлять записи на карте сообщений, как описано ранее, можно использовать [«Мастер класса класса»](reference/mfc-class-wizard.md) для картирования сообщений к функциям. Для получения дополнительной [Mapping Messages to Functions](../mfc/reference/mapping-messages-to-functions.md)информации см.

Для получения соответствующей [информации](../mfc/mapi.md) см.

Для получения дополнительной `CDocument` информации о функциях членов, которые позволяют MAPI, см.:

- [Документ::OnFileSendMail](../mfc/reference/cdocument-class.md#onfilesendmail)

- [Документ::OnUpdateFileSendMail](../mfc/reference/cdocument-class.md#onupdatefilesendmail)

- [COleDocument::OnFileSendMail](../mfc/reference/coledocument-class.md#onfilesendmail)

## <a name="see-also"></a>См. также раздел

[MAPI](../mfc/mapi.md)
