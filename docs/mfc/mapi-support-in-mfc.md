---
title: Поддержка MAPI в MFC
ms.date: 11/04/2016
helpviewer_keywords:
- MFC, MAPI support
- MAPI support in MFC
- CDocument class [MFC], and MAPI
- OnUpdateFileSendMail method [MFC]
- MAPI, MFC
- OnFileSendMail method [MFC]
ms.assetid: cafbecb1-0427-4077-b4b8-159bae5b49b8
ms.openlocfilehash: e46eaf2bd84d4cebd2215ab2752ce3bb8e1eb9b3
ms.sourcegitcommit: 3caf5261b3ea80d9cf14038c116ba981d655cd13
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/11/2019
ms.locfileid: "70907681"
---
# <a name="mapi-support-in-mfc"></a>Поддержка MAPI в MFC

MFC предоставляет поддержку для подмножества интерфейса MAPI в классе `CDocument`. В частности `CDocument` , содержит функции-члены, которые определяют, имеется ли поддержка почты на компьютере конечного пользователя, и, если это так, включите команду отправки почты, чей стандартный идентификатор команды — ID_FILE_SEND_MAIL. Функция обработчика MFC для этой команды позволяет пользователю отправить документ по электронной почте.

> [!TIP]
>  Хотя MFC не инкапсулирует весь набор функций MAPI, вы по-прежнему можете вызывать функции MAPI напрямую, точно так же, как можно вызывать функции API Win32 непосредственно из программ MFC.

Предоставление команды отправки почты в приложении очень просто. MFC предоставляет реализацию для упаковки документа (то есть `CDocument`производного объекта) в виде вложения и отправки его в виде почты. Это вложение эквивалентно команде Save File, которая сохраняет (сериализует) содержимое документа в почтовое сообщение. Эта реализация обращается к почтовому клиенту на компьютере пользователя, чтобы предоставить пользователю возможность адресации почты и добавления темы и текста сообщения в почтовое сообщение. Пользователи видят привычный пользовательский интерфейс почтовых приложений. Эта функция предоставляется двумя `CDocument` функциями-членами: `OnFileSendMail` и `OnUpdateFileSendMail`.

Для отправки вложения MAPI должен прочитать файл. Если приложение сохраняет свой файл данных открытым во время `OnFileSendMail` вызова функции, файл необходимо открыть с помощью общего режима, который позволяет нескольким процессам обращаться к файлу.

> [!NOTE]
>  Переопределение версии `OnFileSendMail` для класса `COleDocument` правильно обрабатывает составные документы.

#### <a name="to-implement-a-send-mail-command-with-mfc"></a>Реализация команды отправки почты с помощью MFC

1. Используйте редактор меню C++ визуального элемента, чтобы добавить пункт меню с идентификатором команды ID_FILE_SEND_MAIL.

   Этот идентификатор команды предоставляется платформой в AFXRES. Высоты. Команду можно добавить в любое меню, но обычно она добавляется в меню **файл** .

1. Вручную добавьте следующий текст в схему сообщения документа:

   [!code-cpp[NVC_MFCDocView#9](../mfc/codesnippet/cpp/mapi-support-in-mfc_1.cpp)]

    > [!NOTE]
    >  Эта схема сообщений работает для документа, производного от `CDocument` или `COleDocument` — он выбирает правильный базовый класс в любом случае, даже если схема сообщений находится в классе производного документа.

1. Создайте приложение.

Если доступна поддержка почты, MFC позволяет элементу меню с помощью `OnUpdateFileSendMail` и затем обрабатывать команду с помощью `OnFileSendMail`. Если поддержка почты недоступна, MFC автоматически удаляет пункт меню, чтобы пользователь не увидит его.

> [!TIP]
>  Вместо того, чтобы добавлять записи схемы сообщений вручную, как описано выше, можно использовать [мастер классов](reference/mfc-class-wizard.md) классов для преобразования сообщений в функции. Дополнительные сведения см. [в разделе Сопоставление сообщений с функциями](../mfc/reference/mapping-messages-to-functions.md).

Связанные сведения см. в обзоре [MAPI](../mfc/mapi.md) .

Дополнительные сведения о `CDocument` функциях элементов, которые включают MAPI, см. в следующих статьях:

- [CDocument:: Онфилесендмаил](../mfc/reference/cdocument-class.md#onfilesendmail)

- [CDocument:: Онупдатефилесендмаил](../mfc/reference/cdocument-class.md#onupdatefilesendmail)

- [Коледокумент:: Онфилесендмаил](../mfc/reference/coledocument-class.md#onfilesendmail)

## <a name="see-also"></a>См. также

[MAPI](../mfc/mapi.md)
