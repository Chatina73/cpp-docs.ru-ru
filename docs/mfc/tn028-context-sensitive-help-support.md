---
title: TN028. Поддержка контекстной справки
ms.date: 11/04/2016
f1_keywords:
- vc.help
helpviewer_keywords:
- context-sensitive Help [MFC], MFC applications
- TN028
- resource identifiers, context-sensitive Help
ms.assetid: 884f1c55-fa27-4d4c-984f-30907d477484
ms.openlocfilehash: db20cb087d70284103cd02dcfa34b2089ae09821
ms.sourcegitcommit: 6052185696adca270bc9bdbec45a626dd89cdcdd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/31/2018
ms.locfileid: "50533423"
---
# <a name="tn028-context-sensitive-help-support"></a>TN028. Поддержка контекстной справки

Эта заметка описывает правила для назначения идентификаторов контекстов справки и другие проблемы справки в MFC. Поддержка контекстной справки требуется компилятор справки, который доступен в Visual C++.

> [!NOTE]
>  Помимо реализации контекстной справки, с помощью WinHelp, MFC также поддерживает использование справки HTML. Дополнительные сведения об этой поддержки и программирование с использованием HTML-справки, см. в разделе [HTML-справки: Context-Sensitive для ваших программ](../mfc/html-help-context-sensitive-help-for-your-programs.md).

## <a name="types-of-help-supported"></a>Типы поддерживаемых справки

Существует два типа контекстной справки, реализованы в приложениях Windows. Во-первых, называется «Справки F1» включает в себя запуск WinHelp с соответствующий контекст на основе текущего активного объекта. Второй — режим «Shift + F1». В этом режиме курсор мыши изменяется на курсор справки, и пользователь переходит к объект, щелкните. На этом этапе WinHelp запускается для предоставления справки для объекта, который щелкнул пользователь.

Microsoft Foundation Classes реализовать оба этих форм справки. Кроме того платформа поддерживает две команды простой справки указателя справки и использование помочь.

## <a name="help-files"></a>Файлы справки

Библиотеки Microsoft Foundation classes предполагают один файл справки. Этот файл справки должен иметь одно и то же имя и путь, что и приложение. Например если исполняемый файл является C:\MyApplication\MyHelp.exe файла справки необходимо C:\MyApplication\MyHelp.hlp. Задайте путь через *m_pszHelpFilePath* переменной-члена [класс CWinApp](../mfc/reference/cwinapp-class.md).

## <a name="help-context-ranges"></a>Диапазоны контекста справки

Реализация по умолчанию MFC требуется программы следовать правилам, некоторые сведения о назначении идентификаторов контекста справки. Эти правила являются диапазон идентификаторов назначен определенных элементов управления. Эти правила можно переопределить, указав различные реализации различных функций-членов, связанных со справкой.

```
0x00000000 - 0x0000FFFF : user defined
0x00010000 - 0x0001FFFF : commands (menus/command buttons)
0x00010000 + ID_
(note: 0x18000-> 0x1FFFF is the practical range since command IDs are>=0x8000)
0x00020000 - 0x0002FFFF : windows and dialogs
0x00020000 + IDR_
(note: 0x20000-> 0x27FFF is the practical range since IDRs are <= 0x7FFF)
0x00030000 - 0x0003FFFF : error messages (based on error string ID)
0x00030000 + IDP_
0x00040000 - 0x0004FFFF : special purpose (non-client areas)
0x00040000 + HitTest area
0x00050000 - 0x0005FFFF : controls (those that are not commands)
0x00040000 + IDW_
```

## <a name="simple-help-commands"></a>Команды простой «Help»

Существует две простые команды справки, которые реализуются Microsoft Foundation Classes.

- ID_HELP_INDEX, который реализован [CWinApp::OnHelpIndex](../mfc/reference/cwinapp-class.md#onhelpindex)

- ID_HELP_USING, который реализован [CWinApp::OnHelpUsing](../mfc/reference/cwinapp-class.md#onhelpusing)

Первая команда показывает индекс справки для приложения. Вторая показывает пользовательской справки по использованию программы WinHelp.

## <a name="context-sensitive-help-f1-help"></a>Контекстной справки (Справка F1)

Клавиши F1 обычно преобразуется в команде с Идентификатором ID_HELP ускорителем, помещаются в таблицу сочетаний клавиш главного окна. Id_help-команда также могут создаваться с помощью кнопки с ID_HELP из идентификатора в главном окне или диалоговом окне.

Независимо от того, как создается id_help-команда оно будет направлено как обычный команду, пока не достигнет обработчик команды. Дополнительные сведения об архитектуре маршрутизация команд MFC см. [технические 21 Примечание](../mfc/tn021-command-and-message-routing.md). Если приложение имеет справки включена, id_help-команда будет обрабатываться [CWinApp::OnHelp](../mfc/reference/cwinapp-class.md#onhelp). Объект приложения получает справочные сообщения и затем соответствующим образом направляет команду. Это необходимо, поскольку маршрутизация команд по умолчанию не подходит для определения наиболее конкретный контекст.

`CWinApp::OnHelp` пытается запустить WinHelp в следующем порядке:

1. Проверяет наличие активной `AfxMessageBox` вызов с идентификатором справки. Если появится сообщение, в данный момент активна, WinHelp запускается с контекстом, подходящие для этого окно сообщения.

1. Отправляет сообщение WM_COMMANDHELP активного окна. Если это окно не отвечает, запустив WinHelp, то же сообщение затем отправляется предков окну до обработки сообщения или текущее окно является окном верхнего уровня.

1. Id_default_help-команда отправляет в главное окно. Это вызывает справку по умолчанию. Эта команда обычно сопоставляется с `CWinApp::OnHelpIndex`.

Чтобы глобально переопределить значения по умолчанию идентификатор базового (например 0x10000 для команд и 0x20000 для ресурсов, таких как диалоговые окна), приложения должны переопределять [CWinApp::WinHelp](../mfc/reference/cwinapp-class.md#winhelp).

Чтобы переопределить эту функцию и способом, что контекст справки определяется, следует обрабатывать сообщения WM_COMMANDHELP. Вы можете более конкретные справки маршрутизации не предоставляет платформу, только чуть как глубокие текущего дочернего окна MDI. Можно также предоставлять более конкретные справку по окно или диалоговое окно, возможно, основываясь на текущей внутреннее состояние объекта или активный элемент управления в диалоговом окне.

## <a name="wmcommandhelp"></a>WM_COMMANDHELP

```

afx_msg LRESULT CWnd::OnCommandHelp(WPARAM wParam, LPARAM lParam)

```

WM_COMMANDHELP является конфиденциального сообщения Windows MFC, получаемого окна справки при получении запроса. Когда окно получает это сообщение, оно может вызвать `CWinApp::WinHelp` с контекстом, который соответствует внутреннее состояние окна.

*lParam*<br/>
Содержит контекст справки в настоящее время недоступно. *lParam* равно нулю, если контекст справки не было определено. Реализация `OnCommandHelp` можно использовать идентификатор контекста в *lParam* для определения другого контекста, или можно просто передать его в `CWinApp::WinHelp`.

*wParam*<br/>
Не используется и должен быть равен нулю.

Если `OnCommandHelp` вызовы функций `CWinApp::WinHelp`, он должен вернуть **TRUE**. Возвращение **TRUE** Останавливает маршрутизацию этой команды для других классов и других окон.

## <a name="help-mode-shiftf1-help"></a>Режим справки (Справка Shift + F1)

Это вторая форма контекстной справки. Как правило этот режим ввода, нажав клавиши SHIFT + F1 или с помощью панели инструментов или меню. Она реализуется как команду (ID_CONTEXT_HELP). Обработчик фильтра сообщений не используется для преобразования этой команды при модального диалогового окна или меню активен, поэтому эта команда доступна только для пользователя при выполнении цикла обработки сообщений приложения (`CWinApp::Run`).

После ввода этого режима, курсор мыши справки отображается по всем областям приложения, даже если приложение обычно будет отображаться свой собственный курсора для этой области (например, изменяющей размер границы вокруг окна). Пользователь имеет возможность использовать мышь или клавиатуру для выбора команды. Вместо выполнения команды, отображается справка по этой команде. Кроме того пользователь может щелкнуть объект отображается на экране, такого как кнопка на панели инструментов и отображается справка для этого объекта. Этот режим справки обеспечивается `CWinApp::OnContextHelp`.

Во время выполнения этого цикла, все сочетания входных данных неактивна, за исключением ключей, доступа к меню. Кроме того, перевод команды по-прежнему выполняется посредством `PreTranslateMessage` чтобы разрешить пользователю нажмите сочетание клавиш и получать справку по этой команды.

При наличии определенного переводы или действиях, поместите в `PreTranslateMessage` функцию, которая не должен быть отображен во время режима справки SHIFT + F1, следует проверить *m_bHelpMode* членом `CWinApp` перед их выполнением операции. `CDialog` Реализация `PreTranslateMessage` проверяет это перед вызовом `IsDialogMessage`, например. Это приведет к отключению «диалоговое окно» нажатие клавиши на немодальное диалоговое окно в режиме SHIFT + F1. Кроме того `CWinApp::OnIdle` по-прежнему вызывается во время этого цикла.

Если пользователь выбирает команду в меню, она обрабатывается как справку по этой команды (через WM_COMMANDHELP, см. ниже). Если пользователь щелкает видимой области окна приложения, принимается это решение о том, является ли щелчок неклиентской или клиент, нажмите кнопку. `OnContextHelp` сопоставление дескрипторов неклиентской нажимает на щелчки клиента автоматически. Если это клиент, нажмите кнопку, затем отправляет WM_HELPHITTEST в окно, в котором был выполнен щелчок. Если это окно возвращает ненулевое значение, это значение используется как контекст для получения справки. Если он возвращает ноль, `OnContextHelp` пытается родительского окна (и не удается, его родительский элемент и так далее). Если не удается определить контекст справки, по умолчанию используется для отправки id_default_help-команда в главное окно, которое затем (обычно) сопоставляется `CWinApp::OnHelpIndex`.

## <a name="wmhelphittest"></a>WM_HELPHITTEST

```

afx_msg LRESULT CWnd::OnHelpHitTest(
WPARAM, LPARAM lParam)
```

WM_HELPHITTEST является сообщение закрытый windows MFC, получаемого окна нажата во время режима справки SHIFT + F1. Когда окно получает это сообщение, он возвращает **DWORD** идентификатор справки для использования WinHelp.

LOWORD(lParam) содержит координаты по оси x устройства, где выполнен щелчок относительно клиентской области окна.

HIWORD(lParam) содержит координаты по оси y.

*wParam*<br/>
Не используется и должен быть равен нулю. Если возвращаемое значение имеет ненулевое значение, WinHelp вызывается с этим контекстом. Если возвращаемое значение равно нулю, родительское окно запрашивается для получения справки.

Во многих случаях вы можете использовать код проверки нажатия, возможно, уже есть. См. в разделе реализации `CToolBar::OnHelpHitTest` пример обработки сообщения WM_HELPHITTEST (код использует код проверки нажатия, используемый для кнопок и подсказки в `CControlBar`).

## <a name="mfc-application-wizard-support-and-makehm"></a>Поддержка мастера приложений MFC и MAKEHM

Мастер приложений MFC создает файлы, необходимые для построения файла справки (.cnt и .hpj файлы). Он также включает ряд готовых RTF-файлы, которые принимаются компилятором помочь корпорации Майкрософт. Во многих разделах завершены, но некоторым может понадобиться изменить для конкретного приложения.

Служебная программа MAKEHM поддерживается автоматическое создание файла «справки сопоставление». Программа MAKEHM можно легко преобразовать РЕСУРСОВ приложения. H-файл сопоставления файла справки. Пример:

```
#define IDD_MY_DIALOG   2000
#define ID_MY_COMMAND   150
```

будет преобразован в:

```
HIDD_MY_DIALOG    0x207d0
HID_MY_COMMAND    0x10096
```

Этот формат совместим с механизмом компилятор справки, который сопоставляет идентификаторы контекста (номера в правой части) с имена разделов (символов с левой стороны).

В примере программы программирования MFC доступен исходный код для MAKEHM [MAKEHM](../visual-cpp-samples.md).

## <a name="adding-help-support-after-running-the-mfc-application-wizard"></a>Добавление поддержки справки после выполнения мастера приложений MFC

Добавление справки в приложение рекомендуется установить флажок «Контекстные справки» на странице "Дополнительные возможности" мастера приложений MFC перед созданием приложения. В этом случае мастер приложений MFC автоматически добавляет записей карты сообщений, необходимые для вашего `CWinApp`-производный класс для поддержки справки.

## <a name="help-on-message-boxes"></a>Получить справку в окнах сообщений

Справку в окнах сообщений (иногда называется оповещения) поддерживается с помощью `AfxMessageBox` функция, оболочкой для `MessageBox` Windows API.

Существуют две версии `AfxMessageBox`, одна для использования с строковый идентификатор, а другой для использования с указателем на строку (`LPCSTR`):

```
int AFXAPI AfxMessageBox(LPCSTR lpszText,
    UINT nType,
    UINT nIDHelp);

int AFXAPI AfxMessageBox(UINT nIDPrompt,
    UINT nType,
    UINT nIDHelp);
```

В обоих случаях имеется необязательный идентификатор справки.

В первом случае по умолчанию для nIDHelp является 0, означающее Справка для данного окна сообщения. Если пользователь нажимает клавишу F1, например сообщения поле активно, пользователь не получит справки (даже если приложение поддерживает справку). Если это нежелательно, необходимо указать идентификатор справки для nIDHelp.

Во втором случае значение по умолчанию для nIDHelp-1, указывает, что идентификатор справки совпадает со значением nIDPrompt. Справка будет работать только в том случае, если приложение доступно для справки, конечно). Необходимо предоставить 0 для nIDHelp при желании у нет поддержка справки в окне сообщения. Следует необходимо, чтобы сообщение справки включена, но хотят иметь идентификатор различная справочная чем nIDPrompt, достаточно просто указать положительное значение для nIDHelp, отличающемся от nIDPrompt.

## <a name="see-also"></a>См. также

[Технические примечания по номеру](../mfc/technical-notes-by-number.md)<br/>
[Технические примечания по категории](../mfc/technical-notes-by-category.md)

