---
title: Пошаговое руководство. Использование новых элементов управления оболочки MFC
ms.date: 04/25/2019
helpviewer_keywords:
- shell controls (MFC)
ms.assetid: f0015caa-199d-4aaf-9501-5a239fce9095
ms.openlocfilehash: 0d8db9044a64305bd7bb9ef6fe10de9ecef1ce51
ms.sourcegitcommit: 9c2b3df9b837879cd17932ae9f61cdd142078260
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/29/2020
ms.locfileid: "92924754"
---
# <a name="walkthrough-using-the-new-mfc-shell-controls"></a>Пошаговое руководство. Использование новых элементов управления оболочки MFC

В этом пошаговом руководстве вы создадите приложение, напоминающее проводник. Вы создадите окно с двумя панелями. На левой панели будет содержаться объект [кмфкшеллтриктрл](../mfc/reference/cmfcshelltreectrl-class.md) , который отображает рабочий стол в иерархическом представлении. На правой панели будет содержаться [кмфкшелллистктрл](../mfc/reference/cmfcshelllistctrl-class.md) , отображающий файлы в папке, выбранной в левой области.

## <a name="prerequisites"></a>Предварительные требования

- В Visual Studio 2017 и более поздних версиях поддержка MFC является дополнительным компонентом. Чтобы установить его, откройте Visual Studio Installer из меню "Пуск" Windows. Найдите используемую версию Visual Studio и нажмите кнопку **Modify (изменить** ). Убедитесь, что установлен флажок **Разработка классических приложений на C++** . В разделе **необязательные компоненты** установите флажок **Поддержка MFC** .

- В этом пошаговом руководстве предполагается, что вы настроили Visual Studio для использования **общих параметров разработки** . Если вы используете другой параметр разработки, некоторые окна Visual Studio, используемые в этом пошаговом руководстве, могут не отображаться по умолчанию.

## <a name="to-create-a-new-mfc-application-by-using-the-mfc-application-wizard"></a>Создание нового приложения MFC с помощью мастера приложений MFC

Эти действия зависят от используемой версии Visual Studio. Чтобы ознакомиться с документацией по предпочтительной версии Visual Studio, используйте селектор **Версия** . Он находится в верхней части оглавления на этой странице.

::: moniker range="msvc-160"

### <a name="to-create-an-mfc-project-in-visual-studio-2019"></a>Создание проекта MFC в Visual Studio 2019

1. В главном меню выберите **Файл** > **Создать** > **Проект** , чтобы открыть диалоговое окно **Создание проекта** .

1. В поле поиска вверху введите **MFC** , а затем выберите **приложение MFC** в списке результатов.

1. Нажмите кнопку **Далее** . На следующей странице введите имя проекта и при необходимости укажите расположение проекта.

1. Нажмите кнопку **Создать** , чтобы создать проект.

   После отображения **мастера приложений MFC** используйте следующие параметры.

   1. Выберите **Тип приложения** слева. Затем выберите **один документ** и выберите **Поддержка архитектуры документа/представления** . В разделе **стиль проекта** выберите **Visual Studio** , а затем в раскрывающемся списке **визуальный стиль и цвета** выберите **Office 2007 (синяя тема)** .

   1. На панели **Поддержка составных документов** выберите **нет** .

   1. Не вносите никаких изменений в область **Свойства шаблона документа** .

   1. На панели **функции интерфейса пользователя** убедитесь, что выбран параметр **использовать строку меню и панель инструментов** . Оставьте все остальные параметры как есть.

   1. На панели " **Дополнительные функции** " выберите **элементы ActiveX** , **Манифест общего элемента управления** и **область навигации** . Оставьте все остальное как есть. В **области навигации** мастер создаст панель слева от окна с `CMFCShellTreeCtrl` уже внедренным параметром.

   1. Мы не будем вносить изменения в область **созданные классы** , поэтому нажмите кнопку **Готово** , чтобы создать новый проект MFC.

::: moniker-end

::: moniker range="<=msvc-150"

### <a name="to-create-an-mfc-project-in-visual-studio-2017-or-earlier"></a>Создание проекта MFC в Visual Studio 2017 или более ранней версии

1. Используйте **Мастер приложений MFC** для создания нового приложения MFC. Чтобы запустить мастер, в меню **файл** выберите **создать** , а затем выберите **проект** . Откроется диалоговое окно **Новый проект** .

1. В диалоговом окне **Новый проект** разверните узел **Visual C++** на панели **типы проектов** и выберите **MFC** . Затем в области **шаблоны** выберите **приложение MFC** . Введите имя проекта, например, `MFCShellControls` и нажмите кнопку **ОК** .

   После отображения **мастера приложений MFC** используйте следующие параметры.

   1. В области **Тип приложения** в разделе **Тип приложения** снимите флажок документы с **вкладками** . Затем выберите **один документ** и выберите **Поддержка архитектуры документа/представления** . В разделе **стиль проекта** выберите **Visual Studio** , а затем в раскрывающемся списке **визуальный стиль и цвета** выберите **Office 2007 (синяя тема)** .

   1. На панели **Поддержка составных документов** выберите **нет** .

   1. Не вносите никаких изменений в панель **строк шаблона документа** .

   1. На панели **Поддержка базы данных** (Visual Studio 2015 и более ранние версии) выберите **нет** , так как приложение не использует базу данных.

   1. На панели **функции интерфейса пользователя** убедитесь, что выбран параметр **использовать строку меню и панель инструментов** . Оставьте все остальные параметры как есть.

   1. В области **Дополнительные функции** в разделе **Дополнительные возможности** выберите только **элементы управления ActiveX** и **Манифест общего элемента управления** . В разделе **Дополнительные области кадров** выберите только параметр **область навигации** . Это приведет к тому, что мастер создаст панель слева от окна с `CMFCShellTreeCtrl` уже внедренным.

   1. Мы не будем вносить изменения в область **созданные классы** , поэтому нажмите кнопку **Готово** , чтобы создать новый проект MFC.

::: moniker-end

Убедитесь, что приложение успешно создано путем его сборки и запуска. Чтобы выполнить сборку приложения, в меню **Сборка** выберите пункт **построить решение** . Если приложение успешно строится, запустите приложение, выбрав **начать отладку** в меню **Отладка** .

Мастер автоматически создает приложение со стандартной строкой меню, стандартной панелью инструментов, стандартной строкой состояния и панелью Outlook слева от окна с представлением **папок** и представлением **календаря** .

### <a name="to-add-the-shell-list-control-to-the-document-view"></a>Добавление элемента управления "список оболочек" в представление документа

1. В этом разделе вы добавите экземпляр `CMFCShellListCtrl` в представление, созданное мастером. Откройте файл заголовка представления, дважды щелкнув **мфкшеллконтролсвиев. h** в **Обозреватель решений** .

   Найдите `#pragma once` директиву, расположенную в верхней части файла заголовка. Непосредственно под ним добавьте следующий код, чтобы включить заголовочный файл `CMFCShellListCtrl` :

   ```cpp
   #include <afxShellListCtrl.h>
   ```

   Теперь добавьте переменную-член типа `CMFCShellListCtrl` . Сначала необходимо указать следующий комментарий в файле заголовка:

   ```cpp
   // Generated message map functions
   ```

   Непосредственно над этим комментарием добавьте следующий код:

   ```cpp
   private:
   CMFCShellListCtrl m_wndList;
   ```

1. **Мастер приложений MFC** уже создал `CMFCShellTreeCtrl` объект в `CMainFrame` классе, но является защищенным членом. Мы будем обращаться к объекту позже, поэтому создадим для него метод доступа. Откройте файл заголовка Маинфрм. h, дважды щелкнув его в **Обозреватель решений** . Откройте следующий комментарий:

   ```cpp
   // Attributes
   ```

   Непосредственно под ним добавьте следующее объявление метода:

   ```cpp
   public:
       CMFCShellTreeCtrl& GetShellTreeCtrl();
   ```

   Затем откройте исходный файл Маинфрм. cpp, дважды щелкнув его в **Обозреватель решений** . В нижней части этого файла добавьте следующее определение метода:

   ```cpp
   CMFCShellTreeCtrl& CMainFrame::GetShellTreeCtrl()
   {
        return m_wndTree;
   }
   ```

1. Теперь мы обновляем `CMFCShellControlsView` класс для обработки `WM_CREATE` сообщения Windows. Откройте окно **представление классов** и выберите `CMFCShellControlsView` класс. Щелкните правой кнопкой мыши и выберите **Свойства** .

   Затем в [мастере классов](reference/mfc-class-wizard.md)перейдите на вкладку **сообщения** . Прокрутите вниз, пока не найдете `WM_CREATE` сообщение. В раскрывающемся списке рядом с `WM_CREATE` выберите **\<Add> OnCreate** . Команда создает обработчик сообщений для нас и автоматически обновляет схему сообщений MFC.

   В `OnCreate` методе теперь создадим наш `CMFCShellListCtrl` объект. Найдите `OnCreate` Определение метода в исходном файле мфкшеллконтролсвиев. cpp и замените его реализацию следующим кодом:

    ```cpp
    int CMFCShellControlsView::OnCreate(LPCREATESTRUCT lpCreateStruct)
    {
        if (CView::OnCreate(lpCreateStruct) == -1)
            return -1;

        CRect rectDummy (0, 0, 0, 0);

        m_wndList.Create(WS_CHILD | WS_VISIBLE | LVS_REPORT,
            rectDummy, this, 1);

        return 0;
    }
    ```

1. Повторите предыдущий шаг, но для `WM_SIZE` сообщения. Это приведет к перерисовке представления приложений при изменении пользователем размера окна приложения. Замените определение `OnSize` метода следующим кодом:

    ```cpp
    void CMFCShellControlsView::OnSize(UINT nType, int cx, int cy)
    {
        CView::OnSize(nType, cx, cy);

        m_wndList.SetWindowPos(NULL, -1, -1, cx, cy,
            SWP_NOMOVE | SWP_NOZORDER | SWP_NOACTIVATE);
    }
    ```

1. Последним шагом является соединение `CMFCShellTreeCtrl` объектов и с `CMFCShellListCtrl` помощью метода [Кмфкшеллтриктрл:: сетрелатедлист](../mfc/reference/cmfcshelltreectrl-class.md#setrelatedlist) . После вызова `CMFCShellTreeCtrl::SetRelatedList` `CMFCShellListCtrl` компонент будет автоматически отображать содержимое элемента, выбранного в `CMFCShellTreeCtrl` . Мы подключим объекты в `OnActivateView` методе, который переопределен из [CView:: онактиватевиев](../mfc/reference/cview-class.md#onactivateview).

   В файле заголовка Мфкшеллконтролсвиев. h внутри `CMFCShellControlsView` объявления класса добавьте следующее объявление метода:

    ```cpp
    protected:
    virtual void OnActivateView(BOOL bActivate,
        CView* pActivateView,
        CView* pDeactiveView);
    ```

   Затем добавьте определение метода в исходный файл Мфкшеллконтролсвиев. cpp:

    ```cpp
    void CMFCShellControlsView::OnActivateView(BOOL bActivate,
        CView* pActivateView,
        CView* pDeactiveView)
    {
        if (bActivate&& AfxGetMainWnd() != NULL)
        {
            ((CMainFrame*)AfxGetMainWnd())->GetShellTreeCtrl().SetRelatedList(&m_wndList);
        }

        CView::OnActivateView(bActivate,
            pActivateView,
            pDeactiveView);
    }
    ```

   Поскольку мы вызываем методы из `CMainFrame` класса, мы должны добавить `#include` директиву в начало исходного файла мфкшеллконтролсвиев. cpp:

    ```cpp
    #include "MainFrm.h"
    ```

1. Убедитесь, что приложение успешно создано путем его сборки и запуска. Чтобы выполнить сборку приложения, в меню **Сборка** выберите пункт **построить решение** . Если приложение успешно строится, запустите его, выбрав **начать отладку** в меню **Отладка** .

   Теперь вы увидите сведения об элементе, выбранном на `CMFCShellTreeCtrl` панели Просмотр. Если щелкнуть узел в `CMFCShellTreeCtrl` , `CMFCShellListCtrl` будет автоматически обновлен. Аналогично, если дважды щелкнуть папку в `CMFCShellListCtrl` , то `CMFCShellTreeCtrl` следует автоматически обновить.

   Щелкните правой кнопкой мыши любой элемент в элементе управления "дерево" или в элементе управления "список". Вы получаете то же контекстное меню, что и при использовании реального **обозревателя файлов** .

## <a name="next-steps"></a>Дальнейшие действия

- Мастер создал панель Outlook с панелью **папок** и областью **календаря** . Возможно, в окне **обозревателя** не имеет смысла использовать область **календаря** , поэтому теперь удалите эту панель.

- `CMFCShellListCtrl`Поддерживает просмотр файлов в различных режимах, таких как **крупные значки** , **мелкие значки** , **список** и **сведения** . Обновите приложение, чтобы реализовать эту функцию. Указание. см. раздел [Visual C++ Samples](../overview/visual-cpp-samples.md).

## <a name="see-also"></a>См. также статью

[Пошаговые руководства](../mfc/walkthroughs-mfc.md)
