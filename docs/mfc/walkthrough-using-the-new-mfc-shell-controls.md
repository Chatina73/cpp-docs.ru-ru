---
title: Пошаговое руководство. Использование новых элементов управления оболочки MFC
ms.date: 04/25/2019
helpviewer_keywords:
- shell controls (MFC)
ms.assetid: f0015caa-199d-4aaf-9501-5a239fce9095
ms.openlocfilehash: 5786fbbf7ec9f31e7d895a96dae27b8fc95abda1
ms.sourcegitcommit: c123cc76bb2b6c5cde6f4c425ece420ac733bf70
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81360214"
---
# <a name="walkthrough-using-the-new-mfc-shell-controls"></a>Пошаговое руководство. Использование новых элементов управления оболочки MFC

В этом пошаговом шаге вы создадите приложение, напоминающее File Explorer. Вы создадите окно с двумя стеклами. Левая панель будет содержать объект [CMFCShellTreeCtrl,](../mfc/reference/cmfcshelltreectrl-class.md) который отображает ваш рабочий стол в иерархическом представлении. Правое стекло будет содержать [CMFCShellListCtrl,](../mfc/reference/cmfcshelllistctrl-class.md) который показывает файлы в папке, которая выбрана в левом стеку.

## <a name="prerequisites"></a>Предварительные требования

- В Visual Studio 2017 и позже поддержка MFC является дополнительным компонентом. Чтобы установить его, откройте Visual Studio Installer из меню Windows Start. Найдите используемую вами версию Visual Studio и выберите кнопку **«Изменить».** Убедитесь, что разработка рабочего стола с плиткой **C''** проверена. В **рамках дополнительных компонентов**проверьте кнопку **поддержки MFC.**

- Это пошаговое подело предполагает, что вы создали Visual Studio для использования **общих настроек разработки.** Если вы используете другую настройку разработки, некоторые окна Visual Studio, которые мы используем в этом пошаговом пошаге, могут быть не отображаться по умолчанию.

## <a name="to-create-a-new-mfc-application-by-using-the-mfc-application-wizard"></a>Создать новое приложение MFC с помощью MFC Application

Эти шаги варьируются в зависимости от того, какую версию Visual Studio вы используете. Чтобы просмотреть документацию для предпочтительной версии Visual Studio, используйте элемент управления селектора **версии.** Он находится в верхней части таблицы содержимого на этой странице.

::: moniker range="vs-2019"

### <a name="to-create-an-mfc-project-in-visual-studio-2019"></a>Создание проекта МФЦ в Visual Studio 2019

1. В главном меню выберите **Файл ** > **Создать ** > **Проект**, чтобы открыть диалоговое окно **Создание проекта**.

1. В поле поиска в верхней части, введите **MFC,** а затем выберите **MFC App** из списка результатов.

1. Нажмите кнопку **Далее**. На следующей странице введите имя проекта и при желании укажите местоположение проекта.

1. Нажмите кнопку **Создать**, чтобы создать проект.

   После отображения **MFC Application Wizard** используйте следующие параметры:

   1. Выберите **тип приложения** слева. Затем выберите **Единый документ** и выберите **поддержку архитектуры документа/просмотра.** В **стиле проекта**, выберите Visual **Studio**, и из **визуального стиля и цветов** падение вниз список выберите Office **2007 (Голубая тема)**.

   1. На панели **поддержки соединения документа** выберите **Нет**.

   1. Не внося никаких изменений в панель **шаблона документов.**

   1. На панели **функций пользовательского интерфейса** убедитесь, что **выбран бар меню и параметр панели инструментов.** Оставьте все другие варианты, как они есть.

   1. На **панели Расширенных функций** выберите **элементы управления ActiveX,** **Общий манифест управления**и опцию **навигационного панели.** Оставьте все остальное как есть. Опция **Navigation Pane** приведет к тому, что мастер создаст `CMFCShellTreeCtrl` стекол слева от окна с уже встроенным.

   1. Мы не собираемся вносить какие-либо изменения в панель **генерируемых классов,** поэтому нажмите **Finish,** чтобы создать свой новый проект MFC.

::: moniker-end

::: moniker range="<=vs-2017"

### <a name="to-create-an-mfc-project-in-visual-studio-2017-or-earlier"></a>Создание проекта MFC в Visual Studio 2017 или раньше

1. Используйте **приложение MFC Wizard** для создания нового приложения MFC. Для запуска мастера из меню **файла** выберите **новый,** а затем выберите **Project.** Будет отображаться диалоговая коробка **Нового проекта.**

1. В диалоговом окне **нового проекта** расширьте узлы **Visual C'в** панели **типов проектов** и выберите **MFC.** Затем, в панели **шаблонов,** выберите **приложение MFC**. Введите имя для проекта, например, `MFCShellControls` и нажмите **OK**.

   После отображения **MFC Application Wizard** используйте следующие параметры:

   1. На панели **типа приложения,** под **типом приложения,** очистите опцию **документов Tabbed.** Далее выберите **Единый документ** и выберите **поддержку архитектуры документа/просмотра.** В **стиле проекта**, выберите Visual **Studio**, и из **визуального стиля и цветов** падение вниз список выберите Office **2007 (Голубая тема)**.

   1. На панели **поддержки соединения документа** выберите **Нет**.

   1. Не внося никаких изменений в панель **шаблонов документов.**

   1. На панели **поддержки базы данных** (Visual Studio 2015 и старше) выберите **None,** поскольку приложение не использует базу данных.

   1. На панели **функций пользовательского интерфейса** убедитесь, что **выбран бар меню и параметр панели инструментов.** Оставьте все другие варианты, как они есть.

   1. На **панели Расширенные функции,** под **Расширенные функции,** выберите только **Элементы управления ActiveX** и **Общий манифест управления.** Под **Расширенные панели кадра**выберите только опцию **навигационного панели.** Это приведет к тому, что мастер создаст стекол слева от окна с уже встроенным. `CMFCShellTreeCtrl`

   1. Мы не собираемся вносить какие-либо изменения в панель **генерируемых классов,** поэтому нажмите **Finish,** чтобы создать свой новый проект MFC.

::: moniker-end

Убедитесь, что приложение было успешно создано путем его создания и запуска. Для создания приложения из меню **Build** выберите **решение Build**Solution. Если приложение успешно построено, запустите приложение, выбрав **Start Debugging** из меню **Debug.**

Мастер автоматически создает приложение со стандартной панелью меню, стандартной панелью инструментов, стандартной панелью состояния и баром Outlook слева от окна с представлением **Folders** и представлением **календаря.**

### <a name="to-add-the-shell-list-control-to-the-document-view"></a>Добавление элемента управления список оболочки в представление документа

1. В этом разделе вы добавите `CMFCShellListCtrl` экземпляр представления, созданного мастером. Откройте файл заголовка представления, нажав на **MFCShellControlsView.h** в **Solution Explorer.**

   Найдите `#pragma once` директиву в верхней части файла заголовка. Сразу же под ним добавить этот код, чтобы включить файл заголовка для: `CMFCShellListCtrl`

   ```cpp
   #include <afxShellListCtrl.h>
   ```

   Теперь добавьте переменную члена типа `CMFCShellListCtrl`. Во-первых, найти следующий комментарий в файле заголовка:

   ```cpp
   // Generated message map functions
   ```

   Сразу же выше этого комментария, добавьте этот код:

   ```cpp
   private:
   CMFCShellListCtrl m_wndList;
   ```

1. Мастер `CMFCShellTreeCtrl` **приложений MFC** уже создал `CMainFrame` объект в классе, но он защищен. Мы получим доступ к объекту позже, так что создайте аксессуар для него сейчас. Откройте файл заголовка MainFrm.h, дважды нажав его в **Solution Explorer.** Найдите следующий комментарий:

   ```cpp
   // Attributes
   ```

   Сразу же под ним добавьте следующее заявление метода:

   ```cpp
   public:
       CMFCShellTreeCtrl& GetShellTreeCtrl();
   ```

   Затем откройте исходный файл MainFrm.cpp, дважды нажав его в **Solution Explorer.** В нижней части этого файла добавьте следующее определение метода:

   ```cpp
   CMFCShellTreeCtrl& CMainFrame::GetShellTreeCtrl()
   {
        return m_wndTree;
   }
   ```

1. Теперь мы `CMFCShellControlsView` обновляем `WM_CREATE` класс для обработки сообщения windows. Откройте окно **просмотра** класса `CMFCShellControlsView` и выберите класс. Щелкните правой кнопкой мыши и выберите **Свойства**.

   Далее, в [классе Мастера,](reference/mfc-class-wizard.md)нажмите на `WM_CREATE` вкладку **Сообщения.** Прокрутите вниз, пока не найдете сообщение. Из списка выпадающих `WM_CREATE`рядом с, ** \<выберите Добавить> OnCreate.** Команда создает обработчик сообщений для нас и автоматически обновляет карту сообщений MFC.

   В `OnCreate` методе мы создадим `CMFCShellListCtrl` наш объект. Найдите `OnCreate` определение метода в исходном файле MFCShellControlsView.cpp и замените его реализацию следующим кодом:

    ```cpp
    int CMFCShellControlsView::OnCreate(LPCREATESTRUCT lpCreateStruct)
    {
        if (CView::OnCreate(lpCreateStruct) == -1)
            return -1;

        CRect rectDummy (0, 0, 0, 0);

        m_wndList.Create(WS_CHILD | WS_VISIBLE | LVS_REPORT,
            rectDummy, this, 1);

        return 0;
    }
    ```

1. Повторите предыдущий шаг, но для `WM_SIZE` сообщения. Это приведет к перерисовке представления приложений всякий раз, когда пользователь изменяет размер окна приложения. Замените определение `OnSize` метода следующим кодом:

    ```cpp
    void CMFCShellControlsView::OnSize(UINT nType, int cx, int cy)
    {
        CView::OnSize(nType, cx, cy);

        m_wndList.SetWindowPos(NULL, -1, -1, cx, cy,
            SWP_NOMOVE | SWP_NOZORDER | SWP_NOACTIVATE);
    }
    ```

1. Последним шагом является подключение `CMFCShellTreeCtrl` `CMFCShellListCtrl` объектов с помощью метода [CMFCShellTreeCtrl::SetRelatedList.](../mfc/reference/cmfcshelltreectrl-class.md#setrelatedlist) После вызова `CMFCShellTreeCtrl::SetRelatedList` `CMFCShellListCtrl` будет автоматически отображать содержимое элемента, `CMFCShellTreeCtrl`выбранного в . Мы соединяем `OnActivateView` объекты в методе, который переопределяется из [CView::OnActivateView](../mfc/reference/cview-class.md#onactivateview).

   В файле заголовка MFCShellControlsView.h `CMFCShellControlsView` в декларации класса добавьте следующее заявление метода:

    ```cpp
    protected:
    virtual void OnActivateView(BOOL bActivate,
        CView* pActivateView,
        CView* pDeactiveView);
    ```

   Затем добавьте определение метода в исходный файл MFCShellControlsView.cpp:

    ```cpp
    void CMFCShellControlsView::OnActivateView(BOOL bActivate,
        CView* pActivateView,
        CView* pDeactiveView)
    {
        if (bActivate&& AfxGetMainWnd() != NULL)
        {
            ((CMainFrame*)AfxGetMainWnd())->GetShellTreeCtrl().SetRelatedList(&m_wndList);
        }

        CView::OnActivateView(bActivate,
            pActivateView,
            pDeactiveView);
    }
    ```

   Поскольку мы вызываем методы из `CMainFrame` класса, `#include` мы должны добавить директиву в верхней части исходного файла MFCShellControlsView.cpp:

    ```cpp
    #include "MainFrm.h"
    ```

1. Убедитесь, что приложение было успешно создано путем его создания и запуска. Для создания приложения из меню **Build** выберите **решение Build**Solution. Если приложение успешно построено, запустите его, выбрав **Start Debugging** из меню **Debug.**

   Теперь вы должны видеть детали для элемента, выбранного `CMFCShellTreeCtrl` в панели представления. При нажатии узла `CMFCShellTreeCtrl`в `CMFCShellListCtrl` , будет автоматически обновляться. Аналогичным образом, если вы дважды щелкните папку в `CMFCShellListCtrl`, `CMFCShellTreeCtrl` должны быть автоматически обновлены.

   Нажмите правой кнопкой любой элемент в управлении дерева или в управлении списком. Вы получаете то же меню контекста, как если бы вы использовали реальный **исследователь файлов.**

## <a name="next-steps"></a>Дальнейшие действия

- Мастер создал панель Outlook с панелью **Folders** и панелью **календаря.** Это, вероятно, не имеет смысла иметь **панель календаря** в окне **Explorer,** так что удалите, что панель сейчас.

- Поддерживает `CMFCShellListCtrl` просмотр файлов в различных режимах, таких как **большие значки,** **малые значки,** **список**и **детали.** Обновите приложение для реализации этой функциональности. Подсказка: [см.](../overview/visual-cpp-samples.md)

## <a name="see-also"></a>См. также раздел

[Пошаговые руководства](../mfc/walkthroughs-mfc.md)
