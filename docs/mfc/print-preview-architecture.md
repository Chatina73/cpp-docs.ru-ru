---
title: Архитектура предварительного просмотра
ms.date: 11/04/2016
helpviewer_keywords:
- print preview [MFC], process
- previewing printing
- print preview [MFC], architecture
- printing [MFC], print preview
- print preview [MFC], modifications to MFC
ms.assetid: 0efc87e6-ff8d-43c5-9d72-9b729a169115
ms.openlocfilehash: 5943edc22cd48ed10d152f72624467ff87104b96
ms.sourcegitcommit: c123cc76bb2b6c5cde6f4c425ece420ac733bf70
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81375949"
---
# <a name="print-preview-architecture"></a>Архитектура предварительного просмотра

В этой статье объясняется, как платформа MFC реализует функциональность предварительного просмотра печати. Здесь рассматриваются такие темы:

- [Процесс предварительного просмотра печати](#_core_the_print_preview_process)

- [Изменение предварительного просмотра печати](#_core_modifying_print_preview)

Предварительный просмотр печати несколько отличается от дисплея экрана и печати, потому что вместо того, чтобы непосредственно рисовать изображение на устройстве, приложение должно имитировать принтер с помощью экрана. Для этого библиотека класса Фонда Майкрософт определяет специальный (недокументированный) `CPreviewDC`класс, полученный из [класса CDC,](../mfc/reference/cdc-class.md)под названием . Все `CDC` объекты содержат два контекста устройства, но обычно они идентичны. В `CPreviewDC` объекте они различны: первый представляет смоделированный принтер, а второй — экран, на котором фактически отображается выход.

## <a name="the-print-preview-process"></a><a name="_core_the_print_preview_process"></a>Процесс предварительного просмотра печати

Когда пользователь выбирает команду Print Preview из меню **файла,** фреймворк `CPreviewDC` создает объект. Всякий раз, когда приложение выполняет операцию, которая устанавливает характеристику контекста устройства принтера, фреймворк также выполняет аналогичную операцию на контексте экрана устройства. Например, если приложение выбирает шрифт для печати, фреймворк выбирает шрифт для отображения экрана, имитирующего шрифт принтера. Всякий раз, когда приложение отправляет выход на принтер, платформа вместо этого отправляет вывод на экран.

Предварительный просмотр печати также отличается от печати в порядке, что каждый рисует страницы документа. Во время печати фреймворк продолжает цикл печати до тех пор, пока не будет отображаться определенный диапазон страниц. Во время предварительного просмотра печати одна или две страницы отображаются в любое время, после чего приложение ждет; никакие дополнительные страницы не отображаются до тех пор, пока пользователь не ответит. Во время предварительного просмотра печати приложение также должно отвечать на сообщения WM_PAINT, как и во время обычного отображения экрана.

Функция [CView::OnPreparePrinting](../mfc/reference/cview-class.md#onprepareprinting) вызывается при вызове режима предварительного просмотра, как и в начале задания печати. [Структура структуры CPrintInfo,](../mfc/reference/cprintinfo-structure.md) переданная функции, содержит несколько членов, значения которых можно установить для настройки определенных характеристик операции предварительного просмотра печати. Например, можно настроить *m_nNumPreviewPages* члену, чтобы указать, хотите ли вы просмотреть документ в одностраничном или двухстраничном режиме.

## <a name="modifying-print-preview"></a><a name="_core_modifying_print_preview"></a>Изменение предварительного просмотра печати

Вы можете изменить поведение и внешний вид предварительного просмотра печати в ряде способов довольно легко. Например, можно, среди прочего:

- Причина окна предварительного просмотра печати для отображения панели прокрутки для легкого доступа к любой странице документа.

- Причина предварительного просмотра печати для поддержания позиции пользователя в документе, начав его отображение на текущей странице.

- Причина различной инициализации, которая должна быть выполнена для предварительного просмотра и печати печати.

- Причина предварительного просмотра печати для отображения номеров страниц в собственных форматах.

Если вы знаете, как долго `SetMaxPage` находится документ и звоните с соответствующим значением, фреймворк может использовать эту информацию как в режиме предварительного просмотра, так и во время печати. После того, как фреймворк узнает длину документа, он может предоставить окну предварительного просмотра с баром прокрутки, что позволяет пользователю переходить туда-сюда через документ в режиме предварительного просмотра. Если длина документа еще не установлена, фреймворк не может расположить поле прокрутки для указания текущего положения, поэтому фреймворк не добавляет бар прокрутки. В этом случае пользователь должен использовать кнопки «Следующая страница» и «Предыдущая страница» в панели управления окна предварительного просмотра для просмотра документа.

Для предварительного просмотра печати, вы можете найти полезным присвоить значение *для m_nCurPage* член `CPrintInfo`, даже если вы никогда не будете делать это для обычной печати. Во время обычной печати этот участник переносит информацию из фреймворка в класс представления. Таким образом фреймворк сообщает представление, какая страница должна быть напечатана.

В отличие от этого, при начале запуска режима предварительного просмотра, *m_nCurPage* член несет информацию в противоположном направлении: от представления к инфраструктуре. Платформа использует значение этого участника, чтобы определить, какая страница должна быть предварительно просмотрена в первую очередь. Значение этого участника по умолчанию составляет 1, поэтому первая страница документа отображается изначально. Можно переопределить, `OnPreparePrinting` чтобы установить этот участник на номер страницы, просматриваемый во время вызова команды Предварительного просмотра. Таким образом, приложение поддерживает текущее положение пользователя при переходе из режима обычного дисплея в режим предварительного просмотра печати.

Иногда вы `OnPreparePrinting` можете выполнить различные инициализации в зависимости от того, он называется для печати работу или для печати предварительного просмотра. Это можно определить, *m_bPreview* изучив `CPrintInfo` переменную m_bPreview в структуре. Этот участник настроен на **истину** при вызове предварительного просмотра печати.

Структура `CPrintInfo` также содержит члена по имени *m_strPageDesc*, который используется для форматирования строк, отображаемых в нижней части экрана в одностраничных и многостраничных режимах. По умолчанию эти строки имеют форму "Page *n* -  *n"* и "Страницы n `OnPreparePrinting` *m",* но вы можете изменить *m_strPageDesc* изнутри и установить строки на что-то более сложное. Подробнее о [структуре CPrintInfo](../mfc/reference/cprintinfo-structure.md) читайте в *справке МФЦ.*

## <a name="see-also"></a>См. также раздел

[Печать и предварительный просмотр печати](../mfc/printing-and-print-preview.md)<br/>
[Печати](../mfc/printing.md)<br/>
[Класс CView](../mfc/reference/cview-class.md)<br/>
[Класс CDC](../mfc/reference/cdc-class.md)
