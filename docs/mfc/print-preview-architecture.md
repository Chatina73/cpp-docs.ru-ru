---
title: Архитектура предварительного просмотра
ms.date: 11/04/2016
helpviewer_keywords:
- print preview [MFC], process
- previewing printing
- print preview [MFC], architecture
- printing [MFC], print preview
- print preview [MFC], modifications to MFC
ms.assetid: 0efc87e6-ff8d-43c5-9d72-9b729a169115
ms.openlocfilehash: ea80b67b3f6bb6980e4e8f7f12a967cb7bb5b6c7
ms.sourcegitcommit: 0ab61bc3d2b6cfbd52a16c6ab2b97a8ea1864f12
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "62218733"
---
# <a name="print-preview-architecture"></a>Архитектура предварительного просмотра

В этой статье объясняется, как платформа MFC реализует функции предварительного просмотра. Рассмотрены следующие темы.

- [Процесс предварительного просмотра](#_core_the_print_preview_process)

- [Изменение предварительного просмотра](#_core_modifying_print_preview)

Предварительного несколько отличается от экрана просмотра и печати, поскольку вместо непосредственно рисование изображения на устройстве, приложение должно имитировать принтер, на экране. Для борьбы с этой библиотеки Microsoft Foundation Class определяет специальный (недокументированные) класса, производного от [класс CDC](../mfc/reference/cdc-class.md), который называется `CPreviewDC`. Все `CDC` объекты содержат два контекста устройства, но обычно они идентичны. В `CPreviewDC` объекта, они отличаются: первый представляет симулируемых принтер, а второй экран, на котором отображаются выходные данные.

##  <a name="_core_the_print_preview_process"></a> Процесс предварительного просмотра

Когда пользователь выбирает команду Предварительный просмотр печати из **файл** меню, платформа создает `CPreviewDC` объекта. Каждый раз, когда приложение выполняет операцию, которая задает характеристикой контекст устройства принтера, данная структура выполняет похожую операцию в контексте экрана устройства. Например если приложение выбирает шрифт для печати, framework выбирает шрифт для отображения на экране, которое имитирует шрифт принтера. Каждый раз, когда приложение следует отправить выходные данные на принтер, платформа вместо этого отправляет выходные данные на экран.

Режим предварительного просмотра также отличается от печати, в том порядке, что каждый рисует страницы документа. Во время печати, платформа продолжает цикл печати, пока не будет подготовлен к просмотру определенный диапазон страниц. Во время предварительного просмотра одна или две страницы отображаются в любое время, а затем ждет приложения; Дальнейшие страницы не отображаются, пока пользователь не ответит. Во время предварительного просмотра приложения должен также отвечать на сообщения WM_PAINT так же, как во время обычного дисплеем.

[CView::OnPreparePrinting](../mfc/reference/cview-class.md#onprepareprinting) функция вызывается при вызове режим предварительного просмотра, так же, как он находится в начале задания печати. [Структура CPrintInfo](../mfc/reference/cprintinfo-structure.md) структура, переданная функции содержит несколько членов, значения которых можно задать для настройки определенных характеристик операции предварительного просмотра печати. Например, можно задать *m_nNumPreviewPages* члена, чтобы указать, следует ли Предварительный просмотр в режиме на одной странице или две страницы.

##  <a name="_core_modifying_print_preview"></a> Изменение предварительного просмотра

Можно изменить поведение и внешний вид предварительного просмотра в ряд способов довольно легко. Например можно, помимо прочего:

- Вызвать окна предварительного просмотра, чтобы отобразить полосу прокрутки для упрощения доступа к любой из страниц документа.

- Причина предварительного поддерживать положение пользователя в документе с начала его отображение на текущей странице.

- Вызывает другой инициализацию, которую необходимо выполнить для предварительного просмотра и печати.

- Вызвать предварительного просмотра отобразить номера страниц в собственных форматах.

Если вы знаете, как долго действует документ и вызвать `SetMaxPage` соответствующим значением, платформа может использовать эту информацию в режиме предварительного просмотра, а также во время печати. Когда платформа известна длина документа, его можно предоставить окно предварительного просмотра полосы, позволяя пользователю просматривать документ в режиме предварительного просмотра страницы и обратно. Если вы не задали длину документа, платформа не удается разместить полосы прокрутки для указания текущей позиции, поэтому платформа не добавляет полосу прокрутки. В этом случае пользователь должен использовать следующей странице и кнопки предыдущей страницы на панели окна предварительного просмотра элемента управления на страницу по документу.

Для предварительного просмотра печати, могут оказаться полезными для присвоения значения для *m_nCurPage* членом `CPrintInfo`, несмотря на то, что никогда не нужно для обычных печати. При обычных печати, этот член несет информацию из .NET framework в классе представления. Это, как платформа указывает представлению какие страницы следует печатать.

Напротив, при запуске режима просмотра печати *m_nCurPage* член содержит конфиденциальную информацию в обратном направлении: в представлении для платформы. Инфраструктура использует значение этого члена, чтобы определить, какую страницу следует сначала просмотреть. Значение этого члена по умолчанию-1, поэтому сначала отображается первой страницы документа. Можно переопределить `OnPreparePrinting` присвоить этот член номер страницы, во время была вызвана команда предварительного просмотра. Таким образом, приложение сохраняет сведения о текущей позиции пользователя при переходе из режима отображения обычного режима предварительного просмотра.

Иногда может возникнуть `OnPreparePrinting` для выполнения различных инициализации в зависимости от того, является ли он вызывается для задания печати или для предварительного просмотра печати. Это можно определить с помощью проверки *m_bPreview* переменную-член в `CPrintInfo` структуры. Этот член имеет значение **TRUE** при вызове предварительного просмотра печати.

`CPrintInfo` Структура также содержит элемент с именем *m_strPageDesc*, который используется для форматирования строк, отображаемых в нижней части экрана в одно- и многостраничных режимах. По умолчанию эти строки имеют следующий вид «страница *n*"и «страниц *n* - *m*,», но вы можете изменить *m_strPageDesc* из в рамках `OnPreparePrinting` и установка на нечто более замысловатое строк. См. в разделе [структура CPrintInfo](../mfc/reference/cprintinfo-structure.md) в *Справочник по библиотеке MFC* Дополнительные сведения.

## <a name="see-also"></a>См. также

[Печать и предварительный просмотр печати](../mfc/printing-and-print-preview.md)<br/>
[Печать](../mfc/printing.md)<br/>
[Класс CView](../mfc/reference/cview-class.md)<br/>
[Класс CDC](../mfc/reference/cdc-class.md)
