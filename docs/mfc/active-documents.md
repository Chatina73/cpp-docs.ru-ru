---
title: Активные документы
ms.date: 11/04/2016
helpviewer_keywords:
- active documents [MFC]
- active documents [MFC], requirements
- view objects [MFC], requirements
- OLE [MFC], active documents
- views [MFC], active documents
- active documents [MFC], views
ms.assetid: 1378f18e-aaa6-420b-8501-4b974905baa0
ms.openlocfilehash: cbea3e032932477006820c5a71fbbf3e40123bdf
ms.sourcegitcommit: c123cc76bb2b6c5cde6f4c425ece420ac733bf70
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81322074"
---
# <a name="active-documents"></a>Активные документы

Активные документы расширяют комплексную технологию документооборота OLE. Эти расширения предоставляются в виде дополнительных интерфейсов, которые управляют представлениями, так что объекты могут функционировать в контейнерах и при этом сохранять контроль над их функциями отображения и печати. Этот процесс позволяет отображать документы как в зарубежных кадрах (например, в Microsoft Office Binder или Microsoft Internet Explorer), так и в нативных кадрах (например, в портах собственного представления продукта).

В этом разделе описаны функциональные [требования к активным документам.](#requirements_for_active_documents) Активный документ владеет набором данных и имеет доступ к хранилищам, где данные могут быть сохранены и извлечены. Он может создавать и управлять одним или несколько представлениями на своих данных. В дополнение к поддержке обычных встраивания и на месте интерфейсов активации документов OLE, активный документ передает свою способность создавать представления через `IOleDocument`. С помощью этого интерфейса контейнер может попросить создать (и, возможно, перечислить) представления, которые может отображать активный документ. С помощью этого интерфейса активный документ может также предоставлять различную информацию о себе, например, поддерживает ли он несколько представлений или сложные прямоугольники.

Ниже приводится `IOleDocument` интерфейс. Обратите внимание, что `IEnumOleDocumentViews` интерфейс является стандартным `IOleDocumentView*` регистратором OLE для типов.

```
interface IOleDocument : IUnknown
    {
    HRESULT CreateView(
        [in] IOleInPlaceSite *pIPSite,
        [in] IStream *pstm,
        [in] DWORD dwReserved,
        [out] IOleDocumentView **ppView);

    HRESULT GetDocMiscStatus([out] DWORD *pdwStatus);

    HRESULT EnumViews(
        [out] IEnumOleDocumentViews **ppEnum,
        [out] IOleDocumentView **ppView);
    }
```

Каждый активный документ должен иметь поставщика кадров представления с этим интерфейсом. Если документ не встроен в контейнер, сам сервер активного документа должен предоставить рамку представления. Однако, когда активный документ встроен в активный контейнер документов, контейнер предоставляет рамку представления.

Активный документ может создавать один или несколько типов [представлений](#requirements_for_view_objects) своих данных (например, нормальный, контур, макет страницы и так далее). Представления действуют как фильтры, с помощью которых можно увидеть данные. Даже если документ имеет только один тип представления, вы все равно можете поддерживать несколько представлений в качестве средства поддержки новой функциональности окна (например, элемент **«Новое окно»** в меню **«Окно»** в приложениях Office).

## <a name="requirements-for-active-documents"></a><a name="requirements_for_active_documents"></a>Требования к активным документам

Активный документ, который может отображаться в активном контейнере документов, должен:

- Используйте compound Files OLE в качестве `IPersistStorage`механизма хранения путем реализации.

- Поддержка основных функций встраивания документов OLE, включая **Создание из файла.** Это требует интерфейсов `IPersistFile`, `IOleObject`и `IDataObject`.

- Поддержка одного или нескольких представлений, каждый из которых способен на месте активации. То есть, представления должны `IOleDocumentView` поддерживать интерфейс, а `IOleInPlaceObject` `IOleInPlaceActiveObject` также интерфейсы и `IOleInPlaceSite` `IOleInPlaceFrame` (с использованием контейнера и интерфейсов).

- Поддержка стандартных активных `IOleDocument` `IOleCommandTarget`интерфейсов `IPrint`документов, и .

Знание о том, когда и как использовать интерфейсы контейнерной стороны, подразумевается в этих требованиях.

## <a name="requirements-for-view-objects"></a><a name="requirements_for_view_objects"></a>Требования к объектам просмотра

Активный документ может создавать одно или несколько представлений своих данных. Функционально эти представления подобны портам на определенный метод отображения данных. Если активный документ поддерживает только одно представление, активный документ и единое представление могут быть реализованы с помощью одного класса. `IOleDocument::CreateView`возвращает указатель интерфейса `IOleDocumentView` того же объекта.

Чтобы быть представленным в активном контейнере `IOleInPlaceObject` документов, компонент представления должен поддерживать и `IOleInPlaceActiveObject` в дополнение к: `IOleDocumentView`

```
interface IOleDocumentView : IUnknown
    {
    HRESULT SetInPlaceSite([in] IOleInPlaceSite *pIPSite);
    HRESULT GetInPlaceSite([out] IOleInPlaceSite **ppIPSite);
    HRESULT GetDocument([out] IUnknown **ppunk);
    [input_sync] HRESULT SetRect([in] LPRECT prcView);
    HRESULT GetRect([in] LPRECT prcView);
    [input_sync] HRESULT SetRectComplex(
        [in] LPRECT prcView,
        [in] LPRECT prcHScroll,
        [in] LPRECT prcVScroll,
        [in] LPRECT prcSizeBox);
    HRESULT Show([in] BOOL fShow);
    HRESULT UIActivate([in] BOOL fUIActivate);
    HRESULT Open(void);
    HRESULT CloseView([in] DWORD dwReserved);
    HRESULT SaveViewState([in] IStream *pstm);
    HRESULT ApplyViewState([in] IStream *pstm);
    HRESULT Clone(
        [in] IOleInPlaceSite *pIPSiteNew,
        [out] IOleDocumentView **ppViewNew);
    }
```

Каждое представление имеет связанный сайт представления, который инкапсулирует рамку представления и порт представления (HWND и прямоугольная область в этом окне). Сайт предоставляет эту функциональность, `IOleInPlaceSite` хотя стандартный интерфейс. Обратите внимание, что на одном HWND можно иметь более одного порта представления.

Как правило, каждый тип представления имеет различное печатное представление. Таким образом, представления и соответствующие сайты `IPrint` `IContinueCallback`представления должны реализовать интерфейсы печати, если и, соответственно. Рамка представления должна вести переговоры с поставщиком представления через `IPrint` момент начала печати, так что заголовки, колонтитулы, поля и связанные с ними элементы печатаются правильно. Поставщик представления уведомляет кадр связанных `IContinueCallback`с печатью событий через . Для получения дополнительной информации об использовании этих интерфейсов, [см.](../mfc/programmatic-printing.md)

Обратите внимание, что если активный документ поддерживает только одно представление, то активный документ и единое представление могут быть реализованы с помощью одного конкретного класса. `IOleDocument::CreateView`просто возвращает указатель `IOleDocumentView` интерфейса того же объекта. Короче говоря, нет необходимости в том, чтобы при необходимости существовало два отдельных случая объекта.

Объект представления также может быть командной целью. При реализации `IOleCommandTarget` представления можно получить команды, которые исходят из пользовательского интерфейса контейнера (например, **Новый,** **Открытый,** **Сохранить Как**, **Печать** в меню **файла;** и **Копия**, **Вставить**, **Отменить** в меню **edit).** Для получения дополнительной информации [см.](../mfc/message-handling-and-command-targets.md)

## <a name="see-also"></a>См. также раздел

[Вложение активного документа](../mfc/active-document-containment.md)
