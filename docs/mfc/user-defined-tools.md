---
description: 'Дополнительные сведения: определяемые пользователем средства'
title: Инструменты, определяемые пользователем
ms.date: 11/19/2018
helpviewer_keywords:
- user-defined tools (MFC Extensions)
ms.assetid: cb887421-78ce-4652-bc67-96a53984ccaa
ms.openlocfilehash: 4cccd0a68751a2f196c8c2e652088e8939e3f162
ms.sourcegitcommit: d6af41e42699628c3e2e6063ec7b03931a49a098
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2020
ms.locfileid: "97263638"
---
# <a name="user-defined-tools"></a>Инструменты, определяемые пользователем

MFC поддерживает пользовательские средства. Определяемое пользователем средство — это специальная команда, выполняющая внешнюю, определяемую пользователем программу. Процесс настройки можно использовать для управления пользовательскими инструментами. Однако этот процесс нельзя использовать, если объект приложения не является производным от [класса CWinAppEx](../mfc/reference/cwinappex-class.md). Дополнительные сведения о настройке см. в разделе [Настройка MFC](../mfc/customization-for-mfc.md).

Если включена поддержка пользовательских средств, диалоговое окно настройки автоматически включает вкладку **средства** . На следующем рисунке показана страница **средств** .

![Вкладка "Сервис" в диалоговом окне настройки](../mfc/media/custdialogboxtoolstab.png "Вкладка "Сервис" в диалоговом окне настройки") <br/>
Вкладка "средства" диалогового окна настройки

## <a name="enabling-user-defined-tools-support"></a>Включение поддержки определяемых пользователем средств

Чтобы включить пользовательские средства в приложении, вызовите [CWinAppEx:: енаблеусертулс](../mfc/reference/cwinappex-class.md#enableusertools). Однако сначала необходимо определить несколько констант в файлах ресурсов приложения, чтобы использовать их в качестве параметров для этого вызова.

В редакторе ресурсов создайте фиктивную команду, которая использует соответствующий идентификатор команды. В следующем примере мы используем в `ID_TOOLS_ENTRY` качестве идентификатора команды. Этот идентификатор команды помечает расположение в одном или нескольких меню, в которое платформа будет вставлять определяемые пользователем средства.

Необходимо отложить несколько последовательных идентификаторов в таблице строк для представления определяемых пользователем средств. Количество заданных строк равно максимальному числу пользовательских инструментов, которые могут быть определены пользователями. В следующем примере они именуются с `ID_USER_TOOL1` помощью `ID_USER_TOOL10` .

Вы можете предложить пользователям предлагать пользователю выбрать каталоги и аргументы для внешних программ, которые будут вызываться как средства. Для этого создайте два всплывающих меню в редакторе ресурсов. В следующем примере используются имена `IDR_MENU_ARGS` и `IDR_MENU_DIRS` . Для каждой команды в этих меню определите строку в таблице строк приложения. Идентификатор ресурса строки должен быть равен ИДЕНТИФИКАТОРу команды.

Можно также создать производный класс из [класса кусертул](../mfc/reference/cusertool-class.md) , чтобы заменить реализацию по умолчанию. Для этого передайте сведения о среде выполнения для производного класса в качестве четвертого параметра в CWinAppEx:: Енаблеусертулс, а не RUNTIME_CLASS ([класс кусертул](../mfc/reference/cusertool-class.md)).

Определив соответствующие константы, вызовите [CWinAppEx:: енаблеусертулс](../mfc/reference/cwinappex-class.md#enableusertools) , чтобы включить пользовательские средства.

Следующий вызов метода показывает, как использовать эти константы:

[!code-cpp[NVC_MFC_VisualStudioDemo#1](../mfc/codesnippet/cpp/user-defined-tools_1.cpp)]

В этом примере вкладка «средства» будет включена в диалоговое окно **Настройка** . Платформа заменит любую команду, которая соответствует ИДЕНТИФИКАТОРу команды, `ID_TOOLS_ENTRY` в любом меню с набором определенных пользовательских средств, каждый раз, когда пользователь открывает это меню. Идентификаторы команд `ID_USER_TOOL1` в `ID_USER_TOOL10` зарезервированы для использования в пользовательских средствах. Класс [кусертул](../mfc/reference/cusertool-class.md) класса обрабатывает вызовы к пользовательским инструментам. Вкладка Средство диалогового окна **Настройка** содержит кнопки справа от полей "аргумент" и "запись каталога" для доступа к меню **IDR_MENU_ARGS** и **IDR_MENU_DIRS**. Когда пользователь выбирает команду из одного из этих меню, платформа добавляет к соответствующему текстовому полю строку с ИДЕНТИФИКАТОРом ресурса, равным ИДЕНТИФИКАТОРу команды.

### <a name="including-predefined-tools"></a>Включая предопределенные средства

Если необходимо определить некоторые средства при запуске приложения, необходимо переопределить метод [CFrameWnd:: лоадфраме](../mfc/reference/cframewnd-class.md#loadframe) главного окна приложения. В этом методе необходимо выполнить следующие действия.

##### <a name="to-add-new-tools-in-loadframe"></a>Добавление новых средств в Лоадфраме

1. Получите указатель на объект [класса кусертулсманажер](../mfc/reference/cusertoolsmanager-class.md) , вызвав [CWinAppEx:: жетусертулсманажер](../mfc/reference/cwinappex-class.md#getusertoolsmanager).

1. Для каждого создаваемого инструмента вызовите [кусертулсманажер:: креатеневтул](../mfc/reference/cusertoolsmanager-class.md#createnewtool). Этот метод возвращает указатель на объект [класса кусертул](../mfc/reference/cusertool-class.md) и добавляет вновь созданное средство пользователя во внутреннюю коллекцию средств. Если вы указали сведения среды выполнения для производного класса [класса кусертул](../mfc/reference/cusertool-class.md) в качестве четвертого параметра [CWinAppEx:: енаблеусертулс](../mfc/reference/cwinappex-class.md#enableusertools), [кусертулсманажер:: креатеневтул](../mfc/reference/cusertoolsmanager-class.md#createnewtool) будет создавать экземпляр этого класса и возвращать его.

1. Для каждого средства задайте его текстовую метку, задав `CUserTool::m_strLabel` и задав его команду, вызвав `CUserTool::SetCommand` . Реализация [класса кусертул](../mfc/reference/cusertool-class.md) по умолчанию автоматически получает доступные значки из программы, указанной в вызове `SetCommand` .

## <a name="see-also"></a>См. также раздел

[Настройка для MFC](../mfc/customization-for-mfc.md)<br/>
[Класс Кусертул](../mfc/reference/cusertool-class.md)<br/>
[Класс Кусертулсманажер](../mfc/reference/cusertoolsmanager-class.md)<br/>
[Класс CWinAppEx](../mfc/reference/cwinappex-class.md)
