---
title: Элементы управления ActiveX в MFC. Сериализация
ms.date: 09/12/2018
f1_keywords:
- _wVerMinor
- DoPropExchange
- _wVerMajor
helpviewer_keywords:
- MFC ActiveX controls [MFC], version support
- wVerMinor global constant [MFC]
- GetVersion method [MFC]
- ExchangeVersion method [MFC]
- MFC ActiveX controls [MFC], serializing
- DoPropExchange method [MFC]
- versioning ActiveX controls
- wVerMajor global constant
ms.assetid: 9d57c290-dd8c-4853-b552-6f17f15ebedd
ms.openlocfilehash: f5e3b4bdf203f90b3550a2521ba51ba451cf3a46
ms.sourcegitcommit: 1f009ab0f2cc4a177f2d1353d5a38f164612bdb1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/27/2020
ms.locfileid: "87225024"
---
# <a name="mfc-activex-controls-serializing"></a>Элементы управления ActiveX в MFC. Сериализация

В этой статье описывается сериализация элемента управления ActiveX. Сериализация — это процесс чтения или записи на постоянном носителе хранилища, например файл на диске. Библиотека Microsoft Foundation Class (MFC) предоставляет встроенную поддержку сериализации в классе `CObject` . `COleControl`расширяет эту поддержку элементами управления ActiveX с помощью механизма обмена свойствами.

>[!IMPORTANT]
> ActiveX — это устаревшая технология, которую не следует использовать для новой разработки. Дополнительные сведения о современных технологиях, которые заменяют ActiveX, см. в разделе [элементы управления ActiveX](activex-controls.md).

Сериализация для элементов управления ActiveX реализуется путем переопределения [COleControl::D опропексчанже](reference/colecontrol-class.md#dopropexchange). Эта функция, вызываемая во время загрузки и сохранения объекта элемента управления, сохраняет все свойства, реализованные с помощью переменной-члена или переменной-члена с уведомлением об изменении.

В следующих разделах рассматриваются основные проблемы сериализации элемента управления ActiveX.

- Реализация `DoPropExchange` функции для сериализации управляющего объекта

- [Настройка процесса сериализации](#_core_customizing_the_default_behavior_of_dopropexchange)

- [Реализация поддержки версий](#_core_implementing_version_support)

## <a name="implementing-the-dopropexchange-function"></a><a name="_core_implementing_the_dopropexchange_function"></a>Реализация функции DoPropExchange

При использовании мастера элементов управления ActiveX для создания проекта элемента управления в класс Control автоматически добавляется несколько функций обработчика по умолчанию, включая реализацию [COleControl::D опропексчанже](reference/colecontrol-class.md#dopropexchange)по умолчанию. В следующем примере показан код, добавленный в классы, созданные с помощью мастера элементов управления ActiveX.

[!code-cpp[NVC_MFC_AxUI#43](codesnippet/cpp/mfc-activex-controls-serializing_1.cpp)]

Если необходимо сделать свойство постоянным, измените его, `DoPropExchange` добавив вызов функции обмена свойствами. В следующем примере показана сериализация пользовательского логического свойства Цирклешапе, где свойство Цирклешапе имеет значение по умолчанию **true**:

[!code-cpp[NVC_MFC_AxSer#1](codesnippet/cpp/mfc-activex-controls-serializing_2.cpp)]
[!code-cpp[NVC_MFC_AxSer#2](codesnippet/cpp/mfc-activex-controls-serializing_3.cpp)]

В следующей таблице перечислены возможные функции обмена свойствами, которые можно использовать для сериализации свойств элемента управления.

|Функции обмена свойствами|Назначение|
|---------------------------------|-------------|
|**PX_Blob ()**|Сериализует свойство данных больших двоичных объектов (BLOB) типа.|
|**PX_Bool ()**|Сериализует логическое свойство типа.|
|**PX_Color ()**|Сериализует свойство цвета типа.|
|**PX_Currency ()**|Сериализует свойство типа **CY** (Currency).|
|**PX_Double ()**|Сериализует **`double`** свойство типа.|
|**PX_Font ()**|Сериализует свойство типа шрифта.|
|**PX_Float ()**|Сериализует **`float`** свойство типа.|
|**PX_IUnknown ()**|Сериализует свойство типа `LPUNKNOWN` .|
|**PX_Long ()**|Сериализует **`long`** свойство типа.|
|**PX_Picture ()**|Сериализует свойство рисунка типа.|
|**PX_Short ()**|Сериализует **`short`** свойство типа.|
|**Пксстринг ()**|Сериализует `CString` свойство типа.|
|**PX_ULong ()**|Сериализует свойство **ulong** типа.|
|**PX_UShort ()**|Сериализует свойство типа **UShort** .|

Дополнительные сведения об этих функциях обмена свойствами см. в разделе [сохраняемость элементов управления OLE](reference/persistence-of-ole-controls.md) в *справочнике по MFC*.

## <a name="customizing-the-default-behavior-of-dopropexchange"></a><a name="_core_customizing_the_default_behavior_of_dopropexchange"></a>Настройка поведения по умолчанию для DoPropExchange

Реализация по умолчанию `DoPropertyExchange` (как показано в предыдущем разделе) выполняет вызов базового класса `COleControl` . Это сериализует набор свойств, автоматически поддерживаемых `COleControl` , который использует больше места для хранения, чем сериализация только пользовательских свойств элемента управления. Удаление этого вызова позволяет объекту сериализовать только те свойства, которые вы считаете важными. Любое состояние свойства акции, что реализованный элемент управления не будет сериализован при сохранении или загрузке управляющего объекта, если только вы не добавили явно **PX_ные** вызовы для них.

## <a name="implementing-version-support"></a><a name="_core_implementing_version_support"></a>Реализация поддержки версий

Поддержка версий позволяет измененному элементу управления ActiveX добавлять новые постоянные свойства и по-прежнему иметь возможность обнаруживать и загружать постоянное состояние, созданное в более ранней версии элемента управления. Чтобы сделать версию элемента управления доступной как часть своих постоянных данных, вызовите метод [COleControl:: ексчанжеверсион](reference/colecontrol-class.md#exchangeversion) в функции элемента управления `DoPropExchange` . Этот вызов автоматически вставляется, если элемент управления ActiveX был создан с помощью мастера элементов управления ActiveX. Его можно удалить, если поддержка версий не требуется. Однако затраты на размер элемента управления очень малы (4 байта) для дополнительной гибкости, предоставляемой поддержкой версий.

Если элемент управления не был создан с помощью мастера элементов управления ActiveX, добавьте вызов `COleControl::ExchangeVersion` , вставив следующую строку в начало `DoPropExchange` функции (перед вызовом `COleControl::DoPropExchange` ):

[!code-cpp[NVC_MFC_AxSer#1](codesnippet/cpp/mfc-activex-controls-serializing_2.cpp)]
[!code-cpp[NVC_MFC_AxSer#3](codesnippet/cpp/mfc-activex-controls-serializing_4.cpp)]

В качестве номера версии можно использовать любой **DWORD** . Проекты, создаваемые мастером элементов ActiveX `_wVerMinor` , `_wVerMajor` по умолчанию используют и. Это глобальные константы, определенные в файле реализации класса элемента управления ActiveX проекта. В оставшейся части `DoPropExchange` функции можно вызвать [кпропексчанже::](reference/cpropexchange-class.md#getversion) Can в любое время, чтобы получить версию, которую вы сохраняете или извлекаете.

В следующем примере в версии 1 этого примера элемента управления имеется только свойство "ReleaseDate". Версия 2 добавляет свойство "Оригиналдате". Если элементу управления дается инструкция загрузить постоянное состояние из старой версии, она инициализирует переменную-член для нового свойства на значение по умолчанию.

[!code-cpp[NVC_MFC_AxSer#4](codesnippet/cpp/mfc-activex-controls-serializing_5.cpp)]
[!code-cpp[NVC_MFC_AxSer#3](codesnippet/cpp/mfc-activex-controls-serializing_4.cpp)]

По умолчанию элемент управления преобразует старые данные в последний формат. Например, если версия 2 элемента управления загружает данные, сохраненные с помощью версии 1, при повторном сохранении будет записан формат версии 2. Если необходимо, чтобы элемент управления сохранял данные в формате, который был считан последним, передайте **значение false** в качестве третьего параметра при вызове метода `ExchangeVersion` . Этот третий параметр является необязательным и по умолчанию имеет **значение true** .

## <a name="see-also"></a>См. также статью

[Элементы управления ActiveX в MFC](mfc-activex-controls.md)
