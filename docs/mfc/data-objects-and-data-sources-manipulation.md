---
title: Объекты и источники данных. Манипуляция
ms.date: 11/04/2016
helpviewer_keywords:
- data objects [MFC], manipulating
- data sources [MFC], data operations
- data sources [MFC], inserting data
- Clipboard [MFC], determining available formats
- OLE [MFC], data objects
- Clipboard [MFC], passing format information
- data sources [MFC], determining available formats
- delayed rendering [MFC]
- OLE [MFC], data sources
ms.assetid: f7f27e77-bb5d-4131-b819-d71bf929ebaf
ms.openlocfilehash: adbe2a77fb0069e9874ab20a51b3ab08aabbe1f6
ms.sourcegitcommit: 63784729604aaf526de21f6c6b62813882af930a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/17/2020
ms.locfileid: "79447000"
---
# <a name="data-objects-and-data-sources-manipulation"></a>Объекты и источники данных. Манипуляция

После создания объекта данных или источника данных можно выполнять ряд общих операций с данными, таких как вставка и удаление данных, перечисление форматов, в которых находятся данные, и многое другое. В этой статье описываются методы, необходимые для выполнения наиболее распространенных операций. Будут рассмотрены следующие задачи:

- [Вставка данных в источник данных](#_core_inserting_data_into_a_data_source)

- [Определение форматов, доступных в объекте данных](#_core_determining_the_formats_available_in_a_data_object)

- [Получение данных из объекта данных](#_core_retrieving_data_from_a_data_object)

##  <a name="_core_inserting_data_into_a_data_source"></a>Вставка данных в источник данных

Способ вставки данных в источник данных зависит от того, передаются данные сразу или по требованию, и в какой среднем они передаются. Возможные варианты:

### <a name="supplying-data-immediately-immediate-rendering"></a>Немедленное предоставление данных (немедленное отображение)

- Вызывайте `COleDataSource::CacheGlobalData` повторно для каждого формата буфера обмена, в котором указываются данные. Передайте используемый формат буфера обмена, маркер памяти, содержащий данные, и, при необходимости, структуру **форматетк** , описывающую данные.

     -или-

- Если вы хотите работать непосредственно с структурами **стгмедиум** , вызовите `COleDataSource::CacheData` вместо `COleDataSource::CacheGlobalData` в указанном выше параметре.

### <a name="supplying-data-on-demand-delayed-rendering"></a>Предоставление данных по запросу (отложенная визуализация)

Это дополнительная тема.

- Вызывайте `COleDataSource::DelayRenderData` повторно для каждого формата буфера обмена, в котором указываются данные. Передайте используемый формат буфера обмена и, при необходимости, структуру **форматетк** , описывающую данные. При запросе данных платформа выполнит вызов `COleDataSource::OnRenderData`, который необходимо переопределить.

     -или-

- Если для передачи данных используется объект `CFile`, вызовите метод `COleDataSource::DelayRenderFileData` вместо `COleDataSource::DelayRenderData` в предыдущем параметре. При запросе данных платформа выполнит вызов `COleDataSource::OnRenderFileData`, который необходимо переопределить.

##  <a name="_core_determining_the_formats_available_in_a_data_object"></a>Определение форматов, доступных в объекте данных

Прежде чем приложение сможет вставить в него данные, необходимо выяснить, есть ли в буфере обмена форматы, которые он может обменяться. Для этого приложение должно выполнить следующие действия:

1. Создайте объект `COleDataObject` и структуру **форматетк** .

1. Вызовите функцию члена `AttachClipboard` объекта данных, чтобы связать объект данных с данными в буфере обмена.

1. Выполните одно из следующих действий.

   - Вызовите функцию члена `IsDataAvailable` объекта данных, если требуется только один или два формата. Это сэкономит время в тех случаях, когда данные в буфере обмена поддерживают значительно больше форматов, чем приложение.

     \-или-

   - Вызовите функцию члена `BeginEnumFormats` объекта данных, чтобы приступить к перечислению форматов, доступных в буфере обмена. Затем вызовите `GetNextFormat`, пока буфер обмена не вернет формат, поддерживаемый приложением, или больше нет форматов.

Если вы используете **ON_UPDATE_COMMAND_UI**, теперь можно включить вставку и, возможно, вставку специальных элементов в меню Правка. Для этого вызовите либо `CMenu::EnableMenuItem`, либо `CCmdUI::Enable`. Дополнительные сведения о том, какие приложения контейнера должны выполнять с элементами меню и когда, см. в разделе [меню и ресурсы: Добавление контейнеров](../mfc/menus-and-resources-container-additions.md).

##  <a name="_core_retrieving_data_from_a_data_object"></a>Получение данных из объекта данных

Когда вы решили использовать формат данных, остается только извлечь данные из объекта данных. Для этого пользователь решает, куда разместить данные, и приложение вызывает соответствующую функцию. Данные будут доступны на одном из следующих носителей:

|Средний|Вызываемая функция|
|------------|----------------------|
|Глобальная память (`HGLOBAL`)|`COleDataObject::GetGlobalData`|
|Файл (`CFile`)|`COleDataObject::GetFileData`|
|Структура **стгмедиум** (`IStorage`)|`COleDataObject::GetData`|

Обычно носитель будет указан вместе со своим форматом буфера обмена. Например, объект **CF_EMBEDDEDSTRUCT** всегда находится в `IStorage` носителе, для которого требуется структура **стгмедиум** . Поэтому следует использовать `GetData`, так как это единственная одна из этих функций, которая может принимать структуру **стгмедиум** .

В случаях, когда формат буфера обмена находится в `IStream` или `HGLOBAL` средних, платформа может предоставить `CFile` указатель, который ссылается на данные. Приложение может использовать чтение файлов для получения данных практически так же, как и импорт данных из файла. По сути, это клиентский интерфейс для `OnRenderData` и `OnRenderFileData` подпрограмм в источнике данных.

Теперь пользователь может вставлять данные в документ точно так же, как и для любых других данных в том же формате.

### <a name="what-do-you-want-to-know-more-about"></a>Что вы хотите узнать подробнее

- [Перетаскивание](../mfc/drag-and-drop-ole.md)

- [Буфер обмена](../mfc/clipboard.md)

## <a name="see-also"></a>См. также раздел

[Объекты и источники данных (OLE)](../mfc/data-objects-and-data-sources-ole.md)<br/>
[Класс COleDataObject](../mfc/reference/coledataobject-class.md)<br/>
[Класс COleDataSource](../mfc/reference/coledatasource-class.md)
