---
title: Настройка мыши и клавиатуры
ms.date: 11/04/2016
helpviewer_keywords:
- customizations [MFC], keyboard and mouse (MFC Extensions)
- keyboard and mouse customizations (MFC Extensions)
ms.assetid: 1f789f1b-5f2e-4b11-b974-e3e2a2e49d82
ms.openlocfilehash: 8bb685974ed4020611ffe275ba504951d132afac
ms.sourcegitcommit: 6052185696adca270bc9bdbec45a626dd89cdcdd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/31/2018
ms.locfileid: "50487393"
---
# <a name="keyboard-and-mouse-customization"></a>Настройка мыши и клавиатуры

MFC позволяет пользователю приложения, чтобы настроить способ обработки клавиатуру и мышь. Пользователь может настроить ввод с клавиатуры, назначив сочетания клавиш для команд. Пользователь также может настроить ввод от мыши, выбрав команду, которая должна выполняться, когда пользователь дважды щелкает внутри конкретного окна приложения. В этом разделе объясняется, как настроить входные данные для вашего приложения.

В **настройки** диалоговое окно, пользователь может изменить пользовательские элементы управления для мыши и клавиатуры. Чтобы отобразить это диалоговое окно, пользователь указывает на **Настройка** на **представление** меню, а затем нажимает кнопку **панелей инструментов и закрепления**. В диалоговом окне пользователь нажимает какую-либо **клавиатуры** вкладку или **мыши** вкладки.

## <a name="keyboard-customization"></a>Настройка клавиатуры

На следующем рисунке показано **клавиатуры** вкладке **настройки** диалоговое окно.

![Вкладка "Клавиатура" в диалоговом окне настройки](../mfc/media/mfcnextkeyboardtab.png "mfcnextkeyboardtab") вкладку настройки клавиатуры

Пользователь взаимодействует с вкладка "Клавиатура", чтобы назначить один или несколько сочетаний клавиш для команды. Доступные команды, перечислены в левой части вкладки. Пользователь может выбрать любые доступные команды в меню. Только команды меню, можно связать с сочетанием клавиш. После того как пользователь введет новый ярлык, **назначить** становится доступной кнопка. Когда пользователь нажимает эту кнопку, приложение связывает выбранную команду с помощью этого ярлыка.

Все в настоящее время назначенных сочетаний клавиш, перечислены в списке в правом столбце. Пользователь также можно выбрать отдельные ярлыки и удалить их или сбросить все сопоставления для приложения.

Если вы хотите поддерживать эту настройку в приложении, необходимо создать [CKeyboardManager](../mfc/reference/ckeyboardmanager-class.md) объекта. Чтобы создать `CKeyboardManager` объекта, вызовите функцию [CWinAppEx::InitKeyboardManager](../mfc/reference/cwinappex-class.md#initkeyboardmanager). Этот метод создает и инициализирует диспетчер клавиатуры. При создании клавиатура manager вручную, по-прежнему необходимо вызвать `CWinAppEx::InitKeyboardManager` для его инициализации.

Если мастер используется для создания приложения, мастер будет инициализировать диспетчер клавиатуры. После инициализации диспетчера клавиатуры приложения среда добавит **клавиатуры** вкладки **настройки** диалоговое окно.

## <a name="mouse-customization"></a>Настройка мыши

На следующем рисунке показано **мыши** вкладке **настройки** диалоговое окно.

![Вкладка "Мышь" в диалоговом окне настройки](../mfc/media/mfcnextmousetab.png "mfcnextmousetab") вкладку настройки мыши

Пользователь взаимодействует с этой вкладке для назначения меню команды мыши двойного щелчка. Пользователь выбирает представления в левой части окна, а затем использует элементы управления справа от оператора должен быть сопоставлен команду действие двойного щелчка. Когда пользователь нажимает **закрыть**, приложение выполняет связанная команда всякий раз, когда пользователь дважды щелкает в любом месте в представлении.

По умолчанию при создании приложения с помощью мастера настройки мыши не включена.

#### <a name="to-enable-mouse-customization"></a>Для быстрой настройки мыши

1. Инициализировать [CMouseManager](../mfc/reference/cmousemanager-class.md) путем вызова метода [CWinAppEx::InitMouseManager](../mfc/reference/cwinappex-class.md#initmousemanager).

1. Получить указатель мыши manager с помощью [CWinAppEx::GetMouseManager](../mfc/reference/cwinappex-class.md#getmousemanager).

1. Добавление представления в диспетчер мыши с помощью [CMouseManager::AddView](../mfc/reference/cmousemanager-class.md#addview) метод. Это необходимо сделайте для каждого представления, который вы хотите добавить в диспетчер мыши.

После инициализации диспетчера мыши приложения среда добавит **мыши** вкладки **Настройка** диалоговое окно. Если вы не добавите все представления, доступ к вкладке будет вызвать необработанное исключение. После создания списка представлений, **мыши** вкладка доступна пользователю.

При добавлении нового представления к диспетчеру мыши ей уникальный идентификатор. Если требуется для поддержки настройки мыши для окна, необходимо обработать WM_LBUTTONDBLCLICK message и call [CWinAppEx::OnViewDoubleClick](../mfc/reference/cwinappex-class.md#onviewdoubleclick) функции. При вызове этой функции, один из параметров — идентификатор для этого окна. Он отвечает программист должен хранить список идентификаторов и объекты, связанные с ними.

## <a name="security-concerns"></a>Проблемы безопасности

Как описано в разделе [определенные пользователем инструменты](../mfc/user-defined-tools.md), пользователь может связать идентификатор инструмента, определенного пользователем с помощью события двойного щелчка. Когда пользователь дважды щелкает представление, приложение выглядит для пользовательского средства, которое соответствует связанный. Если приложение находит подходящий инструмент, он выполняет программу. Если приложение не удается найти подходящий инструмент, он отправляет сообщение WM_COMMAND с Идентификатором представление, которое был выполнен двойной щелчок.

Измененные параметры хранятся в реестре. Путем редактирования реестра, злоумышленник может заменить идентификатор пользователя средство произвольную команду. Когда пользователь дважды щелкает представления, представление обрабатывает команду, которая высадки злоумышленник. Это может привести к непредвиденным и потенциально опасных поведение.

Кроме того такой вид атаки могут обходить меры безопасности интерфейса пользователя. Например предположим, что приложение имеет печать отключена. То есть в своем пользовательском интерфейсе **печати** меню и кнопки будут недоступны. Обычно это дает приложению выполнять печать. Но если злоумышленник изменения в реестр, пользователь может теперь может отправлять команды print по двойному щелчку представления, минуя элементы пользовательского интерфейса, которые недоступны.

Чтобы защититься от атак этого типа, добавьте код обработчик команд вашего приложения для проверки допустимости команду перед его выполнением. Не полагаться на пользовательском интерфейсе, чтобы предотвратить команды, отправляемые в приложение.

## <a name="see-also"></a>См. также

[Настройка для MFC](../mfc/customization-for-mfc.md)<br/>
[Класс CKeyboardManager](../mfc/reference/ckeyboardmanager-class.md)<br/>
[Класс CMouseManager](../mfc/reference/cmousemanager-class.md)<br/>
[Вопросы безопасности во время настройки](../mfc/security-implications-of-customization.md)

