---
title: Получение метаданных в схеме набора строк
ms.date: 10/24/2018
helpviewer_keywords:
- schema rowsets, getting OLE DB provider metadata
- OLE DB consumer templates, getting provider metadata
- metadata, getting (OLE DB Templates)
ms.assetid: 6b448461-82fb-4acf-816b-3cbb0ca1d186
ms.openlocfilehash: a9717649c1bd4f956da8bc926e8f492f4eccff74
ms.sourcegitcommit: c40469825b6101baac87d43e5f4aed6df6b078f5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/12/2018
ms.locfileid: "51556846"
---
# <a name="obtaining-metadata-with-schema-rowsets"></a>Получение метаданных в схеме набора строк

Иногда вам необходимо получить информацию о поставщике, наборе строк, таблице, столбцах или другие сведения о базе данных без открытия набора строк. Данные о структуре базы данных называют метаданными, и их можно получить несколькими способами. Первый способ — использовать наборы строк схемы.

Шаблоны OLE DB предоставляют набор классов для получения сведений схемы; Эти классы создают предопределенные наборы строк схемы и перечислены в [классы схемы Rowset и Typedef](../../data/oledb/schema-rowset-classes-and-typedef-classes.md).

> [!NOTE]
> Если вы используете OLAP и некоторые наборы строк не поддерживаются классами наборов строк схемы (например, количество столбцов переменное), следует рассмотреть возможность использования `CManualAccessor` или `CDynamicAccessor`. Вы можете пройти по столбцам и использовать операторы case для обработки возможных типов данных для каждого столбца.

## <a name="catalogschema-model"></a>Модель каталога или схемы

ANSI SQL определяет модель каталога или схемы для хранилищ данных. Эта модель используется OLE DB. В этой модели каталоги (базы данных) есть схемы и схемы есть таблицы.

- **Каталог** каталог — это другое имя для базы данных. Это коллекция связанных объектов. Чтобы получить список каталогов (баз данных), принадлежащих определенному источнику данных, используйте [CCatalog](../../data/oledb/ccatalogs-ccataloginfo.md). Поскольку многие базы данных содержат только один каталог, метаданные иногда называют сведения о схеме.

- **Схемы** схема является коллекцией объектов базы данных, которые принадлежат либо были созданы определенным пользователем. Чтобы получить список схем, принадлежащих указанному пользователю, используйте [CSchemata](../../data/oledb/cschemata-cschematainfo.md).

   В Microsoft SQL Server и ODBC 2.x, схема — это владелец (например, dbo является это типичное имя схемы). Кроме того, SQL Server хранит метаданные в набор таблиц: одна таблица содержит список всех таблиц, а другая таблица содержит список всех столбцов. Не имеет эквивалента в схему базы данных Microsoft Access.

- **Таблица** таблицы представляют собой коллекции столбцов, расположенных в определенном порядке. Чтобы получить список таблиц, определенных в заданном каталоге (база данных) и сведения об этих таблицах, используйте [CTables](../../data/oledb/ctables-ctableinfo.md)).

## <a name="restrictions"></a>Ограничения

При запросе сведений о схеме, можно использовать ограничения, чтобы указать тип данных, в котором вы заинтересованы. Ограничения можно представить как фильтр или квалификатор в запросе. Например, в запросе:

```sql
SELECT * FROM authors WHERE l_name = 'pivo'
```

`l_name` — это ограничение. Это простой пример с одним ограничением; классы набора строк схемы поддерживают несколько ограничений.

[Классы typedef набора строк схемы](../../data/oledb/schema-rowset-classes-and-typedef-classes.md) инкапсулируют все наборы строк схемы OLE DB таким образом, чтобы доступ к набору строк схемы так же, как и любому другому набору строк путем создания экземпляра и открыв его. Например, класс typedef [CColumns](../../data/oledb/ccolumns-ccolumnsinfo.md) определяется как:

```cpp
CRestrictions<CAccessor<CColumnsInfo>
```

[CRestrictions](../../data/oledb/crestrictions-class.md) класс предоставляет поддержку ограничений. После создания экземпляра набора строк схемы, вызовите [CRestrictions::Open](../../data/oledb/crestrictions-open.md). Он возвращает результирующий набор, основанный на заданных ограничениях.

Указать ограничения, см. в статье [приложение б. наборы строк схемы](https://docs.microsoft.com/previous-versions/windows/desktop/ms712921(v=vs.85)) и найдите набор строк, который вы используете. Например `CColumns` соответствует [набор строк COLUMNS](https://docs.microsoft.com/previous-versions/windows/desktop/ms723052(v=vs.85)\(v%3dvs.85\)); этой теме перечислены столбцы ограничений в наборе строк COLUMNS: значениям TABLE_CATALOG, TABLE_SCHEMA, TABLE_NAME, COLUMN_NAME. Необходимо придерживаться этого порядка при указании ограничений.

Таким образом, например, если требуется ограничение по имени таблицы TABLE_NAME — это третий столбец ограничений, а затем вызовите `Open`, указав имя нужной таблицы в качестве третьего параметра ограничения, как показано в следующем примере.

### <a name="to-use-schema-rowsets"></a>Использование наборов строк схемы

1. Включить файл заголовка `Atldbsch.h` (требуется `Atldbcli.h` для поддержки получателя).

1. Создайте экземпляр объекта набора строк схемы в файле заголовка получателя или документа. Если требуется, чтобы сведения о таблице, объявите `CTables` объекта; Если вам нужны сведения о столбцах, объявите `CColumns` объекта. В этом примере показано, как извлечь столбцы в таблице authors.

    ```cpp
    CDataSource ds;
    ds.Open();
    CSession ss;
    ss.Open(ds);
    CColumns columnSchemaRowset;
    // TABLE_NAME is the third restriction column, so
    // specify "authors" as the third restriction parameter:
    HRESULT hr = columnSchemaRowset.Open(ss, NULL, NULL, L"authors");
    hr = columnSchemaRowset.MoveFirst();
    while (hr == S_OK)
    {
       hr = columnSchemaRowset.MoveNext();
    }
    ```

1. Чтобы получить сведения, обратитесь к соответствующему элементу данных объекта набора строк схемы, например `ColumnSchemaRowset.m_szColumnName`. Этот элемент данных соответствует столбцу COLUMN_NAME. Чтобы увидеть, какой столбец OLE DB, соответствующий каждому элементу данных, см. в разделе [CColumns](../../data/oledb/ccolumns-ccolumnsinfo.md).

Справочные сведения о наборе строк схемы, классы typedef, предоставленного в шаблонах OLE DB (см. в разделе [классы схемы Rowset и Typedef](../../data/oledb/schema-rowset-classes-and-typedef-classes.md)).

Дополнительные сведения о наборах строк схемы OLE DB, включая столбцы ограничений, см. в разделе [приложение б. наборы строк схемы](https://docs.microsoft.com/previous-versions/windows/desktop/ms712921(v=vs.85)) в **Справочник программиста OLE DB по**.

Более сложные примеры использования классов набора строк схемы см. в разделе ["CatDB"](https://github.com/Microsoft/VCSamples) и [DBViewer](https://github.com/Microsoft/VCSamples) примеры.

Сведения о поддержке поставщиками наборов строк схемы, см. в разделе [поддержка наборов строк схемы](../../data/oledb/supporting-schema-rowsets.md).

## <a name="see-also"></a>См. также

[Использование методов доступа](../../data/oledb/using-accessors.md)