---
title: Получение метаданных в схеме набора строк
ms.date: 10/24/2018
helpviewer_keywords:
- schema rowsets, getting OLE DB provider metadata
- OLE DB consumer templates, getting provider metadata
- metadata, getting (OLE DB Templates)
ms.assetid: 6b448461-82fb-4acf-816b-3cbb0ca1d186
ms.openlocfilehash: 37418cc91913ed840d1601aab9005b476bf29ee0
ms.sourcegitcommit: a1676bf6caae05ecd698f26ed80c08828722b237
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/29/2020
ms.locfileid: "91508983"
---
# <a name="obtaining-metadata-with-schema-rowsets"></a>Получение метаданных в схеме набора строк

Иногда вам необходимо получить информацию о поставщике, наборе строк, таблице, столбцах или другие сведения о базе данных без открытия набора строк. Данные о структуре базы данных называют метаданными, и их можно получить несколькими способами. Первый способ — использовать наборы строк схемы.

Шаблоны OLE DB предоставляют набор классов для получения сведений о схеме. Эти классы создают стандартные наборы строк схемы и перечислены в [классах наборов строк схемы и классах typedef](../../data/oledb/schema-rowset-classes-and-typedef-classes.md).

> [!NOTE]
> Если вы используете OLAP и некоторые наборы строк не поддерживаются классами наборов строк схемы (например, количество столбцов переменное), следует рассмотреть возможность использования `CManualAccessor` или `CDynamicAccessor`. Вы можете пройти по столбцам и использовать операторы case для обработки возможных типов данных для каждого столбца.

## <a name="catalogschema-model"></a>Модель каталога или схемы

ANSI SQL определяет модель каталога или схемы для хранилищ данных. Эта модель используется OLE DB. В этой модели в каталогах (базах данных) есть схемы и схемы, имеющие таблицы.

- **Каталог** Каталог — это еще одно имя для базы данных. Это коллекция связанных схем. Чтобы получить список каталогов (баз данных), принадлежащих определенному источнику данных, используйте [ККаталог](./schema-rowset-classes-and-typedef-classes.md#catalog). Поскольку многие базы данных имеют только один каталог, метаданные иногда называются сведениями о схеме.

- **Схема** Схема — это коллекция объектов базы данных, принадлежащих или созданных определенным пользователем. Чтобы получить список схем, принадлежащих данному пользователю, используйте [ксчемата](./schema-rowset-classes-and-typedef-classes.md#schemata).

   В Microsoft SQL Server и ODBC 2.x схема — это владелец (например, dbo — это типичное имя схемы). Кроме того, SQL Server хранит метаданные в наборе таблиц: одна из них содержит список всех таблиц, а другая — список всех столбцов. Нет эквивалента схемы в базе данных Microsoft Access.

- **Таблица** Таблицы представляют собой коллекции столбцов, упорядоченные по конкретным заказам. Чтобы получить список таблиц, определенных в заданном каталоге (базе данных), и сведения об этих таблицах, используйте [ктаблес](./schema-rowset-classes-and-typedef-classes.md#table).

## <a name="restrictions"></a>Ограничения

При запросе сведений о схеме можно использовать ограничения для указания типа интересующей вас информации. Ограничения можно представить как фильтр или квалификатор в запросе. Например, в запросе:

```sql
SELECT * FROM authors WHERE l_name = 'pivo'
```

`l_name` — это ограничение. Это простой пример с единственным ограничением. классы наборов строк схемы поддерживают несколько ограничений.

[Классы typedef набора строк схемы](../../data/oledb/schema-rowset-classes-and-typedef-classes.md) инкапсулируют все наборы строк схемы OLE DB, чтобы можно было обращаться к набору строк схемы так же, как и к любому другому набору строк, путем создания экземпляра и его открытия. Например, класс typedef [кколумнс](./schema-rowset-classes-and-typedef-classes.md#columns) определяется следующим образом:

```cpp
CRestrictions<CAccessor<CColumnsInfo>
```

Класс [cRestrictions](../../data/oledb/crestrictions-class.md) предоставляет поддержку ограничений. После создания экземпляра набора строк схемы вызовите метод [cRestrictions:: Open](./crestrictions-class.md#open). Он возвращает результирующий набор, основанный на заданных ограничениях.

Чтобы указать ограничения, см. [приложение б. наборы строк схемы](/previous-versions/windows/desktop/ms712921(v=vs.85)) и найдите набор строк, который вы используете. Например, `CColumns` соответствует [набору строк COLUMNS](/previous-versions/windows/desktop/ms723052(v=vs.85)). в этом разделе перечислены столбцы ограничений в НАБОРе строк columns: TABLE_CATALOG, TABLE_SCHEMA, table_name column_name. Необходимо придерживаться этого порядка при указании ограничений.

Например, если необходимо ограничить по имени таблицы, TABLE_NAME является третьим столбцом ограничений, а затем вызвать `Open` , указав требуемое имя таблицы в качестве третьего параметра ограничения, как показано в следующем примере.

### <a name="to-use-schema-rowsets"></a>Использование наборов строк схемы

1. Включите заголовочный файл `Atldbsch.h` (также требуется `Atldbcli.h` для поддержки пользователей).

1. Создайте экземпляр объекта набора строк схемы в файле заголовка получателя или документа. Если требуется получить сведения о таблице, объявите `CTables` объект; если требуется получить сведения о столбцах, объявите `CColumns` объект. В этом примере показано, как извлечь столбцы в таблице authors.

    ```cpp
    CDataSource ds;
    ds.Open();
    CSession ss;
    ss.Open(ds);
    CColumns columnSchemaRowset;
    // TABLE_NAME is the third restriction column, so
    // specify "authors" as the third restriction parameter:
    HRESULT hr = columnSchemaRowset.Open(ss, NULL, NULL, L"authors");
    hr = columnSchemaRowset.MoveFirst();
    while (hr == S_OK)
    {
       hr = columnSchemaRowset.MoveNext();
    }
    ```

1. Чтобы получить сведения, обратитесь к соответствующему элементу данных объекта набора строк схемы, например `ColumnSchemaRowset.m_szColumnName`. Этот элемент данных соответствует COLUMN_NAME. Чтобы узнать, к какому OLE DB столбцу каждый элемент данных соответствует, см. раздел [кколумнс](./schema-rowset-classes-and-typedef-classes.md#columns).

Для ссылки на набор строк схемы классы typedef предоставлены в шаблонах OLE DB (см. раздел [классы наборов строк схемы и классы typedef](../../data/oledb/schema-rowset-classes-and-typedef-classes.md)).

Дополнительные сведения о OLE DB наборах строк схемы, включая столбцы ограничений, см. в [приложении б. наборы строк схемы](/previous-versions/windows/desktop/ms712921(v=vs.85)) в **справочнике по программисту OLE DB**.

Более сложные примеры использования классов наборов строк схемы см. в разделе примеры [catdb](https://github.com/Microsoft/VCSamples/tree/master/VC2010Samples/ATL/OLEDB/Consumer) и [дбвиевер](https://github.com/Microsoft/VCSamples/tree/master/VC2010Samples/ATL/OLEDB/Consumer) .

Дополнительные сведения о поддержке наборов строк схемы в поставщике см. в разделе [Поддержка наборов](../../data/oledb/supporting-schema-rowsets.md)строк схемы.

## <a name="see-also"></a>См. также раздел

[Использование методов доступа](../../data/oledb/using-accessors.md)
