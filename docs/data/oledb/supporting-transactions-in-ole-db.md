---
description: 'Дополнительные сведения: поддержка транзакций в OLE DB'
title: Поддержка транзакций в OLE DB
ms.date: 10/24/2018
helpviewer_keywords:
- OLE DB consumer templates [C++], transaction support
- transactions [C++], OLE DB support for
- nested transactions [C++]
- OLE DB [C++], transaction support
- databases [C++], transactions
- distributed transactions [C++]
ms.assetid: 3d72e583-ad38-42ff-8f11-e2166d60a5a7
ms.openlocfilehash: f8d01a0d359a3d33fbe4b88877d8a4452f257c16
ms.sourcegitcommit: d6af41e42699628c3e2e6063ec7b03931a49a098
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2020
ms.locfileid: "97272725"
---
# <a name="supporting-transactions-in-ole-db"></a>Поддержка транзакций в OLE DB

[Транзакция](../../data/transactions-mfc-data-access.md) — это способ группирования или пакетной обработки ряда обновлений источника данных таким образом, чтобы все успешно выполненные операции и зафиксированы одновременно или (если один из них завершается неудачно) ни один из них не фиксируется и выполняется откат всей транзакции. Этот процесс обеспечивает целостность результата для источника данных.

OLE DB поддерживает транзакции с помощью следующих трех методов:

- [ITransactionLocal:: StartTransaction](/previous-versions/windows/desktop/ms709786(v=vs.85))

- [ITransaction:: Commit](/previous-versions/windows/desktop/ms713008(v=vs.85))

- [ITransaction:: Abort](/previous-versions/windows/desktop/ms709833(v=vs.85))

## <a name="relationship-of-sessions-and-transactions"></a>Связь между сеансами и транзакциями

Один объект источника данных может создавать один или несколько объектов сеанса, каждый из которых может находиться внутри или вне области транзакции в определенный момент времени.

Если сеанс не вводит транзакцию, вся работа, выполненная в этом сеансе в хранилище данных, немедленно фиксируется при каждом вызове метода. (Иногда это называется режимом автоматической фиксации или неявным режимом.)

Когда сеанс входит в транзакцию, вся работа, выполненная в этом сеансе в хранилище данных, является частью этой транзакции и фиксируется или прерывается как единое целое. (Иногда это называется режимом фиксации вручную.)

Поддержка транзакций зависит от поставщика. Если поставщик, который вы используете, поддерживает транзакции, то объект сеанса, который поддерживает `ITransaction` и `ITransactionLocal` может ввести (не вложенную) транзакцию. Класс OLE DB шаблонов [CSession](../../data/oledb/csession-class.md) поддерживает эти интерфейсы и является рекомендуемым способом реализации поддержки транзакций в Visual C++.

## <a name="starting-and-ending-the-transaction"></a>Запуск и завершение транзакции

`StartTransaction` `Commit` Методы, и `Abort` в объекте набора строк в потребителе вызываются.

Вызов `ITransactionLocal::StartTransaction` запускает новую локальную транзакцию. При запуске транзакции любые изменения, заданные в последующих операциях, не применяются к хранилищу данных до тех пор, пока транзакция не будет зафиксирована.

Вызов `ITransaction::Commit` или `ITransaction::Abort` Завершение транзакции. `Commit` приводит к применению всех изменений в области действия транзакции к хранилищу данных. `Abort` приводит к отмене всех изменений в области транзакции, а хранилище данных остается в состоянии, в котором оно было до начала транзакции.

## <a name="nested-transactions"></a>Вложенные транзакции

[Вложенная транзакция](/previous-versions/windows/desktop/ms716985(v=vs.85)) возникает при запуске новой локальной транзакции, если в сеансе уже существует активная транзакция. Новая транзакция запускается как вложенная транзакция под текущей транзакцией. Если поставщик не поддерживает вложенные транзакции, вызов `StartTransaction` при наличии активной транзакции в сеансе возвращает XACT_E_XTIONEXISTS.

## <a name="distributed-transactions"></a>Распределенные транзакции

Распределенная транзакция — это транзакция, которая обновляет распределенные данные. то есть данные на более чем одной сетевой системе компьютера. Если требуется поддержка транзакций в распределенной системе, следует использовать .NET Framework, а не поддержку транзакций OLE DB.

## <a name="see-also"></a>См. также раздел

[Использование методов доступа](../../data/oledb/using-accessors.md)
