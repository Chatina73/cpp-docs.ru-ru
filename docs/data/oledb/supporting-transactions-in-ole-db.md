---
title: Поддержка транзакций в OLE DB
ms.date: 10/24/2018
helpviewer_keywords:
- OLE DB consumer templates [C++], transaction support
- transactions [C++], OLE DB support for
- nested transactions [C++]
- OLE DB [C++], transaction support
- databases [C++], transactions
- distributed transactions [C++]
ms.assetid: 3d72e583-ad38-42ff-8f11-e2166d60a5a7
ms.openlocfilehash: 2e3605b636bbcb16a1c6f543bc9090d2b212a60b
ms.sourcegitcommit: bff17488ac5538b8eaac57156a4d6f06b37d6b7f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/05/2019
ms.locfileid: "57418581"
---
# <a name="supporting-transactions-in-ole-db"></a>Поддержка транзакций в OLE DB

Объект [транзакции](../../data/transactions-mfc-data-access.md) — это способ группирования или пакета, последовательность обновлений к источнику данных, либо все завершиться успешно и фиксируются одновременно, или (если какой-либо из них не работает) не завершаются, и выполняется откат всей транзакции. Этот процесс обеспечивает целостность результата в источнике данных.

OLE DB поддерживает транзакции с помощью следующих трех методов:

- [ITransactionLocal::StartTransaction](/previous-versions/windows/desktop/ms709786(v=vs.85))

- [ITransaction::Commit](/previous-versions/windows/desktop/ms713008(v=vs.85))

- [ITransaction::Abort](/previous-versions/windows/desktop/ms709833(v=vs.85))

## <a name="relationship-of-sessions-and-transactions"></a>Связь между сеансами и транзакциями

Объект источника данных можно создать один или несколько объектов сеанса, каждый из которых может быть внутри или за пределами области транзакции в определенный момент времени.

Если сеанс не входит в транзакцию, все операции, выполняемые в течение этого сеанса в хранилище данных немедленно фиксируется при каждом вызове метода. (Это иногда называется режим автоматической фиксации или неявный режим.)

Когда сеанс входит в транзакцию, все операции, выполняемые в течение этого сеанса в хранилище данных является частью этой транзакции и будет зафиксирована или прервана как единое целое. (Это иногда называется режим ручной фиксации.)

Поддержка транзакций зависит от поставщика. Если вы используете поставщик поддерживает транзакции, объект сеанса, который поддерживает `ITransaction` и `ITransactionLocal` можно ввести транзакции (не вложенный). Класс шаблонов OLE DB [CSession](../../data/oledb/csession-class.md) поддерживает эти интерфейсы и рекомендуемый способ реализации поддержки транзакций в Visual C++.

## <a name="starting-and-ending-the-transaction"></a>Запуск и остановка транзакции

Вы вызываете `StartTransaction`, `Commit`, и `Abort` методы в объекте набора строк в объекте-получателе.

Вызов `ITransactionLocal::StartTransaction` начинает новую локальную транзакцию. При запуске транзакции, любые изменения, используемые в последующих операций не применяются к хранилищу данных, до фиксации транзакции.

Вызов `ITransaction::Commit` или `ITransaction::Abort` завершает транзакцию. `Commit` вызывает все изменения в пределах области транзакции, применяемый к хранилищу данных. `Abort` причины, все изменения в области действия транзакции, отменяются и хранилище данных остается в состоянии его было до запуска транзакции.

## <a name="nested-transactions"></a>Вложенные транзакции

Объект [вложенные транзакции](/previous-versions/windows/desktop/ms716985(v=vs.85)) возникает при запуске новой локальной транзакции, если активная транзакция уже существует в сеансе. Новая транзакция запускается как вложенную транзакцию под текущей транзакцией. Если поставщик не поддерживает вложенных транзакций, при вызове метода `StartTransaction` при наличии активной транзакции в сеансе, возвращается значение XACT_E_XTIONEXISTS.

## <a name="distributed-transactions"></a>Распределенные транзакции

Распределенная транзакция предназначена для обновления распределенных данных; то есть данные на нескольких компьютерах в сети. Если требуется для поддержки транзакций в распределенной системе, следует использовать .NET Framework, а не поддержку транзакций OLE DB.

## <a name="see-also"></a>См. также

[Использование методов доступа](../../data/oledb/using-accessors.md)