---
description: 'Дополнительные сведения: передача тестов соответствия OLE DB'
title: Проверка на совместимость с OLE DB
ms.date: 11/04/2016
helpviewer_keywords:
- testing, OLE DB providers
- testing providers
- conformance testing
- conformance testing [OLE DB]
- OLE DB providers, testing
ms.assetid: d1a4f147-2edd-476c-b452-0e6a0ac09891
ms.openlocfilehash: d2a5b788b3a118293800b02a9383fbde9845cfa5
ms.sourcegitcommit: d6af41e42699628c3e2e6063ec7b03931a49a098
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2020
ms.locfileid: "97286727"
---
# <a name="passing-ole-db-conformance-tests"></a>Проверка на совместимость с OLE DB

Чтобы обеспечить более согласованность поставщиков, пакет SDK для доступа к данным предоставляет набор OLE DB проверок соответствия. Тесты проверяют все аспекты поставщика и предоставляют разумные гарантии того, что поставщик работает должным образом. OLE DB проверки соответствия можно найти в пакете SDK для доступа к данным Microsoft. В этом разделе рассматриваются вещи, которые необходимо выполнить для передачи тестов соответствия. Дополнительные сведения о выполнении OLE DB проверки соответствия см. в разделе пакет SDK.

## <a name="running-the-conformance-tests"></a>Выполнение тестов соответствия

В Visual C++ 6,0 Шаблоны поставщика OLE DB добавили ряд функций-обработчиков, позволяющих проверять значения и свойства. Большинство этих функций были добавлены в ответ на проверки соответствия.

> [!NOTE]
> Необходимо добавить несколько функций проверки для поставщика, чтобы передать OLE DB проверки соответствия.

Для этого поставщика требуются две подпрограммы проверки. Первая подпрограммы, `CRowsetImpl::ValidateCommandID` , является частью класса набора строк. Он вызывается во время создания набора строк с помощью шаблонов поставщиков. Этот пример использует эту подпрограммы для информирования потребителей о том, что они не поддерживают индексы. Первый вызов — `CRowsetImpl::ValidateCommandID` (Обратите внимание, что поставщик использует `_RowsetBaseClass` typedef, добавленный в карту интерфейса для `CCustomRowset` в [службе поддержки закладок в поставщике](../../data/oledb/provider-support-for-bookmarks.md), поэтому вам не нужно вводить эту длинную строку аргументов шаблона). Затем вернитесь DB_E_NOINDEX, если параметр индекса не равен NULL (это означает, что потребитель хочет использовать индекс в США). Дополнительные сведения об идентификаторах команд см. в спецификации OLE DB и найдите `IOpenRowset::OpenRowset` .

Следующий код является `ValidateCommandID` подпрограммой проверки:

```cpp
/////////////////////////////////////////////////////////////////////
// CustomRS.H
// Class: CCustomRowset

HRESULT ValidateCommandID(DBID* pTableID, DBID* pIndexID)
{
   HRESULT hr = _RowsetBaseClass::ValidateCommandID(pTableID, pIndexID);
   if (hr != S_OK)
      return hr;

   if (pIndexID != NULL)
      return DB_E_NOINDEX;    // Doesn't support indexes

   return S_OK;
}
```

Шаблоны поставщика вызывают `OnPropertyChanged` метод всякий раз, когда кто-то изменяет свойство в группе DBPROPSET_ROWSET. Если вы хотите управлять свойствами других групп, добавьте их в соответствующий объект (то есть DBPROPSET_SESSION проверки в `CCustomSession` классе).

Код сначала проверяет, связано ли свойство с другим. Если свойство помещается в цепочку, свойству DBPROP_BOOKMARKS присваивается значение `True` . В приложении C спецификации OLE DB содержатся сведения о свойствах. Эти сведения также сообщают о том, является ли свойство цепочкой другим.

Также может потребоваться добавить `IsValidValue` подпрограмму в код. Шаблоны вызываются `IsValidValue` при попытке задать свойство. Этот метод следует переопределить, если требуется дополнительная обработка при задании значения свойства. Для каждого набора свойств можно использовать один из этих методов.

## <a name="see-also"></a>См. также раздел

[Дополнительные методы поставщика](../../data/oledb/advanced-provider-techniques.md)
