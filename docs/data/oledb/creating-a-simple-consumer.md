---
title: Создание простого объекта-получателя
ms.date: 05/09/2019
helpviewer_keywords:
- OLE DB consumers, creating
ms.assetid: ae32d657-72ea-4db8-9839-75cb5cff68ae
ms.openlocfilehash: cc24df1f15d43c384e6bf3853766fad82cf51255
ms.sourcegitcommit: fc1de63a39f7fcbfe2234e3f372b5e1c6a286087
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/15/2019
ms.locfileid: "65707715"
---
# <a name="creating-a-simple-consumer"></a>Создание простого объекта-получателя

::: moniker range="vs-2019"

Мастер объекта-получателя ATL OLE DB недоступен в Visual Studio 2019 и более поздних версиях. Эту функцию все еще можно добавить вручную. Дополнительные сведения см. в статье [Creating a Consumer Without Using a Wizard](creating-a-consumer-without-using-a-wizard.md) (Создание объекта-получателя без помощи мастера).

::: moniker-end

::: moniker range="<=vs-2017"

Используйте **мастер проектов ATL** и **мастер объекта-получателя ATL OLE DB**, чтобы создать объект-получатель шаблонов OLE DB.

## <a name="to-create-a-console-application-for-an-ole-db-consumer"></a>Создание консольного приложения для объекта-получателя OLE DB

1. В меню **Файл** последовательно выберите пункты **Создать**и **Проект**.

   Откроется диалоговое окно **Новый проект** .

1. На панели **Типы проектов** щелкните папки **Установленные** > **Visual C++** > **Классическое приложение Windows**, а затем щелкните значок **Мастер классических приложений Windows** на панели **Шаблоны**. В поле **Имя** введите имя проекта, например *MyCons*.

1. Нажмите кнопку **ОК**.

   Появится мастер **Проект классического приложения Windows**.

1. На странице **Параметры приложения** выберите **Консольное приложение**, а затем выберите **Add common header files for ATL** (Добавить общие файлы заголовков для ATL).

1. Щелкните **ОК**, чтобы закрыть мастер и создать проект.

Затем используйте **мастер объекта-получателя ATL OLE DB**, чтобы добавить объект объекта-получателя OLE DB.

## <a name="to-create-a-consumer-with-the-atl-ole-db-consumer-wizard"></a>Создание объекта-получателя с помощью мастера объекта-получателя ATL OLE DB

1. В **обозревателе решений** щелкните правой кнопкой мыши проект `MyCons`.

1. В контекстном меню выберите **Добавить** и **Новый элемент**.

   Откроется диалоговое окно **Добавление нового элемента**.

1. На панели **Категории** щелкните **Установленные** > **Visual C++** > **Библиотека ATL**, щелкните значок **Объект-получатель OLEDB библиотеки ATL** на панели **Шаблоны**, а затем выберите **Добавить**.

   Появится **мастер объекта-получателя ATL OLEDB**.

1. Нажмите кнопку **Источник данных**.

   Появится диалоговое окно **Data Link Properties** (Свойства канала передачи данных).

1. В диалоговом окне **Data Link Properties** (Свойства канала передачи данных) сделайте следующее.

   1. На вкладке **Поставщик** укажите поставщика OLE DB.

   1. На вкладке **Подключение** укажите необходимые данные, такие как имя сервера, идентификатор входа и пароль для источника данных и базы данных на сервере.

      > [!NOTE]
      > Возникла проблема безопасности с функцией **Разрешить сохранение пароля** диалогового окна **Data Link Properties** (Свойства канала передачи данных). В области **Enter information to log on to the server** (Введите данные для входа на сервер) есть два переключателя: **Использовать встроенную систему безопасности Windows NT** и **Использование указанных имени пользователя и пароля**.

      > [!NOTE]
      > Если вы выберете **Использование указанных имени пользователя и пароля**, появится возможность сохранить пароль (с помощью флажка **Разрешить сохранение пароля**); тем не менее, этот параметр небезопасен. Рекомендуется выбрать **Использовать встроенную систему безопасности Windows NT**; этот параметр использует Windows NT для подтверждения личности.

      > [!NOTE]
      > Если нельзя использовать встроенную систему безопасности Windows NT, необходимо использовать приложение промежуточного уровня, чтобы запросить у пользователя пароль или сохранить пароль в расположении с механизмом безопасности (а не в исходном коде) для обеспечения его безопасности.

   1. После выбора поставщика и других параметров щелкните **Проверить подключение**, чтобы проверить параметры, выбранные на предыдущих страницах диалогового окна. Если в поле **Результаты** появится сообщение `Test connection succeeded`, щелкните **ОК**, чтобы создать канал передачи данных.

   Появится диалоговое окно **Выберите объект базы данных**.

1. Используйте элемент управления в виде дерева, чтобы выбрать таблицу, представление или хранимую процедуру. Для этого примера выберите таблицу `Products` из базы данных `Northwind`.

1. Нажмите кнопку **ОК**. При этом произойдет возврат в **мастер объекта-получателя ATL OLE DB**.

1. Мастер создает имена для `Class` и **H-файла** на основе имени таблицы, представления или хранимой процедуры, которые вы выбрали. При необходимости эти имена можно заменить.

1. Снимите флажок **Attributed** (С атрибутами), чтобы мастер создал код объекта-получателя, используя [классы шаблонов OLE DB](../../data/oledb/ole-db-consumer-templates-reference.md) вместо [атрибутов объекта-получателя OLE DB](../../windows/ole-db-consumer-attributes.md) по умолчанию.

1. В разделе **Тип** выберите **Команда**.

   Мастер создает объект-получатель на основе [CCommand](../../data/oledb/ccommand-class.md), если вы выберете **Команда**, или [CTable](../../data/oledb/ctable-class.md), если вы выберете **Таблица**. Имя класса таблицы или команды соответствует выбранному объекту, но вы можете его изменить.

1. В разделе **Поддержка** оставьте пустыми поля **Изменить**, **Вставить** и **Удалить**.

   Установите флажки **Изменить**, **Вставить** и **Удалить** для поддержки изменения, вставки и удаления записей в наборе строк. Дополнительные сведения о записи данных в хранилище данных см. в статье [Updating Rowsets](../../data/oledb/updating-rowsets.md) (Обновление наборов строк).

1. Щелкните **Готово**, чтобы создать объект-получатель.

Мастер создает класс команд и класс записей пользователя, как показано в статье [Consumer Wizard-Generated Classes](../../data/oledb/consumer-wizard-generated-classes.md) (Классы, создаваемые мастером объекта-получателя). Класс команд будет иметь имя, указанное вами в поле `Class` мастера (в этом случае `CProducts`), а класс записей пользователя получит имя в форме "*Имя класса*Accessor" (в этом случае `CProductsAccessor`).

> [!NOTE]
> Мастер помещает следующую строку в `Products.h`:

```cpp
#error Security Issue: The connection string may contain a password
```

> [!NOTE]
> Эта строка предотвращает компиляцию приложения объекта-получателя и напоминает о проверке строки подключения для паролей, жестко заданных в коде. После проверки строки подключения можно удалить эту строку из кода.

::: moniker-end

## <a name="see-also"></a>См. также

[Создание объекта-получателя OLE DB с помощью мастера](../../data/oledb/creating-an-ole-db-consumer-using-a-wizard.md)
