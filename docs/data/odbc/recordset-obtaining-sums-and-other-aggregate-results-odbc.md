---
title: Набор записей. Определение сумм и других статистических результатов (ODBC)
ms.date: 11/04/2016
helpviewer_keywords:
- SQL, retrieving aggregate values from recordsets
- recordsets, retrieving SQL aggregate values
- retrieving SQL aggregate values from recordsets
- ODBC recordsets, retrieving SQL aggregate values
- SQL aggregate values
- SQL Server projects, retrieving aggregate values from recordsets
- SQL aggregate values, retrieving from recordsets
ms.assetid: 94500662-22a4-443e-82d7-acbe6eca447b
ms.openlocfilehash: 1a8abc8b73ee878ac2feefa210268e87c608e938
ms.sourcegitcommit: 857fa6b530224fa6c18675138043aba9aa0619fb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/24/2020
ms.locfileid: "80212840"
---
# <a name="recordset-obtaining-sums-and-other-aggregate-results-odbc"></a>Набор записей. Определение сумм и других статистических результатов (ODBC)

> [!NOTE]
> Мастер потребителя MFC ODBC недоступен в Visual Studio 2019 и более поздних версиях. При этом вы по-прежнему можете создать потребитель вручную.

Этот раздел относится к классам ODBC библиотеки MFC.

В этой статье объясняется, как получить статистические результаты с помощью следующих ключевых слов [SQL](../../data/odbc/sql.md):

- **SUM** — вычисляет сумму значений в столбце с числовым типом данных;

- **MIN** — извлекает минимальное значение из столбца с числовым типом данных;

- **MAX** — извлекает максимальное значение из столбца с числовым типом данных;

- **AVG** — вычисляет среднее всех значений в столбце с числовым типом данных;

- **COUNT** — подсчитывает число записей в столбце с числовым типом данных.

С помощью функций SQL можно получать статистическую информацию о записях в источнике данных, не извлекая эти записи из источника. Создаваемый набор записей обычно состоит из одной записи (если все столбцы являются статистическими), которая содержит значение. (При использовании предложения **Group By** может существовать несколько записей.) Это значение является результатом вычисления или извлечения, выполненного функцией SQL.

> [!TIP]
>  Чтобы добавить предложение SQL **GROUP BY** и, возможно, предложение **HAVING** в инструкцию SQL, добавьте их в конце `m_strFilter`. Пример:

```
m_strFilter = "sales > 10 GROUP BY SALESPERSON_ID";
```

Количество записей, используемых для получения статистических результатов, можно ограничить путем фильтрации и сортировки столбцов.

> [!CAUTION]
>  Некоторые статистические операторы возвращают данные не того типа, который имеют обрабатываемые столбцы.

- **SUM** и **AVG** могут возвращать следующий по величине тип данных (например, при вызове применительно к типу `int` возвращается **LONG** или **double**).

- **COUNT** обычно возвращает **LONG** независимо от типа целевого столбца.

- **MAX** и **MIN** возвращают тот же тип данных, который имеют обрабатываемые столбцы.

     Например, мастер **добавления классов** создает `long` `m_lSales` для размещения столбца Sales, но его необходимо заменить на элемент данных `double m_dblSumSales`, чтобы он соответствовал статистическому результату. См. указанный ниже пример.

#### <a name="to-obtain-an-aggregate-result-for-a-recordset"></a>Получение статистического результата для набора записей

1. Создайте набор записей со столбцами, для которых нужно получить статистические результаты, как описано в статье [Добавление потребителя ODBC MFC](../../mfc/reference/adding-an-mfc-odbc-consumer.md).

1. Измените функцию [DoFieldExchange](../../mfc/reference/crecordset-class.md#dofieldexchange) для набора записей. Замените строку, представляющую имя столбца (второй аргумент в вызове функции [RFX](../../data/odbc/record-field-exchange-using-rfx.md)), строкой, представляющей статистическую функцию для столбца. Например, замените:

    ```
    RFX_Long(pFX, "Sales", m_lSales);
    ```

     вставьте

    ```
    RFX_Double(pFX, "Sum(Sales)", m_dblSumSales)
    ```

1. Откройте набор записей. Результат статистической операции находится слева в `m_dblSumSales`.

> [!NOTE]
>  Мастер присваивает имена элементов данных без префиксов в венгерской нотации. Например, для столбца Sales мастер создаст имя `m_Sales`, а не `m_lSales`, которое использовалось ранее для демонстрации.

Если для просмотра данных используется класс [CRecordView](../../mfc/reference/crecordview-class.md), нужно изменить вызов функции DDX для отображения нового значения элемента данных. В данном случае его нужно изменить с:

```
DDX_FieldText(pDX, IDC_SUMSALES, m_pSet->m_lSales, m_pSet);
```

на:

```
DDX_FieldText(pDX, IDC_SUMSALES, m_pSet->m_dblSumSales, m_pSet);
```

## <a name="see-also"></a>См. также раздел

[Набор записей (ODBC)](../../data/odbc/recordset-odbc.md)<br/>
[Набор записей. Порядок выборки записей в наборе (ODBC)](../../data/odbc/recordset-how-recordsets-select-records-odbc.md)
