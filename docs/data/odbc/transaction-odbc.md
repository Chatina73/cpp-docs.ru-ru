---
description: 'Дополнительные сведения: Transaction (ODBC)'
title: Транзакция (ODBC)
ms.date: 11/04/2016
helpviewer_keywords:
- ODBC recordsets [C++], updating
- transactions [C++], MFC ODBC classes
- ODBC [C++], transactions
- recordsets [C++], updating
- databases [C++], transactions
- recordsets [C++], transactions
- ODBC recordsets [C++], transactions
ms.assetid: a2ec0995-2029-45f2-8092-6efd6f2a77f4
ms.openlocfilehash: a7b769c37b58b34433939a18cb0dccf5fb4a798d
ms.sourcegitcommit: d6af41e42699628c3e2e6063ec7b03931a49a098
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2020
ms.locfileid: "97333865"
---
# <a name="transaction-odbc"></a>Транзакция (ODBC)

Этот раздел относится к классам ODBC библиотеки MFC.

Транзакция — это способ группирования или пакетной обработки ряда обновлений [источника данных](../../data/odbc/data-source-odbc.md) , чтобы все они зафиксировались один раз или ни один из которых не фиксируется при откате транзакции. Если транзакция не используется, изменения в источнике данных фиксируются автоматически, а не фиксируются по требованию.

> [!NOTE]
> Не все драйверы базы данных ODBC поддерживают транзакции. Вызовите `CanTransact` функцию-член объекта [CDatabase](../../mfc/reference/cdatabase-class.md) или [CRecordset](../../mfc/reference/crecordset-class.md) , чтобы определить, поддерживает ли драйвер транзакции для заданной базы данных. Обратите внимание, что не указывает, `CanTransact` обеспечивает ли источник данных полную поддержку транзакций. Также необходимо вызвать метод `CDatabase::GetCursorCommitBehavior` и и, `CDatabase::GetCursorRollbackBehavior` `CommitTrans` `Rollback` чтобы проверить результат транзакции в открытом `CRecordset` объекте.

Вызовы `AddNew` `Edit` функций-членов и `CRecordset` объекта немедленно влияют на источник данных при вызове `Update` . `Delete` вызовы также вступают в силу немедленно. В отличие от этого, можно использовать транзакцию, состоящую из нескольких вызовов функций `AddNew` ,, `Edit` `Update` и `Delete` , которые выполняются, но не фиксируются до `CommitTrans` явного вызова метода. Установив транзакцию, можно выполнить ряд таких вызовов, сохранив возможность их отката. Если критический ресурс недоступен или какое-либо другое условие не позволяет завершить всю транзакцию, можно выполнить откат транзакции вместо ее фиксации. В этом случае ни один из изменений, относящихся к транзакции, не влияет на источник данных.

> [!NOTE]
> В настоящее время класс не `CRecordset` поддерживает обновления источника данных, если реализована многострочная выборка строк. Это означает, что нельзя вызывать `AddNew` , `Edit` , `Delete` или `Update` . Однако можно написать собственные функции для выполнения обновлений, а затем вызывать эти функции в рамках данной транзакции. Дополнительные сведения о групповой выборке строк см. [в разделе набор записей. сбор записей (ODBC)](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md).

> [!NOTE]
> Кроме влияния на набор записей, транзакции влияют на инструкции SQL, выполняемые напрямую, при условии использования **ХДБК** ODBC, связанного с `CDatabase` объектом, или **хстмт** ODBC на основе этого **хдбк**.

Транзакции особенно полезны при наличии нескольких записей, которые необходимо обновить одновременно. В этом случае необходимо избежать пропускной транзакции, такой как может произойти, если было создано исключение до последнего обновления. Группирование таких обновлений в транзакции позволяет выполнить восстановление (откат) из изменений и возвратить записи в состояние предтранзакции. Например, если банк передает деньги с учетной записи A в счет B, то изъятие из и депозит в B должно успешно пройти для корректной обработки фондов, иначе вся транзакция должна завершиться ошибкой.

В классах базы данных транзакции выполняются с помощью `CDatabase` объектов. `CDatabase`Объект представляет соединение с источником данных, а один или несколько наборов записей, связанных с этим объектом, `CDatabase` работают с таблицами базы данных с помощью функций-членов набора записей.

> [!NOTE]
> Поддерживается только один уровень транзакций. Нельзя вкладывать транзакции и не могут охватывать несколько объектов базы данных.

В следующих разделах содержатся дополнительные сведения о выполнении транзакций.

- [Транзакция: выполнение транзакции в наборе записей (ODBC)](../../data/odbc/transaction-performing-a-transaction-in-a-recordset-odbc.md)

- [Транзакция: влияние транзакций на обновления (ODBC)](../../data/odbc/transaction-how-transactions-affect-updates-odbc.md)

## <a name="see-also"></a>См. также раздел

[Открытие подключения к базе данных (ODBC)](../../data/odbc/open-database-connectivity-odbc.md)
