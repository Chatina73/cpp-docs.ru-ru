---
title: Транзакция (ODBC)
ms.date: 11/04/2016
helpviewer_keywords:
- ODBC recordsets [C++], updating
- transactions [C++], MFC ODBC classes
- ODBC [C++], transactions
- recordsets [C++], updating
- databases [C++], transactions
- recordsets [C++], transactions
- ODBC recordsets [C++], transactions
ms.assetid: a2ec0995-2029-45f2-8092-6efd6f2a77f4
ms.openlocfilehash: 56629f8c5ff74aff4e0df589cda1e7b988fb5fd3
ms.sourcegitcommit: c123cc76bb2b6c5cde6f4c425ece420ac733bf70
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81376413"
---
# <a name="transaction-odbc"></a>Транзакция (ODBC)

Этот раздел относится к классам ODBC библиотеки MFC.

Транзакция — это способ сгруппировать или пакетную серию обновлений [источника данных,](../../data/odbc/data-source-odbc.md) чтобы все они были зафиксированы одновременно или ни один не был зафиксирован при откате транзакции. Если вы не используете транзакцию, изменения в источнике данных фиксируются автоматически, а не совершаются по требованию.

> [!NOTE]
> Не все драйверы базы данных ODBC поддерживают транзакции. Позвоните `CanTransact` функции участника вашего объекта [CDatabase](../../mfc/reference/cdatabase-class.md) или [CRecordset,](../../mfc/reference/crecordset-class.md) чтобы определить, поддерживает ли ваш драйвер транзакции для данной базы данных. Обратите `CanTransact` внимание, что не говорится о том, обеспечивает ли источник данных полную поддержку транзакций. Необходимо также `CDatabase::GetCursorCommitBehavior` вызвать `CommitTrans` `Rollback` и `CDatabase::GetCursorRollbackBehavior` после и проверить влияние `CRecordset` транзакции на открытый объект.

Вызовы `AddNew` на `Edit` функции `CRecordset` и функции члена объекта `Update`влияют на источник данных сразу же при вызове. `Delete`звонки также вснят немедленно. В отличие от этого, вы можете использовать `AddNew` `Edit`транзакцию, `Delete`состоящую из нескольких вызовов `CommitTrans` в `Update`, и , которые выполняются, но не совершаются, пока вы не позвоните явно. Установив транзакцию, можно выполнить серию таких вызовов, сохранив при этом возможность их отката. Если критический ресурс недоступен или какое-либо другое условие препятствует завершению всей транзакции, можно откатить транзакцию вместо того, чтобы ее совершить. В этом случае ни одно из изменений, относящихся к транзакции, не влияет на источник данных.

> [!NOTE]
> В настоящее время класс `CRecordset` не поддерживает обновления источника данных, если вы реализовали объемстроки извлечения. Это `AddNew`означает, `Edit` `Delete`что вы не `Update`можете совершать звонки, или . Тем не менее, вы можете написать свои собственные функции для выполнения обновлений, а затем вызвать эти функции в рамках данной транзакции. Для получения дополнительной информации о массовом строке извлечения, см [Recordset: Извлечение записей в массовых (ODBC)](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md).

> [!NOTE]
> Помимо влияния на ваш набор записей, транзакции влияют на операторы, которые `CDatabase` вы выполняете непосредственно до тех пор, пока вы используете ODBC **HDBC,** связанный с вашим объектом, или ODBC **HSTMT** на основе **этого HDBC.**

Транзакции особенно полезны, когда у вас есть несколько записей, которые должны обновляться одновременно. В этом случае необходимо избежать полузавершенной транзакции, например, если было сделано исключение до того, как было сделано последнее обновление. Группировка таких обновлений в транзакцию позволяет восстановить (откат) от изменений и возвращает записи в состояние предварительной транзакции. Например, если банк переводит деньги со счета А на счет В, как снятие средств с А, так и депозит в Б должны быть успешными для правильной обработки средств или вся транзакция должна потерпеть неудачу.

В классах баз данных `CDatabase` выполняется транзакции через объекты. Объект `CDatabase` представляет собой подключение к источнику данных, и `CDatabase` один или несколько записей, связанных с этим объектом, работают на таблицах базы данных через функции члена записи.

> [!NOTE]
> Поддерживается только один уровень транзакций. Вы не можете гнездить транзакции, а транзакция может охватывать несколько объектов базы данных.

Ниже приведены более подробная информация о том, как выполняются транзакции:

- [Транзакция. Выполнение транзакции в наборе записей (ODBC)](../../data/odbc/transaction-performing-a-transaction-in-a-recordset-odbc.md)

- [Транзакция. Влияние транзакций на обновления (ODBC)](../../data/odbc/transaction-how-transactions-affect-updates-odbc.md)

## <a name="see-also"></a>См. также раздел

[Открытая связь с базами данных (ODBC)](../../data/odbc/open-database-connectivity-odbc.md)
