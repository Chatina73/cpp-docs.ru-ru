---
title: Динамический набор
ms.date: 11/04/2016
helpviewer_keywords:
- ODBC recordsets, dynasets
- ODBC cursor library [ODBC], dynasets
- keyset-driven cursors in dynasets
- cursors [ODBC], keyset-driven cursors in dynasets
- cursor library [ODBC], dynaset availability
- recordsets [C++], dynasets
- dynasets
ms.assetid: 2867e6be-208e-4fe7-8bbe-b8697cb1045c
ms.openlocfilehash: 2eb2447d1f984b7734d5e9c45087023e5a6f003f
ms.sourcegitcommit: c123cc76bb2b6c5cde6f4c425ece420ac733bf70
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81371842"
---
# <a name="dynaset"></a>Динамический набор

Эта тема описывает динасеты и обсуждает их [доступность.](#_core_availability_of_dynasets)

> [!NOTE]
> Эта тема относится к классам MFC ODBC, включая [CRecordset.](../../mfc/reference/crecordset-class.md) Для получения информации о динасетах в классах DAO [см.](../../mfc/reference/cdaorecordset-class.md) С DAO вы можете открывать рекорды типа динасета.

Динасет — это рекорд с динамическими свойствами. В течение своего срока службы объект записи в режиме dynaset (обычно называемый динасет) остается синхронизированным с источником данных следующим образом. В многопользовательской среде другие пользователи могут отсеивать или удалять записи, которые находятся в вашем динасеже, или добавлять записи в таблицу, которую представляет ваш динасет. Записи, добавленные приложение или удаленные из набора записей, отражаются в вашем динасете. Записи, которые другие пользователи добавляют в таблицу, не будут отражены в `Requery` вашем dynaset до тех пор, пока вы не восстановите dynaset, позвонив в его функцию члена. Когда другие пользователи удаляют записи, код MFC пропускает удаления в вашем наборе записей. Изменения редактирования другими пользователями существующих записей отражаются в вашем dynaset, как только вы прокрутите к пострадавшей записи.

Аналогичным образом, вносить в записи в динасете также отражены в динасетах, используемих другими пользователями. Записи, которые вы добавляете, не отражаются в динасетах других пользователей до тех пор, пока они не заразят свои динасеты. Записи, которые вы удаляете, помечаются как "удаленные" в записях других пользователей. Если у вас есть несколько `CDatabase` подключений к одной и той же базе данных (несколько объектов), записи, связанные с этими соединениями, имеют тот же статус, что и записи других пользователей.

Динасеты наиболее ценны, когда данные должны быть динамическими, как (например) в системе бронирования авиабилетов.

> [!NOTE]
> Чтобы использовать dynasets, необходимо иметь драйвер ODBC для исходного кода данных, который поддерживает dynasets и библиотека курсора ODBC не должна быть загружена. Для получения дополнительной [информации см.](#_core_availability_of_dynasets)

Чтобы указать, что набор записей `CRecordset::dynaset` является динасетом, передайте в качестве первого параметра функции `Open` участника объекта записи.

> [!NOTE]
> Для обновленной динамики драйвер ODBC должен поддерживать либо позиционированные операторы обновления, либо функцию `::SQLSetPos` ODBC API. Если оба поддерживаются, `::SQLSetPos` MFC использует для эффективности.

## <a name="availability-of-dynasets"></a><a name="_core_availability_of_dynasets"></a>Наличие динасец

Классы баз данных MFC поддерживают dynasets, если выполнены следующие требования:

- Библиотека курсора ODBC DLL не должна использоваться для этого источника данных.

   Если используется библиотека курсора, она маскирует некоторые функциональные возможности базового драйвера ODBC, необходимые для поддержки dynaset. Если вы хотите использовать dynasets (и ваш драйвер ODBC имеет функциональность, необходимую для динасетей, как описано в остальной части `CDatabase` этого раздела), вы можете заставить MFC не загружать библиотеку курсора при создании объекта. Для получения дополнительной [Open](../../mfc/reference/cdatabase-class.md#open) информации `CDatabase` [OpenEx](../../mfc/reference/cdatabase-class.md#openex) [см.](../../data/odbc/odbc-basics.md)

   В терминологии ODBC динасеты и снимки называются курсорами. Курсор — это механизм, используемый для отслеживания его положения в рекордном наборе.

- Драйвер ODBC для вашего источника данных должен поддерживать курсоры, управляемые ключами.

   Курсоры, управляемые клавиатурой, управляют данными из таблицы, получая и храня набор ключей. Ключи используются для получения текущих данных из таблицы, когда пользователь прокручивает на определенную запись. Чтобы определить, обеспечивает ли драйвер `::SQLGetInfo` эту поддержку, позвоните в функцию ODBC API с параметром *SQL_SCROLL_OPTIONS.*

   Если вы попытаетесь открыть dynaset без поддержки клавиатуры, вы получите `CDBException` значение обратного кода AFX_SQL_ERROR_DYNASET_NOT_SUPPORTED.

- Драйвер ODBC для вашего источника данных должен поддерживать расширенный извлечение.

   Расширенный извлечения — это возможность прокрутки как назад, так и вперед по полученным записям вашего запроса S'L. Чтобы определить, поддерживает ли драйвер `::SQLGetFunctions` эту способность, позвоните в функцию ODBC API с параметром *SQL_API_SQLEXTENDEDFETCH.*

Если вы хотите обновляемые динасеты (или снимки, если на `::SQLSetPos` то пошло), ваш драйвер ODBC должен также поддерживать функцию ODBC API или позиционированные обновления. Функция `::SQLSetPos` позволяет MFC обновлять источник данных без отправки заявлений s-L. Если эта поддержка доступна, MFC использует ее в предпочтении для создания обновлений с помощью S'L. Чтобы определить, поддерживает `::SQLSetPos`ли `::SQLGetInfo` ваш драйвер, позвоните с *параметром SQL_POS_OPERATIONS.*

Позиционируемые обновления используют синтаксис S'L (формы **WHERE CURRENT of** \<cursorname>) для определения определенной строки в таблице на источнике данных. Чтобы определить, поддерживает ли драйвер `::SQLGetInfo` позиционированные обновления, позвоните по *SQL_POSITIONED_STATEMENTS* параметру.

Как правило, динасеты MFC (но не только для рекордов) требуют драйвера ODBC с соответствием API уровня 2. Если драйвер для исходного кода данных соответствует установлению API уровня 1, вы все равно можете использовать как обновляемые и только для чтения снимки, так и записи только для чтения, но не динасеты. Тем не менее, драйвер уровня 1 может поддерживать dynasets, если он поддерживает расширенные курсоры извлечения и клавиши. Для получения дополнительной информации об уровнях соответствия ODBC, [см.](../../data/odbc/odbc-basics.md)

> [!NOTE]
> Если вы хотите использовать как снимки, так и динасеты, вы должны основывать их на двух разных `CDatabase` объектах (два разных соединения).

В отличие от снимков, которые используют промежуточное хранилище, поддерживаемое библиотекой курсоров ODBC, dynasets извлекают запись непосредственно из источника данных, как только вы прокрутите к нему. При этом записи, первоначально выбранные динасетом, синхронизированы с исходным источником данных.

Список драйверов ODBC, включенных в эту версию Visual C++, и сведения о получении дополнительных драйверов см. в статье [Список драйверов ODBC](../../data/odbc/odbc-driver-list.md).

## <a name="see-also"></a>См. также раздел

[Открытая связь с базами данных (ODBC)](../../data/odbc/open-database-connectivity-odbc.md)
