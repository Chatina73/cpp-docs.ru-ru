---
title: Источник данных. Программная настройка источника данных ODBC
ms.date: 11/04/2016
f1_keywords:
- SQLConfigDataSource
helpviewer_keywords:
- ODBC data sources, configuring
- SQLConfigDataSource method example
- ODBC connections, configuring
- configuring ODBC data sources
ms.assetid: b8cabe9b-9e12-4d73-ae36-7cb12dee3213
ms.openlocfilehash: 38f0f383256a05c983fb7e7d7a498e16881c7b78
ms.sourcegitcommit: 63784729604aaf526de21f6c6b62813882af930a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/17/2020
ms.locfileid: "79545963"
---
# <a name="data-source-programmatically-configuring-an-odbc-data-source"></a>Источник данных. Программная настройка источника данных ODBC

В этом разделе объясняется, как можно настроить имена источников данных ODBC программным способом. Это обеспечивает гибкость доступа к данным, не вынуждая пользователя явно использовать администратора ODBC или другие программы для указания имен источников данных.

Как правило, пользователь запускает администратор ODBC для создания источника данных, если соответствующая система управления базами данных (СУБД) поддерживает эту операцию.

При создании источника данных ODBC для Microsoft Access с помощью администратора ODBC вы получите два варианта: можно выбрать существующий MDB-файл или создать новый MDB-файл. Нет программного способа создания MDB-файла из приложения MFC ODBC. Поэтому, если приложение требует, чтобы данные были размещены в источнике данных Microsoft Access (MDB-файл), скорее всего, потребуется пустой MDB-файл, который можно использовать или копировать при необходимости.

Однако многие СУБД позволяют создавать программные источники данных. Некоторые источники данных поддерживают спецификацию каталога для баз данных. Это значит, что каталог является источником данных, а каждая таблица в источнике данных хранится в отдельном файле (в случае с dBASE каждая таблица является DBF-файлом). Драйверы для других баз данных ODBC, таких как Microsoft Access и SQL Server, перед установкой источника данных должны удовлетворять определенным критериям. Например, при использовании драйвера ODBC SQL Server необходимо установить компьютер SQL Server.

##  <a name="sqlconfigdatasource-example"></a><a name="_core_sqlconfigdatasource_example"></a>Пример SQLConfigDataSource

В следующем примере используется функция `::SQLConfigDataSource` ODBC API для создания нового источника данных Excel с именем новый источник данных Excel.

```
SQLConfigDataSource(NULL,ODBC_ADD_DSN, "Excel Files (*.xls)",
                   "DSN=New Excel Data Source\0"
                   "Description=New Excel Data Source\0"
                   "FileType=Excel\0"
                   "DataDirectory=C:\\EXCELDIR\0"
                   "MaxScanRows=20\0");
```

Обратите внимание, что источник данных фактически является каталогом (К:\ЕКСЦЕЛДИР); Этот каталог должен существовать. Драйвер Excel использует каталоги в качестве источников данных и файлов в качестве отдельных таблиц (одна таблица на каждый xls-файл).

Дополнительные сведения о создании таблиц см. [в разделе Data Source: программное создание таблицы в источнике данных ODBC](../../data/odbc/data-source-programmatically-creating-a-table-in-an-odbc-data-source.md).

Ниже приведены сведения о параметрах, которые необходимо передать функции `::SQLConfigDataSource` ODBC API. Чтобы использовать `::SQLConfigDataSource`, необходимо включить файл заголовка Odbcinst. h и использовать библиотеку импорта Odbcinst. lib. Кроме того, Odbccp32. dll должен находиться в пути во время выполнения (или Odbcinst. dll для 16 разрядов).

Можно создать имя источника данных ODBC с помощью администратора ODBC или аналогичной служебной программы. Однако иногда желательно создать имя источника данных непосредственно из приложения, чтобы получить доступ, не требуя от пользователя запуска отдельной служебной программы.

Администратор ODBC (обычно установленный на панели управления) создает новый источник данных, помещая записи в реестр Windows (или для 16-разрядных систем в файл ODBC. ini). Диспетчер драйверов ODBC запрашивает этот файл для получения необходимых сведений об источнике данных. Важно знать, какие сведения необходимо поместить в реестр, так как их необходимо указать с помощью вызова `::SQLConfigDataSource`.

Хотя эта информация может быть записана непосредственно в реестр без использования `::SQLConfigDataSource`, любое приложение, которое делает это, полагается на текущий метод, используемый диспетчером драйверов для обслуживания своих данных. Если более поздняя версия диспетчера драйверов ODBC реализует запись об источниках данных по-другому, любое приложение, использующее этот метод, будет разорвано. Как правило, рекомендуется использовать функцию API, если она предоставляется. Например, код переносим с 16-разрядного на 32 бит при использовании функции `::SQLConfigDataSource`, поскольку функция правильно записывает данные в файл ODBC. ini или в реестр.

##  <a name="sqlconfigdatasource-parameters"></a><a name="_core_sqlconfigdatasource_parameters"></a>Параметры SQLConfigDataSource

Ниже объясняются параметры функции `::SQLConfigDataSource`. Большая часть информации взята из *Справочника программиста* API ODBC, предоставляемого в C++ Visual версии 1,5 и более поздних версиях.

###  <a name="function-prototype"></a><a name="_core_function_prototype"></a>Прототип функции

```
BOOL SQLConfigDataSource(HWND hwndParent,UINT fRequest, LPCSTR lpszDriver, LPCSTR lpszAttributes);
```

### <a name="remarks"></a>Примечания

####  <a name="parameters-and-usage"></a><a name="_core_parameters_and_usage"></a>Параметры и использование

*хвндпарент*<br/>
Окно, заданное как владелец любого диалогового окна, создаваемого диспетчером драйверов ODBC или конкретным драйвером ODBC для получения дополнительных сведений от пользователя о новом источнике данных. Если параметр *лпсзаттрибутес* не предоставляет достаточно сведений, появляется диалоговое окно. Параметр *хвндпарент* может иметь значение null.

*лпсздривер*<br/>
Описание драйвера. Это имя, представляемое пользователям вместо физического имени драйвера (DLL).

*лпсзаттрибутес*<br/>
Список атрибутов в формате "keyName = value". Эти строки разделяются знаками конца со значением NULL с двумя последовательными концами NULL в конце списка. Эти атрибуты, в первую очередь, представляют собой записи, относящиеся к драйверу по умолчанию, которые записываются в реестр для нового источника данных. Одним важным ключом, который не упоминается в справочнике по API ODBC для этой функции, является DSN (имя источника данных), который указывает имя нового источника данных. Остальные записи относятся к драйверу для нового источника данных. Часто необязательно указывать все записи, так как драйвер может предложить пользователю диалоговые окна для новых значений. (Чтобы это сделать, задайте для *хвндпарент* значение null.) Может потребоваться явно указать значения по умолчанию, чтобы пользователь не захотел запрос.

#### <a name="to-determine-the-description-of-a-driver-for-the-lpszdriver-parameter-using-odbc-administrator"></a>Определение описания драйвера для параметра Лпсздривер с помощью администратора ODBC

1. Запустите администратор ODBC.

1. Нажмите кнопку **Добавить**.

В результате вы получите список установленных драйверов и их описания. Используйте это описание в качестве параметра *лпсздривер* . Обратите внимание, что вы используете все описание, например "файлы Excel (*. xls)", включая расширение имени файла и круглые скобки, если они существуют в описании.

В качестве альтернативы можно просмотреть реестр (или, например, для 16-разрядного файла Odbcinst. ini), содержащий список всех записей и описаний драйверов в разделе реестра "Drivers ODBC" (или в разделе [драйверы ODBC] в Odbcinst. ini).

Одним из способов поиска кэйнамес и значений для параметра *лпсзаттрибутес* является проверка файла ODBC. ini на наличие уже настроенного источника данных (возможно, что он был настроен администратором ODBC).

#### <a name="to-find-keynames-and-values-for-the-lpszattributes-parameter"></a>Поиск кэйнамес и значений для параметра Лпсзаттрибутес

1. Запустите редактор реестра Windows (или, для 16-разрядного, откройте файл ODBC. ini).

1. Найдите сведения об источниках данных ODBC одним из следующих источников:

   - Для 32 разрядов найдите ключ **HKEY_CURRENT_USER \софтваре\одбк\одбк. ИНИ\ОДБК источники данных** на левой панели.

      На правой панели перечислены записи в форме: "Pub: REG_SZ: *\<имя источника данных >* ", где *\<имя источника данных >* — это источник данных, который уже настроен с нужными параметрами для драйвера, который вы собираетесь использовать. Выберите нужный источник данных, например SQL Server. Элементы, следующие за строкой "Pub:", — это, по порядку, keyName и value, используемые в параметре *лпсзаттрибутес* .

   - В случае 16-разрядной версии найдите раздел в файле ODBC. ini, помеченный [ *\<имя источника данных >* ].

      Строки, следующие за этой строкой, имеют вид "keyName = value". Это именно те записи, которые нужно использовать в параметре *лпсзаттрибутес* .

Также может потребоваться изучить документацию по конкретному драйверу, который вы собираетесь использовать. Полезные сведения можно найти в интерактивной справке по драйверу, доступ к которому можно получить, запустив Администратор ODBC. Эти файлы справки обычно размещаются в каталоге ВИНДОВС\СИСТЕМ для Windows NT, Windows 3,1 или Windows 95.

#### <a name="to-obtain-online-help-for-your-odbc-driver"></a>Получение справки в Интернете по драйверу ODBC

1. Запустите администратор ODBC.

1. Нажмите кнопку **Добавить**.

1. Выберите имя драйвера.

1. Нажмите кнопку **ОК**.

Когда администратор ODBC отображает сведения о создании нового источника данных для данного драйвера, нажмите кнопку **Справка**. Откроется файл справки для конкретного драйвера, который обычно содержит важные сведения об использовании драйвера.

## <a name="see-also"></a>См. также:

[Источник данных (ODBC)](../../data/odbc/data-source-odbc.md)
