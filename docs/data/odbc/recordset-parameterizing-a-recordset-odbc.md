---
title: Набор записей. Параметризация набора записей (ODBC)
ms.date: 11/04/2016
helpviewer_keywords:
- parameterizing recordsets
- ODBC recordsets, parameterizing
- recordsets, parameterizing
- passing parameters, to queries at runtime
ms.assetid: 7d1dfeb6-5ee0-45e2-aacc-63bc52a465cd
ms.openlocfilehash: f58a33a0c43cb0d70d98f3f2ae33f766058b1c23
ms.sourcegitcommit: 1819bd2ff79fba7ec172504b9a34455c70c73f10
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/09/2018
ms.locfileid: "51331273"
---
# <a name="recordset-parameterizing-a-recordset-odbc"></a>Набор записей. Параметризация набора записей (ODBC)

Этот раздел относится к классам ODBC библиотеки MFC.

Иногда может потребоваться получить возможность выбора записи во время выполнения, используя информацию, вычисленные или полученные от конечного пользователя. Параметры набора записей позволяют это сделать.

Содержание раздела:

- [Цель параметризированные наборы записей](#_core_parameterized_recordsets).

- [Когда и почему может потребоваться параметризация набора записей](#_core_when_to_use_parameters).

- [Как объявить параметр, данные-члены в классе набора записей](#_core_parameterizing_your_recordset_class).

- [Как передать сведения о параметрах на объект набора записей во время выполнения](#_core_passing_parameter_values_at_run_time).

##  <a name="_core_parameterized_recordsets"></a> Параметризированные наборы записей

Параметризированные наборы записей позволяют передавать сведения о параметрах во время выполнения. Это обладает двумя преимуществами:

- Это может привести к повышать скорость выполнения.

- Он позволяет создать запрос во время выполнения, в зависимости от информации, недоступной во время разработки, такие как сведения, полученные от пользователя или вычисляется во время выполнения.

При вызове `Open` для выполнения запроса, набор записей использует сведения о параметрах для завершения его **SQL SELECT** инструкции. Позволяют задавать параметры для любого набора записей.

##  <a name="_core_when_to_use_parameters"></a> Когда следует использовать параметры

Типичные способы использования для параметров:

- Передача аргументов времени выполнения для предопределенного запроса.

   Чтобы передать параметры в хранимую процедуру, необходимо указать полный пользовательский ODBC **вызвать** инструкции — с помощью заполнителей параметров — при вызове `Open`, переопределяя SQL набора записей по умолчанию. Дополнительные сведения см. в разделе [CRecordset::Open](../../mfc/reference/crecordset-class.md#open) в *Справочник по библиотеке классов* и [SQL: инструкция SQL Настройка набора записей (ODBC)](../../data/odbc/sql-customizing-your-recordsets-sql-statement-odbc.md) и [ Набор записей: Объявление класса для предопределенного запроса (ODBC)](../../data/odbc/recordset-declaring-a-class-for-a-predefined-query-odbc.md).

- Эффективное выполнение нескольких повторных запросов с сведения о различных параметрах.

   Например каждый раз, когда конечный пользователь ищет сведения для определенного студента в базе данных регистрации учащихся, можно указать имя или идентификатор учащегося как параметр, полученный от пользователя. Затем, при вызове набора записей `Requery` функция-член, запрос выбирает только запись этого учащегося.

   Строка фильтра набора записей, хранящихся в `m_strFilter`, может выглядеть следующим образом:

    ```cpp
    "StudentID = ?"
    ```

   Предположим, что вы получите идентификатор учащегося в переменной `strInputID`. Если для параметра задано значение `strInputID` (например, 100 идентификатор студента) значение переменной привязан к прототипу параметра, представленного «?» в строке фильтра.

   Значение параметра присваивается следующим образом:

    ```cpp
    strInputID = "100";
    ...
    m_strParam = strInputID;
    ```

   Не нужно задать строку фильтра таким образом:

    ```cpp
    m_strFilter = "StudentID = 100";   // 100 is incorrectly quoted
                                       // for some drivers
    ```

   О том, как правильно использовать кавычки для строк фильтрации, см. в разделе [набор записей: фильтрация записей (ODBC)](../../data/odbc/recordset-filtering-records-odbc.md).

   Значение параметра будет другим каждый раз, когда набора записей для нового идентификатора студента.

   > [!TIP]
   > С помощью параметра является более эффективным, чем применение фильтра. Для создания параметризованного набора записей базы данных необходимо обработать SQL **ВЫБЕРИТЕ** инструкции только один раз. Для набора записей без параметров **ВЫБЕРИТЕ** инструкция обрабатывается каждый раз при `Requery` с новым значением фильтра.

Дополнительные сведения о фильтрах см. в разделе [набор записей: фильтрация записей (ODBC)](../../data/odbc/recordset-filtering-records-odbc.md).

##  <a name="_core_parameterizing_your_recordset_class"></a> Параметризация набора записей класса

> [!NOTE]
> Этот раздел относится к объектам, производным от `CRecordset` в какой строке массовой выборка не был реализован. Если вы используете массовой выборки строк реализации параметров является схожим процессом. Дополнительные сведения см. в разделе [набор записей: получение записей (ODBC)](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md).

Перед созданием класса набора записей, определите, какие параметры, необходимые, каковы их типы данных и возможности их использования в наборе записей.

#### <a name="to-parameterize-a-recordset-class"></a>Параметризация набора записей класса

1. Запустите [Мастер потребителя MFC ODBC](../../mfc/reference/adding-an-mfc-odbc-consumer.md) из **Добавление класса** для создания класса.

1. Укажите поля элементов данных для столбцов набора записей.

1. После мастер создает класс в файл проекта, перейдите в h-файл и вручную добавить один или несколько элементов данных параметров в объявлении класса. Добавление может выглядеть примерно как в следующем примере, часть класса моментальных снимков для ответа на запрос «какие студенты обучаются на старших курсах?»

    ```cpp
    class CStudentSet : public CRecordset
    {
    // Field/Param Data
        CString m_strFirstName;
        CString m_strLastName;
        CString m_strStudentID;
        CString m_strGradYear;

        CString m_strGradYrParam;
    };
    ```

   Добавьте элементы данных параметра после элементами данных полей, созданный мастером. Соглашение заключается в добавлении слово «Param» имя каждого параметра, определяемые пользователем.

1. Изменить [DoFieldExchange](../../mfc/reference/crecordset-class.md#dofieldexchange) определение функции-члена в CPP-файле. Добавьте вызов функции RFX для каждого элемента данных параметра, добавленного к классу. Сведения о написании функций RFX см. в разделе [обмен полями записей: принцип работы RFX](../../data/odbc/record-field-exchange-how-rfx-works.md). Предшествовать вызовам RFX для параметров с помощью одного вызова:

    ```cpp
    pFX->SetFieldType( CFieldExchange::param );
    // RFX calls for parameter data members
    ```

1. В конструкторе класса набора записей, увеличить количество параметров `m_nParams`.

   Сведения см. в разделе [обмен полями записей: работа с кодом мастера](../../data/odbc/record-field-exchange-working-with-the-wizard-code.md).

1. При написании кода, создающего объект набора записей этого класса, поместите «?» символ (вопросительный знак) в каждом месте строки инструкции SQL, в которой должен заменить параметр.

   Во время выполнения «?» заполнители заполняются в порядке, по значениям параметров передать. Задать элемент данных первого параметра после [SetFieldType](../../mfc/reference/cfieldexchange-class.md#setfieldtype) вызов заменяет первый «? «в строке SQL, второй член данных параметра заменяет следующий»?», и т. д.

> [!NOTE]
> Порядок параметров имеет значение: последовательность вызовов RFX для параметров в вашей `DoFieldExchange` функции должен соответствовать порядку параметров-местозаполнителей в строке SQL.

> [!TIP]
> Строка, скорее всего, работать с является строка, указанная (если таковые имеются) для класса [m_strFilter](../../mfc/reference/crecordset-class.md#m_strfilter) данные-член, но некоторые драйверы ODBC могут допускать параметры в других предложениях SQL.

##  <a name="_core_passing_parameter_values_at_run_time"></a> Передача значений параметров во время выполнения

Необходимо указать значения параметров перед вызовом метода `Open` (для нового объекта набора записей) или `Requery` (для существующего).

#### <a name="to-pass-parameter-values-to-a-recordset-object-at-run-time"></a>Для передачи значений параметров на объект набора записей во время выполнения

1. Создайте объект набора записей.

1. Подготовка строки или строк, таких как `m_strFilter` строка, содержащая инструкцию SQL, или его части. Поместите «?» заполнители, где сведения о параметрах для перехода.

1. Присвоить значение параметра времени выполнения для каждого элемента данных параметра объекта.

1. Вызовите `Open` функция-член (или `Requery`, для существующего набора записей).

Например предположим, что вы хотите указать строку фильтра для набора данных, используя сведения, полученные во время выполнения. Предположим, что набор записей класса `CStudentSet` ранее — вызывается `rsStudents` и теперь необходимо сделать запрос для определенного вида информация об учащихся.

```cpp
// Set up a filter string with
// parameter placeholders
rsStudents.m_strFilter = "GradYear <= ?";

// Obtain or calculate parameter values
// to pass--simply assigned here
CString strGradYear = GetCurrentAcademicYear( );

// Assign the values to parameter data members
rsStudents.m_strGradYrParam = strGradYear;

// Run the query
if( !rsStudents.Requery( ) )
    return FALSE;
```

Набор записей содержит записи для этих учащихся, чьи записи соответствуют условиям, заданным с помощью фильтра, который был создан на основе параметров времени выполнения. В этом случае набор записей содержит записи для всех выпускников.

> [!NOTE]
>  При необходимости можно задать значение члена данных параметр значение NULL, с помощью [члена SetParamNull](../../mfc/reference/crecordset-class.md#setparamnull). Проверить, можно ли элемент данных параметра имеет значение Null, с помощью [IsFieldNull](../../mfc/reference/crecordset-class.md#isfieldnull).

## <a name="see-also"></a>См. также

[Набор записей (ODBC)](../../data/odbc/recordset-odbc.md)<br/>
[Набор записей. Добавление, обновление и удаление записей (ODBC)](../../data/odbc/recordset-adding-updating-and-deleting-records-odbc.md)<br/>
[Набор записей. Порядок выборки записей в наборе (ODBC)](../../data/odbc/recordset-how-recordsets-select-records-odbc.md)