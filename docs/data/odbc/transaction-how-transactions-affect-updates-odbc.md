---
title: Транзакция. Влияние транзакций на обновления (ODBC)
ms.date: 11/04/2016
helpviewer_keywords:
- transactions, updating recordsets
- ODBC recordsets, transactions
- transactions, rolling back
- CommitTrans method
- Rollback method, ODBC transactions
ms.assetid: 9e00bbf4-e9fb-4332-87fc-ec8ac61b3f68
ms.openlocfilehash: d03ec3f71c38f7790d66fbf6f800b7647e080147
ms.sourcegitcommit: 0e3da5cea44437c132b5c2ea522bd229ea000a10
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/12/2019
ms.locfileid: "79544426"
---
# <a name="transaction-how-transactions-affect-updates-odbc"></a>Транзакция. Влияние транзакций на обновления (ODBC)

Управление обновлением [источника данных](../../data/odbc/data-source-odbc.md) осуществляется во время транзакций с помощью буфера редактирования (тот же метод, который используется за пределами транзакций). Элементы данных полей в наборе записей в совокупности служат в качестве буфера редактирования, содержащего текущую запись, которая временно архивируется в течение `AddNew` или `Edit`. Во время операции `Delete` текущая запись не архивируется в рамках транзакции. Дополнительные сведения о буфере редактирования и о том, как обновления хранят текущую запись, см. в разделе [набор записей: как наборы записей обновляют записи (ODBC)](../../data/odbc/recordset-how-recordsets-update-records-odbc.md).

> [!NOTE]
>  При реализации групповой выборки строк нельзя вызвать `AddNew`, `Edit`или `Delete`. Вместо этого необходимо написать собственные функции для выполнения обновлений в источнике данных. Дополнительные сведения о групповой выборке строк см. [в разделе набор записей. сбор записей (ODBC)](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md).

Во время транзакций операции `AddNew`, `Edit`и `Delete` могут быть зафиксированы или отменены. Влияние `CommitTrans` и `Rollback` может привести к тому, что текущая запись не будет восстановлена в буфер редактирования. Чтобы убедиться, что текущая запись правильно восстановлена, важно понять, как `CommitTrans` и `Rollback` функции-члены `CDatabase` работают с функциями обновления `CRecordset`.

##  <a name="how-committrans-affects-updates"></a><a name="_core_how_committrans_affects_updates"></a>Влияние CommitTrans на обновления

В следующей таблице объясняется влияние `CommitTrans` на транзакции.

### <a name="how-committrans-affects-updates"></a>Влияние CommitTrans на обновления

|Операция|Состояние источника данных|
|---------------|---------------------------|
|`AddNew` и `Update`, а затем `CommitTrans`|Новая запись добавляется в источник данных.|
|`AddNew` (без `Update`), а затем `CommitTrans`|Новая запись будет потеряна. Запись не добавлена в источник данных.|
|`Edit` и `Update`, а затем `CommitTrans`|Изменения, зафиксированные в источнике данных.|
|`Edit` (без `Update`), а затем `CommitTrans`|Изменения в записи теряются. Запись остается неизменной в источнике данных.|
|`Delete` затем `CommitTrans`|Записи, удаленные из источника данных.|

##  <a name="how-rollback-affects-transactions"></a><a name="_core_how_rollback_affects_updates"></a>Влияние отката на транзакции

В следующей таблице объясняется влияние `Rollback` на транзакции.

### <a name="how-rollback-affects-transactions"></a>Влияние отката на транзакции

|Операция|Состояние текущей записи|Необходимо также|Состояние источника данных|
|---------------|------------------------------|-------------------|---------------------------|
|`AddNew` и `Update`, а затем `Rollback`|Содержимое текущей записи временно сохраняется, чтобы освободить место для новой записи. Новая запись введена в буфер правки. После вызова `Update` текущая запись восстанавливается в буфер редактирования.||Дополнение к источнику данных, созданному `Update`, является обратным.|
|`AddNew` (без `Update`), а затем `Rollback`|Содержимое текущей записи временно сохраняется, чтобы освободить место для новой записи. Буфер правки содержит новую запись.|Вызовите `AddNew` еще раз, чтобы восстановить пустую новую запись в буфере редактирования. Или вызовите `Move`(0), чтобы восстановить старые значения в буфер редактирования.|Поскольку `Update` не был вызван, в источник данных не были внесены изменения.|
|`Edit` и `Update`, а затем `Rollback`|Неизмененная версия текущей записи временно хранится. Изменения вносятся в содержимое буфера редактирования. После вызова `Update`, неизмененная версия записи по-прежнему будет временно храниться.|*Динамический*набор: прокрутить текущую запись, а затем вернуться к восстановлению неизмененной версии записи в буфер редактирования.<br /><br /> *Моментальный снимок*. вызовите `Requery`, чтобы обновить набор записей из источника данных.|Изменения в источнике данных, внесенные `Update`, реверсируются.|
|`Edit` (без `Update`), а затем `Rollback`|Неизмененная версия текущей записи временно хранится. Изменения вносятся в содержимое буфера редактирования.|Вызовите `Edit` еще раз, чтобы восстановить неизмененную версию записи в буфер редактирования.|Поскольку `Update` не был вызван, в источник данных не были внесены изменения.|
|`Delete` затем `Rollback`|Содержимое текущей записи удаляется.|Вызовите `Requery`, чтобы восстановить содержимое текущей записи из источника данных.|Удаление данных из источника данных осуществляется в обратном порядке.|

## <a name="see-also"></a>См. также:

[Транзакция (ODBC)](../../data/odbc/transaction-odbc.md)<br/>
[Транзакция. Выполнение транзакции в наборе записей (ODBC)](../../data/odbc/transaction-performing-a-transaction-in-a-recordset-odbc.md)<br/>
[Класс CDatabase](../../mfc/reference/cdatabase-class.md)<br/>
[Класс CRecordset](../../mfc/reference/crecordset-class.md)
