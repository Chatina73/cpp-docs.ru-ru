---
title: Набор записей. Фильтрация записей (ODBC)
ms.date: 11/04/2016
helpviewer_keywords:
- data [MFC], filtering
- recordsets [C++], filtering
- filtering recordsets
- ODBC recordsets [C++], filtering records
- filters [C++], recordset object
ms.assetid: 5c075f37-c837-464d-90c1-d028a9d1c175
ms.openlocfilehash: 2e742ee02e142fd87df3f149379d9971c4acd166
ms.sourcegitcommit: 857fa6b530224fa6c18675138043aba9aa0619fb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/24/2020
ms.locfileid: "80212916"
---
# <a name="recordset-filtering-records-odbc"></a>Набор записей. Фильтрация записей (ODBC)

Этот раздел относится к классам ODBC библиотеки MFC.

В этом разделе объясняется, как фильтровать набор записей, чтобы он выбрал только определенное подмножество доступных записей. Например, может потребоваться выбрать только разделы класса для конкретного курса, например MATH101. Фильтр — это условие поиска, определенное содержимым предложения **WHERE** SQL. Когда платформа добавляет его к инструкции SQL набора записей, предложение **WHERE** ограничивает выбор.

Необходимо установить фильтр объекта набора записей после создания объекта, но перед вызовом его `Open` функции-члена (или перед вызовом функции члена `Requery` для существующего объекта набора записей, для которого `Open` функция-член была вызвана ранее).

#### <a name="to-specify-a-filter-for-a-recordset-object"></a>Задание фильтра для объекта набора записей

1. Создайте новый объект набора записей (или подготовьте его к вызову `Requery` для существующего объекта).

1. Задайте значение элемента данных [m_strFilter](../../mfc/reference/crecordset-class.md#m_strfilter) объекта.

   Фильтр — это строка, завершающаяся нулем, которая содержит содержимое предложения **WHERE** SQL, но не ключевое слово **WHERE**. Например, вы можете использовать следующие службы.

    ```
    m_pSet->m_strFilter = "CourseID = 'MATH101'";
    ```

   not

    ```
    m_pSet->m_strFilter = "WHERE CourseID = 'MATH101'";
    ```

    > [!NOTE]
    >  Строка литерала "MATH101" отображается с одинарными кавычками выше. В спецификации ODBC SQL одинарные кавычки используются для обозначения символьного строкового литерала. В этом случае ознакомьтесь с документацией по драйверу ODBC, чтобы узнать о требованиях СУБД. Этот синтаксис также обсуждается далее в конце этого раздела.

1. Задайте любые другие необходимые параметры, такие как порядок сортировки, режим блокировки или параметры. Указание параметра особенно полезно. Дополнительные сведения о параметризации фильтра см. [в разделе набор записей. Параметризация набора записей (ODBC)](../../data/odbc/recordset-parameterizing-a-recordset-odbc.md).

1. Вызовите `Open` для нового объекта (или `Requery` для ранее открытого объекта).

> [!TIP]
>  Использование параметров в фильтре является потенциально эффективным методом извлечения записей.

> [!TIP]
>  Фильтры набора записей полезны для [объединения](../../data/odbc/recordset-performing-a-join-odbc.md) таблиц и для использования [параметров](../../data/odbc/recordset-parameterizing-a-recordset-odbc.md) на основе сведений, полученных или вычисленных во время выполнения.

Набор записей выбирает только те записи, которые соответствуют указанному условию поиска. Например, чтобы указать фильтр курсов, описанный выше (при условии, что переменная `strCourseID` задана в данный момент, например, на "MATH101"), выполните следующие действия.

```
// Using the recordset pointed to by m_pSet

// Set the filter
m_pSet->m_strFilter = "CourseID = " + strCourseID;

// Run the query with the filter in place
if ( m_pSet->Open( CRecordset::snapshot, NULL, CRecordset::readOnly ) )

// Use the recordset
```

Набор записей содержит записи для всех разделов класса для MATH101.

Обратите внимание, что строка фильтра была задана в приведенном выше примере, используя строковую переменную. Это типичное использование. Но предположим, что необходимо указать литеральное значение 100 для идентификатора курса. В следующем коде показано, как правильно задать строку фильтра с литеральным значением:

```
m_strFilter = "StudentID = '100'";   // correct
```

Обратите внимание на использование одинарных кавычек. Если строка фильтра задана напрямую, то строка фильтра **не**будет:

```
m_strFilter = "StudentID = 100";   // incorrect for some drivers
```

Приведенное выше предложение соответствует спецификации ODBC, но некоторым СУБД могут потребоваться другие символы кавычек. Дополнительные сведения см. [в разделе SQL: Настройка инструкции SQL набора записей (ODBC)](../../data/odbc/sql-customizing-your-recordsets-sql-statement-odbc.md).

> [!NOTE]
>  Если вы решили переопределить строку SQL набора записей по умолчанию, передав собственную строку SQL в `Open`, не следует устанавливать фильтр, если в пользовательской строке есть предложение **WHERE** . Дополнительные сведения о переопределении SQL по умолчанию см. [в разделе SQL: Настройка инструкции SQL набора записей (ODBC)](../../data/odbc/sql-customizing-your-recordsets-sql-statement-odbc.md).

## <a name="see-also"></a>См. также раздел

[Набор записей (ODBC)](../../data/odbc/recordset-odbc.md)<br/>
[Набор записей. Сортировка записей (ODBC)](../../data/odbc/recordset-sorting-records-odbc.md)<br/>
[Набор записей. Порядок выборки записей в наборе (ODBC)](../../data/odbc/recordset-how-recordsets-select-records-odbc.md)<br/>
[Набор записей. Порядок обновления записей в наборе (ODBC)](../../data/odbc/recordset-how-recordsets-update-records-odbc.md)<br/>
[Набор записей. Блокировка (ODBC)](../../data/odbc/recordset-locking-records-odbc.md)
