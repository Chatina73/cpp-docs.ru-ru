---
description: 'Дополнительные сведения: набор записей: Блокировка записей (ODBC)'
title: 'Набор записей: блокировка (ODBC)'
ms.date: 11/04/2016
helpviewer_keywords:
- locks [C++], recordsets
- optimistic locking
- pessimistic locking in ODBC
- recordsets [C++], locking records
- optimistic locking, ODBC
- ODBC recordsets [C++], locking records
- data [C++], locking
ms.assetid: 8fe8fcfe-b55a-41a8-9136-94a7cd1e4806
ms.openlocfilehash: 1833aff2a1a68affe02cdcf5294007802452bbf9
ms.sourcegitcommit: d6af41e42699628c3e2e6063ec7b03931a49a098
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2020
ms.locfileid: "97304484"
---
# <a name="recordset-locking-records-odbc"></a>Набор записей: блокировка (ODBC)

Этот раздел относится к классам ODBC библиотеки MFC.

В этом разделе рассматриваются следующие вопросы.

- [Доступные типы блокировки записей](#_core_record.2d.locking_modes).

- [Как блокировать записи в наборе записей во время обновлений](#_core_locking_records_in_your_recordset).

При использовании набора записей для обновления записи в источнике данных приложение может заблокировать запись, чтобы другие пользователи не могли одновременно обновлять запись. Состояние записи, обновляемой двумя пользователями одновременно, не определено, если система не гарантирует, что два пользователя не смогут одновременно обновлять запись.

> [!NOTE]
> Этот раздел относится к объектам, производным от `CRecordset`, в которых пакетное получение строк не реализовано. При реализации групповой выборки строк некоторые сведения не применяются. Например, нельзя вызывать `Edit` `Update` функции элементов и. Дополнительные сведения о групповой выборке строк см. [в разделе набор записей. сбор записей (ODBC)](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md).

## <a name="record-locking-modes"></a><a name="_core_record.2d.locking_modes"></a> Режимы Record-Locking

Классы баз данных предоставляют два [режима блокировки записей](../../mfc/reference/crecordset-class.md#setlockingmode):

- Оптимистическая блокировка (по умолчанию)

- Пессимистическая блокировка

Обновление записи происходит в три этапа:

1. Чтобы начать операцию, нужно вызвать функцию [редактирования](../../mfc/reference/crecordset-class.md#edit) элементов.

1. Вы измените соответствующие поля текущей записи.

1. Вы завершаете операцию — и обычно фиксируете обновление, вызывая функцию-член [Update](../../mfc/reference/crecordset-class.md#update) .

Оптимистическая блокировка блокирует запись в источнике данных только во время `Update` вызова. При использовании оптимистичной блокировки в многопользовательской среде приложение должно выполнить `Update` Условие сбоя. Пессимистическая блокировка блокирует запись сразу после вызова `Edit` и не освобождает ее до тех пор, пока не будет вызвано `Update` (сбои обозначаются `CDBException` механизмом, а не значением false, возвращаемым `Update` ). Пессимистическая блокировка может привести к снижению производительности других пользователей, так как одновременный доступ к одной и той же записи должен дожидаться завершения `Update` процесса приложения.

## <a name="locking-records-in-your-recordset"></a><a name="_core_locking_records_in_your_recordset"></a> Блокировка записей в наборе записей

Если требуется изменить [режим блокировки](#_core_record.2d.locking_modes) объекта набора записей по умолчанию, необходимо изменить режим перед вызовом метода `Edit` .

#### <a name="to-change-the-current-locking-mode-for-your-recordset"></a>Изменение текущего режима блокировки для набора записей

1. Вызовите функцию члена [сетлоккингмоде](../../mfc/reference/crecordset-class.md#setlockingmode) , указав либо `CRecordset::pessimistic` `CRecordset::optimistic` .

Новый режим блокировки действует, пока вы не измените его или закроете набор записей.

> [!NOTE]
> В настоящее время относительно небольшого числа драйверов ODBC поддерживает пессимистическую блокировку.

## <a name="see-also"></a>См. также раздел

[Набор записей (ODBC)](../../data/odbc/recordset-odbc.md)<br/>
[Набор записей. Выполнение соединения (ODBC)](../../data/odbc/recordset-performing-a-join-odbc.md)<br/>
[Набор записей: Добавление, обновление и удаление записей (ODBC)](../../data/odbc/recordset-adding-updating-and-deleting-records-odbc.md)
