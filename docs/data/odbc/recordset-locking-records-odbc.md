---
title: 'Набор записей: блокировка (ODBC)'
ms.date: 11/04/2016
helpviewer_keywords:
- locks [C++], recordsets
- optimistic locking
- pessimistic locking in ODBC
- recordsets [C++], locking records
- optimistic locking, ODBC
- ODBC recordsets [C++], locking records
- data [C++], locking
ms.assetid: 8fe8fcfe-b55a-41a8-9136-94a7cd1e4806
ms.openlocfilehash: d4e80816a131c997e9f5bfaa34f025394b05a358
ms.sourcegitcommit: 857fa6b530224fa6c18675138043aba9aa0619fb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/24/2020
ms.locfileid: "80212866"
---
# <a name="recordset-locking-records-odbc"></a>Набор записей: блокировка (ODBC)

Этот раздел относится к классам ODBC библиотеки MFC.

В этом разделе рассматриваются следующие вопросы.

- [Доступные типы блокировки записей](#_core_record.2d.locking_modes).

- [Как блокировать записи в наборе записей во время обновлений](#_core_locking_records_in_your_recordset).

При использовании набора записей для обновления записи в источнике данных приложение может заблокировать запись, чтобы другие пользователи не могли одновременно обновлять запись. Состояние записи, обновляемой двумя пользователями одновременно, не определено, если система не гарантирует, что два пользователя не смогут одновременно обновлять запись.

> [!NOTE]
>  Этот раздел относится к объектам, производным от `CRecordset`, в которых пакетное получение строк не реализовано. При реализации групповой выборки строк некоторые сведения не применяются. Например, нельзя вызвать функции члена `Edit` и `Update`. Дополнительные сведения о групповой выборке строк см. [в разделе набор записей. сбор записей (ODBC)](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md).

##  <a name="record-locking-modes"></a><a name="_core_record.2d.locking_modes"></a>Режимы блокировки записей

Классы баз данных предоставляют два [режима блокировки записей](../../mfc/reference/crecordset-class.md#setlockingmode):

- Оптимистическая блокировка (по умолчанию)

- Пессимистическая блокировка

Обновление записи происходит в три этапа:

1. Чтобы начать операцию, нужно вызвать функцию [редактирования](../../mfc/reference/crecordset-class.md#edit) элементов.

1. Вы измените соответствующие поля текущей записи.

1. Вы завершаете операцию — и обычно фиксируете обновление, вызывая функцию-член [Update](../../mfc/reference/crecordset-class.md#update) .

Оптимистическая блокировка блокирует запись в источнике данных только во время вызова `Update`. Если вы используете оптимистичную блокировку в многопользовательской среде, приложение должно выполнить `Update` условие сбоя. Пессимистическая блокировка блокирует запись сразу же после вызова `Edit` и не освобождает ее до тех пор, пока не будет вызвана `Update` (сбои обозначаются механизмом `CDBException`, а не значением FALSE, возвращаемым `Update`). Пессимистическая блокировка может привести к снижению производительности других пользователей, так как одновременный доступ к одной и той же записи должен дожидаться завершения процесса `Update` приложения.

##  <a name="locking-records-in-your-recordset"></a><a name="_core_locking_records_in_your_recordset"></a>Блокировка записей в наборе записей

Если требуется изменить [режим блокировки](#_core_record.2d.locking_modes) объекта набора записей по умолчанию, необходимо изменить режим перед вызовом `Edit`.

#### <a name="to-change-the-current-locking-mode-for-your-recordset"></a>Изменение текущего режима блокировки для набора записей

1. Вызовите функцию члена [сетлоккингмоде](../../mfc/reference/crecordset-class.md#setlockingmode) , указав либо `CRecordset::pessimistic`, либо `CRecordset::optimistic`.

Новый режим блокировки действует, пока вы не измените его или закроете набор записей.

> [!NOTE]
>  В настоящее время относительно небольшого числа драйверов ODBC поддерживает пессимистическую блокировку.

## <a name="see-also"></a>См. также раздел

[Набор записей (ODBC)](../../data/odbc/recordset-odbc.md)<br/>
[Набор записей. Объединение (ODBC)](../../data/odbc/recordset-performing-a-join-odbc.md)<br/>
[Набор записей. Добавление, обновление и удаление записей (ODBC)](../../data/odbc/recordset-adding-updating-and-deleting-records-odbc.md)
