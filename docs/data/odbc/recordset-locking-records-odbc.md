---
title: 'Набор записей: блокировка (ODBC)'
ms.date: 11/04/2016
helpviewer_keywords:
- locks [C++], recordsets
- optimistic locking
- pessimistic locking in ODBC
- recordsets [C++], locking records
- optimistic locking, ODBC
- ODBC recordsets [C++], locking records
- data [C++], locking
ms.assetid: 8fe8fcfe-b55a-41a8-9136-94a7cd1e4806
ms.openlocfilehash: abd5f817ad321241df2d8565bd6bf346c0792088
ms.sourcegitcommit: c123cc76bb2b6c5cde6f4c425ece420ac733bf70
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81366963"
---
# <a name="recordset-locking-records-odbc"></a>Набор записей: блокировка (ODBC)

Этот раздел относится к классам ODBC библиотеки MFC.

В этом разделе рассматриваются следующие вопросы.

- [Виды блокировки записей доступны.](#_core_record.2d.locking_modes)

- [Как заблокировать записи в записи во время обновления.](#_core_locking_records_in_your_recordset)

Когда вы используете запись для обновления записи на источнике данных, приложение может заблокировать запись, чтобы ни один другой пользователь не мог обновить запись в то же время. Состояние записи, обновленной двумя пользователями одновременно, не определено, если система не может гарантировать, что два пользователя не могут обновлять запись одновременно.

> [!NOTE]
> Этот раздел относится к объектам, производным от `CRecordset`, в которых пакетное получение строк не реализовано. Если вы реализовали объем строки извлечения, часть информации не применяется. Например, вы не `Edit` `Update` можете вызвать функции и функции участника. Для получения дополнительной информации о массовом строке извлечения, см [Recordset: Извлечение записей в массовых (ODBC)](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md).

## <a name="record-locking-modes"></a><a name="_core_record.2d.locking_modes"></a>Режимы записи блокировки

Классы баз данных предоставляют два [режима записи блокировки:](../../mfc/reference/crecordset-class.md#setlockingmode)

- Оптимистичная блокировка (по умолчанию)

- Пессимистическая блокировка

Обновление записи происходит в три этапа:

1. Вы начинаете операцию, вызывая функцию члена [Edit.](../../mfc/reference/crecordset-class.md#edit)

1. Вы меняете соответствующие поля текущей записи.

1. Вы заканчиваете операцию и обычно фиксировать обновление, вызывая функцию участника [обновления.](../../mfc/reference/crecordset-class.md#update)

Оптимистичная блокировка блокирует запись источника данных только во время `Update` вызова. Если вы используете оптимистическую блокировку в многопользовательской среде, приложение должно обрабатывать состояние `Update` сбоя. Пессимистическая блокировка блокирует запись, как только `Edit` вы звоните, и `Update` не отпустит ее до тех пор, пока вы не позвоните (сбои указаны через `CDBException` механизм, а не значение FALSE, возвращенное). `Update` Пессимистическая блокировка имеет потенциальный штраф за производительность для других пользователей, потому что одновременное `Update` доступ к той же записи, возможно, придется ждать до завершения процесса приложения.

## <a name="locking-records-in-your-recordset"></a><a name="_core_locking_records_in_your_recordset"></a>Блокировка записей в вашем наборе рекордов

Если требуется изменить [режим блокировки](#_core_record.2d.locking_modes) объекта записи по умолчанию, необходимо изменить `Edit`режим перед вызовом.

#### <a name="to-change-the-current-locking-mode-for-your-recordset"></a>Изменить текущий режим блокировки для вашего рекорда

1. Позвоните в функцию участника [SetLockingMode,](../../mfc/reference/crecordset-class.md#setlockingmode) указав либо `CRecordset::pessimistic` `CRecordset::optimistic`или .

Новый режим блокировки остается в силе до тех пор, пока вы не измените его снова или запись не будет закрыта.

> [!NOTE]
> Относительно немногие драйверы ODBC в настоящее время поддерживают пессимистическую блокировку.

## <a name="see-also"></a>См. также раздел

[Набор записей (ODBC)](../../data/odbc/recordset-odbc.md)<br/>
[Набор записей. Объединение (ODBC)](../../data/odbc/recordset-performing-a-join-odbc.md)<br/>
[Набор записей. Добавление, обновление и удаление записей (ODBC)](../../data/odbc/recordset-adding-updating-and-deleting-records-odbc.md)
