---
title: ODBC. Библиотека курсоров ODBC
ms.date: 11/04/2016
helpviewer_keywords:
- cursor library [ODBC]
- snapshots, support in ODBC
- timestamps, ODBC timestamp columns
- ODBC cursor library [ODBC]
- static cursors
- ODBC drivers, Level 1
- ODBC drivers, cursor support
- positioned updates
- cursors, ODBC cursor library
- Level 1 ODBC drivers
- cursor library [ODBC], snapshots
- ODBC, timestamp
- positioning cursors
ms.assetid: 6608db92-82b1-4164-bb08-78153c227be3
ms.openlocfilehash: 51524604cad34ace18ffda2b5f48cc3c5fd89ad7
ms.sourcegitcommit: 857fa6b530224fa6c18675138043aba9aa0619fb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/24/2020
ms.locfileid: "80213100"
---
# <a name="odbc-the-odbc-cursor-library"></a>ODBC. Библиотека курсоров ODBC

В этом разделе описывается библиотека курсоров ODBC и объясняется, как ее использовать. Дополнительные сведения см. в разделе:

- [Библиотека курсоров и драйверы ODBC уровня 1](#_core_the_cursor_library_and_level_1_odbc_drivers)

- [Позиционированные обновления и столбцы отметок времени](#_core_positioned_updates_and_timestamp_columns)

- [Использование библиотеки курсоров](#_core_using_the_cursor_library)

Библиотека курсоров ODBC — это библиотека динамической компоновки (DLL), которая находится между диспетчером драйверов ODBC и драйвером. В терминах ODBC драйвер поддерживает курсор, чтобы контролировать его позицию в наборе записей. Курсор отмечает позицию в наборе записей, к которой уже была произведена Прокрутка — текущей записи.

##  <a name="cursor-library-and-level-1-odbc-drivers"></a><a name="_core_the_cursor_library_and_level_1_odbc_drivers"></a>Библиотека курсоров и драйверы ODBC уровня 1

Библиотека курсоров ODBC предоставляет драйверам уровня 1 следующие новые возможности:

- Прямая и Обратная прокрутка. Драйверам уровня 2 не требуется библиотека курсоров, так как они уже прокручены.

- Поддержка моментальных снимков. Библиотека курсоров управляет буфером, содержащим записи моментального снимка. Этот буфер отражает удаления и изменения в записях программы, но не содержит добавления, удаления или изменения других пользователей. Таким образом, моментальный снимок является только текущим, как и буфер библиотеки курсоров. Кроме того, буфер не отражает собственные дополнения, пока не будет вызвана `Requery`. Динамические наборы данных не используют библиотеку курсоров.

Библиотека курсоров предоставляет моментальные снимки (статические курсоры), даже если они обычно не поддерживаются драйвером. Если драйвер уже поддерживает статические курсоры, не нужно загружать библиотеку курсоров для получения поддержки моментальных снимков. Если используется библиотека курсоров, можно использовать только моментальные снимки и наборы записей только для последовательного доступа. Если драйвер поддерживает динамические наборы (KEYSET_DRIVEN курсоры) и вы хотите использовать их, не следует использовать библиотеку курсоров. Если вы хотите использовать как моментальные снимки, так и динамические наборы данных, их необходимо основывать на двух разных объектах `CDatabase` (два разных подключения), если только драйвер не поддерживает оба.

##  <a name="positioned-updates-and-timestamp-columns"></a><a name="_core_positioned_updates_and_timestamp_columns"></a>Позиционированные обновления и столбцы отметок времени

> [!NOTE]
>  Источники данных ODBC доступны через классы ODBC MFC, как описано в этом разделе, или через классы объектов доступа к данным MFC (DAO).

> [!NOTE]
>  Если драйвер ODBC поддерживает `SQLSetPos`, используемый MFC, если он доступен, этот раздел не относится к вам.

Большинство драйверов уровня 1 не поддерживают позиционированные обновления. Такие драйверы используют библиотеку курсоров для эмуляции возможностей драйверов второго уровня в этом отношении. Библиотека курсоров эмулирует поддержку позиционированного обновления, выполняя поиск по неизменяемым полям.

В некоторых случаях набор записей может содержать столбец timestamp в качестве одного из этих неизменяемых полей. При использовании наборов записей MFC с таблицами, содержащими столбцы отметок времени, возникают две проблемы.

Первая ошибка касается обновляемых моментальных снимков в таблицах с столбцами отметок времени. Если таблица, к которой привязан моментальный снимок, содержит столбец timestamp, то следует вызвать `Requery` после вызова `Edit` и `Update`. В противном случае вы не сможете изменить одну и ту же запись еще раз. При вызове `Edit` и последующем `Update`запись записывается в источник данных, а столбец отметок времени обновляется. Если не вызвать `Requery`, значение метки времени для записи в моментальном снимке больше не будет соответствовать соответствующей метке времени в источнике данных. При попытке обновить запись источник данных может запретить обновление из-за несоответствия.

Вторая ошибка касается ограничений класса [CTime](../../atl-mfc-shared/reference/ctime-class.md) при использовании с функцией `RFX_Date` для перемещения сведений о времени и дате в таблицу или из нее. Обработка объекта `CTime` накладывает некоторые издержки на форму дополнительной промежуточной обработки во время обмена данными. Диапазон дат `CTime` объектов также может быть слишком ограничивающим для некоторых приложений. Новая версия функции `RFX_Date` принимает параметр *TIMESTAMP_STRUCT* ODBC вместо объекта `CTime`. Дополнительные сведения см. в разделе `RFX_Date` в [макросах и Globals](../../mfc/reference/mfc-macros-and-globals.md) в *справочнике по MFC*.

##  <a name="using-the-cursor-library"></a><a name="_core_using_the_cursor_library"></a>Использование библиотеки курсоров

При подключении к источнику данных — путем вызова метода [CDatabase:: опенекс](../../mfc/reference/cdatabase-class.md#openex) или [CDatabase:: Open](../../mfc/reference/cdatabase-class.md#open) — можно указать, следует ли использовать библиотеку курсоров для источника данных. Если вы будете создавать моментальные снимки для этого источника данных, укажите параметр `CDatabase::useCursorLib` в параметре `dwOptions`, чтобы `OpenEx` или укажите TRUE для параметра *бусекурсорлиб* , чтобы `Open` (значение по умолчанию — true). Если драйвер ODBC поддерживает динамические функции и необходимо открыть динамические наборы данных в источнике, не используйте библиотеку курсоров (она маскирует некоторые функции драйвера, необходимые для динамических подмножеств). В этом случае не указывайте `CDatabase::useCursorLib` в `OpenEx` или укажите значение FALSE для параметра *бусекурсорлиб* в `Open`.

## <a name="see-also"></a>См. также раздел

[Основы ODBC](../../data/odbc/odbc-basics.md)
