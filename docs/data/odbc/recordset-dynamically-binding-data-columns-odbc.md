---
title: Набор записей. Динамическая привязка столбцов данных (ODBC)
ms.date: 11/19/2018
helpviewer_keywords:
- ODBC recordsets [C++], binding columns dynamically
- data binding [C++], recordset columns
- recordsets [C++], binding data
- data binding [C++], columns in recordsets
- columns [C++], binding to recordsets
ms.assetid: bff67254-d953-4ae4-9716-91c348cb840b
ms.openlocfilehash: c2f2a6a6696f46fb5b8f2777c6c911269c9e7a80
ms.sourcegitcommit: 0ab61bc3d2b6cfbd52a16c6ab2b97a8ea1864f12
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "62397903"
---
# <a name="recordset-dynamically-binding-data-columns-odbc"></a>Набор записей. Динамическая привязка столбцов данных (ODBC)

Этот раздел относится к классам ODBC библиотеки MFC.

Наборы записей управлять привязкой столбцов таблицы, указываемые во время разработки, но бывают случаи, когда может потребоваться привязать столбцы, которые были неизвестны пользователю во время разработки. Содержание раздела:

- [Когда может потребоваться динамическая привязка столбцов в набор записей](#_core_when_you_might_bind_columns_dynamically).

- [Привязка столбцов динамически во время выполнения](#_core_how_to_bind_columns_dynamically).

> [!NOTE]
>  Этот раздел относится к объектам, производным от `CRecordset` в какой строке массовой выборка не был реализован. Методы, описанные в этом разделе не рекомендуются, если вы используете выборка строк. Дополнительные сведения о массовой выборке строк см. в разделе [набор записей: Пакетная выборка строк (ODBC)](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md).

##  <a name="_core_when_you_might_bind_columns_dynamically"></a> Когда вы может динамическая привязка столбцов

Во время разработки, мастер приложений MFC или [Мастер потребителя MFC ODBC](../../mfc/reference/adding-an-mfc-odbc-consumer.md) (из **Добавление класса**) создают классы набора записей на основе известных таблиц и столбцов в источнике данных. Базы данных могут измениться при проектировании их и более поздние версии, когда приложение использует эти таблицы и столбцы во время выполнения. Пользователь может добавить или удалить таблицу или добавлять или удалять столбцы из таблицы, которая использует набор записей приложения. Это возможно, не имеет значения для всех приложений доступ к данным, но если это вам, как вы, справиться с изменения в схему базы данных, кроме Реструктуризация и перекомпиляции? В этом разделе, предназначена для ответа на этот вопрос.

В этом разделе описываются наиболее распространенный случай, в котором может привязывать столбцы динамически — начиная с набора записей, на основе схемы известные базы данных, необходимо обработать дополнительные столбцы во время выполнения. Далее предполагается, что дополнительные столбцы сопоставляются с `CString` полей с данными, наиболее распространенный случай, несмотря на то, что предлагаются для управления другими типами данных.

С помощью небольшого количества дополнительного кода вы можете:

- [Определить, какие столбцы доступны во время выполнения](#_core_how_to_bind_columns_dynamically).

- [Динамически привязать дополнительные столбцы к набору записей, во время выполнения](#_core_adding_the_columns).

Набор записей по-прежнему содержит элементы данных для столбцов, известных во время разработки. Они также содержит небольшой объем дополнительного кода, который динамически определяет, добавлены ли новые столбцы в целевую таблицу и привязывает эти новые столбцы на динамически выделенную память (а не для элементов данных набора записей).

В этом разделе не рассматриваются другие случаи динамической привязки, такие как удаление таблиц или столбцов. В таких случаях необходимо использовать вызовы ODBC API напрямую. Сведения см. в разделе ODBC SDK *справочнике программиста* на компакт-диске библиотеки MSDN.

##  <a name="_core_how_to_bind_columns_dynamically"></a> Как динамическая привязка столбцов

Динамическая привязка столбцов, необходимо знать (или иметь возможность определить) имена дополнительных столбцов. Необходимо также выделения памяти для дополнительных полей элементов данных, укажите их имена и их типы и укажите количество столбцов, которые вы добавляете.

Ниже упоминаются два различных набора записей. Первый — основной набор записей для отбора записей из целевой таблицы. Второй — это набор записей специальный столбец, используемый для получения сведений о столбцах в целевой таблице.

###  <a name="_core_the_general_process"></a> Общий процесс

На самом общем уровне, выполните следующие действия.

1. Создания объекта основного набора записей.

   При необходимости передать указатель на открытый `CDatabase` объекта или иметь возможность предоставить сведения о подключении к набору записей столбцов иным способом.

1. Выполните действия для добавления столбцов динамически.

   См. в разделе, как описано в ниже столбцы.

1. Откройте основного набора записей.

   Набор записей выбирает записи и использует обмен полями записей (RFX) для привязки статических столбцов (которые сопоставляются с элементами данных полей набора записей) и динамических столбцов (сопоставленного с дополнительное хранилище, которое зарезервировать).

###  <a name="_core_adding_the_columns"></a> Добавление столбцов

Динамическая привязка добавлены столбцы во время выполнения необходимо выполнить следующие действия:

1. Во время выполнения можно определите, какие столбцы расположены в целевой таблице. Получить список столбцов, которые были добавлены в таблицу так, как была разработана класса набора записей.

   Рекомендуется использовать класс столбцов набора записей для запросов к источнику данных, сведений о столбце для целевой таблицы (например, столбец имя и тип данных).

1. Предоставление хранилища для новых членов данных поля. Так как класс основного набора записей не имеет элементов данных полей для неизвестных столбцов, необходимо указать место для хранения имен, возвращают значения и возможно сведения о типе данных (если столбцы имеют разные типы данных).

   Один из способов — создать один или несколько динамических списков: один для имен новых столбцов, другой для их результирующих значений, а третий для их типы данных (при необходимости). Эти списки, в частности список значений, предоставляют сведения и хранилище для привязки. На следующем рисунке показано, построение списков.

   ![Построение списков столбцов для динамической привязки](../../data/odbc/media/vc37w61.gif "построение списков столбцов для динамической привязки")<br/>
   Построение списков столбцов для динамической привязки

1. Добавьте вызов функции RFX к основному набору записей `DoFieldExchange` функцию для каждого добавленного столбца. Эти вызовы выполняют работу по выборке записи, включая дополнительные столбцы и связав столбцы элементов данных набора записей или к динамическому хранилищу для них.

   Можно добавить цикл основного набора записей `DoFieldExchange` функции, который просматривает список новых столбцов, вызов соответствующей функции RFX для каждого столбца в списке. При каждом вызове RFX передайте имя столбца из списка имен столбцов и места хранения, в соответствующий элемент списка результирующих значений.

###  <a name="_core_lists_of_columns"></a> Списки столбцов

В следующей таблице показаны четыре списки, которые необходимы для работы с.

|||
|-|-|
|**Текущих столбцов в таблице**| (Список 1 на рисунке) Список столбцов в таблице в источнике данных. Этот список может совпадает со списком столбцов, в настоящее время привязано к набору записей.|
|**Набор записей столбцов, привязанных к**| (Список 2 на рисунке) Список столбцов, привязанных к набору записей. Эти столбцы уже есть инструкций RFX в вашей `DoFieldExchange` функции.|
|**Столбцы, которые необходимо привязать динамически**| (Список 3 на рисунке) Список столбцов в таблице, но не в наборе записей. Это те столбцы, которые вы хотите выполнить привязку динамически.|
|**Столбец значений динамических**| (Список 4 на рисунке) Список, содержащий значения получены из столбцов, которые динамической привязкой. Элементы этого списка соответствуют элементам в столбцы для динамически привязать, один к одному.|

###  <a name="_core_building_your_lists"></a> Построение списков

С общей стратегией в виду можно изучить детали. Процедуры, описанные в остальной части этого раздела показано, как построить списки в [списки столбцов](#_core_lists_of_columns). Описываются процедуры через:

- [Определение имен столбцов, отсутствующих в наборе записей](#_core_determining_which_table_columns_are_not_in_your_recordset).

- [Предоставление динамического хранилища для новых добавленных в таблицу столбцов](#_core_providing_storage_for_the_new_columns).

- [Динамическое добавление RFX вызывает для новых столбцов](#_core_adding_rfx_calls_to_bind_the_columns).

###  <a name="_core_determining_which_table_columns_are_not_in_your_recordset"></a> Определение столбцов, отсутствующих в наборе записей

Строит список (столбцы, привязанные к набору записей, список 2 на рисунке), содержащий список столбцов, которые уже привязаны к основному набору записей. Затем создайте список (столбцы к динамически привязать, производный от столбцов в текущей таблице и набор записей-столбцов, привязанных к), содержащий имена столбцов в таблице в источнике данных, но не в основного набора записей.

##### <a name="to-determine-the-names-of-columns-not-in-the-recordset-columns-to-bind-dynamically"></a>Чтобы определить имена столбцов не в наборе записей (столбцы к динамически привязать)

1. Создавайте список столбцов, которые уже привязаны к основному набору записей (столбцы границы набора записей).

   Одним из подходов является создание набора записей-столбцов, привязанных к во время разработки. Можно визуально изучить функции RFX в наборе записей `DoFieldExchange` функцию, чтобы получить эти имена. Затем настройте список как массив с именами.

   Например на рисунке список столбцов, привязанных к набору записей (список 2) с тремя элементами. Набор записей-столбцов, привязанных к отсутствует в текущем столбцов в таблице (список 1) столбца телефона.

1. Сравнение столбцов в текущей таблице и набор записей-столбцов, привязанных к для построения списка столбцов, которые еще не привязан к основному набору записей (столбцы к динамически привязать).

   Один подход заключается в цикле в список столбцов в таблице во время выполнения (столбцов текущей таблицы) и в список столбцов, уже привязанных к набору записей (столбцы границы набора записей) в параллельном режиме. В столбцы, которые необходимо привязать динамически, добавьте имена в текущем столбцов в таблице, которые не отображаются в набор записей-столбцов, привязанных к.

   Например, на рисунке показан (список 3) с одним элементом: столбец "Phone" найден в текущем столбцов в таблице (список 1), но не в список столбцов, привязанных к набору записей (список 2).

1. Построения списка динамических значений столбцов (как в списке 4 на рисунке), в котором хранятся значения данных, соответствующие имя каждого столбца хранятся в списке столбцов для динамической привязки (столбцы к динамически привязать).

   Элементы этого списка играют роль нового набора записей поля элементов данных. Они являются места хранения, к которым привязаны динамических столбцов. Описание списков, см. в разделе [списки столбцов](#_core_lists_of_columns).

###  <a name="_core_providing_storage_for_the_new_columns"></a> Предоставление хранилища для новых столбцов

Теперь настройте места хранения для столбцов привязываться динамически. Идея состоит в том, чтобы предоставить элемент списка, в котором будет храниться значение каждого столбца. Эти расположения хранилища параллельные переменных-членов набора записей, в которых хранятся обычные привязанные столбцы.

#### <a name="to-provide-dynamic-storage-for-new-columns-dynamic-column-values"></a>Предоставление динамического хранилища для новых столбцов (значений динамических столбцов)

1. Создание динамических значений столбцов, параллельно столбцы для динамически привязать, должен содержать значение данных в каждом столбце.

   Например, на рисунке значений динамических столбцов (список 4) с одним элементом: `CString` объект, содержащий фактический номер телефона для текущей записи: "555-1212".

   В общем случае значений динамических столбцов содержит элементы типа `CString`. Если при работе со столбцами различных типов данных, вам потребуется список, который может содержать элементы различных типов.

Двумя основными списками получается из приведенных выше процедур: Столбцы к динамически привязать, содержащий имена столбцов и столбец значений динамических содержащий значения из столбцов для текущей записи.

> [!TIP]
> Если новые столбцы не все тот же тип данных, вы можете дополнительный параллельный список, содержащий элементы, определяющие тип каждого элемента в списке столбцов. (Значения AFX_RFX_BOOL, AFX_RFX_BYTE, можно использовать и т. д., для этого, если требуется. Эти константы определены в файле AFXDB. З.) Выберите тип списка, в зависимости от представления типов данных столбцов.

###  <a name="_core_adding_rfx_calls_to_bind_the_columns"></a> Добавление вызовов функций RFX для привязки столбцов

Наконец, выполните действия для динамической привязки, поместив вызовы функций RFX для новых столбцов в вашей `DoFieldExchange` функции.

##### <a name="to-dynamically-add-rfx-calls-for-new-columns"></a>Чтобы динамически добавлять вызовы функций RFX для новых столбцов

1. К основному набору записей `DoFieldExchange` член функции, добавьте код, который просматривает список новых столбцов (столбцы к динамически привязать). В каждом цикле извлечь имя столбца из столбцов, которые необходимо привязать динамически и результирующее значение для столбца из динамических значений столбцов. Передайте эти элементы в вызов функции RFX, подходящим для типа данных столбца. Описание списков, см. в разделе [списки столбцов](#_core_lists_of_columns).

В общем случае в ваши `RFX_Text` вызовах функции `CString` объекты из списков, как приведенный ниже код, где столбцы, которые необходимо привязать динамически `CStringList` вызывается `m_listName` и значений столбца динамических `CStringList` вызывается `m_listValue`:

```cpp
RFX_Text( pFX,
            m_listName.GetNext( posName ),
            m_listValue.GetNext( posValue ));
```

Дополнительные сведения о функции RFX см. в разделе [макросы и глобальные объекты](../../mfc/reference/mfc-macros-and-globals.md) в *Справочник по библиотеке классов*.

> [!TIP]
> Если новые столбцы имеют разные типы данных, следует используйте инструкцию switch в цикле для вызова соответствующей функции RFX для каждого типа.

Когда платформа вызывает `DoFieldExchange` во время `Open` процесса для привязки столбцов к набору записей, вызовы функций RFX для статических столбцов привязывают эти столбцы. Затем цикл многократно вызывает функции RFX для динамических столбцов.

## <a name="see-also"></a>См. также

[Набор записей (ODBC)](../../data/odbc/recordset-odbc.md)<br/>
[Набор записей. Работа с большими элементами данных (ODBC)](../../data/odbc/recordset-working-with-large-data-items-odbc.md)