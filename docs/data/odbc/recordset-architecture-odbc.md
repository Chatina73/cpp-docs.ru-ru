---
title: Набор записей. Архитектура (ODBC)
ms.date: 11/04/2016
helpviewer_keywords:
- recordsets, data members
- field data members, recordset architecture
- field data members
- m_nParams data member, recordsets
- recordsets, architecture
- parameter data members in recordsets
- m_nFields data member
- ODBC recordsets, architecture
- m_nParams data member
- m_nFields data member, recordsets
ms.assetid: 47555ddb-11be-4b9e-9b9a-f2931764d298
ms.openlocfilehash: e95250b5ef307eafdb334050fbace945355e0521
ms.sourcegitcommit: 8e285a766523e653aeeb34d412dc6f615ef7b17b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/21/2020
ms.locfileid: "80079865"
---
# <a name="recordset-architecture-odbc"></a>Набор записей. Архитектура (ODBC)

Этот раздел относится к классам ODBC библиотеки MFC.

В этом разделе описаны элементы данных, составляющие архитектуру объекта набора записей.

- [Элементы данных полей](#_core_field_data_members)

- [Элементы данных параметров](#_core_parameter_data_members)

- [Использование элементов данных m_nFields и m_nParams](#_core_using_m_nfields_and_m_nparams)

> [!NOTE]
>  Этот раздел относится к объектам, производным от `CRecordset`, в которых пакетное получение строк не реализовано. Если пакетное получение строк реализовано, архитектура будет схожей. Сведения о различиях см. в разделе [набор записей: незначительная выборка записей (ODBC)](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md).

##  <a name="sample-class"></a><a name="_core_a_sample_class"></a> Пример класса

> [!NOTE]
> Мастер потребителя MFC ODBC недоступен в Visual Studio 2019 и более поздних версиях. При этом вы по-прежнему можете создать потребитель вручную.

При использовании [мастера объекта-получателя ODBC MFC](../../mfc/reference/adding-an-mfc-odbc-consumer.md) в мастере **Добавления класса**, чтобы объявить класс набора записей на основе `CRecordset`, результирующий класс имеет общую структуру, показанную в следующем простом классе:

```cpp
class CCourse : public CRecordset
{
public:
   CCourse(CDatabase* pDatabase = NULL);
   ...
   CString m_strCourseID;
   CString m_strCourseTitle;
   CString m_strIDParam;
};
```

В начале класса мастер записывает набор [элементов данных полей](#_core_field_data_members). При создании класса необходимо указать один или несколько элементов данных полей. Если класс является параметризованным, как класс в примере (с элементом данных `m_strIDParam`), необходимо вручную добавить [элементы данных параметров](#_core_parameter_data_members). Мастер не поддерживает добавление параметров в класс.

##  <a name="field-data-members"></a><a name="_core_field_data_members"></a> Элементы данных полей

Наиболее важные элементы класса в классе набора записей — это элементы данных полей. Для каждого столбца, выбранного из источника данных, этот класс содержит элемент данных соответствующего типа данных для этого столбца. Например, [пример класса](#_core_a_sample_class), показанный в начале этого раздела, содержит два элемента данных полей типа `CString`, которые называются `m_strCourseID` и `m_strCourseTitle`.

Когда набор записей выбирает набор записей, платформа автоматически связывает столбцы текущей записи (после вызова `Open`, первая запись является текущей) с элементами данных полей объекта. То есть платформа использует соответствующий элемент данных поля как буфер, в котором будет храниться содержимое столбца записи.

При переходе пользователя к новой записи платформа использует элементы данных полей для представления текущей записи. Платформа обновляет элементы данных полей, заменяя значения предыдущей записи. Элементы данных полей также используются для обновления текущей записи и добавления новых записей. В рамках процесса обновления записи вы указываете новые значения путем присвоения значений непосредственно соответствующим элементам данных полей.

##  <a name="parameter-data-members"></a><a name="_core_parameter_data_members"></a> Элементы данных параметров

Если класс является параметризованным, он имеет один или несколько элементов данных параметров. Параметризованный класс позволяет делать запрос к набору записей на основе данных, полученных или рассчитанных во время выполнения.

Как правило, параметр помогает сузить выбор, как показано в следующем примере. На основе [примера класса](#_core_a_sample_class) в начале этого раздела объект набора записей может выполнить следующую инструкцию SQL:

```sql
SELECT CourseID, CourseTitle FROM Course WHERE CourseID = ?
```

"?" — заменяет значение параметра, которое вы предоставляете во время выполнения. Когда вы создаете набор записей и задаете для его элемента данных `m_strIDParam` значение MATH101, эффективной инструкцией SQL для набора записей становится:

```sql
SELECT CourseID, CourseTitle FROM Course WHERE CourseID = MATH101
```

Определив элементы данных параметра, вы сообщаете платформе о параметрах в строке SQL. Платформа привязывает параметр, который указывает ODBC, где можно получить значения для замены заполнителя. В примере результирующий набор записей содержит только записи из таблицы Course со столбцом CourseID, значение которого равно MATH101. Выбраны все указанные столбцы этой записи. Можно указать любое необходимое число параметров (и заполнителей).

> [!NOTE]
>  Библиотека MFC сама ничего не делает с параметрами — в частности, она не выполняет подстановки текста. Вместо этого MFC сообщает ODBC, где получить параметр, а ODBC извлекает данные и выполняет необходимую параметризацию.

> [!NOTE]
>  Порядок параметров важен. Дополнительные сведения об этих и дополнительных сведениях о параметрах см. [в разделе набор записей. Параметризация набора записей (ODBC)](../../data/odbc/recordset-parameterizing-a-recordset-odbc.md).

##  <a name="using-m_nfields-and-m_nparams"></a><a name="_core_using_m_nfields_and_m_nparams"></a> Использование m_nFields и m_nParams

Когда мастер создает конструктор для класса, он также инициализирует элемент данных [m_nFields](../../mfc/reference/crecordset-class.md#m_nfields), который указывает количество [элементов данных полей](#_core_field_data_members) в классе. Если вы добавляете [параметры](#_core_parameter_data_members) в класс, необходимо также добавить инициализацию для элемента данных [m_nParams](../../mfc/reference/crecordset-class.md#m_nparams), который указывает число элементов данных параметров. Платформа использует эти значения для работы с элементами данных.

Дополнительные сведения и примеры см. [в разделе Обмен полями записи. Использование RFX](../../data/odbc/record-field-exchange-using-rfx.md).

## <a name="see-also"></a>См. также:

[Набор записей (ODBC)](../../data/odbc/recordset-odbc.md)<br/>
[Набор записей. Объявление класса таблицы (ODBC)](../../data/odbc/recordset-declaring-a-class-for-a-table-odbc.md)<br/>
[Обмен данными полей записей (RFX)](../../data/odbc/record-field-exchange-rfx.md)