---
title: Набор записей. Добавление, обновление и удаление записей (ODBC)
ms.date: 11/04/2016
helpviewer_keywords:
- records [C++], updating
- record editing [C++], in recordsets
- recordsets [C++], adding records
- records [C++], adding
- ODBC recordsets [C++], adding records
- recordsets [C++], editing records
- recordsets [C++], updating
- records [C++], deleting
- AddNew method
- ODBC recordsets [C++], deleting records
- data in recordsets [C++]
- record editing [C++]
- recordsets [C++], deleting records
- ODBC recordsets [C++], editing records
- records [C++], editing
ms.assetid: 760c8889-bec4-482b-a8f2-319792a6af98
ms.openlocfilehash: 28c885119816c1df662cc0b941e02cb3cf747f3d
ms.sourcegitcommit: 72583d30170d6ef29ea5c6848dc00169f2c909aa
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/18/2019
ms.locfileid: "59024612"
---
# <a name="recordset-adding-updating-and-deleting-records-odbc"></a>Набор записей. Добавление, обновление и удаление записей (ODBC)

Этот раздел относится к классам ODBC библиотеки MFC.

> [!NOTE]
>  Теперь можно добавить записи в пакетном режиме более эффективно. Дополнительные сведения см. в разделе [набор записей: Добавление записей (ODBC)](../../data/odbc/recordset-adding-records-in-bulk-odbc.md).

> [!NOTE]
>  Этот раздел относится к объектам, производным от `CRecordset` в какой строке массовой выборка не был реализован. Если вы используете выборка строк, см. в разделе [набор записей: Пакетная выборка строк (ODBC)](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md).

Обновляемые моментальные снимки и динамических подмножеств данных позволяют добавлять, изменять (обновлять) и удаления записей. Содержание раздела:

- [Как определить, является ли набор записей обновляемых](#_core_determining_whether_your_recordset_is_updatable).

- [Как добавить новую запись](#_core_adding_a_record_to_a_recordset).

- [Изменение существующей записи](#_core_editing_a_record_in_a_recordset).

- [Как удалить запись](#_core_deleting_a_record_from_a_recordset).

Дополнительные сведения про обновления выполнение и способы их отображения другим пользователям, см. в разделе [набор записей: Принципы обновления записей в наборе записей (ODBC)](../../data/odbc/recordset-how-recordsets-update-records-odbc.md). Как правило добавить, изменить или удалить запись набора записей изменяется, если источник данных немедленно. Вместо этого можно объединять группы связанных обновлений в транзакции. Если транзакция не выполняется, обновления не вступит в окончательный до фиксации транзакции. Это позволяет сделать назад или откатить изменения. Сведения о транзакциях см. в разделе [транзакции (ODBC)](../../data/odbc/transaction-odbc.md).

В следующей таблице перечислены параметры, доступные для наборов записей с разными характеристиками обновления.

### <a name="recordset-readupdate-options"></a>Параметры чтения или обновления набора записей

|Тип|Чтение|Изменение записи|Удаление записи|Добавить новую (append)|
|----------|----------|-----------------|-------------------|------------------------|
|Только чтение|Y|в|в|в|
|Только для добавления|Y|в|в|Y|
|Полностью обновляемый|Y|Y|Y|Y|

##  <a name="_core_determining_whether_your_recordset_is_updatable"></a> Определение ли набор записей является обновляемым

Объект набора записей можно обновлять, если источник данных является обновляемым и открыть набор записей как обновляемый. Обновляемость также зависит от инструкции SQL, вы используете, возможности своего драйвера ODBC, и от того, находится ли библиотека курсоров ODBC в памяти. Не удается обновить только для чтения записей или источник данных.

#### <a name="to-determine-whether-your-recordset-is-updatable"></a>Чтобы определить, является ли набор записей обновляемых

1. Вызов объекта набора записей [CanUpdate](../../mfc/reference/crecordset-class.md#canupdate) функция-член.

   `CanUpdate` возвращает ненулевое значение, если набор записей является обновляемым.

По умолчанию наборы данных являются полностью обновляемыми (можно выполнять `AddNew`, `Edit`, и `Delete` операций). Но можно также использовать [appendOnly](../../mfc/reference/crecordset-class.md#open) , чтобы открыть обновляемых наборов данных. Набор записей, открытый таким образом, позволяет только добавлять новые записи с помощью `AddNew`. Нельзя изменить или удалить существующие записи. Вы можете протестировать набор записей открыт только для присоединения, вызвав [CanAppend](../../mfc/reference/crecordset-class.md#canappend) функция-член. `CanAppend` возвращает ненулевое значение, если набор записей полностью обновляем или открыт только для присоединения.

В следующем коде показано, как можно использовать `CanUpdate` объекта набора записей с именем `rsStudentSet`:

```cpp
if( !rsStudentSet.Open( ) )
    return FALSE;
if( !rsStudentSet.CanUpdate( ) )
{
    AfxMessageBox( "Unable to update the Student recordset." );
    return;
}
```

> [!CAUTION]
>  При подготовке к обновлению набора записей, вызвав `Update`, будьте внимательны, что набор записей включает все столбцы, составляющие первичный ключ таблицы (или все столбцы уникального индекса в таблице). В некоторых случаях может использоваться платформой только столбцы, выбранные в наборе записей для определения записи в таблице для обновления. Без необходимых столбцов может обновить несколько записей в таблице, возможным повреждением ссылочную целостность таблицы. В этом случае платформа создает исключения, при вызове `Update`.

##  <a name="_core_adding_a_record_to_a_recordset"></a> Добавление записи в наборе записей

Можно добавлять новые записи в набор, если его [CanAppend](../../mfc/reference/crecordset-class.md#canappend) функция-член возвращает ненулевое значение.

#### <a name="to-add-a-new-record-to-a-recordset"></a>Чтобы добавить новую запись в набор записей

1. Убедитесь, что набор записей имеет возможность присоединения.

1. Вызов объекта набора записей [AddNew](../../mfc/reference/crecordset-class.md#addnew) функция-член.

   `AddNew` подготавливает набор записей в качестве буфера редактирования. Все поля элементов данных особое значение Null, которые помечены как без изменений, поэтому только измененные (является "грязным") значения записываются в источник данных, при вызове [обновления](../../mfc/reference/crecordset-class.md#update).

1. Задайте значения свойств элементов данных полей новой записи.

   Присвоение значений поля элементов данных. Те, которые не будут назначены не записываются в источник данных.

1. Вызов объекта набора записей `Update` функция-член.

   `Update` завершает процесс добавления путем записи новой записи в источнике данных. Сведения о происходит, если не удастся вызвать `Update`, см. в разделе [набор записей: Принципы обновления записей в наборе записей (ODBC)](../../data/odbc/recordset-how-recordsets-update-records-odbc.md).

Сведения о том, как добавления записей и время добавленных записей в вашем наборе записей, см. в разделе [набор записей: Как AddNew, Edit и Delete рабочих (ODBC)](../../data/odbc/recordset-how-addnew-edit-and-delete-work-odbc.md).

В следующем примере показано, как добавить новую запись:

```cpp
if( !rsStudent.Open( ) )
    return FALSE;
if( !rsStudent.CanAppend( ) )
    return FALSE;                      // no field values were set
rsStudent.AddNew( );
rsStudent.m_strName = strName;
rsStudent.m_strCity = strCity;
rsStudent.m_strStreet = strStreet;
if( !rsStudent.Update( ) )
{
    AfxMessageBox( "Record not added; no field values were set." );
    return FALSE;
}
```

> [!TIP]
>  Чтобы отменить `AddNew` или `Edit` сделайте еще один вызов `AddNew` или `Edit` или вызвать `Move` с *AFX_MOVE_REFRESH* параметра. Данные-члены будут сброшены к значениям предыдущей, и вы все еще являются `Edit` или `Add` режиме.

##  <a name="_core_editing_a_record_in_a_recordset"></a> Изменение записи в наборе записей

Можно изменять существующие записи, если набора записей [CanUpdate](../../mfc/reference/crecordset-class.md#canupdate) функция-член возвращает ненулевое значение.

#### <a name="to-edit-an-existing-record-in-a-recordset"></a>Чтобы изменить существующую запись в наборе записей

1. Убедитесь, что набор записей является обновляемым.

1. Перейдите к записи, который вы хотите обновить.

1. Вызов объекта набора записей [изменить](../../mfc/reference/crecordset-class.md#edit) функция-член.

   `Edit` подготавливает набор записей в качестве буфера редактирования. Таким образом, набор записей может впоследствии сообщать об их изменении, помечаются все поля элементов данных. Новые значения для элементов данных измененных полей записываются в источник данных при вызове [обновления](../../mfc/reference/crecordset-class.md#update).

1. Задайте значения свойств элементов данных полей новой записи.

   Присвоение значений поля элементов данных. Они не будут назначены значения остаются без изменений.

1. Вызов объекта набора записей `Update` функция-член.

   `Update` Завершает редактирование записи измененной записи в источнике данных. Сведения о происходит, если не удастся вызвать `Update`, см. в разделе [набор записей: Принципы обновления записей в наборе записей (ODBC)](../../data/odbc/recordset-how-recordsets-update-records-odbc.md).

После внесения записи измененной записи остается текущей записи.

В следующем примере показан `Edit` операции. Предполагается, что пользователь были перемещены в запись, которую требуется изменить.

```cpp
rsStudent.Edit( );
rsStudent.m_strStreet = strNewStreet;
rsStudent.m_strCity = strNewCity;
rsStudent.m_strState = strNewState;
rsStudent.m_strPostalCode = strNewPostalCode;
if( !rsStudent.Update( ) )
{
    AfxMessageBox( "Record not updated; no field values were set." );
    return FALSE;
}
```

> [!TIP]
> Чтобы отменить `AddNew` или `Edit` сделайте еще один вызов `AddNew` или `Edit` или вызвать `Move` с *AFX_MOVE_REFRESH* параметра. Данные-члены будут сброшены к значениям предыдущей, и вы все еще являются `Edit` или `Add` режиме.

##  <a name="_core_deleting_a_record_from_a_recordset"></a> Удаление записи из набора записей

Вы можете удалить записи, если набора записей [CanUpdate](../../mfc/reference/crecordset-class.md#canupdate) функция-член возвращает ненулевое значение.

#### <a name="to-delete-a-record"></a>Чтобы удалить запись

1. Убедитесь, что набор записей является обновляемым.

1. Перейдите к записи, который вы хотите обновить.

1. Вызов объекта набора записей [удалить](../../mfc/reference/crecordset-class.md#delete) функция-член.

   `Delete` запись сразу же помечается, как удаленные, как в наборе записей, так и в источнике данных.

   В отличие от `AddNew` и `Edit`, `Delete` не имеет соответствующей `Update` вызова.

1. Перейти к другой записи.

   > [!NOTE]
   >  При перемещении по набору записей, удаленные записи не могут быть пропущены. Дополнительные сведения см. в разделе [IsDeleted](../../mfc/reference/crecordset-class.md#isdeleted) функция-член.

В следующем примере показан `Delete` операции. Предполагается, что пользователь переместил запись, которую требуется удалить. После `Delete` — является необходимо перейти к новой записи.

```
rsStudent.Delete( );
rsStudent.MoveNext( );
```

Дополнительные сведения о последствиях `AddNew`, `Edit`, и `Delete` функций-членов см. в разделе [набор записей: Принципы обновления записей в наборе записей (ODBC)](../../data/odbc/recordset-how-recordsets-update-records-odbc.md).

## <a name="see-also"></a>См. также

[Набор записей (ODBC)](../../data/odbc/recordset-odbc.md)<br/>
[Набор записей. Блокировка записей (ODBC)](../../data/odbc/recordset-locking-records-odbc.md)