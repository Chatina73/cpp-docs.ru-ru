---
title: 'Обмен полями записей: Принцип работы RFX'
ms.date: 11/04/2016
helpviewer_keywords:
- record editing [C++], using RFX
- RFX (ODBC) [C++], updating data in recordsets
- scrolling [C++]
- ODBC [C++], RFX
- data binding [C++], DFX
- scrolling [C++], RFX
- RFX (ODBC) [C++], binding fields and parameters
ms.assetid: e647cacd-62b0-4b80-9e20-b392deca5a88
ms.openlocfilehash: 7da9d480f16dcb6bc5ded0a1dff559b1b1ac4b38
ms.sourcegitcommit: 0ab61bc3d2b6cfbd52a16c6ab2b97a8ea1864f12
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "62395707"
---
# <a name="record-field-exchange-how-rfx-works"></a>Обмен полями записей: Принцип работы RFX

В этом разделе объясняется процесс RFX. Это подробное объяснение темы:

- [RFX и набор записей](#_core_rfx_and_the_recordset)

- [Процесс RFX](#_core_the_record_field_exchange_process)

> [!NOTE]
>  Этот раздел относится к классам, производным от `CRecordset` в какой строке массовой выборка не был реализован. Если вы используете выборка строк, реализуется блочный обмен полей записей (Bulk RFX). Bulk RFX аналогичен RFX. Сведения о различиях, см. в разделе [набор записей: Пакетная выборка строк (ODBC)](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md).

##  <a name="_core_rfx_and_the_recordset"></a> RFX и набор записей

Элементы данных полей объекта набора записей, взятые вместе, составляют буфер редактирования, который содержит выбранные столбцы из одной записи. При первом открытии набор записей и происходит считывание первой записи, RFX связывает (ассоциирует каждого) выбранного столбца на адрес элемента данных, соответствующее поле. Когда набор записей обновляет запись, RFX вызывает функции ODBC API для отправки SQL **обновление** или **вставить** инструкции к драйверу. RFX основе своих знаний о элементами данных полей, чтобы указать столбцы для записи.

Платформа создает резервные копии в буфере на определенных этапах, при необходимости его можно восстановить его содержимое. RFX создает резервные копии в буфере перед добавив новую запись и изменение существующей записи. После восстановления в буфере, в некоторых случаях, например, `Update` следующий вызов `AddNew`. В буфере не восстанавливается, если вы отказаться от только что измененных буфере, например, перемещение в другой записи до вызова метода `Update`.

Помимо обмена данными между источником данных и поля элементов данных набора записей, RFX управляет параметрами привязки. При открытии набора записей, в порядке следования в коллекции связанных элементов данных параметров «?» заполнители в инструкции SQL, `CRecordset::Open` конструкции. Дополнительные сведения см. в разделе [набор записей: Параметризация набора записей (ODBC)](../../data/odbc/recordset-parameterizing-a-recordset-odbc.md).

Переопределение класса набора записей `DoFieldExchange` выполняет всю работу, перемещение данных в обоих направлениях. Как обмен данными диалоговых окон (DDX) RFX требуются сведения об элементах данных класса. Мастер предоставляет необходимую информацию, написав реализацию конкретного набора записей `DoFieldExchange` , на основе поля данных члена имена и типы данных указываются с помощью мастера.

##  <a name="_core_the_record_field_exchange_process"></a> Процесс Exchange поля записей

В этом разделе описана последовательность событий RFX при открытии объекта набора записей и по мере добавления, обновления и удаления записей. Таблицы [последовательность операций RFX во время открытия набора записей](#_core_sequence_of_rfx_operations_during_recordset_open) и таблице [последовательность операций RFX во время прокрутки](#_core_sequence_of_rfx_operations_during_scrolling) в этом разделе показано, как процессы RFX `Move` в команду набор записей, и как RFX управляет обновлением. В ходе этих процессов [DoFieldExchange](../../mfc/reference/crecordset-class.md#dofieldexchange) вызывается для выполнения различных операций. `m_nOperation` Данными-членом [CFieldExchange](../../mfc/reference/cfieldexchange-class.md) объект определяет, какие операции запрашивается. Могут оказаться полезными для чтения [набор записей: Порядок выборки записей (ODBC)](../../data/odbc/recordset-how-recordsets-select-records-odbc.md) и [набор записей: Как записи обновления наборов записей (ODBC)](../../data/odbc/recordset-how-recordsets-update-records-odbc.md) перед прочтением этого материала.

###  <a name="_mfc_rfx.3a_.initial_binding_of_columns_and_parameters"></a> RFX: Начальная привязки столбцов и параметров

Следующие действия RFX выполняются в указанном порядке, при вызове объекта recordset [откройте](../../mfc/reference/crecordset-class.md#open) функция-член:

- Если набор записей содержит параметризованные члены данных, платформа вызывает `DoFieldExchange` для привязки параметров соответствует заполнителям параметров в строке инструкции SQL набора записей. Данные, зависящие от типа представление значения параметра используется для каждого местозаполнителя найдены в **ВЫБЕРИТЕ** инструкции. Это происходит после подготовки инструкции SQL, но перед его выполнением. Сведения о подготовке инструкции см. в разделе `::SQLPrepare` функции в ODBC *справочнике программиста*.

- Платформа вызывает `DoFieldExchange` во второй раз для привязки значений выбранных столбцов с соответствующими элементами данных полей в наборе записей. Это устанавливает объекта набора записей в качестве буфера редактирования, содержащего столбцы первой записи.

- Набор записей выполняет инструкцию SQL и источника данных выбирает первую запись. Столбцы записи загружаются в поля элементов данных набора записей.

Следующая таблица отображает последовательность операций RFX при открытии набора записей.

### <a name="_core_sequence_of_rfx_operations_during_recordset_open"></a> Последовательность операций RFX при открытии набора записей

|Операции|DoFieldExchange операции|Операция базы данных/SQL|
|--------------------|-------------------------------|-----------------------------|
|1. Открыть набор записей.|||
||2. Построение инструкции SQL.||
|||3. Отправьте код SQL.|
||4. Связывание элементов данных параметров.||
||5. Привязка поля элементов данных со столбцами.||
|||6. ODBC выполняет перемещение и заполнение данных.|
||7. Привязка данных для C++.||

Наборы записей используют подготовленное выполнение ODBC позволяет быстро обновления запросов с той же инструкции SQL. Дополнительные сведения о подготовленное выполнение, см. в разделе ODBC SDK *справочнике программиста* в библиотеке MSDN.

###  <a name="_mfc_rfx.3a_.scrolling"></a> RFX: Прокрутка

Во время перехода от одной записи в другую, платформа вызывает `DoFieldExchange` для замены значений, предварительно сохраненных в элементами данных полей со значениями для новой записи.

Следующая таблица показывает последовательность операций RFX при переходе от записи к записи.

### <a name="_core_sequence_of_rfx_operations_during_scrolling"></a> Последовательность операций RFX при прокрутке

|Операции|DoFieldExchange операции|Операция базы данных/SQL|
|--------------------|-------------------------------|-----------------------------|
|1. Вызовите `MoveNext` или один из других функций Move.|||
|||2. ODBC выполняет перемещение и заполнение данных.|
||3. Привязка данных для C++.||

###  <a name="_mfc_rfx.3a_.adding_new_records_and_editing_existing_records"></a> RFX: Добавление новых записей и изменение существующих записей

При добавлении новой записи, набор записей выполняет буфера редактирования для построения содержимого новой записи. При добавлении записей, изменение записей предполагает изменение значения поля элементов данных набора записей. С точки зрения RFX последовательность выглядит следующим образом:

1. При вызове набора записей [AddNew](../../mfc/reference/crecordset-class.md#addnew) или [изменить](../../mfc/reference/crecordset-class.md#edit) функция-член вызывает RFX сохраняет текущий буфер редактирования, чтобы его можно было впоследствии восстановить.

1. `AddNew` или `Edit` подготавливает поля в буфере редактирования, чтобы RFX мог обнаружить элементы измененных данных полей.

   Так как новая запись не имеет предыдущих значений для сравнения с, `AddNew` задает значение элемента данных каждого поля значение PSEUDO_NULL. Позже, при вызове `Update`, RFX сравнивает значение каждого элемента данных со значением PSEUDO_NULL. Если есть различия, член данных задано. (PSEUDO_NULL не так же, как столбец записи со значением Null значение true, и любой из этих так же, как C++ NULL.)

   В отличие от `Update` вызова для `AddNew`, `Update` вызова для `Edit` сравнивает обновленные значения с ранее сохраненных значений, а не с помощью PSEUDO_NULL. Разница в том, `AddNew` не имеет ранее сохраненных значений для сравнения.

1. Вы непосредственно задать значения элементов данных полей, значения которых требуется изменить или заполнить для новой записи. Это могут быть вызовом `SetFieldNull`.

1. При вызове [обновление](../../mfc/reference/crecordset-class.md#update) проверяются элементы измененных полей данных, как описано в шаге 2 (см. в таблице [последовательность операций RFX во время прокрутки](#_core_sequence_of_rfx_operations_during_scrolling)). Если ничего не изменилось, `Update` возвращает 0. Если изменились некоторые поля элементов данных, `Update` подготавливает и выполняет SQL **вставить** инструкцию, которая содержит значения для всех обновленных полей в записи.

1. Для `AddNew`, `Update` завершается путем восстановления ранее сохраненные значения записи, которая была текущей до `AddNew` вызова. Для `Edit`, новые, измененные значения остаются на месте.

Следующая таблица показывает последовательность операций RFX при добавлении новой записи или изменить существующую запись.

### <a name="sequence-of-rfx-operations-during-addnew-and-edit"></a>Последовательность операций RFX во время AddNew и редактирования

|Операции|DoFieldExchange операции|Операция базы данных/SQL|
|--------------------|-------------------------------|-----------------------------|
|1. Вызовите `AddNew` или `Edit`.|||
||2. Резервное копирование в буфере.||
||3. Для `AddNew`, элементы данных полей как «чистым» и значение Null.||
|4. Присвоение значений поля элементов данных набора записей.|||
|5. Вызовите метод `Update`.|||
||6. Проверьте наличие измененных полей.||
||7. Сборки SQL **вставить** инструкции для `AddNew` или **обновление** инструкции для `Edit`.||
|||8. Отправьте код SQL.|
||9. Для `AddNew`, восстанавливается в буфере резервных копий. Для `Edit`, удалить резервную копию.||

### <a name="rfx-deleting-existing-records"></a>RFX: Удаление существующих записей

При удалении записи RFX задает все поля значение NULL в качестве Напоминаем, что запись удаляется, и необходимо выполнить перемещение. Любые другие сведения о последовательности RFX не обязательно.

## <a name="see-also"></a>См. также

[Обмен данными полей записей (RFX)](../../data/odbc/record-field-exchange-rfx.md)<br/>
[Потребление MFC ODBC](../../mfc/reference/adding-an-mfc-odbc-consumer.md)<br/>
[Макросы, глобальные функции и глобальные переменные](../../mfc/reference/mfc-macros-and-globals.md)<br/>
[Класс CFieldExchange](../../mfc/reference/cfieldexchange-class.md)<br/>
[CRecordset::DoFieldExchange](../../mfc/reference/crecordset-class.md#dofieldexchange)