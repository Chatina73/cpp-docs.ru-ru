---
title: Набор записей. Создание и закрытие наборов записей (ODBC)
ms.date: 11/04/2016
helpviewer_keywords:
- ODBC recordsets, creating
- recordsets, creating
- recordsets, opening
- recordsets, closing
- ODBC recordsets, closing
- ODBC recordsets, opening
ms.assetid: 8d2aac23-4396-4ce2-8c60-5ecf1b360d3d
ms.openlocfilehash: d98f7e59e52b86a1b9b1c3ffac5c3e7160e6c36d
ms.sourcegitcommit: 6052185696adca270bc9bdbec45a626dd89cdcdd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/31/2018
ms.locfileid: "50581510"
---
# <a name="recordset-creating-and-closing-recordsets-odbc"></a>Набор записей. Создание и закрытие наборов записей (ODBC)

Этот раздел относится к классам ODBC библиотеки MFC.

Чтобы использовать набор записей, создайте объект набора записей, а затем вызвать его `Open` функцию-член для выполнить запрос набора записей и записей. После завершения работы с набором записей, закройте и удалите объект.

Содержание раздела:

- [Когда и как создавать объект набора записей](#_core_creating_recordsets_at_run_time).

- [Когда и как можно определять поведение набора записей путем параметризации, фильтрации, сортировки или блокировки](#_core_setting_recordset_options).

- [Когда и как следует закрывать объект набора записей](#_core_closing_a_recordset).

##  <a name="_core_creating_recordsets_at_run_time"></a> Создание наборов записей во время выполнения

Перед созданием объекта набора записей в вашей программе, обычно вы создаете классы набора записей для конкретного приложения. Дополнительные сведения об этом предварительном этапе см. в разделе [Добавление потребителя ODBC MFC](../../mfc/reference/adding-an-mfc-odbc-consumer.md).

Откройте динамический или статический объект, для выбора записей из источника данных. Тип создаваемого объекта зависит от того, что необходимо сделать с данными в приложении и на какие драйвер ODBC поддерживает. Дополнительные сведения см. в разделе [динамический набор](../../data/odbc/dynaset.md) и [моментального снимка](../../data/odbc/snapshot.md).

#### <a name="to-open-a-recordset"></a>Чтобы открыть набор записей

1. Создайте объект вашей `CRecordset`-производного класса.

   Можно создать объект в куче или в кадре стека функции.

1. При необходимости измените поведение по умолчанию набор записей. Доступные параметры, см. в разделе [Настройка параметров набора записей](#_core_setting_recordset_options).

1. Вызов объекта [откройте](../../mfc/reference/crecordset-class.md#open) функция-член.

В конструкторе, передать указатель на `CDatabase` объекта или передать значение NULL, чтобы использовать объект временной базы данных, платформа создает и открывает, на основе строки подключения, возвращенный [GetDefaultConnect](../../mfc/reference/crecordset-class.md#getdefaultconnect) функция-член. `CDatabase` Объект может быть подключен к источнику данных.

Вызов `Open` SQL используется для выбора записей из источника данных. Первая запись (если таковые имеются) становится текущей записи. Значения полей записи хранятся в объекте набора записей поля элементов данных. Если какие-либо записи были выбраны, как `IsBOF` и `IsEOF` функции-члены возвращают 0.

В вашей [откройте](../../mfc/reference/crecordset-class.md#open) вызов, вы можете:

- Укажите, является ли набор записей динамический или статический. По умолчанию наборы записей открываются как моментальные снимки. Или можно указать последовательного набора записей, которая позволяет только прямую прокрутку, одной записи за раз.

   По умолчанию набор записей используется тип по умолчанию, хранящиеся в `CRecordset` данные-член `m_nDefaultType`. Мастеры написать код для инициализации `m_nDefaultType` тип набора записей, выберите в мастере. Вместо того, чтобы принимать это значение по умолчанию, можно заменить другой тип набора записей.

- Укажите строку, чтобы заменить значение по умолчанию SQL **ВЫБЕРИТЕ** инструкцию, которая создает набор записей.

- Укажите, является ли набор записей только для чтения или только для добавления. Наборы записей могут полностью обновления по умолчанию, но, можно ограничить только добавление новых записей или запретить все обновления.

Приведенный ниже показано, как открыть только для чтения моментальный снимок объекта класса `CStudentSet`, класс конкретного приложения:

```cpp
// Construct the snapshot object
CStudentSet rsStudent( NULL );
// Set options if desired, then open the recordset
if(!rsStudent.Open(CRecordset::snapshot, NULL, CRecordset::readOnly))
    return FALSE;
// Use the snapshot to operate on its records...
```

После вызова метода `Open`, члены функции и данные члена объекта используются для работы с записями. В некоторых случаях может потребоваться повторный запрос или обновление recordset для включения изменений, которые произошли в источнике данных. Дополнительные сведения см. в разделе [набор записей: выполнение обновления наборов записей (ODBC)](../../data/odbc/recordset-requerying-a-recordset-odbc.md).

> [!TIP]
>  Строка подключения, которую можно использовать во время разработки может оказаться же строка подключения, которая требуется вашим конечным пользователям. Идеи подготовке приложения таким образом, см. в разделе [источника данных: управление подключениями (ODBC)](../../data/odbc/data-source-managing-connections-odbc.md).

##  <a name="_core_setting_recordset_options"></a> Настройка параметров набора записей

После создания объекта набора записей, но перед вызовом метода `Open` для выбора записей, может потребоваться задать некоторые параметры для управления поведением набора записей. Для всех наборов записей вы можете:

- Укажите [фильтр](../../data/odbc/recordset-filtering-records-odbc.md) для ограничения выбора записей.

- Укажите [сортировки](../../data/odbc/recordset-sorting-records-odbc.md) порядок записей.

- Укажите [параметры](../../data/odbc/recordset-parameterizing-a-recordset-odbc.md) для выбора записей с помощью данных, полученных или вычисляется во время выполнения.

Можно также задать следующий параметр, если условия верны:

- Если набор записей является обновляемым и поддерживает параметры блокировки, укажите [блокировки](../../data/odbc/recordset-locking-records-odbc.md) метод, используемый для обновления.

> [!NOTE]
>  Чтобы повлиять на выбор записей, необходимо настроить эти параметры перед вызовом метода `Open` функция-член.

##  <a name="_core_closing_a_recordset"></a> Закрытие набора записей

Когда вы закончите с набором записей, вы удалите его и освобождения его памяти.

#### <a name="to-close-a-recordset"></a>Закрытие набора записей

1. Вызовите его [закрыть](../../mfc/reference/crecordset-class.md#close) функция-член.

1. Уничтожает объект recordset.

   Если он был объявлен в кадре стека функции, объект будет удален автоматически, когда объект выходит за пределы области действия. В противном случае используйте **удалить** оператор.

`Close` Освобождает набора записей `HSTMT` обработки. Она не удаляет объекта C++.

## <a name="see-also"></a>См. также

[Набор записей (ODBC)](../../data/odbc/recordset-odbc.md)<br/>
[Набор записей. Прокрутка (ODBC)](../../data/odbc/recordset-scrolling-odbc.md)<br/>
[Набор записей. Добавление, обновление и удаление записей (ODBC)](../../data/odbc/recordset-adding-updating-and-deleting-records-odbc.md)