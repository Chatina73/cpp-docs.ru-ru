---
title: Набор записей. Создание и закрытие наборов записей (ODBC)
ms.date: 05/09/2019
helpviewer_keywords:
- ODBC recordsets, creating
- recordsets, creating
- recordsets, opening
- recordsets, closing
- ODBC recordsets, closing
- ODBC recordsets, opening
ms.assetid: 8d2aac23-4396-4ce2-8c60-5ecf1b360d3d
ms.openlocfilehash: b4896dff711d87db05334afc0345c15da2fa23e6
ms.sourcegitcommit: fc1de63a39f7fcbfe2234e3f372b5e1c6a286087
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/15/2019
ms.locfileid: "65707977"
---
# <a name="recordset-creating-and-closing-recordsets-odbc"></a>Набор записей. Создание и закрытие наборов записей (ODBC)

> [!NOTE] 
> Мастер потребителя MFC ODBC недоступен в Visual Studio 2019 и более поздних версиях. При этом вы по-прежнему можете создать потребитель вручную.

Этот раздел относится к классам ODBC библиотеки MFC.

Чтобы использовать набор записей, создайте объект набора записей и вызовите его функцию элемента `Open`, чтобы выполнить запрос набора записей и выбрать записи. После завершения работы с набором записей закройте и удалите объект.

В этом разделе рассматриваются следующие вопросы.

- [Когда и как создавать объект набора записей](#_core_creating_recordsets_at_run_time).

- [Когда и как можно определять поведение набора записей путем параметризации, фильтрации, сортировки или блокировки](#_core_setting_recordset_options).

- [Когда и как закрывать объект набора записей](#_core_closing_a_recordset).

##  <a name="_core_creating_recordsets_at_run_time"></a> Создание наборов записей в среде выполнения

Перед созданием объектов набора записей в программе обычно вы записываете классы набора записей для конкретного приложения. Дополнительные сведения об этом предварительном этапе см. в разделе [Добавление объекта-получателя ODBC MFC](../../mfc/reference/adding-an-mfc-odbc-consumer.md).

Откройте динамическое подмножество данных или объект моментального снимка, чтобы выбрать записи из источника данных. Тип создаваемого объекта зависит от того, что необходимо сделать с данными в приложении и что поддерживает ваш драйвер ODBC. Дополнительные сведения см. в разделе [Динамическое подмножество данных](../../data/odbc/dynaset.md) и [Моментальный снимок](../../data/odbc/snapshot.md).

#### <a name="to-open-a-recordset"></a>Открытие набора записей

1. Создайте объект класса, производного от `CRecordset`.

   Вы можете создать объект в куче или в кадре стека функции.

1. При необходимости измените поведение набора записей по умолчанию. Доступные параметры см. в разделе [Настройка параметров набора записей](#_core_setting_recordset_options).

1. Вызовите функцию элемента [Open](../../mfc/reference/crecordset-class.md#open) объекта.

В конструкторе передайте указатель на объект `CDatabase` или передайте значение NULL, чтобы использовать объект временной базы данных, который платформа создает и открывает на основе строки подключения, возвращенной функцией элемента [GetDefaultConnect](../../mfc/reference/crecordset-class.md#getdefaultconnect). Объект `CDatabase` может уже быть подключен к источнику данных.

Вызов к `Open` использует SQL для выбора записей из источника данных. Первая выбранная запись (если таковые имеются) становится текущей записью. Значения полей этой записи хранятся в элементах данных полей объекта набора записей. Если записи были выбраны, функции элементов `IsBOF` и `IsEOF` возвращают 0.

В вызове [Open](../../mfc/reference/crecordset-class.md#open) у вас есть следующие возможности.

- Укажите, является ли набор записей динамическим подмножеством или моментальным снимком. По умолчанию наборы записей открываются как моментальные снимки. Или вы можете указать набор записей только с перемещением вперед, который позволяет только прямую прокрутку по одной записи за раз.

   По умолчанию набор записей использует тип по умолчанию, хранящийся в элементе данных `CRecordset` `m_nDefaultType`. Мастера пишут код для инициализации `m_nDefaultType` в тип набора записей, выбранный в мастере. Вместо того чтобы принять это значение по умолчанию, можно заменить другой тип набора записей.

- Укажите строку, чтобы заменить инструкцию SQL **SELECT** по умолчанию, которую создает набор записей.

- Укажите, предоставляется ли набор записей только для чтения или только для добавления. Наборы записей могут допускать полное обновление по умолчанию, но вы можете ограничить его только добавлением новых записей или запретить все обновления.

Приведенный ниже пример показывает, как открыть объект моментального снимка только для чтения класса `CStudentSet` — класса конкретного приложения:

```cpp
// Construct the snapshot object
CStudentSet rsStudent( NULL );
// Set options if desired, then open the recordset
if(!rsStudent.Open(CRecordset::snapshot, NULL, CRecordset::readOnly))
    return FALSE;
// Use the snapshot to operate on its records...
```

После вызова `Open` используйте функции элементов и элементы данных объекта для работы с записями. В некоторых случаях может потребоваться повторный запрос или обновление набора записей, чтобы включить изменения, которые произошли в источнике данных. Дополнительные сведения см. в разделе [Набор записей. Повторный запрос набора записей (ODBC)](../../data/odbc/recordset-requerying-a-recordset-odbc.md).

> [!TIP]
>  Строка подключения, которую вы используете во время разработки, может не совпадать со строкой подключения, которая требуется вашим конечным пользователям. Идеи по добавлению универсальности в этот аспект приложения см. в разделе [Источник данных: управление соединениями (ODBC)](../../data/odbc/data-source-managing-connections-odbc.md).

##  <a name="_core_setting_recordset_options"></a> Настройка параметров набора записей

После создания объекта набора записей и перед вызовом `Open` для выбора записей может потребоваться задать некоторые параметры для управления поведением набора записей. Для всех наборов записей у вас есть следующие возможности.

- Укажите [фильтр](../../data/odbc/recordset-filtering-records-odbc.md) для ограничения выбора записей.

- Укажите порядок [сортировки](../../data/odbc/recordset-sorting-records-odbc.md) записей.

- Укажите [параметры](../../data/odbc/recordset-parameterizing-a-recordset-odbc.md), чтобы выбирать записи с помощью данных, полученных или вычисленных в среде выполнения.

Можно также задать следующий параметр, если условия подходящие:

- Если набор записей является обновляемым и поддерживает параметры блокировки, укажите метод [блокировки](../../data/odbc/recordset-locking-records-odbc.md), используемый для обновлений.

> [!NOTE]
>  Чтобы повлиять на выбор записей, необходимо настроить эти параметры перед вызовом функции элемента `Open`.

##  <a name="_core_closing_a_recordset"></a> Закрытие набора записей

Когда вы закончите с набором записей, вы должны удалить его и освободить память.

#### <a name="to-close-a-recordset"></a>Закрытие набора записей

1. Вызовите его функцию элемента [Close](../../mfc/reference/crecordset-class.md#close).

1. Уничтожьте объект набора записей.

   Если вы объявили его в кадре стека функции, объект будет удален автоматически, когда выйдет за пределы области действия. В противном случае используйте оператор **delete**.

`Close` освобождает обработку `HSTMT` набора записей. Он не удаляет объект C++.

## <a name="see-also"></a>См. также

[Набор записей (ODBC)](../../data/odbc/recordset-odbc.md)<br/>
[Набор записей. Прокрутка (ODBC)](../../data/odbc/recordset-scrolling-odbc.md)<br/>
[Набор записей. Добавление, обновление и удаление записей (ODBC)](../../data/odbc/recordset-adding-updating-and-deleting-records-odbc.md)