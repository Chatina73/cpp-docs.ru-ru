---
title: MFC. Использование классов базы данных с документами и представлениями
ms.date: 11/04/2016
helpviewer_keywords:
- documents [C++], database applications
- recordsets [C++], documents and views
- CRecordView class, using in database forms
- views [C++], database applications
- forms [C++], database applications
- record views [C++], form-based applications
- document/view architecture [C++], in databases
- database applications [C++], forms
- database classes [C++], MFC
- ODBC recordsets [C++], documents and views
- ODBC [C++], forms
ms.assetid: 83979974-fc63-46ac-b162-e8403a572e2c
ms.openlocfilehash: e2b073b20b9518667b43c30e7ee3199a84a3ad38
ms.sourcegitcommit: 857fa6b530224fa6c18675138043aba9aa0619fb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/24/2020
ms.locfileid: "80213386"
---
# <a name="mfc-using-database-classes-with-documents-and-views"></a>MFC. Использование классов базы данных с документами и представлениями

Классы базы данных MFC можно использовать с архитектурой "документ-представление" или без нее. В этом разделе акцентируется внимание на работе с документами и представлениями. В нем объясняется следующее:

- [Как создать приложение на основе форм](#_core_writing_a_form.2d.based_application) , используя объект `CRecordView` в качестве основного представления документа.

- [Использование объектов набора записей в документах и представлениях](#_core_using_recordsets_in_documents_and_views).

- [Другие рекомендации](#_core_other_factors).

Альтернативные варианты см. [в разделе MFC: использование классов баз данных без документов и представлений](../data/mfc-using-database-classes-without-documents-and-views.md).

##  <a name="writing-a-form-based-application"></a><a name="_core_writing_a_form.2d.based_application"></a>Написание приложения на основе форм

Многие приложения для доступа к данным основаны на формах. Пользовательский интерфейс — это форма, содержащая элементы управления, в которых пользователь проверяет, вводит или редактирует данные. Чтобы сделать приложение на основе формы, используйте класс `CRecordView`. При запуске мастера приложений MFC и выборе типа клиента **ODBC** на странице **поддержки базы данных** проект использует `CRecordView` для класса представления.

В приложении на основе форм каждый объект представления записей хранит указатель на объект `CRecordset`. Механизм обмена полями записей (RFX) платформы обменивается данными между набором записей и источником данных. Механизм обмена данными в диалоговом окне (DDX) обменивается данными между элементами данных поля объекта Recordset и элементами управления в форме. `CRecordView` также предоставляет функции обработчика команд по умолчанию для перехода от записи к записи в форме.

Сведения о создании приложения на основе форм с помощью мастера приложений см. в разделе [Создание приложения MFC на основе форм](../mfc/reference/creating-a-forms-based-mfc-application.md) и [Поддержка баз данных, мастер приложений MFC](../mfc/reference/database-support-mfc-application-wizard.md).

Полное описание форм см. в разделе [представления записей](../data/record-views-mfc-data-access.md).

##  <a name="using-recordsets-in-documents-and-views"></a><a name="_core_using_recordsets_in_documents_and_views"></a>Использование наборов записей в документах и представлениях

Многие простые приложения на основе форм не нуждаются в документах. Если приложение более сложное, возможно, вы захотите использовать документ в качестве прокси-сервера для базы данных, сохранив объект `CDatabase`, который подключается к источнику данных. Приложения на основе форм обычно хранят указатель на объект набора записей в представлении. Другие типы приложений баз данных хранят наборы записей и объект `CDatabase` в документе. Ниже приведены некоторые возможности использования документов в приложениях баз данных.

- При доступе к набору записей в локальном контексте создайте объект `CRecordset` локально в функциях-членах документа или представления по мере необходимости.

   Объявите объект набора записей как локальную переменную в функции. Передайте значение NULL в конструктор, в результате чего платформа создаст и откроет временный объект `CDatabase`. В качестве альтернативы можно передать указатель на объект `CDatabase`. Используйте набор записей в функции и позвольте ему автоматически уничтожить при выходе из функции.

   При передаче значения NULL в конструктор набора записей платформа использует сведения, возвращаемые функцией-членом набора записей `GetDefaultConnect` для создания объекта `CDatabase` и его открытия. Мастера реализуют `GetDefaultConnect`.

- При доступе к набору записей в течение времени существования документа внедрите один или несколько объектов `CRecordset` в документ.

   Создавайте объекты набора записей при инициализации документа или по мере необходимости. Вы можете написать функцию, возвращающую указатель на набор записей, если он уже существует, или создает и открывает набор записей, если он еще не существует. Закройте, удалите и повторно создайте набор записей по мере необходимости или вызовите его `Requery` функцию члена для обновления записей.

- Если вы обращаетесь к источнику данных в течение времени существования документа, внедрите `CDatabase` объект или сохраните указатель на объект `CDatabase` в нем.

   Объект `CDatabase` управляет подключением к источнику данных. Объект создается автоматически во время создания документа и вызывается его `Open` функции-члена при инициализации документа. При создании объектов набора записей в функциях-членах документа передается указатель на объект `CDatabase` документа. При этом каждый набор записей связывается с источником данных. Объект базы данных, как правило, уничтожается при закрытии документа. Объекты набора записей обычно уничтожаются при выходе из области действия функции.

##  <a name="other-factors"></a><a name="_core_other_factors"></a>Другие факторы

Приложения на основе форм часто не используют механизм сериализации документов платформы, поэтому может потребоваться удалить, отключить или заменить команды " **создать** " и " **Открыть** " в меню " **файл** ". См. статью [сериализация: сериализация и ввод-вывод базы данных](../mfc/serialization-serialization-vs-database-input-output.md).

Может также потребоваться использовать многие возможности пользовательского интерфейса, которые может поддерживать платформа. Например, можно использовать несколько `CRecordView` объектов в окне разделителя, открыть несколько наборов записей в разных дочерних окнах многодокументного интерфейса (MDI) и т. д.

Может потребоваться реализовать печать любого элемента в представлении, будь то форма, реализованная с `CRecordView` или что-то другое. Как классы, производные от `CFormView`, `CRecordView` не поддерживает печать, но можно переопределить функцию `OnPrint` члена, чтобы разрешить печать. Дополнительные сведения см. в разделе класс [CFormView](../mfc/reference/cformview-class.md).

Вам может не потребоваться использовать документы и представления. В этом случае см. раздел [MFC: использование классов баз данных без документов и представлений](../data/mfc-using-database-classes-without-documents-and-views.md).

## <a name="see-also"></a>См. также раздел

[MFC-классы баз данных](../data/mfc-database-classes-odbc-and-dao.md)
