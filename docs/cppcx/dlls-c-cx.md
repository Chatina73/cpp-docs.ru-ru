---
title: Библиотеки DLL (C++/CX)
ms.date: 02/06/2018
ms.assetid: 5b8bcc57-64dd-4c54-9f24-26a25bd5dddd
ms.openlocfilehash: 4db0ed4f11f03c65c440c7b654653347da1d4536
ms.sourcegitcommit: 180f63704f6ddd07a4172a93b179cf0733fd952d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/06/2019
ms.locfileid: "70740263"
---
# <a name="dlls-ccx"></a>Библиотеки DLL (C++/CX)

Visual Studio можно использовать для создания стандартной библиотеки DLL Win32 или библиотеки среда выполнения Windows компонентов, которую можно использовать в приложениях универсальная платформа Windows (UWP). Стандартная библиотека DLL, созданная с помощью версии Visual Studio или компилятора Майкрософт C++ , более ранней, чем visual Studio 2012, может быть неправильно загружена в приложение UWP и не может передавать тест проверки приложения в Microsoft Store.

## <a name="windows-runtime-component-dlls"></a>среда выполнения Windowsные библиотеки DLL компонентов

В большинстве случаев, когда нужно создать библиотеку DLL для использования в приложении UWP, создайте ее в качестве среда выполнения Windows компонента, используя шаблон проекта с таким именем. Можно создать проект среда выполнения Windows компонентов для библиотек DLL, имеющих открытые или закрытые типы среда выполнения Windows. Доступ к компоненту среда выполнения Windows можно получить из приложений, написанных на любом языке, совместимом с среда выполнения Windows. По умолчанию параметры компилятора для проекта компонента среда выполнения Windows используют параметр **/ZW** . WINMD-файл должен иметь одно имя с корневым пространством имен. Например, экземпляр класса с именем A.B.C.MyClass может быть создан, только если он определен в файле метаданных с именем A.winmd, A.B.winmd или A.B.C.winmd. Имя DLL-файла не обязательно должно соответствовать имени WINMD-файла.

Для получения дополнительной информации см. [Creating Windows Runtime Components in C++](/windows/uwp/winrt-components/creating-windows-runtime-components-in-cpp).

### <a name="to-reference-a-third-party-windows-runtime-component-binary-in-your-project"></a>Ссылка на двоичный файл компонента среда выполнения Windows стороннего производителя в проекте

1. Откройте контекстное меню для проекта, в котором будет использоваться библиотека DLL, и выберите пункт **Свойства**. На странице **Общие свойства** нажмите кнопку **Добавить новую ссылку** .

1. Компонент среда выполнения Windows состоит из DLL-файла и файла WinMD, содержащего метаданные. Обычно эти файлы расположены в одной и той же папке. В левой области диалогового окна **Добавление ссылки** нажмите кнопку **Обзор** и перейдите к расположению DLL-файла и его WINMD-файла. Дополнительные сведения см. в разделе [пакеты SDK для расширений](/visualstudio/extensibility/creating-a-software-development-kit#extension-sdks).

## <a name="standard-dlls"></a>Стандартные библиотеки DLL

Вы можете создать стандартную библиотеку DLL C++ для кода, который не потребляет или не создает открытые типы Среда выполнения Windows и потребляет их из приложения UWP. Используйте тип проекта Библиотека динамической компоновки (DLL), если нужно просто перенести существующую библиотеку DLL для компиляции в этой версии Visual Studio, но не преобразовывать код в проект компонента среда выполнения Windows. При выполнении следующих действий библиотека DLL будет развернута вместе с исполняемым файлом приложения в APPX-пакете.

### <a name="to-create-a-standard-dll-in-visual-studio"></a>Создание стандартной библиотеки DLL в Visual Studio

1. В строке меню последовательно выберите пункты **файл**, **создать**, **проект**, а затем выберите шаблон **Библиотека динамической компоновки (DLL)** .

1. Введите имя проекта и нажмите кнопку **ОК** .

1. Добавьте код. Не забудьте добавить выражение `__declspec(dllexport)` для функций, которые планируется экспортировать, например `__declspec(dllexport) Add(int I, in j);`

1. Добавить `#include winapifamily.h` , чтобы включить этот файл заголовка из Windows SDK для приложений UWP и задать макрос `WINAPI_FAMILY=WINAPI_PARTITION_APP`.

### <a name="to-reference-a-standard-dll-project-from-the-same-solution"></a>Указание ссылки на проект стандартной библиотеки DLL из того же решения

1. Откройте контекстное меню для проекта, в котором будет использоваться библиотека DLL, и выберите пункт **Свойства**. На странице **Общие свойства** нажмите кнопку **Добавить новую ссылку** .

1. В левой области выберите **Решение**и установите соответствующий флажок в правой области.

1. В файлах исходного кода добавьте оператор `#include` для файла заголовков библиотеки DLL.

### <a name="to-reference-a-standard-dll-binary"></a>Указание ссылки на двоичный файл стандартной библиотеки DLL

1. Скопируйте DLL-файл, LIB-файл и файл заголовков в нужное расположение, например в папку текущего проекта.

1. Откройте контекстное меню для проекта, в котором будет использоваться библиотека DLL, и выберите пункт **Свойства**. На странице **Свойства конфигурации**&gt; **Компоновщик**&gt; **Ввод** добавьте LIB-файл в качестве зависимости.

1. В файлах исходного кода добавьте оператор `#include` для файла заголовков библиотеки DLL.

### <a name="to-migrate-an-existing-win32-dll-for-uwp-app-compatibility"></a>Перенос существующей библиотеки DLL Win32 для совместимости приложений UWP

1. Создайте проект типа DLL (универсальные приложения Windows) и добавьте в него существующий исходный код.

1. Добавить `#include winapifamily.h` , чтобы включить этот файл заголовка из Windows SDK для приложений UWP и задать макрос `WINAPI_FAMILY=WINAPI_PARTITION_APP`.

1. В файлах исходного кода добавьте оператор `#include` для файла заголовков библиотеки DLL.
