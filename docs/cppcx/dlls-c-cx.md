---
title: Библиотеки DLL (C++/CX)
ms.date: 02/06/2018
ms.assetid: 5b8bcc57-64dd-4c54-9f24-26a25bd5dddd
ms.openlocfilehash: 1a72ecc5eb46abfbc7b9a52a168510ce0873ee04
ms.sourcegitcommit: 6052185696adca270bc9bdbec45a626dd89cdcdd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/31/2018
ms.locfileid: "50445712"
---
# <a name="dlls-ccx"></a>Библиотеки DLL (C++/CX)

Чтобы создать стандартную библиотеку DLL Win32 или библиотеку DLL, которые могут использоваться приложениями универсальной платформы Windows (UWP) компонента среды выполнения Windows можно использовать Visual Studio. Стандартную библиотеку DLL, который был создан с помощью версии Visual Studio или компилятор Visual C++, более ранняя, чем Visual Studio 2012 могут неправильно загружаться в приложении UWP и не может пройти проверку приложения в Microsoft Store.

## <a name="windows-runtime-component-dlls"></a>Библиотеки DLL среды выполнения Windows

Практически во всех случаях когда требуется создать библиотеку DLL для использовать в приложении универсальной платформы Windows, создайте его как в компонент среды выполнения Windows с помощью шаблона проекта этим именем. Для библиотек DLL, содержащих общедоступных или частных типов среды выполнения Windows, можно создать проект компонента среды выполнения Windows. Компонент среды выполнения Windows может осуществляться из приложений, написанных на любом языке, совместимом среды выполнения Windows. По умолчанию параметры компилятора для компонента среды выполнения Windows на проекта используйте **/ZW** переключения. WINMD-файл должен иметь одно имя с корневым пространством имен. Например, экземпляр класса с именем A.B.C.MyClass может быть создан, только если он определен в файле метаданных с именем A.winmd, A.B.winmd или A.B.C.winmd. Имя DLL-файла не обязательно должно соответствовать имени WINMD-файла.

Для получения дополнительной информации см. [Creating Windows Runtime Components in C++](/windows/uwp/winrt-components/creating-windows-runtime-components-in-cpp).

### <a name="to-reference-a-third-party-windows-runtime-component-binary-in-your-project"></a>Для ссылки на двоичный файл в проекте стороннего компонента среды выполнения Windows

1. Откройте контекстное меню для проекта, в котором будет использоваться библиотека DLL, и выберите пункт **Свойства**. На странице **Общие свойства** нажмите кнопку **Добавить новую ссылку** .

1. Компонент среды выполнения Windows состоит из DLL-файла и winmd-файл, содержащий метаданные. Обычно эти файлы расположены в одной и той же папке. В левой области диалогового окна **Добавление ссылки** нажмите кнопку **Обзор** и перейдите к расположению DLL-файла и его WINMD-файла. Дополнительные сведения см. в разделе [пакетов SDK расширений](/visualstudio/extensibility/creating-a-software-development-kit#ExtensionSDKs).

## <a name="standard-dlls"></a>Стандартные библиотеки DLL

Можно создать стандартную библиотеку DLL для кода C++, который не используют или создают открытые типы среды выполнения Windows и использовать его из приложения универсальной платформы Windows. Используйте тип проекта библиотеки динамической компоновки (DLL), если нужно перенести существующую библиотеку DLL для компиляции в этой версии Visual Studio, но без конвертирования кода в проект компонента среды выполнения Windows. При выполнении следующих действий библиотека DLL будет развернута вместе с исполняемым файлом приложения в APPX-пакете.

### <a name="to-create-a-standard-dll-in-visual-studio"></a>Создание стандартной библиотеки DLL в Visual Studio

1. В строке меню выберите **файл**, **New**, **проекта**, а затем выберите **библиотеки динамических ссылок (DLL)** шаблона.

1. Введите имя проекта и нажмите кнопку **ОК** .

1. Добавьте код. Не забудьте добавить выражение `__declspec(dllexport)` для функций, которые планируется экспортировать, например `__declspec(dllexport) Add(int I, in j);`

1. Добавить `#include winapifamily.h` включить этот файл заголовка из пакета Windows SDK для приложений универсальной платформы Windows и задайте макрос `WINAPI_FAMILY=WINAPI_PARTITION_APP`.

### <a name="to-reference-a-standard-dll-project-from-the-same-solution"></a>Указание ссылки на проект стандартной библиотеки DLL из того же решения

1. Откройте контекстное меню для проекта, в котором будет использоваться библиотека DLL, и выберите пункт **Свойства**. На странице **Общие свойства** нажмите кнопку **Добавить новую ссылку** .

1. В левой области выберите **Решение**и установите соответствующий флажок в правой области.

1. В файлах исходного кода добавьте оператор `#include` для файла заголовков библиотеки DLL.

### <a name="to-reference-a-standard-dll-binary"></a>Указание ссылки на двоичный файл стандартной библиотеки DLL

1. Скопируйте DLL-файл, LIB-файл и файл заголовков в нужное расположение, например в папку текущего проекта.

1. Откройте контекстное меню для проекта, в котором будет использоваться библиотека DLL, и выберите пункт **Свойства**. На странице **Свойства конфигурации**&gt; **Компоновщик**&gt; **Ввод** добавьте LIB-файл в качестве зависимости.

1. В файлах исходного кода добавьте оператор `#include` для файла заголовков библиотеки DLL.

### <a name="to-migrate-an-existing-win32-dll-for-uwp-app-compatibility"></a>Для переноса существующей библиотеки DLL Win32 для обеспечения совместимости приложений универсальной платформы Windows

1. Создайте проект типа DLL (универсальные Windows) и добавьте к нему существующий исходный код.

1. Добавить `#include winapifamily.h` включить этот файл заголовка из пакета Windows SDK для приложений универсальной платформы Windows и задайте макрос `WINAPI_FAMILY=WINAPI_PARTITION_APP`.

1. В файлах исходного кода добавьте оператор `#include` для файла заголовков библиотеки DLL.
