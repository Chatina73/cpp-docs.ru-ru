---
title: Система типов (C++/CX)
ms.date: 02/03/2017
ms.assetid: b67bee8a-b526-4872-969e-ef22724e88fe
ms.openlocfilehash: f4a6ea32681ad033b5db9451682c764f0a6d8959
ms.sourcegitcommit: 6b3d793f0ef3bbb7eefaf9f372ba570fdfe61199
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/15/2020
ms.locfileid: "86404630"
---
# <a name="type-system-ccx"></a>Система типов (C++/CX)

Используя архитектуру среда выполнения Windows, можно использовать C++/CX, Visual Basic, Visual C# и JavaScript для написания приложений и компонентов, которые напрямую обращаются к API Windows и взаимодействуют с другими приложениями и компонентами среда выполнения Windows. Универсальная платформа Windows приложения, написанные на C++, компилируются в машинный код, который выполняется непосредственно в ЦП. Универсальная платформа Windows приложения, написанные на C# или Visual Basic, компилируются в MSIL и выполняются в среде CLR. Универсальная платформа Windows приложения, написанные на языке JavaScript, выполняются в среде выполнения. Сами компоненты операционной системы среда выполнения Windows написаны на C++ и выполняются как машинный код. Все эти компоненты и универсальная платформа Windows приложения взаимодействуют напрямую через интерфейс среда выполнения Windowsного двоичного интерфейса приложения (ABI).

Чтобы обеспечить поддержку среда выполнения Windows в современной идиоме C++, корпорация Майкрософт создала C++/CX. C++/CX предоставляет встроенные базовые типы и реализации основных типов среда выполнения Windows, которые позволяют приложениям и компонентам C++ взаимодействовать через интерфейс ABI с приложениями, написанными на других языках. Можно использовать любой тип среда выполнения Windows или создавать классы, структуры, интерфейсы и другие определяемые пользователем типы, которые могут использоваться другими универсальная платформа Windows приложениями и компонентами. приложение универсальная платформа Windows, написанное на C++/CX, также может использовать обычные классы и структуры C++, если они не имеют общедоступной доступности.

Подробное рассмотрение проекции языка C++/CX и принципов его работы приведено в следующих записях блогов:

- [C++/CX часть 0 из \[ n \] : введение](https://devblogs.microsoft.com/cppblog/ccx-part-0-of-n-an-introduction/)

- [C++/CX, часть 1 из \[ n \] : простой класс](https://devblogs.microsoft.com/cppblog/ccx-part-1-of-n-a-simple-class/)

- [C++/CX, часть 2 из \[ n \] : типы, которые выизносют шляпы](https://devblogs.microsoft.com/cppblog/ccx-part-2-of-n-types-that-wear-hats/)

- [C++/CX, часть 3 из \[ n \] : в конструкции](https://devblogs.microsoft.com/cppblog/ccx-part-3-of-n-under-construction/)

- [C++/CX, часть 4 из \[ n \] : статические функции членов](https://devblogs.microsoft.com/cppblog/ccx-part-4-of-n-static-member-functions/)

## <a name="windows-metadata-winmd-files"></a>Файлы метаданных Windows (WINMD-файлы)

При компиляции универсальная платформа Windows приложения, написанного на C++, компилятор создает исполняемый файл в машинном коде, а также создает отдельный файл метаданных Windows (. winmd), содержащий описания типов общедоступных среда выполнения Windows, которые включают классы, структуры, перечисления, интерфейсы, параметризованные интерфейсы и делегаты. Формат метаданных напоминает формат, используемый в сборках .NET Framework.  В компоненте C++ WINMD-файл содержит только метаданные; исполняемый код находится в отдельном файле. Это относится к компонентам среда выполнения Windows, которые входят в состав Windows. Имя WINMD-файла должно соответствовать корневому пространству имен в исходном коде или являться его префиксом. (Для языков платформы .NET Framework WINMD-файл содержит код и метаданные точно так же, как сборка .NET Framework.)

Метаданные в WINMD-файле представляют опубликованную область кода. Опубликованные типы видимы для других универсальных платформ Windows независимо от языка, на котором написаны другие приложения. Таким образом, метаданные или опубликованный код могут содержать только типы, заданные системой типов среда выполнения Windows. Языковые конструкции, относящиеся к C++, такие как обычные классы, массивы, шаблоны или контейнеры STL, не могут публиковаться в метаданных, поскольку клиентское приложение JavaScript или C# не будет знать, что с ними делать.

Видимость типа или метода в метаданных зависит от применяемых к ним модификаторов доступа. Чтобы быть видимым, тип должен быть объявлен в пространстве имен как открытый тип. Класс ссылки, не являющийся открытым, можно использовать в коде как внутренний вспомогательный тип; он просто не отображается в метаданных. Даже в открытом классе ссылки не все члены будут обязательно видимыми. В следующей таблице перечислены связи между описателями доступа C++ в открытом классе ссылки и среда выполнения Windows видимость метаданных.

|||
|-|-|
|**Опубликован в метаданных**|**Не опубликован в метаданных**|
|public|private|
|protected|internal|
|public protected|private protected|

Для просмотра WINMD-файлов можно использовать **обозреватель объектов** . Среда выполнения Windows компоненты, входящие в состав Windows, находятся в файле Windows. winmd. Файл Default. winmd содержит фундаментальные типы, используемые в C++/CX, а Platform. winmd — дополнительные типы из пространства имен Platform. По умолчанию эти три файла WinMD включены в каждый проект C++ для универсальная платформа Windows приложений.

> [!TIP]
> Типы из [Platform::Collections Namespace](../cppcx/platform-collections-namespace.md) не отображаются в WINMD-файле, поскольку они не являются открытыми. Они являются закрытыми особыми реализациями интерфейсов C++, которые определены в `Windows::Foundation::Collections`. Приложение среда выполнения Windows, написанное на JavaScript или C#, не знает, что такое [класс Platform:: Collections:: Vector](../cppcx/platform-collections-vector-class.md) , но может использовать `Windows::Foundation::Collections::IVector` . Типы `Platform::Collections` определены в файле collection.h.

## <a name="windows-runtime-type-system-in-ccx"></a>Система типов среда выполнения Windows в C++/CX

В следующих разделах описываются основные функции системы типов среда выполнения Windows и их поддержка в C++/CX.

### <a name="namespaces"></a>Пространства имен

Все типы среда выполнения Windows должны быть объявлены в пространстве имен; сам API Windows упорядочен по пространствам имен. WINMD-файл должен иметь одно имя с корневым пространством имен. Например, экземпляр класса с именем A.B.C.MyClass может быть создан, только если он определен в файле метаданных с именем A.winmd, A.B.winmd или A.B.C.winmd. Имя DLL-файла не обязательно должно соответствовать имени WINMD-файла.

Сам интерфейс API Windows был переработан как хорошо организованная библиотека классов, упорядоченная по пространствам имен.  Все компоненты среда выполнения Windows объявляются в пространствах имен Windows. *.

Дополнительные сведения см. в разделе [пространства имен и видимость типов](../cppcx/namespaces-and-type-visibility-c-cx.md).

### <a name="fundamental-types"></a>Фундаментальные типы

Среда выполнения Windows определяет следующие фундаментальные типы: UInt8, Int16, UInt16, Int32, UInt32, Int64, UInt64, Single, Double, Char16, Boolean и String. C++/CX поддерживает фундаментальные числовые типы в пространстве имен по умолчанию как UInt16, UInt32, UInt64, Int16, Int32, Int64, float32, float64 и Char16. Типы Boolean и String также определены в пространстве имен Platform.

C++/CX также определяет Uint8, эквивалент `unsigned char` , который не поддерживается в среда выполнения Windows и не может использоваться в общедоступных API.

Фундаментальный тип можно сделать поддерживающим значение NULL, если поместить его в интерфейс [Platform::IBox](../cppcx/platform-ibox-interface.md) . Дополнительные сведения см. в разделе [Классы и структуры значения](../cppcx/value-classes-and-structs-c-cx.md).

Дополнительные сведения о фундаментальных типах см. в разделе [Базовые типы](../cppcx/fundamental-types-c-cx.md)

### <a name="strings"></a>Строки

Строка среда выполнения Windows представляет собой неизменяемую последовательность из 16-разрядных символов Юникода. Строка среда выполнения Windows проецируется как `Platform::String^` . Этот класс предоставляет методы для создания, обработки строк, а также для их преобразования в тип `wchar_t`и из этого типа.

Дополнительные сведения см. в разделе [Строки](../cppcx/strings-c-cx.md).

### <a name="arrays"></a>Массивы

Среда выполнения Windows поддерживает одномерные массивы любого типа. Массивы массивов не поддерживаются.  В C++/CX среда выполнения Windows массивы проецируются как [класс Platform:: Array](../cppcx/platform-array-class.md).

Дополнительные сведения см. в разделе [Array и WriteOnlyArray](../cppcx/array-and-writeonlyarray-c-cx.md) .

### <a name="ref-classes-and-structs"></a>Классы и структуры ссылки

Класс среда выполнения Windows проецируется в C++/CX как ссылочный класс или ссылочную структуру, так как они копируются по ссылке. Управление памятью для классов и структур ссылки прозрачно осуществляется посредством подсчета ссылок. Когда последняя ссылка на объект выходит из области, объект ликвидируется. Класс или структура ссылки:

- может содержать такие члены, как конструкторы, методы, свойства и события. Эти члены могут иметь модификаторы доступа public, private, protected или internal;

- могут содержать определения закрытых вложенных перечислений, структур или классов;

- могут напрямую наследовать от одного базового класса и реализовать любое число интерфейсов. Все классы ссылок неявно преобразуются в [Platform::Object Class](../cppcx/platform-object-class.md) и могут переопределять его виртуальные методы, например [Object::ToString](../cppcx/platform-object-class.md#tostring).

Класс ссылки, имеющий открытый конструктор, необходимо объявить как запечатанный, чтобы запретить его дальнейшее наследование.

Дополнительные сведения см. в разделе [ссылочные классы и структуры](../cppcx/ref-classes-and-structs-c-cx.md) .

### <a name="value-classes-and-structs"></a>Классы и структуры значения

Класс значения или структура значения представляет базовую структуру данных и содержит только поля, которые могут быть классами значений, структурами значений или типом `Platform::String^`.  Структуры и классы значения копируются по значению.

Структура значений может допускать значение NULL, если ее заключить в интерфейс IBox.

Дополнительные сведения см. в разделе [Классы и структуры значения](../cppcx/value-classes-and-structs-c-cx.md).

### <a name="partial-classes"></a>Разделяемые классы

Функция разделяемого класса позволяет определять один класс на несколько файлов. Она используется в основном для того, чтобы позволить средствам создания кода, таким как редактор XAML, изменить один файл, не внося корректив в редактируемый пользователем файл.

Дополнительные сведения см. в разделе [Разделяемые классы](../cppcx/partial-classes-c-cx.md)

### <a name="properties"></a>Свойства

Свойство является открытым элементом данных любого типа среда выполнения Windows и реализуется как пара методов Get/Set. Клиентский код обращается к свойству, как если бы он был открытым полем. Свойство, для которого не требуется пользовательский код get или set, называется *тривиальным свойством* ; его можно объявлять без явного указания методов get и set.

Дополнительные сведения см. в разделе [Свойства](../cppcx/properties-c-cx.md).

### <a name="windows-runtime-collections-in-ccx"></a>Среда выполнения Windows коллекции в C++/CX

Среда выполнения Windows определяет набор интерфейсов для типов коллекций, которые каждый язык реализует по своему усмотрению. C++/CX предоставляет реализации в [классе Platform:: коллекций:: Vector](../cppcx/platform-collections-vector-class.md), [платформе:: Collections:: Map](../cppcx/platform-collections-map-class.md)и других связанных типах конкретных коллекций, совместимых с аналогами библиотеки стандартных шаблонов (STL).

Дополнительные сведения см. в разделе [коллекции](../cppcx/collections-c-cx.md).

### <a name="template-ref-classes"></a>Классы ссылки шаблонов

Для закрытых и внутренних классов ссылок можно создавать шаблоны и задавать параметры.

Дополнительные сведения см. в разделе [Классы ссылки шаблонов](../cppcx/template-ref-classes-c-cx.md).

### <a name="interfaces"></a>Интерфейсы

Интерфейс среда выполнения Windows определяет набор открытых свойств, методов и событий, которые должны быть реализованы классом ссылки или структурой ссылки, если он наследуется от интерфейса.

Дополнительные сведения см. в разделе [Интерфейсы](../cppcx/interfaces-c-cx.md).

### <a name="enums"></a>Перечисления

Класс Enum в среда выполнения Windows похож на перечисление с заданной областью в C++. Базовым типом является int32, если не применяется атрибут [Flags] — в этом случае базовым типом становится uint32.

Дополнительные сведения см. в разделе [Перечисления](../cppcx/enums-c-cx.md).

### <a name="delegates"></a>Делегаты

Делегат в среда выполнения Windows является аналогом объекта std:: Function в C++. Это особый тип класса ссылки, который используется для вызова предоставляемых клиентом функций с совместимыми сигнатурами.  Делегаты чаще всего используются в среда выполнения Windows в качестве типа события.

Дополнительные сведения см. в разделе [Делегаты](../cppcx/delegates-c-cx.md).

### <a name="exceptions"></a>Исключения

В C ++/CX можно перехватить пользовательские типы исключений, типы [std::exception](../standard-library/exception-class.md) и [Platform::Exception](../cppcx/platform-exception-class.md) .

Дополнительные сведения см. в разделе [Исключения](../cppcx/exceptions-c-cx.md).

### <a name="events"></a>События

Событие — открытый член класса или структуры ссылки, тип которого является типом делегата. Событие может вызываться — или инициироваться — только классом-владельцем. Однако клиентский код может предоставить свои собственные функции, которые называются обработчиками событий и вызываются при инициировании события классом-владельцем.

Дополнительные сведения см. в статье [Events (Visual Basic)](../cppcx/events-c-cx.md) (События в Visual Basic).

### <a name="casting"></a>Приведение

C ++/CX поддерживает стандартные операторы приведения типа [static_cast](../cpp/static-cast-operator.md), [dynamic_cast](../cpp/dynamic-cast-operator.md)и [reinterpret_cast](../cpp/reinterpret-cast-operator.md), а также оператор **safe_cast** , относящийся к C ++/CX.

Дополнительные сведения см. в разделе [Приведение](../cppcx/casting-c-cx.md).

### <a name="boxing"></a>Упаковка-преобразование

Упакованная переменная — это тип значения, упакованный в ссылочный тип в ситуациях, где требуется ссылочная семантика.

Дополнительные сведения см. в разделе [Упаковка](../cppcx/boxing-c-cx.md).

### <a name="attributes"></a>Атрибуты

Атрибут — это значение метаданных, которое может быть применено к любому среда выполнения Windows типу или члену типа и может быть проверено во время выполнения. Среда выполнения Windows определяет набор общих атрибутов в `Windows::Foundation::Metadata` пространстве имен. Определенные пользователем атрибуты в открытых интерфейсах не поддерживаются среда выполнения Windows в этом выпуске.

## <a name="api-deprecation"></a>Включение API в список нерекомендуемых

Описывает, как пометить открытые API как устаревшие с помощью того же атрибута, который используется типами системы среда выполнения Windows.

Дополнительные сведения см. в разделе [устаревшие типы и члены](../cppcx/deprecating-types-and-members-c-cx.md).

## <a name="see-also"></a>См. также раздел

[Справочник по языку C++/CX](../cppcx/visual-c-language-reference-c-cx.md)
