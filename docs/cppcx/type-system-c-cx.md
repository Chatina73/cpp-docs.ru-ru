---
title: Система типов (C++/CX)
ms.date: 02/03/2017
ms.assetid: b67bee8a-b526-4872-969e-ef22724e88fe
ms.openlocfilehash: fbc7a178621624e396c80509703ce1b5b4c19162
ms.sourcegitcommit: dedd4c3cb28adec3793329018b9163ffddf890a4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/11/2019
ms.locfileid: "57745958"
---
# <a name="type-system-ccx"></a>Система типов (C++/CX)

С помощью архитектуры среды выполнения Windows, можно использовать C + +/ CX, Visual Basic, Visual C# и JavaScript для написания приложений и компонентов, которые непосредственно доступ к Windows API и взаимодействовать с другими приложениями среды выполнения Windows и компонентов. Приложений универсальной платформы Windows, которые создаются на языке C++ компиляции в машинный код, который выполняется непосредственно в ЦП. Приложений универсальной платформы Windows, которые создаются на языке C# или Visual Basic, компилируются в промежуточный язык Майкрософт (MSIL) и выполняются в общеязыковой среде выполнения (CLR). Приложений универсальной платформы Windows, которые создаются на языке JavaScript выполняются в среде выполнения. Сами компоненты операционной системы среды выполнения Windows, написанных на C++ и работают как машинный код. Все эти компоненты и приложениях универсальной платформы Windows взаимодействовать напрямую через двоичный интерфейс приложений (ABI) среды выполнения Windows.

Чтобы включить поддержку для среды выполнения Windows в современной версии C++, корпорация Майкрософт создала C + +/ CX. C + +/ CX предоставляет встроенные базовые типы и реализации основных типов среды выполнения Windows, которые позволяют приложениям и компонентам взаимодействовать через интерфейс ABI с приложениями, написанными на других языках C++. Можно использовать любой тип среды выполнения Windows, или создать классы, структуры, интерфейсы и другие определяемые пользователем типы, которые могут использоваться в других приложениях универсальной платформы Windows и компонентов. приложения универсальной платформы Windows, написанного на C + +/ CX можно также использовать регулярные классы и структуры C++ до тех пор, пока они не иметь доступность уровня public.

Подробное рассмотрение проекции языка C++/CX и принципов его работы приведено в следующих записях блогов:

1. [C + +/ CX: часть 0 из \[n\]: Общие сведения о](https://blogs.msdn.microsoft.com/vcblog/2012/08/29/ccx-part-0-of-n-an-introduction)

1. [C + +/ CX: часть 1 из \[n\]: Простой класс](https://blogs.msdn.microsoft.com/vcblog/2012/09/05/ccx-part-1-of-n-a-simple-class)

1. [C + +/ CX: часть 2 из \[n\]: Типы крышками](https://blogs.msdn.microsoft.com/vcblog/2012/09/17/ccx-part-2-of-n-types-that-wear-hats)

1. [C + +/ CX: часть 3 из \[n\]: В процессе построения](https://blogs.msdn.microsoft.com/vcblog/2012/10/05/ccx-part-3-of-n-under-construction/)

1. [C + +/ CX: часть 4 из \[n\]: Статические функции-члены](https://blogs.msdn.microsoft.com/vcblog/2012/10/19/ccx-part-4-of-n-static-member-functions)

## <a name="windows-metadata-winmd-files"></a>Файлы метаданных Windows (WINMD-файлы)

При компиляции приложения универсальной платформы Windows, написанного на C++, компилятор создает исполняемый файл в машинном коде, а также создает отдельный файл метаданных (с расширением winmd) Windows, содержащий описания открытых типов среды выполнения Windows, которые включают классы, структуры, перечисления, интерфейсы, параметризованные интерфейсы и делегаты. Формат метаданных напоминает формат, используемый в сборках .NET Framework.  В компоненте C++ WINMD-файл содержит только метаданные; исполняемый код находится в отдельном файле. Это происходит для компонентов среды выполнения Windows, которые входят в состав Windows. Имя WINMD-файла должно соответствовать корневому пространству имен в исходном коде или являться его префиксом. (Для языков платформы .NET Framework WINMD-файл содержит код и метаданные точно так же, как сборка .NET Framework.)

Метаданные в WINMD-файле представляют опубликованную область кода. Опубликованные типы являются видимыми для других универсальной платформы Windows вне зависимости от языка этих других приложений создаются на языке. Таким образом метаданные, или опубликованный код, может содержать только типы, определенные системой типов среды выполнения Windows. Языковые конструкции, относящиеся к C++, такие как обычные классы, массивы, шаблоны или контейнеры STL, не могут публиковаться в метаданных, поскольку клиентское приложение JavaScript или C# не будет знать, что с ними делать.

Видимость типа или метода в метаданных зависит от применяемых к ним модификаторов доступа. Чтобы быть видимым, тип должен быть объявлен в пространстве имен как открытый тип. Класс ссылки, не являющийся открытым, можно использовать в коде как внутренний вспомогательный тип; он просто не отображается в метаданных. Даже в открытом классе ссылки не все члены будут обязательно видимыми. В следующей таблице перечислены отношения между спецификаторами доступа C++ в открытом классе ссылки и видимостью метаданных среды выполнения Windows:

|||
|-|-|
|**Опубликован в метаданных**|**Не опубликован в метаданных**|
|public|private|
|protected|internal|
|public protected|private protected|

Для просмотра WINMD-файлов можно использовать **обозреватель объектов** . Компоненты среды выполнения Windows, которые входят в состав Windows находятся в файле Windows.winmd. Файл default.winmd содержит базовые типы, которые используются в C + +/ CX и platform.winmd содержит дополнительные типы из пространства имен Platform. По умолчанию эти три winmd-файлов, включаются в каждый проекте C++ для приложений универсальной платформы Windows.

> [!TIP]
> Типы из [Platform::Collections Namespace](../cppcx/platform-collections-namespace.md) не отображаются в WINMD-файле, поскольку они не являются открытыми. Они являются закрытыми особыми реализациями интерфейсов C++, которые определены в `Windows::Foundation::Collections`. Приложения среды выполнения Windows, которая написана на JavaScript или C# не знает, что [класс Platform::Collections:: vector](../cppcx/platform-collections-vector-class.md) , но этот класс можно использовать `Windows::Foundation::Collections::IVector`. Типы `Platform::Collections` определены в файле collection.h.

## <a name="windows-runtime-type-system-in-ccx"></a>Система типов среды выполнения Windows в C + +/ CX

В следующих разделах описаны основные функции системы типов среды выполнения Windows и как они поддерживаются в C + +/ CX.

### <a name="namespaces"></a>Пространства имен

Все типы среды выполнения Windows должен быть объявлен в пространстве имен. сам интерфейс API Windows упорядочен по пространствам имен. WINMD-файл должен иметь одно имя с корневым пространством имен. Например, экземпляр класса с именем A.B.C.MyClass может быть создан, только если он определен в файле метаданных с именем A.winmd, A.B.winmd или A.B.C.winmd. Имя DLL-файла не обязательно должно соответствовать имени WINMD-файла.

Сам интерфейс API Windows был переработан как хорошо организованная библиотека классов, упорядоченная по пространствам имен.  Все компоненты среды выполнения Windows, объявляются в пространствах имен Windows.*.

Дополнительные сведения см. в разделе [пространства имен и видимость типов](../cppcx/namespaces-and-type-visibility-c-cx.md).

### <a name="fundamental-types"></a>Фундаментальные типы

Среда выполнения Windows определяет следующие базовые типы, UInt8, Int16, UInt16, Int32, UInt32, Int64, UInt64, Single, Double, Char16, Boolean и строки. C + +/ CX поддерживает базовые числовые типы в пространстве имен по умолчанию в качестве uint16, uint32, uint64, int16, int32, int64, float32, float64 и char16. Типы Boolean и String также определены в пространстве имен Platform.

C + +/ CX также определяет тип uint8, эквивалентный `unsigned char`, который не поддерживается в среде выполнения Windows и не может использоваться в открытых API.

Фундаментальный тип можно сделать поддерживающим значение NULL, если поместить его в интерфейс [Platform::IBox](../cppcx/platform-ibox-interface.md) . Дополнительные сведения см. в разделе [Классы и структуры значения](../cppcx/value-classes-and-structs-c-cx.md).

Дополнительные сведения о фундаментальных типах см. в разделе [Базовые типы](../cppcx/fundamental-types-c-cx.md)

### <a name="strings"></a>Строки

Строка среды выполнения Windows — это Неизменяемая последовательность 16-разрядных символов ЮНИКОДА. Строка среды выполнения Windows проецируется как `Platform::String^`. Этот класс предоставляет методы для создания, обработки строк, а также для их преобразования в тип `wchar_t`и из этого типа.

Дополнительные сведения см. в разделе [Строки](../cppcx/strings-c-cx.md).

### <a name="arrays"></a>Массивы

Среда выполнения Windows поддерживает одномерные массивы любого типа. Массивы массивов не поддерживаются.  В C + +/ CX, массивов в среде выполнения Windows проецируются в качестве [класс Platform::Array](../cppcx/platform-array-class.md).

Дополнительные сведения см. в разделе [Array и WriteOnlyArray](../cppcx/array-and-writeonlyarray-c-cx.md)

### <a name="ref-classes-and-structs"></a>Классы и структуры ссылки

Класс среды выполнения Windows проецируется в C + +/ CX как ссылочный класс или структура ссылки, так как они копируются по ссылке. Управление памятью для классов и структур ссылки прозрачно осуществляется посредством подсчета ссылок. Когда последняя ссылка на объект выходит из области, объект ликвидируется. Класс или структура ссылки:

- может содержать такие члены, как конструкторы, методы, свойства и события. Эти члены могут иметь модификаторы доступа public, private, protected или internal;

- могут содержать определения закрытых вложенных перечислений, структур или классов;

- могут напрямую наследовать от одного базового класса и реализовать любое число интерфейсов. Все классы ссылок неявно преобразуются в [Platform::Object Class](../cppcx/platform-object-class.md) и могут переопределять его виртуальные методы, например [Object::ToString](../cppcx/platform-object-class.md#tostring).

Класс ссылки, имеющий открытый конструктор, необходимо объявить как запечатанный, чтобы запретить его дальнейшее наследование.

Дополнительные сведения см. в разделе [Классы и структуры ссылки](../cppcx/ref-classes-and-structs-c-cx.md)

### <a name="value-classes-and-structs"></a>Классы и структуры значения

Класс значения или структура значения представляет базовую структуру данных и содержит только поля, которые могут быть классами значений, структурами значений или типом `Platform::String^`.  Структуры и классы значения копируются по значению.

Структура значений может допускать значение NULL, если ее заключить в интерфейс IBox.

Дополнительные сведения см. в разделе [Классы и структуры значения](../cppcx/value-classes-and-structs-c-cx.md).

### <a name="partial-classes"></a>Разделяемые классы

Функция разделяемого класса позволяет определять один класс на несколько файлов. Она используется в основном для того, чтобы позволить средствам создания кода, таким как редактор XAML, изменить один файл, не внося корректив в редактируемый пользователем файл.

Дополнительные сведения см. в разделе [Разделяемые классы](../cppcx/partial-classes-c-cx.md)

### <a name="properties"></a>Свойства

Свойство является членом открытых данных любого типа среды выполнения Windows и реализуется в виде пары методов get и set. Клиентский код обращается к свойству, как если бы он был открытым полем. Свойство, для которого не требуется пользовательский код get или set, называется *тривиальным свойством* ; его можно объявлять без явного указания методов get и set.

Дополнительные сведения см. в разделе [Свойства](../cppcx/properties-c-cx.md).

### <a name="windows-runtime-collections-in-ccx"></a>Коллекции среды выполнения Windows в C + +/ CX

Среда выполнения Windows определяет набор интерфейсов для типов коллекций, которые каждый язык реализует собственным способом. C + +/ CX предоставляет реализации в [класс Platform::Collections:: vector](../cppcx/platform-collections-vector-class.md), [класс Platform::Collections:: map](../cppcx/platform-collections-map-class.md)и других связанных конкретных типах коллекций, которые совместимы с их Аналоги стандартной библиотеки шаблонов (STL).

Дополнительные сведения см. в разделе [коллекций](../cppcx/collections-c-cx.md).

### <a name="template-ref-classes"></a>Классы ссылки шаблонов

Для закрытых и внутренних классов ссылок можно создавать шаблоны и задавать параметры.

Дополнительные сведения см. в разделе [Классы ссылки шаблонов](../cppcx/template-ref-classes-c-cx.md).

### <a name="interfaces"></a>интерфейсов,

Интерфейс среды выполнения Windows определяет набор открытые свойства, методы и события, класс или структура ссылки должны реализовывать, если он наследует от интерфейса.

Дополнительные сведения см. в разделе [Интерфейсы](../cppcx/interfaces-c-cx.md).

### <a name="enums"></a>перечислениям;

Класс enum в среде выполнения Windows напоминает перечисление с ограниченной областью в C++. Базовым типом является int32, если не применяется атрибут [Flags] — в этом случае базовым типом становится uint32.

Дополнительные сведения см. в разделе [Перечисления](../cppcx/enums-c-cx.md).

### <a name="delegates"></a>Делегаты

Делегат в среде выполнения Windows аналогично объекту std::function в C++. Это особый тип класса ссылки, который используется для вызова предоставляемых клиентом функций с совместимыми сигнатурами.  Делегаты наиболее часто используются в среде выполнения Windows в качестве типа события.

Дополнительные сведения см. в разделе [Делегаты](../cppcx/delegates-c-cx.md).

### <a name="exceptions"></a>Исключения

В C ++/CX можно перехватить пользовательские типы исключений, типы [std::exception](../standard-library/exception-class.md) и [Platform::Exception](../cppcx/platform-exception-class.md) .

Дополнительные сведения см. в разделе [Исключения](../cppcx/exceptions-c-cx.md).

### <a name="events"></a>События

Событие — открытый член класса или структуры ссылки, тип которого является типом делегата. Событие может вызываться — или инициироваться — только классом-владельцем. Однако клиентский код может предоставить свои собственные функции, которые называются обработчиками событий и вызываются при инициировании события классом-владельцем.

Дополнительные сведения см. в разделе [События](../cppcx/events-c-cx.md).

### <a name="casting"></a>Приведение

C ++/CX поддерживает стандартные операторы приведения типа [static_cast](../cpp/static-cast-operator.md), [dynamic_cast](../cpp/dynamic-cast-operator.md)и [reinterpret_cast](../cpp/reinterpret-cast-operator.md), а также оператор **safe_cast** , относящийся к C ++/CX.

Дополнительные сведения см. в разделе [Приведение](../cppcx/casting-c-cx.md).

### <a name="boxing"></a>Упаковка

Упакованная переменная — это тип значения, упакованный в ссылочный тип в ситуациях, где требуется ссылочная семантика.

Дополнительные сведения см. в разделе [Упаковка](../cppcx/boxing-c-cx.md).

### <a name="attributes"></a>Атрибуты

Атрибут является значением метаданных, которое может применяться в любой тип среды выполнения Windows или член типа и может проверяться во время выполнения. Среда выполнения Windows определяет набор общих атрибутов в `Windows::Foundation::Metadata` пространства имен. Пользовательские атрибуты открытых интерфейсов не поддерживаются средой выполнения Windows в этом выпуске.

## <a name="api-deprecation"></a>Включение API в список нерекомендуемых

Описывает, как пометить открытые API, как устаревшие, используя тот же атрибут, используемый для системных типов среды выполнения Windows.

Дополнительные сведения см. в разделе [перевод типов и членов в разряд нерекомендуемых](../cppcx/deprecating-types-and-members-c-cx.md).

## <a name="see-also"></a>См. также

[Справочник по языку Visual C++](../cppcx/visual-c-language-reference-c-cx.md)
