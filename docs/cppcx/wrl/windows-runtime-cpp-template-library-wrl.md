---
title: Библиотека шаблонов C++ среды выполнения Windows (WRL)
ms.date: 11/04/2016
ms.topic: overview
ms.assetid: b915afce-553b-44a7-b8dc-0ab601758eb0
ms.openlocfilehash: 7b99f6429f620b56aec5adbc4b8f15d89cc54264
ms.sourcegitcommit: 7750e4c291d56221c8893120c56a1fe6c9af60d6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/25/2019
ms.locfileid: "71274671"
---
# <a name="windows-runtime-c-template-library-wrl"></a>Библиотека шаблонов C++ среды выполнения Windows (WRL)

Библиотека шаблонов C++ среды выполнения Windows (WRL) — это библиотека шаблонов, которая предлагает низкоуровневый способ создания и использования компонентов среды выполнения Windows.

> [!NOTE]
> WRL теперь заменяется C++/WinRT, стандартной проекцией языка c++ 17 для Среда выполнения Windows API. C++/WinRT доступен в пакете SDK для Windows 10 из версии 1803. C++/WinRT реализован полностью в файлах заголовков и предназначен для предоставления доступа к современным API Windows с помощью первого класса.
>
> С C++помощью/WinRT можно использовать и создавать интерфейсы Среда выполнения Windows API, используя любой стандартно совместимый с c++ 17 компилятор. C++/WinRT обычно работает лучше и создает меньше двоичных файлов, чем любой другой языковой параметр для среда выполнения Windows. Мы продолжим предоставлять поддержку C++/CX и WRL, но в новых приложениях настоятельно рекомендуется использовать C++/WinRT. См. дополнительные сведения о [C++/WinRT](https://docs.microsoft.com/windows/uwp/cpp-and-winrt-apis/index).

## <a name="benefits"></a>Преимущества

Библиотека шаблонов C++ среда выполнения Windows позволяет упростить реализацию и использование компонентов модели COM. Он предоставляет методы обслуживания, такие как подсчет ссылок, для управления временем существования объектов и проверки значений HRESULT, чтобы определить, завершилась ли операция успешно или неудачно. Для успешного использования библиотеки шаблонов C++ среда выполнения Windows необходимо соблюдать следующие правила и методы.

C++/CX — это высокоуровневый, основанный на языках языковой способ использования среда выполнения Windows компонентов. Как библиотека шаблонов C++ среда выполнения Windows, так C++и код/CX упрощают написание кода для Среда выполнения Windows, автоматически выполняя задачи обслуживания от вашего имени.

Библиотека шаблонов C++ среда выполнения Windows и C++/CX предоставляют различные преимущества. Ниже приведены некоторые причины, по которым вместо C++ C++/CX может потребоваться использовать библиотеку шаблонов среда выполнения Windows.

- Среда выполнения Windows C++ библиотека шаблонов добавляет небольшую абстракцию по отношению к среда выполнения Windows двоичному интерфейсу приложения (ABI), предоставляя возможность управлять базовым кодом для более эффективного создания или использования API-интерфейсов Среда выполнения Windows.

- C++/CX представляет значения COM HRESULT как исключения. Если вы настроили базу кода, использующую COM, или одну, которая не использует исключения, может оказаться, что C++ среда выполнения Windows библиотека шаблонов является более естественным способом работы с среда выполнения Windows, поскольку не нужно использовать исключения.

   > [!NOTE]
   > Библиотека шаблонов C++ среда выполнения Windows использует значения HRESULT и не создает исключения. Кроме того, Библиотека шаблонов C++ среда выполнения Windows использует интеллектуальные указатели и шаблон RAII, чтобы гарантировать правильное уничтожение объектов, когда код приложения создает исключение. Дополнительные сведения о смарт-указателях и RAII см. в разделе [интеллектуальные указатели](../../cpp/smart-pointers-modern-cpp.md) и [объекты, собственные ресурсы (RAII)](../../cpp/objects-own-resources-raii.md).

- Назначение и проектирование библиотеки шаблонов среда выполнения Windowsа C++ относится к библиотеке ATL, которая представляет собой набор классов на основе C++ шаблонов, упрощающих программирование COM-объектов. Так как C++ библиотека шаблонов среда выполнения Windows использует C++ стандарт для создания оболочки среда выполнения Windows, можно легко переносить и взаимодействовать с множеством существующих COM-компонентов, написанных на ATL, в среда выполнения Windows. Если вы уже знакомы с библиотекой ATL, может оказаться C++ , что среда выполнения Windows программированию библиотеки шаблонов проще.

## <a name="getting-started"></a>Начало работы

Ниже приведены некоторые ресурсы, которые могут помочь сразу приступить к работе C++ с библиотекой шаблонов среда выполнения Windows.

[Библиотека среда выполнения Windows (WRL)](https://channel9.msdn.com/Events/Windows-Camp/Developing-Windows-8-Metro-style-apps-in-Cpp/The-Windows-Runtime-Library-WRL-)<br/>
В этом видео Channel 9 вы узнаете о том, как C++ библиотека шаблонов среда выполнения Windows помогает создавать приложения универсальная платформа Windows (UWP), а также создавать и использовать компоненты Среда выполнения Windows.

[Практическое руководство. Активация и использование компонента среда выполнения Windows](how-to-activate-and-use-a-windows-runtime-component-using-wrl.md)<br/>
Показывает, как использовать библиотеку шаблонов C++ среда выполнения Windows для инициализации среда выполнения Windows и активации и использования компонента Среда выполнения Windows.

[Практическое руководство. Завершение асинхронных операций](how-to-complete-asynchronous-operations-using-wrl.md)<br/>
Показывает, как использовать библиотеку шаблонов C++ среда выполнения Windows для запуска асинхронных операций и выполнения работы по завершении операций.

[Практическое руководство. Обработчики событий](how-to-handle-events-using-wrl.md)<br/>
Показывает, как использовать библиотеку шаблонов C++ среда выполнения Windows для подписки на события объекта среда выполнения Windows и управления им.

[Пошаговое руководство: Создание приложения UWP с использованием WRL и Media Foundation](walkthrough-creating-a-windows-store-app-using-wrl-and-media-foundation.md)<br/>
Узнайте, как создать приложение UWP, которое использует [Microsoft Media Foundation](/windows/win32/medfound/microsoft-media-foundation-sdk).

[Практическое руководство. Создание классического COM-компонента](how-to-create-a-classic-com-component-using-wrl.md)<br/>
Демонстрирует использование библиотеки шаблонов среда выполнения Windows C++ для создания базового COM-компонента и базового способа регистрации и использования COM-компонента из классического приложения.

[Практическое руководство. Непосредственное создание экземпляра компонентов WRL](how-to-instantiate-wrl-components-directly.md)<br/>
Сведения об использовании функций [Microsoft::WRL::Make](make-function.md) и [Microsoft::WRL::Details::MakeAndInitialize](makeandinitialize-function.md) для создания экземпляра компонента из определяющего его модуля.

[Практическое руководство. Использование winmdidl.exe и midlrt.exe для создания H-файлов из метаданных Windows](use-winmdidl-and-midlrt-to-create-h-files-from-windows-metadata.md)<br/>
Демонстрация использования пользовательских компонент среды выполнения Windows из WRL путем создания IDL-файла из метаданных WINMD.

[Пошаговое руководство: Подключение с использованием задач и HTTP-запросов XML](../../parallel/concrt/walkthrough-connecting-using-tasks-and-xml-http-requests.md)<br/>
Показывает, как использовать интерфейсы [IXMLHTTPRequest2](/windows/win32/api/msxml6/nn-msxml6-ixmlhttprequest2) и [IXMLHTTPRequest2Callback](/windows/win32/api/msxml6/nn-msxml6-ixmlhttprequest2callback) вместе с задачами для отправки запросов HTTP GET и POST к веб-службе в приложении UWP.

[Пример оптимизатора пути к службе Bing Maps](https://code.msdn.microsoft.com/Bing-Maps-trip-optimizer-c4e037f7)<br/>
Использует класс, определенный в [пошаговом руководстве. `HttpRequest` Подключение с помощью задач и HTTP-](../../parallel/concrt/walkthrough-connecting-using-tasks-and-xml-http-requests.md) запросов XML в контексте полного приложения UWP.

[Создание среда выполнения Windows компонента DLL с C++ примером](https://code.msdn.microsoft.com/windowsapps/Creating-a-Windows-Runtime-6c399797)<br/>
Показывает, как использовать библиотеку шаблонов C++ среда выполнения Windows, чтобы создать ВНУТРИПРОЦЕССНЫЙ компонент DLL и использовать его из C++кода/CX, JavaScript и. C#

[Пример игры лабиринта в DirectX мрамор](https://code.msdn.microsoft.com/windowsapps/DirectX-Marble-Maze-Game-e4806345)<br/>
Демонстрирует использование библиотеки шаблонов среда выполнения Windows C++ для управления временем существования компонентов COM, таких как DirectX и Media Foundation в контексте полной трехмерной игры.

[Отправка всплывающих уведомлений из примера классических приложений](https://code.msdn.microsoft.com/windowsdesktop/Sending-toast-notifications-71e230a2)<br/>
Демонстрирует использование библиотеки шаблонов среда выполнения Windows C++ для работы с всплывающими уведомлениями из классического приложения.

## <a name="windows-runtime-c-template-library-compared-to-atl"></a>Библиотека C++ шаблонов среда выполнения Windows по сравнению с ATL

Среда выполнения Windows C++ библиотека шаблонов похожа на библиотеку ATL, поскольку ее можно использовать для создания небольших и быстрых COM-объектов. Библиотека C++ шаблонов среда выполнения Windows и ATL также совместно используют такие понятия, как определение объектов в модулях, явная регистрация интерфейсов и открытие создания объектов с помощью фабрик. Если вы знакомы с библиотекой C++ ATL, вам может быть удобна среда выполнения Windows библиотека шаблонов.

Библиотека C++ шаблонов среда выполнения Windows поддерживает функции COM, необходимые для приложений UWP. Поэтому она отличается от библиотеки ATL, поскольку в последней нет непосредственной поддержки таких функций модели COM, как:

- статистическая обработка

- стандартные реализации

- сдвоенные интерфейсы (`IDispatch`)

- стандартные интерфейсы перечислителя

- точки подключения

- перемещаемые интерфейсы

- внедрение OLE

- Элементы управления ActiveX

- COM+

## <a name="concepts"></a>Основные понятия

Библиотека C++ шаблонов среда выполнения Windows предоставляет типы, представляющие несколько основных понятий. Эти типы описаны в следующих разделах.

### <a name="comptr"></a>ComPtr

тип[ComPtr](comptr-class.md) — тип *интеллектуального указателя* , который представляет интерфейс, определяемый параметром шаблона. Тип `ComPtr` используется для объявления переменной, которая может получить доступ к членам объекта, производного от интерфейса. `ComPtr` автоматически поддерживает счетчик ссылок для указателя базового интерфейса и освобождает интерфейс, когда счетчик ссылок становится равен нулю.

### <a name="runtimeclass"></a>RuntimeClass

[RuntimeClass](runtimeclass-class.md) представляет собой экземпляр класса, который наследуется от набора указанных интерфейсов. `RuntimeClass` Объект может предоставить сочетание поддержки для одного или нескольких среда выполнения Windows COM-интерфейсов или слабой ссылки на компонент.

### <a name="module"></a>Module

[Module](module-class.md) представляет коллекцию связанных объектов. Объект `Module` управляет фабриками класса, создающими объекты, и регистрацией, которая позволяет другим приложениям использовать объект.

### <a name="callback"></a>Callback

Функция [Callback](callback-function-wrl.md) создает объект, функция-член которого является обработчиком событий (метод обратного вызова). Функция `Callback` используется для записи асинхронных операций.

### <a name="eventsource"></a>EventSource

[EventSource](eventsource-class.md) используется для управления обработчиками событий *делегатов* . Используйте библиотеку C++ шаблонов среда выполнения Windows для реализации делегата и использования `EventSource` для добавления, удаления и вызова делегатов.

### <a name="asyncbase"></a>AsyncBase

[Метод asyncbase](asyncbase-class.md) предоставляет виртуальные методы, представляющие модель асинхронного программирования среда выполнения Windows. Переопределите члены этого класса для создания пользовательского класса, который может запускать и останавливать асинхронную операцию, а также проверять ход ее выполнения.

### <a name="ftmbase"></a>FtmBase

[FtmBase](ftmbase-class.md) представляет объект маршаллера в режиме свободного потока. `FtmBase` создает общую таблицу интерфейса (GIT) и помогает управлять маршалингом и прокси-объектами.

### <a name="weakref"></a>WeakRef

[WeakRef](weakref-class.md) — тип интеллектуального указателя, представляющий *слабую ссылку*на объект, который может быть доступен или недоступен. `WeakRef` Объект может использоваться только среда выполнения Windows, а не классической моделью COM.

Объект `WeakRef` обычно представляет объект, наличием которого управляет внешний поток или приложение. Например, объект `WeakRef` может ссылаться на объект файла. При открывании файла `WeakRef` является допустимым и файл, на который он ссылается, доступен. Однако после закрытия файла `WeakRef` перестает быть допустимым и файл становится недоступным.

## <a name="related-topics"></a>См. также

|||
|-|-|
|[Ключевые API по категориям](key-wrl-apis-by-category.md)|Выделение основных типов, C++ функций и макросов библиотеки шаблонов среда выполнения Windows.|
|[Ссылки](wrl-reference.md)|Содержит справочные сведения по библиотеке C++ шаблонов среда выполнения Windows.|
|[Краткий C++Справочник/CX)](../../cppcx/quick-reference-c-cx.md)|Краткое описание функций C++/CX, поддерживающих среда выполнения Windows.|
|[Использование компонентов среда выполнения Windows в VisualC++](/windows/uwp/winrt-components/walkthrough-creating-a-basic-windows-runtime-component-in-cpp-and-calling-it-from-javascript-or-csharp)|Показывает, как использовать C++/CX для создания базового среда выполнения Windows компонента.|
