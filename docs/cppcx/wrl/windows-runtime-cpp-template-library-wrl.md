---
title: Библиотека шаблонов C++ среды выполнения Windows (WRL)
ms.date: 11/04/2016
ms.topic: overview
ms.assetid: b915afce-553b-44a7-b8dc-0ab601758eb0
ms.openlocfilehash: 12bda00d6687340fbddfb8f81bbb83b6c2bd98a6
ms.sourcegitcommit: a1676bf6caae05ecd698f26ed80c08828722b237
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/29/2020
ms.locfileid: "91509798"
---
# <a name="windows-runtime-c-template-library-wrl"></a>Библиотека шаблонов C++ среды выполнения Windows (WRL)

Библиотека шаблонов C++ среды выполнения Windows (WRL) — это библиотека шаблонов, которая предлагает низкоуровневый способ создания и использования компонентов среды выполнения Windows.

> [!NOTE]
> WRL теперь заменен на C++/WinRT, стандартной проекции языка C++ 17 для среда выполнения Windows API. C++/WinRT доступна в пакете SDK для Windows 10, начиная с версии 1803. C++/WinRT реализован полностью в файлах заголовков и предназначен для предоставления доступа к современным API Windows с помощью первого класса.
>
> С помощью C++/WinRT можно использовать и создавать интерфейсы среда выполнения Windows API, используя любой стандартно совместимый с C++ 17 компилятор. C++/WinRT, как правило, работает лучше и создает меньше двоичных файлов, чем любой другой языковой параметр для среда выполнения Windows. Мы продолжим предоставлять поддержку C++/CX и WRL, но в новых приложениях настоятельно рекомендуется использовать C++/WinRT. См. дополнительные сведения о [C++/WinRT](/windows/uwp/cpp-and-winrt-apis/index).

## <a name="benefits"></a>Преимущества

Библиотека шаблонов среда выполнения Windows C++ позволяет упростить реализацию и использование компонентов модели COM. Он предоставляет методы обслуживания, такие как подсчет ссылок, для управления временем существования объектов и проверки значений HRESULT, чтобы определить, завершилась ли операция успешно или неудачно. Для успешного использования библиотеки шаблонов среда выполнения Windows C++ необходимо соблюдать следующие правила и методы.

C++/CX — это высокоуровневый языковой способ использования среда выполнения Windows компонентов. Как библиотека шаблонов среда выполнения Windows C++, так и C++/CX упрощают написание кода для среда выполнения Windows, автоматически выполняя задачи обслуживания от вашего имени.

Библиотека шаблонов среда выполнения Windows C++ и C++/CX предоставляют различные преимущества. Ниже приведены некоторые причины, по которым вместо C++/CX может потребоваться использовать библиотеку шаблонов среда выполнения Windows C++.

- Среда выполнения Windows библиотека шаблонов C++ добавляет небольшую абстракцию по отношению к среда выполнения Windows двоичному интерфейсу приложения (ABI), предоставляя возможность управлять базовым кодом для более эффективного создания или использования API-интерфейсов среда выполнения Windows.

- C++/CX представляет значения COM HRESULT как исключения. Если вы настроили базу кода, использующую COM, или одну, которая не использует исключения, возможно, вы обнаружите, что среда выполнения Windows библиотека шаблонов C++ является более естественным способом работы с среда выполнения Windows, так как не нужно использовать исключения.

   > [!NOTE]
   > Библиотека шаблонов среда выполнения Windows C++ использует значения HRESULT и не создает исключения. Кроме того, Библиотека шаблонов C++ среда выполнения Windows использует интеллектуальные указатели и шаблон RAII, чтобы гарантировать, что объекты будут уничтожены правильно, когда код приложения создает исключение. Дополнительные сведения о смарт-указателях и RAII см. в разделе [интеллектуальные указатели](../../cpp/smart-pointers-modern-cpp.md) и [объекты, собственные ресурсы (RAII)](../../cpp/object-lifetime-and-resource-management-modern-cpp.md).

- Назначение и проектирование библиотеки шаблонов среда выполнения Windows C++ — это библиотека ATL, которая представляет собой набор классов C++ на основе шаблонов, упрощающих программирование COM-объектов. Поскольку среда выполнения Windows библиотека шаблонов C++ использует стандартный C++ для создания оболочки среда выполнения Windows, можно легко переносить и взаимодействовать с множеством существующих COM-компонентов, написанных в ATL, на среда выполнения Windows. Если вы уже знакомы с библиотекой ATL, может оказаться, что среда выполнения Windows программирование библиотеки шаблонов C++ будет проще.

## <a name="getting-started"></a>Приступая к работе

Ниже приведены некоторые ресурсы, которые могут помочь вам сразу же приступить к работе с библиотекой шаблонов среда выполнения Windows C++.

[Библиотека времени выполнения Windows (WRL)](https://channel9.msdn.com/Events/Windows-Camp/Developing-Windows-8-Metro-style-apps-in-Cpp/The-Windows-Runtime-Library-WRL-)<br/>
В этом видео Channel 9 вы узнаете о том, как библиотека шаблонов среда выполнения Windows C++ помогает создавать приложения универсальная платформа Windows (UWP), а также создавать и использовать компоненты среда выполнения Windows.

[Практическое руководство. Активация и использование компонента среды выполнения Windows](how-to-activate-and-use-a-windows-runtime-component-using-wrl.md)<br/>
Показывает, как использовать библиотеку шаблонов среда выполнения Windows C++ для инициализации среда выполнения Windows и активации и использования компонента среда выполнения Windows.

[Практическое руководство. Завершение асинхронных операций](how-to-complete-asynchronous-operations-using-wrl.md)<br/>
Демонстрирует использование библиотеки шаблонов среда выполнения Windows C++ для запуска асинхронных операций и выполнения работы по завершении операций.

[Практическое руководство. Обработка событий](how-to-handle-events-using-wrl.md)<br/>
Показывает, как использовать библиотеку шаблонов среда выполнения Windows C++ для подписки на события объекта среда выполнения Windows и управления им.

[Пошаговое руководство. Создание приложения UWP с использованием WRL и Media Foundation](walkthrough-creating-a-windows-store-app-using-wrl-and-media-foundation.md)<br/>
Узнайте, как создать приложение UWP, которое использует [Microsoft Media Foundation](/windows/win32/medfound/microsoft-media-foundation-sdk).

[Практическое руководство. Создание классического компонента COM](how-to-create-a-classic-com-component-using-wrl.md)<br/>
Демонстрирует использование библиотеки шаблонов среда выполнения Windows C++ для создания базового COM-компонента и базового способа регистрации и использования COM-компонента из классического приложения.

[Как напрямую создать экземпляры компонентов WRL](how-to-instantiate-wrl-components-directly.md)<br/>
Сведения об использовании функций [Microsoft::WRL::Make](make-function.md) и [Microsoft::WRL::Details::MakeAndInitialize](makeandinitialize-function.md) для создания экземпляра компонента из определяющего его модуля.

[Практическое руководство. Использование winmdidl.exe и midlrt.exe для создания H-файлов из метаданных Windows](use-winmdidl-and-midlrt-to-create-h-files-from-windows-metadata.md)<br/>
Демонстрация использования пользовательских компонент среды выполнения Windows из WRL путем создания IDL-файла из метаданных WINMD.

[Пошаговое руководство. подключение с помощью задач и HTTP-запросов XML](../../parallel/concrt/walkthrough-connecting-using-tasks-and-xml-http-requests.md)<br/>
Показывает, как использовать интерфейсы [IXMLHTTPRequest2](/windows/win32/api/msxml6/nn-msxml6-ixmlhttprequest2) и [IXMLHTTPRequest2Callback](/windows/win32/api/msxml6/nn-msxml6-ixmlhttprequest2callback) вместе с задачами для отправки запросов HTTP GET и POST к веб-службе в приложении UWP.

[Пример приложения Bing Maps Trip Optimizer](https://github.com/Microsoft/VCSamples/tree/master/VC2012Samples/Windows%208%20samples/C%2B%2B/Windows%208%20app%20samples)<br/>
Использует `HttpRequest` класс, определенный в [пошаговом руководстве: подключение с помощью задач и HTTP-запросов XML](../../parallel/concrt/walkthrough-connecting-using-tasks-and-xml-http-requests.md) в контексте полного приложения UWP.

[Создание компонента DLL среды выполнения Windows с использованием примера C++](https://github.com/Microsoft/VCSamples/tree/master/VC2012Samples/Windows%208%20samples/C%2B%2B/Windows%208%20app%20samples)<br/>
Показывает, как использовать библиотеку шаблонов C++ среда выполнения Windows, чтобы создать внутрипроцессный компонент DLL и использовать его из C++/CX, JavaScript и C#.

[Пример игры DirectX Marble Maze](/samples/microsoft/windows-appsample-marble-maze/directx-marble-maze-game-sample/)<br/>
Демонстрирует использование библиотеки шаблонов среда выполнения Windows C++ для управления временем существования компонентов COM, таких как DirectX и Media Foundation в контексте полной трехмерной игры.

[Всплывающие уведомления из классических приложений](/windows/uwp/design/shell/tiles-and-notifications/toast-desktop-apps)<br/>
Демонстрирует, как отправлять всплывающие уведомления из классического приложения.

## <a name="windows-runtime-c-template-library-compared-to-atl"></a>Сравнение библиотеки шаблонов C++ среда выполнения Windows с ATL

Библиотека шаблонов C++ среда выполнения Windows похожа на библиотеку ATL, поскольку ее можно использовать для создания небольших и быстрых COM-объектов. Среда выполнения Windows библиотека шаблонов C++ и ATL также совместно используют такие понятия, как определение объектов в модулях, явная регистрация интерфейсов и открытие создания объектов с помощью фабрик. Если вы знакомы с библиотекой ATL, возможно, вам будет удобнее среда выполнения Windows библиотеку шаблонов C++.

Библиотека шаблонов C++ среда выполнения Windows поддерживает функции COM, необходимые для приложений UWP. Поэтому она отличается от библиотеки ATL, поскольку в последней нет непосредственной поддержки таких функций модели COM, как:

- aggregation

- стандартные реализации

- сдвоенные интерфейсы (`IDispatch`)

- стандартные интерфейсы перечислителя

- точки подключения

- перемещаемые интерфейсы

- внедрение OLE

- Элементы управления ActiveX

- COM+

## <a name="concepts"></a>Основные понятия

Среда выполнения Windows библиотека шаблонов C++ предоставляет типы, представляющие несколько основных понятий. Эти типы описаны в следующих разделах.

### <a name="comptr"></a>ComPtr

тип[ComPtr](comptr-class.md) — тип *интеллектуального указателя* , который представляет интерфейс, определяемый параметром шаблона. Тип `ComPtr` используется для объявления переменной, которая может получить доступ к членам объекта, производного от интерфейса. `ComPtr` автоматически поддерживает счетчик ссылок для указателя базового интерфейса и освобождает интерфейс, когда счетчик ссылок становится равен нулю.

### <a name="runtimeclass"></a>RuntimeClass

[RuntimeClass](runtimeclass-class.md) представляет собой экземпляр класса, который наследуется от набора указанных интерфейсов. `RuntimeClass`Объект может предоставить сочетание поддержки для одного или нескольких среда выполнения Windows COM-интерфейсов или слабой ссылки на компонент.

### <a name="module"></a>Модуль

[Module](module-class.md) представляет коллекцию связанных объектов. Объект `Module` управляет фабриками класса, создающими объекты, и регистрацией, которая позволяет другим приложениям использовать объект.

### <a name="callback"></a>Обратный вызов

Функция [Callback](callback-function-wrl.md) создает объект, функция-член которого является обработчиком событий (метод обратного вызова). Функция `Callback` используется для записи асинхронных операций.

### <a name="eventsource"></a>EventSource

[EventSource](eventsource-class.md) используется для управления обработчиками событий *делегатов* . Используйте среда выполнения Windows библиотеку шаблонов C++, чтобы реализовать делегат и использовать `EventSource` для добавления, удаления и вызова делегатов.

### <a name="asyncbase"></a>AsyncBase

[Метод asyncbase](asyncbase-class.md) предоставляет виртуальные методы, представляющие модель асинхронного программирования среда выполнения Windows. Переопределите члены этого класса для создания пользовательского класса, который может запускать и останавливать асинхронную операцию, а также проверять ход ее выполнения.

### <a name="ftmbase"></a>FtmBase

[FtmBase](ftmbase-class.md) представляет объект маршаллера в режиме свободного потока. `FtmBase` создает общую таблицу интерфейса (GIT) и помогает управлять маршалингом и прокси-объектами.

### <a name="weakref"></a>WeakRef

[WeakRef](weakref-class.md) — тип интеллектуального указателя, представляющий *слабую ссылку*на объект, который может быть доступен или недоступен. `WeakRef`Объект может использоваться только среда выполнения Windows, а не классической моделью COM.

Объект `WeakRef` обычно представляет объект, наличием которого управляет внешний поток или приложение. Например, объект `WeakRef` может ссылаться на объект файла. При открывании файла `WeakRef` является допустимым и файл, на который он ссылается, доступен. Однако после закрытия файла `WeakRef` перестает быть допустимым и файл становится недоступным.

## <a name="related-topics"></a>См. также

[Ключевые API по категориям](key-wrl-apis-by-category.md)\
Выделяет основные типы, функции и макросы библиотеки шаблонов C++ среда выполнения Windows.

[IsReference](wrl-reference.md)\
Содержит справочные сведения для библиотеки шаблонов среда выполнения Windows C++.

[Краткий справочник (C++/CX)](../../cppcx/quick-reference-c-cx.md)\
Краткое описание функций C++/CX, которые поддерживают среда выполнения Windows.

[Использование среда выполнения Windows компонентов в Visual C++](/windows/uwp/winrt-components/walkthrough-creating-a-basic-windows-runtime-component-in-cpp-and-calling-it-from-javascript-or-csharp)\
Показывает, как использовать C++/CX для создания базового среда выполнения Windows компонента.
